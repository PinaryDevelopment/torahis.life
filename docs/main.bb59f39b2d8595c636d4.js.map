{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./node_modules/tslib/tslib.es6.js","webpack:///./node_modules/@aurelia/kernel/dist/esnext/reporter.js","webpack:///./node_modules/@aurelia/kernel/dist/esnext/functions.js","webpack:///./node_modules/@aurelia/kernel/dist/esnext/metadata.js","webpack:///./node_modules/@aurelia/kernel/dist/esnext/resource.js","webpack:///./node_modules/@aurelia/kernel/dist/esnext/di.js","webpack:///./node_modules/@aurelia/kernel/dist/esnext/logger.js","webpack:///./node_modules/@aurelia/kernel/dist/esnext/path.js","webpack:///./node_modules/@aurelia/kernel/dist/esnext/profiler.js","webpack:///./node_modules/@aurelia/kernel/dist/esnext/eventaggregator.js","webpack:///./node_modules/@aurelia/kernel/dist/esnext/index.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/observation/proxy-observer.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/observation/subscriber-collection.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/lifecycle.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/observation/setter-observer.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/observation/binding-context.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/observation/signaler.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/definitions.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/binding/connectable.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/resources/binding-behavior.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/resources/value-converter.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/binding/ast.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/flags.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/observation.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/observation/collection-length-observer.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/observation/array-observer.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/observation/computed-observer.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/scheduler.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/observation/dirty-checker.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/observation/collection-size-observer.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/observation/map-observer.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/observation/primitive-observer.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/observation/property-accessor.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/observation/set-observer.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/observation/observer-locator.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/binding/property-binding.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/binding/call-binding.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/binding/expression-parser.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/binding/interpolation-binding.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/binding/let-binding.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/binding/ref-binding.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/observation/bindable-observer.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/resources/binding-behaviors/binding-mode.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/resources/binding-behaviors/debounce.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/resources/binding-behaviors/signals.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/resources/binding-behaviors/throttle.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/templating/bindable.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/resources/custom-attribute.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/dom.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/resources/custom-attributes/flags.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/lifecycle-task.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/resources/custom-attributes/if.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/resources/custom-attributes/repeat.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/resources/custom-attributes/replaceable.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/resources/custom-attributes/with.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/templating/children.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/resources/custom-element.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/resources/value-converters/sanitize.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/renderer.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/templating/render-context.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/templating/controller.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/templating/view.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/resources/value-converters/view.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/activator.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/aurelia.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/configuration.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/instructions.js","webpack:///./node_modules/@aurelia/runtime/dist/esnext/index.js","webpack:///./node_modules/@aurelia/jit/dist/esnext/ast.js","webpack:///./node_modules/@aurelia/jit/dist/esnext/attribute-pattern.js","webpack:///./node_modules/@aurelia/jit/dist/esnext/attribute-parser.js","webpack:///./node_modules/@aurelia/jit/dist/esnext/attribute-patterns.js","webpack:///./node_modules/@aurelia/jit/dist/esnext/binding-command.js","webpack:///./node_modules/@aurelia/jit/dist/esnext/semantic-model.js","webpack:///./node_modules/@aurelia/jit/dist/esnext/binding-commands.js","webpack:///./node_modules/@aurelia/jit/dist/esnext/common.js","webpack:///./node_modules/@aurelia/jit/dist/esnext/expression-parser.js","webpack:///./node_modules/@aurelia/jit/dist/esnext/configuration.js","webpack:///./node_modules/@aurelia/jit/dist/esnext/resource-model.js","webpack:///./node_modules/@aurelia/jit/dist/esnext/index.js","webpack:///./node_modules/@aurelia/runtime-html/dist/esnext/binding/listener.js","webpack:///./node_modules/@aurelia/runtime-html/dist/esnext/observation/element-attribute-observer.js","webpack:///./node_modules/@aurelia/runtime-html/dist/esnext/binding/attribute.js","webpack:///./node_modules/@aurelia/runtime-html/dist/esnext/observation/attribute-ns-accessor.js","webpack:///./node_modules/@aurelia/runtime-html/dist/esnext/observation/checked-observer.js","webpack:///./node_modules/@aurelia/runtime-html/dist/esnext/observation/class-attribute-accessor.js","webpack:///./node_modules/@aurelia/runtime-html/dist/esnext/observation/data-attribute-accessor.js","webpack:///./node_modules/@aurelia/runtime-html/dist/esnext/observation/element-property-accessor.js","webpack:///./node_modules/@aurelia/runtime-html/dist/esnext/observation/event-manager.js","webpack:///./node_modules/@aurelia/runtime-html/dist/esnext/observation/select-value-observer.js","webpack:///./node_modules/@aurelia/runtime-html/dist/esnext/observation/style-attribute-accessor.js","webpack:///./node_modules/@aurelia/runtime-html/dist/esnext/observation/svg-analyzer.js","webpack:///./node_modules/@aurelia/runtime-html/dist/esnext/observation/value-attribute-observer.js","webpack:///./node_modules/@aurelia/runtime-html/dist/esnext/observation/observer-locator.js","webpack:///./node_modules/@aurelia/runtime-html/dist/esnext/resources/binding-behaviors/attr.js","webpack:///./node_modules/@aurelia/runtime-html/dist/esnext/resources/binding-behaviors/self.js","webpack:///./node_modules/@aurelia/runtime-html/dist/esnext/resources/binding-behaviors/update-trigger.js","webpack:///./node_modules/@aurelia/runtime-html/dist/esnext/styles/shadow-dom-styles.js","webpack:///./node_modules/@aurelia/runtime-html/dist/esnext/projectors.js","webpack:///./node_modules/@aurelia/runtime-html/dist/esnext/dom.js","webpack:///./node_modules/@aurelia/runtime-html/dist/esnext/resources/custom-attributes/blur.js","webpack:///./node_modules/@aurelia/runtime-html/dist/esnext/resources/custom-attributes/focus.js","webpack:///./node_modules/@aurelia/runtime-html/dist/esnext/resources/custom-attributes/portal.js","webpack:///./node_modules/@aurelia/runtime-html/dist/esnext/definitions.js","webpack:///./node_modules/@aurelia/runtime-html/dist/esnext/instructions.js","webpack:///./node_modules/@aurelia/runtime-html/dist/esnext/create-element.js","webpack:///./node_modules/@aurelia/runtime-html/dist/esnext/resources/custom-elements/compose.js","webpack:///./node_modules/@aurelia/runtime-html/dist/esnext/html-renderer.js","webpack:///./node_modules/@aurelia/runtime-html/dist/esnext/configuration.js","webpack:///./node_modules/@aurelia/runtime-html/dist/esnext/index.js","webpack:///./node_modules/@aurelia/kernel/dist/esnext/platform.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/kernel/dist/esnext/platform.js","webpack:///./node_modules/@aurelia/debug/dist/esnext/binding/unparser.js","webpack:///./node_modules/@aurelia/debug/dist/esnext/reporter.js","webpack:///./node_modules/@aurelia/debug/dist/esnext/tracer.js","webpack:///./node_modules/@aurelia/jit-html/dist/esnext/attribute-syntax-transformer.js","webpack:///./node_modules/@aurelia/jit-html/dist/esnext/binding-commands.js","webpack:///./node_modules/@aurelia/jit-html/dist/esnext/semantic-model.js","webpack:///./node_modules/@aurelia/jit-html/dist/esnext/template-binder.js","webpack:///./node_modules/@aurelia/jit-html/dist/esnext/template-element-factory.js","webpack:///./node_modules/@aurelia/jit-html/dist/esnext/template-compiler.js","webpack:///./node_modules/@aurelia/jit-html/dist/esnext/configuration.js","webpack:///./node_modules/@aurelia/jit-html/dist/esnext/html-attribute-syntax-transformer.js","webpack:///./node_modules/@aurelia/runtime-html-browser/dist/esnext/browser-scheduler.js","webpack:///./node_modules/@aurelia/runtime-html-browser/dist/esnext/index.js","webpack:///./node_modules/@aurelia/jit-html-browser/dist/esnext/index.js","webpack:///./node_modules/aurelia/dist/esnext/quick-start.js","webpack:///./node_modules/process/browser.js","webpack:///(webpack)/buildin/global.js","webpack:///./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js","webpack:///./node_modules/css-loader/dist/runtime/api.js","webpack:///./src/my-app.css?d9e4","webpack:///./src/audio-player.css?478b","webpack:///./src/my-app.css","webpack:///./src/audio-player.css","webpack:///./node_modules/@aurelia/fetch-client/dist/esnext/retry-interceptor.js","webpack:///./node_modules/@aurelia/fetch-client/dist/esnext/http-client-configuration.js","webpack:///./node_modules/@aurelia/fetch-client/dist/esnext/http-client.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/kernel/dist/esnext/reporter.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/kernel/dist/esnext/functions.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/kernel/dist/esnext/metadata.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/kernel/dist/esnext/resource.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/kernel/dist/esnext/di.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/kernel/dist/esnext/logger.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/kernel/dist/esnext/path.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/kernel/dist/esnext/profiler.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/kernel/dist/esnext/eventaggregator.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime/dist/esnext/observation/subscriber-collection.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime/dist/esnext/observation/proxy-observer.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime/dist/esnext/lifecycle.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime/dist/esnext/observation/setter-observer.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime/dist/esnext/observation/binding-context.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime/dist/esnext/observation/signaler.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime/dist/esnext/definitions.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime/dist/esnext/binding/connectable.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime/dist/esnext/resources/binding-behavior.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime/dist/esnext/resources/value-converter.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime/dist/esnext/binding/ast.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime/dist/esnext/flags.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime/dist/esnext/observation.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime/dist/esnext/observation/collection-length-observer.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime/dist/esnext/observation/array-observer.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime/dist/esnext/observation/computed-observer.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime/dist/esnext/scheduler.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime/dist/esnext/observation/dirty-checker.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime/dist/esnext/observation/collection-size-observer.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime/dist/esnext/observation/map-observer.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime/dist/esnext/observation/primitive-observer.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime/dist/esnext/observation/property-accessor.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime/dist/esnext/observation/set-observer.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime/dist/esnext/observation/observer-locator.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime/dist/esnext/binding/property-binding.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime/dist/esnext/binding/call-binding.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime/dist/esnext/binding/expression-parser.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime/dist/esnext/binding/interpolation-binding.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime/dist/esnext/binding/let-binding.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime/dist/esnext/binding/ref-binding.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime/dist/esnext/observation/bindable-observer.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime/dist/esnext/resources/binding-behaviors/binding-mode.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime/dist/esnext/resources/binding-behaviors/debounce.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime/dist/esnext/resources/binding-behaviors/signals.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime/dist/esnext/resources/binding-behaviors/throttle.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime/dist/esnext/templating/bindable.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime/dist/esnext/resources/custom-attribute.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime/dist/esnext/dom.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime/dist/esnext/resources/custom-attributes/flags.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime/dist/esnext/lifecycle-task.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime/dist/esnext/resources/custom-attributes/if.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime/dist/esnext/resources/custom-attributes/repeat.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime/dist/esnext/resources/custom-attributes/replaceable.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime/dist/esnext/resources/custom-attributes/with.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime/dist/esnext/templating/children.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime/dist/esnext/resources/custom-element.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime/dist/esnext/resources/value-converters/sanitize.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime/dist/esnext/renderer.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime/dist/esnext/templating/render-context.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime/dist/esnext/templating/controller.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime/dist/esnext/templating/view.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime/dist/esnext/resources/value-converters/view.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime/dist/esnext/activator.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime/dist/esnext/aurelia.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime/dist/esnext/instructions.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime-html/dist/esnext/binding/listener.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime-html/dist/esnext/observation/element-attribute-observer.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime-html/dist/esnext/binding/attribute.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime-html/dist/esnext/observation/attribute-ns-accessor.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime-html/dist/esnext/observation/checked-observer.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime-html/dist/esnext/observation/class-attribute-accessor.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime-html/dist/esnext/observation/data-attribute-accessor.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime-html/dist/esnext/observation/element-property-accessor.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime-html/dist/esnext/observation/event-manager.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime-html/dist/esnext/observation/select-value-observer.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime-html/dist/esnext/observation/style-attribute-accessor.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime-html/dist/esnext/observation/svg-analyzer.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime-html/dist/esnext/observation/value-attribute-observer.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime-html/dist/esnext/observation/observer-locator.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime-html/dist/esnext/resources/binding-behaviors/attr.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime-html/dist/esnext/resources/binding-behaviors/self.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime-html/dist/esnext/resources/binding-behaviors/update-trigger.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime-html/dist/esnext/styles/shadow-dom-styles.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime-html/dist/esnext/projectors.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime-html/dist/esnext/dom.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime-html/dist/esnext/resources/custom-attributes/blur.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime-html/dist/esnext/resources/custom-attributes/focus.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime-html/dist/esnext/resources/custom-attributes/portal.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime-html/dist/esnext/definitions.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime-html/dist/esnext/instructions.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime-html/dist/esnext/create-element.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime-html/dist/esnext/resources/custom-elements/compose.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/node_modules/@aurelia/runtime-html/dist/esnext/html-renderer.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/dist/esnext/queue.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/dist/esnext/browser-navigator.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/dist/esnext/link-handler.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/dist/esnext/utils.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/dist/esnext/parser.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/dist/esnext/viewport-content.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/dist/esnext/viewport-scope.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/dist/esnext/route-recognizer.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/dist/esnext/found-route.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/dist/esnext/collection.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/dist/esnext/scope.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/dist/esnext/viewport.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/dist/esnext/type-resolvers.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/dist/esnext/viewport-instruction.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/dist/esnext/interfaces.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/dist/esnext/hook-manager.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/dist/esnext/hook.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/dist/esnext/nav-route.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/dist/esnext/nav.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/dist/esnext/task-queue.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/dist/esnext/browser-viewer-store.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/dist/esnext/router.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/dist/esnext/navigator.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/dist/esnext/instruction-resolver.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/dist/esnext/resources/nav.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/dist/esnext/resources/viewport.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/dist/esnext/resources/viewport-scope.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/dist/esnext/resources/goto.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/dist/esnext/resources/href.js","webpack:///./node_modules/aurelia/node_modules/@aurelia/router/dist/esnext/configuration.js","webpack:///./src/audio-player.html","webpack:///./src/audio-player.ts","webpack:///./src/my-app.html","webpack:///./src/shiur.ts","webpack:///./src/my-app.ts","webpack:///./src/main.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","__decorate","decorators","target","desc","arguments","length","getOwnPropertyDescriptor","Reflect","decorate","__param","paramIndex","decorator","__metadata","metadataKey","metadataValue","metadata","LogLevel","Reporter","level","code","params","error","Error","Tracer","enabled","liveLoggingEnabled","liveWriter","objName","methodName","args","writer","enableLiveLogging","optionsOrWriter","isNumericLookup","isArrayIndex","result","ch","charCodeAt","isNumberOrBigInt","isStringOrDate","Date","baseCase","CharKind","isDigit","assign","charToKind","char","toUpperCase","toLowerCase","input","cb","len","prevKind","sep","output","curChar","curKind","nextChar","charAt","nextKind","camelCase","cache","callback","pascalCase","slice","kebabCase","toArray","arr","Array","ids","nextId","context","compareNumber","a","b","emptyArray","mergeDistinct","arr1","arr2","lookup","arr3","item","len1","len2","push","bound","descriptor","configurable","boundFn","this","writable","mergeArrays","arrays","k","arraysLen","array","arrayLen","j","firstDefined","values","getPrototypeChain","functionPrototype","Function","getPrototypeOf","WeakMap","proto","chain","Type","set","toLookup","objs","isObject","isNullOrUndefined","isNativeFunction","isNative","sourceText","fn","toString","metadataInternalSlot","$typeError","operation","paramName","actualValue","expectedType","TypeError","map","String","join","toPropertyKeyOrUndefined","propertyKey","GetOrCreateMetadataMap","O","P","Create","targetMetadata","Map","metadataMap","OrdinaryHasOwnMetadata","MetadataKey","has","OrdinaryGetOwnMetadata","OrdinaryDefineOwnMetadata","MetadataValue","OrdinaryOwnMetadataKeys","keys","keysObj","$define","$has","OrdinaryHasMetadata","parent","$hasOwn","$get","OrdinaryGetMetadata","$getOwn","$getKeys","OrdinaryMetadataKeys","ownKeys","parentKeys","ownKeysLen","parentKeysLen","Set","add","$getOwnKeys","$delete","delete","OrdinaryDeleteMetadata","Metadata","define","hasOwn","getOwn","getKeys","getOwnKeys","obj","hasMetadata","hasDecorate","hasDefineMetadata","hasHasMetadata","hasHasOwnMetadata","hasGetMetadata","hasGetOwnMetadata","hasGetMetadataKeys","hasGetOwnMetadataKeys","hasDeleteMetadata","console","warn","ensurePropertyKeyOrUndefined","attributes","isArray","decorated","DecorateProperty","toPropertyKey","DecorateConstructor","annotation","prop","keyFor","isKey","startsWith","resource","Protocol","fromAnnotationOrDefinitionOrTypeOrDefault","def","getDefault","fromAnnotationOrTypeOrDefault","fromDefinitionOrDefault","ResolverBuilder","container","registerResolver","destinationKey","strategy","state","cloneArrayWithPossibleProps","source","clone","DI","createContainer","register","getDesignParamtypes","annotationParamtypes","appendTo","dependencies","inject","designParamtypes","getAnnotationParamtypes","Proto","getDependencies","auAnnotationParamtype","friendlyName","Interface","index","getOrCreateAnnotationParamTypes","noDefault","withDefault","configure","dep","constructor","transient","Registration","singleton","IContainer","createInterface","IServiceLocator","createResolver","resolver","resolve","handler","requestor","getAll","instance","ResolverStrategy","factory","getFactory","construct","getResolver","Factory","invoker","transformers","dynamicDependencies","invokeWithDynamicDependencies","invoke","ii","transformer","createFactory","staticDependencies","concat","classInvokers","deps","fallbackInvoker","write","containerResolver","isRegistry","registerDepth","root","resolvers","resourceResolvers","current","jj","defs","validateKey","indexOf","isResourceKey","registerTransformer","autoRegister","jitRegister","searchAncestors","buildAllResponse","keyAsValue","registrationResolver","newResolver","ParameterizedRegistry","filter","x","alias","originalKey","aliasKey","defer","undefined","results","ColorOptions","ILogConfig","LogConfig","ISink","ILogEventFactory","DefaultLogEventFactory","format","DefaultLogger","red","str","green","yellow","blue","magenta","cyan","white","grey","colorOptions","getLogLevelString","logLevelString","TRC","DBG","INF","WRN","ERR","FTL","QQQ","getIsoString","timestamp","toISOString","DefaultLogEvent","severity","message","optionalParams","scope","getScopeString","config","logger","now","ConsoleSink","$console","emit","event","debug","info","sinks","scopedLoggers","sinksLen","msgOrGetMsg","createLogEvent","trace","messageOrGetMessage","fatal","scopedLogger","encodeURIComponent","Profiler","timers","profileMap","profiler","createTimer","depth","mark","enter","topLevelCount","totalCount","leave","duration","enable","timer","disable","report","sort","forEach","Handler","messageType","invokeCallback","data","e","invokeHandler","handle","eventLookup","messageHandlers","channelOrInstance","subscribers","channel","channelOrType","idx","splice","sub","subscribe","dispose","ProxyObserver_1","subscriberCollection","_subscriberFlags","addSubscriber","removeSubscriber","hasSubscriber","hasSubscribers","callSubscribers","unsubscribe","collectionSubscriberCollection","_collectionSubscriberFlags","addCollectionSubscriber","removeCollectionSubscriber","hasCollectionSubscriber","hasCollectionSubscribers","callCollectionSubscribers","subscribeToCollection","unsubscribeFromCollection","subscriber","subscriberFlags","_subscriber0","_subscriber1","_subscriber2","_subscribersRest","addProxySubscriber","hasProxySubscriber","_proxySubscriberFlags","_proxySubscriber0","_proxySubscriber1","_proxySubscriber2","_proxySubscribersRest","_collectionSubscriber0","_collectionSubscriber1","_collectionSubscriber2","_collectionSubscribersRest","removeProxySubscriber","hasProxySubscribers","newValue","previousValue","flags","subscriber0","subscriber1","subscriber2","callSubscriber","id","ownFlags","handleChange","callProxySubscribers","handleProxyChange","indexMap","handleCollectionChange","ProxySubscriberCollection","proxy","raw","inBatch","getOrCreate","oldValue","Proxy","$raw","proxyObserver","$observer","getRawIfProxy","receiver","callPropertySubscribers","deleteProperty","thisArg","argArray","apply","ViewModelKind","subscribeToProxy","unsubscribeFromProxy","IController","MountStrategy","IViewFactory","ILifecycle","BoundQueue","lifecycle","head","tail","process","begin","end","controller","prevBound","nextBound","next","cur","afterBind","UnboundQueue","prevUnbound","nextUnbound","afterUnbind","AttachedQueue","mount","prevAttached","nextAttached","afterAttach","DetachedQueue","unmount","prevDetached","nextDetached","afterDetach","MountQueue","prevMount","nextMount","UnmountQueue","prevUnmount","nextUnmount","BatchQueue","queue","batch","flushBatch","currentValue","observing","persistentFlags","getValue","setValue","RuntimeError","Number","marker","freeze","keyOrObj","$synthetic","bc","ancestor","part","overrideContext","parentOverrideContext","bindingContext","parentScope","scopeParts","includes","$observers","oc","OverrideContext","ps","poc","ISignaler","Signaler","signals","listeners","listener","TargetedInstructionType","parentPartsOwnPartsLookup","mergeParts","parentParts","ownParts","ownPartsLookup","mergedParts","ITargetedInstruction","HooksDefinition","hasCreate","hasBeforeCompile","hasAfterCompile","hasAfterCompileChildren","hasBeforeBind","hasAfterBind","hasBeforeUnbind","hasAfterUnbind","hasBeforeAttach","hasAfterAttach","hasBeforeDetach","hasAfterDetach","hasCaching","registerAliases","aliases","keyFrom","none","slotNames","versionSlotNames","lastSlot","ensureEnoughSlotNames","currentSlot","addObserver","observer","observerSlots","version","observeProperty","propertyName","observerLocator","getObserver","unobserve","all","slots","slotName","connectableDecorator","connectable","BindingBehaviorStrategy","bindingBehavior","nameOrDef","BindingBehavior","assignIdTo","inheritsFromInterceptor","BindingInterceptor","getAnnotation","binding","expr","interceptor","locator","$scope","$state","updateTarget","updateSource","callSource","$bind","$unbind","isType","definition","valueConverter","ValueConverter","hasBind","$kind","hasUnbind","CustomExpression","expression","behaviorKey","evaluate","connect","behavior","evalList","unbind","visitor","visitBindingBehavior","converterKey","converter","toView","fromView","signaler","addSignalListener","removeSignalListener","visitValueConverter","AssignExpression","visitAssign","ConditionalExpression","condition","yes","no","visitConditional","visitAccessThis","$this","$parent","evaluatedValue","visitAccessScope","AccessMemberExpression","visitAccessMember","AccessKeyedExpression","visitAccessKeyed","func","getFunction","visitCallScope","CallMemberExpression","visitCallMember","visitCallFunction","left","right","f","visitBinary","visitUnary","PrimitiveLiteralExpression","visitPrimitiveLiteral","$undefined","$null","$true","$false","$empty","HtmlLiteralExpression","parts","elements","visitHtmlLiteral","ArrayLiteralExpression","visitArrayLiteral","ObjectLiteralExpression","visitObjectLiteral","cooked","expressions","visitTemplate","visitTaggedTemplate","ArrayBindingPattern","visitArrayBindingPattern","ObjectBindingPattern","visitObjectBindingPattern","BindingIdentifier","visitBindingIdentifier","declaration","iterable","size","$array","entry","entries","$map","$number","visitForOfStatement","isMulti","firstExpression","visitInterpolation","list","rawArray","BindingMode","BindingStrategy","State","LifecycleFlags","ExpressionKind","SubscriberFlags","DelegationStrategy","CollectionKind","createIndexMap","deletedItems","isIndexMap","CollectionLengthObserver","observerLookup","sortCompare","y","preSortCompare","insertionSort","from","to","compareFn","velement","ielement","vtmp","itmp","order","quickSort","v0","v1","v2","i0","i1","i2","c01","c02","c12","vpivot","ipivot","lowEnd","highStart","vtopElement","thirdIndex","partition","$push","$unshift","unshift","$pop","pop","$shift","shift","$splice","$reverse","reverse","$sort","methods","observe","argCount","notify","inserts","element","start","deleteCount","relativeStart","actualStart","Math","max","min","actualDeleteCount","itemCount","deleted","middle","lower","upper","lowerValue","lowerIndex","upperValue","upperIndex","descriptorProps","method","enableArrayObservationCalled","enableArrayObservation","indexObservers","collection","lengthObserver","getOrCreateIndexObserver","indexObserver","ArrayIndexObserver","owner","subscriberCount","arrayObserver","prevValue","currValue","addIndexObserver","removeIndexObserver","getArrayObserver","computedOverrideDefaults","static","volatile","CustomSetterObserver","convertProperty","overrides","propertyDeps","collectionDeps","isCollecting","createGetterTraps","subscribable","getValueAndCollectDependencies","unsubscribeAllDependencies","requireCollect","doNotCollect","addCollectionDep","proxyOrValue","getMapObserver","getSetObserver","addPropertyDep","defaultClockSettings","forceUpdateInterval","IClock","globalClock","opts","highRes","TaskQueuePriority","IScheduler","createPromise","$resolve","$reject","executor","reject","Promise","defaultQueueTaskOptions","delay","preempt","priority","persistent","reusable","TaskQueue","clock","scheduler","processingSize","processingHead","processingTail","pendingSize","pendingHead","pendingTail","delayedSize","delayedHead","delayedTail","flushRequested","yieldPromise","taskPool","taskPoolSize","lastRequest","microTaskRequestFlushTask","cancel","movePendingToProcessing","moveDelayedToProcessing","run","requestFlush","getTaskQueue","queueTask","noMoreFiniteWork","cancelFlush","time","task","reuse","Task","prev","status","taskQueue","remove","addToProcessing","queueTime","addToPending","addToDelayed","removeFromProcessing","removeFromDelayed","removeFromPending","reset","createdTime","finish","count","TaskAbortError","super","_result","_status","promise","ret","resetPersistentTask","err","returnToPool","isEmpty","IDirtyChecker","DirtyCheckSettings","framesPerCheck","disabled","throw","tracked","elapsedFrames","DirtyCheckProperty","queueRenderTask","check","delta","isDirty","flush","dirtyChecker","addProperty","removeProperty","CollectionSizeObserver","$clear","clear","oldSize","deleteResult","enableMapObservationCalled","enableMapObservation","noop","PrimitiveObserver","doNotCache","getStringLength","returnUndefined","PropertyAccessor","setValueDirect","$add","enableSetObservationCalled","observedSet","enableSetObservation","IObserverLocator","ITargetObserverLocator","ITargetAccessorLocator","targetObserverLocator","targetAccessorLocator","adapters","isBindingContext","getObservers","observersLookup","createPropertyObserver","getOrCreateObserversLookup","adapter","handles","overridesAccessor","getAccessor","observedArray","observedMap","createObserversLookup","isNode","getLengthObserver","getIndexObserver","subject","pd","getPropertyDescriptor","adapterObserver","getAdapterObserver","createProperty","computed","givenOverrides","createComputedObserver","oneTime","toViewOrOneTime","sourceExpression","targetProperty","targetObserver","$lifecycle","_previousValue","$args","IExpressionParser","expressionLookup","forOfLookup","interpolationLookup","bindingType","found","parseCore","split","firstPart","endsWith","replace","currentPart","BindingType","MultiInterpolationBinding","interpolation","isFirst","_newValue","Boolean","toBindingContext","cbName","$set","isProxy","propertyChangedCallback","propertyChanged","hasPropertyChangedCallback","shouldInterceptSet","createGetterSetter","is","BindingModeBehavior","originalModes","twoWay","firstArg","getPostRenderTaskQueue","isNaN","signal","names","lastCall","nextDelay","configOrTarget","$target","$prop","Bindable","isBindableAnnotation","bindableLists","bindables","addName","maybeList","addDescription","builder","configOrProp","attribute","primary","setInterpreter","propStart","prototypeChain","keysLen","Class","iProto","iDefs","customAttribute","CustomAttribute","templateController","isTemplateController","defaultBindingMode","hooks","noMultiBindings","for","node","INode","IRenderLocation","IDOM","ni","niDOM","addEventListener","appendChild","cloneNode","convertToRenderLocation","createDocumentFragment","createNodeSequence","createElement","createCustomEvent","dispatchEvent","createNodeObserver","createTemplate","createTextNode","getEffectiveParentNode","setEffectiveParentNode","insertBefore","isMarker","isNodeInstance","isRenderLocation","makeTarget","registerElementResolver","removeEventListener","setAttribute","DOM","dom","isInitialized","descriptors","protos","getOwnPropertyDescriptors","location","view","hold","$controller","attach","detach","InfrequentMutations","FrequentMutations","ObserveShallow","LifecycleTask","done","canCancel","wait","TaskSlot","IStartTask","TaskType","IStartTaskManager","slot","tasks","startTask","resolveTask","AggregateTerminalTask","PromiseTask","hasStarted","isCancelled","then","nextResult","ProviderTask","maybePromiseOrTask","catch","ContinuationTask","antecedent","TerminalTask","AggregateContinuationTask","antecedents","hasAsyncWork","ifFactory","elseFactory","elseView","ifView","swap","attachView","release","ensureView","deactivate","updateView","activate","bindView","ifBehavior","viewModel","renderable","hasPendingInstanceMutation","views","normalizedItems","checkCollectionObserver","bindings","forOf","local","normalizeToArray","processViewsKeyed","attachViews","detachViewsByRange","unbindAndRemoveViewsByRange","oldLength","createAndBindAllViews","attachViewsKeyed","offset","applyMutationsToIndices","detachViewsByKey","unbindAndRemoveViewsByKey","createAndBindNewViewsByKey","sortViewsByKey","oldObserver","newObserver","rawCollection","getCollectionObserver","items","iterate","iStart","iEnd","adjustLength","deletedLen","viewScope","newLen","fromParent","setContextualProperties","mapLen","nodes","unlink","copy","synchronizeIndices","seq","maxLen","prevIndices","Int32Array","tailIndices","cursor","low","high","mid","longestIncreasingSubsequence","seqLen","link","isLast","isEven","$index","$first","$last","$middle","$even","$odd","$length","bindChild","isChildrenObserverAnnotation","Children","childrenObserverLists","childrenObservers","options","query","defaultChildQuery","defaultChildFilter","defaultChildMap","children","tryStartObserving","projector","filterChildren","subscribeToChildrenChange","onChildrenChanged","CustomElement","customElement","definitionLookup","template","instructions","injectable","needsCompile","surrogates","containerless","isStrictBinding","shadowOptions","hasSlots","generateName","generateType","partialDefinition","nameOrSearchParents","searchParents","$injectable","nameDescriptor","defaultProto","IProjectorLocator","SCRIPT_REGEX","ISanitizer","SanitizeValueConverter","sanitizer","untrustedMarkup","sanitize","ITemplateCompiler","IInstructionRenderer","IRenderer","instructionRenderer","instructionType","decoratedTarget","metadataKeys","ownProperties","instructionRenderers","record","render","targets","host","targetInstructions","renderInstructions","type","ensureExpression","parser","srcOrExpr","parse","getTarget","potentialTarget","SetPropertyRenderer","instruction","getComponentFactory","res","component","createComponent","childController","forCustomElement","addController","forCustomAttribute","parentContext","viewFactory","getRenderContext","getViewFactory","renderLocation","componentFactory","controllers","childInstructions","childInstruction","applyBindingBehavior","addBinding","refHost","refTargetName","caController","ceController","getRefTarget","behaviorExpressionIndex","behaviorExpressions","behaviorExpression","behaviorOrFactory","definitionContainerLookup","definitionContainerPartsLookup","fragmentCache","parentContainer","containerLookup","containerPartsLookup","partsLookup","viewModelProvider","fragment","isCompiled","compiledDefinition","createChild","renderer","factoryProvider","parentControllerProvider","instructionProvider","renderLocationProvider","elementProvider","compiler","compile","prepare","parentController","resourceKey","templateDefinition","controllerLookup","vmKind","mountStrategy","getCached","getDefinition","getBindingContext","hydrateCustomElement","hydrateCustomAttribute","hydrateSynthetic","createObservers","childObserverNames","getOwnPropertyNames","observers","getLookup","childrenDescription","createChildrenObservers","beginChildComponentOperation","beforeCompile","compiledContext","projectorLocator","getElementProjector","createNodes","afterCompile","findTargets","afterCompileChildren","canReturnToCache","unmountSynthetic","bindCustomElement","bindCustomAttribute","bindSynthetic","unbindCustomElement","unbindCustomAttribute","unbindSynthetic","attachCustomElement","attachCustomAttribute","attachSynthetic","detachCustomElement","detachCustomAttribute","detachSynthetic","mountCustomElement","mountSynthetic","unmountCustomElement","cacheCustomElement","cacheCustomAttribute","cacheSynthetic","find","beforeBind","bindBindings","endBind","bindControllers","beforeUnbind","unbindControllers","endUnbind","unbindBindings","beforeAttach","attachControllers","beforeDetach","detachControllers","project","take","tryReturnToCache","caching","noProxy","observableNames","bindable","isCaching","cacheSize","doNotOverrideIfAlreadySet","maxCacheSize","parseInt","forSyntheticView","seenViews","WeakSet","notYetSeen","$view","toCustomElementDefinition","Views","definitions","$views","IViewLocator","ViewValueConverter","viewLocator","viewNameOrSelector","getViewComponentForObject","IActivator","taskManager","mgr","runBeforeRender","runBeforeBind","runBeforeAttach","getCachedOrThrow","initializer","IDOMInitializer","initialize","activator","beforeCreateTask","runBeforeCreate","createTask","combinedAntecedent","_isRunning","_isStarting","_isStopping","_root","isRunning","stop","onBeforeStart","onAfterStart","onBeforeStop","onAfterStop","detail","bubbles","cancelable","global","Aurelia","DefaultComponents","modelInstanceToBoundComponent","modelTypeToUnboundComponent","availableViews","resolvedViewName","getViewName","getOrCreateBoundComponent","BoundComponent","UnboundComponent","getOrCreateUnboundComponent","getView","vm","requestedName","v","DefaultResources","DefaultRenderers","RuntimeConfiguration","InterpolationInstruction","IteratorBindingInstruction","CallBindingInstruction","RefBindingInstruction","SetPropertyInstruction","HydrateElementInstruction","HydrateAttributeInstruction","HydrateTemplateController","LetElementInstruction","LetBindingInstruction","$StartTask","_slot","_promiseOrTask","_container","_key","_callback","_task","promiseOrTask","at","AttrSyntax","rawName","rawValue","command","CharSpec","chars","repeat","isSymbol","isInverted","hasOfNoneInverse","hasOfSingleInverse","hasOfMultipleInverse","hasOfNone","hasOfSingle","hasOfMultiple","other","_pattern","currentRecord","partsRecord","pattern","charSpec","patterns","nextStates","types","isEndpoint","child","equals","findChild","interpretation","childLen","append","StaticSegment","text","specs","DynamicSegment","symbols","spec","SymbolSegment","SegmentTypes","statics","dynamics","ISyntaxInterpreter","SyntaxInterpreter","rootState","initialStates","defOrDefs","currentState","segments","eachChar","states","getNextStates","aTypes","bTypes","findMatches","IAttributePattern","attributePattern","patternDefs","AttributePattern","definitionAnnotationKey","validatePrototype","getPatternDefinitions","IAttributeParser","interpreter","attrPatterns","attrPattern","interpret","bindingCommand","nameOrDefinition","BindingCommand","makeCamelCase","propName","syntax","SymbolFlags","createMarker","TemplateControllerSymbol","partName","physicalNode","_bindings","_parts","ReplacePartSymbol","CustomAttributeSymbol","PlainAttributeSymbol","BindingSymbol","CustomElementSymbol","isTarget","_customAttributes","_plainAttributes","_childNodes","isContainerless","LetElementSymbol","PlainElementSymbol","TextSymbol","default","unescapeCode","Access","Precedence","Token","Char","startIndex","lastIndex","currentToken","tokenValue","assignable","currentChar","SyntaxError","SemanticError","parseExpression","access","minPrecedence","nextToken","fromCharCode","parseInterpolation","op","TokenValues","consumeOpt","consume","parseArrayLiteralExpression","parseObjectLiteralExpression","parseTemplate","statement","parseForOfStatement","strings","opToken","tokenRaw","tagged","scanTemplateTail","CharScanners","scanNumber","isFloat","parseFloat","scanTemplate","token","expected","KeywordLookup","true","null","false","in","instanceof","typeof","void","of","codes","decompress","compressed","rangeCount","fill","returnToken","unexpectedCharacter","notMapped","IdParts","Uint8Array","quote","unescaped","buffer","last","unescapedStr","scanString","DefaultBindingSyntax","DefaultBindingLanguage","BindableInfo","attr","bindableInfo","hasPrimary","isPrimary","contextLookup","elementLookup","attributeLookup","commandLookup","rootContainer","rootResourceResolvers","model","optional","kind","targetEvent","delegationStrategy","preventDefault","eventManager","$event","AttributeObserver","targetAttribute","hasChanges","flushChanges","classList","style","setProperty","mutationRecords","shouldProcess","attributeName","contains","getPropertyValue","getAttribute","startObservation","stopObservation","subscription","$eMObservers","$mObserver","handleMutation","disconnect","invokeHandleMutation","$scheduler","AttributeNSAccessor","namespace","removeAttributeNS","setAttributeNS","getAttributeNS","defaultMatcher","CheckedObserver","valueObserver","synchronizeElement","elementValue","isRadio","matcher","checked","findIndex","ClassAttributeAccessor","nameIndex","isActive","classesToAdd","getClassesToAdd","addClassesAndUpdateIndex","classes","className","splitClassString","classString","matches","match","DataAttributeAccessor","removeAttribute","ElementPropertyAccessor","findOriginalEventTarget","composedPath","deepPath","path","stopPropagation","standardStopPropagation","propagationStopped","handleCapturedEvent","orderedCallbacks","capturedCallbacks","parentNode","orderedCallback","handleEvent","handleDelegatedEvent","delegatedCallbacks","ListenerTracker","eventName","capture","DelegateOrCaptureSubscription","decrement","TriggerSubscription","EventSubscriber","events","callbackOrListener","IEventManager","delegatedHandlers","capturedHandlers","handlerEntry","bubbling","increment","capturing","childObserverOptions","childList","subtree","characterData","SelectValueObserver","nodeObserver","multiple","synchronizeOptions","synchronizeValue","option","optionValue","selected","handleNodeChange","styles","cssText","styleTuples","rx","pair","exec","getStyleTuples","getStyleTuplesFromString","getStyleTuplesFromArray","getStyleTuplesFromObject","tuple","ISVGAnalyzer","ValueAttributeObserver","xlinkNS","xmlNS","xmlnsNS","nsAttributes","inputEvents","selectEvents","contentEvents","scrollEvents","overrideProps","svgAnalyzer","tagName","nsProps","isDataAttribute","IsDataAttribute","prefix","isStandardSvgAttribute","handleSelfEvent","selfEventCallSource","originalHandler","noopShadowDOMStyles","applyTo","IShadowDOMStyles","IShadowDOMGlobalStyles","defaultShadowOptions","shadowRoot","attachShadow","childNodes","getRootNode","NodeType","effectiveParentNodeOverrides","window","document","TNode","TElement","THTMLElement","TCustomEvent","TCSSStyleSheet","TShadowRoot","Node","Element","HTMLElement","CustomEvent","CSSStyleSheet","ShadowRoot","destroy","emptyNodes","FragmentNodeSequence","publisher","deep","locationEnd","createComment","locationStart","replaceChild","$start","$nodes","markupOrNode","content","init","fetch","eventType","evt","MutationObserver","takeRecords","markup","innerHTML","containerlessOffset","nextSibling","nodeType","textContent","childNodeOrNodeSequence","nodeToInsert","referenceNode","nodeName","potentialNode","removeChild","$DOM","isMounted","isLinked","refNode","targetNodeList","querySelectorAll","childNodeList","firstChild","lastChild","addToLinked","obtainRefNode","previousSibling","unset","defaultCaptureEventInit","passive","defaultBubbleEventInit","blurDocMap","BlurManager","blurs","createHandler","blur","addListeners","removeListeners","doc","win","navigator","pointerEnabled","linkedMultiple","searchSubTree","linkingContext","manager","createFor","unregister","triggerBlur","els","containsElementOrShadowRoot","linkedWith","links","contextNode","querySelector","body","el","onBlur","checkTargets","hasChecked","revertCheckage","markChecked","handleMousedown","composed","handleEventTarget","onpointerdown","ontouchstart","onmousedown","onfocus","onblur","Focus","needsApply","valueChanged","activeElement","focus","toTask","originalLoc","strict","currentTarget","callbackContext","targetChanged","oldTarget","newTarget","resolveTarget","activating","activated","deactivating","deactivated","$document","renderContext","queryContext","HTMLTargetedInstructionType","isHTMLTargetedInstruction","TextBindingInstruction","SetAttributeInstruction","SetClassAttributeInstruction","SetStyleAttributeInstruction","AttributeBindingInstruction","tagOrType","props","allInstructions","hasInstructions","addChildren","createElementForTag","createElementForType","lazyDefinition","getContext","mergeInto","composing","lastSubject","properties","reduce","acc","compose","viewPromise","resolveView","onComposed","provideViewFor","lockScope","isController","createView","SetAttributeRenderer","SetClassAttributeRenderer","addClasses","SetStyleAttributeRenderer","$component","RuntimeHtmlConfiguration","$global","self","_a","isBrowserLike","isWebWorkerLike","isNodeLike","versions","$now","getNanoSeconds","hrtime","moduleLoadTime","nodeLoadTime","upTime","performance","$performance","hr","uptime","emptyObject","$PLATFORM","PLATFORM","getMessageInfoForCode","codeLookup","createInvalidCodeMessageInfo","0","1","2","3","4","5","6","7","8","9","10","11","12","14","15","16","17","18","19","20","21","22","30","31","100","101","102","103","104","105","106","107","108","109","110","111","150","151","401","402","800","801","2000","2001","2002","2003","2004","1001","10000","TraceInfo","stack","defaultOptions","rendering","observation","mounting","di","jit","flagsText","flagNames","stringifyLifecycleFlags","_ctorName","description","ctorName","scopeText","$ctorName","keyText","$key","primitive","RenderingArgsProcessor","$hydrate","addComponent","BindingArgsProcessor","lockedBind","lockedUnbind","InternalObserversLookup","ObservationArgsProcessor","valueText","AttachingArgsProcessor","$attach","$detach","$cache","MountingArgsProcessor","$mount","$unmount","DIArgsProcessor","LifecycleArgsProcessor","JitArgsProcessor","TemplateBinder","IAttrSyntaxTransformer","invalidSurrogateAttribute","attributesToIgnore","hasInlineBindings","isTemplateControllerOf","manifest","resources","attrParser","exprParser","attrSyntaxTransformer","surrogate","attrSyntax","getBindingCommand","attrInfo","getAttributeInfo","transform","bindPlainAttribute","bindChildNodes","parentManifest","manifestRoot","parentManifestRoot","bindLetElement","elementInfo","getElementInfo","bindAttributes","symbol","manifestProxy","previousController","currentController","declareTemplateController","ensureAttributeOrder","manifestNode","currentTemplate","processTemplateControllers","partOwner","replacePart","proxyNode","processReplacePart","plainAttributes","modelOrValueIndex","checkedIndex","childNode","nextChild","bindManifest","bindText","textNode","wholeText","processInterpolationText","attrRawValue","bindMultiAttribute","customAttributes","valueLength","attrName","attrValue","attrTarget","ITemplateElementFactory","markupCache","firstElementChild","nextElementSibling","attrSyntaxModifier","binder","compilation","customAttributeLength","plainAttributeLength","compileCustomAttribute","compilePlainAttribute","compileChildNodes","toDefinition","instructionRows","compileParentNode","instructionRow","compileAttributes","compileBindings","compileParts","compileCustomElement","compilePlainElement","compileTemplateController","controllerInstructionRows","controllerScopeParts","bindingInstructions","compileBinding","attributeInstructions","plainAttributesLength","isOnSurrogate","replaceParts","partScopeParts","partInstructionRows","hasAttribute","shouldDefaultToTwoWay","createMicrotaskFlushRequestor","called","wnd","queueMicrotask","$window","$flush","callFlush","createQueueMicrotaskFlushRequestor","createPromiseFlushRequestor","flip","val","createMutationObserverFlushRequestor","createSetTimeoutFlushRequestor","clearTimeout","request","setTimeout","createRequestAnimationFrameFlushRequestor","cancelAnimationFrame","requestAnimationFrame","createPostRequestAnimationFrameFlushRequestor","rafHandle","timeoutHandle","queueFlush","createRequestIdleCallbackFlushRequestor","hasNative","requestIdleCallback","timeout","cancelIdleCallback","BrowserScheduler","microTaskTaskQueue","renderTaskQueue","macroTaskTaskQueue","postRenderTaskQueue","idleTaskQueue","yield","yieldIdleTask","yieldPostRenderTask","yieldMacroTask","yieldRenderTask","yieldMicroTask","ownerDocument","RuntimeHtmlBrowserConfiguration","JitHtmlBrowserConfiguration","createAurelia","au","env","app","cachedSetTimeout","cachedClearTimeout","defaultSetTimout","defaultClearTimeout","runTimeout","fun","currentQueue","draining","queueIndex","cleanUpNextTick","drainQueue","runClearTimeout","Item","nextTick","title","browser","argv","on","addListener","once","off","removeListener","removeAllListeners","prependListener","prependOnceListener","cwd","chdir","dir","umask","g","memo","isOldIE","atob","styleTarget","HTMLIFrameElement","contentDocument","stylesInDom","modulesToDom","css","media","sourceMap","addStyle","insertStyleElement","nonce","insert","textStore","replaceText","replacement","applyToSingletonTag","styleSheet","cssNode","applyToTag","btoa","unescape","JSON","stringify","singletonCounter","update","styleIndex","removeStyleElement","newObj","base","newList","useSourceMap","cssMapping","sourceMapping","base64","sourceURLs","sources","sourceRoot","cssWithMappingToString","mediaQuery","dedupe","alreadyImportedModules","_i","api","exported","locals","___CSS_LOADER_API_IMPORT___","retryStrategy","defaultRetryConfig","maxRetries","interval","retryConfig","counter","requestClone","response","httpClient","doRetry","minRandomInterval","maxRandomInterval","retryStrategies","calculateDelay","newRequest","beforeRetry","retryableRequest","retryCount","random","baseUrl","defaults","interceptors","credentials","rejectErrorResponses","withInterceptor","rejectOnError","ok","absoluteUrlRegexp","activeRequestCount","isRequesting","isConfigured","normalizedConfig","isPrototypeOf","Headers","headers","retryInterceptorIndex","trackRequestStart","buildRequest","processRequest","Response","Request","processResponse","trackRequestEnd","requestContentType","parsedDefaultHeaders","parsedHeaders","$headers","parseHeaderValues","bodyObj","requestInit","url","test","getRequestUrl","isJSON","defaultHeaders","$defaultHeaders","setDefaultHeaders","Blob","callFetch","applyInterceptors","successName","errorName","interceptorArgs","successHandler","errorHandler","identity","reason","thrower","encode","encodeKey","buildParam","traditional","arrayKey","processScalarParam","existedParam","parseComplexParam","queryParams","currentParams","keysLastIndex","StartTask","isRenderContext","Queue","pending","processing","allowedExecutionCostWithinTick","currentExecutionCostInCurrentTick","dequeue","itemOrItems","costOrCosts","costs","promises","qItem","cost","useUrlFragmentHash","forwardedState","handlePopstate","ev","enqueue","processCalls","qCall","parameters","suppressPopstate","history","pendingCalls","pathname","search","hash","currentEntry","viewerState","go","navigationEntry","firstEntry","pushNavigatorState","calls","_resolve","useHref","getEventInfo","shouldHandleEvent","anchor","targetIsThisWindow","altKey","ctrlKey","metaKey","shiftKey","gotoAttr","goto","href","leftButtonClicked","button","targetWindow","arrayRemove","removed","arrIndex","parseQuery","param","decodeURIComponent","ContentStatus","fullStateInstruction","contentStatus","entered","fromCache","fromHistory","reentry","isComponentType","componentType","toComponentType","componentInstance","viewport","sameComponent","reentryBehavior","fallback","toComponentInstance","setParameters","componentName","setComponent","ee","previousInstruction","canEnter","typeParameters","toSpecifiedParameters","merged","router","createViewportInstruction","nextInstruction","canLeave","stateful","getElementsByTagName","top","scrollTo","scrollTop","scrollLeft","removeComponent","terminateComponent","unloadComponent","destroyComponent","owningScope","rootComponentType","catches","nextContent","available","sourceItem","sourceItemIndex","connectedScope","enabledChildren","isViewportScope","viewportScope","viewportInstruction","instructionResolver","parseViewportInstruction","isClearViewportInstruction","isClearAllViewportsInstruction","isAddViewportInstruction","removeSourceItem","segment","clearViewportInstruction","addViewportInstruction","getAvailableSourceItem","siblings","every","sibling","routes","HandlerEntry","RouteGenerator","handlers","TypesRecord","stars","RecognizeResult","isDynamic","invalidChars","validChars","escapeRegex","RegExp","caseSensitive","string","consumed","StarSegment","EpsilonSegment","route","skippableStates","regex","routeName","normalizedRoute","splitRoute","firstState","put","nextState","routeNames","nameOrRoute","getRoute","generationUsesHref","routeParams","segmentValue","generate","queryString","pairs","buildQueryString","isSlashDropped","normalizedPath","queryStart","parseQueryString","decodeURI","pathLen","solutions","solution","captures","currentCapture","FoundRoute","matching","remaining","currentIndex","hasScope","replacedChildren","childCollections","passThroughScope","isViewport","scopes","some","viewportScopes","viewports","includeDisabled","allViewports","allScopes","getOwnedScopes","alreadyFound","disregardViewports","foundViewports","remainingInstructions","ownedScopes","availableViewportScopes","availableViewports","getEnabledViewports","viewportName","viewportInstructions","foundViewportScope","removeCurrent","foundViewport","acceptSegment","addSourceItem","needsViewportDescribed","wantComponent","ownsScope","acceptComponent","remainingViewports","nextScopeInstructions","rem","withoutViewports","doesntNeedViewportDescribed","setViewport","getOwnedViewports","addChild","setElement","vp","includeReplaced","hoistedChildren","reparentViewportInstructions","findMatchingRouteInRoutes","getRoutes","findMatchingRoute","recognizableRoutes","ensureProperRoute","ilen","newRoute","recognizer","recognize","remainingPath","foundConfiguration","cloneViewportInstructions","addParameters","NavigationInstructionResolver","toViewportInstructions","forceRemove","elementResolve","previousViewportState","historyCache","navigation","back","forward","cached","isCacheEqual","clearReplacedChildren","equalComponent","refresh","disableReplacedChildren","equalParameters","clearState","usedBy","noLink","noHistory","parseViewportInstructions","freeContent","doForceRemove","statefulHistory","waitForElement","loadComponent","initializeComponent","unloadContent","reenableReplacedChildren","ComponentAppellationResolver","isName","isInstance","getName","getType","getInstance","ViewportHandleResolver","createViewportInstructions","navigationInstructions","findScope","rootScope","viewportComponent","newInstruction","ParametersType","ReentryBehavior","HookTypes","parametersString","parametersRecord","parametersList","parametersType","parseComponentParameters","typedParameters","stringifyComponentParameters","isComponentName","isComponentInstance","getViewport","specifications","specified","parameter","sorted","compareParameters","compareType","sameParameters","mine","others","Hook","hook","includeTargets","excludeTargets","include","exclude","navigationInstruction","arg","cvTarget","beforeNavigation","transformFromUrl","transformToUrl","lastIdentity","hookFunction","wantsMatch","outcome","nav","linkVisible","linkActive","visible","active","meta","parseRoute","computeLink","consideredActive","execute","computeVisible","computeActive","activeChild","components","activeComponents","flattenViewportInstructions","stringifyViewportInstructions","addRoute","updateRoutes","QueueTask","createQueueTask","eventTask","async","evTask","suppressPopstateEvent","popstate","doneTask","forwardState","steps","titleOrEmpty","pushState","replaceState","popState","ClosestScope","IRouter","linkHandler","navs","appendedInstructions","statefulHistoryLength","useDirectRoutes","useConfiguredRoutes","loadedFirst","processingNavigation","lastNavigation","staleChecks","linkCallback","origin","navigatorCallback","processNavigations","navigatorSerializeCallback","preservedEntries","excludeComponents","preservedEntry","serialized","alreadyDone","freeComponents","browserNavigatorCallback","browserNavigationEvent","fromBrowser","navigate","qInstruction","reportCallback","instructionNavigation","configuredRoute","findInstructions","configuredRoutePath","foundInstructions","unknownRoute","clearScopeOwners","clearViewportScopes","clearInstruction","instr","addInstruction","isAddAllViewportsInstruction","updatedScopeOwners","alreadyFoundInstructions","findViewports","guard","log","changedScopeOwners","hooked","hookManager","invokeBeforeNavigation","cancelNavigation","scopeOwner","setNextContent","abortContentChange","hasRemaining","configured","routeScopeOwners","appendInstructions","appendedInstruction","existingAlreadyFound","sameViewport","existingFound","existingRemaining","loadContent","replacePaths","new","first","repeating","untracked","finalizeContentChange","finalize","addHooks","separators","store","serializeCallback","ensureRootScope","replacing","getClosestScope","viewModelOrContainer","getContainer","viewModelOrElement","getClosestContainer","findParentScope","addViewport","setClosestScope","removeViewport","unsetClosestScope","addViewportScope","removeViewportScope","toOptions","matchScope","matchChildren","flat","findNav","addNav","addRoutes","addHook","instructionScope","transformUrl","invokeTransformFromUrl","hasSiblingInstructions","foundRoute","nextInstructions","staleCheck","activeRoute","invokeTransformToUrl","fullViewportStates","CustomElementFor","nodeResourceName","qEntry","navigationFlags","uninitializedEntry","loadState","refreshing","historyMovement","pendingNavigations","movement","newIndex","saveState","getState","storedEntry","toStoredEntry","toStoreableEntry","replaceNavigatorState","previous","storableEntry","popNavigatorState","indexPreserve","previousEntry","storeable","scopeStart","scopeEnd","noScope","parametersEnd","parameterSeparator","parameterKeySeparator","action","setInstructionResolver","parsedInstructions","parseViewportInstructionsWorker","excludeViewport","viewportContext","stringifyViewportInstruction","stringifyAViewportInstruction","excludeCurrentViewport","excludeCurrentComponent","forceDescription","stringified","nextStringified","stringifyScopedViewportInstructions","scopeContext","clearViewports","newPath","merge","keepInstances","clones","uriComponent","seps","grouped","parseAViewportInstruction","tokens","pos","specials","special","findNextToken","excludeComponent","instructionString","specification","toSortedParameters","NavCustomElement","ul","li","ulActive","liActive","aActive","ParentViewport","createInjectable","parentViewport","isBound","connectViewport","disconnectViewport","checkExists","ParentViewportScope","connectViewportScope","disconnectViewportScope","hasHref","activeClass","updateValue","created","checkActive","eventListener","hasGoto","configurationOptions","configurationCall","routerConfiguration","with","loadUrl","AudioPlayer","totalLength","currentLocation","volume","currentTime","currentTimeElement","audioElement","createTimeSpan","percent","paused","play","pause","timeInSeconds","minutes","floor","toFixed","seconds","Shiur","shiur","normalize","toLocaleLowerCase","author","series","subseries","date","client","shiurim","selectedShiur","selectedVersion","json","currentYear","getFullYear","getVersionLocation"],"mappings":"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","file":"main.bb59f39b2d8595c636d4.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 18);\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","export var LogLevel;\n(function (LogLevel) {\n    /**\n     * The most detailed information about internal app state.\n     *\n     * Disabled by default and should never be enabled in a production environment.\n     */\n    LogLevel[LogLevel[\"trace\"] = 0] = \"trace\";\n    /**\n     * Information that is useful for debugging during development and has no long-term value.\n     */\n    LogLevel[LogLevel[\"debug\"] = 1] = \"debug\";\n    /**\n     * Information about the general flow of the application that has long-term value.\n     */\n    LogLevel[LogLevel[\"info\"] = 2] = \"info\";\n    /**\n     * Unexpected circumstances that require attention but do not otherwise cause the current flow of execution to stop.\n     */\n    LogLevel[LogLevel[\"warn\"] = 3] = \"warn\";\n    /**\n     * Unexpected circumstances that cause the flow of execution in the current activity to stop but do not cause an app-wide failure.\n     */\n    LogLevel[LogLevel[\"error\"] = 4] = \"error\";\n    /**\n     * Unexpected circumstances that cause an app-wide failure or otherwise require immediate attention.\n     */\n    LogLevel[LogLevel[\"fatal\"] = 5] = \"fatal\";\n    /**\n     * No messages should be written.\n     */\n    LogLevel[LogLevel[\"none\"] = 6] = \"none\";\n})(LogLevel || (LogLevel = {}));\nexport const Reporter = {\n    level: 3 /* warn */,\n    write(code, ...params) { return; },\n    error(code, ...params) { return new Error(`Code ${code}`); }\n};\nexport const Tracer = {\n    /**\n     * A convenience property for the user to conditionally call the tracer.\n     * This saves unnecessary `noop` and `slice` calls in non-AOT scenarios even if debugging is disabled.\n     * In AOT these calls will simply be removed entirely.\n     *\n     * This property **only** turns on tracing if `@aurelia/debug` is included and configured as well.\n     */\n    enabled: false,\n    liveLoggingEnabled: false,\n    liveWriter: null,\n    /**\n     * Call this at the start of a method/function.\n     * Each call to `enter` **must** have an accompanying call to `leave` for the tracer to work properly.\n     *\n     * @param objName - Any human-friendly name to identify the traced object with.\n     * @param methodName - Any human-friendly name to identify the traced method with.\n     * @param args - Pass in `Array.prototype.slice.call(arguments)` to also trace the parameters, or `null` if this is not needed (to save memory/cpu)\n     */\n    enter(objName, methodName, args) { return; },\n    /**\n     * Call this at the end of a method/function. Pops one trace item off the stack.\n     */\n    leave() { return; },\n    /**\n     * Writes only the trace info leading up to the current method call.\n     *\n     * @param writer - An object to write the output to.\n     */\n    writeStack(writer) { return; },\n    /**\n     * Writes all trace info captured since the previous flushAll operation.\n     *\n     * @param writer - An object to write the output to. Can be null to simply reset the tracer state.\n     */\n    flushAll(writer) { return; },\n    enableLiveLogging,\n    /**\n     * Stops writing out each trace info item as they are traced.\n     */\n    disableLiveLogging() { return; }\n};\nfunction enableLiveLogging(optionsOrWriter) { return; }\n//# sourceMappingURL=reporter.js.map","import { PLATFORM } from './platform';\nconst isNumericLookup = {};\n/**\n * Efficiently determine whether the provided property key is numeric\n * (and thus could be an array indexer) or not.\n *\n * Always returns true for values of type `'number'`.\n *\n * Otherwise, only returns true for strings that consist only of positive integers.\n *\n * Results are cached.\n */\nexport function isArrayIndex(value) {\n    switch (typeof value) {\n        case 'number':\n            return value >= 0 && (value | 0) === value;\n        case 'string': {\n            const result = isNumericLookup[value];\n            if (result !== void 0) {\n                return result;\n            }\n            const length = value.length;\n            if (length === 0) {\n                return isNumericLookup[value] = false;\n            }\n            let ch = 0;\n            for (let i = 0; i < length; ++i) {\n                ch = value.charCodeAt(i);\n                if (i === 0 && ch === 0x30 && length > 1 /* must not start with 0 */ || ch < 0x30 /* 0 */ || ch > 0x39 /* 9 */) {\n                    return isNumericLookup[value] = false;\n                }\n            }\n            return isNumericLookup[value] = true;\n        }\n        default:\n            return false;\n    }\n}\n/**\n * Determines if the value passed is a number or bigint for parsing purposes\n *\n * @param value - Value to evaluate\n */\nexport function isNumberOrBigInt(value) {\n    switch (typeof value) {\n        case 'number':\n        case 'bigint':\n            return true;\n        default:\n            return false;\n    }\n}\n/**\n * Determines if the value passed is a number or bigint for parsing purposes\n *\n * @param value - Value to evaluate\n */\nexport function isStringOrDate(value) {\n    switch (typeof value) {\n        case 'string':\n            return true;\n        case 'object':\n            return value instanceof Date;\n        default:\n            return false;\n    }\n}\n/**\n * Base implementation of camel and kebab cases\n */\nconst baseCase = (function () {\n    let CharKind;\n    (function (CharKind) {\n        CharKind[CharKind[\"none\"] = 0] = \"none\";\n        CharKind[CharKind[\"digit\"] = 1] = \"digit\";\n        CharKind[CharKind[\"upper\"] = 2] = \"upper\";\n        CharKind[CharKind[\"lower\"] = 3] = \"lower\";\n    })(CharKind || (CharKind = {}));\n    // eslint-disable-next-line @typescript-eslint/consistent-type-assertions\n    const isDigit = Object.assign(Object.create(null), {\n        '0': true,\n        '1': true,\n        '2': true,\n        '3': true,\n        '4': true,\n        '5': true,\n        '6': true,\n        '7': true,\n        '8': true,\n        '9': true,\n    });\n    function charToKind(char) {\n        if (char === '') {\n            // We get this if we do charAt() with an index out of range\n            return 0 /* none */;\n        }\n        if (char !== char.toUpperCase()) {\n            return 3 /* lower */;\n        }\n        if (char !== char.toLowerCase()) {\n            return 2 /* upper */;\n        }\n        if (isDigit[char] === true) {\n            return 1 /* digit */;\n        }\n        return 0 /* none */;\n    }\n    return function (input, cb) {\n        const len = input.length;\n        if (len === 0) {\n            return input;\n        }\n        let sep = false;\n        let output = '';\n        let prevKind;\n        let curChar = '';\n        let curKind = 0 /* none */;\n        let nextChar = input.charAt(0);\n        let nextKind = charToKind(nextChar);\n        for (let i = 0; i < len; ++i) {\n            prevKind = curKind;\n            curChar = nextChar;\n            curKind = nextKind;\n            nextChar = input.charAt(i + 1);\n            nextKind = charToKind(nextChar);\n            if (curKind === 0 /* none */) {\n                if (output.length > 0) {\n                    // Only set sep to true if it's not at the beginning of output.\n                    sep = true;\n                }\n            }\n            else {\n                if (!sep && output.length > 0 && curKind === 2 /* upper */) {\n                    // Separate UAFoo into UA Foo.\n                    // Separate uaFOO into ua FOO.\n                    sep = prevKind === 3 /* lower */ || nextKind === 3 /* lower */;\n                }\n                output += cb(curChar, sep);\n                sep = false;\n            }\n        }\n        return output;\n    };\n})();\n/**\n * Efficiently convert a string to camelCase.\n *\n * Non-alphanumeric characters are treated as separators.\n *\n * Primarily used by Aurelia to convert DOM attribute names to ViewModel property names.\n *\n * Results are cached.\n */\nexport const camelCase = (function () {\n    const cache = Object.create(null);\n    function callback(char, sep) {\n        return sep ? char.toUpperCase() : char.toLowerCase();\n    }\n    return function (input) {\n        let output = cache[input];\n        if (output === void 0) {\n            output = cache[input] = baseCase(input, callback);\n        }\n        return output;\n    };\n})();\n/**\n * Efficiently convert a string to PascalCase.\n *\n * Non-alphanumeric characters are treated as separators.\n *\n * Primarily used by Aurelia to convert element names to class names for synthetic types.\n *\n * Results are cached.\n */\nexport const pascalCase = (function () {\n    const cache = Object.create(null);\n    return function (input) {\n        let output = cache[input];\n        if (output === void 0) {\n            output = camelCase(input);\n            if (output.length > 0) {\n                output = output[0].toUpperCase() + output.slice(1);\n            }\n            cache[input] = output;\n        }\n        return output;\n    };\n})();\n/**\n * Efficiently convert a string to kebab-case.\n *\n * Non-alphanumeric characters are treated as separators.\n *\n * Primarily used by Aurelia to convert ViewModel property names to DOM attribute names.\n *\n * Results are cached.\n */\nexport const kebabCase = (function () {\n    const cache = Object.create(null);\n    function callback(char, sep) {\n        return sep ? `-${char.toLowerCase()}` : char.toLowerCase();\n    }\n    return function (input) {\n        let output = cache[input];\n        if (output === void 0) {\n            output = cache[input] = baseCase(input, callback);\n        }\n        return output;\n    };\n})();\n/**\n * Efficiently (up to 10x faster than `Array.from`) convert an `ArrayLike` to a real array.\n *\n * Primarily used by Aurelia to convert DOM node lists to arrays.\n */\nexport function toArray(input) {\n    // benchmark: http://jsben.ch/xjsyF\n    const { length } = input;\n    const arr = Array(length);\n    for (let i = 0; i < length; ++i) {\n        arr[i] = input[i];\n    }\n    return arr;\n}\nconst ids = {};\n/**\n * Retrieve the next ID in a sequence for a given string, starting with `1`.\n *\n * Used by Aurelia to assign unique ID's to controllers and resources.\n *\n * Aurelia will always prepend the context name with `au$`, so as long as you avoid\n * using that convention you should be safe from collisions.\n */\nexport function nextId(context) {\n    if (ids[context] === void 0) {\n        ids[context] = 0;\n    }\n    return ++ids[context];\n}\n/**\n * Reset the ID for the given string, so that `nextId` will return `1` again for the next call.\n *\n * Used by Aurelia to reset ID's in between unit tests.\n */\nexport function resetId(context) {\n    ids[context] = 0;\n}\n/**\n * A compare function to pass to `Array.prototype.sort` for sorting numbers.\n * This is needed for numeric sort, since the default sorts them as strings.\n */\nexport function compareNumber(a, b) {\n    return a - b;\n}\nconst emptyArray = PLATFORM.emptyArray;\n/**\n * Efficiently merge and deduplicate the (primitive) values in two arrays.\n *\n * Does not deduplicate existing values in the first array.\n *\n * Guards against null or undefined arrays.\n *\n * Returns `PLATFORM.emptyArray` if both arrays are either `null`, `undefined` or `PLATFORM.emptyArray`\n *\n * @param slice - If `true`, always returns a new array copy (unless neither array is/has a value)\n */\nexport function mergeDistinct(arr1, arr2, slice) {\n    if (arr1 === void 0 || arr1 === null || arr1 === emptyArray) {\n        if (arr2 === void 0 || arr2 === null || arr2 === emptyArray) {\n            return emptyArray;\n        }\n        else {\n            return slice ? arr2.slice(0) : arr2;\n        }\n    }\n    else if (arr2 === void 0 || arr2 === null || arr2 === emptyArray) {\n        return slice ? arr1.slice(0) : arr1;\n    }\n    const lookup = {};\n    const arr3 = slice ? arr1.slice(0) : arr1;\n    let len1 = arr1.length;\n    let len2 = arr2.length;\n    while (len1-- > 0) {\n        lookup[arr1[len1]] = true;\n    }\n    let item;\n    while (len2-- > 0) {\n        item = arr2[len2];\n        // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n        if (lookup[item] === void 0) {\n            arr3.push(item);\n            lookup[item] = true;\n        }\n    }\n    return arr3;\n}\n/**\n * Decorator. (lazily) bind the method to the class instance on first call.\n */\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport function bound(target, key, descriptor) {\n    return {\n        configurable: true,\n        enumerable: descriptor.enumerable,\n        get() {\n            // eslint-disable-next-line @typescript-eslint/no-unnecessary-type-assertion\n            const boundFn = descriptor.value.bind(this);\n            Reflect.defineProperty(this, key, {\n                value: boundFn,\n                writable: true,\n                configurable: true,\n                enumerable: descriptor.enumerable,\n            });\n            return boundFn;\n        },\n    };\n}\nexport function mergeArrays(...arrays) {\n    const result = [];\n    let k = 0;\n    const arraysLen = arrays.length;\n    let arrayLen = 0;\n    let array;\n    for (let i = 0; i < arraysLen; ++i) {\n        array = arrays[i];\n        if (array !== void 0) {\n            arrayLen = array.length;\n            for (let j = 0; j < arrayLen; ++j) {\n                result[k++] = array[j];\n            }\n        }\n    }\n    return result;\n}\nexport function mergeObjects(...objects) {\n    const result = {};\n    const objectsLen = objects.length;\n    let object;\n    let key;\n    for (let i = 0; i < objectsLen; ++i) {\n        object = objects[i];\n        if (object !== void 0) {\n            for (key in object) {\n                result[key] = object[key];\n            }\n        }\n    }\n    return result;\n}\nexport function firstDefined(...values) {\n    const len = values.length;\n    let value;\n    for (let i = 0; i < len; ++i) {\n        value = values[i];\n        if (value !== void 0) {\n            return value;\n        }\n    }\n    throw new Error(`No default value found`);\n}\nexport const getPrototypeChain = (function () {\n    const functionPrototype = Function.prototype;\n    // eslint-disable-next-line @typescript-eslint/unbound-method\n    const getPrototypeOf = Object.getPrototypeOf;\n    const cache = new WeakMap();\n    let proto = functionPrototype;\n    let i = 0;\n    let chain = void 0;\n    return function (Type) {\n        chain = cache.get(Type);\n        if (chain === void 0) {\n            cache.set(Type, chain = [proto = Type]);\n            i = 0;\n            while ((proto = getPrototypeOf(proto)) !== functionPrototype) {\n                chain[++i] = proto;\n            }\n        }\n        return chain;\n    };\n})();\nexport function toLookup(...objs) {\n    return Object.assign(Object.create(null), ...objs);\n}\n/**\n * Determine whether a value is an object.\n *\n * Uses `typeof` to guarantee this works cross-realm, which is where `instanceof Object` might fail.\n *\n * Some environments where these issues are known to arise:\n * - same-origin iframes (accessing the other realm via `window.top`)\n * - `jest`.\n *\n * The exact test is:\n * ```ts\n * typeof value === 'object' && value !== null || typeof value === 'function'\n * ```\n *\n * @param value - The value to test.\n * @returns `true` if the value is an object, otherwise `false`.\n * Also performs a type assertion that defaults to `value is Object | Function` which, if the input type is a union with an object type, will infer the correct type.\n * This can be overridden with the generic type argument.\n *\n * @example\n *\n * ```ts\n * class Foo {\n *   bar = 42;\n * }\n *\n * function doStuff(input?: Foo | null) {\n *   input.bar; // Object is possibly 'null' or 'undefined'\n *\n *   // input has an object type in its union (Foo) so that type will be extracted for the 'true' condition\n *   if (isObject(input)) {\n *     input.bar; // OK (input is now typed as Foo)\n *   }\n * }\n *\n * function doOtherStuff(input: unknown) {\n *   input.bar; // Object is of type 'unknown'\n *\n *   // input is 'unknown' so there is no union type to match and it will default to 'Object | Function'\n *   if (isObject(input)) {\n *     input.bar; // Property 'bar' does not exist on type 'Object | Function'\n *   }\n *\n *   // if we know for sure that, if input is an object, it must be a specific type, we can explicitly tell the function to assert that for us\n *   if (isObject<Foo>(input)) {\n *    input.bar; // OK (input is now typed as Foo)\n *   }\n * }\n * ```\n */\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport function isObject(value) {\n    return typeof value === 'object' && value !== null || typeof value === 'function';\n}\n/**\n * Determine whether a value is `null` or `undefined`.\n *\n * @param value - The value to test.\n * @returns `true` if the value is `null` or `undefined`, otherwise `false`.\n * Also performs a type assertion that ensures TypeScript treats the value appropriately in the `if` and `else` branches after this check.\n */\nexport function isNullOrUndefined(value) {\n    return value === null || value === void 0;\n}\n/**\n * Determine whether the value is a native function.\n *\n * @param fn - The function to check.\n * @returns `true` is the function is a native function, otherwise `false`\n */\nexport const isNativeFunction = (function () {\n    // eslint-disable-next-line @typescript-eslint/ban-types\n    const lookup = new WeakMap();\n    let isNative = false;\n    let sourceText = '';\n    let i = 0;\n    // eslint-disable-next-line @typescript-eslint/ban-types\n    return function (fn) {\n        isNative = lookup.get(fn);\n        if (isNative === void 0) {\n            sourceText = fn.toString();\n            i = sourceText.length;\n            // http://www.ecma-international.org/ecma-262/#prod-NativeFunction\n            isNative = (\n            // 29 is the length of 'function () { [native code] }' which is the smallest length of a native function string\n            i >= 29 &&\n                // 100 seems to be a safe upper bound of the max length of a native function. In Chrome and FF it's 56, in Edge it's 61.\n                i <= 100 &&\n                // This whole heuristic *could* be tricked by a comment. Do we need to care about that?\n                sourceText.charCodeAt(i - 1) === 0x7D && // }\n                // TODO: the spec is a little vague about the precise constraints, so we do need to test this across various browsers to make sure just one whitespace is a safe assumption.\n                sourceText.charCodeAt(i - 2) <= 0x20 && // whitespace\n                sourceText.charCodeAt(i - 3) === 0x5D && // ]\n                sourceText.charCodeAt(i - 4) === 0x65 && // e\n                sourceText.charCodeAt(i - 5) === 0x64 && // d\n                sourceText.charCodeAt(i - 6) === 0x6F && // o\n                sourceText.charCodeAt(i - 7) === 0x63 && // c\n                sourceText.charCodeAt(i - 8) === 0x20 && //\n                sourceText.charCodeAt(i - 9) === 0x65 && // e\n                sourceText.charCodeAt(i - 10) === 0x76 && // v\n                sourceText.charCodeAt(i - 11) === 0x69 && // i\n                sourceText.charCodeAt(i - 12) === 0x74 && // t\n                sourceText.charCodeAt(i - 13) === 0x61 && // a\n                sourceText.charCodeAt(i - 14) === 0x6E && // n\n                sourceText.charCodeAt(i - 15) === 0x58 // [\n            );\n            lookup.set(fn, isNative);\n        }\n        return isNative;\n    };\n})();\n//# sourceMappingURL=functions.js.map","import { isObject, isNullOrUndefined } from './functions';\n/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable @typescript-eslint/ban-types */\nconst metadataInternalSlot = new WeakMap();\nfunction $typeError(operation, args, paramName, actualValue, expectedType) {\n    return new TypeError(`${operation}(${args.map(String).join(',')}) - Expected '${paramName}' to be of type ${expectedType}, but got: ${Object.prototype.toString.call(actualValue)} (${String(actualValue)})`);\n}\nfunction toPropertyKeyOrUndefined(propertyKey) {\n    switch (typeof propertyKey) {\n        case 'undefined':\n        case 'string':\n        case 'symbol':\n            return propertyKey;\n        default:\n            return `${propertyKey}`;\n    }\n}\nfunction toPropertyKey(propertyKey) {\n    switch (typeof propertyKey) {\n        case 'string':\n        case 'symbol':\n            return propertyKey;\n        default:\n            return `${propertyKey}`;\n    }\n}\nfunction ensurePropertyKeyOrUndefined(propertyKey) {\n    switch (typeof propertyKey) {\n        case 'undefined':\n        case 'string':\n        case 'symbol':\n            return propertyKey;\n        default:\n            throw new TypeError(`Invalid metadata propertyKey: ${propertyKey}.`);\n    }\n}\nfunction GetOrCreateMetadataMap(O, P, Create) {\n    // 1. Assert: P is undefined or IsPropertyKey(P) is true.\n    // 2. Let targetMetadata be the value of O's [[Metadata]] internal slot.\n    let targetMetadata = metadataInternalSlot.get(O);\n    // 3. If targetMetadata is undefined, then\n    if (targetMetadata === void 0) {\n        // 3. a. If Create is false, return undefined.\n        if (!Create) {\n            return void 0;\n        }\n        // 3. b. Set targetMetadata to be a newly created Map object.\n        targetMetadata = new Map();\n        // 3. c. Set the [[Metadata]] internal slot of O to targetMetadata.\n        metadataInternalSlot.set(O, targetMetadata);\n    }\n    // 4. Let metadataMap be ? Invoke(targetMetadata, \"get\", P).\n    let metadataMap = targetMetadata.get(P);\n    // 5. If metadataMap is undefined, then\n    if (metadataMap === void 0) {\n        // 5. a. If Create is false, return undefined.\n        if (!Create) {\n            return void 0;\n        }\n        // 5. b. Set metadataMap to be a newly created Map object.\n        metadataMap = new Map();\n        // 5. c. Perform ? Invoke(targetMetadata, \"set\", P, metadataMap).\n        targetMetadata.set(P, metadataMap);\n    }\n    // 6. Return metadataMap.\n    return metadataMap;\n}\n// 3.1.2.1 OrdinaryHasOwnMetadata(MetadataKey, O, P)\n// https://rbuckton.github.io/reflect-metadata/#ordinaryhasownmetadata\nfunction OrdinaryHasOwnMetadata(MetadataKey, O, P) {\n    // 1. Assert: P is undefined or IsPropertyKey(P) is true.\n    // 2. Let metadataMap be ? GetOrCreateMetadataMap(O, P, false).\n    const metadataMap = GetOrCreateMetadataMap(O, P, /* Create */ false);\n    // 3. If metadataMap is undefined, return false.\n    if (metadataMap === void 0) {\n        return false;\n    }\n    // 4. Return ? ToBoolean(? Invoke(metadataMap, \"has\", MetadataKey)).\n    return metadataMap.has(MetadataKey);\n}\n// 3.1.1.1 OrdinaryHasMetadata(MetadataKey, O, P)\n// https://rbuckton.github.io/reflect-metadata/#ordinaryhasmetadata\nfunction OrdinaryHasMetadata(MetadataKey, O, P) {\n    // 1. Assert: P is undefined or IsPropertyKey(P) is true.\n    // 2. Let hasOwn be ? OrdinaryHasOwnMetadata(MetadataKey, O, P).\n    // 3. If hasOwn is true, return true.\n    if (OrdinaryHasOwnMetadata(MetadataKey, O, P)) {\n        return true;\n    }\n    // 4. Let parent be ? O.[[GetPrototypeOf]]().\n    const parent = Object.getPrototypeOf(O);\n    // 5. If parent is not null, Return ? parent.[[HasMetadata]](MetadataKey, P).\n    if (parent !== null) {\n        return OrdinaryHasMetadata(MetadataKey, parent, P);\n    }\n    // 6. Return false.\n    return false;\n}\n// 3.1.4.1 OrdinaryGetOwnMetadata(MetadataKey, O, P)\n// https://rbuckton.github.io/reflect-metadata/#ordinarygetownmetadata\nfunction OrdinaryGetOwnMetadata(MetadataKey, O, P) {\n    // 1. Assert: P is undefined or IsPropertyKey(P) is true.\n    // 2. Let metadataMap be ? GetOrCreateMetadataMap(O, P, false).\n    const metadataMap = GetOrCreateMetadataMap(O, P, /* Create */ false);\n    // 3. If metadataMap is undefined, return undefined.\n    if (metadataMap === void 0) {\n        return void 0;\n    }\n    // 4. Return ? Invoke(metadataMap, \"get\", MetadataKey).\n    return metadataMap.get(MetadataKey);\n}\n// 3.1.3.1 OrdinaryGetMetadata(MetadataKey, O, P)\n// https://rbuckton.github.io/reflect-metadata/#ordinarygetmetadata\nfunction OrdinaryGetMetadata(MetadataKey, O, P) {\n    // 1. Assert: P is undefined or IsPropertyKey(P) is true.\n    // 2. Let hasOwn be ? OrdinaryHasOwnMetadata(MetadataKey, O, P).\n    // 3. If hasOwn is true, return ? OrdinaryGetOwnMetadata(MetadataKey, O, P).\n    if (OrdinaryHasOwnMetadata(MetadataKey, O, P)) {\n        return OrdinaryGetOwnMetadata(MetadataKey, O, P);\n    }\n    // 4. Let parent be ? O.[[GetPrototypeOf]]().\n    const parent = Object.getPrototypeOf(O);\n    // 5. If parent is not null, return ? parent.[[GetMetadata]](MetadataKey, P).\n    if (parent !== null) {\n        return OrdinaryGetMetadata(MetadataKey, parent, P);\n    }\n    // 6. Return undefined.\n    return void 0;\n}\n// 3.1.5.1 OrdinaryDefineOwnMetadata(MetadataKey, MetadataValue, O, P)\n// https://rbuckton.github.io/reflect-metadata/#ordinarydefineownmetadata\nfunction OrdinaryDefineOwnMetadata(MetadataKey, MetadataValue, O, P) {\n    // 1. Assert: P is undefined or IsPropertyKey(P) is true.\n    // 2. Let metadataMap be ? GetOrCreateMetadataMap(O, P, true).\n    const metadataMap = GetOrCreateMetadataMap(O, P, /* Create */ true);\n    // 3. Return ? Invoke(metadataMap, \"set\", MetadataKey, MetadataValue).\n    metadataMap.set(MetadataKey, MetadataValue);\n}\n// 3.1.7.1 OrdinaryOwnMetadataKeys(O, P)\n// https://rbuckton.github.io/reflect-metadata/#ordinaryownmetadatakeys\nfunction OrdinaryOwnMetadataKeys(O, P) {\n    // 1. Assert: P is undefined or IsPropertyKey(P) is true.\n    // 2. Let keys be ? ArrayCreate(0).\n    const keys = [];\n    // 3. Let metadataMap be ? GetOrCreateMetadataMap(O, P, false).\n    const metadataMap = GetOrCreateMetadataMap(O, P, /* Create */ false);\n    // 4. If metadataMap is undefined, return keys.\n    if (metadataMap === void 0) {\n        return keys;\n    }\n    // 5. Let keysObj be ? Invoke(metadataMap, \"keys\").\n    const keysObj = metadataMap.keys();\n    // 6. Let iterator be ? GetIterator(keysObj).\n    // 7. Let k be 0.\n    let k = 0;\n    // 8. Repeat\n    for (const key of keysObj) {\n        // 8. a. Let Pk be ! ToString(k).\n        // 8. b. Let next be ? IteratorStep(iterator).\n        // 8. c. If next is false, then\n        // 8. c. i. Let setStatus be ? Set(keys, \"length\", k, true).\n        // 8. c. ii. Assert: setStatus is true.\n        // 8. c. iii. Return keys.\n        // 8. d. Let nextValue be ? IteratorValue(next).\n        // 8. e. Let defineStatus be CreateDataPropertyOrThrow(keys, Pk, nextValue).\n        keys[k] = key;\n        // 8. f. If defineStatus is an abrupt completion, return ? IteratorClose(iterator, defineStatus).\n        // 8. g. Increase k by 1.\n        ++k;\n    }\n    return keys;\n}\n// 3.1.6.1 OrdinaryMetadataKeys(O, P)\n// https://rbuckton.github.io/reflect-metadata/#ordinarymetadatakeys\nfunction OrdinaryMetadataKeys(O, P) {\n    // 1. Assert: P is undefined or IsPropertyKey(P) is true.\n    // 2. Let ownKeys be ? OrdinaryOwnMetadataKeys(O, P).\n    const ownKeys = OrdinaryOwnMetadataKeys(O, P);\n    // 3. Let parent be ? O.[[GetPrototypeOf]]().\n    const parent = Object.getPrototypeOf(O);\n    // 4. If parent is null, then return ownKeys.\n    if (parent === null) {\n        return ownKeys;\n    }\n    // 5. Let parentKeys be ? O.[[OrdinaryMetadataKeys]](P).\n    const parentKeys = OrdinaryMetadataKeys(parent, P);\n    // 6. Let ownKeysLen = ? Get(ownKeys, \"length\").\n    const ownKeysLen = ownKeys.length;\n    // 7. If ownKeysLen is 0, return parentKeys.\n    if (ownKeysLen === 0) {\n        return parentKeys;\n    }\n    // 8. Let parentKeysLen = ? Get(parentKeys, \"length\").\n    const parentKeysLen = parentKeys.length;\n    // 9. If parentKeysLen is 0, return ownKeys.\n    if (parentKeysLen === 0) {\n        return ownKeys;\n    }\n    // 10. Let set be a newly created Set object.\n    const set = new Set();\n    // 11. Let keys be ? ArrayCreate(0).\n    const keys = [];\n    // 12. Let k be 0.\n    let k = 0;\n    // 13. For each element key of ownKeys\n    let key;\n    for (let i = 0; i < ownKeysLen; ++i) {\n        key = ownKeys[i];\n        // 13. a. Let hasKey be ? Invoke(set, \"has\", key).\n        // 13. b. If hasKey is false, then\n        if (!set.has(key)) {\n            // 13. b. i. Let Pk be ! ToString(k).\n            // 13. b. ii. Perform ? Invoke(set, \"add\", key).\n            set.add(key);\n            // 13. b. iii. Let defineStatus be CreateDataProperty(keys, Pk, key).\n            // 13. b. iv. Assert: defineStatus is true.\n            keys[k] = key;\n            // 13. b. v. Increase k by 1.\n            ++k;\n        }\n    }\n    // 14. For each element key of parentKeys\n    for (let i = 0; i < parentKeysLen; ++i) {\n        key = parentKeys[i];\n        // 14. a. Let hasKey be ? Invoke(set, \"has\", key).\n        // 14. b. If hasKey is false, then\n        if (!set.has(key)) {\n            // 14. b. i. Let Pk be ! ToString(k).\n            // 14. b. ii. Perform ? Invoke(set, \"add\", key).\n            set.add(key);\n            // 14. b. iii. Let defineStatus be CreateDataProperty(keys, Pk, key).\n            // 14. b. iv. Assert: defineStatus is true.\n            keys[k] = key;\n            // 14. b. v. Increase k by 1.\n            ++k;\n        }\n    }\n    // 15. Perform ? Set(keys, \"length\", k).\n    // 16. return keys.\n    return keys;\n}\n// 3.1.8 DeleteMetadata(MetadataKey, P)\n// https://rbuckton.github.io/reflect-metadata/#ordinary-object-internal-methods-and-internal-slots-deletemetadata\nfunction OrdinaryDeleteMetadata(O, MetadataKey, P) {\n    // 1. Assert: P is undefined or IsPropertyKey(P) is true.\n    // 2. Let metadataMap be ? GetOrCreateMetadataMap(O, P, false).\n    const metadataMap = GetOrCreateMetadataMap(O, P, false);\n    // 3. If metadataMap is undefined, return false.\n    if (metadataMap === void 0) {\n        return false;\n    }\n    // 4. Return ? Invoke(metadataMap, \"delete\", MetadataKey).\n    return metadataMap.delete(MetadataKey);\n}\n// 4.1.2 Reflect.metadata(metadataKey, metadataValue)\n// https://rbuckton.github.io/reflect-metadata/#reflect.metadata\n/**\n * A default metadata decorator factory that can be used on a class, class member, or parameter.\n *\n * @param metadataKey - The key for the metadata entry.\n * If `metadataKey` is already defined for the target and target key, the\n * metadataValue for that key will be overwritten.\n * @param metadataValue - The value for the metadata entry.\n * @returns A decorator function.\n */\nfunction metadata(metadataKey, metadataValue) {\n    function decorator(target, propertyKey) {\n        // 1. Assert: F has a [[MetadataKey]] internal slot whose value is an ECMAScript language value, or undefined.\n        // 2. Assert: F has a [[MetadataValue]] internal slot whose value is an ECMAScript language value, or undefined.\n        // 3. If Type(target) is not Object, throw a TypeError exception.\n        if (!isObject(target)) {\n            throw $typeError('@metadata', [metadataKey, metadataValue, target, propertyKey], 'target', target, 'Object or Function');\n        }\n        // 4. If key is not undefined and IsPropertyKey(key) is false, throw a TypeError exception.\n        // 5. Let metadataKey be the value of F's [[MetadataKey]] internal slot.\n        // 6. Let metadataValue be the value of F's [[MetadataValue]] internal slot.\n        // 7. Perform ? target.[[DefineMetadata]](metadataKey, metadataValue, target, key).\n        OrdinaryDefineOwnMetadata(metadataKey, metadataValue, target, ensurePropertyKeyOrUndefined(propertyKey));\n        // 8. Return undefined.\n    }\n    return decorator;\n}\nfunction decorate(decorators, target, propertyKey, attributes) {\n    if (propertyKey !== void 0) {\n        if (!Array.isArray(decorators)) {\n            throw $typeError('Metadata.decorate', [decorators, target, propertyKey, attributes], 'decorators', decorators, 'Array');\n        }\n        if (!isObject(target)) {\n            throw $typeError('Metadata.decorate', [decorators, target, propertyKey, attributes], 'target', target, 'Object or Function');\n        }\n        if (!isObject(attributes) && !isNullOrUndefined(attributes)) {\n            throw $typeError('Metadata.decorate', [decorators, target, propertyKey, attributes], 'attributes', attributes, 'Object, Function, null, or undefined');\n        }\n        if (attributes === null) {\n            attributes = void 0;\n        }\n        propertyKey = toPropertyKey(propertyKey);\n        return DecorateProperty(decorators, target, propertyKey, attributes);\n    }\n    else {\n        if (!Array.isArray(decorators)) {\n            throw $typeError('Metadata.decorate', [decorators, target, propertyKey, attributes], 'decorators', decorators, 'Array');\n        }\n        if (typeof target !== 'function') {\n            throw $typeError('Metadata.decorate', [decorators, target, propertyKey, attributes], 'target', target, 'Function');\n        }\n        return DecorateConstructor(decorators, target);\n    }\n}\nfunction DecorateConstructor(decorators, target) {\n    for (let i = decorators.length - 1; i >= 0; --i) {\n        const decorator = decorators[i];\n        const decorated = decorator(target);\n        if (!isNullOrUndefined(decorated)) {\n            if (typeof decorated !== 'function') {\n                throw $typeError('DecorateConstructor', [decorators, target], 'decorated', decorated, 'Function, null, or undefined');\n            }\n            target = decorated;\n        }\n    }\n    return target;\n}\nfunction DecorateProperty(decorators, target, propertyKey, descriptor) {\n    for (let i = decorators.length - 1; i >= 0; --i) {\n        const decorator = decorators[i];\n        const decorated = decorator(target, propertyKey, descriptor);\n        if (!isNullOrUndefined(decorated)) {\n            if (!isObject(decorated)) {\n                throw $typeError('DecorateProperty', [decorators, target, propertyKey, descriptor], 'decorated', decorated, 'Object, Function, null, or undefined');\n            }\n            descriptor = decorated;\n        }\n    }\n    return descriptor;\n}\nfunction $define(metadataKey, metadataValue, target, propertyKey) {\n    // 1. If Type(target) is not Object, throw a TypeError exception.\n    if (!isObject(target)) {\n        throw $typeError('Metadata.define', [metadataKey, metadataValue, target, propertyKey], 'target', target, 'Object or Function');\n    }\n    // 2. Return ? target.[[DefineMetadata]](metadataKey, metadataValue, propertyKey).\n    return OrdinaryDefineOwnMetadata(metadataKey, metadataValue, target, toPropertyKeyOrUndefined(propertyKey));\n}\nfunction $has(metadataKey, target, propertyKey) {\n    // 1. If Type(target) is not Object, throw a TypeError exception.\n    if (!isObject(target)) {\n        throw $typeError('Metadata.has', [metadataKey, target, propertyKey], 'target', target, 'Object or Function');\n    }\n    // 2. Return ? target.[[HasMetadata]](metadataKey, propertyKey).\n    return OrdinaryHasMetadata(metadataKey, target, toPropertyKeyOrUndefined(propertyKey));\n}\nfunction $hasOwn(metadataKey, target, propertyKey) {\n    // 1. If Type(target) is not Object, throw a TypeError exception.\n    if (!isObject(target)) {\n        throw $typeError('Metadata.hasOwn', [metadataKey, target, propertyKey], 'target', target, 'Object or Function');\n    }\n    // 2. Return ? target.[[HasOwn]](metadataKey, propertyKey).\n    return OrdinaryHasOwnMetadata(metadataKey, target, toPropertyKeyOrUndefined(propertyKey));\n}\nfunction $get(metadataKey, target, propertyKey) {\n    // 1. If Type(target) is not Object, throw a TypeError exception.\n    if (!isObject(target)) {\n        throw $typeError('Metadata.get', [metadataKey, target, propertyKey], 'target', target, 'Object or Function');\n    }\n    // 2. Return ? target.[[GetMetadata]](metadataKey, propertyKey).\n    return OrdinaryGetMetadata(metadataKey, target, toPropertyKeyOrUndefined(propertyKey));\n}\nfunction $getOwn(metadataKey, target, propertyKey) {\n    // 1. If Type(target) is not Object, throw a TypeError exception.\n    if (!isObject(target)) {\n        throw $typeError('Metadata.getOwn', [metadataKey, target, propertyKey], 'target', target, 'Object or Function');\n    }\n    // 2. Return ? target.[[GetOwnMetadata]](metadataKey, propertyKey).\n    return OrdinaryGetOwnMetadata(metadataKey, target, toPropertyKeyOrUndefined(propertyKey));\n}\nfunction $getKeys(target, propertyKey) {\n    // 1. If Type(target) is not Object, throw a TypeError exception.\n    if (!isObject(target)) {\n        throw $typeError('Metadata.getKeys', [target, propertyKey], 'target', target, 'Object or Function');\n    }\n    // 2. Return ? target.[[GetMetadataKeys]](propertyKey).\n    return OrdinaryMetadataKeys(target, toPropertyKeyOrUndefined(propertyKey));\n}\nfunction $getOwnKeys(target, propertyKey) {\n    // 1. If Type(target) is not Object, throw a TypeError exception.\n    if (!isObject(target)) {\n        throw $typeError('Metadata.getOwnKeys', [target, propertyKey], 'target', target, 'Object or Function');\n    }\n    // 2. Return ? target.[[GetOwnMetadataKeys]](propertyKey).\n    return OrdinaryOwnMetadataKeys(target, toPropertyKeyOrUndefined(propertyKey));\n}\nfunction $delete(metadataKey, target, propertyKey) {\n    // 1. If Type(target) is not Object, throw a TypeError exception.\n    if (!isObject(target)) {\n        throw $typeError('Metadata.delete', [metadataKey, target, propertyKey], 'target', target, 'Object or Function');\n    }\n    // 2. Return ? target.[[DeleteMetadata]](metadataKey, propertyKey).\n    return OrdinaryDeleteMetadata(target, metadataKey, toPropertyKeyOrUndefined(propertyKey));\n}\nconst Metadata = {\n    define: $define,\n    has: $has,\n    hasOwn: $hasOwn,\n    get: $get,\n    getOwn: $getOwn,\n    getKeys: $getKeys,\n    getOwnKeys: $getOwnKeys,\n    delete: $delete,\n};\nfunction def(obj, key, value) {\n    Reflect.defineProperty(obj, key, {\n        writable: true,\n        enumerable: false,\n        configurable: true,\n        value,\n    });\n}\ndef(Metadata, '$Internal', metadataInternalSlot);\nconst hasMetadata = 'metadata' in Reflect;\nconst hasDecorate = 'decorate' in Reflect;\nconst hasDefineMetadata = 'defineMetadata' in Reflect;\nconst hasHasMetadata = 'hasMetadata' in Reflect;\nconst hasHasOwnMetadata = 'hasOwnMetadata' in Reflect;\nconst hasGetMetadata = 'getMetadata' in Reflect;\nconst hasGetOwnMetadata = 'getOwnMetadata' in Reflect;\nconst hasGetMetadataKeys = 'getMetadataKeys' in Reflect;\nconst hasGetOwnMetadataKeys = 'getOwnMetadataKeys' in Reflect;\nconst hasDeleteMetadata = 'deleteMetadata' in Reflect;\nconst hasSome = (hasMetadata ||\n    hasDecorate ||\n    hasDefineMetadata ||\n    hasHasMetadata ||\n    hasHasOwnMetadata ||\n    hasGetMetadata ||\n    hasGetOwnMetadata ||\n    hasGetMetadataKeys ||\n    hasGetOwnMetadataKeys ||\n    hasDeleteMetadata);\nconst hasAll = (hasMetadata &&\n    hasDecorate &&\n    hasDefineMetadata &&\n    hasHasMetadata &&\n    hasHasOwnMetadata &&\n    hasGetMetadata &&\n    hasGetOwnMetadata &&\n    hasGetMetadataKeys &&\n    hasGetOwnMetadataKeys &&\n    hasDeleteMetadata);\nif (hasSome && !hasAll) {\n    // This is temporary until we have the reporter / logging component working properly.\n    // We should kind of throw here, but it's a bit harsh to completely stop Aurelia from loading for something that's not guaranteed to fail,\n    // so just log a warning instead.\n    /* eslint-disable no-console, no-undef, @typescript-eslint/ban-ts-ignore */\n    // @ts-ignore\n    console.warn('Partial existing Reflect.metadata polyfill found. Working environment cannot be guaranteed. Please file an issue at https://github.com/aurelia/aurelia/issues so that we can look into compatibility options for this scenario.');\n}\nif (!hasMetadata) {\n    def(Reflect, 'metadata', metadata);\n}\nif (!hasDecorate) {\n    def(Reflect, 'decorate', decorate);\n}\nif (!hasDefineMetadata) {\n    def(Reflect, 'defineMetadata', $define);\n}\nif (!hasHasMetadata) {\n    def(Reflect, 'hasMetadata', $has);\n}\nif (!hasHasOwnMetadata) {\n    def(Reflect, 'hasOwnMetadata', $hasOwn);\n}\nif (!hasGetMetadata) {\n    def(Reflect, 'getMetadata', $get);\n}\nif (!hasGetOwnMetadata) {\n    def(Reflect, 'getOwnMetadata', $getOwn);\n}\nif (!hasGetMetadataKeys) {\n    def(Reflect, 'getMetadataKeys', $getKeys);\n}\nif (!hasGetOwnMetadataKeys) {\n    def(Reflect, 'getOwnMetadataKeys', $getOwnKeys);\n}\nif (!hasDeleteMetadata) {\n    def(Reflect, 'deleteMetadata', $delete);\n}\nexport { Metadata, metadata };\n//# sourceMappingURL=metadata.js.map","import { Metadata } from './metadata';\nimport { PLATFORM } from './platform';\nconst annotation = {\n    name: 'au:annotation',\n    appendTo(target, key) {\n        const keys = Metadata.getOwn(annotation.name, target);\n        if (keys === void 0) {\n            Metadata.define(annotation.name, [key], target);\n        }\n        else {\n            keys.push(key);\n        }\n    },\n    set(target, prop, value) {\n        Metadata.define(annotation.keyFor(prop), value, target);\n    },\n    get(target, prop) {\n        return Metadata.getOwn(annotation.keyFor(prop), target);\n    },\n    getKeys(target) {\n        let keys = Metadata.getOwn(annotation.name, target);\n        if (keys === void 0) {\n            Metadata.define(annotation.name, keys = [], target);\n        }\n        return keys;\n    },\n    isKey(key) {\n        return key.startsWith(annotation.name);\n    },\n    keyFor(name, context) {\n        if (context === void 0) {\n            return `${annotation.name}:${name}`;\n        }\n        return `${annotation.name}:${name}:${context}`;\n    },\n};\nconst resource = {\n    name: 'au:resource',\n    appendTo(target, key) {\n        const keys = Metadata.getOwn(resource.name, target);\n        if (keys === void 0) {\n            Metadata.define(resource.name, [key], target);\n        }\n        else {\n            keys.push(key);\n        }\n    },\n    has(target) {\n        return Metadata.hasOwn(resource.name, target);\n    },\n    getAll(target) {\n        const keys = Metadata.getOwn(resource.name, target);\n        if (keys === void 0) {\n            return PLATFORM.emptyArray;\n        }\n        else {\n            return keys.map(k => Metadata.getOwn(k, target));\n        }\n    },\n    getKeys(target) {\n        let keys = Metadata.getOwn(resource.name, target);\n        if (keys === void 0) {\n            Metadata.define(resource.name, keys = [], target);\n        }\n        return keys;\n    },\n    isKey(key) {\n        return key.startsWith(resource.name);\n    },\n    keyFor(name, context) {\n        if (context === void 0) {\n            return `${resource.name}:${name}`;\n        }\n        return `${resource.name}:${name}:${context}`;\n    },\n};\nexport const Protocol = {\n    annotation,\n    resource,\n};\n// eslint-disable-next-line @typescript-eslint/unbound-method\nconst hasOwn = Object.prototype.hasOwnProperty;\n/**\n * The order in which the values are checked:\n * 1. Annotations (usually set by decorators) have the highest priority; they override the definition as well as static properties on the type.\n * 2. Definition properties (usually set by the customElement decorator object literal) come next. They override static properties on the type.\n * 3. Static properties on the type come last. Note that this does not look up the prototype chain (bindables are an exception here, but we do that differently anyway)\n * 4. The default property that is provided last. The function is only called if the default property is needed\n */\nexport function fromAnnotationOrDefinitionOrTypeOrDefault(name, def, Type, getDefault) {\n    let value = Metadata.getOwn(Protocol.annotation.keyFor(name), Type);\n    if (value === void 0) {\n        value = def[name];\n        if (value === void 0) {\n            value = Type[name];\n            // eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n            if (value === void 0 || !hasOwn.call(Type, name)) { // First just check the value (common case is faster), but do make sure it doesn't come from the proto chain\n                return getDefault();\n            }\n            return value;\n        }\n        return value;\n    }\n    return value;\n}\n/**\n * The order in which the values are checked:\n * 1. Annotations (usually set by decorators) have the highest priority; they override static properties on the type.\n * 2. Static properties on the typ. Note that this does not look up the prototype chain (bindables are an exception here, but we do that differently anyway)\n * 3. The default property that is provided last. The function is only called if the default property is needed\n */\nexport function fromAnnotationOrTypeOrDefault(name, Type, getDefault) {\n    let value = Metadata.getOwn(Protocol.annotation.keyFor(name), Type);\n    if (value === void 0) {\n        value = Type[name];\n        // eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n        if (value === void 0 || !hasOwn.call(Type, name)) { // First just check the value (common case is faster), but do make sure it doesn't come from the proto chain\n            return getDefault();\n        }\n        return value;\n    }\n    return value;\n}\n/**\n * The order in which the values are checked:\n * 1. Definition properties.\n * 2. The default property that is provided last. The function is only called if the default property is needed\n */\nexport function fromDefinitionOrDefault(name, def, getDefault) {\n    const value = def[name];\n    if (value === void 0) {\n        return getDefault();\n    }\n    return value;\n}\n//# sourceMappingURL=resource.js.map","import { PLATFORM } from './platform';\nimport { Reporter } from './reporter';\nimport { Protocol } from './resource';\nimport { Metadata } from './metadata';\nimport { isArrayIndex, isNativeFunction, isObject } from './functions';\nexport class ResolverBuilder {\n    constructor(container, key) {\n        this.container = container;\n        this.key = key;\n    }\n    instance(value) {\n        return this.registerResolver(0 /* instance */, value);\n    }\n    singleton(value) {\n        return this.registerResolver(1 /* singleton */, value);\n    }\n    transient(value) {\n        return this.registerResolver(2 /* transient */, value);\n    }\n    callback(value) {\n        return this.registerResolver(3 /* callback */, value);\n    }\n    aliasTo(destinationKey) {\n        return this.registerResolver(5 /* alias */, destinationKey);\n    }\n    registerResolver(strategy, state) {\n        const { container, key } = this;\n        this.container = this.key = (void 0);\n        return container.registerResolver(key, new Resolver(key, strategy, state));\n    }\n}\nfunction cloneArrayWithPossibleProps(source) {\n    const clone = source.slice();\n    const keys = Object.keys(source);\n    const len = keys.length;\n    let key;\n    for (let i = 0; i < len; ++i) {\n        key = keys[i];\n        if (!isArrayIndex(key)) {\n            clone[key] = source[key];\n        }\n    }\n    return clone;\n}\nexport const DI = {\n    createContainer(...params) {\n        if (params.length === 0) {\n            return new Container(null);\n        }\n        else {\n            return new Container(null).register(...params);\n        }\n    },\n    getDesignParamtypes(Type) {\n        return Metadata.getOwn('design:paramtypes', Type);\n    },\n    getAnnotationParamtypes(Type) {\n        const key = Protocol.annotation.keyFor('di:paramtypes');\n        return Metadata.getOwn(key, Type);\n    },\n    getOrCreateAnnotationParamTypes(Type) {\n        const key = Protocol.annotation.keyFor('di:paramtypes');\n        let annotationParamtypes = Metadata.getOwn(key, Type);\n        if (annotationParamtypes === void 0) {\n            Metadata.define(key, annotationParamtypes = [], Type);\n            Protocol.annotation.appendTo(Type, key);\n        }\n        return annotationParamtypes;\n    },\n    getDependencies(Type) {\n        // Note: Every detail of this getDependencies method is pretty deliberate at the moment, and probably not yet 100% tested from every possible angle,\n        // so be careful with making changes here as it can have a huge impact on complex end user apps.\n        // Preferably, only make changes to the dependency resolution process via a RFC.\n        const key = Protocol.annotation.keyFor('di:dependencies');\n        let dependencies = Metadata.getOwn(key, Type);\n        if (dependencies === void 0) {\n            // Type.length is the number of constructor parameters. If this is 0, it could mean the class has an empty constructor\n            // but it could also mean the class has no constructor at all (in which case it inherits the constructor from the prototype).\n            // Non-zero constructor length + no paramtypes means emitDecoratorMetadata is off, or the class has no decorator.\n            // We're not doing anything with the above right now, but it's good to keep in mind for any future issues.\n            const inject = Type.inject;\n            if (inject === void 0) {\n                // design:paramtypes is set by tsc when emitDecoratorMetadata is enabled.\n                const designParamtypes = DI.getDesignParamtypes(Type);\n                // au:annotation:di:paramtypes is set by the parameter decorator from DI.createInterface or by @inject\n                const annotationParamtypes = DI.getAnnotationParamtypes(Type);\n                if (designParamtypes === void 0) {\n                    if (annotationParamtypes === void 0) {\n                        // Only go up the prototype if neither static inject nor any of the paramtypes is defined, as\n                        // there is no sound way to merge a type's deps with its prototype's deps\n                        const Proto = Object.getPrototypeOf(Type);\n                        if (typeof Proto === 'function' && Proto !== Function.prototype) {\n                            dependencies = cloneArrayWithPossibleProps(DI.getDependencies(Proto));\n                        }\n                        else {\n                            dependencies = [];\n                        }\n                    }\n                    else {\n                        // No design:paramtypes so just use the au:annotation:di:paramtypes\n                        dependencies = cloneArrayWithPossibleProps(annotationParamtypes);\n                    }\n                }\n                else if (annotationParamtypes === void 0) {\n                    // No au:annotation:di:paramtypes so just use the design:paramtypes\n                    dependencies = cloneArrayWithPossibleProps(designParamtypes);\n                }\n                else {\n                    // We've got both, so merge them (in case of conflict on same index, au:annotation:di:paramtypes take precedence)\n                    dependencies = cloneArrayWithPossibleProps(designParamtypes);\n                    let len = annotationParamtypes.length;\n                    let auAnnotationParamtype;\n                    for (let i = 0; i < len; ++i) {\n                        auAnnotationParamtype = annotationParamtypes[i];\n                        if (auAnnotationParamtype !== void 0) {\n                            dependencies[i] = auAnnotationParamtype;\n                        }\n                    }\n                    const keys = Object.keys(annotationParamtypes);\n                    len = keys.length;\n                    let key;\n                    for (let i = 0; i < len; ++i) {\n                        key = keys[i];\n                        if (!isArrayIndex(key)) {\n                            dependencies[key] = annotationParamtypes[key];\n                        }\n                    }\n                }\n            }\n            else {\n                // Ignore paramtypes if we have static inject\n                dependencies = cloneArrayWithPossibleProps(inject);\n            }\n            Metadata.define(key, dependencies, Type);\n            Protocol.annotation.appendTo(Type, key);\n        }\n        return dependencies;\n    },\n    createInterface(friendlyName) {\n        const Interface = function (target, property, index) {\n            if (target == null) {\n                throw Reporter.error(16, Interface.friendlyName, Interface); // TODO: add error (trying to resolve an InterfaceSymbol that has no registrations)\n            }\n            const annotationParamtypes = DI.getOrCreateAnnotationParamTypes(target);\n            annotationParamtypes[index] = Interface;\n            return target;\n        };\n        Interface.friendlyName = friendlyName == null ? 'Interface' : friendlyName;\n        Interface.noDefault = function () {\n            return Interface;\n        };\n        Interface.withDefault = function (configure) {\n            Interface.withDefault = function () {\n                throw Reporter.error(17, Interface);\n            };\n            Interface.register = function (container, key) {\n                return configure(new ResolverBuilder(container, (key !== null && key !== void 0 ? key : Interface)));\n            };\n            return Interface;\n        };\n        return Interface;\n    },\n    inject(...dependencies) {\n        return function (target, key, descriptor) {\n            if (typeof descriptor === 'number') { // It's a parameter decorator.\n                const annotationParamtypes = DI.getOrCreateAnnotationParamTypes(target);\n                const dep = dependencies[0];\n                if (dep !== void 0) {\n                    annotationParamtypes[descriptor] = dep;\n                }\n            }\n            else if (key) { // It's a property decorator. Not supported by the container without plugins.\n                const annotationParamtypes = DI.getOrCreateAnnotationParamTypes(target.constructor);\n                const dep = dependencies[0];\n                if (dep !== void 0) {\n                    annotationParamtypes[key] = dep;\n                }\n            }\n            else if (descriptor) { // It's a function decorator (not a Class constructor)\n                const fn = descriptor.value;\n                const annotationParamtypes = DI.getOrCreateAnnotationParamTypes(fn);\n                let dep;\n                for (let i = 0; i < dependencies.length; ++i) {\n                    dep = dependencies[i];\n                    if (dep !== void 0) {\n                        annotationParamtypes[i] = dep;\n                    }\n                }\n            }\n            else { // It's a class decorator.\n                const annotationParamtypes = DI.getOrCreateAnnotationParamTypes(target);\n                let dep;\n                for (let i = 0; i < dependencies.length; ++i) {\n                    dep = dependencies[i];\n                    if (dep !== void 0) {\n                        annotationParamtypes[i] = dep;\n                    }\n                }\n            }\n        };\n    },\n    /**\n     * Registers the `target` class as a transient dependency; each time the dependency is resolved\n     * a new instance will be created.\n     *\n     * @param target - The class / constructor function to register as transient.\n     * @returns The same class, with a static `register` method that takes a container and returns the appropriate resolver.\n     *\n     * @example ```ts\n     * // On an existing class\n     * class Foo { }\n     * DI.transient(Foo);\n     *\n     * // Inline declaration\n     * const Foo = DI.transient(class { });\n     * // Foo is now strongly typed with register\n     * Foo.register(container);\n     * ```\n     */\n    transient(target) {\n        target.register = function register(container) {\n            const registration = Registration.transient(target, target);\n            return registration.register(container, target);\n        };\n        return target;\n    },\n    /**\n     * Registers the `target` class as a singleton dependency; the class will only be created once. Each\n     * consecutive time the dependency is resolved, the same instance will be returned.\n     *\n     * @param target - The class / constructor function to register as a singleton.\n     * @returns The same class, with a static `register` method that takes a container and returns the appropriate resolver.\n     * @example ```ts\n     * // On an existing class\n     * class Foo { }\n     * DI.singleton(Foo);\n     *\n     * // Inline declaration\n     * const Foo = DI.singleton(class { });\n     * // Foo is now strongly typed with register\n     * Foo.register(container);\n     * ```\n     */\n    singleton(target) {\n        target.register = function register(container) {\n            const registration = Registration.singleton(target, target);\n            return registration.register(container, target);\n        };\n        return target;\n    },\n};\nexport const IContainer = DI.createInterface('IContainer').noDefault();\nexport const IServiceLocator = IContainer;\nfunction createResolver(getter) {\n    return function (key) {\n        const resolver = function (target, property, descriptor) {\n            DI.inject(resolver)(target, property, descriptor);\n        };\n        resolver.resolve = function (handler, requestor) {\n            return getter(key, handler, requestor);\n        };\n        return resolver;\n    };\n}\nexport const inject = DI.inject;\nfunction transientDecorator(target) {\n    return DI.transient(target);\n}\nexport function transient(target) {\n    return target == null ? transientDecorator : transientDecorator(target);\n}\nfunction singletonDecorator(target) {\n    return DI.singleton(target);\n}\nexport function singleton(target) {\n    return target == null ? singletonDecorator : singletonDecorator(target);\n}\nexport const all = createResolver((key, handler, requestor) => requestor.getAll(key));\nexport const lazy = createResolver((key, handler, requestor) => {\n    let instance = null; // cache locally so that lazy always returns the same instance once resolved\n    return () => {\n        if (instance == null) {\n            instance = requestor.get(key);\n        }\n        return instance;\n    };\n});\nexport const optional = createResolver((key, handler, requestor) => {\n    if (requestor.has(key, true)) {\n        return requestor.get(key);\n    }\n    else {\n        return null;\n    }\n});\n/** @internal */\nexport var ResolverStrategy;\n(function (ResolverStrategy) {\n    ResolverStrategy[ResolverStrategy[\"instance\"] = 0] = \"instance\";\n    ResolverStrategy[ResolverStrategy[\"singleton\"] = 1] = \"singleton\";\n    ResolverStrategy[ResolverStrategy[\"transient\"] = 2] = \"transient\";\n    ResolverStrategy[ResolverStrategy[\"callback\"] = 3] = \"callback\";\n    ResolverStrategy[ResolverStrategy[\"array\"] = 4] = \"array\";\n    ResolverStrategy[ResolverStrategy[\"alias\"] = 5] = \"alias\";\n})(ResolverStrategy || (ResolverStrategy = {}));\n/** @internal */\nexport class Resolver {\n    constructor(key, strategy, state) {\n        this.key = key;\n        this.strategy = strategy;\n        this.state = state;\n    }\n    register(container, key) {\n        return container.registerResolver(key || this.key, this);\n    }\n    resolve(handler, requestor) {\n        switch (this.strategy) {\n            case 0 /* instance */:\n                return this.state;\n            case 1 /* singleton */: {\n                this.strategy = 0 /* instance */;\n                const factory = handler.getFactory(this.state);\n                if (factory === null) {\n                    throw new Error(`Resolver for ${String(this.key)} returned a null factory`);\n                }\n                return this.state = factory.construct(requestor);\n            }\n            case 2 /* transient */: {\n                // Always create transients from the requesting container\n                const factory = handler.getFactory(this.state);\n                if (factory === null) {\n                    throw new Error(`Resolver for ${String(this.key)} returned a null factory`);\n                }\n                return factory.construct(requestor);\n            }\n            case 3 /* callback */:\n                return this.state(handler, requestor, this);\n            case 4 /* array */:\n                return this.state[0].resolve(handler, requestor);\n            case 5 /* alias */:\n                return handler.get(this.state);\n            default:\n                throw Reporter.error(6, this.strategy);\n        }\n    }\n    getFactory(container) {\n        let resolver;\n        switch (this.strategy) {\n            case 1 /* singleton */:\n            case 2 /* transient */:\n                return container.getFactory(this.state);\n            case 5 /* alias */:\n                resolver = container.getResolver(this.state);\n                if (resolver == null || resolver.getFactory === void 0) {\n                    return null;\n                }\n                return resolver.getFactory(container);\n            default:\n                return null;\n        }\n    }\n}\n/** @internal */\nexport class Factory {\n    constructor(Type, invoker, dependencies) {\n        this.Type = Type;\n        this.invoker = invoker;\n        this.dependencies = dependencies;\n        this.transformers = null;\n    }\n    construct(container, dynamicDependencies) {\n        const transformers = this.transformers;\n        let instance = dynamicDependencies !== void 0\n            ? this.invoker.invokeWithDynamicDependencies(container, this.Type, this.dependencies, dynamicDependencies)\n            : this.invoker.invoke(container, this.Type, this.dependencies);\n        if (transformers == null) {\n            return instance;\n        }\n        for (let i = 0, ii = transformers.length; i < ii; ++i) {\n            instance = transformers[i](instance);\n        }\n        return instance;\n    }\n    registerTransformer(transformer) {\n        if (this.transformers == null) {\n            this.transformers = [];\n        }\n        this.transformers.push(transformer);\n        return true;\n    }\n}\nconst createFactory = (function () {\n    function invokeWithDynamicDependencies(container, Type, staticDependencies, dynamicDependencies) {\n        let i = staticDependencies.length;\n        let args = new Array(i);\n        let lookup;\n        while (i-- > 0) {\n            lookup = staticDependencies[i];\n            if (lookup == null) {\n                throw Reporter.error(7, `Index ${i}.`);\n            }\n            else {\n                args[i] = container.get(lookup);\n            }\n        }\n        if (dynamicDependencies !== void 0) {\n            args = args.concat(dynamicDependencies);\n        }\n        return Reflect.construct(Type, args);\n    }\n    const classInvokers = [\n        {\n            invoke(container, Type) {\n                return new Type();\n            },\n            invokeWithDynamicDependencies\n        },\n        {\n            invoke(container, Type, deps) {\n                return new Type(container.get(deps[0]));\n            },\n            invokeWithDynamicDependencies\n        },\n        {\n            invoke(container, Type, deps) {\n                return new Type(container.get(deps[0]), container.get(deps[1]));\n            },\n            invokeWithDynamicDependencies\n        },\n        {\n            invoke(container, Type, deps) {\n                return new Type(container.get(deps[0]), container.get(deps[1]), container.get(deps[2]));\n            },\n            invokeWithDynamicDependencies\n        },\n        {\n            invoke(container, Type, deps) {\n                return new Type(container.get(deps[0]), container.get(deps[1]), container.get(deps[2]), container.get(deps[3]));\n            },\n            invokeWithDynamicDependencies\n        },\n        {\n            invoke(container, Type, deps) {\n                return new Type(container.get(deps[0]), container.get(deps[1]), container.get(deps[2]), container.get(deps[3]), container.get(deps[4]));\n            },\n            invokeWithDynamicDependencies\n        }\n    ];\n    const fallbackInvoker = {\n        invoke: invokeWithDynamicDependencies,\n        invokeWithDynamicDependencies\n    };\n    return function (Type) {\n        if (isNativeFunction(Type)) {\n            Reporter.write(5, Type.name);\n        }\n        const dependencies = DI.getDependencies(Type);\n        const invoker = classInvokers.length > dependencies.length ? classInvokers[dependencies.length] : fallbackInvoker;\n        return new Factory(Type, invoker, dependencies);\n    };\n})();\nconst containerResolver = {\n    resolve(handler, requestor) {\n        return requestor;\n    }\n};\nfunction isRegistry(obj) {\n    return typeof obj.register === 'function';\n}\nfunction isClass(obj) {\n    return obj.prototype !== void 0;\n}\nfunction isResourceKey(key) {\n    return typeof key === 'string' && key.indexOf(':') > 0;\n}\n/** @internal */\nexport class Container {\n    constructor(parent) {\n        this.parent = parent;\n        this.registerDepth = 0;\n        if (parent === null) {\n            this.root = this;\n            this.resolvers = new Map();\n            this.resourceResolvers = Object.create(null);\n        }\n        else {\n            this.root = parent.root;\n            this.resolvers = new Map();\n            this.resourceResolvers = Object.assign(Object.create(null), this.root.resourceResolvers);\n        }\n        this.resolvers.set(IContainer, containerResolver);\n    }\n    register(...params) {\n        if (++this.registerDepth === 100) {\n            throw new Error('Unable to autoregister dependency');\n            // TODO: change to reporter.error and add various possible causes in description.\n            // Most likely cause is trying to register a plain object that does not have a\n            // register method and is not a class constructor\n        }\n        let current;\n        let keys;\n        let value;\n        let j;\n        let jj;\n        for (let i = 0, ii = params.length; i < ii; ++i) {\n            current = params[i];\n            if (!isObject(current)) {\n                continue;\n            }\n            if (isRegistry(current)) {\n                current.register(this);\n            }\n            else if (Protocol.resource.has(current)) {\n                const defs = Protocol.resource.getAll(current);\n                if (defs.length === 1) {\n                    // Fast path for the very common case\n                    defs[0].register(this);\n                }\n                else {\n                    const len = defs.length;\n                    for (let d = 0; d < len; ++d) {\n                        defs[d].register(this);\n                    }\n                }\n            }\n            else if (isClass(current)) {\n                Registration.singleton(current, current).register(this);\n            }\n            else {\n                keys = Object.keys(current);\n                j = 0;\n                jj = keys.length;\n                for (; j < jj; ++j) {\n                    value = current[keys[j]];\n                    if (!isObject(value)) {\n                        continue;\n                    }\n                    // note: we could remove this if-branch and call this.register directly\n                    // - the extra check is just a perf tweak to create fewer unnecessary arrays by the spread operator\n                    if (isRegistry(value)) {\n                        value.register(this);\n                    }\n                    else {\n                        this.register(value);\n                    }\n                }\n            }\n        }\n        --this.registerDepth;\n        return this;\n    }\n    registerResolver(key, resolver) {\n        validateKey(key);\n        const resolvers = this.resolvers;\n        const result = resolvers.get(key);\n        if (result == null) {\n            resolvers.set(key, resolver);\n            if (isResourceKey(key)) {\n                this.resourceResolvers[key] = resolver;\n            }\n        }\n        else if (result instanceof Resolver && result.strategy === 4 /* array */) {\n            result.state.push(resolver);\n        }\n        else {\n            resolvers.set(key, new Resolver(key, 4 /* array */, [result, resolver]));\n        }\n        return resolver;\n    }\n    registerTransformer(key, transformer) {\n        const resolver = this.getResolver(key);\n        if (resolver == null) {\n            return false;\n        }\n        if (resolver.getFactory) {\n            const factory = resolver.getFactory(this);\n            if (factory == null) {\n                return false;\n            }\n            // This type cast is a bit of a hacky one, necessary due to the duplicity of IResolverLike.\n            // Problem is that that interface's type arg can be of type Key, but the getFactory method only works on\n            // type Constructable. So the return type of that optional method has this additional constraint, which\n            // seems to confuse the type checker.\n            return factory.registerTransformer(transformer);\n        }\n        return false;\n    }\n    getResolver(key, autoRegister = true) {\n        validateKey(key);\n        if (key.resolve !== void 0) {\n            return key;\n        }\n        let current = this;\n        let resolver;\n        while (current != null) {\n            resolver = current.resolvers.get(key);\n            if (resolver == null) {\n                if (current.parent == null) {\n                    return autoRegister ? this.jitRegister(key, current) : null;\n                }\n                current = current.parent;\n            }\n            else {\n                return resolver;\n            }\n        }\n        return null;\n    }\n    has(key, searchAncestors = false) {\n        return this.resolvers.has(key)\n            ? true\n            : searchAncestors && this.parent != null\n                ? this.parent.has(key, true)\n                : false;\n    }\n    get(key) {\n        validateKey(key);\n        if (key.resolve !== void 0) {\n            return key.resolve(this, this);\n        }\n        let current = this;\n        let resolver;\n        while (current != null) {\n            resolver = current.resolvers.get(key);\n            if (resolver == null) {\n                if (current.parent == null) {\n                    resolver = this.jitRegister(key, current);\n                    return resolver.resolve(current, this);\n                }\n                current = current.parent;\n            }\n            else {\n                return resolver.resolve(current, this);\n            }\n        }\n        throw new Error(`Unable to resolve key: ${key}`);\n    }\n    getAll(key) {\n        validateKey(key);\n        let current = this;\n        let resolver;\n        while (current != null) {\n            resolver = current.resolvers.get(key);\n            if (resolver == null) {\n                if (this.parent == null) {\n                    return PLATFORM.emptyArray;\n                }\n                current = current.parent;\n            }\n            else {\n                return buildAllResponse(resolver, current, this);\n            }\n        }\n        return PLATFORM.emptyArray;\n    }\n    getFactory(Type) {\n        const key = Protocol.annotation.keyFor('di:factory');\n        let factory = Metadata.getOwn(key, Type);\n        if (factory === void 0) {\n            Metadata.define(key, factory = createFactory(Type), Type);\n            Protocol.annotation.appendTo(Type, key);\n        }\n        return factory;\n    }\n    createChild() {\n        return new Container(this);\n    }\n    jitRegister(keyAsValue, handler) {\n        if (typeof keyAsValue !== 'function') {\n            throw new Error(`Attempted to jitRegister something that is not a constructor: '${keyAsValue}'. Did you forget to register this resource?`);\n        }\n        if (isRegistry(keyAsValue)) {\n            const registrationResolver = keyAsValue.register(handler, keyAsValue);\n            if (!(registrationResolver instanceof Object) || registrationResolver.resolve == null) {\n                const newResolver = handler.resolvers.get(keyAsValue);\n                if (newResolver != void 0) {\n                    return newResolver;\n                }\n                throw Reporter.error(40); // did not return a valid resolver from the static register method\n            }\n            return registrationResolver;\n        }\n        else if (Protocol.resource.has(keyAsValue)) {\n            const defs = Protocol.resource.getAll(keyAsValue);\n            if (defs.length === 1) {\n                // Fast path for the very common case\n                defs[0].register(handler);\n            }\n            else {\n                const len = defs.length;\n                for (let d = 0; d < len; ++d) {\n                    defs[d].register(handler);\n                }\n            }\n            const newResolver = handler.resolvers.get(keyAsValue);\n            if (newResolver != void 0) {\n                return newResolver;\n            }\n            throw Reporter.error(40); // did not return a valid resolver from the static register method\n        }\n        else {\n            const resolver = new Resolver(keyAsValue, 1 /* singleton */, keyAsValue);\n            handler.resolvers.set(keyAsValue, resolver);\n            return resolver;\n        }\n    }\n}\n/**\n * An implementation of IRegistry that delegates registration to a\n * separately registered class. The ParameterizedRegistry facilitates the\n * passing of parameters to the final registry.\n */\nexport class ParameterizedRegistry {\n    constructor(key, params) {\n        this.key = key;\n        this.params = params;\n    }\n    register(container) {\n        if (container.has(this.key, true)) {\n            const registry = container.get(this.key);\n            registry.register(container, ...this.params);\n        }\n        else {\n            container.register(...this.params.filter(x => typeof x === 'object'));\n        }\n    }\n}\nexport const Registration = {\n    instance(key, value) {\n        return new Resolver(key, 0 /* instance */, value);\n    },\n    singleton(key, value) {\n        return new Resolver(key, 1 /* singleton */, value);\n    },\n    transient(key, value) {\n        return new Resolver(key, 2 /* transient */, value);\n    },\n    callback(key, callback) {\n        return new Resolver(key, 3 /* callback */, callback);\n    },\n    alias(originalKey, aliasKey) {\n        return new Resolver(aliasKey, 5 /* alias */, originalKey);\n    },\n    defer(key, ...params) {\n        return new ParameterizedRegistry(key, params);\n    }\n};\nexport class InstanceProvider {\n    constructor() {\n        this.instance = null;\n    }\n    prepare(instance) {\n        this.instance = instance;\n    }\n    resolve(handler, requestor) {\n        if (this.instance === undefined) { // unmet precondition: call prepare\n            throw Reporter.error(50); // TODO: organize error codes\n        }\n        return this.instance;\n    }\n    dispose() {\n        this.instance = null;\n    }\n}\n/** @internal */\nexport function validateKey(key) {\n    if (key === null || key === void 0) {\n        throw Reporter.error(5);\n    }\n}\nfunction buildAllResponse(resolver, handler, requestor) {\n    if (resolver instanceof Resolver && resolver.strategy === 4 /* array */) {\n        const state = resolver.state;\n        let i = state.length;\n        const results = new Array(i);\n        while (i--) {\n            results[i] = state[i].resolve(handler, requestor);\n        }\n        return results;\n    }\n    return [resolver.resolve(handler, requestor)];\n}\n//# sourceMappingURL=di.js.map","import { __decorate, __metadata, __param } from \"tslib\";\nimport { toLookup } from './functions';\nimport { DI, all, Registration } from './di';\n/**\n * Flags to enable/disable color usage in the logging output.\n */\nexport var ColorOptions;\n(function (ColorOptions) {\n    /**\n     * Do not use ASCII color codes in logging output.\n     */\n    ColorOptions[ColorOptions[\"noColors\"] = 0] = \"noColors\";\n    /**\n     * Use ASCII color codes in logging output. By default, timestamps and the TRC and DBG prefix are colored grey. INF white, WRN yellow, and ERR and FTL red.\n     */\n    ColorOptions[ColorOptions[\"colors\"] = 1] = \"colors\";\n})(ColorOptions || (ColorOptions = {}));\nexport const ILogConfig = DI.createInterface('ILogConfig').withDefault(x => x.instance(new LogConfig(0 /* noColors */, 3 /* warn */)));\nexport const ISink = DI.createInterface('ISink').noDefault();\nexport const ILogEventFactory = DI.createInterface('ILogEventFactory').withDefault(x => x.singleton(DefaultLogEventFactory));\nexport const ILogger = DI.createInterface('ILogger').withDefault(x => x.singleton(DefaultLogger));\n// http://en.wikipedia.org/wiki/ANSI_escape_code#graphics\nexport const format = toLookup({\n    red(str) {\n        return `\\u001b[31m${str}\\u001b[39m`;\n    },\n    green(str) {\n        return `\\u001b[32m${str}\\u001b[39m`;\n    },\n    yellow(str) {\n        return `\\u001b[33m${str}\\u001b[39m`;\n    },\n    blue(str) {\n        return `\\u001b[34m${str}\\u001b[39m`;\n    },\n    magenta(str) {\n        return `\\u001b[35m${str}\\u001b[39m`;\n    },\n    cyan(str) {\n        return `\\u001b[36m${str}\\u001b[39m`;\n    },\n    white(str) {\n        return `\\u001b[37m${str}\\u001b[39m`;\n    },\n    grey(str) {\n        return `\\u001b[90m${str}\\u001b[39m`;\n    },\n});\nexport class LogConfig {\n    constructor(colorOptions, level) {\n        this.colorOptions = colorOptions;\n        this.level = level;\n    }\n}\nconst getLogLevelString = (function () {\n    const logLevelString = [\n        toLookup({\n            TRC: 'TRC',\n            DBG: 'DBG',\n            INF: 'INF',\n            WRN: 'WRN',\n            ERR: 'ERR',\n            FTL: 'FTL',\n            QQQ: '???',\n        }),\n        toLookup({\n            TRC: format.grey('TRC'),\n            DBG: format.grey('DBG'),\n            INF: format.white('INF'),\n            WRN: format.yellow('WRN'),\n            ERR: format.red('ERR'),\n            FTL: format.red('FTL'),\n            QQQ: format.grey('???'),\n        }),\n    ];\n    return function (level, colorOptions) {\n        if (level <= 0 /* trace */) {\n            return logLevelString[colorOptions].TRC;\n        }\n        if (level <= 1 /* debug */) {\n            return logLevelString[colorOptions].DBG;\n        }\n        if (level <= 2 /* info */) {\n            return logLevelString[colorOptions].INF;\n        }\n        if (level <= 3 /* warn */) {\n            return logLevelString[colorOptions].WRN;\n        }\n        if (level <= 4 /* error */) {\n            return logLevelString[colorOptions].ERR;\n        }\n        if (level <= 5 /* fatal */) {\n            return logLevelString[colorOptions].FTL;\n        }\n        return logLevelString[colorOptions].QQQ;\n    };\n})();\nfunction getScopeString(scope, colorOptions) {\n    if (colorOptions === 0 /* noColors */) {\n        return scope.join('.');\n    }\n    // eslint-disable-next-line @typescript-eslint/unbound-method\n    return scope.map(format.cyan).join('.');\n}\nfunction getIsoString(timestamp, colorOptions) {\n    if (colorOptions === 0 /* noColors */) {\n        return new Date(timestamp).toISOString();\n    }\n    return format.grey(new Date(timestamp).toISOString());\n}\nexport class DefaultLogEvent {\n    constructor(severity, message, optionalParams, scope, colorOptions, timestamp) {\n        this.severity = severity;\n        this.message = message;\n        this.optionalParams = optionalParams;\n        this.scope = scope;\n        this.colorOptions = colorOptions;\n        this.timestamp = timestamp;\n    }\n    toString() {\n        const { severity, message, scope, colorOptions, timestamp } = this;\n        if (scope.length === 0) {\n            return `${getIsoString(timestamp, colorOptions)} [${getLogLevelString(severity, colorOptions)}] ${message}`;\n        }\n        return `${getIsoString(timestamp, colorOptions)} [${getLogLevelString(severity, colorOptions)} ${getScopeString(scope, colorOptions)}] ${message}`;\n    }\n}\nlet DefaultLogEventFactory = class DefaultLogEventFactory {\n    constructor(config) {\n        this.config = config;\n    }\n    createLogEvent(logger, level, message, optionalParams) {\n        return new DefaultLogEvent(level, message, optionalParams, logger.scope, this.config.colorOptions, Date.now());\n    }\n};\nDefaultLogEventFactory = __decorate([\n    __param(0, ILogConfig),\n    __metadata(\"design:paramtypes\", [Object])\n], DefaultLogEventFactory);\nexport { DefaultLogEventFactory };\nexport class ConsoleSink {\n    constructor($console) {\n        this.emit = function emit(event) {\n            const optionalParams = event.optionalParams;\n            if (optionalParams === void 0 || optionalParams.length === 0) {\n                switch (event.severity) {\n                    case 0 /* trace */:\n                    case 1 /* debug */:\n                        return $console.debug(event.toString());\n                    case 2 /* info */:\n                        return $console.info(event.toString());\n                    case 3 /* warn */:\n                        return $console.warn(event.toString());\n                    case 4 /* error */:\n                    case 5 /* fatal */:\n                        return $console.error(event.toString());\n                }\n            }\n            else {\n                switch (event.severity) {\n                    case 0 /* trace */:\n                    case 1 /* debug */:\n                        return $console.debug(event.toString(), ...optionalParams);\n                    case 2 /* info */:\n                        return $console.info(event.toString(), ...optionalParams);\n                    case 3 /* warn */:\n                        return $console.warn(event.toString(), ...optionalParams);\n                    case 4 /* error */:\n                    case 5 /* fatal */:\n                        return $console.error(event.toString(), ...optionalParams);\n                }\n            }\n        };\n    }\n}\nlet DefaultLogger = class DefaultLogger {\n    constructor(config, factory, sinks, scope = [], parent = null) {\n        this.config = config;\n        this.factory = factory;\n        this.sinks = sinks;\n        this.scope = scope;\n        this.scopedLoggers = Object.create(null);\n        if (parent === null) {\n            this.root = this;\n            this.parent = this;\n        }\n        else {\n            this.root = parent.root;\n            this.parent = parent;\n        }\n        const sinksLen = sinks.length;\n        let i = 0;\n        const emit = (level, msgOrGetMsg, optionalParams) => {\n            const message = typeof msgOrGetMsg === 'function' ? msgOrGetMsg() : msgOrGetMsg;\n            const event = factory.createLogEvent(this, level, message, optionalParams);\n            for (i = 0; i < sinksLen; ++i) {\n                sinks[i].emit(event);\n            }\n        };\n        this.trace = function trace(messageOrGetMessage, ...optionalParams) {\n            if (config.level <= 0 /* trace */) {\n                emit(0 /* trace */, messageOrGetMessage, optionalParams);\n            }\n        };\n        this.debug = function debug(messageOrGetMessage, ...optionalParams) {\n            if (config.level <= 1 /* debug */) {\n                emit(1 /* debug */, messageOrGetMessage, optionalParams);\n            }\n        };\n        this.info = function info(messageOrGetMessage, ...optionalParams) {\n            if (config.level <= 2 /* info */) {\n                emit(2 /* info */, messageOrGetMessage, optionalParams);\n            }\n        };\n        this.warn = function warn(messageOrGetMessage, ...optionalParams) {\n            if (config.level <= 3 /* warn */) {\n                emit(3 /* warn */, messageOrGetMessage, optionalParams);\n            }\n        };\n        this.error = function error(messageOrGetMessage, ...optionalParams) {\n            if (config.level <= 4 /* error */) {\n                emit(4 /* error */, messageOrGetMessage, optionalParams);\n            }\n        };\n        this.fatal = function fatal(messageOrGetMessage, ...optionalParams) {\n            if (config.level <= 5 /* fatal */) {\n                emit(5 /* fatal */, messageOrGetMessage, optionalParams);\n            }\n        };\n    }\n    scopeTo(name) {\n        const scopedLoggers = this.scopedLoggers;\n        let scopedLogger = scopedLoggers[name];\n        if (scopedLogger === void 0) {\n            scopedLogger = scopedLoggers[name] = new DefaultLogger(this.config, this.factory, this.sinks, this.scope.concat(name), this);\n        }\n        return scopedLogger;\n    }\n};\nDefaultLogger = __decorate([\n    __param(0, ILogConfig),\n    __param(1, ILogEventFactory),\n    __param(2, all(ISink)),\n    __metadata(\"design:paramtypes\", [Object, Object, Array, Array, Object])\n], DefaultLogger);\nexport { DefaultLogger };\n/**\n * A basic `ILogger` configuration that configures a single `console` sink based on provided options.\n *\n * NOTE: You *must* register the return value of `.create` with the container / au instance, not this `LoggerConfiguration` object itself.\n *\n * ```ts\n * // GOOD\n * container.register(LoggerConfiguration.create(console))\n * // GOOD\n * container.register(LoggerConfiguration.create(console, LogLevel.debug))\n * // GOOD\n * container.register(LoggerConfiguration.create({\n *   debug: PLATFORM.noop,\n *   info: PLATFORM.noop,\n *   warn: PLATFORM.noop,\n *   error: msg => {\n *     throw new Error(msg);\n *   }\n * }, LogLevel.debug))\n *\n * // BAD\n * container.register(LoggerConfiguration)\n * ```\n */\nexport const LoggerConfiguration = toLookup({\n    /**\n     * @param $console - The `console` object to use. Can be the native `window.console` / `global.console`, but can also be a wrapper or mock that implements the same interface.\n     * @param level - The global `LogLevel` to configure. Defaults to `warn` or higher.\n     * @param colorOptions - Whether to use colors or not. Defaults to `noColors`. Colors are especially nice in nodejs environments but don't necessarily work (well) in all environments, such as browsers.\n     */\n    create($console, level = 3 /* warn */, colorOptions = 0 /* noColors */) {\n        return toLookup({\n            register(container) {\n                return container.register(Registration.instance(ILogConfig, new LogConfig(colorOptions, level)), Registration.instance(ISink, new ConsoleSink($console)));\n            },\n        });\n    },\n});\n//# sourceMappingURL=logger.js.map","function trimDots(ary) {\n    const len = ary.length;\n    let i = 0;\n    let part;\n    for (; i < len; ++i) {\n        part = ary[i];\n        if (part === '.') {\n            ary.splice(i, 1);\n            i -= 1;\n        }\n        else if (part === '..') {\n            // If at the start, or previous value is still ..,\n            // keep them so that when converted to a path it may\n            // still work when converted to a path, even though\n            // as an ID it is less than ideal. In larger point\n            // releases, may be better to just kick out an error.\n            if (i === 0 || (i === 1 && ary[2] === '..') || ary[i - 1] === '..') {\n                continue;\n            }\n            if (i > 0) {\n                ary.splice(i - 1, 2);\n                i -= 2;\n            }\n        }\n    }\n}\n/**\n * Calculates a path relative to a file.\n *\n * @param name - The relative path.\n * @param file - The file path.\n * @returns The calculated path.\n */\nexport function relativeToFile(name, file) {\n    const fileParts = !file ? file : file.split('/');\n    const nameParts = name.trim().split('/');\n    if (nameParts[0].startsWith('.') && fileParts) {\n        // Convert file to array, and lop off the last part,\n        // so that . matches that 'directory' and not name of the file's\n        // module. For instance, file of 'one/two/three', maps to\n        // 'one/two/three.js', but we want the directory, 'one/two' for\n        // this normalization.\n        const normalizedBaseParts = fileParts.slice(0, fileParts.length - 1);\n        nameParts.unshift(...normalizedBaseParts);\n    }\n    trimDots(nameParts);\n    return nameParts.join('/');\n}\n/**\n * Joins two paths.\n *\n * @param path1 - The first path.\n * @param path2 - The second path.\n * @returns The joined path.\n */\nexport function join(path1, path2) {\n    if (!path1) {\n        return path2;\n    }\n    if (!path2) {\n        return path1;\n    }\n    const schemeMatch = /^([^/]*?:)\\//.exec(path1);\n    const scheme = (schemeMatch && schemeMatch.length > 0) ? schemeMatch[1] : '';\n    path1 = path1.slice(scheme.length);\n    let urlPrefix;\n    if (path1.startsWith('///') && scheme === 'file:') {\n        urlPrefix = '///';\n    }\n    else if (path1.startsWith('//')) {\n        urlPrefix = '//';\n    }\n    else if (path1.startsWith('/')) {\n        urlPrefix = '/';\n    }\n    else {\n        urlPrefix = '';\n    }\n    const trailingSlash = path2.endsWith('/') ? '/' : '';\n    const url1 = path1.split('/');\n    const url2 = path2.split('/');\n    const url3 = [];\n    for (let i = 0, ii = url1.length; i < ii; ++i) {\n        if (url1[i] === '..') {\n            url3.pop();\n        }\n        else if (url1[i] !== '.' && url1[i] !== '') {\n            url3.push(url1[i]);\n        }\n    }\n    for (let i = 0, ii = url2.length; i < ii; ++i) {\n        if (url2[i] === '..') {\n            url3.pop();\n        }\n        else if (url2[i] !== '.' && url2[i] !== '') {\n            url3.push(url2[i]);\n        }\n    }\n    return scheme + urlPrefix + url3.join('/') + trailingSlash;\n}\nconst encode = encodeURIComponent;\nconst encodeKey = (k) => encode(k).replace('%24', '$');\n/**\n * Recursively builds part of query string for parameter.\n *\n * @param key - Parameter name for query string.\n * @param value - Parameter value to deserialize.\n * @param traditional - Boolean Use the old URI template standard (RFC6570)\n * @returns Array with serialized parameter(s)\n */\nfunction buildParam(key, value, traditional) {\n    let result = [];\n    if (value == null) {\n        return result;\n    }\n    if (Array.isArray(value)) {\n        for (let i = 0, l = value.length; i < l; i++) {\n            if (traditional) {\n                result.push(`${encodeKey(key)}=${encode(value[i])}`);\n            }\n            else {\n                const arrayKey = `${key}[${(typeof value[i] === 'object' && value[i] != null ? i : '')}]`;\n                result = result.concat(buildParam(arrayKey, value[i]));\n            }\n        }\n    }\n    else if (typeof value === 'object' && !traditional) {\n        for (const propertyName in value) {\n            result = result.concat(buildParam(`${key}[${propertyName}]`, value[propertyName]));\n        }\n    }\n    else {\n        result.push(`${encodeKey(key)}=${encode(value)}`);\n    }\n    return result;\n}\n/**\n * Generate a query string from an object.\n *\n * @param params - Object containing the keys and values to be used.\n * @param traditional - Boolean Use the old URI template standard (RFC6570)\n * @returns The generated query string, excluding leading '?'.\n */\nexport function buildQueryString(params, traditional) {\n    if (params == null) {\n        return '';\n    }\n    const pairs = [];\n    const keys = Object.keys(params).sort();\n    let key;\n    for (let i = 0, len = keys.length; i < len; ++i) {\n        key = keys[i];\n        pairs.push(...buildParam(key, params[key], traditional));\n    }\n    if (pairs.length === 0) {\n        return '';\n    }\n    return pairs.join('&');\n}\n/**\n * Process parameter that was recognized as scalar param (primitive value or shallow array).\n *\n * @param existedParam - Object with previously parsed values for specified key.\n * @param value - Parameter value to append.\n * @returns Initial primitive value or transformed existedParam if parameter was recognized as an array.\n */\nfunction processScalarParam(existedParam, value) {\n    if (Array.isArray(existedParam)) {\n        // value is already an array, so push on the next value.\n        existedParam.push(value);\n        return existedParam;\n    }\n    if (existedParam !== undefined) {\n        // value isn't an array, but since a second value has been specified,\n        // convert value into an array.\n        return [existedParam, value];\n    }\n    // value is a scalar.\n    return value;\n}\n/**\n * Sequentially process parameter that was recognized as complex value (object or array).\n * For each keys part, if the current level is undefined create an\n * object or array based on the type of the next keys part.\n *\n * @param queryParams - root-level result object.\n * @param keys - Collection of keys related to this parameter.\n * @param value - Parameter value to append.\n */\nfunction parseComplexParam(queryParams, keys, value) {\n    let currentParams = queryParams;\n    const keysLastIndex = keys.length - 1;\n    let key;\n    let prevValue;\n    for (let j = 0; j <= keysLastIndex; ++j) {\n        key = (keys[j] === '' ? currentParams.length : keys[j]);\n        if (j < keysLastIndex) {\n            // The value has to be an array or a false value\n            // It can happen that the value is no array if the key was repeated with traditional style like `list=1&list[]=2`\n            if (!currentParams[key] || typeof currentParams[key] === 'object') {\n                prevValue = currentParams[key];\n            }\n            else {\n                prevValue = [currentParams[key]];\n            }\n            if (prevValue) {\n                currentParams = currentParams[key] = prevValue;\n            }\n            else if (isNaN(keys[j + 1])) {\n                // Kinda have no choice here\n                // eslint-disable-next-line @typescript-eslint/consistent-type-assertions\n                currentParams = currentParams[key] = {};\n            }\n            else {\n                currentParams = currentParams[key] = [];\n            }\n        }\n        else {\n            currentParams = currentParams[key] = value;\n        }\n    }\n}\n/**\n * Parse a query string into a queryParams object.\n *\n * @param queryString - The query string to parse.\n * @returns Object with keys and values mapped from the query string.\n */\nexport function parseQueryString(queryString) {\n    const queryParams = {};\n    if (!queryString || typeof queryString !== 'string') {\n        return queryParams;\n    }\n    let query = queryString;\n    if (query.startsWith('?')) {\n        query = query.slice(1);\n    }\n    const pairs = query.replace(/\\+/g, ' ').split('&');\n    for (let i = 0; i < pairs.length; i++) {\n        const pair = pairs[i].split('=');\n        const key = decodeURIComponent(pair[0]);\n        if (!key) {\n            continue;\n        }\n        // split object key into its parts\n        let keys = key.split('][');\n        let keysLastIndex = keys.length - 1;\n        // If the first keys part contains [ and the last ends with ], then []\n        // are correctly balanced, split key to parts\n        // Else it's basic key\n        if (keys[0].includes(\"[\") && keys[keysLastIndex].endsWith(\"]\")) {\n            keys[keysLastIndex] = keys[keysLastIndex].replace(/\\]$/, '');\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            keys = keys.shift().split('[').concat(keys); // outer condition already ensures not-null\n            keysLastIndex = keys.length - 1;\n        }\n        else {\n            keysLastIndex = 0;\n        }\n        if (pair.length >= 2) {\n            const value = pair[1] ? decodeURIComponent(pair[1]) : '';\n            if (keysLastIndex) {\n                parseComplexParam(queryParams, keys, value);\n            }\n            else {\n                queryParams[key] = processScalarParam(queryParams[key], value);\n            }\n        }\n        else {\n            queryParams[key] = true;\n        }\n    }\n    return queryParams;\n}\n//# sourceMappingURL=path.js.map","import { PLATFORM } from './platform';\nexport const Profiler = (function () {\n    const now = PLATFORM.now;\n    const timers = [];\n    let profileMap;\n    const profiler = {\n        createTimer,\n        enable,\n        disable,\n        report,\n        enabled: false\n    };\n    return profiler;\n    function createTimer(name) {\n        timers.push(name);\n        let depth = 0;\n        let mark = 0;\n        return {\n            enter,\n            leave\n        };\n        function enter() {\n            if (++depth === 1) {\n                mark = now();\n                ++profileMap[name].topLevelCount;\n            }\n            ++profileMap[name].totalCount;\n        }\n        function leave() {\n            if (--depth === 0) {\n                profileMap[name].duration += (now() - mark);\n            }\n        }\n    }\n    function enable() {\n        profileMap = {};\n        for (const timer of timers) {\n            profileMap[timer] = {\n                name: timer,\n                duration: 0,\n                topLevelCount: 0,\n                totalCount: 0\n            };\n        }\n        profiler.enabled = true;\n    }\n    function disable() {\n        profiler.enabled = false;\n    }\n    function report(cb) {\n        Object.keys(profileMap).map(key => profileMap[key]).sort((a, b) => b.duration - a.duration).forEach(p => {\n            cb(p.name, p.duration, p.topLevelCount, p.totalCount);\n        });\n    }\n})();\n//# sourceMappingURL=profiler.js.map","import { DI } from './di';\nimport { Reporter } from './reporter';\n/**\n * Represents a handler for an EventAggregator event.\n */\nclass Handler {\n    constructor(\n    /** @internal */\n    messageType, \n    /** @internal */\n    callback) {\n        this.messageType = messageType;\n        this.callback = callback;\n    }\n    handle(message) {\n        if (message instanceof this.messageType) {\n            this.callback.call(null, message);\n        }\n    }\n}\nfunction invokeCallback(callback, data, event) {\n    try {\n        callback(data, event);\n    }\n    catch (e) {\n        Reporter.error(0, e); // TODO: create error code\n    }\n}\nfunction invokeHandler(handler, data) {\n    try {\n        handler.handle(data);\n    }\n    catch (e) {\n        Reporter.error(0, e); // TODO: create error code\n    }\n}\nexport const IEventAggregator = DI.createInterface('IEventAggregator').withDefault(x => x.singleton(EventAggregator));\n/**\n * Enables loosely coupled publish/subscribe messaging.\n */\nexport class EventAggregator {\n    constructor() {\n        /** @internal */\n        this.eventLookup = {};\n        /** @internal */\n        this.messageHandlers = [];\n    }\n    publish(channelOrInstance, data) {\n        let subscribers;\n        let i;\n        if (!channelOrInstance) {\n            throw Reporter.error(0); // TODO: create error code for 'Event was invalid.'\n        }\n        if (typeof channelOrInstance === 'string') {\n            const channel = channelOrInstance;\n            subscribers = this.eventLookup[channel];\n            if (subscribers != null) {\n                subscribers = subscribers.slice();\n                i = subscribers.length;\n                while (i--) {\n                    invokeCallback(subscribers[i], data, channel);\n                }\n            }\n        }\n        else {\n            const instance = channelOrInstance;\n            subscribers = this.messageHandlers.slice();\n            i = subscribers.length;\n            while (i--) {\n                invokeHandler(subscribers[i], instance);\n            }\n        }\n    }\n    subscribe(channelOrType, callback) {\n        let handler;\n        let subscribers;\n        if (!channelOrType) {\n            throw Reporter.error(0); // TODO: create error code for 'Event channel/type was invalid.'\n        }\n        if (typeof channelOrType === 'string') {\n            const channel = channelOrType;\n            handler = callback;\n            if (this.eventLookup[channel] === void 0) {\n                this.eventLookup[channel] = [];\n            }\n            subscribers = this.eventLookup[channel];\n        }\n        else {\n            handler = new Handler(channelOrType, callback);\n            subscribers = this.messageHandlers;\n        }\n        subscribers.push(handler);\n        return {\n            dispose() {\n                const idx = subscribers.indexOf(handler);\n                if (idx !== -1) {\n                    subscribers.splice(idx, 1);\n                }\n            }\n        };\n    }\n    subscribeOnce(channelOrType, callback) {\n        const sub = this.subscribe(channelOrType, (data, event) => {\n            sub.dispose();\n            return callback(data, event);\n        });\n        return sub;\n    }\n}\n//# sourceMappingURL=eventaggregator.js.map","export { all, DI, IContainer, inject, IServiceLocator, lazy, optional, Registration, singleton, transient, InstanceProvider, } from './di';\nexport { metadata, Metadata, } from './metadata';\nexport { ColorOptions, ILogConfig, ILogEventFactory, ISink, ILogger, LogConfig, DefaultLogEvent, DefaultLogEventFactory, DefaultLogger, ConsoleSink, LoggerConfiguration, format, } from './logger';\nexport { relativeToFile, join, buildQueryString, parseQueryString } from './path';\nexport { PLATFORM } from './platform';\nexport { Reporter, Tracer, LogLevel, } from './reporter';\nexport { Profiler } from './profiler';\nexport { Protocol, fromAnnotationOrDefinitionOrTypeOrDefault, fromAnnotationOrTypeOrDefault, fromDefinitionOrDefault, } from './resource';\nexport { EventAggregator, IEventAggregator, } from './eventaggregator';\nexport { isArrayIndex, camelCase, kebabCase, pascalCase, toArray, nextId, resetId, compareNumber, mergeDistinct, isNumberOrBigInt, isStringOrDate, bound, mergeArrays, mergeObjects, firstDefined, getPrototypeChain, isObject, isNullOrUndefined, isNativeFunction, } from './functions';\n//# sourceMappingURL=index.js.map","var ProxyObserver_1;\nimport { __decorate, __metadata } from \"tslib\";\nimport { PLATFORM } from '@aurelia/kernel';\nimport { proxySubscriberCollection, subscriberCollection } from './subscriber-collection';\nconst lookup = new WeakMap();\nlet ProxySubscriberCollection = class ProxySubscriberCollection {\n    constructor(proxy, raw, key) {\n        this.proxy = proxy;\n        this.raw = raw;\n        this.key = key;\n        this.inBatch = false;\n        this.subscribe = this.addSubscriber;\n        this.unsubscribe = this.removeSubscriber;\n        if (raw[key] instanceof Object) { // Ensure we observe array indices and newly created object properties\n            raw[key] = ProxyObserver.getOrCreate(raw[key]).proxy;\n        }\n    }\n    setValue(value, flags) {\n        const oldValue = this.raw[this.key];\n        if (oldValue !== value) {\n            this.raw[this.key] = value;\n            this.callSubscribers(value, oldValue, flags | 2 /* proxyStrategy */ | 16 /* updateTargetInstance */);\n        }\n    }\n    getValue() {\n        return this.raw[this.key];\n    }\n    flushBatch(flags) {\n        return;\n    }\n};\nProxySubscriberCollection = __decorate([\n    subscriberCollection(),\n    __metadata(\"design:paramtypes\", [Object, Object, Object])\n], ProxySubscriberCollection);\nexport { ProxySubscriberCollection };\nlet ProxyObserver = ProxyObserver_1 = class ProxyObserver {\n    constructor(obj) {\n        this.raw = obj;\n        this.proxy = new Proxy(obj, this);\n        lookup.set(obj, this.proxy);\n        this.subscribers = {};\n    }\n    static getProxyOrSelf(obj) {\n        if (obj.$raw === void 0) {\n            const proxy = lookup.get(obj);\n            if (proxy === void 0) {\n                return obj;\n            }\n            return proxy;\n        }\n        return obj;\n    }\n    static getRawIfProxy(obj) {\n        const raw = obj.$raw;\n        if (raw === void 0) {\n            return obj;\n        }\n        return raw;\n    }\n    static getOrCreate(obj, key) {\n        let proxyObserver;\n        if (obj.$raw === void 0) {\n            const proxy = lookup.get(obj);\n            if (proxy === void 0) {\n                proxyObserver = new ProxyObserver_1(obj);\n            }\n            else {\n                proxyObserver = proxy.$observer;\n            }\n        }\n        else {\n            proxyObserver = obj.$observer;\n        }\n        if (key === void 0) {\n            return proxyObserver;\n        }\n        let subscribers = proxyObserver.subscribers[key];\n        if (subscribers === void 0) {\n            const raw = this.getRawIfProxy(obj);\n            const proxy = proxyObserver.proxy;\n            subscribers = proxyObserver.subscribers[key] = new ProxySubscriberCollection(proxy, raw, key);\n        }\n        return subscribers;\n    }\n    static isProxy(obj) {\n        return obj.$raw !== void 0;\n    }\n    get(target, p, receiver) {\n        if (p === '$observer') {\n            return this;\n        }\n        if (p === '$raw') {\n            return target;\n        }\n        return target[p];\n    }\n    set(target, p, value, receiver) {\n        const oldValue = target[p];\n        if (oldValue !== value) {\n            target[p] = value;\n            this.callPropertySubscribers(value, oldValue, p);\n            this.callProxySubscribers(p, value, oldValue, 2 /* proxyStrategy */ | 16 /* updateTargetInstance */);\n        }\n        return true;\n    }\n    deleteProperty(target, p) {\n        const oldValue = target[p];\n        if (Reflect.deleteProperty(target, p)) {\n            if (oldValue !== void 0) {\n                this.callPropertySubscribers(undefined, oldValue, p);\n                this.callProxySubscribers(p, undefined, oldValue, 2 /* proxyStrategy */ | 16 /* updateTargetInstance */);\n            }\n            return true;\n        }\n        return false;\n    }\n    defineProperty(target, p, attributes) {\n        const oldValue = target[p];\n        if (Reflect.defineProperty(target, p, attributes)) {\n            if (attributes.value !== oldValue) {\n                this.callPropertySubscribers(attributes.value, oldValue, p);\n                this.callProxySubscribers(p, attributes.value, oldValue, 2 /* proxyStrategy */ | 16 /* updateTargetInstance */);\n            }\n            return true;\n        }\n        return false;\n    }\n    apply(target, thisArg, argArray = PLATFORM.emptyArray) {\n        // eslint-disable-next-line @typescript-eslint/ban-types\n        return Reflect.apply(target, target, argArray); // Reflect API dictates this\n    }\n    subscribe(subscriber, key) {\n        if (key === void 0) {\n            this.addProxySubscriber(subscriber);\n        }\n        else {\n            let subscribers = this.subscribers[key];\n            if (subscribers === void 0) {\n                subscribers = this.subscribers[key] = new ProxySubscriberCollection(this.proxy, this.raw, key);\n            }\n            subscribers.addSubscriber(subscriber);\n        }\n    }\n    unsubscribe(subscriber, key) {\n        if (key === void 0) {\n            this.removeProxySubscriber(subscriber);\n        }\n        else {\n            const subscribers = this.subscribers[key];\n            if (subscribers !== undefined) {\n                subscribers.removeSubscriber(subscriber);\n            }\n        }\n    }\n    callPropertySubscribers(newValue, oldValue, key) {\n        const subscribers = this.subscribers[key];\n        if (subscribers !== void 0) {\n            subscribers.callSubscribers(newValue, oldValue, 2 /* proxyStrategy */ | 16 /* updateTargetInstance */);\n        }\n    }\n};\nProxyObserver = ProxyObserver_1 = __decorate([\n    proxySubscriberCollection(),\n    __metadata(\"design:paramtypes\", [Object])\n], ProxyObserver);\nexport { ProxyObserver };\n//# sourceMappingURL=proxy-observer.js.map","// TODO: see if we can de-duplicate these 3 decorators and their functions without killing performance or readability\nexport function subscriberCollection() {\n    // eslint-disable-next-line @typescript-eslint/ban-types\n    return function (target) {\n        const proto = target.prototype;\n        proto._subscriberFlags = 0 /* None */;\n        proto.addSubscriber = addSubscriber;\n        proto.removeSubscriber = removeSubscriber;\n        proto.hasSubscriber = hasSubscriber;\n        proto.hasSubscribers = hasSubscribers;\n        proto.callSubscribers = callSubscribers;\n        if (proto.subscribe === void 0)\n            proto.subscribe = addSubscriber;\n        if (proto.unsubscribe === void 0)\n            proto.unsubscribe = removeSubscriber;\n    };\n}\nexport function proxySubscriberCollection() {\n    // eslint-disable-next-line @typescript-eslint/ban-types\n    return function (target) {\n        const proto = target.prototype;\n        proto._proxySubscriberFlags = 0 /* None */;\n        proto.addProxySubscriber = addProxySubscriber;\n        proto.removeProxySubscriber = removeProxySubscriber;\n        proto.hasProxySubscriber = hasProxySubscriber;\n        proto.hasProxySubscribers = hasProxySubscribers;\n        proto.callProxySubscribers = callProxySubscribers;\n        if (proto.subscribeToProxy === void 0)\n            proto.subscribeToProxy = addProxySubscriber;\n        if (proto.unsubscribeFromProxy === void 0)\n            proto.unsubscribeFromProxy = removeProxySubscriber;\n    };\n}\nexport function collectionSubscriberCollection() {\n    // eslint-disable-next-line @typescript-eslint/ban-types\n    return function (target) {\n        const proto = target.prototype;\n        proto._collectionSubscriberFlags = 0 /* None */;\n        proto.addCollectionSubscriber = addCollectionSubscriber;\n        proto.removeCollectionSubscriber = removeCollectionSubscriber;\n        proto.hasCollectionSubscriber = hasCollectionSubscriber;\n        proto.hasCollectionSubscribers = hasCollectionSubscribers;\n        proto.callCollectionSubscribers = callCollectionSubscribers;\n        if (proto.subscribeToCollection === void 0)\n            proto.subscribeToCollection = addCollectionSubscriber;\n        if (proto.unsubscribeFromCollection === void 0)\n            proto.unsubscribeFromCollection = removeCollectionSubscriber;\n    };\n}\nfunction addSubscriber(subscriber) {\n    if (this.hasSubscriber(subscriber)) {\n        return false;\n    }\n    const subscriberFlags = this._subscriberFlags;\n    if ((subscriberFlags & 1 /* Subscriber0 */) === 0) {\n        this._subscriber0 = subscriber;\n        this._subscriberFlags |= 1 /* Subscriber0 */;\n    }\n    else if ((subscriberFlags & 2 /* Subscriber1 */) === 0) {\n        this._subscriber1 = subscriber;\n        this._subscriberFlags |= 2 /* Subscriber1 */;\n    }\n    else if ((subscriberFlags & 4 /* Subscriber2 */) === 0) {\n        this._subscriber2 = subscriber;\n        this._subscriberFlags |= 4 /* Subscriber2 */;\n    }\n    else if ((subscriberFlags & 8 /* SubscribersRest */) === 0) {\n        this._subscribersRest = [subscriber];\n        this._subscriberFlags |= 8 /* SubscribersRest */;\n    }\n    else {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        this._subscribersRest.push(subscriber); // Non-null is implied by else branch of (subscriberFlags & SF.SubscribersRest) === 0\n    }\n    return true;\n}\nfunction addProxySubscriber(subscriber) {\n    if (this.hasProxySubscriber(subscriber)) {\n        return false;\n    }\n    const subscriberFlags = this._proxySubscriberFlags;\n    if ((subscriberFlags & 1 /* Subscriber0 */) === 0) {\n        this._proxySubscriber0 = subscriber;\n        this._proxySubscriberFlags |= 1 /* Subscriber0 */;\n    }\n    else if ((subscriberFlags & 2 /* Subscriber1 */) === 0) {\n        this._proxySubscriber1 = subscriber;\n        this._proxySubscriberFlags |= 2 /* Subscriber1 */;\n    }\n    else if ((subscriberFlags & 4 /* Subscriber2 */) === 0) {\n        this._proxySubscriber2 = subscriber;\n        this._proxySubscriberFlags |= 4 /* Subscriber2 */;\n    }\n    else if ((subscriberFlags & 8 /* SubscribersRest */) === 0) {\n        this._proxySubscribersRest = [subscriber];\n        this._proxySubscriberFlags |= 8 /* SubscribersRest */;\n    }\n    else {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        this._proxySubscribersRest.push(subscriber); // Non-null is implied by else branch of (subscriberFlags & SF.SubscribersRest) === 0\n    }\n    return true;\n}\nfunction addCollectionSubscriber(subscriber) {\n    if (this.hasCollectionSubscriber(subscriber)) {\n        return false;\n    }\n    const subscriberFlags = this._collectionSubscriberFlags;\n    if ((subscriberFlags & 1 /* Subscriber0 */) === 0) {\n        this._collectionSubscriber0 = subscriber;\n        this._collectionSubscriberFlags |= 1 /* Subscriber0 */;\n    }\n    else if ((subscriberFlags & 2 /* Subscriber1 */) === 0) {\n        this._collectionSubscriber1 = subscriber;\n        this._collectionSubscriberFlags |= 2 /* Subscriber1 */;\n    }\n    else if ((subscriberFlags & 4 /* Subscriber2 */) === 0) {\n        this._collectionSubscriber2 = subscriber;\n        this._collectionSubscriberFlags |= 4 /* Subscriber2 */;\n    }\n    else if ((subscriberFlags & 8 /* SubscribersRest */) === 0) {\n        this._collectionSubscribersRest = [subscriber];\n        this._collectionSubscriberFlags |= 8 /* SubscribersRest */;\n    }\n    else {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        this._collectionSubscribersRest.push(subscriber); // Non-null is implied by else branch of (subscriberFlags & SF.SubscribersRest) === 0\n    }\n    return true;\n}\nfunction removeSubscriber(subscriber) {\n    const subscriberFlags = this._subscriberFlags;\n    if ((subscriberFlags & 1 /* Subscriber0 */) > 0 && this._subscriber0 === subscriber) {\n        this._subscriber0 = void 0;\n        this._subscriberFlags = (this._subscriberFlags | 1 /* Subscriber0 */) ^ 1 /* Subscriber0 */;\n        return true;\n    }\n    else if ((subscriberFlags & 2 /* Subscriber1 */) > 0 && this._subscriber1 === subscriber) {\n        this._subscriber1 = void 0;\n        this._subscriberFlags = (this._subscriberFlags | 2 /* Subscriber1 */) ^ 2 /* Subscriber1 */;\n        return true;\n    }\n    else if ((subscriberFlags & 4 /* Subscriber2 */) > 0 && this._subscriber2 === subscriber) {\n        this._subscriber2 = void 0;\n        this._subscriberFlags = (this._subscriberFlags | 4 /* Subscriber2 */) ^ 4 /* Subscriber2 */;\n        return true;\n    }\n    else if ((subscriberFlags & 8 /* SubscribersRest */) > 0) {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        const subscribers = this._subscribersRest; // Non-null is implied by (subscriberFlags & SF.SubscribersRest) > 0\n        for (let i = 0, ii = subscribers.length; i < ii; ++i) {\n            if (subscribers[i] === subscriber) {\n                subscribers.splice(i, 1);\n                if (ii === 1) {\n                    this._subscriberFlags = (this._subscriberFlags | 8 /* SubscribersRest */) ^ 8 /* SubscribersRest */;\n                }\n                return true;\n            }\n        }\n    }\n    return false;\n}\nfunction removeProxySubscriber(subscriber) {\n    const subscriberFlags = this._proxySubscriberFlags;\n    if ((subscriberFlags & 1 /* Subscriber0 */) > 0 && this._proxySubscriber0 === subscriber) {\n        this._proxySubscriber0 = void 0;\n        this._proxySubscriberFlags = (this._proxySubscriberFlags | 1 /* Subscriber0 */) ^ 1 /* Subscriber0 */;\n        return true;\n    }\n    else if ((subscriberFlags & 2 /* Subscriber1 */) > 0 && this._proxySubscriber1 === subscriber) {\n        this._proxySubscriber1 = void 0;\n        this._proxySubscriberFlags = (this._proxySubscriberFlags | 2 /* Subscriber1 */) ^ 2 /* Subscriber1 */;\n        return true;\n    }\n    else if ((subscriberFlags & 4 /* Subscriber2 */) > 0 && this._proxySubscriber2 === subscriber) {\n        this._proxySubscriber2 = void 0;\n        this._proxySubscriberFlags = (this._proxySubscriberFlags | 4 /* Subscriber2 */) ^ 4 /* Subscriber2 */;\n        return true;\n    }\n    else if ((subscriberFlags & 8 /* SubscribersRest */) > 0) {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        const subscribers = this._proxySubscribersRest; // Non-null is implied by (subscriberFlags & SF.SubscribersRest) > 0\n        for (let i = 0, ii = subscribers.length; i < ii; ++i) {\n            if (subscribers[i] === subscriber) {\n                subscribers.splice(i, 1);\n                if (ii === 1) {\n                    this._proxySubscriberFlags = (this._proxySubscriberFlags | 8 /* SubscribersRest */) ^ 8 /* SubscribersRest */;\n                }\n                return true;\n            }\n        }\n    }\n    return false;\n}\nfunction removeCollectionSubscriber(subscriber) {\n    const subscriberFlags = this._collectionSubscriberFlags;\n    if ((subscriberFlags & 1 /* Subscriber0 */) > 0 && this._collectionSubscriber0 === subscriber) {\n        this._collectionSubscriber0 = void 0;\n        this._collectionSubscriberFlags = (this._collectionSubscriberFlags | 1 /* Subscriber0 */) ^ 1 /* Subscriber0 */;\n        return true;\n    }\n    else if ((subscriberFlags & 2 /* Subscriber1 */) > 0 && this._collectionSubscriber1 === subscriber) {\n        this._collectionSubscriber1 = void 0;\n        this._collectionSubscriberFlags = (this._collectionSubscriberFlags | 2 /* Subscriber1 */) ^ 2 /* Subscriber1 */;\n        return true;\n    }\n    else if ((subscriberFlags & 4 /* Subscriber2 */) > 0 && this._collectionSubscriber2 === subscriber) {\n        this._collectionSubscriber2 = void 0;\n        this._collectionSubscriberFlags = (this._collectionSubscriberFlags | 4 /* Subscriber2 */) ^ 4 /* Subscriber2 */;\n        return true;\n    }\n    else if ((subscriberFlags & 8 /* SubscribersRest */) > 0) {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        const subscribers = this._collectionSubscribersRest; // Non-null is implied by (subscriberFlags & SF.SubscribersRest) > 0\n        for (let i = 0, ii = subscribers.length; i < ii; ++i) {\n            if (subscribers[i] === subscriber) {\n                subscribers.splice(i, 1);\n                if (ii === 1) {\n                    this._collectionSubscriberFlags = (this._collectionSubscriberFlags | 8 /* SubscribersRest */) ^ 8 /* SubscribersRest */;\n                }\n                return true;\n            }\n        }\n    }\n    return false;\n}\nfunction hasSubscribers() {\n    return this._subscriberFlags !== 0 /* None */;\n}\nfunction hasProxySubscribers() {\n    return this._proxySubscriberFlags !== 0 /* None */;\n}\nfunction hasCollectionSubscribers() {\n    return this._collectionSubscriberFlags !== 0 /* None */;\n}\nfunction hasSubscriber(subscriber) {\n    // Flags here is just a perf tweak\n    // Compared to not using flags, it's a moderate speed-up when this collection does not have the subscriber;\n    // and minor slow-down when it does, and the former is more common than the latter.\n    const subscriberFlags = this._subscriberFlags;\n    if ((subscriberFlags & 1 /* Subscriber0 */) > 0 && this._subscriber0 === subscriber) {\n        return true;\n    }\n    if ((subscriberFlags & 2 /* Subscriber1 */) > 0 && this._subscriber1 === subscriber) {\n        return true;\n    }\n    if ((subscriberFlags & 4 /* Subscriber2 */) > 0 && this._subscriber2 === subscriber) {\n        return true;\n    }\n    if ((subscriberFlags & 8 /* SubscribersRest */) > 0) {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        const subscribers = this._subscribersRest; // Non-null is implied by (subscriberFlags & SF.SubscribersRest) > 0\n        for (let i = 0, ii = subscribers.length; i < ii; ++i) {\n            if (subscribers[i] === subscriber) {\n                return true;\n            }\n        }\n    }\n    return false;\n}\nfunction hasProxySubscriber(subscriber) {\n    const subscriberFlags = this._proxySubscriberFlags;\n    if ((subscriberFlags & 1 /* Subscriber0 */) > 0 && this._proxySubscriber0 === subscriber) {\n        return true;\n    }\n    if ((subscriberFlags & 2 /* Subscriber1 */) > 0 && this._proxySubscriber1 === subscriber) {\n        return true;\n    }\n    if ((subscriberFlags & 4 /* Subscriber2 */) > 0 && this._proxySubscriber2 === subscriber) {\n        return true;\n    }\n    if ((subscriberFlags & 8 /* SubscribersRest */) > 0) {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        const subscribers = this._proxySubscribersRest; // Non-null is implied by (subscriberFlags & SF.SubscribersRest) > 0\n        for (let i = 0, ii = subscribers.length; i < ii; ++i) {\n            if (subscribers[i] === subscriber) {\n                return true;\n            }\n        }\n    }\n    return false;\n}\nfunction hasCollectionSubscriber(subscriber) {\n    const subscriberFlags = this._collectionSubscriberFlags;\n    if ((subscriberFlags & 1 /* Subscriber0 */) > 0 && this._collectionSubscriber0 === subscriber) {\n        return true;\n    }\n    if ((subscriberFlags & 2 /* Subscriber1 */) > 0 && this._collectionSubscriber1 === subscriber) {\n        return true;\n    }\n    if ((subscriberFlags & 4 /* Subscriber2 */) > 0 && this._collectionSubscriber2 === subscriber) {\n        return true;\n    }\n    if ((subscriberFlags & 8 /* SubscribersRest */) > 0) {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        const subscribers = this._collectionSubscribersRest; // Non-null is implied by (subscriberFlags & SF.SubscribersRest) > 0\n        for (let i = 0, ii = subscribers.length; i < ii; ++i) {\n            if (subscribers[i] === subscriber) {\n                return true;\n            }\n        }\n    }\n    return false;\n}\nfunction callSubscribers(newValue, previousValue, flags) {\n    /**\n     * Note: change handlers may have the side-effect of adding/removing subscribers to this collection during this\n     * callSubscribers invocation, so we're caching them all before invoking any.\n     * Subscribers added during this invocation are not invoked (and they shouldn't be).\n     * Subscribers removed during this invocation will still be invoked (and they also shouldn't be,\n     * however this is accounted for via $isBound and similar flags on the subscriber objects)\n     */\n    const subscriber0 = this._subscriber0;\n    const subscriber1 = this._subscriber1;\n    const subscriber2 = this._subscriber2;\n    let subscribers = this._subscribersRest;\n    if (subscribers !== void 0) {\n        subscribers = subscribers.slice();\n    }\n    if (subscriber0 !== void 0) {\n        callSubscriber(subscriber0, newValue, previousValue, flags, subscriber0.id === void 0 ? 0 : this[subscriber0.id]);\n    }\n    if (subscriber1 !== void 0) {\n        callSubscriber(subscriber1, newValue, previousValue, flags, subscriber1.id === void 0 ? 0 : this[subscriber1.id]);\n    }\n    if (subscriber2 !== void 0) {\n        callSubscriber(subscriber2, newValue, previousValue, flags, subscriber2.id === void 0 ? 0 : this[subscriber2.id]);\n    }\n    if (subscribers !== void 0) {\n        const { length } = subscribers;\n        let subscriber;\n        for (let i = 0; i < length; ++i) {\n            subscriber = subscribers[i];\n            if (subscriber !== void 0) {\n                callSubscriber(subscriber, newValue, previousValue, flags, subscriber.id === void 0 ? 0 : this[subscriber.id]);\n            }\n        }\n    }\n}\nfunction callSubscriber(subscriber, newValue, previousValue, flags, ownFlags) {\n    subscriber.handleChange(newValue, previousValue, ((flags | 48 /* update */) ^ 48 /* update */) | ownFlags);\n}\nfunction callProxySubscribers(key, newValue, previousValue, flags) {\n    const subscriber0 = this._proxySubscriber0;\n    const subscriber1 = this._proxySubscriber1;\n    const subscriber2 = this._proxySubscriber2;\n    let subscribers = this._proxySubscribersRest;\n    if (subscribers !== void 0) {\n        subscribers = subscribers.slice();\n    }\n    if (subscriber0 !== void 0) {\n        subscriber0.handleProxyChange(key, newValue, previousValue, flags);\n    }\n    if (subscriber1 !== void 0) {\n        subscriber1.handleProxyChange(key, newValue, previousValue, flags);\n    }\n    if (subscriber2 !== void 0) {\n        subscriber2.handleProxyChange(key, newValue, previousValue, flags);\n    }\n    if (subscribers !== void 0) {\n        const { length } = subscribers;\n        let subscriber;\n        for (let i = 0; i < length; ++i) {\n            subscriber = subscribers[i];\n            if (subscriber !== void 0) {\n                subscriber.handleProxyChange(key, newValue, previousValue, flags);\n            }\n        }\n    }\n}\nfunction callCollectionSubscribers(indexMap, flags) {\n    const subscriber0 = this._collectionSubscriber0;\n    const subscriber1 = this._collectionSubscriber1;\n    const subscriber2 = this._collectionSubscriber2;\n    let subscribers = this._collectionSubscribersRest;\n    if (subscribers !== void 0) {\n        subscribers = subscribers.slice();\n    }\n    if (subscriber0 !== void 0) {\n        subscriber0.handleCollectionChange(indexMap, flags);\n    }\n    if (subscriber1 !== void 0) {\n        subscriber1.handleCollectionChange(indexMap, flags);\n    }\n    if (subscriber2 !== void 0) {\n        subscriber2.handleCollectionChange(indexMap, flags);\n    }\n    if (subscribers !== void 0) {\n        const { length } = subscribers;\n        let subscriber;\n        for (let i = 0; i < length; ++i) {\n            subscriber = subscribers[i];\n            if (subscriber !== void 0) {\n                subscriber.handleCollectionChange(indexMap, flags);\n            }\n        }\n    }\n}\n//# sourceMappingURL=subscriber-collection.js.map","import { __decorate, __metadata, __param } from \"tslib\";\nimport { DI, Registration, } from '@aurelia/kernel';\nexport var ViewModelKind;\n(function (ViewModelKind) {\n    ViewModelKind[ViewModelKind[\"customElement\"] = 0] = \"customElement\";\n    ViewModelKind[ViewModelKind[\"customAttribute\"] = 1] = \"customAttribute\";\n    ViewModelKind[ViewModelKind[\"synthetic\"] = 2] = \"synthetic\";\n})(ViewModelKind || (ViewModelKind = {}));\nexport const IController = DI.createInterface('IController').noDefault();\n/**\n * Describing characteristics of a mounting operation a controller will perform\n */\nexport var MountStrategy;\n(function (MountStrategy) {\n    MountStrategy[MountStrategy[\"insertBefore\"] = 1] = \"insertBefore\";\n    MountStrategy[MountStrategy[\"append\"] = 2] = \"append\";\n})(MountStrategy || (MountStrategy = {}));\nexport const IViewFactory = DI.createInterface('IViewFactory').noDefault();\nexport const ILifecycle = DI.createInterface('ILifecycle').withDefault(x => x.singleton(Lifecycle));\nlet BoundQueue = class BoundQueue {\n    constructor(lifecycle) {\n        this.lifecycle = lifecycle;\n        this.depth = 0;\n        this.head = void 0;\n        this.tail = void 0;\n    }\n    begin() {\n        ++this.depth;\n    }\n    end(flags) {\n        if (flags === void 0) {\n            flags = 0 /* none */;\n        }\n        if (--this.depth === 0) {\n            this.process(flags);\n        }\n    }\n    inline(fn, flags) {\n        this.begin();\n        fn();\n        this.end(flags);\n    }\n    add(controller) {\n        if (this.head === void 0) {\n            this.head = controller;\n        }\n        else {\n            controller.prevBound = this.tail;\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            this.tail.nextBound = controller; // implied by boundHead not being undefined\n        }\n        this.tail = controller;\n    }\n    remove(controller) {\n        if (controller.prevBound !== void 0) {\n            controller.prevBound.nextBound = controller.nextBound;\n        }\n        if (controller.nextBound !== void 0) {\n            controller.nextBound.prevBound = controller.prevBound;\n        }\n        controller.prevBound = void 0;\n        controller.nextBound = void 0;\n        if (this.tail === controller) {\n            this.tail = controller.prevBound;\n        }\n        if (this.head === controller) {\n            this.head = controller.nextBound;\n        }\n    }\n    process(flags) {\n        while (this.head !== void 0) {\n            let cur = this.head;\n            this.head = this.tail = void 0;\n            let next;\n            do {\n                cur.afterBind(flags);\n                next = cur.nextBound;\n                cur.nextBound = void 0;\n                cur.prevBound = void 0;\n                // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n                cur = next; // we're checking it for undefined the next line\n            } while (cur !== void 0);\n        }\n    }\n};\nBoundQueue = __decorate([\n    __param(0, ILifecycle),\n    __metadata(\"design:paramtypes\", [Object])\n], BoundQueue);\nexport { BoundQueue };\nlet UnboundQueue = class UnboundQueue {\n    constructor(lifecycle) {\n        this.lifecycle = lifecycle;\n        this.depth = 0;\n        this.head = void 0;\n        this.tail = void 0;\n    }\n    begin() {\n        ++this.depth;\n    }\n    end(flags) {\n        if (flags === void 0) {\n            flags = 0 /* none */;\n        }\n        if (--this.depth === 0) {\n            this.process(flags);\n        }\n    }\n    inline(fn, flags) {\n        this.begin();\n        fn();\n        this.end(flags);\n    }\n    add(controller) {\n        if (this.head === void 0) {\n            this.head = controller;\n        }\n        else {\n            controller.prevUnbound = this.tail;\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            this.tail.nextUnbound = controller; // implied by unboundHead not being undefined\n        }\n        this.tail = controller;\n    }\n    remove(controller) {\n        if (controller.prevUnbound !== void 0) {\n            controller.prevUnbound.nextUnbound = controller.nextUnbound;\n        }\n        if (controller.nextUnbound !== void 0) {\n            controller.nextUnbound.prevUnbound = controller.prevUnbound;\n        }\n        controller.prevUnbound = void 0;\n        controller.nextUnbound = void 0;\n        if (this.tail === controller) {\n            this.tail = controller.prevUnbound;\n        }\n        if (this.head === controller) {\n            this.head = controller.nextUnbound;\n        }\n    }\n    process(flags) {\n        while (this.head !== void 0) {\n            let cur = this.head;\n            this.head = this.tail = void 0;\n            let next;\n            do {\n                cur.afterUnbind(flags);\n                next = cur.nextUnbound;\n                cur.nextUnbound = void 0;\n                cur.prevUnbound = void 0;\n                // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n                cur = next; // we're checking it for undefined the next line\n            } while (cur !== void 0);\n        }\n    }\n};\nUnboundQueue = __decorate([\n    __param(0, ILifecycle),\n    __metadata(\"design:paramtypes\", [Object])\n], UnboundQueue);\nexport { UnboundQueue };\nlet AttachedQueue = class AttachedQueue {\n    constructor(lifecycle) {\n        this.lifecycle = lifecycle;\n        this.depth = 0;\n        this.head = void 0;\n        this.tail = void 0;\n    }\n    begin() {\n        ++this.depth;\n    }\n    end(flags) {\n        if (flags === void 0) {\n            flags = 0 /* none */;\n        }\n        if (--this.depth === 0) {\n            // temporary, until everything else works and we're ready for integrating mount/unmount in the RAF queue\n            this.lifecycle.mount.process(flags);\n            this.process(flags);\n        }\n    }\n    inline(fn, flags) {\n        this.begin();\n        fn();\n        this.end(flags);\n    }\n    add(controller) {\n        if (this.head === void 0) {\n            this.head = controller;\n        }\n        else {\n            controller.prevAttached = this.tail;\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            this.tail.nextAttached = controller; // implied by attachedHead not being undefined\n        }\n        this.tail = controller;\n    }\n    remove(controller) {\n        if (controller.prevAttached !== void 0) {\n            controller.prevAttached.nextAttached = controller.nextAttached;\n        }\n        if (controller.nextAttached !== void 0) {\n            controller.nextAttached.prevAttached = controller.prevAttached;\n        }\n        controller.prevAttached = void 0;\n        controller.nextAttached = void 0;\n        if (this.tail === controller) {\n            this.tail = controller.prevAttached;\n        }\n        if (this.head === controller) {\n            this.head = controller.nextAttached;\n        }\n    }\n    process(flags) {\n        while (this.head !== void 0) {\n            let cur = this.head;\n            this.head = this.tail = void 0;\n            let next;\n            do {\n                cur.afterAttach(flags);\n                next = cur.nextAttached;\n                cur.nextAttached = void 0;\n                cur.prevAttached = void 0;\n                // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n                cur = next; // we're checking it for undefined the next line\n            } while (cur !== void 0);\n        }\n    }\n};\nAttachedQueue = __decorate([\n    __param(0, ILifecycle),\n    __metadata(\"design:paramtypes\", [Object])\n], AttachedQueue);\nexport { AttachedQueue };\nlet DetachedQueue = class DetachedQueue {\n    constructor(lifecycle) {\n        this.lifecycle = lifecycle;\n        this.depth = 0;\n        this.head = void 0;\n        this.tail = void 0;\n    }\n    begin() {\n        ++this.depth;\n    }\n    end(flags) {\n        if (flags === void 0) {\n            flags = 0 /* none */;\n        }\n        if (--this.depth === 0) {\n            // temporary, until everything else works and we're ready for integrating mount/unmount in the RAF queue\n            this.lifecycle.unmount.process(flags);\n            this.process(flags);\n        }\n    }\n    inline(fn, flags) {\n        this.begin();\n        fn();\n        this.end(flags);\n    }\n    add(controller) {\n        if (this.head === void 0) {\n            this.head = controller;\n        }\n        else {\n            controller.prevDetached = this.tail;\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            this.tail.nextDetached = controller; // implied by detachedHead not being undefined\n        }\n        this.tail = controller;\n    }\n    remove(controller) {\n        if (controller.prevDetached !== void 0) {\n            controller.prevDetached.nextDetached = controller.nextDetached;\n        }\n        if (controller.nextDetached !== void 0) {\n            controller.nextDetached.prevDetached = controller.prevDetached;\n        }\n        controller.prevDetached = void 0;\n        controller.nextDetached = void 0;\n        if (this.tail === controller) {\n            this.tail = controller.prevDetached;\n        }\n        if (this.head === controller) {\n            this.head = controller.nextDetached;\n        }\n    }\n    process(flags) {\n        while (this.head !== void 0) {\n            let cur = this.head;\n            this.head = this.tail = void 0;\n            let next;\n            do {\n                cur.afterDetach(flags);\n                next = cur.nextDetached;\n                cur.nextDetached = void 0;\n                cur.prevDetached = void 0;\n                // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n                cur = next; // we're checking it for undefined the next line\n            } while (cur !== void 0);\n        }\n    }\n};\nDetachedQueue = __decorate([\n    __param(0, ILifecycle),\n    __metadata(\"design:paramtypes\", [Object])\n], DetachedQueue);\nexport { DetachedQueue };\nlet MountQueue = class MountQueue {\n    constructor(lifecycle) {\n        this.lifecycle = lifecycle;\n        this.depth = 0;\n        this.head = void 0;\n        this.tail = void 0;\n    }\n    add(controller) {\n        if (this.head === void 0) {\n            this.head = controller;\n        }\n        else {\n            controller.prevMount = this.tail;\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            this.tail.nextMount = controller; // implied by mountHead not being undefined\n        }\n        this.tail = controller;\n    }\n    remove(controller) {\n        if (controller.prevMount !== void 0) {\n            controller.prevMount.nextMount = controller.nextMount;\n        }\n        if (controller.nextMount !== void 0) {\n            controller.nextMount.prevMount = controller.prevMount;\n        }\n        controller.prevMount = void 0;\n        controller.nextMount = void 0;\n        if (this.tail === controller) {\n            this.tail = controller.prevMount;\n        }\n        if (this.head === controller) {\n            this.head = controller.nextMount;\n        }\n    }\n    process(flags) {\n        let i = 0;\n        while (this.head !== void 0) {\n            let cur = this.head;\n            this.head = this.tail = void 0;\n            let next;\n            do {\n                ++i;\n                cur.mount(flags);\n                next = cur.nextMount;\n                cur.nextMount = void 0;\n                cur.prevMount = void 0;\n                // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n                cur = next; // we're checking it for undefined the next line\n            } while (cur !== void 0);\n        }\n    }\n};\nMountQueue = __decorate([\n    __param(0, ILifecycle),\n    __metadata(\"design:paramtypes\", [Object])\n], MountQueue);\nexport { MountQueue };\nlet UnmountQueue = class UnmountQueue {\n    constructor(lifecycle) {\n        this.lifecycle = lifecycle;\n        this.head = void 0;\n        this.tail = void 0;\n    }\n    add(controller) {\n        if (this.head === void 0) {\n            this.head = controller;\n        }\n        else {\n            controller.prevUnmount = this.tail;\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            this.tail.nextUnmount = controller; // implied by unmountHead not being undefined\n        }\n        this.tail = controller;\n    }\n    remove(controller) {\n        if (controller.prevUnmount !== void 0) {\n            controller.prevUnmount.nextUnmount = controller.nextUnmount;\n        }\n        if (controller.nextUnmount !== void 0) {\n            controller.nextUnmount.prevUnmount = controller.prevUnmount;\n        }\n        controller.prevUnmount = void 0;\n        controller.nextUnmount = void 0;\n        if (this.tail === controller) {\n            this.tail = controller.prevUnmount;\n        }\n        if (this.head === controller) {\n            this.head = controller.nextUnmount;\n        }\n    }\n    process(flags) {\n        let i = 0;\n        while (this.head !== void 0) {\n            let cur = this.head;\n            this.head = this.tail = void 0;\n            let next;\n            do {\n                ++i;\n                cur.unmount(flags);\n                next = cur.nextUnmount;\n                cur.nextUnmount = void 0;\n                cur.prevUnmount = void 0;\n                // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n                cur = next; // we're checking it for undefined the next line\n            } while (cur !== void 0);\n        }\n    }\n};\nUnmountQueue = __decorate([\n    __param(0, ILifecycle),\n    __metadata(\"design:paramtypes\", [Object])\n], UnmountQueue);\nexport { UnmountQueue };\nlet BatchQueue = class BatchQueue {\n    constructor(lifecycle) {\n        this.lifecycle = lifecycle;\n        this.queue = [];\n        this.depth = 0;\n    }\n    begin() {\n        ++this.depth;\n    }\n    end(flags) {\n        if (flags === void 0) {\n            flags = 0 /* none */;\n        }\n        if (--this.depth === 0) {\n            this.process(flags);\n        }\n    }\n    inline(fn, flags) {\n        this.begin();\n        fn();\n        this.end(flags);\n    }\n    add(requestor) {\n        this.queue.push(requestor);\n    }\n    remove(requestor) {\n        const index = this.queue.indexOf(requestor);\n        if (index > -1) {\n            this.queue.splice(index, 1);\n        }\n    }\n    process(flags) {\n        flags |= 512 /* fromBatch */;\n        while (this.queue.length > 0) {\n            const batch = this.queue.slice();\n            this.queue = [];\n            const { length } = batch;\n            for (let i = 0; i < length; ++i) {\n                batch[i].flushBatch(flags);\n            }\n        }\n    }\n};\nBatchQueue = __decorate([\n    __param(0, ILifecycle),\n    __metadata(\"design:paramtypes\", [Object])\n], BatchQueue);\nexport { BatchQueue };\nexport class Lifecycle {\n    constructor() {\n        this.batch = new BatchQueue(this);\n        this.mount = new MountQueue(this);\n        this.unmount = new UnmountQueue(this);\n        this.afterBind = new BoundQueue(this);\n        this.afterUnbind = new UnboundQueue(this);\n        this.afterAttach = new AttachedQueue(this);\n        this.afterDetach = new DetachedQueue(this);\n    }\n    static register(container) {\n        return Registration.singleton(ILifecycle, this).register(container);\n    }\n}\n//# sourceMappingURL=lifecycle.js.map","import { __decorate, __metadata } from \"tslib\";\nimport { Reporter } from '@aurelia/kernel';\nimport { ILifecycle } from '../lifecycle';\nimport { subscriberCollection } from './subscriber-collection';\n/**\n * Observer for the mutation of object property value employing getter-setter strategy.\n * This is used for observing object properties that has no decorator.\n */\nlet SetterObserver = class SetterObserver {\n    constructor(lifecycle, flags, obj, propertyKey) {\n        this.lifecycle = lifecycle;\n        this.obj = obj;\n        this.propertyKey = propertyKey;\n        this.currentValue = void 0;\n        this.oldValue = void 0;\n        this.inBatch = false;\n        this.observing = false;\n        this.persistentFlags = flags & 2080374799 /* persistentBindingFlags */;\n    }\n    getValue() {\n        return this.currentValue;\n    }\n    setValue(newValue, flags) {\n        if (this.observing) {\n            const currentValue = this.currentValue;\n            this.currentValue = newValue;\n            if (this.lifecycle.batch.depth === 0) {\n                this.callSubscribers(newValue, currentValue, this.persistentFlags | flags);\n            }\n            else if (!this.inBatch) {\n                this.inBatch = true;\n                this.oldValue = currentValue;\n                this.lifecycle.batch.add(this);\n            }\n        }\n        else {\n            // If subscribe() has been called, the target property descriptor is replaced by these getter/setter methods,\n            // so calling obj[propertyKey] will actually return this.currentValue.\n            // However, if subscribe() was not yet called (indicated by !this.observing), the target descriptor\n            // is unmodified and we need to explicitly set the property value.\n            // This will happen in one-time, to-view and two-way bindings during $bind, meaning that the $bind will not actually update the target value.\n            // This wasn't visible in vCurrent due to connect-queue always doing a delayed update, so in many cases it didn't matter whether $bind updated the target or not.\n            this.obj[this.propertyKey] = newValue;\n        }\n    }\n    flushBatch(flags) {\n        this.inBatch = false;\n        const currentValue = this.currentValue;\n        const oldValue = this.oldValue;\n        this.oldValue = currentValue;\n        this.callSubscribers(currentValue, oldValue, this.persistentFlags | flags);\n    }\n    subscribe(subscriber) {\n        if (this.observing === false) {\n            this.observing = true;\n            this.currentValue = this.obj[this.propertyKey];\n            if (!Reflect.defineProperty(this.obj, this.propertyKey, {\n                enumerable: true,\n                configurable: true,\n                get: () => {\n                    return this.getValue();\n                },\n                set: value => {\n                    this.setValue(value, 0 /* none */);\n                },\n            })) {\n                Reporter.write(1, this.propertyKey, this.obj);\n            }\n        }\n        this.addSubscriber(subscriber);\n    }\n};\nSetterObserver = __decorate([\n    subscriberCollection(),\n    __metadata(\"design:paramtypes\", [Object, Number, Object, String])\n], SetterObserver);\nexport { SetterObserver };\n//# sourceMappingURL=setter-observer.js.map","import { PLATFORM, Reporter } from '@aurelia/kernel';\nimport { ProxyObserver } from './proxy-observer';\nimport { SetterObserver } from './setter-observer';\nvar RuntimeError;\n(function (RuntimeError) {\n    RuntimeError[RuntimeError[\"NilScope\"] = 250] = \"NilScope\";\n    RuntimeError[RuntimeError[\"NilOverrideContext\"] = 252] = \"NilOverrideContext\";\n    RuntimeError[RuntimeError[\"NilParentScope\"] = 253] = \"NilParentScope\";\n})(RuntimeError || (RuntimeError = {}));\nconst marker = Object.freeze({});\n/** @internal */\nexport class InternalObserversLookup {\n    getOrCreate(lifecycle, flags, obj, key) {\n        if (this[key] === void 0) {\n            this[key] = new SetterObserver(lifecycle, flags, obj, key);\n        }\n        return this[key];\n    }\n}\nexport class BindingContext {\n    constructor(keyOrObj, value) {\n        this.$synthetic = true;\n        if (keyOrObj !== void 0) {\n            if (value !== void 0) {\n                // if value is defined then it's just a property and a value to initialize with\n                this[keyOrObj] = value;\n            }\n            else {\n                // can either be some random object or another bindingContext to clone from\n                for (const prop in keyOrObj) {\n                    if (Object.prototype.hasOwnProperty.call(keyOrObj, prop)) {\n                        this[prop] = keyOrObj[prop];\n                    }\n                }\n            }\n        }\n    }\n    static create(flags, keyOrObj, value) {\n        const bc = new BindingContext(keyOrObj, value);\n        if (flags & 2 /* proxyStrategy */) {\n            return ProxyObserver.getOrCreate(bc).proxy;\n        }\n        return bc;\n    }\n    static get(scope, name, ancestor, flags, part) {\n        if (scope == null) {\n            throw Reporter.error(250 /* NilScope */);\n        }\n        let overrideContext = scope.overrideContext;\n        if (ancestor > 0) {\n            // jump up the required number of ancestor contexts (eg $parent.$parent requires two jumps)\n            while (ancestor > 0) {\n                if (overrideContext.parentOverrideContext == null) {\n                    return void 0;\n                }\n                ancestor--;\n                overrideContext = overrideContext.parentOverrideContext;\n            }\n            return name in overrideContext ? overrideContext : overrideContext.bindingContext;\n        }\n        // traverse the context and it's ancestors, searching for a context that has the name.\n        while (overrideContext && !(name in overrideContext) && !(overrideContext.bindingContext && name in overrideContext.bindingContext)) {\n            overrideContext = overrideContext.parentOverrideContext;\n        }\n        if (overrideContext) {\n            // we located a context with the property.  return it.\n            return name in overrideContext ? overrideContext : overrideContext.bindingContext;\n        }\n        // the name wasn't found. see if parent scope traversal is allowed and if so, try that\n        if ((flags & 67108864 /* allowParentScopeTraversal */) > 0) {\n            let parent = scope.parentScope;\n            while (parent !== null) {\n                if (parent.scopeParts.includes(part)) {\n                    const result = this.get(parent, name, ancestor, flags\n                        // unset the flag; only allow one level of scope boundary traversal\n                        & ~67108864 /* allowParentScopeTraversal */\n                        // tell the scope to return null if the name could not be found\n                        | 4194304 /* isTraversingParentScope */);\n                    if (result === marker) {\n                        return scope.bindingContext || scope.overrideContext;\n                    }\n                    else {\n                        return result;\n                    }\n                }\n                else {\n                    parent = parent.parentScope;\n                }\n            }\n            if (parent === null) {\n                throw new Error(`No target scope could be found for part \"${part}\"`);\n            }\n        }\n        // still nothing found. return the root binding context (or null\n        // if this is a parent scope traversal, to ensure we fall back to the\n        // correct level)\n        if (flags & 4194304 /* isTraversingParentScope */) {\n            return marker;\n        }\n        return scope.bindingContext || scope.overrideContext;\n    }\n    getObservers(flags) {\n        if (this.$observers == null) {\n            this.$observers = new InternalObserversLookup();\n        }\n        return this.$observers;\n    }\n}\nexport class Scope {\n    constructor(parentScope, bindingContext, overrideContext) {\n        this.parentScope = parentScope;\n        this.scopeParts = PLATFORM.emptyArray;\n        this.bindingContext = bindingContext;\n        this.overrideContext = overrideContext;\n    }\n    static create(flags, bc, oc) {\n        return new Scope(null, bc, oc == null ? OverrideContext.create(flags, bc, oc) : oc);\n    }\n    static fromOverride(flags, oc) {\n        if (oc == null) {\n            throw Reporter.error(252 /* NilOverrideContext */);\n        }\n        return new Scope(null, oc.bindingContext, oc);\n    }\n    static fromParent(flags, ps, bc) {\n        if (ps == null) {\n            throw Reporter.error(253 /* NilParentScope */);\n        }\n        return new Scope(ps, bc, OverrideContext.create(flags, bc, ps.overrideContext));\n    }\n}\nexport class OverrideContext {\n    constructor(bindingContext, parentOverrideContext) {\n        this.$synthetic = true;\n        this.bindingContext = bindingContext;\n        this.parentOverrideContext = parentOverrideContext;\n    }\n    static create(flags, bc, poc) {\n        return new OverrideContext(bc, poc === void 0 ? null : poc);\n    }\n    getObservers() {\n        if (this.$observers === void 0) {\n            this.$observers = new InternalObserversLookup();\n        }\n        return this.$observers;\n    }\n}\n//# sourceMappingURL=binding-context.js.map","import { DI } from '@aurelia/kernel';\nexport const ISignaler = DI.createInterface('ISignaler').withDefault(x => x.singleton(Signaler));\n/** @internal */\nexport class Signaler {\n    constructor() {\n        this.signals = Object.create(null);\n    }\n    dispatchSignal(name, flags) {\n        const listeners = this.signals[name];\n        if (listeners === undefined) {\n            return;\n        }\n        for (const listener of listeners.keys()) {\n            listener.handleChange(undefined, undefined, flags | 16 /* updateTargetInstance */);\n        }\n    }\n    addSignalListener(name, listener) {\n        const signals = this.signals;\n        const listeners = signals[name];\n        if (listeners === undefined) {\n            signals[name] = new Set([listener]);\n        }\n        else {\n            listeners.add(listener);\n        }\n    }\n    removeSignalListener(name, listener) {\n        const listeners = this.signals[name];\n        if (listeners) {\n            listeners.delete(listener);\n        }\n    }\n}\n//# sourceMappingURL=signaler.js.map","import { DI, Registration, Metadata, Protocol, } from '@aurelia/kernel';\n/**\n * TargetedInstructionType enum values become the property names for the associated renderers when they are injected\n * into the `Renderer`.\n *\n * Additional instruction types can be added as long as they are 2 characters long and do not clash with existing ones.\n *\n * By convention, the instruction types for a particular runtime start with the same first letter, and the second letter\n * starts counting from letter `a`. The standard runtime instruction types all start with the letter `r`.\n */\nexport var TargetedInstructionType;\n(function (TargetedInstructionType) {\n    TargetedInstructionType[\"hydrateElement\"] = \"ra\";\n    TargetedInstructionType[\"hydrateAttribute\"] = \"rb\";\n    TargetedInstructionType[\"hydrateTemplateController\"] = \"rc\";\n    TargetedInstructionType[\"hydrateLetElement\"] = \"rd\";\n    TargetedInstructionType[\"setProperty\"] = \"re\";\n    TargetedInstructionType[\"interpolation\"] = \"rf\";\n    TargetedInstructionType[\"propertyBinding\"] = \"rg\";\n    TargetedInstructionType[\"callBinding\"] = \"rh\";\n    TargetedInstructionType[\"letBinding\"] = \"ri\";\n    TargetedInstructionType[\"refBinding\"] = \"rj\";\n    TargetedInstructionType[\"iteratorBinding\"] = \"rk\";\n})(TargetedInstructionType || (TargetedInstructionType = {}));\nconst parentPartsOwnPartsLookup = new WeakMap();\n/**\n * Efficiently merge parts, performing the minimal amount of work / using the minimal amount of memory.\n *\n * If either of the two part records is undefined, the other will simply be returned.\n *\n * If both are undefined, undefined will be returned.\n *\n * If neither are undefined, a new object will be returned where parts of the second value will be written last (and thus may overwrite duplicate named parts).\n *\n * This function is idempotent via a WeakMap cache: results are cached and if the same two variables are provided again, the same object will be returned.\n */\nexport function mergeParts(parentParts, ownParts) {\n    if (parentParts === ownParts) {\n        return parentParts;\n    }\n    if (parentParts === void 0) {\n        return ownParts;\n    }\n    if (ownParts === void 0) {\n        return parentParts;\n    }\n    let ownPartsLookup = parentPartsOwnPartsLookup.get(parentParts);\n    if (ownPartsLookup === void 0) {\n        parentPartsOwnPartsLookup.set(parentParts, ownPartsLookup = new WeakMap());\n    }\n    let mergedParts = ownPartsLookup.get(ownParts);\n    if (mergedParts === void 0) {\n        ownPartsLookup.set(ownParts, mergedParts = {\n            ...parentParts,\n            ...ownParts,\n        });\n    }\n    return mergedParts;\n}\nexport const ITargetedInstruction = DI.createInterface('ITargetedInstruction').noDefault();\nexport function isTargetedInstruction(value) {\n    const type = value.type;\n    return typeof type === 'string' && type.length === 2;\n}\nexport class HooksDefinition {\n    constructor(target) {\n        this.hasCreate = 'create' in target;\n        this.hasBeforeCompile = 'beforeCompile' in target;\n        this.hasAfterCompile = 'afterCompile' in target;\n        this.hasAfterCompileChildren = 'afterCompileChildren' in target;\n        this.hasBeforeBind = 'beforeBind' in target;\n        this.hasAfterBind = 'afterBind' in target;\n        this.hasBeforeUnbind = 'beforeUnbind' in target;\n        this.hasAfterUnbind = 'afterUnbind' in target;\n        this.hasBeforeAttach = 'beforeAttach' in target;\n        this.hasAfterAttach = 'afterAttach' in target;\n        this.hasBeforeDetach = 'beforeDetach' in target;\n        this.hasAfterDetach = 'afterDetach' in target;\n        this.hasCaching = 'caching' in target;\n    }\n}\nHooksDefinition.none = new HooksDefinition({});\nexport function alias(...aliases) {\n    return function (target) {\n        const key = Protocol.annotation.keyFor('aliases');\n        const existing = Metadata.getOwn(key, target);\n        if (existing === void 0) {\n            Metadata.define(key, aliases, target);\n        }\n        else {\n            existing.push(...aliases);\n        }\n    };\n}\nexport function registerAliases(aliases, resource, key, container) {\n    for (let i = 0, ii = aliases.length; i < ii; ++i) {\n        Registration.alias(key, resource.keyFrom(aliases[i])).register(container);\n    }\n}\n//# sourceMappingURL=definitions.js.map","// TODO: add connect-queue (or something similar) back in when everything else is working, to improve startup time\nconst slice = Array.prototype.slice;\nconst slotNames = [];\nconst versionSlotNames = [];\nlet lastSlot = -1;\nfunction ensureEnoughSlotNames(currentSlot) {\n    if (currentSlot === lastSlot) {\n        lastSlot += 5;\n        const ii = slotNames.length = versionSlotNames.length = lastSlot + 1;\n        for (let i = currentSlot + 1; i < ii; ++i) {\n            slotNames[i] = `_observer${i}`;\n            versionSlotNames[i] = `_observerVersion${i}`;\n        }\n    }\n}\nensureEnoughSlotNames(-1);\n/** @internal */\nexport function addObserver(observer) {\n    // find the observer.\n    const observerSlots = this.observerSlots == null ? 0 : this.observerSlots;\n    let i = observerSlots;\n    while (i-- && this[slotNames[i]] !== observer)\n        ;\n    // if we are not already observing, put the observer in an open slot and subscribe.\n    if (i === -1) {\n        i = 0;\n        while (this[slotNames[i]]) {\n            i++;\n        }\n        this[slotNames[i]] = observer;\n        observer.subscribe(this);\n        observer[this.id] |= 16 /* updateTargetInstance */;\n        // increment the slot count.\n        if (i === observerSlots) {\n            this.observerSlots = i + 1;\n        }\n    }\n    // set the \"version\" when the observer was used.\n    if (this.version == null) {\n        this.version = 0;\n    }\n    this[versionSlotNames[i]] = this.version;\n    ensureEnoughSlotNames(i);\n}\n/** @internal */\nexport function observeProperty(flags, obj, propertyName) {\n    const observer = this.observerLocator.getObserver(flags, obj, propertyName);\n    /* Note: we need to cast here because we can indeed get an accessor instead of an observer,\n     *  in which case the call to observer.subscribe will throw. It's not very clean and we can solve this in 2 ways:\n     *  1. Fail earlier: only let the locator resolve observers from .getObserver, and throw if no branches are left (e.g. it would otherwise return an accessor)\n     *  2. Fail silently (without throwing): give all accessors a no-op subscribe method\n     *\n     * We'll probably want to implement some global configuration (like a \"strict\" toggle) so users can pick between enforced correctness vs. ease-of-use\n     */\n    this.addObserver(observer);\n}\n/** @internal */\nexport function unobserve(all) {\n    const slots = this.observerSlots;\n    let slotName;\n    let observer;\n    if (all === true) {\n        for (let i = 0; i < slots; ++i) {\n            slotName = slotNames[i];\n            observer = this[slotName];\n            if (observer != null) {\n                this[slotName] = void 0;\n                observer.unsubscribe(this);\n                observer[this.id] &= ~16 /* updateTargetInstance */;\n            }\n        }\n    }\n    else {\n        const version = this.version;\n        for (let i = 0; i < slots; ++i) {\n            if (this[versionSlotNames[i]] !== version) {\n                slotName = slotNames[i];\n                observer = this[slotName];\n                if (observer != null) {\n                    this[slotName] = void 0;\n                    observer.unsubscribe(this);\n                    observer[this.id] &= ~16 /* updateTargetInstance */;\n                }\n            }\n        }\n    }\n}\nfunction connectableDecorator(target) {\n    const proto = target.prototype;\n    if (!Object.prototype.hasOwnProperty.call(proto, 'observeProperty'))\n        proto.observeProperty = observeProperty;\n    if (!Object.prototype.hasOwnProperty.call(proto, 'unobserve'))\n        proto.unobserve = unobserve;\n    if (!Object.prototype.hasOwnProperty.call(proto, 'addObserver'))\n        proto.addObserver = addObserver;\n    return target;\n}\nexport function connectable(target) {\n    return target == null ? connectableDecorator : connectableDecorator(target);\n}\nlet value = 0;\nconnectable.assignIdTo = (instance) => {\n    instance.id = ++value;\n};\n//# sourceMappingURL=connectable.js.map","import { __decorate, __metadata } from \"tslib\";\nimport { Registration, Metadata, Protocol, mergeArrays, firstDefined, DI, fromAnnotationOrDefinitionOrTypeOrDefault, } from '@aurelia/kernel';\nimport { registerAliases } from '../definitions';\nimport { connectable } from '../binding/connectable';\nexport var BindingBehaviorStrategy;\n(function (BindingBehaviorStrategy) {\n    BindingBehaviorStrategy[BindingBehaviorStrategy[\"singleton\"] = 1] = \"singleton\";\n    BindingBehaviorStrategy[BindingBehaviorStrategy[\"interceptor\"] = 2] = \"interceptor\";\n})(BindingBehaviorStrategy || (BindingBehaviorStrategy = {}));\nexport function bindingBehavior(nameOrDef) {\n    return function (target) {\n        return BindingBehavior.define(nameOrDef, target);\n    };\n}\nexport class BindingBehaviorDefinition {\n    constructor(Type, name, aliases, key, strategy) {\n        this.Type = Type;\n        this.name = name;\n        this.aliases = aliases;\n        this.key = key;\n        this.strategy = strategy;\n    }\n    static create(nameOrDef, Type) {\n        let name;\n        let def;\n        if (typeof nameOrDef === 'string') {\n            name = nameOrDef;\n            def = { name };\n        }\n        else {\n            name = nameOrDef.name;\n            def = nameOrDef;\n        }\n        const inheritsFromInterceptor = Object.getPrototypeOf(Type) === BindingInterceptor;\n        return new BindingBehaviorDefinition(Type, firstDefined(BindingBehavior.getAnnotation(Type, 'name'), name), mergeArrays(BindingBehavior.getAnnotation(Type, 'aliases'), def.aliases, Type.aliases), BindingBehavior.keyFrom(name), fromAnnotationOrDefinitionOrTypeOrDefault('strategy', def, Type, () => inheritsFromInterceptor ? 2 /* interceptor */ : 1 /* singleton */));\n    }\n    register(container) {\n        const { Type, key, aliases, strategy } = this;\n        switch (strategy) {\n            case 1 /* singleton */:\n                Registration.singleton(key, Type).register(container);\n                break;\n            case 2 /* interceptor */:\n                Registration.instance(key, new BindingBehaviorFactory(container, Type)).register(container);\n                break;\n        }\n        Registration.alias(key, Type).register(container);\n        registerAliases(aliases, BindingBehavior, key, container);\n    }\n}\nexport class BindingBehaviorFactory {\n    constructor(container, Type) {\n        this.container = container;\n        this.Type = Type;\n        this.deps = DI.getDependencies(Type);\n    }\n    construct(binding, expr) {\n        const container = this.container;\n        const deps = this.deps;\n        switch (deps.length) {\n            case 0:\n            case 1:\n            case 2:\n                return new this.Type(binding, expr);\n            case 3:\n                return new this.Type(container.get(deps[0]), binding, expr);\n            case 4:\n                return new this.Type(container.get(deps[0]), container.get(deps[1]), binding, expr);\n            default:\n                return new this.Type(...deps.map(d => container.get(d)), binding, expr);\n        }\n    }\n}\nlet BindingInterceptor = class BindingInterceptor {\n    constructor(binding, expr) {\n        this.binding = binding;\n        this.expr = expr;\n        this.interceptor = this;\n        let interceptor;\n        while (binding.interceptor !== this) {\n            interceptor = binding.interceptor;\n            binding.interceptor = this;\n            binding = interceptor;\n        }\n    }\n    get id() {\n        return this.binding.id;\n    }\n    get observerLocator() {\n        return this.binding.observerLocator;\n    }\n    get locator() {\n        return this.binding.locator;\n    }\n    get $scope() {\n        return this.binding.$scope;\n    }\n    get part() {\n        return this.binding.part;\n    }\n    get $state() {\n        return this.binding.$state;\n    }\n    updateTarget(value, flags) {\n        this.binding.updateTarget(value, flags);\n    }\n    updateSource(value, flags) {\n        this.binding.updateSource(value, flags);\n    }\n    callSource(args) {\n        return this.binding.callSource(args);\n    }\n    handleChange(newValue, previousValue, flags) {\n        this.binding.handleChange(newValue, previousValue, flags);\n    }\n    $bind(flags, scope, part) {\n        this.binding.$bind(flags, scope, part);\n    }\n    $unbind(flags) {\n        this.binding.$unbind(flags);\n    }\n};\nBindingInterceptor = __decorate([\n    connectable,\n    __metadata(\"design:paramtypes\", [Object, Object])\n], BindingInterceptor);\nexport { BindingInterceptor };\nexport const BindingBehavior = {\n    name: Protocol.resource.keyFor('binding-behavior'),\n    keyFrom(name) {\n        return `${BindingBehavior.name}:${name}`;\n    },\n    isType(value) {\n        return typeof value === 'function' && Metadata.hasOwn(BindingBehavior.name, value);\n    },\n    define(nameOrDef, Type) {\n        const definition = BindingBehaviorDefinition.create(nameOrDef, Type);\n        Metadata.define(BindingBehavior.name, definition, definition.Type);\n        Metadata.define(BindingBehavior.name, definition, definition);\n        Protocol.resource.appendTo(Type, BindingBehavior.name);\n        return definition.Type;\n    },\n    getDefinition(Type) {\n        const def = Metadata.getOwn(BindingBehavior.name, Type);\n        if (def === void 0) {\n            throw new Error(`No definition found for type ${Type.name}`);\n        }\n        return def;\n    },\n    annotate(Type, prop, value) {\n        Metadata.define(Protocol.annotation.keyFor(prop), value, Type);\n    },\n    getAnnotation(Type, prop) {\n        return Metadata.getOwn(Protocol.annotation.keyFor(prop), Type);\n    },\n};\n//# sourceMappingURL=binding-behavior.js.map","import { Registration, Metadata, Protocol, mergeArrays, firstDefined, } from '@aurelia/kernel';\nimport { registerAliases } from '../definitions';\nexport function valueConverter(nameOrDef) {\n    return function (target) {\n        return ValueConverter.define(nameOrDef, target);\n    };\n}\nexport class ValueConverterDefinition {\n    constructor(Type, name, aliases, key) {\n        this.Type = Type;\n        this.name = name;\n        this.aliases = aliases;\n        this.key = key;\n    }\n    static create(nameOrDef, Type) {\n        let name;\n        let def;\n        if (typeof nameOrDef === 'string') {\n            name = nameOrDef;\n            def = { name };\n        }\n        else {\n            name = nameOrDef.name;\n            def = nameOrDef;\n        }\n        return new ValueConverterDefinition(Type, firstDefined(ValueConverter.getAnnotation(Type, 'name'), name), mergeArrays(ValueConverter.getAnnotation(Type, 'aliases'), def.aliases, Type.aliases), ValueConverter.keyFrom(name));\n    }\n    register(container) {\n        const { Type, key, aliases } = this;\n        Registration.singleton(key, Type).register(container);\n        Registration.alias(key, Type).register(container);\n        registerAliases(aliases, ValueConverter, key, container);\n    }\n}\nexport const ValueConverter = {\n    name: Protocol.resource.keyFor('value-converter'),\n    keyFrom(name) {\n        return `${ValueConverter.name}:${name}`;\n    },\n    isType(value) {\n        return typeof value === 'function' && Metadata.hasOwn(ValueConverter.name, value);\n    },\n    define(nameOrDef, Type) {\n        const definition = ValueConverterDefinition.create(nameOrDef, Type);\n        Metadata.define(ValueConverter.name, definition, definition.Type);\n        Metadata.define(ValueConverter.name, definition, definition);\n        Protocol.resource.appendTo(Type, ValueConverter.name);\n        return definition.Type;\n    },\n    getDefinition(Type) {\n        const def = Metadata.getOwn(ValueConverter.name, Type);\n        if (def === void 0) {\n            throw new Error(`No definition found for type ${Type.name}`);\n        }\n        return def;\n    },\n    annotate(Type, prop, value) {\n        Metadata.define(Protocol.annotation.keyFor(prop), value, Type);\n    },\n    getAnnotation(Type, prop) {\n        return Metadata.getOwn(Protocol.annotation.keyFor(prop), Type);\n    },\n};\n//# sourceMappingURL=value-converter.js.map","import { PLATFORM, Reporter, isNumberOrBigInt, isStringOrDate, } from '@aurelia/kernel';\nimport { BindingContext } from '../observation/binding-context';\nimport { ProxyObserver } from '../observation/proxy-observer';\nimport { ISignaler } from '../observation/signaler';\nimport { BindingBehavior, BindingBehaviorFactory, } from '../resources/binding-behavior';\nimport { ValueConverter, } from '../resources/value-converter';\nexport function connects(expr) {\n    return (expr.$kind & 32 /* Connects */) === 32 /* Connects */;\n}\nexport function observes(expr) {\n    return (expr.$kind & 64 /* Observes */) === 64 /* Observes */;\n}\nexport function callsFunction(expr) {\n    return (expr.$kind & 128 /* CallsFunction */) === 128 /* CallsFunction */;\n}\nexport function hasAncestor(expr) {\n    return (expr.$kind & 256 /* HasAncestor */) === 256 /* HasAncestor */;\n}\nexport function isAssignable(expr) {\n    return (expr.$kind & 8192 /* IsAssignable */) === 8192 /* IsAssignable */;\n}\nexport function isLeftHandSide(expr) {\n    return (expr.$kind & 1024 /* IsLeftHandSide */) === 1024 /* IsLeftHandSide */;\n}\nexport function isPrimary(expr) {\n    return (expr.$kind & 512 /* IsPrimary */) === 512 /* IsPrimary */;\n}\nexport function isResource(expr) {\n    return (expr.$kind & 32768 /* IsResource */) === 32768 /* IsResource */;\n}\nexport function hasBind(expr) {\n    return (expr.$kind & 2048 /* HasBind */) === 2048 /* HasBind */;\n}\nexport function hasUnbind(expr) {\n    return (expr.$kind & 4096 /* HasUnbind */) === 4096 /* HasUnbind */;\n}\nexport function isLiteral(expr) {\n    return (expr.$kind & 16384 /* IsLiteral */) === 16384 /* IsLiteral */;\n}\nexport function arePureLiterals(expressions) {\n    if (expressions === void 0 || expressions.length === 0) {\n        return true;\n    }\n    for (let i = 0; i < expressions.length; ++i) {\n        if (!isPureLiteral(expressions[i])) {\n            return false;\n        }\n    }\n    return true;\n}\nexport function isPureLiteral(expr) {\n    if (isLiteral(expr)) {\n        switch (expr.$kind) {\n            case 17955 /* ArrayLiteral */:\n                return arePureLiterals(expr.elements);\n            case 17956 /* ObjectLiteral */:\n                return arePureLiterals(expr.values);\n            case 17958 /* Template */:\n                return arePureLiterals(expr.expressions);\n            case 17925 /* PrimitiveLiteral */:\n                return true;\n        }\n    }\n    return false;\n}\nvar RuntimeError;\n(function (RuntimeError) {\n    RuntimeError[RuntimeError[\"NoLocator\"] = 202] = \"NoLocator\";\n    RuntimeError[RuntimeError[\"NoBehaviorFound\"] = 203] = \"NoBehaviorFound\";\n    RuntimeError[RuntimeError[\"BehaviorAlreadyApplied\"] = 204] = \"BehaviorAlreadyApplied\";\n    RuntimeError[RuntimeError[\"NoConverterFound\"] = 205] = \"NoConverterFound\";\n    RuntimeError[RuntimeError[\"NoBinding\"] = 206] = \"NoBinding\";\n    RuntimeError[RuntimeError[\"NotAFunction\"] = 207] = \"NotAFunction\";\n    RuntimeError[RuntimeError[\"UnknownOperator\"] = 208] = \"UnknownOperator\";\n    RuntimeError[RuntimeError[\"NilScope\"] = 250] = \"NilScope\";\n})(RuntimeError || (RuntimeError = {}));\nexport class CustomExpression {\n    constructor(value) {\n        this.value = value;\n    }\n    evaluate(flags, scope, locator, part) {\n        return this.value;\n    }\n}\nexport class BindingBehaviorExpression {\n    constructor(expression, name, args) {\n        this.expression = expression;\n        this.name = name;\n        this.args = args;\n        this.$kind = 38962 /* BindingBehavior */;\n        this.behaviorKey = BindingBehavior.keyFrom(name);\n    }\n    evaluate(flags, scope, locator, part) {\n        return this.expression.evaluate(flags, scope, locator, part);\n    }\n    assign(flags, scope, locator, value, part) {\n        return this.expression.assign(flags, scope, locator, value, part);\n    }\n    connect(flags, scope, binding, part) {\n        this.expression.connect(flags, scope, binding, part);\n    }\n    bind(flags, scope, binding) {\n        if (scope == null) {\n            throw Reporter.error(250 /* NilScope */, this);\n        }\n        if (!binding) {\n            throw Reporter.error(206 /* NoBinding */, this);\n        }\n        const locator = binding.locator;\n        if (!locator) {\n            throw Reporter.error(202 /* NoLocator */, this);\n        }\n        if (hasBind(this.expression)) {\n            this.expression.bind(flags, scope, binding);\n        }\n        const behaviorKey = this.behaviorKey;\n        const behavior = locator.get(behaviorKey);\n        if (!behavior) {\n            throw Reporter.error(203 /* NoBehaviorFound */, this);\n        }\n        if (!(behavior instanceof BindingBehaviorFactory)) {\n            if (binding[behaviorKey] === void 0) {\n                binding[behaviorKey] = behavior;\n                behavior.bind.call(behavior, flags, scope, binding, ...evalList(flags, scope, locator, this.args));\n            }\n            else {\n                Reporter.write(204 /* BehaviorAlreadyApplied */, this);\n            }\n        }\n    }\n    unbind(flags, scope, binding) {\n        const behaviorKey = this.behaviorKey;\n        if (binding[behaviorKey] !== void 0) {\n            binding[behaviorKey].unbind(flags, scope, binding);\n            binding[behaviorKey] = void 0;\n        }\n        if (hasUnbind(this.expression)) {\n            this.expression.unbind(flags, scope, binding);\n        }\n    }\n    accept(visitor) {\n        return visitor.visitBindingBehavior(this);\n    }\n}\nexport class ValueConverterExpression {\n    constructor(expression, name, args) {\n        this.expression = expression;\n        this.name = name;\n        this.args = args;\n        this.$kind = 36913 /* ValueConverter */;\n        this.converterKey = ValueConverter.keyFrom(name);\n    }\n    evaluate(flags, scope, locator, part) {\n        if (!locator) {\n            throw Reporter.error(202 /* NoLocator */, this);\n        }\n        const converter = locator.get(this.converterKey);\n        if (!converter) {\n            throw Reporter.error(205 /* NoConverterFound */, this);\n        }\n        if ('toView' in converter) {\n            const args = this.args;\n            const len = args.length;\n            const result = Array(len + 1);\n            result[0] = this.expression.evaluate(flags, scope, locator, part);\n            for (let i = 0; i < len; ++i) {\n                result[i + 1] = args[i].evaluate(flags, scope, locator, part);\n            }\n            return converter.toView.call(converter, ...result);\n        }\n        return this.expression.evaluate(flags, scope, locator, part);\n    }\n    assign(flags, scope, locator, value, part) {\n        if (!locator) {\n            throw Reporter.error(202 /* NoLocator */, this);\n        }\n        const converter = locator.get(this.converterKey);\n        if (!converter) {\n            throw Reporter.error(205 /* NoConverterFound */, this);\n        }\n        if ('fromView' in converter) {\n            value = converter.fromView.call(converter, value, ...(evalList(flags, scope, locator, this.args)));\n        }\n        return this.expression.assign(flags, scope, locator, value, part);\n    }\n    connect(flags, scope, binding, part) {\n        if (scope == null) {\n            throw Reporter.error(250 /* NilScope */, this);\n        }\n        if (!binding) {\n            throw Reporter.error(206 /* NoBinding */, this);\n        }\n        const locator = binding.locator;\n        if (!locator) {\n            throw Reporter.error(202 /* NoLocator */, this);\n        }\n        this.expression.connect(flags, scope, binding, part);\n        const args = this.args;\n        for (let i = 0, ii = args.length; i < ii; ++i) {\n            args[i].connect(flags, scope, binding, part);\n        }\n        const converter = locator.get(this.converterKey);\n        if (!converter) {\n            throw Reporter.error(205 /* NoConverterFound */, this);\n        }\n        const signals = converter.signals;\n        if (signals === void 0) {\n            return;\n        }\n        const signaler = locator.get(ISignaler);\n        for (let i = 0, ii = signals.length; i < ii; ++i) {\n            signaler.addSignalListener(signals[i], binding);\n        }\n    }\n    unbind(flags, scope, binding) {\n        const locator = binding.locator;\n        const converter = locator.get(this.converterKey);\n        const signals = converter.signals;\n        if (signals === void 0) {\n            return;\n        }\n        const signaler = locator.get(ISignaler);\n        for (let i = 0, ii = signals.length; i < ii; ++i) {\n            signaler.removeSignalListener(signals[i], binding);\n        }\n    }\n    accept(visitor) {\n        return visitor.visitValueConverter(this);\n    }\n}\nexport class AssignExpression {\n    constructor(target, value) {\n        this.target = target;\n        this.value = value;\n        this.$kind = 8208 /* Assign */;\n    }\n    evaluate(flags, scope, locator, part) {\n        return this.target.assign(flags, scope, locator, this.value.evaluate(flags, scope, locator), part);\n    }\n    connect(flags, scope, binding, part) {\n        return;\n    }\n    assign(flags, scope, locator, value, part) {\n        this.value.assign(flags, scope, locator, value, part);\n        return this.target.assign(flags, scope, locator, value, part);\n    }\n    accept(visitor) {\n        return visitor.visitAssign(this);\n    }\n}\nexport class ConditionalExpression {\n    constructor(condition, yes, no) {\n        this.condition = condition;\n        this.yes = yes;\n        this.no = no;\n        this.$kind = 63 /* Conditional */;\n    }\n    evaluate(flags, scope, locator, part) {\n        return (!!this.condition.evaluate(flags, scope, locator, part))\n            ? this.yes.evaluate(flags, scope, locator, part)\n            : this.no.evaluate(flags, scope, locator, part);\n    }\n    assign(flags, scope, locator, obj, part) {\n        return void 0;\n    }\n    connect(flags, scope, binding, part) {\n        const condition = this.condition;\n        if (condition.evaluate(flags, scope, null, part)) {\n            this.condition.connect(flags, scope, binding, part);\n            this.yes.connect(flags, scope, binding, part);\n        }\n        else {\n            this.condition.connect(flags, scope, binding, part);\n            this.no.connect(flags, scope, binding, part);\n        }\n    }\n    accept(visitor) {\n        return visitor.visitConditional(this);\n    }\n}\nexport class AccessThisExpression {\n    constructor(ancestor = 0) {\n        this.ancestor = ancestor;\n        this.$kind = 1793 /* AccessThis */;\n    }\n    evaluate(flags, scope, locator, part) {\n        if (scope == null) {\n            throw Reporter.error(250 /* NilScope */, this);\n        }\n        if ((flags & 67108864 /* allowParentScopeTraversal */) > 0) {\n            let parent = scope.parentScope;\n            while (parent !== null) {\n                if (!parent.scopeParts.includes(part)) {\n                    parent = parent.parentScope;\n                }\n            }\n            if (parent === null) {\n                throw new Error(`No target scope cold be found for part \"${part}\"`);\n            }\n        }\n        let oc = scope.overrideContext;\n        let i = this.ancestor;\n        while (i-- && oc) {\n            oc = oc.parentOverrideContext;\n        }\n        return i < 1 && oc ? oc.bindingContext : void 0;\n    }\n    assign(flags, scope, locator, obj, part) {\n        return void 0;\n    }\n    connect(flags, scope, binding, part) {\n        return;\n    }\n    accept(visitor) {\n        return visitor.visitAccessThis(this);\n    }\n}\nAccessThisExpression.$this = new AccessThisExpression(0);\nAccessThisExpression.$parent = new AccessThisExpression(1);\nexport class AccessScopeExpression {\n    constructor(name, ancestor = 0) {\n        this.name = name;\n        this.ancestor = ancestor;\n        this.$kind = 10082 /* AccessScope */;\n    }\n    evaluate(flags, scope, locator, part) {\n        const obj = BindingContext.get(scope, this.name, this.ancestor, flags, part);\n        const evaluatedValue = obj[this.name];\n        if (flags & 4 /* isStrictBindingStrategy */) {\n            return evaluatedValue;\n        }\n        return evaluatedValue == null ? '' : evaluatedValue;\n    }\n    assign(flags, scope, locator, value, part) {\n        const obj = BindingContext.get(scope, this.name, this.ancestor, flags, part);\n        if (obj instanceof Object) {\n            if (obj.$observers !== void 0 && obj.$observers[this.name] !== void 0) {\n                obj.$observers[this.name].setValue(value, flags);\n                return value;\n            }\n            else {\n                return obj[this.name] = value;\n            }\n        }\n        return void 0;\n    }\n    connect(flags, scope, binding, part) {\n        const context = BindingContext.get(scope, this.name, this.ancestor, flags, part);\n        binding.observeProperty(flags, context, this.name);\n    }\n    accept(visitor) {\n        return visitor.visitAccessScope(this);\n    }\n}\nexport class AccessMemberExpression {\n    constructor(object, name) {\n        this.object = object;\n        this.name = name;\n        this.$kind = 9323 /* AccessMember */;\n    }\n    evaluate(flags, scope, locator, part) {\n        const instance = this.object.evaluate(flags, scope, locator, part);\n        if (flags & 4 /* isStrictBindingStrategy */) {\n            return instance == null ? instance : instance[this.name];\n        }\n        return instance ? instance[this.name] : '';\n    }\n    assign(flags, scope, locator, value, part) {\n        const obj = this.object.evaluate(flags, scope, locator, part);\n        if (obj instanceof Object) {\n            if (obj.$observers !== void 0 && obj.$observers[this.name] !== void 0) {\n                obj.$observers[this.name].setValue(value, flags);\n            }\n            else {\n                obj[this.name] = value;\n            }\n        }\n        else {\n            this.object.assign(flags, scope, locator, { [this.name]: value });\n        }\n        return value;\n    }\n    connect(flags, scope, binding, part) {\n        const obj = this.object.evaluate(flags, scope, null, part);\n        if ((flags & 134217728 /* observeLeafPropertiesOnly */) === 0) {\n            this.object.connect(flags, scope, binding, part);\n        }\n        if (obj instanceof Object) {\n            binding.observeProperty(flags, obj, this.name);\n        }\n    }\n    accept(visitor) {\n        return visitor.visitAccessMember(this);\n    }\n}\nexport class AccessKeyedExpression {\n    constructor(object, key) {\n        this.object = object;\n        this.key = key;\n        this.$kind = 9324 /* AccessKeyed */;\n    }\n    evaluate(flags, scope, locator, part) {\n        const instance = this.object.evaluate(flags, scope, locator, part);\n        if (instance instanceof Object) {\n            const key = this.key.evaluate(flags, scope, locator, part);\n            return instance[key];\n        }\n        return void 0;\n    }\n    assign(flags, scope, locator, value, part) {\n        const instance = this.object.evaluate(flags, scope, locator, part);\n        const key = this.key.evaluate(flags, scope, locator, part);\n        return instance[key] = value;\n    }\n    connect(flags, scope, binding, part) {\n        const obj = this.object.evaluate(flags, scope, null, part);\n        if ((flags & 134217728 /* observeLeafPropertiesOnly */) === 0) {\n            this.object.connect(flags, scope, binding, part);\n        }\n        if (obj instanceof Object) {\n            this.key.connect(flags, scope, binding, part);\n            const key = this.key.evaluate(flags, scope, null, part);\n            // (note: string indexers behave the same way as numeric indexers as long as they represent numbers)\n            binding.observeProperty(flags, obj, key);\n        }\n    }\n    accept(visitor) {\n        return visitor.visitAccessKeyed(this);\n    }\n}\nexport class CallScopeExpression {\n    constructor(name, args, ancestor = 0) {\n        this.name = name;\n        this.args = args;\n        this.ancestor = ancestor;\n        this.$kind = 1448 /* CallScope */;\n    }\n    evaluate(flags, scope, locator, part) {\n        const args = evalList(flags, scope, locator, this.args, part);\n        const context = BindingContext.get(scope, this.name, this.ancestor, flags, part);\n        const func = getFunction(flags, context, this.name);\n        if (func) {\n            return func.apply(context, args);\n        }\n        return void 0;\n    }\n    assign(flags, scope, locator, obj, part) {\n        return void 0;\n    }\n    connect(flags, scope, binding, part) {\n        const args = this.args;\n        for (let i = 0, ii = args.length; i < ii; ++i) {\n            args[i].connect(flags, scope, binding, part);\n        }\n    }\n    accept(visitor) {\n        return visitor.visitCallScope(this);\n    }\n}\nexport class CallMemberExpression {\n    constructor(object, name, args) {\n        this.object = object;\n        this.name = name;\n        this.args = args;\n        this.$kind = 1161 /* CallMember */;\n    }\n    evaluate(flags, scope, locator, part) {\n        const instance = this.object.evaluate(flags, scope, locator, part);\n        const args = evalList(flags, scope, locator, this.args, part);\n        const func = getFunction(flags, instance, this.name);\n        if (func) {\n            return func.apply(instance, args);\n        }\n        return void 0;\n    }\n    assign(flags, scope, locator, obj, part) {\n        return void 0;\n    }\n    connect(flags, scope, binding, part) {\n        const obj = this.object.evaluate(flags, scope, null, part);\n        if ((flags & 134217728 /* observeLeafPropertiesOnly */) === 0) {\n            this.object.connect(flags, scope, binding, part);\n        }\n        if (getFunction(flags & ~2097152 /* mustEvaluate */, obj, this.name)) {\n            const args = this.args;\n            for (let i = 0, ii = args.length; i < ii; ++i) {\n                args[i].connect(flags, scope, binding, part);\n            }\n        }\n    }\n    accept(visitor) {\n        return visitor.visitCallMember(this);\n    }\n}\nexport class CallFunctionExpression {\n    constructor(func, args) {\n        this.func = func;\n        this.args = args;\n        this.$kind = 1162 /* CallFunction */;\n    }\n    evaluate(flags, scope, locator, part) {\n        const func = this.func.evaluate(flags, scope, locator, part);\n        if (typeof func === 'function') {\n            return func(...evalList(flags, scope, locator, this.args, part));\n        }\n        if (!(flags & 2097152 /* mustEvaluate */) && (func == null)) {\n            return void 0;\n        }\n        throw Reporter.error(207 /* NotAFunction */, this);\n    }\n    assign(flags, scope, locator, obj, part) {\n        return void 0;\n    }\n    connect(flags, scope, binding, part) {\n        const func = this.func.evaluate(flags, scope, null, part);\n        this.func.connect(flags, scope, binding, part);\n        if (typeof func === 'function') {\n            const args = this.args;\n            for (let i = 0, ii = args.length; i < ii; ++i) {\n                args[i].connect(flags, scope, binding, part);\n            }\n        }\n    }\n    accept(visitor) {\n        return visitor.visitCallFunction(this);\n    }\n}\nexport class BinaryExpression {\n    constructor(operation, left, right) {\n        this.operation = operation;\n        this.left = left;\n        this.right = right;\n        this.$kind = 46 /* Binary */;\n        // what we're doing here is effectively moving the large switch statement from evaluate to the constructor\n        // so that the check only needs to be done once, and evaluate (which is called many times) will have a lot less\n        // work to do; we can do this because the operation can't change after it's parsed\n        this.evaluate = this[operation];\n    }\n    evaluate(flags, scope, locator, part) {\n        throw Reporter.error(208 /* UnknownOperator */, this);\n    }\n    assign(flags, scope, locator, obj, part) {\n        return void 0;\n    }\n    connect(flags, scope, binding, part) {\n        this.left.connect(flags, scope, binding, part);\n        this.right.connect(flags, scope, binding, part);\n    }\n    ['&&'](f, s, l, p) {\n        return this.left.evaluate(f, s, l, p) && this.right.evaluate(f, s, l, p);\n    }\n    ['||'](f, s, l, p) {\n        return this.left.evaluate(f, s, l, p) || this.right.evaluate(f, s, l, p);\n    }\n    ['=='](f, s, l, p) {\n        // eslint-disable-next-line eqeqeq\n        return this.left.evaluate(f, s, l, p) == this.right.evaluate(f, s, l, p);\n    }\n    ['==='](f, s, l, p) {\n        return this.left.evaluate(f, s, l, p) === this.right.evaluate(f, s, l, p);\n    }\n    ['!='](f, s, l, p) {\n        // eslint-disable-next-line eqeqeq\n        return this.left.evaluate(f, s, l, p) != this.right.evaluate(f, s, l, p);\n    }\n    ['!=='](f, s, l, p) {\n        return this.left.evaluate(f, s, l, p) !== this.right.evaluate(f, s, l, p);\n    }\n    ['instanceof'](f, s, l, p) {\n        const right = this.right.evaluate(f, s, l, p);\n        if (typeof right === 'function') {\n            return this.left.evaluate(f, s, l, p) instanceof right;\n        }\n        return false;\n    }\n    ['in'](f, s, l, p) {\n        const right = this.right.evaluate(f, s, l, p);\n        if (right instanceof Object) {\n            return this.left.evaluate(f, s, l, p) in right;\n        }\n        return false;\n    }\n    // note: autoConvertAdd (and the null check) is removed because the default spec behavior is already largely similar\n    // and where it isn't, you kind of want it to behave like the spec anyway (e.g. return NaN when adding a number to undefined)\n    // this makes bugs in user code easier to track down for end users\n    // also, skipping these checks and leaving it to the runtime is a nice little perf boost and simplifies our code\n    ['+'](f, s, l, p) {\n        const left = this.left.evaluate(f, s, l, p);\n        const right = this.right.evaluate(f, s, l, p);\n        if ((f & 4 /* isStrictBindingStrategy */) > 0) {\n            return left + right;\n        }\n        // eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n        if (!left || !right) {\n            if (isNumberOrBigInt(left) || isNumberOrBigInt(right)) {\n                // eslint-disable-next-line @typescript-eslint/strict-boolean-expressions, @typescript-eslint/no-unnecessary-condition\n                return (left || 0) + (right || 0);\n            }\n            if (isStringOrDate(left) || isStringOrDate(right)) {\n                // eslint-disable-next-line @typescript-eslint/strict-boolean-expressions, @typescript-eslint/no-unnecessary-condition\n                return (left || '') + (right || '');\n            }\n        }\n        return left + right;\n    }\n    ['-'](f, s, l, p) {\n        return this.left.evaluate(f, s, l, p) - this.right.evaluate(f, s, l, p);\n    }\n    ['*'](f, s, l, p) {\n        return this.left.evaluate(f, s, l, p) * this.right.evaluate(f, s, l, p);\n    }\n    ['/'](f, s, l, p) {\n        return this.left.evaluate(f, s, l, p) / this.right.evaluate(f, s, l, p);\n    }\n    ['%'](f, s, l, p) {\n        return this.left.evaluate(f, s, l, p) % this.right.evaluate(f, s, l, p);\n    }\n    ['<'](f, s, l, p) {\n        return this.left.evaluate(f, s, l, p) < this.right.evaluate(f, s, l, p);\n    }\n    ['>'](f, s, l, p) {\n        return this.left.evaluate(f, s, l, p) > this.right.evaluate(f, s, l, p);\n    }\n    ['<='](f, s, l, p) {\n        return this.left.evaluate(f, s, l, p) <= this.right.evaluate(f, s, l, p);\n    }\n    ['>='](f, s, l, p) {\n        return this.left.evaluate(f, s, l, p) >= this.right.evaluate(f, s, l, p);\n    }\n    accept(visitor) {\n        return visitor.visitBinary(this);\n    }\n}\nexport class UnaryExpression {\n    constructor(operation, expression) {\n        this.operation = operation;\n        this.expression = expression;\n        this.$kind = 39 /* Unary */;\n        // see Binary (we're doing the same thing here)\n        this.evaluate = this[operation];\n    }\n    evaluate(flags, scope, locator, part) {\n        throw Reporter.error(208 /* UnknownOperator */, this);\n    }\n    assign(flags, scope, locator, obj, part) {\n        return void 0;\n    }\n    connect(flags, scope, binding, part) {\n        this.expression.connect(flags, scope, binding, part);\n    }\n    ['void'](f, s, l, p) {\n        return void this.expression.evaluate(f, s, l, p);\n    }\n    ['typeof'](f, s, l, p) {\n        return typeof this.expression.evaluate(f | 4 /* isStrictBindingStrategy */, s, l, p);\n    }\n    ['!'](f, s, l, p) {\n        return !this.expression.evaluate(f, s, l, p);\n    }\n    ['-'](f, s, l, p) {\n        return -this.expression.evaluate(f, s, l, p);\n    }\n    ['+'](f, s, l, p) {\n        return +this.expression.evaluate(f, s, l, p);\n    }\n    accept(visitor) {\n        return visitor.visitUnary(this);\n    }\n}\nexport class PrimitiveLiteralExpression {\n    constructor(value) {\n        this.value = value;\n        this.$kind = 17925 /* PrimitiveLiteral */;\n    }\n    evaluate(flags, scope, locator, part) {\n        return this.value;\n    }\n    assign(flags, scope, locator, obj, part) {\n        return void 0;\n    }\n    connect(flags, scope, binding, part) {\n        return;\n    }\n    accept(visitor) {\n        return visitor.visitPrimitiveLiteral(this);\n    }\n}\nPrimitiveLiteralExpression.$undefined = new PrimitiveLiteralExpression(void 0);\nPrimitiveLiteralExpression.$null = new PrimitiveLiteralExpression(null);\nPrimitiveLiteralExpression.$true = new PrimitiveLiteralExpression(true);\nPrimitiveLiteralExpression.$false = new PrimitiveLiteralExpression(false);\nPrimitiveLiteralExpression.$empty = new PrimitiveLiteralExpression('');\nexport class HtmlLiteralExpression {\n    constructor(parts) {\n        this.parts = parts;\n        this.$kind = 51 /* HtmlLiteral */;\n    }\n    evaluate(flags, scope, locator, part) {\n        const elements = this.parts;\n        let result = '';\n        let value;\n        for (let i = 0, ii = elements.length; i < ii; ++i) {\n            value = elements[i].evaluate(flags, scope, locator, part);\n            if (value == null) {\n                continue;\n            }\n            result += value;\n        }\n        return result;\n    }\n    assign(flags, scope, locator, obj, part) {\n        return void 0;\n    }\n    connect(flags, scope, binding, part) {\n        for (let i = 0, ii = this.parts.length; i < ii; ++i) {\n            this.parts[i].connect(flags, scope, binding, part);\n        }\n    }\n    accept(visitor) {\n        return visitor.visitHtmlLiteral(this);\n    }\n}\nexport class ArrayLiteralExpression {\n    constructor(elements) {\n        this.elements = elements;\n        this.$kind = 17955 /* ArrayLiteral */;\n    }\n    evaluate(flags, scope, locator, part) {\n        const elements = this.elements;\n        const length = elements.length;\n        const result = Array(length);\n        for (let i = 0; i < length; ++i) {\n            result[i] = elements[i].evaluate(flags, scope, locator, part);\n        }\n        return result;\n    }\n    assign(flags, scope, locator, obj, part) {\n        return void 0;\n    }\n    connect(flags, scope, binding, part) {\n        const elements = this.elements;\n        for (let i = 0, ii = elements.length; i < ii; ++i) {\n            elements[i].connect(flags, scope, binding, part);\n        }\n    }\n    accept(visitor) {\n        return visitor.visitArrayLiteral(this);\n    }\n}\nArrayLiteralExpression.$empty = new ArrayLiteralExpression(PLATFORM.emptyArray);\nexport class ObjectLiteralExpression {\n    constructor(keys, values) {\n        this.keys = keys;\n        this.values = values;\n        this.$kind = 17956 /* ObjectLiteral */;\n    }\n    evaluate(flags, scope, locator, part) {\n        const instance = {};\n        const keys = this.keys;\n        const values = this.values;\n        for (let i = 0, ii = keys.length; i < ii; ++i) {\n            instance[keys[i]] = values[i].evaluate(flags, scope, locator, part);\n        }\n        return instance;\n    }\n    assign(flags, scope, locator, obj, part) {\n        return void 0;\n    }\n    connect(flags, scope, binding, part) {\n        const keys = this.keys;\n        const values = this.values;\n        for (let i = 0, ii = keys.length; i < ii; ++i) {\n            values[i].connect(flags, scope, binding, part);\n        }\n    }\n    accept(visitor) {\n        return visitor.visitObjectLiteral(this);\n    }\n}\nObjectLiteralExpression.$empty = new ObjectLiteralExpression(PLATFORM.emptyArray, PLATFORM.emptyArray);\nexport class TemplateExpression {\n    constructor(cooked, expressions = PLATFORM.emptyArray) {\n        this.cooked = cooked;\n        this.expressions = expressions;\n        this.$kind = 17958 /* Template */;\n    }\n    evaluate(flags, scope, locator, part) {\n        const expressions = this.expressions;\n        const cooked = this.cooked;\n        let result = cooked[0];\n        for (let i = 0, ii = expressions.length; i < ii; ++i) {\n            result += expressions[i].evaluate(flags, scope, locator, part);\n            result += cooked[i + 1];\n        }\n        return result;\n    }\n    assign(flags, scope, locator, obj, part) {\n        return void 0;\n    }\n    connect(flags, scope, binding, part) {\n        const expressions = this.expressions;\n        for (let i = 0, ii = expressions.length; i < ii; ++i) {\n            expressions[i].connect(flags, scope, binding, part);\n            i++;\n        }\n    }\n    accept(visitor) {\n        return visitor.visitTemplate(this);\n    }\n}\nTemplateExpression.$empty = new TemplateExpression(['']);\nexport class TaggedTemplateExpression {\n    constructor(cooked, raw, func, expressions = PLATFORM.emptyArray) {\n        this.cooked = cooked;\n        this.func = func;\n        this.expressions = expressions;\n        this.$kind = 1197 /* TaggedTemplate */;\n        cooked.raw = raw;\n    }\n    evaluate(flags, scope, locator, part) {\n        const expressions = this.expressions;\n        const len = expressions.length;\n        const results = Array(len);\n        for (let i = 0, ii = len; i < ii; ++i) {\n            results[i] = expressions[i].evaluate(flags, scope, locator, part);\n        }\n        const func = this.func.evaluate(flags, scope, locator, part);\n        if (typeof func !== 'function') {\n            throw Reporter.error(207 /* NotAFunction */, this);\n        }\n        return func(this.cooked, ...results);\n    }\n    assign(flags, scope, locator, obj, part) {\n        return void 0;\n    }\n    connect(flags, scope, binding, part) {\n        const expressions = this.expressions;\n        for (let i = 0, ii = expressions.length; i < ii; ++i) {\n            expressions[i].connect(flags, scope, binding);\n        }\n        this.func.connect(flags, scope, binding);\n    }\n    accept(visitor) {\n        return visitor.visitTaggedTemplate(this);\n    }\n}\nexport class ArrayBindingPattern {\n    // We'll either have elements, or keys+values, but never all 3\n    constructor(elements) {\n        this.elements = elements;\n        this.$kind = 65556 /* ArrayBindingPattern */;\n    }\n    evaluate(flags, scope, locator, part) {\n        // TODO\n        return void 0;\n    }\n    assign(flags, scope, locator, obj, part) {\n        // TODO\n        return void 0;\n    }\n    connect(flags, scope, binding, part) {\n        return;\n    }\n    accept(visitor) {\n        return visitor.visitArrayBindingPattern(this);\n    }\n}\nexport class ObjectBindingPattern {\n    // We'll either have elements, or keys+values, but never all 3\n    constructor(keys, values) {\n        this.keys = keys;\n        this.values = values;\n        this.$kind = 65557 /* ObjectBindingPattern */;\n    }\n    evaluate(flags, scope, locator, part) {\n        // TODO\n        return void 0;\n    }\n    assign(flags, scope, locator, obj, part) {\n        // TODO\n        return void 0;\n    }\n    connect(flags, scope, binding, part) {\n        return;\n    }\n    accept(visitor) {\n        return visitor.visitObjectBindingPattern(this);\n    }\n}\nexport class BindingIdentifier {\n    constructor(name) {\n        this.name = name;\n        this.$kind = 65558 /* BindingIdentifier */;\n    }\n    evaluate(flags, scope, locator, part) {\n        return this.name;\n    }\n    connect(flags, scope, binding, part) {\n        return;\n    }\n    accept(visitor) {\n        return visitor.visitBindingIdentifier(this);\n    }\n}\nconst toStringTag = Object.prototype.toString;\n// https://tc39.github.io/ecma262/#sec-iteration-statements\n// https://tc39.github.io/ecma262/#sec-for-in-and-for-of-statements\nexport class ForOfStatement {\n    constructor(declaration, iterable) {\n        this.declaration = declaration;\n        this.iterable = iterable;\n        this.$kind = 6199 /* ForOfStatement */;\n    }\n    evaluate(flags, scope, locator, part) {\n        return this.iterable.evaluate(flags, scope, locator, part);\n    }\n    assign(flags, scope, locator, obj, part) {\n        return void 0;\n    }\n    count(flags, result) {\n        switch (toStringTag.call(result)) {\n            case '[object Array]': return result.length;\n            case '[object Map]': return result.size;\n            case '[object Set]': return result.size;\n            case '[object Number]': return result;\n            case '[object Null]': return 0;\n            case '[object Undefined]': return 0;\n            default: throw Reporter.error(0); // TODO: Set error code\n        }\n    }\n    iterate(flags, result, func) {\n        switch (toStringTag.call(result)) {\n            case '[object Array]': return $array(flags | 8388608 /* isOriginalArray */, result, func);\n            case '[object Map]': return $map(flags | 8388608 /* isOriginalArray */, result, func);\n            case '[object Set]': return $set(flags | 8388608 /* isOriginalArray */, result, func);\n            case '[object Number]': return $number(flags | 8388608 /* isOriginalArray */, result, func);\n            case '[object Null]': return;\n            case '[object Undefined]': return;\n            default: throw Reporter.error(0); // TODO: Set error code\n        }\n    }\n    connect(flags, scope, binding, part) {\n        this.declaration.connect(flags, scope, binding, part);\n        this.iterable.connect(flags, scope, binding, part);\n    }\n    bind(flags, scope, binding) {\n        if (hasBind(this.iterable)) {\n            this.iterable.bind(flags, scope, binding);\n        }\n    }\n    unbind(flags, scope, binding) {\n        if (hasUnbind(this.iterable)) {\n            this.iterable.unbind(flags, scope, binding);\n        }\n    }\n    accept(visitor) {\n        return visitor.visitForOfStatement(this);\n    }\n}\n/*\n* Note: this implementation is far simpler than the one in vCurrent and might be missing important stuff (not sure yet)\n* so while this implementation is identical to Template and we could reuse that one, we don't want to lock outselves in to potentially the wrong abstraction\n* but this class might be a candidate for removal if it turns out it does provide all we need\n*/\nexport class Interpolation {\n    constructor(parts, expressions = PLATFORM.emptyArray) {\n        this.parts = parts;\n        this.expressions = expressions;\n        this.$kind = 24 /* Interpolation */;\n        this.isMulti = expressions.length > 1;\n        this.firstExpression = expressions[0];\n    }\n    evaluate(flags, scope, locator, part) {\n        if (this.isMulti) {\n            const expressions = this.expressions;\n            const parts = this.parts;\n            let result = parts[0];\n            for (let i = 0, ii = expressions.length; i < ii; ++i) {\n                result += expressions[i].evaluate(flags, scope, locator, part);\n                result += parts[i + 1];\n            }\n            return result;\n        }\n        else {\n            const parts = this.parts;\n            return `${parts[0]}${this.firstExpression.evaluate(flags, scope, locator, part)}${parts[1]}`;\n        }\n    }\n    assign(flags, scope, locator, obj, part) {\n        return void 0;\n    }\n    connect(flags, scope, binding, part) {\n        return;\n    }\n    accept(visitor) {\n        return visitor.visitInterpolation(this);\n    }\n}\n/// Evaluate the [list] in context of the [scope].\nfunction evalList(flags, scope, locator, list, part) {\n    const len = list.length;\n    const result = Array(len);\n    for (let i = 0; i < len; ++i) {\n        result[i] = list[i].evaluate(flags, scope, locator, part);\n    }\n    return result;\n}\nfunction getFunction(flags, obj, name) {\n    const func = obj == null ? null : obj[name];\n    if (typeof func === 'function') {\n        return func;\n    }\n    if (!(flags & 2097152 /* mustEvaluate */) && func == null) {\n        return null;\n    }\n    throw Reporter.error(207 /* NotAFunction */, obj, name, func);\n}\nconst proxyAndOriginalArray = 2 /* proxyStrategy */ | 8388608 /* isOriginalArray */;\nfunction $array(flags, result, func) {\n    if ((flags & proxyAndOriginalArray) === proxyAndOriginalArray) {\n        // If we're in proxy mode, and the array is the original \"items\" (and not an array we created here to iterate over e.g. a set)\n        // then replace all items (which are Objects) with proxies so their properties are observed in the source view model even if no\n        // observers are explicitly created\n        const rawArray = ProxyObserver.getRawIfProxy(result);\n        const len = rawArray.length;\n        let item;\n        let i = 0;\n        for (; i < len; ++i) {\n            item = rawArray[i];\n            if (item instanceof Object) {\n                item = rawArray[i] = ProxyObserver.getOrCreate(item).proxy;\n            }\n            func(rawArray, i, item);\n        }\n    }\n    else {\n        for (let i = 0, ii = result.length; i < ii; ++i) {\n            func(result, i, result[i]);\n        }\n    }\n}\nfunction $map(flags, result, func) {\n    const arr = Array(result.size);\n    let i = -1;\n    for (const entry of result.entries()) {\n        arr[++i] = entry;\n    }\n    $array(flags & ~8388608 /* isOriginalArray */, arr, func);\n}\nfunction $set(flags, result, func) {\n    const arr = Array(result.size);\n    let i = -1;\n    for (const key of result.keys()) {\n        arr[++i] = key;\n    }\n    $array(flags & ~8388608 /* isOriginalArray */, arr, func);\n}\nfunction $number(flags, result, func) {\n    const arr = Array(result);\n    for (let i = 0; i < result; ++i) {\n        arr[i] = i;\n    }\n    $array(flags & ~8388608 /* isOriginalArray */, arr, func);\n}\n//# sourceMappingURL=ast.js.map","/*\n* Note: the oneTime binding now has a non-zero value for 2 reasons:\n*  - plays nicer with bitwise operations (more consistent code, more explicit settings)\n*  - allows for potentially having something like BindingMode.oneTime | BindingMode.fromView, where an initial value is set once to the view but updates from the view also propagate back to the view model\n*\n* Furthermore, the \"default\" mode would be for simple \".bind\" expressions to make it explicit for our logic that the default is being used.\n* This essentially adds extra information which binding could use to do smarter things and allows bindingBehaviors that add a mode instead of simply overwriting it\n*/\nexport var BindingMode;\n(function (BindingMode) {\n    BindingMode[BindingMode[\"oneTime\"] = 1] = \"oneTime\";\n    BindingMode[BindingMode[\"toView\"] = 2] = \"toView\";\n    BindingMode[BindingMode[\"fromView\"] = 4] = \"fromView\";\n    BindingMode[BindingMode[\"twoWay\"] = 6] = \"twoWay\";\n    BindingMode[BindingMode[\"default\"] = 8] = \"default\";\n})(BindingMode || (BindingMode = {}));\nexport var BindingStrategy;\n(function (BindingStrategy) {\n    /**\n     * Configures all components \"below\" this one to operate in getterSetter binding mode.\n     * This is the default; if no strategy is specified, this one is implied.\n     *\n     * This strategy is the most compatible, convenient and has the best performance on frequently updated bindings on components that are infrequently replaced.\n     * However, it also consumes the most resources on initialization.\n     */\n    BindingStrategy[BindingStrategy[\"getterSetter\"] = 1] = \"getterSetter\";\n    /**\n     * Configures all components \"below\" this one to operate in proxy binding mode.\n     * No getters/setters are created.\n     *\n     * This strategy consumes significantly fewer resources than `getterSetter` on initialization and has the best performance on infrequently updated bindings on\n     * components that are frequently replaced.\n     * However, it consumes more resources on updates.\n     */\n    BindingStrategy[BindingStrategy[\"proxies\"] = 2] = \"proxies\";\n})(BindingStrategy || (BindingStrategy = {}));\nconst mandatoryStrategy = 1 /* getterSetter */ | 2 /* proxies */;\nexport function ensureValidStrategy(strategy) {\n    if ((strategy & mandatoryStrategy) === 0) {\n        // TODO: probably want to validate that user isn't trying to mix getterSetter/proxy\n        // TODO: also need to make sure that strategy can be changed away from proxies inside the component tree (not here though, but just making a note)\n        return strategy | 1 /* getterSetter */;\n    }\n    return strategy;\n}\nexport var State;\n(function (State) {\n    State[State[\"none\"] = 0] = \"none\";\n    State[State[\"isBinding\"] = 1] = \"isBinding\";\n    State[State[\"isUnbinding\"] = 2] = \"isUnbinding\";\n    State[State[\"isBound\"] = 4] = \"isBound\";\n    State[State[\"isBoundOrBinding\"] = 5] = \"isBoundOrBinding\";\n    State[State[\"isBoundOrUnbinding\"] = 6] = \"isBoundOrUnbinding\";\n    State[State[\"isAttaching\"] = 8] = \"isAttaching\";\n    State[State[\"isDetaching\"] = 16] = \"isDetaching\";\n    State[State[\"isAttached\"] = 32] = \"isAttached\";\n    State[State[\"isAttachedOrAttaching\"] = 40] = \"isAttachedOrAttaching\";\n    State[State[\"isAttachedOrDetaching\"] = 48] = \"isAttachedOrDetaching\";\n    State[State[\"isMounted\"] = 64] = \"isMounted\";\n    State[State[\"hasLockedScope\"] = 256] = \"hasLockedScope\";\n    State[State[\"canBeCached\"] = 512] = \"canBeCached\";\n})(State || (State = {}));\nexport var LifecycleFlags;\n(function (LifecycleFlags) {\n    LifecycleFlags[LifecycleFlags[\"none\"] = 0] = \"none\";\n    // Bitmask for flags that need to be stored on a binding during $bind for mutation\n    // callbacks outside of $bind\n    LifecycleFlags[LifecycleFlags[\"persistentBindingFlags\"] = 2080374799] = \"persistentBindingFlags\";\n    LifecycleFlags[LifecycleFlags[\"allowParentScopeTraversal\"] = 67108864] = \"allowParentScopeTraversal\";\n    LifecycleFlags[LifecycleFlags[\"observeLeafPropertiesOnly\"] = 134217728] = \"observeLeafPropertiesOnly\";\n    LifecycleFlags[LifecycleFlags[\"targetObserverFlags\"] = 805306383] = \"targetObserverFlags\";\n    LifecycleFlags[LifecycleFlags[\"noTargetObserverQueue\"] = 268435456] = \"noTargetObserverQueue\";\n    LifecycleFlags[LifecycleFlags[\"persistentTargetObserverQueue\"] = 536870912] = \"persistentTargetObserverQueue\";\n    LifecycleFlags[LifecycleFlags[\"secondaryExpression\"] = 1073741824] = \"secondaryExpression\";\n    LifecycleFlags[LifecycleFlags[\"bindingStrategy\"] = 15] = \"bindingStrategy\";\n    LifecycleFlags[LifecycleFlags[\"getterSetterStrategy\"] = 1] = \"getterSetterStrategy\";\n    LifecycleFlags[LifecycleFlags[\"proxyStrategy\"] = 2] = \"proxyStrategy\";\n    LifecycleFlags[LifecycleFlags[\"isStrictBindingStrategy\"] = 4] = \"isStrictBindingStrategy\";\n    LifecycleFlags[LifecycleFlags[\"update\"] = 48] = \"update\";\n    LifecycleFlags[LifecycleFlags[\"updateTargetInstance\"] = 16] = \"updateTargetInstance\";\n    LifecycleFlags[LifecycleFlags[\"updateSourceExpression\"] = 32] = \"updateSourceExpression\";\n    LifecycleFlags[LifecycleFlags[\"from\"] = 524224] = \"from\";\n    LifecycleFlags[LifecycleFlags[\"fromFlush\"] = 960] = \"fromFlush\";\n    LifecycleFlags[LifecycleFlags[\"fromAsyncFlush\"] = 64] = \"fromAsyncFlush\";\n    LifecycleFlags[LifecycleFlags[\"fromSyncFlush\"] = 128] = \"fromSyncFlush\";\n    LifecycleFlags[LifecycleFlags[\"fromTick\"] = 256] = \"fromTick\";\n    LifecycleFlags[LifecycleFlags[\"fromBatch\"] = 512] = \"fromBatch\";\n    LifecycleFlags[LifecycleFlags[\"fromStartTask\"] = 1024] = \"fromStartTask\";\n    LifecycleFlags[LifecycleFlags[\"fromStopTask\"] = 2048] = \"fromStopTask\";\n    LifecycleFlags[LifecycleFlags[\"fromBind\"] = 4096] = \"fromBind\";\n    LifecycleFlags[LifecycleFlags[\"fromUnbind\"] = 8192] = \"fromUnbind\";\n    LifecycleFlags[LifecycleFlags[\"fromAttach\"] = 16384] = \"fromAttach\";\n    LifecycleFlags[LifecycleFlags[\"fromDetach\"] = 32768] = \"fromDetach\";\n    LifecycleFlags[LifecycleFlags[\"fromCache\"] = 65536] = \"fromCache\";\n    LifecycleFlags[LifecycleFlags[\"fromDOMEvent\"] = 131072] = \"fromDOMEvent\";\n    LifecycleFlags[LifecycleFlags[\"fromLifecycleTask\"] = 262144] = \"fromLifecycleTask\";\n    LifecycleFlags[LifecycleFlags[\"allowPublishRoundtrip\"] = 524288] = \"allowPublishRoundtrip\";\n    LifecycleFlags[LifecycleFlags[\"isPublishing\"] = 1048576] = \"isPublishing\";\n    LifecycleFlags[LifecycleFlags[\"mustEvaluate\"] = 2097152] = \"mustEvaluate\";\n    LifecycleFlags[LifecycleFlags[\"isTraversingParentScope\"] = 4194304] = \"isTraversingParentScope\";\n    LifecycleFlags[LifecycleFlags[\"isOriginalArray\"] = 8388608] = \"isOriginalArray\";\n    LifecycleFlags[LifecycleFlags[\"isCollectionMutation\"] = 16777216] = \"isCollectionMutation\";\n    LifecycleFlags[LifecycleFlags[\"reorderNodes\"] = 33554432] = \"reorderNodes\";\n})(LifecycleFlags || (LifecycleFlags = {}));\nexport var ExpressionKind;\n(function (ExpressionKind) {\n    ExpressionKind[ExpressionKind[\"Connects\"] = 32] = \"Connects\";\n    ExpressionKind[ExpressionKind[\"Observes\"] = 64] = \"Observes\";\n    ExpressionKind[ExpressionKind[\"CallsFunction\"] = 128] = \"CallsFunction\";\n    ExpressionKind[ExpressionKind[\"HasAncestor\"] = 256] = \"HasAncestor\";\n    ExpressionKind[ExpressionKind[\"IsPrimary\"] = 512] = \"IsPrimary\";\n    ExpressionKind[ExpressionKind[\"IsLeftHandSide\"] = 1024] = \"IsLeftHandSide\";\n    ExpressionKind[ExpressionKind[\"HasBind\"] = 2048] = \"HasBind\";\n    ExpressionKind[ExpressionKind[\"HasUnbind\"] = 4096] = \"HasUnbind\";\n    ExpressionKind[ExpressionKind[\"IsAssignable\"] = 8192] = \"IsAssignable\";\n    ExpressionKind[ExpressionKind[\"IsLiteral\"] = 16384] = \"IsLiteral\";\n    ExpressionKind[ExpressionKind[\"IsResource\"] = 32768] = \"IsResource\";\n    ExpressionKind[ExpressionKind[\"IsForDeclaration\"] = 65536] = \"IsForDeclaration\";\n    ExpressionKind[ExpressionKind[\"Type\"] = 31] = \"Type\";\n    // ---------------------------------------------------------------------------------------------------------------------------\n    ExpressionKind[ExpressionKind[\"AccessThis\"] = 1793] = \"AccessThis\";\n    ExpressionKind[ExpressionKind[\"AccessScope\"] = 10082] = \"AccessScope\";\n    ExpressionKind[ExpressionKind[\"ArrayLiteral\"] = 17955] = \"ArrayLiteral\";\n    ExpressionKind[ExpressionKind[\"ObjectLiteral\"] = 17956] = \"ObjectLiteral\";\n    ExpressionKind[ExpressionKind[\"PrimitiveLiteral\"] = 17925] = \"PrimitiveLiteral\";\n    ExpressionKind[ExpressionKind[\"Template\"] = 17958] = \"Template\";\n    ExpressionKind[ExpressionKind[\"Unary\"] = 39] = \"Unary\";\n    ExpressionKind[ExpressionKind[\"CallScope\"] = 1448] = \"CallScope\";\n    ExpressionKind[ExpressionKind[\"CallMember\"] = 1161] = \"CallMember\";\n    ExpressionKind[ExpressionKind[\"CallFunction\"] = 1162] = \"CallFunction\";\n    ExpressionKind[ExpressionKind[\"AccessMember\"] = 9323] = \"AccessMember\";\n    ExpressionKind[ExpressionKind[\"AccessKeyed\"] = 9324] = \"AccessKeyed\";\n    ExpressionKind[ExpressionKind[\"TaggedTemplate\"] = 1197] = \"TaggedTemplate\";\n    ExpressionKind[ExpressionKind[\"Binary\"] = 46] = \"Binary\";\n    ExpressionKind[ExpressionKind[\"Conditional\"] = 63] = \"Conditional\";\n    ExpressionKind[ExpressionKind[\"Assign\"] = 8208] = \"Assign\";\n    ExpressionKind[ExpressionKind[\"ValueConverter\"] = 36913] = \"ValueConverter\";\n    ExpressionKind[ExpressionKind[\"BindingBehavior\"] = 38962] = \"BindingBehavior\";\n    ExpressionKind[ExpressionKind[\"HtmlLiteral\"] = 51] = \"HtmlLiteral\";\n    ExpressionKind[ExpressionKind[\"ArrayBindingPattern\"] = 65556] = \"ArrayBindingPattern\";\n    ExpressionKind[ExpressionKind[\"ObjectBindingPattern\"] = 65557] = \"ObjectBindingPattern\";\n    ExpressionKind[ExpressionKind[\"BindingIdentifier\"] = 65558] = \"BindingIdentifier\";\n    ExpressionKind[ExpressionKind[\"ForOfStatement\"] = 6199] = \"ForOfStatement\";\n    ExpressionKind[ExpressionKind[\"Interpolation\"] = 24] = \"Interpolation\"; //\n})(ExpressionKind || (ExpressionKind = {}));\n//# sourceMappingURL=flags.js.map","/** @internal */\nexport var SubscriberFlags;\n(function (SubscriberFlags) {\n    SubscriberFlags[SubscriberFlags[\"None\"] = 0] = \"None\";\n    SubscriberFlags[SubscriberFlags[\"Subscriber0\"] = 1] = \"Subscriber0\";\n    SubscriberFlags[SubscriberFlags[\"Subscriber1\"] = 2] = \"Subscriber1\";\n    SubscriberFlags[SubscriberFlags[\"Subscriber2\"] = 4] = \"Subscriber2\";\n    SubscriberFlags[SubscriberFlags[\"SubscribersRest\"] = 8] = \"SubscribersRest\";\n    SubscriberFlags[SubscriberFlags[\"Any\"] = 15] = \"Any\";\n})(SubscriberFlags || (SubscriberFlags = {}));\nexport var DelegationStrategy;\n(function (DelegationStrategy) {\n    DelegationStrategy[DelegationStrategy[\"none\"] = 0] = \"none\";\n    DelegationStrategy[DelegationStrategy[\"capturing\"] = 1] = \"capturing\";\n    DelegationStrategy[DelegationStrategy[\"bubbling\"] = 2] = \"bubbling\";\n})(DelegationStrategy || (DelegationStrategy = {}));\nexport var CollectionKind;\n(function (CollectionKind) {\n    CollectionKind[CollectionKind[\"indexed\"] = 8] = \"indexed\";\n    CollectionKind[CollectionKind[\"keyed\"] = 4] = \"keyed\";\n    CollectionKind[CollectionKind[\"array\"] = 9] = \"array\";\n    CollectionKind[CollectionKind[\"map\"] = 6] = \"map\";\n    CollectionKind[CollectionKind[\"set\"] = 7] = \"set\";\n})(CollectionKind || (CollectionKind = {}));\nexport function copyIndexMap(existing, deletedItems) {\n    const { length } = existing;\n    const arr = Array(length);\n    let i = 0;\n    while (i < length) {\n        arr[i] = existing[i];\n        ++i;\n    }\n    if (deletedItems !== void 0) {\n        arr.deletedItems = deletedItems.slice(0);\n    }\n    else if (existing.deletedItems !== void 0) {\n        arr.deletedItems = existing.deletedItems.slice(0);\n    }\n    else {\n        arr.deletedItems = [];\n    }\n    arr.isIndexMap = true;\n    return arr;\n}\nexport function createIndexMap(length = 0) {\n    const arr = Array(length);\n    let i = 0;\n    while (i < length) {\n        arr[i] = i++;\n    }\n    arr.deletedItems = [];\n    arr.isIndexMap = true;\n    return arr;\n}\nexport function cloneIndexMap(indexMap) {\n    const clone = indexMap.slice();\n    clone.deletedItems = indexMap.deletedItems.slice();\n    clone.isIndexMap = true;\n    return clone;\n}\nexport function isIndexMap(value) {\n    return value instanceof Array && value.isIndexMap === true;\n}\n//# sourceMappingURL=observation.js.map","import { __decorate, __metadata } from \"tslib\";\nimport { subscriberCollection } from './subscriber-collection';\nlet CollectionLengthObserver = class CollectionLengthObserver {\n    constructor(obj) {\n        this.obj = obj;\n        this.currentValue = obj.length;\n    }\n    getValue() {\n        return this.obj.length;\n    }\n    setValue(newValue, flags) {\n        const { currentValue } = this;\n        if (newValue !== currentValue) {\n            this.currentValue = newValue;\n            this.callSubscribers(newValue, currentValue, flags | 16 /* updateTargetInstance */);\n        }\n    }\n};\nCollectionLengthObserver = __decorate([\n    subscriberCollection(),\n    __metadata(\"design:paramtypes\", [Array])\n], CollectionLengthObserver);\nexport { CollectionLengthObserver };\n//# sourceMappingURL=collection-length-observer.js.map","import { __decorate, __metadata } from \"tslib\";\nimport { ILifecycle } from '../lifecycle';\nimport { createIndexMap } from '../observation';\nimport { CollectionLengthObserver } from './collection-length-observer';\nimport { collectionSubscriberCollection, subscriberCollection } from './subscriber-collection';\nconst observerLookup = new WeakMap();\n// https://tc39.github.io/ecma262/#sec-sortcompare\nfunction sortCompare(x, y) {\n    if (x === y) {\n        return 0;\n    }\n    x = x === null ? 'null' : x.toString();\n    y = y === null ? 'null' : y.toString();\n    return x < y ? -1 : 1;\n}\nfunction preSortCompare(x, y) {\n    if (x === void 0) {\n        if (y === void 0) {\n            return 0;\n        }\n        else {\n            return 1;\n        }\n    }\n    if (y === void 0) {\n        return -1;\n    }\n    return 0;\n}\nfunction insertionSort(arr, indexMap, from, to, compareFn) {\n    let velement, ielement, vtmp, itmp, order;\n    let i, j;\n    for (i = from + 1; i < to; i++) {\n        velement = arr[i];\n        ielement = indexMap[i];\n        for (j = i - 1; j >= from; j--) {\n            vtmp = arr[j];\n            itmp = indexMap[j];\n            order = compareFn(vtmp, velement);\n            if (order > 0) {\n                arr[j + 1] = vtmp;\n                indexMap[j + 1] = itmp;\n            }\n            else {\n                break;\n            }\n        }\n        arr[j + 1] = velement;\n        indexMap[j + 1] = ielement;\n    }\n}\nfunction quickSort(arr, indexMap, from, to, compareFn) {\n    let thirdIndex = 0, i = 0;\n    let v0, v1, v2;\n    let i0, i1, i2;\n    let c01, c02, c12;\n    let vtmp, itmp;\n    let vpivot, ipivot, lowEnd, highStart;\n    let velement, ielement, order, vtopElement;\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n        if (to - from <= 10) {\n            insertionSort(arr, indexMap, from, to, compareFn);\n            return;\n        }\n        thirdIndex = from + ((to - from) >> 1);\n        v0 = arr[from];\n        i0 = indexMap[from];\n        v1 = arr[to - 1];\n        i1 = indexMap[to - 1];\n        v2 = arr[thirdIndex];\n        i2 = indexMap[thirdIndex];\n        c01 = compareFn(v0, v1);\n        if (c01 > 0) {\n            vtmp = v0;\n            itmp = i0;\n            v0 = v1;\n            i0 = i1;\n            v1 = vtmp;\n            i1 = itmp;\n        }\n        c02 = compareFn(v0, v2);\n        if (c02 >= 0) {\n            vtmp = v0;\n            itmp = i0;\n            v0 = v2;\n            i0 = i2;\n            v2 = v1;\n            i2 = i1;\n            v1 = vtmp;\n            i1 = itmp;\n        }\n        else {\n            c12 = compareFn(v1, v2);\n            if (c12 > 0) {\n                vtmp = v1;\n                itmp = i1;\n                v1 = v2;\n                i1 = i2;\n                v2 = vtmp;\n                i2 = itmp;\n            }\n        }\n        arr[from] = v0;\n        indexMap[from] = i0;\n        arr[to - 1] = v2;\n        indexMap[to - 1] = i2;\n        vpivot = v1;\n        ipivot = i1;\n        lowEnd = from + 1;\n        highStart = to - 1;\n        arr[thirdIndex] = arr[lowEnd];\n        indexMap[thirdIndex] = indexMap[lowEnd];\n        arr[lowEnd] = vpivot;\n        indexMap[lowEnd] = ipivot;\n        partition: for (i = lowEnd + 1; i < highStart; i++) {\n            velement = arr[i];\n            ielement = indexMap[i];\n            order = compareFn(velement, vpivot);\n            if (order < 0) {\n                arr[i] = arr[lowEnd];\n                indexMap[i] = indexMap[lowEnd];\n                arr[lowEnd] = velement;\n                indexMap[lowEnd] = ielement;\n                lowEnd++;\n            }\n            else if (order > 0) {\n                do {\n                    highStart--;\n                    // eslint-disable-next-line eqeqeq\n                    if (highStart == i) {\n                        break partition;\n                    }\n                    vtopElement = arr[highStart];\n                    order = compareFn(vtopElement, vpivot);\n                } while (order > 0);\n                arr[i] = arr[highStart];\n                indexMap[i] = indexMap[highStart];\n                arr[highStart] = velement;\n                indexMap[highStart] = ielement;\n                if (order < 0) {\n                    velement = arr[i];\n                    ielement = indexMap[i];\n                    arr[i] = arr[lowEnd];\n                    indexMap[i] = indexMap[lowEnd];\n                    arr[lowEnd] = velement;\n                    indexMap[lowEnd] = ielement;\n                    lowEnd++;\n                }\n            }\n        }\n        if (to - highStart < lowEnd - from) {\n            quickSort(arr, indexMap, highStart, to, compareFn);\n            to = lowEnd;\n        }\n        else {\n            quickSort(arr, indexMap, from, lowEnd, compareFn);\n            from = highStart;\n        }\n    }\n}\nconst proto = Array.prototype;\nconst $push = proto.push;\nconst $unshift = proto.unshift;\nconst $pop = proto.pop;\nconst $shift = proto.shift;\nconst $splice = proto.splice;\nconst $reverse = proto.reverse;\nconst $sort = proto.sort;\nconst native = { push: $push, unshift: $unshift, pop: $pop, shift: $shift, splice: $splice, reverse: $reverse, sort: $sort };\nconst methods = ['push', 'unshift', 'pop', 'shift', 'splice', 'reverse', 'sort'];\nconst observe = {\n    // https://tc39.github.io/ecma262/#sec-array.prototype.push\n    push: function (...args) {\n        let $this = this;\n        if ($this.$raw !== void 0) {\n            $this = $this.$raw;\n        }\n        const o = observerLookup.get($this);\n        if (o === void 0) {\n            return $push.apply($this, args);\n        }\n        const len = $this.length;\n        const argCount = args.length;\n        if (argCount === 0) {\n            return len;\n        }\n        $this.length = o.indexMap.length = len + argCount;\n        let i = len;\n        while (i < $this.length) {\n            $this[i] = args[i - len];\n            o.indexMap[i] = -2;\n            i++;\n        }\n        o.notify();\n        return $this.length;\n    },\n    // https://tc39.github.io/ecma262/#sec-array.prototype.unshift\n    unshift: function (...args) {\n        let $this = this;\n        if ($this.$raw !== void 0) {\n            $this = $this.$raw;\n        }\n        const o = observerLookup.get($this);\n        if (o === void 0) {\n            return $unshift.apply($this, args);\n        }\n        const argCount = args.length;\n        const inserts = new Array(argCount);\n        let i = 0;\n        while (i < argCount) {\n            inserts[i++] = -2;\n        }\n        $unshift.apply(o.indexMap, inserts);\n        const len = $unshift.apply($this, args);\n        o.notify();\n        return len;\n    },\n    // https://tc39.github.io/ecma262/#sec-array.prototype.pop\n    pop: function () {\n        let $this = this;\n        if ($this.$raw !== void 0) {\n            $this = $this.$raw;\n        }\n        const o = observerLookup.get($this);\n        if (o === void 0) {\n            return $pop.call($this);\n        }\n        const indexMap = o.indexMap;\n        const element = $pop.call($this);\n        // only mark indices as deleted if they actually existed in the original array\n        const index = indexMap.length - 1;\n        if (indexMap[index] > -1) {\n            indexMap.deletedItems.push(indexMap[index]);\n        }\n        $pop.call(indexMap);\n        o.notify();\n        return element;\n    },\n    // https://tc39.github.io/ecma262/#sec-array.prototype.shift\n    shift: function () {\n        let $this = this;\n        if ($this.$raw !== void 0) {\n            $this = $this.$raw;\n        }\n        const o = observerLookup.get($this);\n        if (o === void 0) {\n            return $shift.call($this);\n        }\n        const indexMap = o.indexMap;\n        const element = $shift.call($this);\n        // only mark indices as deleted if they actually existed in the original array\n        if (indexMap[0] > -1) {\n            indexMap.deletedItems.push(indexMap[0]);\n        }\n        $shift.call(indexMap);\n        o.notify();\n        return element;\n    },\n    // https://tc39.github.io/ecma262/#sec-array.prototype.splice\n    splice: function (...args) {\n        const start = args[0];\n        const deleteCount = args[1];\n        let $this = this;\n        if ($this.$raw !== void 0) {\n            $this = $this.$raw;\n        }\n        const o = observerLookup.get($this);\n        if (o === void 0) {\n            return $splice.apply($this, args);\n        }\n        const len = this.length;\n        const relativeStart = start | 0;\n        const actualStart = relativeStart < 0 ? Math.max((len + relativeStart), 0) : Math.min(relativeStart, len);\n        const indexMap = o.indexMap;\n        const argCount = args.length;\n        const actualDeleteCount = argCount === 0 ? 0 : argCount === 1 ? len - actualStart : deleteCount;\n        if (actualDeleteCount > 0) {\n            let i = actualStart;\n            const to = i + actualDeleteCount;\n            while (i < to) {\n                if (indexMap[i] > -1) {\n                    indexMap.deletedItems.push(indexMap[i]);\n                }\n                i++;\n            }\n        }\n        if (argCount > 2) {\n            const itemCount = argCount - 2;\n            const inserts = new Array(itemCount);\n            let i = 0;\n            while (i < itemCount) {\n                inserts[i++] = -2;\n            }\n            $splice.call(indexMap, start, deleteCount, ...inserts);\n        }\n        else {\n            $splice.apply(indexMap, args);\n        }\n        const deleted = $splice.apply($this, args);\n        o.notify();\n        return deleted;\n    },\n    // https://tc39.github.io/ecma262/#sec-array.prototype.reverse\n    reverse: function () {\n        let $this = this;\n        if ($this.$raw !== void 0) {\n            $this = $this.$raw;\n        }\n        const o = observerLookup.get($this);\n        if (o === void 0) {\n            $reverse.call($this);\n            return this;\n        }\n        const len = $this.length;\n        const middle = (len / 2) | 0;\n        let lower = 0;\n        while (lower !== middle) {\n            const upper = len - lower - 1;\n            const lowerValue = $this[lower];\n            const lowerIndex = o.indexMap[lower];\n            const upperValue = $this[upper];\n            const upperIndex = o.indexMap[upper];\n            $this[lower] = upperValue;\n            o.indexMap[lower] = upperIndex;\n            $this[upper] = lowerValue;\n            o.indexMap[upper] = lowerIndex;\n            lower++;\n        }\n        o.notify();\n        return this;\n    },\n    // https://tc39.github.io/ecma262/#sec-array.prototype.sort\n    // https://github.com/v8/v8/blob/master/src/js/array.js\n    sort: function (compareFn) {\n        let $this = this;\n        if ($this.$raw !== void 0) {\n            $this = $this.$raw;\n        }\n        const o = observerLookup.get($this);\n        if (o === void 0) {\n            $sort.call($this, compareFn);\n            return this;\n        }\n        const len = $this.length;\n        if (len < 2) {\n            return this;\n        }\n        quickSort($this, o.indexMap, 0, len, preSortCompare);\n        let i = 0;\n        while (i < len) {\n            if ($this[i] === void 0) {\n                break;\n            }\n            i++;\n        }\n        if (compareFn === void 0 || typeof compareFn !== 'function' /* spec says throw a TypeError, should we do that too? */) {\n            compareFn = sortCompare;\n        }\n        quickSort($this, o.indexMap, 0, i, compareFn);\n        o.notify();\n        return this;\n    }\n};\nconst descriptorProps = {\n    writable: true,\n    enumerable: false,\n    configurable: true\n};\nconst def = Reflect.defineProperty;\nfor (const method of methods) {\n    def(observe[method], 'observing', { value: true, writable: false, configurable: false, enumerable: false });\n}\nlet enableArrayObservationCalled = false;\nexport function enableArrayObservation() {\n    for (const method of methods) {\n        if (proto[method].observing !== true) {\n            def(proto, method, { ...descriptorProps, value: observe[method] });\n        }\n    }\n}\nexport function disableArrayObservation() {\n    for (const method of methods) {\n        if (proto[method].observing === true) {\n            def(proto, method, { ...descriptorProps, value: native[method] });\n        }\n    }\n}\nlet ArrayObserver = class ArrayObserver {\n    constructor(flags, lifecycle, array) {\n        if (!enableArrayObservationCalled) {\n            enableArrayObservationCalled = true;\n            enableArrayObservation();\n        }\n        this.inBatch = false;\n        this.indexObservers = {};\n        this.collection = array;\n        this.persistentFlags = flags & 2080374799 /* persistentBindingFlags */;\n        this.indexMap = createIndexMap(array.length);\n        this.lifecycle = lifecycle;\n        this.lengthObserver = (void 0);\n        observerLookup.set(array, this);\n    }\n    notify() {\n        if (this.lifecycle.batch.depth > 0) {\n            if (!this.inBatch) {\n                this.inBatch = true;\n                this.lifecycle.batch.add(this);\n            }\n        }\n        else {\n            this.flushBatch(0 /* none */);\n        }\n    }\n    getLengthObserver() {\n        if (this.lengthObserver === void 0) {\n            this.lengthObserver = new CollectionLengthObserver(this.collection);\n        }\n        return this.lengthObserver;\n    }\n    getIndexObserver(index) {\n        return this.getOrCreateIndexObserver(index);\n    }\n    flushBatch(flags) {\n        this.inBatch = false;\n        const indexMap = this.indexMap;\n        const length = this.collection.length;\n        this.indexMap = createIndexMap(length);\n        this.callCollectionSubscribers(indexMap, 16 /* updateTargetInstance */ | this.persistentFlags);\n        if (this.lengthObserver !== void 0) {\n            this.lengthObserver.setValue(length, 16 /* updateTargetInstance */);\n        }\n    }\n    /**\n     * @internal used by friend class ArrayIndexObserver only\n     */\n    addIndexObserver(indexObserver) {\n        this.addCollectionSubscriber(indexObserver);\n    }\n    /**\n     * @internal used by friend class ArrayIndexObserver only\n     */\n    removeIndexObserver(indexObserver) {\n        this.removeCollectionSubscriber(indexObserver);\n    }\n    /**\n     * @internal\n     */\n    getOrCreateIndexObserver(index) {\n        const indexObservers = this.indexObservers;\n        let observer = indexObservers[index];\n        if (observer === void 0) {\n            observer = indexObservers[index] = new ArrayIndexObserver(this, index);\n        }\n        return observer;\n    }\n};\nArrayObserver = __decorate([\n    collectionSubscriberCollection(),\n    __metadata(\"design:paramtypes\", [Number, Object, Object])\n], ArrayObserver);\nexport { ArrayObserver };\nlet ArrayIndexObserver = class ArrayIndexObserver {\n    constructor(owner, index) {\n        this.owner = owner;\n        this.index = index;\n        this.subscriberCount = 0;\n        this.currentValue = this.getValue();\n    }\n    getValue() {\n        return this.owner.collection[this.index];\n    }\n    setValue(newValue, flags) {\n        if (newValue === this.getValue()) {\n            return;\n        }\n        const arrayObserver = this.owner;\n        const index = this.index;\n        const indexMap = arrayObserver.indexMap;\n        if (indexMap[index] > -1) {\n            indexMap.deletedItems.push(indexMap[index]);\n        }\n        indexMap[index] = -2;\n        // do not need to update current value here\n        // as it will be updated inside handle collection change\n        arrayObserver.collection[index] = newValue;\n        arrayObserver.notify();\n    }\n    /**\n     * From interface `ICollectionSubscriber`\n     */\n    handleCollectionChange(indexMap, flags) {\n        const index = this.index;\n        const noChange = indexMap[index] === index;\n        if (noChange) {\n            return;\n        }\n        const prevValue = this.currentValue;\n        const currValue = this.currentValue = this.getValue();\n        // hmm\n        if (prevValue !== currValue) {\n            this.callSubscribers(currValue, prevValue, flags);\n        }\n    }\n    subscribe(subscriber) {\n        if (this.addSubscriber(subscriber) && ++this.subscriberCount === 1) {\n            this.owner.addIndexObserver(this);\n        }\n    }\n    unsubscribe(subscriber) {\n        if (this.removeSubscriber(subscriber) && --this.subscriberCount === 0) {\n            this.owner.removeIndexObserver(this);\n        }\n    }\n};\nArrayIndexObserver = __decorate([\n    subscriberCollection(),\n    __metadata(\"design:paramtypes\", [ArrayObserver, Number])\n], ArrayIndexObserver);\nexport { ArrayIndexObserver };\nexport function getArrayObserver(flags, lifecycle, array) {\n    const observer = observerLookup.get(array);\n    if (observer === void 0) {\n        return new ArrayObserver(flags, lifecycle, array);\n    }\n    return observer;\n}\n/**\n * Applies offsets to the non-negative indices in the IndexMap\n * based on added and deleted items relative to those indices.\n *\n * e.g. turn `[-2, 0, 1]` into `[-2, 1, 2]`, allowing the values at the indices to be\n * used for sorting/reordering items if needed\n */\nexport function applyMutationsToIndices(indexMap) {\n    let offset = 0;\n    let j = 0;\n    const len = indexMap.length;\n    for (let i = 0; i < len; ++i) {\n        while (indexMap.deletedItems[j] <= i - offset) {\n            ++j;\n            --offset;\n        }\n        if (indexMap[i] === -2) {\n            ++offset;\n        }\n        else {\n            indexMap[i] += offset;\n        }\n    }\n}\n/**\n * After `applyMutationsToIndices`, this function can be used to reorder items in a derived\n * array (e.g.  the items in the `views` in the repeater are derived from the `items` property)\n */\nexport function synchronizeIndices(items, indexMap) {\n    const copy = items.slice();\n    const len = indexMap.length;\n    let to = 0;\n    let from = 0;\n    while (to < len) {\n        from = indexMap[to];\n        if (from !== -2) {\n            items[to] = copy[from];\n        }\n        ++to;\n    }\n}\n//# sourceMappingURL=array-observer.js.map","import { __decorate, __metadata } from \"tslib\";\n/* eslint-disable eqeqeq, compat/compat */\nimport { PLATFORM, Reporter, isArrayIndex } from '@aurelia/kernel';\nimport { IObserverLocator } from './observer-locator';\nimport { subscriberCollection } from './subscriber-collection';\nexport function computed(config) {\n    return function (target, key) {\n        /**\n         * The 'computed' property defined on prototype needs to be non-enumerable to prevent getting this in loops,\n         * iterating over object properties, such as for..in.\n         *\n         * The 'value' of the property should not have any prototype. Otherwise if by mistake the target passed\n         * here is `Object`, then we are in soup. Because then every instance of `Object` will have the `computed`\n         * property, including the `value` (in the descriptor of the property), when assigned `{}`. This might\n         * lead to infinite recursion for the cases as mentioned above.\n         */\n        if (target.computed == null) {\n            Reflect.defineProperty(target, 'computed', {\n                writable: true,\n                configurable: true,\n                enumerable: false,\n                value: Object.create(null)\n            });\n        }\n        // eslint-disable-next-line @typescript-eslint/no-unnecessary-type-assertion\n        target.computed[key] = config;\n    };\n}\nconst computedOverrideDefaults = { static: false, volatile: false };\n/* @internal */\nexport function createComputedObserver(flags, observerLocator, dirtyChecker, lifecycle, instance, propertyName, descriptor) {\n    if (descriptor.configurable === false) {\n        return dirtyChecker.createProperty(instance, propertyName);\n    }\n    if (descriptor.get != null) {\n        const { constructor: { prototype: { computed: givenOverrides } } } = instance;\n        // eslint-disable-next-line @typescript-eslint/strict-boolean-expressions, @typescript-eslint/no-unnecessary-type-assertion\n        const overrides = givenOverrides && givenOverrides[propertyName] || computedOverrideDefaults;\n        if (descriptor.set != null) {\n            if (overrides.volatile) {\n                return new GetterObserver(flags, overrides, instance, propertyName, descriptor, observerLocator);\n            }\n            return new CustomSetterObserver(instance, propertyName, descriptor);\n        }\n        return new GetterObserver(flags, overrides, instance, propertyName, descriptor, observerLocator);\n    }\n    throw Reporter.error(18, propertyName);\n}\n// Used when the getter is dependent solely on changes that happen within the setter.\nlet CustomSetterObserver = class CustomSetterObserver {\n    constructor(obj, propertyKey, descriptor) {\n        this.obj = obj;\n        this.propertyKey = propertyKey;\n        this.descriptor = descriptor;\n        this.currentValue = void 0;\n        this.oldValue = void 0;\n        this.observing = false;\n    }\n    setValue(newValue) {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion, @typescript-eslint/no-unnecessary-type-assertion\n        this.descriptor.set.call(this.obj, newValue); // Non-null is implied because descriptors without setters won't end up here\n        if (this.currentValue !== newValue) {\n            this.oldValue = this.currentValue;\n            this.currentValue = newValue;\n            this.callSubscribers(newValue, this.oldValue, 16 /* updateTargetInstance */);\n        }\n    }\n    subscribe(subscriber) {\n        if (!this.observing) {\n            this.convertProperty();\n        }\n        this.addSubscriber(subscriber);\n    }\n    unsubscribe(subscriber) {\n        this.removeSubscriber(subscriber);\n    }\n    convertProperty() {\n        this.observing = true;\n        this.currentValue = this.obj[this.propertyKey];\n        const set = (newValue) => { this.setValue(newValue); };\n        Reflect.defineProperty(this.obj, this.propertyKey, { set, get: this.descriptor.get });\n    }\n};\nCustomSetterObserver = __decorate([\n    subscriberCollection(),\n    __metadata(\"design:paramtypes\", [Object, String, Object])\n], CustomSetterObserver);\nexport { CustomSetterObserver };\n// Used when there is no setter, and the getter is dependent on other properties of the object;\n// Used when there is a setter but the value of the getter can change based on properties set outside of the setter.\nlet GetterObserver = class GetterObserver {\n    constructor(flags, overrides, obj, propertyKey, descriptor, observerLocator) {\n        this.overrides = overrides;\n        this.obj = obj;\n        this.propertyKey = propertyKey;\n        this.descriptor = descriptor;\n        this.currentValue = void 0;\n        this.oldValue = void 0;\n        this.propertyDeps = [];\n        this.collectionDeps = [];\n        this.subscriberCount = 0;\n        this.isCollecting = false;\n        this.proxy = new Proxy(obj, createGetterTraps(flags, observerLocator, this));\n        const get = () => this.getValue();\n        Reflect.defineProperty(obj, propertyKey, { get, set: descriptor.set });\n    }\n    addPropertyDep(subscribable) {\n        if (!this.propertyDeps.includes(subscribable)) {\n            this.propertyDeps.push(subscribable);\n        }\n    }\n    addCollectionDep(subscribable) {\n        if (!this.collectionDeps.includes(subscribable)) {\n            this.collectionDeps.push(subscribable);\n        }\n    }\n    getValue() {\n        if (this.subscriberCount > 0 || this.isCollecting) {\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            this.currentValue = Reflect.apply(this.descriptor.get, this.proxy, PLATFORM.emptyArray); // Non-null is implied because descriptors without getters won't end up here\n        }\n        else {\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            this.currentValue = Reflect.apply(this.descriptor.get, this.obj, PLATFORM.emptyArray); // Non-null is implied because descriptors without getters won't end up here\n        }\n        return this.currentValue;\n    }\n    subscribe(subscriber) {\n        this.addSubscriber(subscriber);\n        if (++this.subscriberCount === 1) {\n            this.getValueAndCollectDependencies(true);\n        }\n    }\n    unsubscribe(subscriber) {\n        this.removeSubscriber(subscriber);\n        if (--this.subscriberCount === 0) {\n            this.unsubscribeAllDependencies();\n        }\n    }\n    handleChange() {\n        const oldValue = this.currentValue;\n        const newValue = this.getValueAndCollectDependencies(false);\n        if (oldValue !== newValue) {\n            this.callSubscribers(newValue, oldValue, 16 /* updateTargetInstance */);\n        }\n    }\n    handleCollectionChange() {\n        const oldValue = this.currentValue;\n        const newValue = this.getValueAndCollectDependencies(false);\n        if (oldValue !== newValue) {\n            this.callSubscribers(newValue, oldValue, 16 /* updateTargetInstance */);\n        }\n    }\n    getValueAndCollectDependencies(requireCollect) {\n        const dynamicDependencies = !this.overrides.static || requireCollect;\n        if (dynamicDependencies) {\n            this.unsubscribeAllDependencies();\n            this.isCollecting = true;\n        }\n        this.currentValue = this.getValue();\n        if (dynamicDependencies) {\n            this.propertyDeps.forEach(x => { x.subscribe(this); });\n            this.collectionDeps.forEach(x => { x.subscribeToCollection(this); });\n            this.isCollecting = false;\n        }\n        return this.currentValue;\n    }\n    doNotCollect(target, key, receiver) {\n        return !this.isCollecting\n            || key === '$observers'\n            || key === '$synthetic'\n            || key === 'constructor';\n    }\n    unsubscribeAllDependencies() {\n        this.propertyDeps.forEach(x => { x.unsubscribe(this); });\n        this.propertyDeps.length = 0;\n        this.collectionDeps.forEach(x => { x.unsubscribeFromCollection(this); });\n        this.collectionDeps.length = 0;\n    }\n};\nGetterObserver = __decorate([\n    subscriberCollection(),\n    __metadata(\"design:paramtypes\", [Number, Object, Object, String, Object, Object])\n], GetterObserver);\nexport { GetterObserver };\nconst toStringTag = Object.prototype.toString;\n/**\n * _@param observer The owning observer of current evaluation, will subscribe to all observers created via proxy\n */\nfunction createGetterTraps(flags, observerLocator, observer) {\n    return {\n        get: function (target, key, receiver) {\n            if (observer.doNotCollect(target, key, receiver)) {\n                return Reflect.get(target, key, receiver);\n            }\n            // The length and iterator properties need to be invoked on the original object\n            // (for Map and Set at least) or they will throw.\n            switch (toStringTag.call(target)) {\n                case '[object Array]':\n                    if (key === 'length' || isArrayIndex(key)) {\n                        observer.addCollectionDep(observerLocator.getArrayObserver(flags, target));\n                        return proxyOrValue(flags, target, key, observerLocator, observer);\n                    }\n                    break;\n                case '[object Map]':\n                    if (key === 'size') {\n                        observer.addCollectionDep(observerLocator.getMapObserver(flags, target));\n                        return Reflect.get(target, key, target);\n                    }\n                    break;\n                case '[object Set]':\n                    if (key === 'size') {\n                        observer.addCollectionDep(observerLocator.getSetObserver(flags, target));\n                        return Reflect.get(target, key, target);\n                    }\n                    break;\n            }\n            observer.addPropertyDep(observerLocator.getObserver(flags, target, key));\n            return proxyOrValue(flags, target, key, observerLocator, observer);\n        }\n    };\n}\n/**\n * _@param observer The owning observer of current evaluation, will subscribe to all observers created via proxy\n */\nfunction proxyOrValue(flags, target, key, observerLocator, observer) {\n    const value = Reflect.get(target, key, target);\n    if (typeof value !== 'object' || typeof value === 'function' || value === null) {\n        return value;\n    }\n    return new Proxy(value, createGetterTraps(flags, observerLocator, observer));\n}\n//# sourceMappingURL=computed-observer.js.map","import { __decorate, __metadata } from \"tslib\";\nimport { PLATFORM, DI, bound, Registration } from '@aurelia/kernel';\nconst defaultClockSettings = {\n    forceUpdateInterval: 10,\n    now: PLATFORM.now,\n};\nconst { enter, leave, trace, } = (function () {\n    const enabled = false;\n    let depth = 0;\n    function round(num) {\n        return ((num * 10 + .5) | 0) / 10;\n    }\n    function log(prefix, obj, method) {\n        if (obj instanceof TaskQueue) {\n            const processing = obj['processingSize'];\n            const pending = obj['pendingSize'];\n            const delayed = obj['delayedSize'];\n            const flushReq = obj['flushRequested'];\n            const prio = obj['priority'];\n            const info = `processing=${processing} pending=${pending} delayed=${delayed} flushReq=${flushReq} prio=${prio}`;\n            console.log(`${prefix}[Q.${method}] ${info}`);\n        }\n        else {\n            const id = obj['id'];\n            const created = round(obj['createdTime']);\n            const queue = round(obj['queueTime']);\n            const preempt = obj['preempt'];\n            const reusable = obj['reusable'];\n            const persistent = obj['persistent'];\n            const status = obj['_status'];\n            const info = `id=${id} created=${created} queue=${queue} preempt=${preempt} persistent=${persistent} reusable=${reusable} status=${status}`;\n            console.log(`${prefix}[T.${method}] ${info}`);\n        }\n    }\n    function $enter(obj, method) {\n        if (enabled) {\n            log(`${'  '.repeat(depth++)}> `, obj, method);\n        }\n    }\n    function $leave(obj, method) {\n        if (enabled) {\n            log(`${'  '.repeat(--depth)}< `, obj, method);\n        }\n    }\n    function $trace(obj, method) {\n        if (enabled) {\n            log(`${'  '.repeat(depth)}- `, obj, method);\n        }\n    }\n    return {\n        enter: $enter,\n        leave: $leave,\n        trace: $trace,\n    };\n})();\nexport const IClock = DI.createInterface('IClock').withDefault(x => x.instance(globalClock));\nexport class Clock {\n    constructor(opts) {\n        const { now, forceUpdateInterval } = { ...defaultClockSettings, ...opts };\n        this.now = function (highRes = false) {\n            // if (++requests === forceUpdateInterval || highRes) {\n            //   requests = 0;\n            //   timestamp = now();\n            // }\n            // return timestamp;\n            return now();\n        };\n    }\n    static register(container) {\n        return Registration.singleton(IClock, this).register(container);\n    }\n}\nexport const globalClock = new Clock();\nexport var TaskQueuePriority;\n(function (TaskQueuePriority) {\n    TaskQueuePriority[TaskQueuePriority[\"microTask\"] = 0] = \"microTask\";\n    TaskQueuePriority[TaskQueuePriority[\"render\"] = 1] = \"render\";\n    TaskQueuePriority[TaskQueuePriority[\"macroTask\"] = 2] = \"macroTask\";\n    TaskQueuePriority[TaskQueuePriority[\"postRender\"] = 3] = \"postRender\";\n    TaskQueuePriority[TaskQueuePriority[\"idle\"] = 4] = \"idle\";\n})(TaskQueuePriority || (TaskQueuePriority = {}));\nexport const IScheduler = DI.createInterface('IScheduler').noDefault();\nconst createPromise = (function () {\n    let $resolve = void 0;\n    let $reject = void 0;\n    function executor(resolve, reject) {\n        $resolve = resolve;\n        $reject = reject;\n    }\n    return function () {\n        const p = new Promise(executor);\n        p.resolve = $resolve;\n        p.reject = $reject;\n        $resolve = void 0;\n        $reject = void 0;\n        return p;\n    };\n})();\nconst defaultQueueTaskOptions = {\n    delay: 0,\n    preempt: false,\n    priority: 1 /* render */,\n    persistent: false,\n    reusable: true,\n};\nexport class TaskQueue {\n    constructor({ clock, priority, scheduler }) {\n        this.processingSize = 0;\n        this.processingHead = void 0;\n        this.processingTail = void 0;\n        this.pendingSize = 0;\n        this.pendingHead = void 0;\n        this.pendingTail = void 0;\n        this.delayedSize = 0;\n        this.delayedHead = void 0;\n        this.delayedTail = void 0;\n        this.flushRequested = false;\n        this.yieldPromise = void 0;\n        this.taskPool = [];\n        this.taskPoolSize = 0;\n        this.lastRequest = 0;\n        this.microTaskRequestFlushTask = null;\n        this.priority = priority;\n        this.scheduler = scheduler;\n        this.clock = clock;\n    }\n    get isEmpty() {\n        return this.processingSize === 0 && this.pendingSize === 0 && this.delayedSize === 0;\n    }\n    flush() {\n        enter(this, 'flush');\n        if (this.microTaskRequestFlushTask !== null) {\n            this.microTaskRequestFlushTask.cancel();\n            this.microTaskRequestFlushTask = null;\n        }\n        this.clock.now(true);\n        this.flushRequested = false;\n        if (this.pendingSize > 0) {\n            this.movePendingToProcessing();\n        }\n        if (this.delayedSize > 0) {\n            this.moveDelayedToProcessing();\n        }\n        while (this.processingSize > 0) {\n            this.processingHead.run();\n        }\n        if (this.pendingSize > 0) {\n            this.movePendingToProcessing();\n        }\n        if (this.delayedSize > 0) {\n            this.moveDelayedToProcessing();\n        }\n        if (this.processingSize > 0) {\n            this.requestFlush();\n        }\n        else if (this.delayedSize > 0) {\n            if (this.priority <= 0 /* microTask */) {\n                // MicroTasks are not clamped so we have to clamp them with setTimeout or they'll block forever\n                this.microTaskRequestFlushTask = this.scheduler.getTaskQueue(2 /* macroTask */).queueTask(this.requestFlush);\n            }\n            else {\n                // Otherwise just let this queue handle itself\n                this.requestFlush();\n            }\n        }\n        if (this.yieldPromise !== void 0) {\n            let noMoreFiniteWork = true;\n            let cur = this.processingHead;\n            while (cur !== void 0) {\n                if (!cur.persistent) {\n                    noMoreFiniteWork = false;\n                    break;\n                }\n                cur = cur.next;\n            }\n            if (noMoreFiniteWork) {\n                cur = this.pendingHead;\n                while (cur !== void 0) {\n                    if (!cur.persistent) {\n                        noMoreFiniteWork = false;\n                        break;\n                    }\n                    cur = cur.next;\n                }\n            }\n            if (noMoreFiniteWork) {\n                cur = this.delayedHead;\n                while (cur !== void 0) {\n                    if (!cur.persistent) {\n                        noMoreFiniteWork = false;\n                        break;\n                    }\n                    cur = cur.next;\n                }\n            }\n            if (noMoreFiniteWork) {\n                const p = this.yieldPromise;\n                this.yieldPromise = void 0;\n                p.resolve();\n            }\n        }\n        leave(this, 'flush');\n    }\n    cancel() {\n        enter(this, 'cancel');\n        if (this.microTaskRequestFlushTask !== null) {\n            this.microTaskRequestFlushTask.cancel();\n            this.microTaskRequestFlushTask = null;\n        }\n        this.scheduler.cancelFlush(this);\n        this.flushRequested = false;\n        leave(this, 'cancel');\n    }\n    yield() {\n        enter(this, 'yield');\n        if (this.processingSize === 0 && this.pendingSize === 0 && this.delayedSize === 0) {\n            leave(this, 'yield empty');\n            return Promise.resolve();\n        }\n        if (this.yieldPromise === void 0) {\n            this.yieldPromise = createPromise();\n        }\n        leave(this, 'yield task');\n        return this.yieldPromise;\n    }\n    queueTask(callback, opts) {\n        enter(this, 'queueTask');\n        const { delay, preempt, persistent, reusable } = { ...defaultQueueTaskOptions, ...opts };\n        if (preempt) {\n            if (delay > 0) {\n                throw new Error(`Invalid arguments: preempt cannot be combined with a greater-than-zero delay`);\n            }\n            if (persistent) {\n                throw new Error(`Invalid arguments: preempt cannot be combined with persistent`);\n            }\n        }\n        if (persistent && this.priority === 0 /* microTask */) {\n            throw new Error(`Invalid arguments: cannot queue persistent tasks on the micro task queue`);\n        }\n        if (this.processingSize === 0) {\n            this.requestFlush();\n        }\n        const time = this.clock.now();\n        let task;\n        if (reusable) {\n            const taskPool = this.taskPool;\n            const index = this.taskPoolSize - 1;\n            if (index >= 0) {\n                task = taskPool[index];\n                taskPool[index] = (void 0);\n                this.taskPoolSize = index;\n                task.reuse(time, delay, preempt, persistent, callback);\n            }\n            else {\n                task = new Task(this, time, time + delay, preempt, persistent, reusable, callback);\n            }\n        }\n        else {\n            task = new Task(this, time, time + delay, preempt, persistent, reusable, callback);\n        }\n        if (preempt) {\n            if (this.processingSize++ === 0) {\n                this.processingHead = this.processingTail = task;\n            }\n            else {\n                this.processingTail = (task.prev = this.processingTail).next = task;\n            }\n        }\n        else if (delay === 0) {\n            if (this.pendingSize++ === 0) {\n                this.pendingHead = this.pendingTail = task;\n            }\n            else {\n                this.pendingTail = (task.prev = this.pendingTail).next = task;\n            }\n        }\n        else {\n            if (this.delayedSize++ === 0) {\n                this.delayedHead = this.delayedTail = task;\n            }\n            else {\n                this.delayedTail = (task.prev = this.delayedTail).next = task;\n            }\n        }\n        leave(this, 'queueTask');\n        return task;\n    }\n    take(task) {\n        enter(this, 'take');\n        if (task.status !== 'pending') {\n            leave(this, 'take error');\n            throw new Error('Can only take pending tasks.');\n        }\n        if (this.processingSize === 0) {\n            this.requestFlush();\n        }\n        task.taskQueue.remove(task);\n        if (task.preempt) {\n            this.addToProcessing(task);\n        }\n        else if (task.queueTime <= this.clock.now()) {\n            this.addToPending(task);\n        }\n        else {\n            this.addToDelayed(task);\n        }\n        leave(this, 'take');\n    }\n    remove(task) {\n        enter(this, 'remove');\n        if (task.preempt) {\n            // Fast path - preempt task can only ever end up in the processing queue\n            this.removeFromProcessing(task);\n            leave(this, 'remove processing fast');\n            return;\n        }\n        if (task.queueTime > this.clock.now()) {\n            // Fast path - task with queueTime in the future can only ever be in the delayed queue\n            this.removeFromDelayed(task);\n            leave(this, 'remove delayed fast');\n            return;\n        }\n        // Scan everything (we can make this faster by using the queueTime property, but this is good enough for now)\n        let cur = this.processingHead;\n        while (cur !== void 0) {\n            if (cur === task) {\n                this.removeFromProcessing(task);\n                leave(this, 'remove processing slow');\n                return;\n            }\n            cur = cur.next;\n        }\n        cur = this.pendingHead;\n        while (cur !== void 0) {\n            if (cur === task) {\n                this.removeFromPending(task);\n                leave(this, 'remove pending slow');\n                return;\n            }\n            cur = cur.next;\n        }\n        cur = this.delayedHead;\n        while (cur !== void 0) {\n            if (cur === task) {\n                this.removeFromDelayed(task);\n                leave(this, 'remove delayed slow');\n                return;\n            }\n            cur = cur.next;\n        }\n        leave(this, 'remove error');\n        throw new Error(`Task #${task.id} could not be found`);\n    }\n    returnToPool(task) {\n        trace(this, 'returnToPool');\n        this.taskPool[this.taskPoolSize++] = task;\n    }\n    resetPersistentTask(task) {\n        enter(this, 'resetPersistentTask');\n        task.reset(this.clock.now());\n        if (task.createdTime === task.queueTime) {\n            if (this.pendingSize++ === 0) {\n                this.pendingHead = this.pendingTail = task;\n                task.prev = task.next = void 0;\n            }\n            else {\n                this.pendingTail = (task.prev = this.pendingTail).next = task;\n                task.next = void 0;\n            }\n        }\n        else {\n            if (this.delayedSize++ === 0) {\n                this.delayedHead = this.delayedTail = task;\n                task.prev = task.next = void 0;\n            }\n            else {\n                this.delayedTail = (task.prev = this.delayedTail).next = task;\n                task.next = void 0;\n            }\n        }\n        leave(this, 'resetPersistentTask');\n    }\n    finish(task) {\n        enter(this, 'finish');\n        if (task.next !== void 0) {\n            task.next.prev = task.prev;\n        }\n        if (task.prev !== void 0) {\n            task.prev.next = task.next;\n        }\n        leave(this, 'finish');\n    }\n    removeFromProcessing(task) {\n        enter(this, 'removeFromProcessing');\n        if (this.processingHead === task) {\n            this.processingHead = task.next;\n        }\n        if (this.processingTail === task) {\n            this.processingTail = task.prev;\n        }\n        --this.processingSize;\n        this.finish(task);\n        leave(this, 'removeFromProcessing');\n    }\n    removeFromPending(task) {\n        enter(this, 'removeFromPending');\n        if (this.pendingHead === task) {\n            this.pendingHead = task.next;\n        }\n        if (this.pendingTail === task) {\n            this.pendingTail = task.prev;\n        }\n        --this.pendingSize;\n        this.finish(task);\n        leave(this, 'removeFromPending');\n    }\n    removeFromDelayed(task) {\n        enter(this, 'removeFromDelayed');\n        if (this.delayedHead === task) {\n            this.delayedHead = task.next;\n        }\n        if (this.delayedTail === task) {\n            this.delayedTail = task.prev;\n        }\n        --this.delayedSize;\n        this.finish(task);\n        leave(this, 'removeFromDelayed');\n    }\n    addToProcessing(task) {\n        enter(this, 'addToProcessing');\n        if (this.processingSize++ === 0) {\n            this.processingHead = this.processingTail = task;\n        }\n        else {\n            this.processingTail = (task.prev = this.processingTail).next = task;\n        }\n        leave(this, 'addToProcessing');\n    }\n    addToPending(task) {\n        enter(this, 'addToPending');\n        if (this.pendingSize++ === 0) {\n            this.pendingHead = this.pendingTail = task;\n        }\n        else {\n            this.pendingTail = (task.prev = this.pendingTail).next = task;\n        }\n        leave(this, 'addToPending');\n    }\n    addToDelayed(task) {\n        enter(this, 'addToDelayed');\n        if (this.delayedSize++ === 0) {\n            this.delayedHead = this.delayedTail = task;\n        }\n        else {\n            this.delayedTail = (task.prev = this.delayedTail).next = task;\n        }\n        leave(this, 'addToDelayed');\n    }\n    movePendingToProcessing() {\n        enter(this, 'movePendingToProcessing');\n        // Add the previously pending tasks to the currently processing tasks\n        if (this.processingSize === 0) {\n            this.processingHead = this.pendingHead;\n            this.processingTail = this.pendingTail;\n            this.processingSize = this.pendingSize;\n        }\n        else {\n            this.processingTail.next = this.pendingHead;\n            this.processingTail = this.pendingTail;\n            this.processingSize += this.pendingSize;\n        }\n        this.pendingHead = void 0;\n        this.pendingTail = void 0;\n        this.pendingSize = 0;\n        leave(this, 'movePendingToProcessing');\n    }\n    moveDelayedToProcessing() {\n        enter(this, 'moveDelayedToProcessing');\n        const time = this.clock.now(true);\n        // Add any delayed tasks whose delay have expired to the currently processing tasks\n        const delayedHead = this.delayedHead;\n        if (delayedHead.queueTime <= time) {\n            let delayedTail = delayedHead;\n            let next = delayedTail.next;\n            let count = 1;\n            while (next !== void 0 && next.queueTime <= time) {\n                delayedTail = next;\n                next = delayedTail.next;\n                ++count;\n            }\n            if (this.processingSize === 0) {\n                this.processingHead = delayedHead;\n                this.processingTail = delayedTail;\n                this.processingSize = count;\n            }\n            else {\n                this.processingTail.next = delayedHead;\n                this.processingTail = delayedTail;\n                this.processingSize += count;\n            }\n            this.delayedHead = next;\n            this.delayedSize -= count;\n            if (this.delayedSize === 0) {\n                this.delayedTail = void 0;\n            }\n        }\n        leave(this, 'moveDelayedToProcessing');\n    }\n    requestFlush() {\n        enter(this, 'requestFlush');\n        if (this.microTaskRequestFlushTask !== null) {\n            this.microTaskRequestFlushTask.cancel();\n            this.microTaskRequestFlushTask = null;\n        }\n        if (!this.flushRequested) {\n            this.flushRequested = true;\n            this.lastRequest = this.clock.now(true);\n            this.scheduler.requestFlush(this);\n        }\n        leave(this, 'requestFlush');\n    }\n}\n__decorate([\n    bound,\n    __metadata(\"design:type\", Function),\n    __metadata(\"design:paramtypes\", []),\n    __metadata(\"design:returntype\", void 0)\n], TaskQueue.prototype, \"requestFlush\", null);\nexport class TaskAbortError extends Error {\n    constructor(task) {\n        super('Task was canceled.');\n        this.task = task;\n    }\n}\nlet id = 0;\nexport class Task {\n    constructor(taskQueue, createdTime, queueTime, preempt, persistent, reusable, callback) {\n        this.taskQueue = taskQueue;\n        this.createdTime = createdTime;\n        this.queueTime = queueTime;\n        this.preempt = preempt;\n        this.persistent = persistent;\n        this.reusable = reusable;\n        this.callback = callback;\n        this.id = ++id;\n        this.next = void 0;\n        this.prev = void 0;\n        this.resolve = void 0;\n        this.reject = void 0;\n        this._result = void 0;\n        this._status = 'pending';\n        trace(this, 'constructor');\n        this.priority = taskQueue.priority;\n    }\n    get result() {\n        const result = this._result;\n        if (result === void 0) {\n            switch (this._status) {\n                case 'pending': {\n                    const promise = this._result = createPromise();\n                    this.resolve = promise.resolve;\n                    this.reject = promise.reject;\n                    return promise;\n                }\n                case 'running':\n                    throw new Error('Trying to await task from within task will cause a deadlock.');\n                case 'completed':\n                    return this._result = Promise.resolve();\n                case 'canceled':\n                    return this._result = Promise.reject(new TaskAbortError(this));\n            }\n        }\n        return result;\n    }\n    get status() {\n        return this._status;\n    }\n    run() {\n        enter(this, 'run');\n        if (this._status !== 'pending') {\n            leave(this, 'run error');\n            throw new Error(`Cannot run task in ${this._status} state`);\n        }\n        // this.persistent could be changed while the task is running (this can only be done by the task itself if canceled, and is a valid way of stopping a loop)\n        // so we deliberately reference this.persistent instead of the local variable, but we keep it around to know whether the task *was* persistent before running it,\n        // so we can set the correct cancelation state.\n        const persistent = this.persistent;\n        const reusable = this.reusable;\n        const taskQueue = this.taskQueue;\n        const callback = this.callback;\n        const resolve = this.resolve;\n        const reject = this.reject;\n        const createdTime = this.createdTime;\n        taskQueue.remove(this);\n        this._status = 'running';\n        try {\n            const ret = callback(globalClock.now() - createdTime);\n            if (this.persistent) {\n                taskQueue.resetPersistentTask(this);\n            }\n            else if (persistent) {\n                // Persistent tasks never reach completed status. They're either pending, running, or canceled.\n                this._status = 'canceled';\n            }\n            else {\n                this._status = 'completed';\n            }\n            if (resolve !== void 0) {\n                resolve(ret);\n            }\n        }\n        catch (err) {\n            if (reject !== void 0) {\n                reject(err);\n            }\n            else {\n                throw err;\n            }\n        }\n        finally {\n            if (!this.persistent) {\n                this.dispose();\n                if (reusable) {\n                    taskQueue.returnToPool(this);\n                }\n            }\n            leave(this, 'run finally');\n        }\n    }\n    cancel() {\n        enter(this, 'cancel');\n        if (this._status === 'pending') {\n            const taskQueue = this.taskQueue;\n            const reusable = this.reusable;\n            const reject = this.reject;\n            taskQueue.remove(this);\n            if (taskQueue.isEmpty) {\n                taskQueue.cancel();\n            }\n            this._status = 'canceled';\n            if (reject !== void 0) {\n                reject(new TaskAbortError(this));\n            }\n            this.dispose();\n            if (reusable) {\n                taskQueue.returnToPool(this);\n            }\n            leave(this, 'cancel true =pending');\n            return true;\n        }\n        else if (this._status === 'running' && this.persistent) {\n            this.persistent = false;\n            leave(this, 'cancel true =running+persistent');\n            return true;\n        }\n        leave(this, 'cancel false');\n        return false;\n    }\n    reset(time) {\n        enter(this, 'reset');\n        const delay = this.queueTime - this.createdTime;\n        this.createdTime = time;\n        this.queueTime = time + delay;\n        this._status = 'pending';\n        this.resolve = void 0;\n        this.reject = void 0;\n        this._result = void 0;\n        leave(this, 'reset');\n    }\n    reuse(time, delay, preempt, persistent, callback) {\n        enter(this, 'reuse');\n        this.createdTime = time;\n        this.queueTime = time + delay;\n        this.preempt = preempt;\n        this.persistent = persistent;\n        this.callback = callback;\n        this._status = 'pending';\n        leave(this, 'reuse');\n    }\n    dispose() {\n        trace(this, 'dispose');\n        this.prev = void 0;\n        this.next = void 0;\n        this.callback = (void 0);\n        this.resolve = void 0;\n        this.reject = void 0;\n        this._result = void 0;\n    }\n}\n//# sourceMappingURL=scheduler.js.map","import { __decorate, __metadata, __param } from \"tslib\";\nimport { DI, Reporter } from '@aurelia/kernel';\nimport { subscriberCollection } from './subscriber-collection';\nimport { IScheduler } from '../scheduler';\nexport const IDirtyChecker = DI.createInterface('IDirtyChecker').withDefault(x => x.singleton(DirtyChecker));\nexport const DirtyCheckSettings = {\n    /**\n     * Default: `6`\n     *\n     * Adjust the global dirty check frequency.\n     * Measures in \"frames per check\", such that (given an FPS of 60):\n     * - A value of 1 will result in 60 dirty checks per second\n     * - A value of 6 will result in 10 dirty checks per second\n     */\n    framesPerCheck: 6,\n    /**\n     * Default: `false`\n     *\n     * Disable dirty-checking entirely. Properties that cannot be observed without dirty checking\n     * or an adapter, will simply not be observed.\n     */\n    disabled: false,\n    /**\n     * Default: `true`\n     *\n     * Log a warning message to the console if a property is being dirty-checked.\n     */\n    warn: true,\n    /**\n     * Default: `false`\n     *\n     * Throw an error if a property is being dirty-checked.\n     */\n    throw: false,\n    /**\n     * Resets all dirty checking settings to the framework's defaults.\n     */\n    resetToDefault() {\n        this.framesPerCheck = 6;\n        this.disabled = false;\n        this.warn = true;\n        this.throw = false;\n    }\n};\n/** @internal */\nlet DirtyChecker = class DirtyChecker {\n    constructor(scheduler) {\n        this.scheduler = scheduler;\n        this.tracked = [];\n        this.task = null;\n        this.elapsedFrames = 0;\n    }\n    createProperty(obj, propertyName) {\n        if (DirtyCheckSettings.throw) {\n            throw Reporter.error(800, propertyName); // TODO: create/organize error code\n        }\n        if (DirtyCheckSettings.warn) {\n            Reporter.write(801, propertyName);\n        }\n        return new DirtyCheckProperty(this, obj, propertyName);\n    }\n    addProperty(property) {\n        this.tracked.push(property);\n        if (this.tracked.length === 1) {\n            this.task = this.scheduler.queueRenderTask(() => this.check(), { persistent: true });\n        }\n    }\n    removeProperty(property) {\n        this.tracked.splice(this.tracked.indexOf(property), 1);\n        if (this.tracked.length === 0) {\n            this.task.cancel();\n            this.task = null;\n        }\n    }\n    check(delta) {\n        if (DirtyCheckSettings.disabled) {\n            return;\n        }\n        if (++this.elapsedFrames < DirtyCheckSettings.framesPerCheck) {\n            return;\n        }\n        this.elapsedFrames = 0;\n        const tracked = this.tracked;\n        const len = tracked.length;\n        let current;\n        let i = 0;\n        for (; i < len; ++i) {\n            current = tracked[i];\n            if (current.isDirty()) {\n                current.flush(256 /* fromTick */);\n            }\n        }\n    }\n};\nDirtyChecker = __decorate([\n    __param(0, IScheduler),\n    __metadata(\"design:paramtypes\", [Object])\n], DirtyChecker);\nexport { DirtyChecker };\nlet DirtyCheckProperty = class DirtyCheckProperty {\n    constructor(dirtyChecker, obj, propertyKey) {\n        this.dirtyChecker = dirtyChecker;\n        this.obj = obj;\n        this.propertyKey = propertyKey;\n    }\n    isDirty() {\n        return this.oldValue !== this.obj[this.propertyKey];\n    }\n    flush(flags) {\n        const oldValue = this.oldValue;\n        const newValue = this.obj[this.propertyKey];\n        this.callSubscribers(newValue, oldValue, flags | 16 /* updateTargetInstance */);\n        this.oldValue = newValue;\n    }\n    subscribe(subscriber) {\n        if (!this.hasSubscribers()) {\n            this.oldValue = this.obj[this.propertyKey];\n            this.dirtyChecker.addProperty(this);\n        }\n        this.addSubscriber(subscriber);\n    }\n    unsubscribe(subscriber) {\n        if (this.removeSubscriber(subscriber) && !this.hasSubscribers()) {\n            this.dirtyChecker.removeProperty(this);\n        }\n    }\n};\nDirtyCheckProperty = __decorate([\n    subscriberCollection(),\n    __metadata(\"design:paramtypes\", [Object, Object, String])\n], DirtyCheckProperty);\nexport { DirtyCheckProperty };\n//# sourceMappingURL=dirty-checker.js.map","import { __decorate, __metadata } from \"tslib\";\nimport { subscriberCollection } from './subscriber-collection';\nlet CollectionSizeObserver = class CollectionSizeObserver {\n    constructor(obj) {\n        this.obj = obj;\n        this.currentValue = obj.size;\n    }\n    getValue() {\n        return this.obj.size;\n    }\n    setValue(newValue, flags) {\n        const { currentValue } = this;\n        if (newValue !== currentValue) {\n            this.currentValue = newValue;\n            this.callSubscribers(newValue, currentValue, flags | 16 /* updateTargetInstance */);\n        }\n    }\n};\nCollectionSizeObserver = __decorate([\n    subscriberCollection(),\n    __metadata(\"design:paramtypes\", [Object])\n], CollectionSizeObserver);\nexport { CollectionSizeObserver };\n//# sourceMappingURL=collection-size-observer.js.map","import { __decorate, __metadata } from \"tslib\";\nimport { ILifecycle } from '../lifecycle';\nimport { createIndexMap } from '../observation';\nimport { CollectionSizeObserver } from './collection-size-observer';\nimport { collectionSubscriberCollection } from './subscriber-collection';\nconst observerLookup = new WeakMap();\nconst proto = Map.prototype;\nconst $set = proto.set;\nconst $clear = proto.clear;\nconst $delete = proto.delete;\nconst native = { set: $set, clear: $clear, delete: $delete };\nconst methods = ['set', 'clear', 'delete'];\n// note: we can't really do much with Map due to the internal data structure not being accessible so we're just using the native calls\n// fortunately, map/delete/clear are easy to reconstruct for the indexMap\nconst observe = {\n    // https://tc39.github.io/ecma262/#sec-map.prototype.map\n    set: function (key, value) {\n        let $this = this;\n        if ($this.$raw !== undefined) {\n            $this = $this.$raw;\n        }\n        const o = observerLookup.get($this);\n        if (o === undefined) {\n            $set.call($this, key, value);\n            return this;\n        }\n        const oldValue = $this.get(key);\n        const oldSize = $this.size;\n        $set.call($this, key, value);\n        const newSize = $this.size;\n        if (newSize === oldSize) {\n            let i = 0;\n            for (const entry of $this.entries()) {\n                if (entry[0] === key) {\n                    if (entry[1] !== oldValue) {\n                        o.indexMap.deletedItems.push(o.indexMap[i]);\n                        o.indexMap[i] = -2;\n                        o.notify();\n                    }\n                    return this;\n                }\n                i++;\n            }\n            return this;\n        }\n        o.indexMap[oldSize] = -2;\n        o.notify();\n        return this;\n    },\n    // https://tc39.github.io/ecma262/#sec-map.prototype.clear\n    clear: function () {\n        let $this = this;\n        if ($this.$raw !== undefined) {\n            $this = $this.$raw;\n        }\n        const o = observerLookup.get($this);\n        if (o === undefined) {\n            return $clear.call($this);\n        }\n        const size = $this.size;\n        if (size > 0) {\n            const indexMap = o.indexMap;\n            let i = 0;\n            for (const entry of $this.keys()) {\n                if (indexMap[i] > -1) {\n                    indexMap.deletedItems.push(indexMap[i]);\n                }\n                i++;\n            }\n            $clear.call($this);\n            indexMap.length = 0;\n            o.notify();\n        }\n        return undefined;\n    },\n    // https://tc39.github.io/ecma262/#sec-map.prototype.delete\n    delete: function (value) {\n        let $this = this;\n        if ($this.$raw !== undefined) {\n            $this = $this.$raw;\n        }\n        const o = observerLookup.get($this);\n        if (o === undefined) {\n            return $delete.call($this, value);\n        }\n        const size = $this.size;\n        if (size === 0) {\n            return false;\n        }\n        let i = 0;\n        const indexMap = o.indexMap;\n        for (const entry of $this.keys()) {\n            if (entry === value) {\n                if (indexMap[i] > -1) {\n                    indexMap.deletedItems.push(indexMap[i]);\n                }\n                indexMap.splice(i, 1);\n                const deleteResult = $delete.call($this, value);\n                if (deleteResult === true) {\n                    o.notify();\n                }\n                return deleteResult;\n            }\n            ++i;\n        }\n        return false;\n    }\n};\nconst descriptorProps = {\n    writable: true,\n    enumerable: false,\n    configurable: true\n};\nconst def = Reflect.defineProperty;\nfor (const method of methods) {\n    def(observe[method], 'observing', { value: true, writable: false, configurable: false, enumerable: false });\n}\nlet enableMapObservationCalled = false;\nexport function enableMapObservation() {\n    for (const method of methods) {\n        if (proto[method].observing !== true) {\n            def(proto, method, { ...descriptorProps, value: observe[method] });\n        }\n    }\n}\nexport function disableMapObservation() {\n    for (const method of methods) {\n        if (proto[method].observing === true) {\n            def(proto, method, { ...descriptorProps, value: native[method] });\n        }\n    }\n}\nconst slice = Array.prototype.slice;\nlet MapObserver = class MapObserver {\n    constructor(flags, lifecycle, map) {\n        if (!enableMapObservationCalled) {\n            enableMapObservationCalled = true;\n            enableMapObservation();\n        }\n        this.inBatch = false;\n        this.collection = map;\n        this.persistentFlags = flags & 2080374799 /* persistentBindingFlags */;\n        this.indexMap = createIndexMap(map.size);\n        this.lifecycle = lifecycle;\n        this.lengthObserver = (void 0);\n        observerLookup.set(map, this);\n    }\n    notify() {\n        if (this.lifecycle.batch.depth > 0) {\n            if (!this.inBatch) {\n                this.inBatch = true;\n                this.lifecycle.batch.add(this);\n            }\n        }\n        else {\n            this.flushBatch(0 /* none */);\n        }\n    }\n    getLengthObserver() {\n        if (this.lengthObserver === void 0) {\n            this.lengthObserver = new CollectionSizeObserver(this.collection);\n        }\n        return this.lengthObserver;\n    }\n    getIndexObserver(index) {\n        throw new Error('Map index observation not supported');\n    }\n    flushBatch(flags) {\n        this.inBatch = false;\n        const { indexMap, collection } = this;\n        const { size } = collection;\n        this.indexMap = createIndexMap(size);\n        this.callCollectionSubscribers(indexMap, 16 /* updateTargetInstance */ | this.persistentFlags);\n        if (this.lengthObserver !== void 0) {\n            this.lengthObserver.setValue(size, 16 /* updateTargetInstance */);\n        }\n    }\n};\nMapObserver = __decorate([\n    collectionSubscriberCollection(),\n    __metadata(\"design:paramtypes\", [Number, Object, Object])\n], MapObserver);\nexport { MapObserver };\nexport function getMapObserver(flags, lifecycle, map) {\n    const observer = observerLookup.get(map);\n    if (observer === void 0) {\n        return new MapObserver(flags, lifecycle, map);\n    }\n    return observer;\n}\n//# sourceMappingURL=map-observer.js.map","import { PLATFORM } from '@aurelia/kernel';\nconst slice = Array.prototype.slice;\nconst noop = PLATFORM.noop;\n// note: string.length is the only property of any primitive that is not a function,\n// so we can hardwire it to that and simply return undefined for anything else\n// note#2: a modified primitive constructor prototype would not work (and really, it shouldn't..)\nexport class PrimitiveObserver {\n    constructor(obj, propertyKey) {\n        this.doNotCache = true;\n        // we don't need to store propertyName because only 'length' can return a useful value\n        if (propertyKey === 'length') {\n            // deliberately not checking for typeof string as users probably still want to know via an error that their string is undefined\n            this.obj = obj;\n            this.getValue = this.getStringLength;\n        }\n        else {\n            this.getValue = this.returnUndefined;\n        }\n    }\n    getStringLength() {\n        return this.obj.length;\n    }\n    returnUndefined() {\n        return undefined;\n    }\n}\nPrimitiveObserver.prototype.setValue = noop;\nPrimitiveObserver.prototype.subscribe = noop;\nPrimitiveObserver.prototype.unsubscribe = noop;\nPrimitiveObserver.prototype.dispose = noop;\n//# sourceMappingURL=primitive-observer.js.map","export class PropertyAccessor {\n    constructor(obj, propertyKey) {\n        this.obj = obj;\n        this.propertyKey = propertyKey;\n        if (obj.$observers !== void 0\n            && obj.$observers[propertyKey] !== void 0\n            && obj.$observers[propertyKey].setValue !== void 0) {\n            this.setValue = this.setValueDirect;\n        }\n    }\n    getValue() {\n        return this.obj[this.propertyKey];\n    }\n    setValue(value, flags) {\n        this.obj[this.propertyKey] = value;\n    }\n    setValueDirect(value, flags) {\n        this.obj.$observers[this.propertyKey].setValue(value, flags);\n    }\n}\n//# sourceMappingURL=property-accessor.js.map","import { __decorate, __metadata } from \"tslib\";\nimport { ILifecycle } from '../lifecycle';\nimport { createIndexMap } from '../observation';\nimport { CollectionSizeObserver } from './collection-size-observer';\nimport { collectionSubscriberCollection } from './subscriber-collection';\nconst observerLookup = new WeakMap();\nconst proto = Set.prototype;\nconst $add = proto.add;\nconst $clear = proto.clear;\nconst $delete = proto.delete;\nconst native = { add: $add, clear: $clear, delete: $delete };\nconst methods = ['add', 'clear', 'delete'];\n// note: we can't really do much with Set due to the internal data structure not being accessible so we're just using the native calls\n// fortunately, add/delete/clear are easy to reconstruct for the indexMap\nconst observe = {\n    // https://tc39.github.io/ecma262/#sec-set.prototype.add\n    add: function (value) {\n        let $this = this;\n        if ($this.$raw !== undefined) {\n            $this = $this.$raw;\n        }\n        const o = observerLookup.get($this);\n        if (o === undefined) {\n            $add.call($this, value);\n            return this;\n        }\n        const oldSize = $this.size;\n        $add.call($this, value);\n        const newSize = $this.size;\n        if (newSize === oldSize) {\n            return this;\n        }\n        o.indexMap[oldSize] = -2;\n        o.notify();\n        return this;\n    },\n    // https://tc39.github.io/ecma262/#sec-set.prototype.clear\n    clear: function () {\n        let $this = this;\n        if ($this.$raw !== undefined) {\n            $this = $this.$raw;\n        }\n        const o = observerLookup.get($this);\n        if (o === undefined) {\n            return $clear.call($this);\n        }\n        const size = $this.size;\n        if (size > 0) {\n            const indexMap = o.indexMap;\n            let i = 0;\n            for (const entry of $this.keys()) {\n                if (indexMap[i] > -1) {\n                    indexMap.deletedItems.push(indexMap[i]);\n                }\n                i++;\n            }\n            $clear.call($this);\n            indexMap.length = 0;\n            o.notify();\n        }\n        return undefined;\n    },\n    // https://tc39.github.io/ecma262/#sec-set.prototype.delete\n    delete: function (value) {\n        let $this = this;\n        if ($this.$raw !== undefined) {\n            $this = $this.$raw;\n        }\n        const o = observerLookup.get($this);\n        if (o === undefined) {\n            return $delete.call($this, value);\n        }\n        const size = $this.size;\n        if (size === 0) {\n            return false;\n        }\n        let i = 0;\n        const indexMap = o.indexMap;\n        for (const entry of $this.keys()) {\n            if (entry === value) {\n                if (indexMap[i] > -1) {\n                    indexMap.deletedItems.push(indexMap[i]);\n                }\n                indexMap.splice(i, 1);\n                const deleteResult = $delete.call($this, value);\n                if (deleteResult === true) {\n                    o.notify();\n                }\n                return deleteResult;\n            }\n            i++;\n        }\n        return false;\n    }\n};\nconst descriptorProps = {\n    writable: true,\n    enumerable: false,\n    configurable: true\n};\nconst def = Reflect.defineProperty;\nfor (const method of methods) {\n    def(observe[method], 'observing', { value: true, writable: false, configurable: false, enumerable: false });\n}\nlet enableSetObservationCalled = false;\nexport function enableSetObservation() {\n    for (const method of methods) {\n        if (proto[method].observing !== true) {\n            def(proto, method, { ...descriptorProps, value: observe[method] });\n        }\n    }\n}\nexport function disableSetObservation() {\n    for (const method of methods) {\n        if (proto[method].observing === true) {\n            def(proto, method, { ...descriptorProps, value: native[method] });\n        }\n    }\n}\nconst slice = Array.prototype.slice;\nlet SetObserver = class SetObserver {\n    constructor(flags, lifecycle, observedSet) {\n        if (!enableSetObservationCalled) {\n            enableSetObservationCalled = true;\n            enableSetObservation();\n        }\n        this.inBatch = false;\n        this.collection = observedSet;\n        this.persistentFlags = flags & 2080374799 /* persistentBindingFlags */;\n        this.indexMap = createIndexMap(observedSet.size);\n        this.lifecycle = lifecycle;\n        this.lengthObserver = (void 0);\n        observerLookup.set(observedSet, this);\n    }\n    notify() {\n        if (this.lifecycle.batch.depth > 0) {\n            if (!this.inBatch) {\n                this.inBatch = true;\n                this.lifecycle.batch.add(this);\n            }\n        }\n        else {\n            this.flushBatch(0 /* none */);\n        }\n    }\n    getLengthObserver() {\n        if (this.lengthObserver === void 0) {\n            this.lengthObserver = new CollectionSizeObserver(this.collection);\n        }\n        return this.lengthObserver;\n    }\n    getIndexObserver(index) {\n        throw new Error('Set index observation not supported');\n    }\n    flushBatch(flags) {\n        this.inBatch = false;\n        const { indexMap, collection } = this;\n        const { size } = collection;\n        this.indexMap = createIndexMap(size);\n        this.callCollectionSubscribers(indexMap, 16 /* updateTargetInstance */ | this.persistentFlags);\n        if (this.lengthObserver !== void 0) {\n            this.lengthObserver.setValue(size, 16 /* updateTargetInstance */);\n        }\n    }\n};\nSetObserver = __decorate([\n    collectionSubscriberCollection(),\n    __metadata(\"design:paramtypes\", [Number, Object, Object])\n], SetObserver);\nexport { SetObserver };\nexport function getSetObserver(flags, lifecycle, observedSet) {\n    const observer = observerLookup.get(observedSet);\n    if (observer === void 0) {\n        return new SetObserver(flags, lifecycle, observedSet);\n    }\n    return observer;\n}\n//# sourceMappingURL=set-observer.js.map","import { __decorate, __metadata, __param } from \"tslib\";\nimport { DI, Registration, Reporter, isArrayIndex, } from '@aurelia/kernel';\nimport { ILifecycle } from '../lifecycle';\nimport { getArrayObserver } from './array-observer';\nimport { createComputedObserver } from './computed-observer';\nimport { IDirtyChecker } from './dirty-checker';\nimport { getMapObserver } from './map-observer';\nimport { PrimitiveObserver } from './primitive-observer';\nimport { PropertyAccessor } from './property-accessor';\nimport { ProxyObserver } from './proxy-observer';\nimport { getSetObserver } from './set-observer';\nimport { SetterObserver } from './setter-observer';\nimport { IScheduler } from '../scheduler';\nconst toStringTag = Object.prototype.toString;\nexport const IObserverLocator = DI.createInterface('IObserverLocator').noDefault();\nexport const ITargetObserverLocator = DI.createInterface('ITargetObserverLocator').noDefault();\nexport const ITargetAccessorLocator = DI.createInterface('ITargetAccessorLocator').noDefault();\nfunction getPropertyDescriptor(subject, name) {\n    let pd = Object.getOwnPropertyDescriptor(subject, name);\n    let proto = Object.getPrototypeOf(subject);\n    while (pd == null && proto != null) {\n        pd = Object.getOwnPropertyDescriptor(proto, name);\n        proto = Object.getPrototypeOf(proto);\n    }\n    return pd;\n}\n/** @internal */\nlet ObserverLocator = class ObserverLocator {\n    constructor(lifecycle, scheduler, dirtyChecker, targetObserverLocator, targetAccessorLocator) {\n        this.lifecycle = lifecycle;\n        this.scheduler = scheduler;\n        this.dirtyChecker = dirtyChecker;\n        this.targetObserverLocator = targetObserverLocator;\n        this.targetAccessorLocator = targetAccessorLocator;\n        this.adapters = [];\n    }\n    static register(container) {\n        return Registration.singleton(IObserverLocator, this).register(container);\n    }\n    getObserver(flags, obj, propertyName) {\n        if (flags & 2 /* proxyStrategy */ && typeof obj === 'object') {\n            return ProxyObserver.getOrCreate(obj, propertyName); // TODO: fix typings (and ensure proper contracts ofc)\n        }\n        if (isBindingContext(obj)) {\n            return obj.getObservers(flags).getOrCreate(this.lifecycle, flags, obj, propertyName);\n        }\n        let observersLookup = obj.$observers;\n        if (observersLookup && propertyName in observersLookup) {\n            return observersLookup[propertyName];\n        }\n        const observer = this.createPropertyObserver(flags, obj, propertyName);\n        if (!observer.doNotCache) {\n            if (observersLookup === void 0) {\n                observersLookup = this.getOrCreateObserversLookup(obj);\n            }\n            observersLookup[propertyName] = observer;\n        }\n        return observer;\n    }\n    addAdapter(adapter) {\n        this.adapters.push(adapter);\n    }\n    getAccessor(flags, obj, propertyName) {\n        if (this.targetAccessorLocator.handles(flags, obj)) {\n            if (this.targetObserverLocator.overridesAccessor(flags, obj, propertyName)) {\n                return this.getObserver(flags, obj, propertyName);\n            }\n            return this.targetAccessorLocator.getAccessor(flags, this.scheduler, this.lifecycle, obj, propertyName);\n        }\n        if (flags & 2 /* proxyStrategy */) {\n            return ProxyObserver.getOrCreate(obj, propertyName);\n        }\n        return new PropertyAccessor(obj, propertyName);\n    }\n    getArrayObserver(flags, observedArray) {\n        return getArrayObserver(flags, this.lifecycle, observedArray);\n    }\n    getMapObserver(flags, observedMap) {\n        return getMapObserver(flags, this.lifecycle, observedMap);\n    }\n    getSetObserver(flags, observedSet) {\n        return getSetObserver(flags, this.lifecycle, observedSet);\n    }\n    getOrCreateObserversLookup(obj) {\n        return obj.$observers || this.createObserversLookup(obj);\n    }\n    createObserversLookup(obj) {\n        const value = {};\n        if (!Reflect.defineProperty(obj, '$observers', {\n            enumerable: false,\n            configurable: false,\n            writable: false,\n            value: value\n        })) {\n            Reporter.write(0, obj);\n        }\n        return value;\n    }\n    getAdapterObserver(flags, obj, propertyName, descriptor) {\n        for (let i = 0, ii = this.adapters.length; i < ii; i++) {\n            const adapter = this.adapters[i];\n            const observer = adapter.getObserver(flags, obj, propertyName, descriptor);\n            if (observer != null) {\n                return observer;\n            }\n        }\n        return null;\n    }\n    createPropertyObserver(flags, obj, propertyName) {\n        if (!(obj instanceof Object)) {\n            return new PrimitiveObserver(obj, propertyName);\n        }\n        let isNode = false;\n        if (this.targetObserverLocator.handles(flags, obj)) {\n            const observer = this.targetObserverLocator.getObserver(flags, this.scheduler, this.lifecycle, this, obj, propertyName);\n            if (observer != null) {\n                return observer;\n            }\n            isNode = true;\n        }\n        const tag = toStringTag.call(obj);\n        switch (tag) {\n            case '[object Array]':\n                if (propertyName === 'length') {\n                    return this.getArrayObserver(flags, obj).getLengthObserver();\n                }\n                // is numer only returns true for integer\n                if (isArrayIndex(propertyName)) {\n                    return this.getArrayObserver(flags, obj).getIndexObserver(Number(propertyName));\n                }\n                break;\n            case '[object Map]':\n                if (propertyName === 'size') {\n                    return this.getMapObserver(flags, obj).getLengthObserver();\n                }\n                break;\n            case '[object Set]':\n                if (propertyName === 'size') {\n                    return this.getSetObserver(flags, obj).getLengthObserver();\n                }\n                break;\n        }\n        const descriptor = getPropertyDescriptor(obj, propertyName);\n        if (descriptor != null && (descriptor.get != null || descriptor.set != null)) {\n            if (descriptor.get != null && descriptor.get.getObserver != null) {\n                return descriptor.get.getObserver(obj);\n            }\n            // attempt to use an adapter before resorting to dirty checking.\n            const adapterObserver = this.getAdapterObserver(flags, obj, propertyName, descriptor);\n            if (adapterObserver != null) {\n                return adapterObserver;\n            }\n            if (isNode) {\n                // TODO: use MutationObserver\n                return this.dirtyChecker.createProperty(obj, propertyName);\n            }\n            return createComputedObserver(flags, this, this.dirtyChecker, this.lifecycle, obj, propertyName, descriptor);\n        }\n        return new SetterObserver(this.lifecycle, flags, obj, propertyName);\n    }\n};\nObserverLocator = __decorate([\n    __param(0, ILifecycle),\n    __param(1, IScheduler),\n    __param(2, IDirtyChecker),\n    __param(3, ITargetObserverLocator),\n    __param(4, ITargetAccessorLocator),\n    __metadata(\"design:paramtypes\", [Object, Object, Object, Object, Object])\n], ObserverLocator);\nexport { ObserverLocator };\nexport function getCollectionObserver(flags, lifecycle, collection) {\n    // If the collection is wrapped by a proxy then `$observer` will return the proxy observer instead of the collection observer, which is not what we want\n    // when we ask for getCollectionObserver\n    const rawCollection = collection instanceof Object ? ProxyObserver.getRawIfProxy(collection) : collection;\n    switch (toStringTag.call(collection)) {\n        case '[object Array]':\n            return getArrayObserver(flags, lifecycle, rawCollection);\n        case '[object Map]':\n            return getMapObserver(flags, lifecycle, rawCollection);\n        case '[object Set]':\n            return getSetObserver(flags, lifecycle, rawCollection);\n    }\n    return void 0;\n}\nfunction isBindingContext(obj) {\n    return obj.$synthetic === true;\n}\n//# sourceMappingURL=observer-locator.js.map","import { __decorate, __metadata } from \"tslib\";\nimport { IServiceLocator, Reporter, } from '@aurelia/kernel';\nimport { BindingMode, } from '../flags';\nimport { ILifecycle } from '../lifecycle';\nimport { IObserverLocator } from '../observation/observer-locator';\nimport { hasBind, hasUnbind, } from './ast';\nimport { connectable, } from './connectable';\n// BindingMode is not a const enum (and therefore not inlined), so assigning them to a variable to save a member accessor is a minor perf tweak\nconst { oneTime, toView, fromView } = BindingMode;\n// pre-combining flags for bitwise checks is a minor perf tweak\nconst toViewOrOneTime = toView | oneTime;\nlet PropertyBinding = class PropertyBinding {\n    constructor(sourceExpression, target, targetProperty, mode, observerLocator, locator) {\n        this.sourceExpression = sourceExpression;\n        this.target = target;\n        this.targetProperty = targetProperty;\n        this.mode = mode;\n        this.observerLocator = observerLocator;\n        this.locator = locator;\n        this.interceptor = this;\n        this.$state = 0 /* none */;\n        this.$scope = void 0;\n        this.targetObserver = void 0;\n        this.persistentFlags = 0 /* none */;\n        connectable.assignIdTo(this);\n        this.$lifecycle = locator.get(ILifecycle);\n    }\n    ;\n    updateTarget(value, flags) {\n        flags |= this.persistentFlags;\n        this.targetObserver.setValue(value, flags);\n    }\n    updateSource(value, flags) {\n        flags |= this.persistentFlags;\n        this.sourceExpression.assign(flags, this.$scope, this.locator, value, this.part);\n    }\n    handleChange(newValue, _previousValue, flags) {\n        if ((this.$state & 4 /* isBound */) === 0) {\n            return;\n        }\n        flags |= this.persistentFlags;\n        if ((flags & 16 /* updateTargetInstance */) > 0) {\n            const previousValue = this.targetObserver.getValue();\n            // if the only observable is an AccessScope then we can assume the passed-in newValue is the correct and latest value\n            if (this.sourceExpression.$kind !== 10082 /* AccessScope */ || this.observerSlots > 1) {\n                newValue = this.sourceExpression.evaluate(flags, this.$scope, this.locator, this.part);\n            }\n            if (newValue !== previousValue) {\n                this.interceptor.updateTarget(newValue, flags);\n            }\n            if ((this.mode & oneTime) === 0) {\n                this.version++;\n                this.sourceExpression.connect(flags, this.$scope, this.interceptor, this.part);\n                this.interceptor.unobserve(false);\n            }\n            return;\n        }\n        if ((flags & 32 /* updateSourceExpression */) > 0) {\n            if (newValue !== this.sourceExpression.evaluate(flags, this.$scope, this.locator, this.part)) {\n                this.interceptor.updateSource(newValue, flags);\n            }\n            return;\n        }\n        throw Reporter.error(15, flags);\n    }\n    $bind(flags, scope, part) {\n        if (this.$state & 4 /* isBound */) {\n            if (this.$scope === scope) {\n                return;\n            }\n            this.interceptor.$unbind(flags | 4096 /* fromBind */);\n        }\n        // add isBinding flag\n        this.$state |= 1 /* isBinding */;\n        // Force property binding to always be strict\n        flags |= 4 /* isStrictBindingStrategy */;\n        // Store flags which we can only receive during $bind and need to pass on\n        // to the AST during evaluate/connect/assign\n        this.persistentFlags = flags & 2080374799 /* persistentBindingFlags */;\n        this.$scope = scope;\n        this.part = part;\n        let sourceExpression = this.sourceExpression;\n        if (hasBind(sourceExpression)) {\n            sourceExpression.bind(flags, scope, this.interceptor);\n        }\n        let targetObserver = this.targetObserver;\n        if (!targetObserver) {\n            if (this.mode & fromView) {\n                targetObserver = this.targetObserver = this.observerLocator.getObserver(flags, this.target, this.targetProperty);\n            }\n            else {\n                targetObserver = this.targetObserver = this.observerLocator.getAccessor(flags, this.target, this.targetProperty);\n            }\n        }\n        if (this.mode !== BindingMode.oneTime && targetObserver.bind) {\n            targetObserver.bind(flags);\n        }\n        // during bind, binding behavior might have changed sourceExpression\n        sourceExpression = this.sourceExpression;\n        if (this.mode & toViewOrOneTime) {\n            this.interceptor.updateTarget(sourceExpression.evaluate(flags, scope, this.locator, part), flags);\n        }\n        if (this.mode & toView) {\n            sourceExpression.connect(flags, scope, this.interceptor, part);\n        }\n        if (this.mode & fromView) {\n            targetObserver.subscribe(this.interceptor);\n            targetObserver[this.id] |= 32 /* updateSourceExpression */;\n        }\n        // add isBound flag and remove isBinding flag\n        this.$state |= 4 /* isBound */;\n        this.$state &= ~1 /* isBinding */;\n    }\n    $unbind(flags) {\n        if (!(this.$state & 4 /* isBound */)) {\n            return;\n        }\n        // add isUnbinding flag\n        this.$state |= 2 /* isUnbinding */;\n        // clear persistent flags\n        this.persistentFlags = 0 /* none */;\n        if (hasUnbind(this.sourceExpression)) {\n            this.sourceExpression.unbind(flags, this.$scope, this.interceptor);\n        }\n        this.$scope = void 0;\n        if (this.targetObserver.unbind) {\n            this.targetObserver.unbind(flags);\n        }\n        if (this.targetObserver.unsubscribe) {\n            this.targetObserver.unsubscribe(this.interceptor);\n            this.targetObserver[this.id] &= ~32 /* updateSourceExpression */;\n        }\n        this.interceptor.unobserve(true);\n        // remove isBound and isUnbinding flags\n        this.$state &= ~(4 /* isBound */ | 2 /* isUnbinding */);\n    }\n};\nPropertyBinding = __decorate([\n    connectable(),\n    __metadata(\"design:paramtypes\", [Object, Object, String, Number, Object, Object])\n], PropertyBinding);\nexport { PropertyBinding };\n//# sourceMappingURL=property-binding.js.map","import { hasBind, hasUnbind, } from './ast';\nexport class CallBinding {\n    constructor(sourceExpression, target, targetProperty, observerLocator, locator) {\n        this.sourceExpression = sourceExpression;\n        this.locator = locator;\n        this.interceptor = this;\n        this.$state = 0 /* none */;\n        this.targetObserver = observerLocator.getObserver(0 /* none */, target, targetProperty);\n    }\n    callSource(args) {\n        const overrideContext = this.$scope.overrideContext;\n        Object.assign(overrideContext, args);\n        const result = this.sourceExpression.evaluate(2097152 /* mustEvaluate */, this.$scope, this.locator, this.part);\n        for (const prop in args) {\n            Reflect.deleteProperty(overrideContext, prop);\n        }\n        return result;\n    }\n    $bind(flags, scope, part) {\n        if (this.$state & 4 /* isBound */) {\n            if (this.$scope === scope) {\n                return;\n            }\n            this.interceptor.$unbind(flags | 4096 /* fromBind */);\n        }\n        // add isBinding flag\n        this.$state |= 1 /* isBinding */;\n        this.$scope = scope;\n        this.part = part;\n        if (hasBind(this.sourceExpression)) {\n            this.sourceExpression.bind(flags, scope, this.interceptor);\n        }\n        this.targetObserver.setValue(($args) => this.interceptor.callSource($args), flags);\n        // add isBound flag and remove isBinding flag\n        this.$state |= 4 /* isBound */;\n        this.$state &= ~1 /* isBinding */;\n    }\n    $unbind(flags) {\n        if (!(this.$state & 4 /* isBound */)) {\n            return;\n        }\n        // add isUnbinding flag\n        this.$state |= 2 /* isUnbinding */;\n        if (hasUnbind(this.sourceExpression)) {\n            this.sourceExpression.unbind(flags, this.$scope, this.interceptor);\n        }\n        this.$scope = void 0;\n        this.targetObserver.setValue(null, flags);\n        // remove isBound and isUnbinding flags\n        this.$state &= ~(4 /* isBound */ | 2 /* isUnbinding */);\n    }\n    observeProperty(flags, obj, propertyName) {\n        return;\n    }\n    handleChange(newValue, previousValue, flags) {\n        return;\n    }\n}\n//# sourceMappingURL=call-binding.js.map","import { DI, PLATFORM, Reporter, } from '@aurelia/kernel';\nimport { AccessMemberExpression, AccessScopeExpression, CallMemberExpression, CallScopeExpression, PrimitiveLiteralExpression, } from './ast';\nexport const IExpressionParser = DI.createInterface('IExpressionParser').withDefault(x => x.singleton(ExpressionParser));\n/** @internal */\nexport class ExpressionParser {\n    constructor() {\n        this.expressionLookup = Object.create(null);\n        this.forOfLookup = Object.create(null);\n        this.interpolationLookup = Object.create(null);\n    }\n    parse(expression, bindingType) {\n        switch (bindingType) {\n            case 2048 /* Interpolation */: {\n                let found = this.interpolationLookup[expression];\n                if (found === void 0) {\n                    found = this.interpolationLookup[expression] = this.parseCore(expression, bindingType);\n                }\n                return found;\n            }\n            case 539 /* ForCommand */: {\n                let found = this.forOfLookup[expression];\n                if (found === void 0) {\n                    found = this.forOfLookup[expression] = this.parseCore(expression, bindingType);\n                }\n                return found;\n            }\n            default: {\n                // Allow empty strings for normal bindings and those that are empty by default (such as a custom attribute without an equals sign)\n                // But don't cache it, because empty strings are always invalid for any other type of binding\n                if (expression.length === 0 && (bindingType & (53 /* BindCommand */ | 49 /* OneTimeCommand */ | 50 /* ToViewCommand */))) {\n                    return PrimitiveLiteralExpression.$empty;\n                }\n                let found = this.expressionLookup[expression];\n                if (found === void 0) {\n                    found = this.expressionLookup[expression] = this.parseCore(expression, bindingType);\n                }\n                return found;\n            }\n        }\n    }\n    cache(expressions) {\n        const { forOfLookup, expressionLookup, interpolationLookup } = this;\n        for (const expression in expressions) {\n            const expr = expressions[expression];\n            switch (expr.$kind) {\n                case 24 /* Interpolation */:\n                    interpolationLookup[expression] = expr;\n                    break;\n                case 6199 /* ForOfStatement */:\n                    forOfLookup[expression] = expr;\n                    break;\n                default:\n                    expressionLookup[expression] = expr;\n            }\n        }\n    }\n    parseCore(expression, bindingType) {\n        try {\n            const parts = expression.split('.');\n            const firstPart = parts[0];\n            let current;\n            if (firstPart.endsWith('()')) {\n                current = new CallScopeExpression(firstPart.replace('()', ''), PLATFORM.emptyArray);\n            }\n            else {\n                current = new AccessScopeExpression(parts[0]);\n            }\n            let index = 1;\n            while (index < parts.length) {\n                const currentPart = parts[index];\n                if (currentPart.endsWith('()')) {\n                    current = new CallMemberExpression(current, currentPart.replace('()', ''), PLATFORM.emptyArray);\n                }\n                else {\n                    current = new AccessMemberExpression(current, parts[index]);\n                }\n                index++;\n            }\n            return current;\n        }\n        catch (e) {\n            throw Reporter.error(3, e);\n        }\n    }\n}\n/* eslint-disable @typescript-eslint/indent */\nexport var BindingType;\n(function (BindingType) {\n    BindingType[BindingType[\"None\"] = 0] = \"None\";\n    BindingType[BindingType[\"IgnoreCustomAttr\"] = 4096] = \"IgnoreCustomAttr\";\n    BindingType[BindingType[\"Interpolation\"] = 2048] = \"Interpolation\";\n    BindingType[BindingType[\"IsRef\"] = 5376] = \"IsRef\";\n    BindingType[BindingType[\"IsIterator\"] = 512] = \"IsIterator\";\n    BindingType[BindingType[\"IsCustom\"] = 256] = \"IsCustom\";\n    BindingType[BindingType[\"IsFunction\"] = 128] = \"IsFunction\";\n    BindingType[BindingType[\"IsEvent\"] = 64] = \"IsEvent\";\n    BindingType[BindingType[\"IsProperty\"] = 32] = \"IsProperty\";\n    BindingType[BindingType[\"IsCommand\"] = 16] = \"IsCommand\";\n    BindingType[BindingType[\"IsPropertyCommand\"] = 48] = \"IsPropertyCommand\";\n    BindingType[BindingType[\"IsEventCommand\"] = 80] = \"IsEventCommand\";\n    BindingType[BindingType[\"DelegationStrategyDelta\"] = 6] = \"DelegationStrategyDelta\";\n    BindingType[BindingType[\"Command\"] = 15] = \"Command\";\n    BindingType[BindingType[\"OneTimeCommand\"] = 49] = \"OneTimeCommand\";\n    BindingType[BindingType[\"ToViewCommand\"] = 50] = \"ToViewCommand\";\n    BindingType[BindingType[\"FromViewCommand\"] = 51] = \"FromViewCommand\";\n    BindingType[BindingType[\"TwoWayCommand\"] = 52] = \"TwoWayCommand\";\n    BindingType[BindingType[\"BindCommand\"] = 53] = \"BindCommand\";\n    BindingType[BindingType[\"TriggerCommand\"] = 4182] = \"TriggerCommand\";\n    BindingType[BindingType[\"CaptureCommand\"] = 4183] = \"CaptureCommand\";\n    BindingType[BindingType[\"DelegateCommand\"] = 4184] = \"DelegateCommand\";\n    BindingType[BindingType[\"CallCommand\"] = 153] = \"CallCommand\";\n    BindingType[BindingType[\"OptionsCommand\"] = 26] = \"OptionsCommand\";\n    BindingType[BindingType[\"ForCommand\"] = 539] = \"ForCommand\";\n    BindingType[BindingType[\"CustomCommand\"] = 284] = \"CustomCommand\";\n})(BindingType || (BindingType = {}));\n/* eslint-enable @typescript-eslint/indent */\n//# sourceMappingURL=expression-parser.js.map","import { __decorate, __metadata } from \"tslib\";\nimport { IServiceLocator } from '@aurelia/kernel';\nimport { BindingMode, } from '../flags';\nimport { IObserverLocator } from '../observation/observer-locator';\nimport { connectable, } from './connectable';\nconst { toView, oneTime } = BindingMode;\nexport class MultiInterpolationBinding {\n    constructor(observerLocator, interpolation, target, targetProperty, mode, locator) {\n        this.observerLocator = observerLocator;\n        this.interpolation = interpolation;\n        this.target = target;\n        this.targetProperty = targetProperty;\n        this.mode = mode;\n        this.locator = locator;\n        this.interceptor = this;\n        this.$state = 0 /* none */;\n        this.$scope = void 0;\n        // Note: the child expressions of an Interpolation expression are full Aurelia expressions, meaning they may include\n        // value converters and binding behaviors.\n        // Each expression represents one ${interpolation}, and for each we create a child TextBinding unless there is only one,\n        // in which case the renderer will create the TextBinding directly\n        const expressions = interpolation.expressions;\n        const parts = this.parts = Array(expressions.length);\n        for (let i = 0, ii = expressions.length; i < ii; ++i) {\n            parts[i] = new InterpolationBinding(expressions[i], interpolation, target, targetProperty, mode, observerLocator, locator, i === 0);\n        }\n    }\n    ;\n    $bind(flags, scope, part) {\n        if (this.$state & 4 /* isBound */) {\n            if (this.$scope === scope) {\n                return;\n            }\n            this.interceptor.$unbind(flags);\n        }\n        this.$state |= 4 /* isBound */;\n        this.$scope = scope;\n        this.part = part;\n        const parts = this.parts;\n        for (let i = 0, ii = parts.length; i < ii; ++i) {\n            parts[i].interceptor.$bind(flags, scope, part);\n        }\n    }\n    $unbind(flags) {\n        if (!(this.$state & 4 /* isBound */)) {\n            return;\n        }\n        this.$state &= ~4 /* isBound */;\n        this.$scope = void 0;\n        const parts = this.parts;\n        for (let i = 0, ii = parts.length; i < ii; ++i) {\n            parts[i].interceptor.$unbind(flags);\n        }\n    }\n}\nlet InterpolationBinding = class InterpolationBinding {\n    constructor(sourceExpression, interpolation, target, targetProperty, mode, observerLocator, locator, isFirst) {\n        this.sourceExpression = sourceExpression;\n        this.interpolation = interpolation;\n        this.target = target;\n        this.targetProperty = targetProperty;\n        this.mode = mode;\n        this.observerLocator = observerLocator;\n        this.locator = locator;\n        this.isFirst = isFirst;\n        this.interceptor = this;\n        this.$state = 0 /* none */;\n        connectable.assignIdTo(this);\n        this.targetObserver = observerLocator.getAccessor(0 /* none */, target, targetProperty);\n    }\n    updateTarget(value, flags) {\n        this.targetObserver.setValue(value, flags | 16 /* updateTargetInstance */);\n    }\n    handleChange(_newValue, _previousValue, flags) {\n        if (!(this.$state & 4 /* isBound */)) {\n            return;\n        }\n        const previousValue = this.targetObserver.getValue();\n        const newValue = this.interpolation.evaluate(flags, this.$scope, this.locator, this.part);\n        if (newValue !== previousValue) {\n            this.interceptor.updateTarget(newValue, flags);\n        }\n        if ((this.mode & oneTime) === 0) {\n            this.version++;\n            this.sourceExpression.connect(flags, this.$scope, this.interceptor, this.part);\n            this.interceptor.unobserve(false);\n        }\n    }\n    $bind(flags, scope, part) {\n        if (this.$state & 4 /* isBound */) {\n            if (this.$scope === scope) {\n                return;\n            }\n            this.interceptor.$unbind(flags);\n        }\n        this.$state |= 4 /* isBound */;\n        this.$scope = scope;\n        this.part = part;\n        const sourceExpression = this.sourceExpression;\n        if (sourceExpression.bind) {\n            sourceExpression.bind(flags, scope, this.interceptor);\n        }\n        if (this.mode !== BindingMode.oneTime && this.targetObserver.bind) {\n            this.targetObserver.bind(flags);\n        }\n        // since the interpolation already gets the whole value, we only need to let the first\n        // text binding do the update if there are multiple\n        if (this.isFirst) {\n            this.interceptor.updateTarget(this.interpolation.evaluate(flags, scope, this.locator, part), flags);\n        }\n        if (this.mode & toView) {\n            sourceExpression.connect(flags, scope, this.interceptor, part);\n        }\n    }\n    $unbind(flags) {\n        if (!(this.$state & 4 /* isBound */)) {\n            return;\n        }\n        this.$state &= ~4 /* isBound */;\n        const sourceExpression = this.sourceExpression;\n        if (sourceExpression.unbind) {\n            sourceExpression.unbind(flags, this.$scope, this.interceptor);\n        }\n        if (this.targetObserver.unbind) {\n            this.targetObserver.unbind(flags);\n        }\n        this.$scope = void 0;\n        this.interceptor.unobserve(true);\n    }\n};\nInterpolationBinding = __decorate([\n    connectable(),\n    __metadata(\"design:paramtypes\", [Object, Object, Object, String, Number, Object, Object, Boolean])\n], InterpolationBinding);\nexport { InterpolationBinding };\n//# sourceMappingURL=interpolation-binding.js.map","import { __decorate, __metadata } from \"tslib\";\nimport { IServiceLocator, Reporter, } from '@aurelia/kernel';\nimport { ILifecycle, } from '../lifecycle';\nimport { IObserverLocator } from '../observation/observer-locator';\nimport { connectable, } from './connectable';\nlet LetBinding = class LetBinding {\n    constructor(sourceExpression, targetProperty, observerLocator, locator, toBindingContext = false) {\n        this.sourceExpression = sourceExpression;\n        this.targetProperty = targetProperty;\n        this.observerLocator = observerLocator;\n        this.locator = locator;\n        this.toBindingContext = toBindingContext;\n        this.interceptor = this;\n        this.$state = 0 /* none */;\n        this.$scope = void 0;\n        this.target = null;\n        connectable.assignIdTo(this);\n        this.$lifecycle = locator.get(ILifecycle);\n    }\n    handleChange(_newValue, _previousValue, flags) {\n        if (!(this.$state & 4 /* isBound */)) {\n            return;\n        }\n        if (flags & 16 /* updateTargetInstance */) {\n            const { target, targetProperty } = this;\n            const previousValue = target[targetProperty];\n            const newValue = this.sourceExpression.evaluate(flags, this.$scope, this.locator, this.part);\n            if (newValue !== previousValue) {\n                target[targetProperty] = newValue;\n            }\n            return;\n        }\n        throw Reporter.error(15, flags);\n    }\n    $bind(flags, scope, part) {\n        if (this.$state & 4 /* isBound */) {\n            if (this.$scope === scope) {\n                return;\n            }\n            this.interceptor.$unbind(flags | 4096 /* fromBind */);\n        }\n        // add isBinding flag\n        this.$state |= 1 /* isBinding */;\n        this.$scope = scope;\n        this.part = part;\n        this.target = (this.toBindingContext ? scope.bindingContext : scope.overrideContext);\n        const sourceExpression = this.sourceExpression;\n        if (sourceExpression.bind) {\n            sourceExpression.bind(flags, scope, this.interceptor);\n        }\n        // sourceExpression might have been changed during bind\n        this.target[this.targetProperty] = this.sourceExpression.evaluate(flags | 4096 /* fromBind */, scope, this.locator, part);\n        this.sourceExpression.connect(flags, scope, this.interceptor, part);\n        // add isBound flag and remove isBinding flag\n        this.$state |= 4 /* isBound */;\n        this.$state &= ~1 /* isBinding */;\n    }\n    $unbind(flags) {\n        if (!(this.$state & 4 /* isBound */)) {\n            return;\n        }\n        // add isUnbinding flag\n        this.$state |= 2 /* isUnbinding */;\n        const sourceExpression = this.sourceExpression;\n        if (sourceExpression.unbind) {\n            sourceExpression.unbind(flags, this.$scope, this.interceptor);\n        }\n        this.$scope = void 0;\n        this.interceptor.unobserve(true);\n        // remove isBound and isUnbinding flags\n        this.$state &= ~(4 /* isBound */ | 2 /* isUnbinding */);\n    }\n};\nLetBinding = __decorate([\n    connectable(),\n    __metadata(\"design:paramtypes\", [Object, String, Object, Object, Boolean])\n], LetBinding);\nexport { LetBinding };\n//# sourceMappingURL=let-binding.js.map","import { hasBind, hasUnbind, } from './ast';\nexport class RefBinding {\n    constructor(sourceExpression, target, locator) {\n        this.sourceExpression = sourceExpression;\n        this.target = target;\n        this.locator = locator;\n        this.interceptor = this;\n        this.$state = 0 /* none */;\n        this.$scope = void 0;\n    }\n    $bind(flags, scope, part) {\n        if (this.$state & 4 /* isBound */) {\n            if (this.$scope === scope) {\n                return;\n            }\n            this.interceptor.$unbind(flags | 4096 /* fromBind */);\n        }\n        // add isBinding flag\n        this.$state |= 1 /* isBinding */;\n        this.$scope = scope;\n        this.part = part;\n        if (hasBind(this.sourceExpression)) {\n            this.sourceExpression.bind(flags, scope, this);\n        }\n        this.sourceExpression.assign(flags | 32 /* updateSourceExpression */, this.$scope, this.locator, this.target, part);\n        // add isBound flag and remove isBinding flag\n        this.$state |= 4 /* isBound */;\n        this.$state &= ~1 /* isBinding */;\n    }\n    $unbind(flags) {\n        if (!(this.$state & 4 /* isBound */)) {\n            return;\n        }\n        // add isUnbinding flag\n        this.$state |= 2 /* isUnbinding */;\n        let sourceExpression = this.sourceExpression;\n        if (sourceExpression.evaluate(flags, this.$scope, this.locator, this.part) === this.target) {\n            sourceExpression.assign(flags, this.$scope, this.locator, null, this.part);\n        }\n        // source expression might have been modified durring assign, via a BB\n        sourceExpression = this.sourceExpression;\n        if (hasUnbind(sourceExpression)) {\n            sourceExpression.unbind(flags, this.$scope, this.interceptor);\n        }\n        this.$scope = void 0;\n        // remove isBound and isUnbinding flags\n        this.$state &= ~(4 /* isBound */ | 2 /* isUnbinding */);\n    }\n    observeProperty(flags, obj, propertyName) {\n        return;\n    }\n    handleChange(newValue, previousValue, flags) {\n        return;\n    }\n}\n//# sourceMappingURL=ref-binding.js.map","var BindableObserver_1;\nimport { __decorate, __metadata } from \"tslib\";\nimport { Reporter, PLATFORM } from '@aurelia/kernel';\nimport { ILifecycle } from '../lifecycle';\nimport { ProxyObserver } from './proxy-observer';\nimport { subscriberCollection } from './subscriber-collection';\nlet BindableObserver = BindableObserver_1 = class BindableObserver {\n    constructor(lifecycle, flags, obj, propertyKey, cbName, $set) {\n        this.lifecycle = lifecycle;\n        this.obj = obj;\n        this.propertyKey = propertyKey;\n        this.$set = $set;\n        this.currentValue = void 0;\n        this.oldValue = void 0;\n        this.inBatch = false;\n        let isProxy = false;\n        if (ProxyObserver.isProxy(obj)) {\n            isProxy = true;\n            obj.$observer.subscribe(this, propertyKey);\n            this.obj = obj.$raw;\n        }\n        this.callback = this.obj[cbName];\n        const propertyChangedCallback = this.propertyChangedCallback = this.obj.propertyChanged;\n        const hasPropertyChangedCallback = this.hasPropertyChangedCallback = typeof propertyChangedCallback === 'function';\n        const shouldInterceptSet = this.shouldInterceptSet = $set !== PLATFORM.noop;\n        // when user declare @bindable({ set })\n        // it's expected to work from the start,\n        // regardless where the assignment comes from: either direct view model assignment or from binding during render\n        // so if either getter/setter config is present, alter the accessor straight await\n        if (this.callback === void 0 && !hasPropertyChangedCallback && !shouldInterceptSet) {\n            this.observing = false;\n        }\n        else {\n            this.observing = true;\n            const currentValue = obj[propertyKey];\n            this.currentValue = shouldInterceptSet\n                ? currentValue\n                : $set(currentValue);\n            if (!isProxy) {\n                this.createGetterSetter();\n            }\n        }\n        this.persistentFlags = flags & 2080374799 /* persistentBindingFlags */;\n    }\n    handleChange(newValue, oldValue, flags) {\n        this.setValue(newValue, flags);\n    }\n    getValue() {\n        return this.currentValue;\n    }\n    setValue(newValue, flags) {\n        if (this.shouldInterceptSet) {\n            newValue = this.$set(newValue);\n        }\n        if (this.observing) {\n            const currentValue = this.currentValue;\n            // eslint-disable-next-line compat/compat\n            if (Object.is(newValue, currentValue)) {\n                return;\n            }\n            this.currentValue = newValue;\n            if (this.lifecycle.batch.depth === 0) {\n                this.callSubscribers(newValue, currentValue, this.persistentFlags | flags);\n                if ((flags & 4096 /* fromBind */) === 0 || (flags & 32 /* updateSourceExpression */) > 0) {\n                    const callback = this.callback;\n                    if (callback !== void 0) {\n                        callback.call(this.obj, newValue, currentValue, this.persistentFlags | flags);\n                    }\n                    if (this.hasPropertyChangedCallback) {\n                        // eslint-disable-next-line @typescript-eslint/no-unnecessary-type-assertion\n                        this.propertyChangedCallback.call(this.obj, this.propertyKey, newValue, currentValue, this.persistentFlags | flags);\n                    }\n                }\n            }\n            else if (!this.inBatch) {\n                this.inBatch = true;\n                this.oldValue = currentValue;\n                this.lifecycle.batch.add(this);\n            }\n        }\n        else {\n            // See SetterObserver.setValue for explanation\n            this.obj[this.propertyKey] = newValue;\n        }\n    }\n    subscribe(subscriber) {\n        if (this.observing === false) {\n            this.observing = true;\n            const currentValue = this.obj[this.propertyKey];\n            this.currentValue = this.shouldInterceptSet\n                ? this.$set(currentValue)\n                : currentValue;\n            this.createGetterSetter();\n        }\n        this.addSubscriber(subscriber);\n    }\n    createGetterSetter() {\n        if (!Reflect.defineProperty(this.obj, this.propertyKey, {\n            enumerable: true,\n            configurable: true,\n            get: () => this.currentValue,\n            set: (value) => {\n                this.setValue(value, 0 /* none */);\n            }\n        })) {\n            Reporter.write(1, this.propertyKey, this.obj);\n        }\n    }\n};\nBindableObserver = BindableObserver_1 = __decorate([\n    subscriberCollection(),\n    __metadata(\"design:paramtypes\", [Object, Number, Object, String, String, Function])\n], BindableObserver);\nexport { BindableObserver };\n//# sourceMappingURL=bindable-observer.js.map","import { __decorate, __metadata } from \"tslib\";\nimport { BindingMode } from '../../flags';\nimport { bindingBehavior } from '../binding-behavior';\nexport class BindingModeBehavior {\n    constructor(mode) {\n        this.mode = mode;\n        this.originalModes = new WeakMap();\n    }\n    bind(flags, scope, binding) {\n        this.originalModes.set(binding, binding.mode);\n        binding.mode = this.mode;\n    }\n    unbind(flags, scope, binding) {\n        binding.mode = this.originalModes.get(binding);\n    }\n}\nlet OneTimeBindingBehavior = class OneTimeBindingBehavior extends BindingModeBehavior {\n    constructor() {\n        super(BindingMode.oneTime);\n    }\n};\nOneTimeBindingBehavior = __decorate([\n    bindingBehavior('oneTime'),\n    __metadata(\"design:paramtypes\", [])\n], OneTimeBindingBehavior);\nexport { OneTimeBindingBehavior };\nlet ToViewBindingBehavior = class ToViewBindingBehavior extends BindingModeBehavior {\n    constructor() {\n        super(BindingMode.toView);\n    }\n};\nToViewBindingBehavior = __decorate([\n    bindingBehavior('toView'),\n    __metadata(\"design:paramtypes\", [])\n], ToViewBindingBehavior);\nexport { ToViewBindingBehavior };\nlet FromViewBindingBehavior = class FromViewBindingBehavior extends BindingModeBehavior {\n    constructor() {\n        super(BindingMode.fromView);\n    }\n};\nFromViewBindingBehavior = __decorate([\n    bindingBehavior('fromView'),\n    __metadata(\"design:paramtypes\", [])\n], FromViewBindingBehavior);\nexport { FromViewBindingBehavior };\nlet TwoWayBindingBehavior = class TwoWayBindingBehavior extends BindingModeBehavior {\n    constructor() {\n        super(BindingMode.twoWay);\n    }\n};\nTwoWayBindingBehavior = __decorate([\n    bindingBehavior('twoWay'),\n    __metadata(\"design:paramtypes\", [])\n], TwoWayBindingBehavior);\nexport { TwoWayBindingBehavior };\n//# sourceMappingURL=binding-mode.js.map","import { __decorate, __metadata } from \"tslib\";\nimport { bindingBehavior, BindingInterceptor } from '../binding-behavior';\nimport { IScheduler } from '../../scheduler';\nimport { BindingBehaviorExpression } from '../../binding/ast';\nlet DebounceBindingBehavior = class DebounceBindingBehavior extends BindingInterceptor {\n    constructor(binding, expr) {\n        super(binding, expr);\n        this.opts = { delay: 0 };\n        this.firstArg = null;\n        this.task = null;\n        this.taskQueue = binding.locator.get(IScheduler).getPostRenderTaskQueue();\n        if (expr.args.length > 0) {\n            this.firstArg = expr.args[0];\n        }\n    }\n    callSource(args) {\n        this.queueTask(() => this.binding.callSource(args));\n        return void 0;\n    }\n    handleChange(newValue, previousValue, flags) {\n        this.queueTask(() => this.binding.handleChange(newValue, previousValue, flags));\n    }\n    queueTask(callback) {\n        if (this.task !== null) {\n            this.task.cancel();\n        }\n        this.task = this.taskQueue.queueTask(callback, this.opts);\n    }\n    $bind(flags, scope, part) {\n        if (this.firstArg !== null) {\n            const delay = Number(this.firstArg.evaluate(flags, scope, this.locator, part));\n            if (!isNaN(delay)) {\n                this.opts.delay = delay;\n            }\n        }\n        this.binding.$bind(flags, scope, part);\n    }\n};\nDebounceBindingBehavior = __decorate([\n    bindingBehavior('debounce'),\n    __metadata(\"design:paramtypes\", [Object, BindingBehaviorExpression])\n], DebounceBindingBehavior);\nexport { DebounceBindingBehavior };\n//# sourceMappingURL=debounce.js.map","import { __decorate, __metadata, __param } from \"tslib\";\nimport { Reporter } from '@aurelia/kernel';\nimport { ISignaler } from '../../observation/signaler';\nimport { bindingBehavior } from '../binding-behavior';\nlet SignalBindingBehavior = class SignalBindingBehavior {\n    constructor(signaler) {\n        this.signaler = signaler;\n    }\n    bind(flags, scope, binding, ...args) {\n        if (!binding.updateTarget) {\n            throw Reporter.error(11);\n        }\n        if (arguments.length === 4) {\n            const name = args[0];\n            this.signaler.addSignalListener(name, binding);\n            binding.signal = name;\n        }\n        else if (arguments.length > 4) {\n            const names = Array.prototype.slice.call(args.length + 3, 3);\n            let i = names.length;\n            while (i--) {\n                const name = names[i];\n                this.signaler.addSignalListener(name, binding);\n            }\n            binding.signal = names;\n        }\n        else {\n            throw Reporter.error(12);\n        }\n    }\n    unbind(flags, scope, binding) {\n        const name = binding.signal;\n        binding.signal = null;\n        if (Array.isArray(name)) {\n            const names = name;\n            let i = names.length;\n            while (i--) {\n                this.signaler.removeSignalListener(names[i], binding);\n            }\n        }\n        else {\n            this.signaler.removeSignalListener(name, binding);\n        }\n    }\n};\nSignalBindingBehavior = __decorate([\n    bindingBehavior('signal'),\n    __param(0, ISignaler),\n    __metadata(\"design:paramtypes\", [Object])\n], SignalBindingBehavior);\nexport { SignalBindingBehavior };\n//# sourceMappingURL=signals.js.map","import { __decorate, __metadata } from \"tslib\";\nimport { bindingBehavior, BindingInterceptor } from '../binding-behavior';\nimport { IScheduler, IClock } from '../../scheduler';\nimport { BindingBehaviorExpression } from '../../binding/ast';\nlet ThrottleBindingBehavior = class ThrottleBindingBehavior extends BindingInterceptor {\n    constructor(binding, expr) {\n        super(binding, expr);\n        this.opts = { delay: 0 };\n        this.firstArg = null;\n        this.task = null;\n        this.lastCall = 0;\n        this.taskQueue = binding.locator.get(IScheduler).getPostRenderTaskQueue();\n        this.clock = binding.locator.get(IClock);\n        if (expr.args.length > 0) {\n            this.firstArg = expr.args[0];\n        }\n    }\n    callSource(args) {\n        this.queueTask(() => this.binding.callSource(args));\n        return void 0;\n    }\n    handleChange(newValue, previousValue, flags) {\n        this.queueTask(() => this.binding.handleChange(newValue, previousValue, flags));\n    }\n    queueTask(callback) {\n        const opts = this.opts;\n        const clock = this.clock;\n        const nextDelay = this.lastCall + opts.delay - clock.now();\n        if (nextDelay > 0) {\n            if (this.task !== null) {\n                this.task.cancel();\n            }\n            opts.delay = nextDelay;\n            this.task = this.taskQueue.queueTask(() => {\n                this.lastCall = clock.now();\n                callback();\n            }, opts);\n        }\n        else {\n            this.lastCall = clock.now();\n            callback();\n        }\n    }\n    $bind(flags, scope, part) {\n        if (this.firstArg !== null) {\n            const delay = Number(this.firstArg.evaluate(flags, scope, this.locator, part));\n            if (!isNaN(delay)) {\n                this.opts.delay = delay;\n            }\n        }\n        this.binding.$bind(flags, scope, part);\n    }\n};\nThrottleBindingBehavior = __decorate([\n    bindingBehavior('throttle'),\n    __metadata(\"design:paramtypes\", [Object, BindingBehaviorExpression])\n], ThrottleBindingBehavior);\nexport { ThrottleBindingBehavior };\n//# sourceMappingURL=throttle.js.map","import { __decorate, __metadata } from \"tslib\";\nimport { kebabCase, Metadata, Protocol, firstDefined, getPrototypeChain, PLATFORM, } from '@aurelia/kernel';\nimport { BindingMode, } from '../flags';\nexport function bindable(configOrTarget, prop) {\n    let config;\n    function decorator($target, $prop) {\n        if (arguments.length > 1) {\n            // Non invocation:\n            // - @bindable\n            // Invocation with or w/o opts:\n            // - @bindable()\n            // - @bindable({...opts})\n            config.property = $prop;\n        }\n        Metadata.define(Bindable.name, BindableDefinition.create($prop, config), $target.constructor, $prop);\n        Protocol.annotation.appendTo($target.constructor, Bindable.keyFrom($prop));\n    }\n    if (arguments.length > 1) {\n        // Non invocation:\n        // - @bindable\n        config = {};\n        decorator(configOrTarget, prop);\n        return;\n    }\n    else if (typeof configOrTarget === 'string') {\n        // ClassDecorator\n        // - @bindable('bar')\n        // Direct call:\n        // - @bindable('bar')(Foo)\n        config = {};\n        return decorator;\n    }\n    // Invocation with or w/o opts:\n    // - @bindable()\n    // - @bindable({...opts})\n    config = configOrTarget === void 0 ? {} : configOrTarget;\n    return decorator;\n}\nfunction isBindableAnnotation(key) {\n    return key.startsWith(Bindable.name);\n}\nexport const Bindable = {\n    name: Protocol.annotation.keyFor('bindable'),\n    keyFrom(name) {\n        return `${Bindable.name}:${name}`;\n    },\n    from(...bindableLists) {\n        const bindables = {};\n        // eslint-disable-next-line @typescript-eslint/unbound-method\n        const isArray = Array.isArray;\n        function addName(name) {\n            bindables[name] = BindableDefinition.create(name);\n        }\n        function addDescription(name, def) {\n            bindables[name] = def instanceof BindableDefinition ? def : BindableDefinition.create(name, def);\n        }\n        function addList(maybeList) {\n            if (isArray(maybeList)) {\n                maybeList.forEach(addName);\n            }\n            else if (maybeList instanceof BindableDefinition) {\n                bindables[maybeList.property] = maybeList;\n            }\n            else if (maybeList !== void 0) {\n                Object.keys(maybeList).forEach(name => addDescription(name, maybeList[name]));\n            }\n        }\n        bindableLists.forEach(addList);\n        return bindables;\n    },\n    for(Type) {\n        let def;\n        const builder = {\n            add(configOrProp) {\n                let prop;\n                let config;\n                if (typeof configOrProp === 'string') {\n                    prop = configOrProp;\n                    config = { property: prop };\n                }\n                else {\n                    prop = configOrProp.property;\n                    config = configOrProp;\n                }\n                def = BindableDefinition.create(prop, config);\n                if (!Metadata.hasOwn(Bindable.name, Type, prop)) {\n                    Protocol.annotation.appendTo(Type, Bindable.keyFrom(prop));\n                }\n                Metadata.define(Bindable.name, def, Type, prop);\n                return builder;\n            },\n            mode(mode) {\n                def.mode = mode;\n                return builder;\n            },\n            callback(callback) {\n                def.callback = callback;\n                return builder;\n            },\n            attribute(attribute) {\n                def.attribute = attribute;\n                return builder;\n            },\n            primary() {\n                def.primary = true;\n                return builder;\n            },\n            set(setInterpreter) {\n                def.set = setInterpreter;\n                return builder;\n            }\n        };\n        return builder;\n    },\n    getAll(Type) {\n        const propStart = Bindable.name.length + 1;\n        const defs = [];\n        const prototypeChain = getPrototypeChain(Type);\n        let iProto = prototypeChain.length;\n        let iDefs = 0;\n        let keys;\n        let keysLen;\n        let Class;\n        while (--iProto >= 0) {\n            Class = prototypeChain[iProto];\n            keys = Protocol.annotation.getKeys(Class).filter(isBindableAnnotation);\n            keysLen = keys.length;\n            for (let i = 0; i < keysLen; ++i) {\n                defs[iDefs++] = Metadata.getOwn(Bindable.name, Class, keys[i].slice(propStart));\n            }\n        }\n        return defs;\n    },\n};\nexport class BindableDefinition {\n    constructor(attribute, callback, mode, primary, property, set) {\n        this.attribute = attribute;\n        this.callback = callback;\n        this.mode = mode;\n        this.primary = primary;\n        this.property = property;\n        this.set = set;\n    }\n    static create(prop, def = {}) {\n        return new BindableDefinition(firstDefined(def.attribute, kebabCase(prop)), firstDefined(def.callback, `${prop}Changed`), firstDefined(def.mode, BindingMode.toView), firstDefined(def.primary, false), firstDefined(def.property, prop), firstDefined(def.set, PLATFORM.noop));\n    }\n}\n/* eslint-disable @typescript-eslint/no-unused-vars,spaced-comment */\n/**\n * This function serves two purposes:\n * - A playground for contributors to try their changes to the APIs.\n * - Cause the API surface to be properly type-checked and protected against accidental type regressions.\n *\n * It will be automatically removed by dead code elimination.\n */\nfunction apiTypeCheck() {\n    let Foo = \n    // > expected error - class decorator only accepts a string\n    //@bindable({})\n    class Foo {\n    };\n    __decorate([\n        bindable,\n        bindable(),\n        bindable({})\n        // > expected error - 'property' does not exist on decorator input object\n        //@bindable({ property: 'prop' })\n        ,\n        bindable({ mode: BindingMode.twoWay }),\n        bindable({ callback: 'propChanged' }),\n        bindable({ attribute: 'prop' }),\n        bindable({ primary: true }),\n        bindable({ set: value => String(value) }),\n        bindable({ set: value => Number(value) }),\n        bindable({\n            mode: BindingMode.twoWay,\n            callback: 'propChanged',\n            attribute: 'prop',\n            primary: true,\n            set: value => String(value)\n        }),\n        __metadata(\"design:type\", Object)\n    ], Foo.prototype, \"prop\", void 0);\n    Foo = __decorate([\n        bindable('prop')\n        // > expected error - class decorator only accepts a string\n        //@bindable({})\n    ], Foo);\n    Bindable.for(Foo)\n        // > expected error - there is no add() function with only optional params on the fluent api\n        //.add()\n        // > expected error - 'property' is a required property on the fluent api\n        //.add({})\n        .add({ property: 'prop' })\n        .add({ property: 'prop', mode: BindingMode.twoWay })\n        .add({ property: 'prop', callback: 'propChanged' })\n        .add({ property: 'prop', attribute: 'prop' })\n        .add({ property: 'prop', primary: true })\n        .add({ property: 'prop', mode: BindingMode.twoWay, callback: 'propChanged', attribute: 'prop', primary: true })\n        .add('prop')\n        // > expected error - the add() method that accepts an object literal does not return a fluent api\n        //.add({ property: 'prop' }).mode(BindingMode.twoWay)\n        //.add({ property: 'prop' }).callback('propChanged')\n        //.add({ property: 'prop' }).attribute('prop')\n        //.add({ property: 'prop' }).primary()\n        // > expected error - fluent api methods can only be invoked once per bindable\n        //.add('prop').mode(BindingMode.twoWay).mode(BindingMode.twoWay)\n        //.add('prop').mode(BindingMode.twoWay).callback('propChanged').mode(BindingMode.twoWay)\n        //.add('prop').mode(BindingMode.twoWay).callback('propChanged').callback('propChanged') // etc\n        // > expected error - wrong invocation order\n        //.add('prop').callback('propChanged').mode(BindingMode.twoWay)\n        //.add('prop').primary().mode(BindingMode.twoWay)  // etc\n        .add('prop').mode(BindingMode.twoWay)\n        .add('prop').mode(BindingMode.twoWay).callback('propChanged')\n        .add('prop').mode(BindingMode.twoWay).callback('propChanged').attribute('prop')\n        .add('prop').mode(BindingMode.twoWay).callback('propChanged').attribute('prop').primary()\n        .add('prop').mode(BindingMode.twoWay).set((value) => Number(value))\n        .add('prop').mode(BindingMode.twoWay).callback('propChanged').set(value => Number(value))\n        .add('prop').callback('propChanged')\n        .add('prop').callback('propChanged').attribute('prop')\n        .add('prop').callback('propChanged').attribute('prop').primary()\n        .add('prop').attribute('prop')\n        .add('prop').attribute('prop').primary()\n        .add('prop').primary();\n}\n/* eslint-enable @typescript-eslint/no-unused-vars,spaced-comment */\n//# sourceMappingURL=bindable.js.map","import { Registration, Protocol, Metadata, mergeArrays, firstDefined, } from '@aurelia/kernel';\nimport { HooksDefinition, registerAliases, } from '../definitions';\nimport { BindingMode, } from '../flags';\nimport { Bindable } from '../templating/bindable';\nexport function customAttribute(nameOrDef) {\n    return function (target) {\n        return CustomAttribute.define(nameOrDef, target);\n    };\n}\nexport function templateController(nameOrDef) {\n    return function (target) {\n        return CustomAttribute.define(typeof nameOrDef === 'string'\n            ? { isTemplateController: true, name: nameOrDef }\n            : { isTemplateController: true, ...nameOrDef }, target);\n    };\n}\nexport class CustomAttributeDefinition {\n    constructor(Type, name, aliases, key, defaultBindingMode, isTemplateController, bindables, strategy, hooks, noMultiBindings) {\n        this.Type = Type;\n        this.name = name;\n        this.aliases = aliases;\n        this.key = key;\n        this.defaultBindingMode = defaultBindingMode;\n        this.isTemplateController = isTemplateController;\n        this.bindables = bindables;\n        this.strategy = strategy;\n        this.hooks = hooks;\n        this.noMultiBindings = noMultiBindings;\n    }\n    static create(nameOrDef, Type) {\n        let name;\n        let def;\n        if (typeof nameOrDef === 'string') {\n            name = nameOrDef;\n            def = { name };\n        }\n        else {\n            name = nameOrDef.name;\n            def = nameOrDef;\n        }\n        return new CustomAttributeDefinition(Type, firstDefined(CustomAttribute.getAnnotation(Type, 'name'), name), mergeArrays(CustomAttribute.getAnnotation(Type, 'aliases'), def.aliases, Type.aliases), CustomAttribute.keyFrom(name), firstDefined(CustomAttribute.getAnnotation(Type, 'defaultBindingMode'), def.defaultBindingMode, Type.defaultBindingMode, BindingMode.toView), firstDefined(CustomAttribute.getAnnotation(Type, 'isTemplateController'), def.isTemplateController, Type.isTemplateController, false), Bindable.from(...Bindable.getAll(Type), CustomAttribute.getAnnotation(Type, 'bindables'), Type.bindables, def.bindables), firstDefined(CustomAttribute.getAnnotation(Type, 'strategy'), def.strategy, Type.strategy, 1 /* getterSetter */), firstDefined(CustomAttribute.getAnnotation(Type, 'hooks'), def.hooks, Type.hooks, new HooksDefinition(Type.prototype)), firstDefined(CustomAttribute.getAnnotation(Type, 'noMultiBindings'), def.noMultiBindings, Type.noMultiBindings, false));\n    }\n    register(container) {\n        const { Type, key, aliases } = this;\n        Registration.transient(key, Type).register(container);\n        Registration.alias(key, Type).register(container);\n        registerAliases(aliases, CustomAttribute, key, container);\n    }\n}\nexport const CustomAttribute = {\n    name: Protocol.resource.keyFor('custom-attribute'),\n    keyFrom(name) {\n        return `${CustomAttribute.name}:${name}`;\n    },\n    isType(value) {\n        return typeof value === 'function' && Metadata.hasOwn(CustomAttribute.name, value);\n    },\n    for(node, name) {\n        return Metadata.getOwn(CustomAttribute.keyFrom(name), node);\n    },\n    define(nameOrDef, Type) {\n        const definition = CustomAttributeDefinition.create(nameOrDef, Type);\n        Metadata.define(CustomAttribute.name, definition, definition.Type);\n        Metadata.define(CustomAttribute.name, definition, definition);\n        Protocol.resource.appendTo(Type, CustomAttribute.name);\n        return definition.Type;\n    },\n    getDefinition(Type) {\n        const def = Metadata.getOwn(CustomAttribute.name, Type);\n        if (def === void 0) {\n            throw new Error(`No definition found for type ${Type.name}`);\n        }\n        return def;\n    },\n    annotate(Type, prop, value) {\n        Metadata.define(Protocol.annotation.keyFor(prop), value, Type);\n    },\n    getAnnotation(Type, prop) {\n        return Metadata.getOwn(Protocol.annotation.keyFor(prop), Type);\n    },\n};\n//# sourceMappingURL=custom-attribute.js.map","import { DI, PLATFORM, Reporter, } from '@aurelia/kernel';\nexport const INode = DI.createInterface('INode').noDefault();\nexport const IRenderLocation = DI.createInterface('IRenderLocation').noDefault();\nexport const IDOM = DI.createInterface('IDOM').noDefault();\nconst ni = function (...args) {\n    throw Reporter.error(1000); // TODO: create error code (not implemented exception)\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n}; // this function doesn't need typing because it is never directly called\nconst niDOM = {\n    addEventListener: ni,\n    appendChild: ni,\n    cloneNode: ni,\n    convertToRenderLocation: ni,\n    createDocumentFragment: ni,\n    createNodeSequence: ni,\n    createElement: ni,\n    createCustomEvent: ni,\n    dispatchEvent: ni,\n    createNodeObserver: ni,\n    createTemplate: ni,\n    createTextNode: ni,\n    getEffectiveParentNode: ni,\n    setEffectiveParentNode: ni,\n    insertBefore: ni,\n    isMarker: ni,\n    isNodeInstance: ni,\n    isRenderLocation: ni,\n    makeTarget: ni,\n    registerElementResolver: ni,\n    remove: ni,\n    removeEventListener: ni,\n    setAttribute: ni\n};\nexport const DOM = {\n    ...niDOM,\n    scheduler: (void 0),\n    get isInitialized() {\n        return Reflect.get(this, '$initialized') === true;\n    },\n    initialize(dom) {\n        if (this.isInitialized) {\n            throw Reporter.error(1001); // TODO: create error code (already initialized, check isInitialized property and call destroy() if you want to assign a different dom)\n        }\n        const descriptors = {};\n        const protos = [dom];\n        let proto = Object.getPrototypeOf(dom);\n        while (proto && proto !== Object.prototype) {\n            protos.unshift(proto);\n            proto = Object.getPrototypeOf(proto);\n        }\n        for (proto of protos) {\n            Object.assign(descriptors, Object.getOwnPropertyDescriptors(proto));\n        }\n        const keys = [];\n        let key;\n        let descriptor;\n        for (key in descriptors) {\n            descriptor = descriptors[key];\n            if (descriptor.configurable && descriptor.writable) {\n                Reflect.defineProperty(this, key, descriptor);\n                keys.push(key);\n            }\n        }\n        Reflect.set(this, '$domKeys', keys);\n        Reflect.set(this, '$initialized', true);\n    },\n    destroy() {\n        if (!this.isInitialized) {\n            throw Reporter.error(1002); // TODO: create error code (already destroyed)\n        }\n        const keys = Reflect.get(this, '$domKeys');\n        keys.forEach(key => {\n            Reflect.deleteProperty(this, key);\n        });\n        Object.assign(this, niDOM);\n        Reflect.set(this, '$domKeys', PLATFORM.emptyArray);\n        Reflect.set(this, '$initialized', false);\n    }\n};\n// This is an implementation of INodeSequence that represents \"no DOM\" to render.\n// It's used in various places to avoid null and to encode\n// the explicit idea of \"no view\".\nconst emptySequence = {\n    isMounted: false,\n    isLinked: false,\n    next: void 0,\n    childNodes: PLATFORM.emptyArray,\n    firstChild: null,\n    lastChild: null,\n    findTargets() { return PLATFORM.emptyArray; },\n    insertBefore(refNode) { },\n    appendTo(parent) { },\n    remove() { },\n    addToLinked() { },\n    unlink() { },\n    link(next) { },\n};\nexport const NodeSequence = {\n    empty: emptySequence\n};\n//# sourceMappingURL=dom.js.map","import { __decorate, __metadata, __param } from \"tslib\";\nimport { nextId } from '@aurelia/kernel';\nimport { IRenderLocation } from '../../dom';\nimport { IViewFactory } from '../../lifecycle';\nimport { templateController } from '../custom-attribute';\nclass FlagsTemplateController {\n    constructor(factory, location, flags) {\n        this.factory = factory;\n        this.flags = flags;\n        this.id = nextId('au$component');\n        this.view = this.factory.create();\n        this.view.hold(location, 1 /* insertBefore */);\n    }\n    beforeBind(flags) {\n        this.view.parent = this.$controller;\n        return this.view.bind(flags | this.flags, this.$controller.scope);\n    }\n    beforeAttach(flags) {\n        this.view.attach(flags);\n    }\n    beforeDetach(flags) {\n        this.view.detach(flags);\n    }\n    beforeUnbind(flags) {\n        const task = this.view.unbind(flags);\n        this.view.parent = void 0;\n        return task;\n    }\n}\nlet InfrequentMutations = class InfrequentMutations extends FlagsTemplateController {\n    constructor(factory, location) {\n        super(factory, location, 268435456 /* noTargetObserverQueue */);\n    }\n};\nInfrequentMutations = __decorate([\n    templateController('infrequent-mutations'),\n    __param(0, IViewFactory), __param(1, IRenderLocation),\n    __metadata(\"design:paramtypes\", [Object, Object])\n], InfrequentMutations);\nexport { InfrequentMutations };\nlet FrequentMutations = class FrequentMutations extends FlagsTemplateController {\n    constructor(factory, location) {\n        super(factory, location, 536870912 /* persistentTargetObserverQueue */);\n    }\n};\nFrequentMutations = __decorate([\n    templateController('frequent-mutations'),\n    __param(0, IViewFactory), __param(1, IRenderLocation),\n    __metadata(\"design:paramtypes\", [Object, Object])\n], FrequentMutations);\nexport { FrequentMutations };\nlet ObserveShallow = class ObserveShallow extends FlagsTemplateController {\n    constructor(factory, location) {\n        super(factory, location, 134217728 /* observeLeafPropertiesOnly */);\n    }\n};\nObserveShallow = __decorate([\n    templateController('observe-shallow'),\n    __param(0, IViewFactory), __param(1, IRenderLocation),\n    __metadata(\"design:paramtypes\", [Object, Object])\n], ObserveShallow);\nexport { ObserveShallow };\n//# sourceMappingURL=flags.js.map","import { __decorate, __metadata, __param } from \"tslib\";\nimport { DI, IServiceLocator, Registration, } from '@aurelia/kernel';\nexport const LifecycleTask = {\n    done: {\n        done: true,\n        canCancel() { return false; },\n        cancel() { return; },\n        wait() { return Promise.resolve(); }\n    }\n};\nexport var TaskSlot;\n(function (TaskSlot) {\n    TaskSlot[TaskSlot[\"beforeCreate\"] = 0] = \"beforeCreate\";\n    TaskSlot[TaskSlot[\"beforeRender\"] = 1] = \"beforeRender\";\n    TaskSlot[TaskSlot[\"beforeBind\"] = 2] = \"beforeBind\";\n    TaskSlot[TaskSlot[\"beforeAttach\"] = 3] = \"beforeAttach\";\n})(TaskSlot || (TaskSlot = {}));\nexport const IStartTask = DI.createInterface('IStartTask').noDefault();\nvar TaskType;\n(function (TaskType) {\n    TaskType[TaskType[\"with\"] = 0] = \"with\";\n    TaskType[TaskType[\"from\"] = 1] = \"from\";\n})(TaskType || (TaskType = {}));\n// eslint-disable-next-line @typescript-eslint/class-name-casing\nexport const StartTask = class $StartTask {\n    constructor(type) {\n        this.type = type;\n        this._slot = void 0;\n        this._promiseOrTask = void 0;\n        this._container = void 0;\n        this._key = void 0;\n        this._callback = void 0;\n        this._task = void 0;\n    }\n    get slot() {\n        if (this._slot === void 0) {\n            throw new Error('StartTask.slot is not set');\n        }\n        return this._slot;\n    }\n    get promiseOrTask() {\n        if (this._promiseOrTask === void 0) {\n            throw new Error('StartTask.promiseOrTask is not set');\n        }\n        return this._promiseOrTask;\n    }\n    get container() {\n        if (this._container === void 0) {\n            throw new Error('StartTask.container is not set');\n        }\n        return this._container;\n    }\n    get key() {\n        if (this._key === void 0) {\n            throw new Error('StartTask.key is not set');\n        }\n        return this._key;\n    }\n    get callback() {\n        if (this._callback === void 0) {\n            throw new Error('StartTask.callback is not set');\n        }\n        return this._callback;\n    }\n    get task() {\n        if (this._task === void 0) {\n            throw new Error('StartTask.task is not set');\n        }\n        return this._task;\n    }\n    static with(key) {\n        const task = new $StartTask(0 /* with */);\n        task._key = key;\n        return task;\n    }\n    static from(promiseOrTask) {\n        const task = new $StartTask(1 /* from */);\n        task._promiseOrTask = promiseOrTask;\n        return task;\n    }\n    beforeCreate() {\n        return this.at(0 /* beforeCreate */);\n    }\n    beforeRender() {\n        return this.at(1 /* beforeRender */);\n    }\n    beforeBind() {\n        return this.at(2 /* beforeBind */);\n    }\n    beforeAttach() {\n        return this.at(3 /* beforeAttach */);\n    }\n    at(slot) {\n        this._slot = slot;\n        return this;\n    }\n    call(fn) {\n        this._callback = fn;\n        return this;\n    }\n    register(container) {\n        return this._container = container.register(Registration.instance(IStartTask, this));\n    }\n    resolveTask() {\n        if (this._task === void 0) {\n            switch (this.type) {\n                case 0 /* with */:\n                    this._task = new ProviderTask(this.container, this.key, this.callback);\n                    break;\n                case 1 /* from */:\n                    this._task = new TerminalTask(this.promiseOrTask);\n                    break;\n            }\n        }\n        return this.task;\n    }\n};\nexport const IStartTaskManager = DI.createInterface('IStartTaskManager').noDefault();\nlet StartTaskManager = class StartTaskManager {\n    constructor(locator) {\n        this.locator = locator;\n    }\n    static register(container) {\n        return Registration.singleton(IStartTaskManager, this).register(container);\n    }\n    runBeforeCreate(locator = this.locator) {\n        return this.run(0 /* beforeCreate */, locator);\n    }\n    runBeforeRender(locator = this.locator) {\n        return this.run(1 /* beforeRender */, locator);\n    }\n    runBeforeBind(locator = this.locator) {\n        return this.run(2 /* beforeBind */, locator);\n    }\n    runBeforeAttach(locator = this.locator) {\n        return this.run(3 /* beforeAttach */, locator);\n    }\n    run(slot, locator = this.locator) {\n        const tasks = locator.getAll(IStartTask)\n            .filter(startTask => startTask.slot === slot)\n            .map(startTask => startTask.resolveTask())\n            .filter(task => !task.done);\n        if (tasks.length === 0) {\n            return LifecycleTask.done;\n        }\n        return new AggregateTerminalTask(tasks);\n    }\n};\nStartTaskManager = __decorate([\n    __param(0, IServiceLocator),\n    __metadata(\"design:paramtypes\", [Object])\n], StartTaskManager);\nexport { StartTaskManager };\nexport class PromiseTask {\n    constructor(promise, next, context, ...args) {\n        this.done = false;\n        this.hasStarted = false;\n        this.isCancelled = false;\n        this.promise = promise.then(value => {\n            if (this.isCancelled === true) {\n                return;\n            }\n            this.hasStarted = true;\n            if (next !== null) {\n                const nextResult = next.call(context, value, ...args);\n                if (nextResult === void 0) {\n                    this.done = true;\n                }\n                else {\n                    const nextPromise = nextResult.then instanceof Function\n                        ? nextResult\n                        : nextResult.wait();\n                    return nextPromise.then(() => {\n                        this.done = true;\n                    });\n                }\n            }\n        });\n    }\n    canCancel() {\n        return !this.hasStarted;\n    }\n    cancel() {\n        if (this.canCancel()) {\n            this.isCancelled = true;\n        }\n    }\n    wait() {\n        return this.promise;\n    }\n}\nexport class ProviderTask {\n    constructor(container, key, callback) {\n        this.container = container;\n        this.key = key;\n        this.callback = callback;\n        this.done = false;\n    }\n    canCancel() {\n        return false;\n    }\n    cancel() {\n        return;\n    }\n    wait() {\n        if (this.promise === void 0) {\n            const instance = this.container.get(this.key);\n            const maybePromiseOrTask = this.callback.call(void 0, instance);\n            this.promise = maybePromiseOrTask === void 0\n                ? Promise.resolve()\n                : maybePromiseOrTask.then instanceof Function\n                    ? maybePromiseOrTask\n                    : maybePromiseOrTask.wait();\n            this.promise = this.promise.then(() => {\n                this.done = true;\n                this.container = (void 0);\n                this.key = (void 0);\n                this.callback = (void 0);\n            }).catch(e => { throw e; });\n        }\n        return this.promise;\n    }\n}\nexport class ContinuationTask {\n    constructor(antecedent, next, context, ...args) {\n        this.done = false;\n        this.hasStarted = false;\n        this.isCancelled = false;\n        const promise = antecedent.then instanceof Function\n            ? antecedent\n            : antecedent.wait();\n        this.promise = promise.then(() => {\n            if (this.isCancelled === true) {\n                return;\n            }\n            this.hasStarted = true;\n            const nextResult = next.call(context, ...args);\n            if (nextResult === void 0) {\n                this.done = true;\n            }\n            else {\n                const nextPromise = nextResult.then instanceof Function\n                    ? nextResult\n                    : nextResult.wait();\n                return nextPromise.then(() => {\n                    this.done = true;\n                });\n            }\n        });\n    }\n    canCancel() {\n        return !this.hasStarted;\n    }\n    cancel() {\n        if (this.canCancel()) {\n            this.isCancelled = true;\n        }\n    }\n    wait() {\n        return this.promise;\n    }\n}\nexport class TerminalTask {\n    constructor(antecedent) {\n        this.done = false;\n        this.promise = antecedent.then instanceof Function\n            ? antecedent\n            : antecedent.wait();\n        this.promise.then(() => {\n            this.done = true;\n        }).catch(e => { throw e; });\n    }\n    canCancel() {\n        return false;\n    }\n    cancel() {\n        return;\n    }\n    wait() {\n        return this.promise;\n    }\n}\nexport class AggregateContinuationTask {\n    constructor(antecedents, next, context, ...args) {\n        this.done = false;\n        this.hasStarted = false;\n        this.isCancelled = false;\n        this.promise = Promise.all(antecedents.map(t => t.wait())).then(() => {\n            if (this.isCancelled === true) {\n                return;\n            }\n            this.hasStarted = true;\n            const nextResult = next.call(context, ...args);\n            if (nextResult === void 0) {\n                this.done = true;\n            }\n            else {\n                return nextResult.wait().then(() => {\n                    this.done = true;\n                });\n            }\n        });\n    }\n    canCancel() {\n        return !this.hasStarted;\n    }\n    cancel() {\n        if (this.canCancel()) {\n            this.isCancelled = true;\n        }\n    }\n    wait() {\n        return this.promise;\n    }\n}\nexport class AggregateTerminalTask {\n    constructor(antecedents) {\n        this.done = false;\n        this.promise = Promise.all(antecedents.map(t => t.wait())).then(() => {\n            this.done = true;\n        });\n    }\n    canCancel() {\n        return false;\n    }\n    cancel() {\n        return;\n    }\n    wait() {\n        return this.promise;\n    }\n}\nexport function hasAsyncWork(value) {\n    return !(value === void 0 || value.done === true);\n}\n//# sourceMappingURL=lifecycle-task.js.map","import { __decorate, __metadata, __param } from \"tslib\";\nimport { nextId } from '@aurelia/kernel';\nimport { IRenderLocation } from '../../dom';\nimport { IViewFactory } from '../../lifecycle';\nimport { ContinuationTask, LifecycleTask, PromiseTask } from '../../lifecycle-task';\nimport { bindable } from '../../templating/bindable';\nimport { templateController } from '../custom-attribute';\nlet If = class If {\n    constructor(ifFactory, location) {\n        this.ifFactory = ifFactory;\n        this.location = location;\n        this.id = nextId('au$component');\n        this.elseFactory = void 0;\n        this.elseView = void 0;\n        this.ifView = void 0;\n        this.view = void 0;\n        this.task = LifecycleTask.done;\n        this.value = false;\n    }\n    ;\n    beforeBind(flags) {\n        if (this.task.done) {\n            this.task = this.swap(this.value, flags);\n        }\n        else {\n            this.task = new ContinuationTask(this.task, this.swap, this, this.value, flags);\n        }\n        return this.task;\n    }\n    beforeAttach(flags) {\n        if (this.task.done) {\n            this.attachView(flags);\n        }\n        else {\n            this.task = new ContinuationTask(this.task, this.attachView, this, flags);\n        }\n    }\n    beforeDetach(flags) {\n        if (this.view !== void 0) {\n            if (this.task.done) {\n                this.view.detach(flags);\n            }\n            else {\n                this.task = new ContinuationTask(this.task, this.view.detach, this.view, flags);\n            }\n        }\n        return this.task;\n    }\n    beforeUnbind(flags) {\n        if (this.view !== void 0) {\n            if (this.task.done) {\n                this.task = this.view.unbind(flags);\n            }\n            else {\n                this.task = new ContinuationTask(this.task, this.view.unbind, this.view, flags);\n            }\n        }\n        return this.task;\n    }\n    caching(flags) {\n        if (this.ifView !== void 0 && this.ifView.release(flags)) {\n            this.ifView = void 0;\n        }\n        if (this.elseView !== void 0 && this.elseView.release(flags)) {\n            this.elseView = void 0;\n        }\n        this.view = void 0;\n    }\n    valueChanged(newValue, oldValue, flags) {\n        if ((this.$controller.state & 4 /* isBound */) === 0) {\n            return;\n        }\n        if (this.task.done) {\n            this.task = this.swap(this.value, flags);\n        }\n        else {\n            this.task = new ContinuationTask(this.task, this.swap, this, this.value, flags);\n        }\n    }\n    /** @internal */\n    updateView(value, flags) {\n        let view;\n        if (value) {\n            view = this.ifView = this.ensureView(this.ifView, this.ifFactory, flags);\n        }\n        else if (this.elseFactory != void 0) {\n            view = this.elseView = this.ensureView(this.elseView, this.elseFactory, flags);\n        }\n        else {\n            view = void 0;\n        }\n        return view;\n    }\n    /** @internal */\n    ensureView(view, factory, flags) {\n        if (view === void 0) {\n            view = factory.create(flags);\n        }\n        view.hold(this.location, 1 /* insertBefore */);\n        return view;\n    }\n    swap(value, flags) {\n        let task = LifecycleTask.done;\n        if ((value === true && this.elseView !== void 0)\n            || (value !== true && this.ifView !== void 0)) {\n            task = this.deactivate(flags);\n        }\n        if (task.done) {\n            const view = this.updateView(value, flags);\n            task = this.activate(view, flags);\n        }\n        else {\n            task = new PromiseTask(task.wait().then(() => this.updateView(value, flags)), this.activate, this, flags);\n        }\n        return task;\n    }\n    deactivate(flags) {\n        const view = this.view;\n        if (view === void 0) {\n            return LifecycleTask.done;\n        }\n        view.detach(flags); // TODO: link this up with unbind\n        const task = view.unbind(flags);\n        view.parent = void 0;\n        return task;\n    }\n    activate(view, flags) {\n        this.view = view;\n        if (view === void 0) {\n            return LifecycleTask.done;\n        }\n        let task = this.bindView(flags);\n        if ((this.$controller.state & 32 /* isAttached */) === 0) {\n            return task;\n        }\n        if (task.done) {\n            this.attachView(flags);\n        }\n        else {\n            task = new ContinuationTask(task, this.attachView, this, flags);\n        }\n        return task;\n    }\n    bindView(flags) {\n        if (this.view !== void 0 && (this.$controller.state & 5 /* isBoundOrBinding */) > 0) {\n            this.view.parent = this.$controller;\n            return this.view.bind(flags, this.$controller.scope, this.$controller.part);\n        }\n        return LifecycleTask.done;\n    }\n    attachView(flags) {\n        if (this.view !== void 0 && (this.$controller.state & 40 /* isAttachedOrAttaching */) > 0) {\n            this.view.attach(flags);\n        }\n    }\n};\n__decorate([\n    bindable,\n    __metadata(\"design:type\", Boolean)\n], If.prototype, \"value\", void 0);\nIf = __decorate([\n    templateController('if'),\n    __param(0, IViewFactory),\n    __param(1, IRenderLocation),\n    __metadata(\"design:paramtypes\", [Object, Object])\n], If);\nexport { If };\nlet Else = class Else {\n    constructor(factory) {\n        this.factory = factory;\n        this.id = nextId('au$component');\n    }\n    link(ifBehavior) {\n        if (ifBehavior instanceof If) {\n            ifBehavior.elseFactory = this.factory;\n        }\n        else if (ifBehavior.viewModel instanceof If) {\n            ifBehavior.viewModel.elseFactory = this.factory;\n        }\n        else {\n            throw new Error(`Unsupported IfBehavior`); // TODO: create error code\n        }\n    }\n};\nElse = __decorate([\n    templateController('else'),\n    __param(0, IViewFactory),\n    __metadata(\"design:paramtypes\", [Object])\n], Else);\nexport { Else };\n//# sourceMappingURL=if.js.map","import { __decorate, __metadata, __param } from \"tslib\";\nimport { compareNumber, nextId } from '@aurelia/kernel';\nimport { IRenderLocation } from '../../dom';\nimport { IViewFactory, IController } from '../../lifecycle';\nimport { AggregateContinuationTask, ContinuationTask, LifecycleTask, } from '../../lifecycle-task';\nimport { applyMutationsToIndices, synchronizeIndices } from '../../observation/array-observer';\nimport { BindingContext, Scope } from '../../observation/binding-context';\nimport { getCollectionObserver } from '../../observation/observer-locator';\nimport { bindable } from '../../templating/bindable';\nimport { templateController } from '../custom-attribute';\nlet Repeat = class Repeat {\n    constructor(location, renderable, factory) {\n        this.location = location;\n        this.renderable = renderable;\n        this.factory = factory;\n        this.id = nextId('au$component');\n        this.hasPendingInstanceMutation = false;\n        this.observer = void 0;\n        this.views = [];\n        this.key = void 0;\n        this.task = LifecycleTask.done;\n        this.normalizedItems = void 0;\n    }\n    beforeBind(flags) {\n        this.checkCollectionObserver(flags);\n        const bindings = this.renderable.bindings;\n        const { length } = bindings;\n        let binding;\n        for (let i = 0; i < length; ++i) {\n            binding = bindings[i];\n            if (binding.target === this && binding.targetProperty === 'items') {\n                this.forOf = binding.sourceExpression;\n                break;\n            }\n        }\n        this.local = this.forOf.declaration.evaluate(flags, this.$controller.scope, null);\n        this.normalizeToArray(flags);\n        this.processViewsKeyed(void 0, flags);\n        return this.task;\n    }\n    beforeAttach(flags) {\n        if (this.task.done) {\n            this.attachViews(void 0, flags);\n        }\n        else {\n            this.task = new ContinuationTask(this.task, this.attachViews, this, void 0, flags);\n        }\n    }\n    beforeDetach(flags) {\n        if (this.task.done) {\n            this.detachViewsByRange(0, this.views.length, flags);\n        }\n        else {\n            this.task = new ContinuationTask(this.task, this.detachViewsByRange, this, 0, this.views.length, flags);\n        }\n    }\n    beforeUnbind(flags) {\n        this.checkCollectionObserver(flags);\n        if (this.task.done) {\n            this.task = this.unbindAndRemoveViewsByRange(0, this.views.length, flags, false);\n        }\n        else {\n            this.task = new ContinuationTask(this.task, this.unbindAndRemoveViewsByRange, this, 0, this.views.length, flags, false);\n        }\n        return this.task;\n    }\n    // called by SetterObserver\n    itemsChanged(flags) {\n        flags |= this.$controller.flags;\n        this.checkCollectionObserver(flags);\n        flags |= 16 /* updateTargetInstance */;\n        this.normalizeToArray(flags);\n        this.processViewsKeyed(void 0, flags);\n    }\n    // called by a CollectionObserver\n    handleCollectionChange(indexMap, flags) {\n        flags |= this.$controller.flags;\n        flags |= (960 /* fromFlush */ | 16 /* updateTargetInstance */);\n        this.normalizeToArray(flags);\n        this.processViewsKeyed(indexMap, flags);\n    }\n    processViewsKeyed(indexMap, flags) {\n        const oldLength = this.views.length;\n        if (indexMap === void 0) {\n            if ((this.$controller.state & 5 /* isBoundOrBinding */) > 0) {\n                this.detachViewsByRange(0, oldLength, flags);\n                if (this.task.done) {\n                    this.task = this.unbindAndRemoveViewsByRange(0, oldLength, flags, false);\n                }\n                else {\n                    this.task = new ContinuationTask(this.task, this.unbindAndRemoveViewsByRange, this, 0, oldLength, flags, false);\n                }\n                if (this.task.done) {\n                    this.task = this.createAndBindAllViews(flags);\n                }\n                else {\n                    this.task = new ContinuationTask(this.task, this.createAndBindAllViews, this, flags);\n                }\n            }\n            if ((this.$controller.state & 40 /* isAttachedOrAttaching */) > 0) {\n                if (this.task.done) {\n                    this.attachViewsKeyed(flags);\n                }\n                else {\n                    this.task = new ContinuationTask(this.task, this.attachViewsKeyed, this, flags);\n                }\n            }\n        }\n        else {\n            applyMutationsToIndices(indexMap);\n            if ((this.$controller.state & 5 /* isBoundOrBinding */) > 0) {\n                // first detach+unbind+(remove from array) the deleted view indices\n                if (indexMap.deletedItems.length > 0) {\n                    indexMap.deletedItems.sort(compareNumber);\n                    if (this.task.done) {\n                        this.detachViewsByKey(indexMap, flags);\n                    }\n                    else {\n                        this.task = new ContinuationTask(this.task, this.detachViewsByKey, this, indexMap, flags);\n                    }\n                    if (this.task.done) {\n                        this.task = this.unbindAndRemoveViewsByKey(indexMap, flags);\n                    }\n                    else {\n                        this.task = new ContinuationTask(this.task, this.unbindAndRemoveViewsByKey, this, indexMap, flags);\n                    }\n                }\n                // then insert new views at the \"added\" indices to bring the views array in aligment with indexMap size\n                if (this.task.done) {\n                    this.task = this.createAndBindNewViewsByKey(indexMap, flags);\n                }\n                else {\n                    this.task = new ContinuationTask(this.task, this.createAndBindNewViewsByKey, this, indexMap, flags);\n                }\n            }\n            if ((this.$controller.state & 40 /* isAttachedOrAttaching */) > 0) {\n                if (this.task.done) {\n                    this.sortViewsByKey(oldLength, indexMap, flags);\n                }\n                else {\n                    this.task = new ContinuationTask(this.task, this.sortViewsByKey, this, oldLength, indexMap, flags);\n                }\n            }\n        }\n    }\n    // todo: subscribe to collection from inner expression\n    checkCollectionObserver(flags) {\n        const oldObserver = this.observer;\n        if ((flags & 8192 /* fromUnbind */)) {\n            if (oldObserver !== void 0) {\n                oldObserver.unsubscribeFromCollection(this);\n            }\n        }\n        else if ((this.$controller.state & 5 /* isBoundOrBinding */) > 0) {\n            const newObserver = this.observer = getCollectionObserver(flags, this.$controller.lifecycle, this.items);\n            if (oldObserver !== newObserver && oldObserver) {\n                oldObserver.unsubscribeFromCollection(this);\n            }\n            if (newObserver) {\n                newObserver.subscribeToCollection(this);\n            }\n        }\n    }\n    normalizeToArray(flags) {\n        const items = this.items;\n        if (items instanceof Array) {\n            this.normalizedItems = items;\n            return;\n        }\n        const forOf = this.forOf;\n        if (forOf === void 0) {\n            return;\n        }\n        const normalizedItems = [];\n        this.forOf.iterate(flags, items, (arr, index, item) => {\n            normalizedItems[index] = item;\n        });\n        this.normalizedItems = normalizedItems;\n    }\n    detachViewsByRange(iStart, iEnd, flags) {\n        const views = this.views;\n        this.$controller.lifecycle.afterDetach.begin();\n        let view;\n        for (let i = iStart; i < iEnd; ++i) {\n            view = views[i];\n            view.release(flags);\n            view.detach(flags);\n        }\n        this.$controller.lifecycle.afterDetach.end(flags);\n    }\n    unbindAndRemoveViewsByRange(iStart, iEnd, flags, adjustLength) {\n        const views = this.views;\n        let tasks = void 0;\n        let task;\n        this.$controller.lifecycle.afterUnbind.begin();\n        let view;\n        for (let i = iStart; i < iEnd; ++i) {\n            view = views[i];\n            task = view.unbind(flags);\n            view.parent = void 0;\n            if (!task.done) {\n                if (tasks === undefined) {\n                    tasks = [];\n                }\n                tasks.push(task);\n            }\n        }\n        if (adjustLength) {\n            this.views.length = iStart;\n        }\n        if (tasks === undefined) {\n            this.$controller.lifecycle.afterUnbind.end(flags);\n            return LifecycleTask.done;\n        }\n        return new AggregateContinuationTask(tasks, this.$controller.lifecycle.afterUnbind.end, this.$controller.lifecycle.afterUnbind, flags);\n    }\n    detachViewsByKey(indexMap, flags) {\n        const views = this.views;\n        this.$controller.lifecycle.afterDetach.begin();\n        const deleted = indexMap.deletedItems;\n        const deletedLen = deleted.length;\n        let view;\n        for (let i = 0; i < deletedLen; ++i) {\n            view = views[deleted[i]];\n            view.release(flags);\n            view.detach(flags);\n        }\n        this.$controller.lifecycle.afterDetach.end(flags);\n    }\n    unbindAndRemoveViewsByKey(indexMap, flags) {\n        const views = this.views;\n        let tasks = void 0;\n        let task;\n        this.$controller.lifecycle.afterUnbind.begin();\n        const deleted = indexMap.deletedItems;\n        const deletedLen = deleted.length;\n        let view;\n        let i = 0;\n        for (; i < deletedLen; ++i) {\n            view = views[deleted[i]];\n            task = view.unbind(flags);\n            view.parent = void 0;\n            if (!task.done) {\n                if (tasks === undefined) {\n                    tasks = [];\n                }\n                tasks.push(task);\n            }\n        }\n        i = 0;\n        let j = 0;\n        for (; i < deletedLen; ++i) {\n            j = deleted[i] - i;\n            this.views.splice(j, 1);\n        }\n        if (tasks === undefined) {\n            this.$controller.lifecycle.afterUnbind.end(flags);\n            return LifecycleTask.done;\n        }\n        return new AggregateContinuationTask(tasks, this.$controller.lifecycle.afterUnbind.end, this.$controller.lifecycle.afterUnbind, flags);\n    }\n    createAndBindAllViews(flags) {\n        let tasks = void 0;\n        let task;\n        let view;\n        let viewScope;\n        const $controller = this.$controller;\n        const lifecycle = $controller.lifecycle;\n        const parentScope = $controller.scope;\n        lifecycle.afterBind.begin();\n        const part = $controller.part;\n        const factory = this.factory;\n        const local = this.local;\n        const items = this.items;\n        const newLen = this.forOf.count(flags, items);\n        const views = this.views = Array(newLen);\n        this.forOf.iterate(flags, items, (arr, i, item) => {\n            view = views[i] = factory.create(flags);\n            view.parent = $controller;\n            viewScope = Scope.fromParent(flags, parentScope, BindingContext.create(flags, local, item));\n            setContextualProperties(viewScope.overrideContext, i, newLen);\n            task = view.bind(flags, viewScope, part);\n            if (!task.done) {\n                if (tasks === undefined) {\n                    tasks = [];\n                }\n                tasks.push(task);\n            }\n        });\n        if (tasks === undefined) {\n            lifecycle.afterBind.end(flags);\n            return LifecycleTask.done;\n        }\n        return new AggregateContinuationTask(tasks, lifecycle.afterBind.end, lifecycle.afterBind, flags);\n    }\n    createAndBindNewViewsByKey(indexMap, flags) {\n        let tasks = void 0;\n        let task;\n        let view;\n        let viewScope;\n        const factory = this.factory;\n        const views = this.views;\n        const local = this.local;\n        const normalizedItems = this.normalizedItems;\n        const $controller = this.$controller;\n        const lifecycle = $controller.lifecycle;\n        const parentScope = $controller.scope;\n        lifecycle.afterBind.begin();\n        const part = $controller.part;\n        const mapLen = indexMap.length;\n        for (let i = 0; i < mapLen; ++i) {\n            if (indexMap[i] === -2) {\n                view = factory.create(flags);\n                // TODO: test with map/set/undefined/null, make sure we can use strong typing here as well, etc\n                view.parent = $controller;\n                viewScope = Scope.fromParent(flags, parentScope, BindingContext.create(flags, local, normalizedItems[i]));\n                setContextualProperties(viewScope.overrideContext, i, mapLen);\n                // update all the rest oc\n                task = view.bind(flags, viewScope, part);\n                views.splice(i, 0, view);\n                if (!task.done) {\n                    if (tasks === undefined) {\n                        tasks = [];\n                    }\n                    tasks.push(task);\n                }\n            }\n        }\n        if (views.length !== mapLen) {\n            // TODO: create error code and use reporter with more informative message\n            throw new Error(`viewsLen=${views.length}, mapLen=${mapLen}`);\n        }\n        if (tasks === undefined) {\n            lifecycle.afterBind.end(flags);\n            return LifecycleTask.done;\n        }\n        return new AggregateContinuationTask(tasks, lifecycle.afterBind.end, lifecycle.afterBind, flags);\n    }\n    attachViews(indexMap, flags) {\n        let view;\n        const views = this.views;\n        const location = this.location;\n        const lifecycle = this.$controller.lifecycle;\n        lifecycle.afterAttach.begin();\n        if (indexMap === void 0) {\n            for (let i = 0, ii = views.length; i < ii; ++i) {\n                view = views[i];\n                view.hold(location, 1 /* insertBefore */);\n                view.nodes.unlink();\n                view.attach(flags);\n            }\n        }\n        else {\n            for (let i = 0, ii = views.length; i < ii; ++i) {\n                if (indexMap[i] !== i) {\n                    view = views[i];\n                    view.hold(location, 1 /* insertBefore */);\n                    view.nodes.unlink();\n                    view.attach(flags);\n                }\n            }\n        }\n        lifecycle.afterAttach.end(flags);\n    }\n    attachViewsKeyed(flags) {\n        let view;\n        const { views, location } = this;\n        this.$controller.lifecycle.afterAttach.begin();\n        for (let i = 0, ii = views.length; i < ii; ++i) {\n            view = views[i];\n            view.hold(location, 1 /* insertBefore */);\n            view.nodes.unlink();\n            view.attach(flags);\n        }\n        this.$controller.lifecycle.afterAttach.end(flags);\n    }\n    sortViewsByKey(oldLength, indexMap, flags) {\n        // TODO: integrate with tasks\n        const location = this.location;\n        const views = this.views;\n        const newLen = indexMap.length;\n        synchronizeIndices(views, indexMap);\n        // this algorithm retrieves the indices of the longest increasing subsequence of items in the repeater\n        // the items on those indices are not moved; this minimizes the number of DOM operations that need to be performed\n        const seq = longestIncreasingSubsequence(indexMap);\n        const seqLen = seq.length;\n        this.$controller.lifecycle.afterAttach.begin();\n        flags |= 33554432 /* reorderNodes */;\n        let next;\n        let j = seqLen - 1;\n        let i = newLen - 1;\n        let view;\n        for (; i >= 0; --i) {\n            view = views[i];\n            if (indexMap[i] === -2) {\n                setContextualProperties(view.scope.overrideContext, i, newLen);\n                view.hold(location, 1 /* insertBefore */);\n                view.attach(flags);\n            }\n            else if (j < 0 || seqLen === 1 || i !== seq[j]) {\n                setContextualProperties(view.scope.overrideContext, i, newLen);\n                view.attach(flags);\n            }\n            else {\n                if (oldLength !== newLen) {\n                    setContextualProperties(view.scope.overrideContext, i, newLen);\n                }\n                --j;\n            }\n            next = views[i + 1];\n            if (next !== void 0) {\n                view.nodes.link(next.nodes);\n            }\n            else {\n                view.nodes.link(location);\n            }\n        }\n        this.$controller.lifecycle.afterAttach.end(flags);\n    }\n};\n__decorate([\n    bindable,\n    __metadata(\"design:type\", Object)\n], Repeat.prototype, \"items\", void 0);\nRepeat = __decorate([\n    templateController('repeat'),\n    __param(0, IRenderLocation),\n    __param(1, IController),\n    __param(2, IViewFactory),\n    __metadata(\"design:paramtypes\", [Object, Object, Object])\n], Repeat);\nexport { Repeat };\nlet maxLen = 16;\nlet prevIndices = new Int32Array(maxLen);\nlet tailIndices = new Int32Array(maxLen);\n// Based on inferno's lis_algorithm @ https://github.com/infernojs/inferno/blob/master/packages/inferno/src/DOM/patching.ts#L732\n// with some tweaks to make it just a bit faster + account for IndexMap (and some names changes for readability)\n/** @internal */\nexport function longestIncreasingSubsequence(indexMap) {\n    const len = indexMap.length;\n    if (len > maxLen) {\n        maxLen = len;\n        prevIndices = new Int32Array(len);\n        tailIndices = new Int32Array(len);\n    }\n    let cursor = 0;\n    let cur = 0;\n    let prev = 0;\n    let i = 0;\n    let j = 0;\n    let low = 0;\n    let high = 0;\n    let mid = 0;\n    for (; i < len; i++) {\n        cur = indexMap[i];\n        if (cur !== -2) {\n            j = prevIndices[cursor];\n            prev = indexMap[j];\n            if (prev !== -2 && prev < cur) {\n                tailIndices[i] = j;\n                prevIndices[++cursor] = i;\n                continue;\n            }\n            low = 0;\n            high = cursor;\n            while (low < high) {\n                mid = (low + high) >> 1;\n                prev = indexMap[prevIndices[mid]];\n                if (prev !== -2 && prev < cur) {\n                    low = mid + 1;\n                }\n                else {\n                    high = mid;\n                }\n            }\n            prev = indexMap[prevIndices[low]];\n            if (cur < prev || prev === -2) {\n                if (low > 0) {\n                    tailIndices[i] = prevIndices[low - 1];\n                }\n                prevIndices[low] = i;\n            }\n        }\n    }\n    i = ++cursor;\n    const result = new Int32Array(i);\n    cur = prevIndices[cursor - 1];\n    while (cursor-- > 0) {\n        result[cursor] = cur;\n        cur = tailIndices[cur];\n    }\n    while (i-- > 0)\n        prevIndices[i] = 0;\n    return result;\n}\nfunction setContextualProperties(oc, index, length) {\n    const isFirst = index === 0;\n    const isLast = index === length - 1;\n    const isEven = index % 2 === 0;\n    oc.$index = index;\n    oc.$first = isFirst;\n    oc.$last = isLast;\n    oc.$middle = !isFirst && !isLast;\n    oc.$even = isEven;\n    oc.$odd = !isEven;\n    oc.$length = length;\n}\n//# sourceMappingURL=repeat.js.map","import { __decorate, __metadata, __param } from \"tslib\";\nimport { nextId } from '@aurelia/kernel';\nimport { IRenderLocation } from '../../dom';\nimport { IViewFactory } from '../../lifecycle';\nimport { templateController } from '../custom-attribute';\nlet Replaceable = class Replaceable {\n    constructor(factory, location) {\n        this.factory = factory;\n        this.location = location;\n        this.id = nextId('au$component');\n        this.view = this.factory.create();\n        this.view.hold(location, 1 /* insertBefore */);\n    }\n    beforeBind(flags) {\n        this.view.parent = this.$controller;\n        return this.view.bind(flags | 67108864 /* allowParentScopeTraversal */, this.$controller.scope, this.factory.name);\n    }\n    beforeAttach(flags) {\n        this.view.attach(flags);\n    }\n    beforeDetach(flags) {\n        this.view.detach(flags);\n    }\n    beforeUnbind(flags) {\n        const task = this.view.unbind(flags);\n        this.view.parent = void 0;\n        return task;\n    }\n};\nReplaceable = __decorate([\n    templateController('replaceable'),\n    __param(0, IViewFactory),\n    __param(1, IRenderLocation),\n    __metadata(\"design:paramtypes\", [Object, Object])\n], Replaceable);\nexport { Replaceable };\n//# sourceMappingURL=replaceable.js.map","import { __decorate, __metadata, __param } from \"tslib\";\nimport { nextId } from '@aurelia/kernel';\nimport { IRenderLocation } from '../../dom';\nimport { IViewFactory } from '../../lifecycle';\nimport { templateController } from '../custom-attribute';\nimport { bindable } from '../../templating/bindable';\nimport { Scope } from '../../observation/binding-context';\nlet With = class With {\n    constructor(factory, location) {\n        this.factory = factory;\n        this.location = location;\n        this.id = nextId('au$component');\n        this.id = nextId('au$component');\n        this.view = this.factory.create();\n        this.view.hold(location, 1 /* insertBefore */);\n    }\n    valueChanged(newValue, oldValue, flags) {\n        if ((this.$controller.state & 5 /* isBoundOrBinding */) > 0) {\n            this.bindChild(4096 /* fromBind */);\n        }\n    }\n    beforeBind(flags) {\n        this.view.parent = this.$controller;\n        this.bindChild(flags);\n    }\n    beforeAttach(flags) {\n        this.view.attach(flags);\n    }\n    beforeDetach(flags) {\n        this.view.detach(flags);\n    }\n    beforeUnbind(flags) {\n        this.view.unbind(flags);\n        this.view.parent = void 0;\n    }\n    bindChild(flags) {\n        const scope = Scope.fromParent(flags, this.$controller.scope, this.value === void 0 ? {} : this.value);\n        this.view.bind(flags, scope, this.$controller.part);\n    }\n};\n__decorate([\n    bindable,\n    __metadata(\"design:type\", Object)\n], With.prototype, \"value\", void 0);\nWith = __decorate([\n    templateController('with'),\n    __param(0, IViewFactory),\n    __param(1, IRenderLocation),\n    __metadata(\"design:paramtypes\", [Object, Object])\n], With);\nexport { With };\n//# sourceMappingURL=with.js.map","var ChildrenObserver_1;\nimport { __decorate, __metadata } from \"tslib\";\n/* eslint-disable @typescript-eslint/no-use-before-define */\nimport { Protocol, Metadata, firstDefined, getPrototypeChain, Reporter } from '@aurelia/kernel';\nimport { CustomElement } from '../resources/custom-element';\nimport { subscriberCollection } from '../observation/subscriber-collection';\nexport function children(configOrTarget, prop) {\n    let config;\n    function decorator($target, $prop) {\n        if (arguments.length > 1) {\n            // Non invocation:\n            // - @children\n            // Invocation with or w/o opts:\n            // - @children()\n            // - @children({...opts})\n            config.property = $prop;\n        }\n        Metadata.define(Children.name, ChildrenDefinition.create($prop, config), $target.constructor, $prop);\n        Protocol.annotation.appendTo($target.constructor, Children.keyFrom($prop));\n    }\n    if (arguments.length > 1) {\n        // Non invocation:\n        // - @children\n        config = {};\n        decorator(configOrTarget, prop);\n        return;\n    }\n    else if (typeof configOrTarget === 'string') {\n        // ClassDecorator\n        // - @children('bar')\n        // Direct call:\n        // - @children('bar')(Foo)\n        config = {};\n        return decorator;\n    }\n    // Invocation with or w/o opts:\n    // - @children()\n    // - @children({...opts})\n    config = configOrTarget === void 0 ? {} : configOrTarget;\n    return decorator;\n}\nfunction isChildrenObserverAnnotation(key) {\n    return key.startsWith(Children.name);\n}\nexport const Children = {\n    name: Protocol.annotation.keyFor('children-observer'),\n    keyFrom(name) {\n        return `${Children.name}:${name}`;\n    },\n    from(...childrenObserverLists) {\n        const childrenObservers = {};\n        // eslint-disable-next-line @typescript-eslint/unbound-method\n        const isArray = Array.isArray;\n        function addName(name) {\n            childrenObservers[name] = ChildrenDefinition.create(name);\n        }\n        function addDescription(name, def) {\n            childrenObservers[name] = ChildrenDefinition.create(name, def);\n        }\n        function addList(maybeList) {\n            if (isArray(maybeList)) {\n                maybeList.forEach(addName);\n            }\n            else if (maybeList instanceof ChildrenDefinition) {\n                childrenObservers[maybeList.property] = maybeList;\n            }\n            else if (maybeList !== void 0) {\n                Object.keys(maybeList).forEach(name => addDescription(name, maybeList));\n            }\n        }\n        childrenObserverLists.forEach(addList);\n        return childrenObservers;\n    },\n    getAll(Type) {\n        const propStart = Children.name.length + 1;\n        const defs = [];\n        const prototypeChain = getPrototypeChain(Type);\n        let iProto = prototypeChain.length;\n        let iDefs = 0;\n        let keys;\n        let keysLen;\n        let Class;\n        while (--iProto >= 0) {\n            Class = prototypeChain[iProto];\n            keys = Protocol.annotation.getKeys(Class).filter(isChildrenObserverAnnotation);\n            keysLen = keys.length;\n            for (let i = 0; i < keysLen; ++i) {\n                defs[iDefs++] = Metadata.getOwn(Children.name, Class, keys[i].slice(propStart));\n            }\n        }\n        return defs;\n    },\n};\nexport class ChildrenDefinition {\n    constructor(callback, property, options, query, filter, map) {\n        this.callback = callback;\n        this.property = property;\n        this.options = options;\n        this.query = query;\n        this.filter = filter;\n        this.map = map;\n    }\n    static create(prop, def = {}) {\n        return new ChildrenDefinition(firstDefined(def.callback, `${prop}Changed`), firstDefined(def.property, prop), def.options, def.query, def.filter, def.map);\n    }\n}\n/** @internal */\nlet ChildrenObserver = ChildrenObserver_1 = class ChildrenObserver {\n    constructor(controller, obj, flags, propertyKey, cbName, query = defaultChildQuery, filter = defaultChildFilter, map = defaultChildMap, options) {\n        this.controller = controller;\n        this.obj = obj;\n        this.propertyKey = propertyKey;\n        this.query = query;\n        this.filter = filter;\n        this.map = map;\n        this.options = options;\n        this.observing = false;\n        this.children = (void 0);\n        this.callback = obj[cbName];\n        this.persistentFlags = flags & 2080374799 /* persistentBindingFlags */;\n        this.createGetterSetter();\n    }\n    getValue() {\n        this.tryStartObserving();\n        return this.children;\n    }\n    setValue(newValue) { }\n    subscribe(subscriber) {\n        this.tryStartObserving();\n        this.addSubscriber(subscriber);\n    }\n    tryStartObserving() {\n        if (!this.observing) {\n            this.observing = true;\n            const projector = this.controller.projector;\n            this.children = filterChildren(projector, this.query, this.filter, this.map);\n            projector.subscribeToChildrenChange(() => { this.onChildrenChanged(); }, this.options);\n        }\n    }\n    onChildrenChanged() {\n        this.children = filterChildren(this.controller.projector, this.query, this.filter, this.map);\n        if (this.callback !== void 0) {\n            this.callback.call(this.obj);\n        }\n        this.callSubscribers(this.children, undefined, this.persistentFlags | 16 /* updateTargetInstance */);\n    }\n    createGetterSetter() {\n        if (!Reflect.defineProperty(this.obj, this.propertyKey, {\n            enumerable: true,\n            configurable: true,\n            get: () => this.getValue(),\n            set: () => { return; },\n        })) {\n            Reporter.write(1, this.propertyKey, this.obj);\n        }\n    }\n};\nChildrenObserver = ChildrenObserver_1 = __decorate([\n    subscriberCollection(),\n    __metadata(\"design:paramtypes\", [Object, Object, Number, String, String, Object, Object, Object, Object])\n], ChildrenObserver);\nexport { ChildrenObserver };\nfunction defaultChildQuery(projector) {\n    return projector.children;\n}\nfunction defaultChildFilter(node, controller, viewModel) {\n    return !!viewModel;\n}\nfunction defaultChildMap(node, controller, viewModel) {\n    return viewModel;\n}\n/** @internal */\nexport function filterChildren(projector, query, filter, map) {\n    const nodes = query(projector);\n    const children = [];\n    for (let i = 0, ii = nodes.length; i < ii; ++i) {\n        const node = nodes[i];\n        const controller = CustomElement.for(node);\n        const viewModel = controller ? controller.viewModel : null;\n        if (filter(node, controller, viewModel)) {\n            children.push(map(node, controller, viewModel));\n        }\n    }\n    return children;\n}\n//# sourceMappingURL=children.js.map","import { DI, Registration, Protocol, Metadata, mergeArrays, fromDefinitionOrDefault, pascalCase, fromAnnotationOrTypeOrDefault, fromAnnotationOrDefinitionOrTypeOrDefault, } from '@aurelia/kernel';\nimport { registerAliases, HooksDefinition, } from '../definitions';\nimport { DOM } from '../dom';\nimport { Bindable } from '../templating/bindable';\nimport { Children } from '../templating/children';\nexport function customElement(nameOrDef) {\n    return function (target) {\n        return CustomElement.define(nameOrDef, target);\n    };\n}\nexport function useShadowDOM(targetOrOptions) {\n    if (targetOrOptions === void 0) {\n        return function ($target) {\n            CustomElement.annotate($target, 'shadowOptions', { mode: 'open' });\n        };\n    }\n    if (typeof targetOrOptions !== 'function') {\n        return function ($target) {\n            CustomElement.annotate($target, 'shadowOptions', targetOrOptions);\n        };\n    }\n    CustomElement.annotate(targetOrOptions, 'shadowOptions', { mode: 'open' });\n}\nexport function containerless(target) {\n    if (target === void 0) {\n        return function ($target) {\n            CustomElement.annotate($target, 'containerless', true);\n        };\n    }\n    CustomElement.annotate(target, 'containerless', true);\n}\nexport function strict(target) {\n    if (target === void 0) {\n        return function ($target) {\n            CustomElement.annotate($target, 'isStrictBinding', true);\n        };\n    }\n    CustomElement.annotate(target, 'isStrictBinding', true);\n}\nconst definitionLookup = new WeakMap();\nexport class CustomElementDefinition {\n    constructor(Type, name, aliases, key, cache, template, instructions, dependencies, injectable, needsCompile, surrogates, bindables, childrenObservers, containerless, isStrictBinding, shadowOptions, hasSlots, strategy, hooks, scopeParts) {\n        this.Type = Type;\n        this.name = name;\n        this.aliases = aliases;\n        this.key = key;\n        this.cache = cache;\n        this.template = template;\n        this.instructions = instructions;\n        this.dependencies = dependencies;\n        this.injectable = injectable;\n        this.needsCompile = needsCompile;\n        this.surrogates = surrogates;\n        this.bindables = bindables;\n        this.childrenObservers = childrenObservers;\n        this.containerless = containerless;\n        this.isStrictBinding = isStrictBinding;\n        this.shadowOptions = shadowOptions;\n        this.hasSlots = hasSlots;\n        this.strategy = strategy;\n        this.hooks = hooks;\n        this.scopeParts = scopeParts;\n    }\n    static create(nameOrDef, Type = null) {\n        if (Type === null) {\n            const def = nameOrDef;\n            if (typeof def === 'string') {\n                throw new Error(`Cannot create a custom element definition with only a name and no type: ${nameOrDef}`);\n            }\n            // eslint-disable-next-line @typescript-eslint/unbound-method\n            const name = fromDefinitionOrDefault('name', def, CustomElement.generateName);\n            if (typeof def.Type === 'function') {\n                // This needs to be a clone (it will usually be the compiler calling this signature)\n                // TODO: we need to make sure it's documented that passing in the type via the definition (while passing in null\n                // as the \"Type\" parameter) effectively skips type analysis, so it should only be used this way for cloning purposes.\n                Type = def.Type;\n            }\n            else {\n                Type = CustomElement.generateType(pascalCase(name));\n            }\n            return new CustomElementDefinition(Type, name, mergeArrays(def.aliases), fromDefinitionOrDefault('key', def, () => CustomElement.keyFrom(name)), fromDefinitionOrDefault('cache', def, () => 0), fromDefinitionOrDefault('template', def, () => null), mergeArrays(def.instructions), mergeArrays(def.dependencies), fromDefinitionOrDefault('injectable', def, () => null), fromDefinitionOrDefault('needsCompile', def, () => true), mergeArrays(def.surrogates), Bindable.from(def.bindables), Children.from(def.childrenObservers), fromDefinitionOrDefault('containerless', def, () => false), fromDefinitionOrDefault('isStrictBinding', def, () => false), fromDefinitionOrDefault('shadowOptions', def, () => null), fromDefinitionOrDefault('hasSlots', def, () => false), fromDefinitionOrDefault('strategy', def, () => 1 /* getterSetter */), fromDefinitionOrDefault('hooks', def, () => HooksDefinition.none), mergeArrays(def.scopeParts));\n        }\n        // If a type is passed in, we ignore the Type property on the definition if it exists.\n        // TODO: document this behavior\n        if (typeof nameOrDef === 'string') {\n            return new CustomElementDefinition(Type, nameOrDef, mergeArrays(CustomElement.getAnnotation(Type, 'aliases'), Type.aliases), CustomElement.keyFrom(nameOrDef), fromAnnotationOrTypeOrDefault('cache', Type, () => 0), fromAnnotationOrTypeOrDefault('template', Type, () => null), mergeArrays(CustomElement.getAnnotation(Type, 'instructions'), Type.instructions), mergeArrays(CustomElement.getAnnotation(Type, 'dependencies'), Type.dependencies), fromAnnotationOrTypeOrDefault('injectable', Type, () => null), fromAnnotationOrTypeOrDefault('needsCompile', Type, () => true), mergeArrays(CustomElement.getAnnotation(Type, 'surrogates'), Type.surrogates), Bindable.from(...Bindable.getAll(Type), CustomElement.getAnnotation(Type, 'bindables'), Type.bindables), Children.from(...Children.getAll(Type), CustomElement.getAnnotation(Type, 'childrenObservers'), Type.childrenObservers), fromAnnotationOrTypeOrDefault('containerless', Type, () => false), fromAnnotationOrTypeOrDefault('isStrictBinding', Type, () => false), fromAnnotationOrTypeOrDefault('shadowOptions', Type, () => null), fromAnnotationOrTypeOrDefault('hasSlots', Type, () => false), fromAnnotationOrTypeOrDefault('strategy', Type, () => 1 /* getterSetter */), \n            // eslint-disable-next-line @typescript-eslint/no-unnecessary-type-assertion\n            fromAnnotationOrTypeOrDefault('hooks', Type, () => new HooksDefinition(Type.prototype)), mergeArrays(CustomElement.getAnnotation(Type, 'scopeParts'), Type.scopeParts));\n        }\n        // This is the typical default behavior, e.g. from regular CustomElement.define invocations or from @customElement deco\n        // The ViewValueConverter also uses this signature and passes in a definition where everything except for the 'hooks'\n        // property needs to be copied. So we have that exception for 'hooks', but we may need to revisit that default behavior\n        // if this turns out to be too opinionated.\n        // eslint-disable-next-line @typescript-eslint/unbound-method\n        const name = fromDefinitionOrDefault('name', nameOrDef, CustomElement.generateName);\n        return new CustomElementDefinition(Type, name, mergeArrays(CustomElement.getAnnotation(Type, 'aliases'), nameOrDef.aliases, Type.aliases), CustomElement.keyFrom(name), fromAnnotationOrDefinitionOrTypeOrDefault('cache', nameOrDef, Type, () => 0), fromAnnotationOrDefinitionOrTypeOrDefault('template', nameOrDef, Type, () => null), mergeArrays(CustomElement.getAnnotation(Type, 'instructions'), nameOrDef.instructions, Type.instructions), mergeArrays(CustomElement.getAnnotation(Type, 'dependencies'), nameOrDef.dependencies, Type.dependencies), fromAnnotationOrDefinitionOrTypeOrDefault('injectable', nameOrDef, Type, () => null), fromAnnotationOrDefinitionOrTypeOrDefault('needsCompile', nameOrDef, Type, () => true), mergeArrays(CustomElement.getAnnotation(Type, 'surrogates'), nameOrDef.surrogates, Type.surrogates), Bindable.from(...Bindable.getAll(Type), CustomElement.getAnnotation(Type, 'bindables'), Type.bindables, nameOrDef.bindables), Children.from(...Children.getAll(Type), CustomElement.getAnnotation(Type, 'childrenObservers'), Type.childrenObservers, nameOrDef.childrenObservers), fromAnnotationOrDefinitionOrTypeOrDefault('containerless', nameOrDef, Type, () => false), fromAnnotationOrDefinitionOrTypeOrDefault('isStrictBinding', nameOrDef, Type, () => false), fromAnnotationOrDefinitionOrTypeOrDefault('shadowOptions', nameOrDef, Type, () => null), fromAnnotationOrDefinitionOrTypeOrDefault('hasSlots', nameOrDef, Type, () => false), fromAnnotationOrDefinitionOrTypeOrDefault('strategy', nameOrDef, Type, () => 1 /* getterSetter */), \n        // eslint-disable-next-line @typescript-eslint/no-unnecessary-type-assertion\n        fromAnnotationOrTypeOrDefault('hooks', Type, () => new HooksDefinition(Type.prototype)), mergeArrays(CustomElement.getAnnotation(Type, 'scopeParts'), nameOrDef.scopeParts, Type.scopeParts));\n    }\n    static getOrCreate(partialDefinition) {\n        if (partialDefinition instanceof CustomElementDefinition) {\n            return partialDefinition;\n        }\n        if (definitionLookup.has(partialDefinition)) {\n            return definitionLookup.get(partialDefinition);\n        }\n        const definition = CustomElementDefinition.create(partialDefinition);\n        definitionLookup.set(partialDefinition, definition);\n        // Make sure the full definition can be retrieved from dynamically created classes as well\n        Metadata.define(CustomElement.name, definition, definition.Type);\n        return definition;\n    }\n    register(container) {\n        const { Type, key, aliases } = this;\n        Registration.transient(key, Type).register(container);\n        Registration.alias(key, Type).register(container);\n        registerAliases(aliases, CustomElement, key, container);\n    }\n}\nexport const CustomElement = {\n    name: Protocol.resource.keyFor('custom-element'),\n    keyFrom(name) {\n        return `${CustomElement.name}:${name}`;\n    },\n    isType(value) {\n        return typeof value === 'function' && Metadata.hasOwn(CustomElement.name, value);\n    },\n    for(node, nameOrSearchParents, searchParents) {\n        if (nameOrSearchParents === void 0) {\n            return Metadata.getOwn(CustomElement.name, node);\n        }\n        if (typeof nameOrSearchParents === 'string') {\n            if (searchParents !== true) {\n                const controller = Metadata.getOwn(CustomElement.name, node);\n                if (controller === void 0) {\n                    return (void 0);\n                }\n                if (controller.is(nameOrSearchParents)) {\n                    return controller;\n                }\n                return (void 0);\n            }\n            let cur = node;\n            while (cur !== null) {\n                const controller = Metadata.getOwn(CustomElement.name, cur);\n                if (controller !== void 0 && controller.is(nameOrSearchParents)) {\n                    return controller;\n                }\n                cur = DOM.getEffectiveParentNode(cur);\n            }\n            return (void 0);\n        }\n        let cur = node;\n        while (cur !== null) {\n            const controller = Metadata.getOwn(CustomElement.name, cur);\n            if (controller !== void 0) {\n                return controller;\n            }\n            cur = DOM.getEffectiveParentNode(cur);\n        }\n        return (void 0);\n    },\n    define(nameOrDef, Type) {\n        const definition = CustomElementDefinition.create(nameOrDef, Type);\n        Metadata.define(CustomElement.name, definition, definition.Type);\n        Metadata.define(CustomElement.name, definition, definition);\n        Protocol.resource.appendTo(definition.Type, CustomElement.name);\n        return definition.Type;\n    },\n    getDefinition(Type) {\n        const def = Metadata.getOwn(CustomElement.name, Type);\n        if (def === void 0) {\n            throw new Error(`No definition found for type ${Type.name}`);\n        }\n        return def;\n    },\n    annotate(Type, prop, value) {\n        Metadata.define(Protocol.annotation.keyFor(prop), value, Type);\n    },\n    getAnnotation(Type, prop) {\n        return Metadata.getOwn(Protocol.annotation.keyFor(prop), Type);\n    },\n    generateName: (function () {\n        let id = 0;\n        return function () {\n            return `unnamed-${++id}`;\n        };\n    })(),\n    createInjectable() {\n        const $injectable = function (target, property, index) {\n            const annotationParamtypes = DI.getOrCreateAnnotationParamTypes(target);\n            annotationParamtypes[index] = $injectable;\n            return target;\n        };\n        $injectable.register = function (container) {\n            // eslint-disable-next-line @typescript-eslint/consistent-type-assertions\n            return {\n                resolve(container, requestor) {\n                    if (requestor.has($injectable, true)) {\n                        return requestor.get($injectable);\n                    }\n                    else {\n                        return null;\n                    }\n                },\n            };\n        };\n        return $injectable;\n    },\n    generateType: (function () {\n        const nameDescriptor = {\n            value: '',\n            writable: false,\n            enumerable: false,\n            configurable: true,\n        };\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        const defaultProto = {};\n        return function (name, proto = defaultProto) {\n            // Anonymous class ensures that minification cannot cause unintended side-effects, and keeps the class\n            // looking similarly from the outside (when inspected via debugger, etc).\n            const Type = class {\n            };\n            // Define the name property so that Type.name can be used by end users / plugin authors if they really need to,\n            // even when minified.\n            nameDescriptor.value = name;\n            Reflect.defineProperty(Type, 'name', nameDescriptor);\n            // Assign anything from the prototype that was passed in\n            if (proto !== defaultProto) {\n                Object.assign(Type.prototype, proto);\n            }\n            return Type;\n        };\n    })(),\n};\nexport const IProjectorLocator = DI.createInterface('IProjectorLocator').noDefault();\n//# sourceMappingURL=custom-element.js.map","import { __decorate, __metadata, __param } from \"tslib\";\nimport { DI } from '@aurelia/kernel';\nimport { valueConverter } from '../value-converter';\nconst SCRIPT_REGEX = /<script\\b[^<]*(?:(?!<\\/script>)<[^<]*)*<\\/script>/gi;\nexport const ISanitizer = DI.createInterface('ISanitizer').withDefault(x => x.singleton(class {\n    sanitize(input) {\n        return input.replace(SCRIPT_REGEX, '');\n    }\n}));\n/**\n * Simple html sanitization converter to preserve whitelisted elements and attributes on a bound property containing html.\n */\nlet SanitizeValueConverter = class SanitizeValueConverter {\n    constructor(sanitizer) {\n        this.sanitizer = sanitizer;\n    }\n    /**\n     * Process the provided markup that flows to the view.\n     *\n     * @param untrustedMarkup - The untrusted markup to be sanitized.\n     */\n    toView(untrustedMarkup) {\n        if (untrustedMarkup == null) {\n            return null;\n        }\n        return this.sanitizer.sanitize(untrustedMarkup);\n    }\n};\nSanitizeValueConverter = __decorate([\n    valueConverter('sanitize'),\n    __param(0, ISanitizer),\n    __metadata(\"design:paramtypes\", [Object])\n], SanitizeValueConverter);\nexport { SanitizeValueConverter };\n//# sourceMappingURL=sanitize.js.map","import { __decorate, __metadata, __param } from \"tslib\";\nimport { all, Registration, Metadata, DI, } from '@aurelia/kernel';\nimport { CallBinding } from './binding/call-binding';\nimport { IExpressionParser } from './binding/expression-parser';\nimport { InterpolationBinding, MultiInterpolationBinding } from './binding/interpolation-binding';\nimport { LetBinding } from './binding/let-binding';\nimport { PropertyBinding } from './binding/property-binding';\nimport { RefBinding } from './binding/ref-binding';\nimport { mergeParts } from './definitions';\nimport { BindingMode } from './flags';\nimport { ILifecycle, } from './lifecycle';\nimport { IObserverLocator } from './observation/observer-locator';\nimport { CustomAttribute, } from './resources/custom-attribute';\nimport { CustomElement, } from './resources/custom-element';\nimport { Controller } from './templating/controller';\nimport { getRenderContext } from './templating/render-context';\nimport { BindingBehaviorExpression } from './binding/ast';\nimport { BindingBehaviorFactory } from './resources/binding-behavior';\nexport const ITemplateCompiler = DI.createInterface('ITemplateCompiler').noDefault();\nexport const IInstructionRenderer = DI.createInterface('IInstructionRenderer').noDefault();\nexport const IRenderer = DI.createInterface('IRenderer').noDefault();\nexport function instructionRenderer(instructionType) {\n    return function decorator(target) {\n        // wrap the constructor to set the instructionType to the instance (for better performance than when set on the prototype)\n        const decoratedTarget = function (...args) {\n            const instance = new target(...args);\n            instance.instructionType = instructionType;\n            return instance;\n        };\n        // make sure we register the decorated constructor with DI\n        decoratedTarget.register = function register(container) {\n            Registration.singleton(IInstructionRenderer, decoratedTarget).register(container);\n        };\n        // copy over any metadata such as annotations (set by preceding decorators) as well as static properties set by the user\n        // also copy the name, to be less confusing to users (so they can still use constructor.name for whatever reason)\n        // the length (number of ctor arguments) is copied for the same reason\n        const metadataKeys = Metadata.getOwnKeys(target);\n        for (const key of metadataKeys) {\n            Metadata.define(key, Metadata.getOwn(key, target), decoratedTarget);\n        }\n        const ownProperties = Object.getOwnPropertyDescriptors(target);\n        Object.keys(ownProperties).filter(prop => prop !== 'prototype').forEach(prop => {\n            Reflect.defineProperty(decoratedTarget, prop, ownProperties[prop]);\n        });\n        return decoratedTarget;\n    };\n}\n/* @internal */\nlet Renderer = class Renderer {\n    constructor(instructionRenderers) {\n        const record = this.instructionRenderers = {};\n        instructionRenderers.forEach(item => {\n            // Binding the functions to the renderer instances and calling the functions directly,\n            // prevents the `render` call sites from going megamorphic.\n            // Consumes slightly more memory but significantly less CPU.\n            record[item.instructionType] = item.render.bind(item);\n        });\n    }\n    static register(container) {\n        return Registration.singleton(IRenderer, this).register(container);\n    }\n    render(flags, context, controller, targets, definition, host, parts) {\n        const targetInstructions = definition.instructions;\n        if (targets.length !== targetInstructions.length) {\n            throw new Error(`The compiled template is not aligned with the render instructions. There are ${targets.length} targets and ${targetInstructions.length} instructions.`);\n        }\n        for (let i = 0, ii = targets.length; i < ii; ++i) {\n            this.renderInstructions(\n            /* flags        */ flags, \n            /* context      */ context, \n            /* instructions */ targetInstructions[i], \n            /* controller   */ controller, \n            /* target       */ targets[i], \n            /* parts        */ parts);\n        }\n        if (host !== void 0 && host !== null) {\n            this.renderInstructions(\n            /* flags        */ flags, \n            /* context      */ context, \n            /* instructions */ definition.surrogates, \n            /* controller   */ controller, \n            /* target       */ host, \n            /* parts        */ parts);\n        }\n    }\n    renderInstructions(flags, context, instructions, controller, target, parts) {\n        const instructionRenderers = this.instructionRenderers;\n        let current;\n        for (let i = 0, ii = instructions.length; i < ii; ++i) {\n            current = instructions[i];\n            instructionRenderers[current.type](flags, context, controller, target, current, parts);\n        }\n    }\n};\nRenderer = __decorate([\n    __param(0, all(IInstructionRenderer)),\n    __metadata(\"design:paramtypes\", [Array])\n], Renderer);\nexport { Renderer };\nexport function ensureExpression(parser, srcOrExpr, bindingType) {\n    if (typeof srcOrExpr === 'string') {\n        return parser.parse(srcOrExpr, bindingType);\n    }\n    return srcOrExpr;\n}\nexport function getTarget(potentialTarget) {\n    if (potentialTarget.bindingContext !== void 0) {\n        return potentialTarget.bindingContext;\n    }\n    return potentialTarget;\n}\nexport function getRefTarget(refHost, refTargetName) {\n    if (refTargetName === 'element') {\n        return refHost;\n    }\n    switch (refTargetName) {\n        case 'controller':\n            // this means it supports returning undefined\n            return CustomElement.for(refHost);\n        case 'view':\n            // todo: returns node sequences for fun?\n            throw new Error('Not supported API');\n        case 'view-model':\n            // this means it supports returning undefined\n            return CustomElement.for(refHost).viewModel;\n        default: {\n            const caController = CustomAttribute.for(refHost, refTargetName);\n            if (caController !== void 0) {\n                return caController.viewModel;\n            }\n            const ceController = CustomElement.for(refHost, refTargetName);\n            if (ceController === void 0) {\n                throw new Error(`Attempted to reference \"${refTargetName}\", but it was not found amongst the target's API.`);\n            }\n            return ceController.viewModel;\n        }\n    }\n}\nlet SetPropertyRenderer = \n/** @internal */\nclass SetPropertyRenderer {\n    render(flags, context, controller, target, instruction) {\n        const obj = getTarget(target);\n        if (obj.$observers !== void 0 && obj.$observers[instruction.to] !== void 0) {\n            obj.$observers[instruction.to].setValue(instruction.value, 4096 /* fromBind */);\n        }\n        else {\n            obj[instruction.to] = instruction.value;\n        }\n    }\n};\nSetPropertyRenderer = __decorate([\n    instructionRenderer(\"re\" /* setProperty */)\n    /** @internal */\n], SetPropertyRenderer);\nexport { SetPropertyRenderer };\nlet CustomElementRenderer = \n/** @internal */\nclass CustomElementRenderer {\n    render(flags, context, controller, target, instruction, parts) {\n        parts = mergeParts(parts, instruction.parts);\n        const factory = context.getComponentFactory(\n        /* parentController */ controller, \n        /* host             */ target, \n        /* instruction      */ instruction, \n        /* viewFactory      */ void 0, \n        /* location         */ target);\n        const key = CustomElement.keyFrom(instruction.res);\n        const component = factory.createComponent(key);\n        const lifecycle = context.get(ILifecycle);\n        const childController = Controller.forCustomElement(\n        /* viewModel       */ component, \n        /* lifecycle       */ lifecycle, \n        /* host            */ target, \n        /* parentContainer */ context, \n        /* parts           */ parts, \n        /* flags           */ flags);\n        flags = childController.flags;\n        Metadata.define(key, childController, target);\n        context.renderInstructions(\n        /* flags        */ flags, \n        /* instructions */ instruction.instructions, \n        /* controller   */ controller, \n        /* target       */ childController, \n        /* parts        */ parts);\n        controller.addController(childController);\n        factory.dispose();\n    }\n};\nCustomElementRenderer = __decorate([\n    instructionRenderer(\"ra\" /* hydrateElement */)\n    /** @internal */\n], CustomElementRenderer);\nexport { CustomElementRenderer };\nlet CustomAttributeRenderer = \n/** @internal */\nclass CustomAttributeRenderer {\n    render(flags, context, controller, target, instruction, parts) {\n        const factory = context.getComponentFactory(\n        /* parentController */ controller, \n        /* host             */ target, \n        /* instruction      */ instruction, \n        /* viewFactory      */ void 0, \n        /* location         */ void 0);\n        const key = CustomAttribute.keyFrom(instruction.res);\n        const component = factory.createComponent(key);\n        const lifecycle = context.get(ILifecycle);\n        const childController = Controller.forCustomAttribute(\n        /* viewModel */ component, \n        /* lifecycle */ lifecycle, \n        /* flags     */ flags);\n        Metadata.define(key, childController, target);\n        context.renderInstructions(\n        /* flags        */ flags, \n        /* instructions */ instruction.instructions, \n        /* controller   */ controller, \n        /* target       */ childController, \n        /* parts        */ parts);\n        controller.addController(childController);\n        factory.dispose();\n    }\n};\nCustomAttributeRenderer = __decorate([\n    instructionRenderer(\"rb\" /* hydrateAttribute */)\n    /** @internal */\n], CustomAttributeRenderer);\nexport { CustomAttributeRenderer };\nlet TemplateControllerRenderer = \n/** @internal */\nclass TemplateControllerRenderer {\n    render(flags, parentContext, controller, target, instruction, parts) {\n        parts = mergeParts(parts, instruction.parts);\n        const viewFactory = getRenderContext(instruction.def, parentContext, parts).getViewFactory();\n        const renderLocation = parentContext.dom.convertToRenderLocation(target);\n        const componentFactory = parentContext.getComponentFactory(\n        /* parentController */ controller, \n        /* host             */ target, \n        /* instruction      */ instruction, \n        /* viewFactory      */ viewFactory, \n        /* location         */ renderLocation);\n        const key = CustomAttribute.keyFrom(instruction.res);\n        const component = componentFactory.createComponent(key);\n        const lifecycle = parentContext.get(ILifecycle);\n        const childController = Controller.forCustomAttribute(\n        /* viewModel */ component, \n        /* lifecycle */ lifecycle, \n        /* flags     */ flags);\n        Metadata.define(key, childController, renderLocation);\n        if (instruction.link) {\n            const controllers = controller.controllers;\n            component.link(controllers[controllers.length - 1]);\n        }\n        parentContext.renderInstructions(\n        /* flags        */ flags, \n        /* instructions */ instruction.instructions, \n        /* controller   */ controller, \n        /* target       */ childController, \n        /* parts        */ parts);\n        controller.addController(childController);\n        componentFactory.dispose();\n    }\n};\nTemplateControllerRenderer = __decorate([\n    instructionRenderer(\"rc\" /* hydrateTemplateController */)\n    /** @internal */\n], TemplateControllerRenderer);\nexport { TemplateControllerRenderer };\nlet LetElementRenderer = \n/** @internal */\nclass LetElementRenderer {\n    constructor(parser, observerLocator) {\n        this.parser = parser;\n        this.observerLocator = observerLocator;\n    }\n    render(flags, context, controller, target, instruction) {\n        context.dom.remove(target);\n        const childInstructions = instruction.instructions;\n        const toBindingContext = instruction.toBindingContext;\n        let childInstruction;\n        let expr;\n        let binding;\n        for (let i = 0, ii = childInstructions.length; i < ii; ++i) {\n            childInstruction = childInstructions[i];\n            expr = ensureExpression(this.parser, childInstruction.from, 48 /* IsPropertyCommand */);\n            binding = applyBindingBehavior(new LetBinding(expr, childInstruction.to, this.observerLocator, context, toBindingContext), expr, context);\n            controller.addBinding(binding);\n        }\n    }\n};\nLetElementRenderer = __decorate([\n    instructionRenderer(\"rd\" /* hydrateLetElement */)\n    /** @internal */\n    ,\n    __param(0, IExpressionParser),\n    __param(1, IObserverLocator),\n    __metadata(\"design:paramtypes\", [Object, Object])\n], LetElementRenderer);\nexport { LetElementRenderer };\nlet CallBindingRenderer = \n/** @internal */\nclass CallBindingRenderer {\n    constructor(parser, observerLocator) {\n        this.parser = parser;\n        this.observerLocator = observerLocator;\n    }\n    render(flags, context, controller, target, instruction) {\n        const expr = ensureExpression(this.parser, instruction.from, 153 /* CallCommand */);\n        const binding = applyBindingBehavior(new CallBinding(expr, getTarget(target), instruction.to, this.observerLocator, context), expr, context);\n        controller.addBinding(binding);\n    }\n};\nCallBindingRenderer = __decorate([\n    instructionRenderer(\"rh\" /* callBinding */)\n    /** @internal */\n    ,\n    __param(0, IExpressionParser),\n    __param(1, IObserverLocator),\n    __metadata(\"design:paramtypes\", [Object, Object])\n], CallBindingRenderer);\nexport { CallBindingRenderer };\nlet RefBindingRenderer = \n/** @internal */\nclass RefBindingRenderer {\n    constructor(parser) {\n        this.parser = parser;\n    }\n    render(flags, context, controller, target, instruction) {\n        const expr = ensureExpression(this.parser, instruction.from, 5376 /* IsRef */);\n        const binding = applyBindingBehavior(new RefBinding(expr, getRefTarget(target, instruction.to), context), expr, context);\n        controller.addBinding(binding);\n    }\n};\nRefBindingRenderer = __decorate([\n    instructionRenderer(\"rj\" /* refBinding */)\n    /** @internal */\n    ,\n    __param(0, IExpressionParser),\n    __metadata(\"design:paramtypes\", [Object])\n], RefBindingRenderer);\nexport { RefBindingRenderer };\nlet InterpolationBindingRenderer = \n/** @internal */\nclass InterpolationBindingRenderer {\n    constructor(parser, observerLocator) {\n        this.parser = parser;\n        this.observerLocator = observerLocator;\n    }\n    render(flags, context, controller, target, instruction) {\n        let binding;\n        const expr = ensureExpression(this.parser, instruction.from, 2048 /* Interpolation */);\n        if (expr.isMulti) {\n            binding = applyBindingBehavior(new MultiInterpolationBinding(this.observerLocator, expr, getTarget(target), instruction.to, BindingMode.toView, context), expr, context);\n        }\n        else {\n            binding = applyBindingBehavior(new InterpolationBinding(expr.firstExpression, expr, getTarget(target), instruction.to, BindingMode.toView, this.observerLocator, context, true), expr, context);\n        }\n        controller.addBinding(binding);\n    }\n};\nInterpolationBindingRenderer = __decorate([\n    instructionRenderer(\"rf\" /* interpolation */)\n    /** @internal */\n    ,\n    __param(0, IExpressionParser),\n    __param(1, IObserverLocator),\n    __metadata(\"design:paramtypes\", [Object, Object])\n], InterpolationBindingRenderer);\nexport { InterpolationBindingRenderer };\nlet PropertyBindingRenderer = \n/** @internal */\nclass PropertyBindingRenderer {\n    constructor(parser, observerLocator) {\n        this.parser = parser;\n        this.observerLocator = observerLocator;\n    }\n    render(flags, context, controller, target, instruction) {\n        const expr = ensureExpression(this.parser, instruction.from, 48 /* IsPropertyCommand */ | instruction.mode);\n        const binding = applyBindingBehavior(new PropertyBinding(expr, getTarget(target), instruction.to, instruction.mode, this.observerLocator, context), expr, context);\n        controller.addBinding(binding);\n    }\n};\nPropertyBindingRenderer = __decorate([\n    instructionRenderer(\"rg\" /* propertyBinding */)\n    /** @internal */\n    ,\n    __param(0, IExpressionParser),\n    __param(1, IObserverLocator),\n    __metadata(\"design:paramtypes\", [Object, Object])\n], PropertyBindingRenderer);\nexport { PropertyBindingRenderer };\nlet IteratorBindingRenderer = \n/** @internal */\nclass IteratorBindingRenderer {\n    constructor(parser, observerLocator) {\n        this.parser = parser;\n        this.observerLocator = observerLocator;\n    }\n    render(flags, context, controller, target, instruction) {\n        const expr = ensureExpression(this.parser, instruction.from, 539 /* ForCommand */);\n        const binding = applyBindingBehavior(new PropertyBinding(expr, getTarget(target), instruction.to, BindingMode.toView, this.observerLocator, context), expr, context);\n        controller.addBinding(binding);\n    }\n};\nIteratorBindingRenderer = __decorate([\n    instructionRenderer(\"rk\" /* iteratorBinding */)\n    /** @internal */\n    ,\n    __param(0, IExpressionParser),\n    __param(1, IObserverLocator),\n    __metadata(\"design:paramtypes\", [Object, Object])\n], IteratorBindingRenderer);\nexport { IteratorBindingRenderer };\nlet behaviorExpressionIndex = 0;\nconst behaviorExpressions = [];\nexport function applyBindingBehavior(binding, expression, locator) {\n    while (expression instanceof BindingBehaviorExpression) {\n        behaviorExpressions[behaviorExpressionIndex++] = expression;\n        expression = expression.expression;\n    }\n    while (behaviorExpressionIndex > 0) {\n        const behaviorExpression = behaviorExpressions[--behaviorExpressionIndex];\n        const behaviorOrFactory = locator.get(behaviorExpression.behaviorKey);\n        if (behaviorOrFactory instanceof BindingBehaviorFactory) {\n            binding = behaviorOrFactory.construct(binding, behaviorExpression);\n        }\n    }\n    behaviorExpressions.length = 0;\n    return binding;\n}\n//# sourceMappingURL=renderer.js.map","import { CustomElementDefinition } from '../resources/custom-element';\nimport { ITargetedInstruction, mergeParts } from '../definitions';\nimport { InstanceProvider, Reporter } from '@aurelia/kernel';\nimport { IController, IViewFactory, ILifecycle } from '../lifecycle';\nimport { IDOM, IRenderLocation } from '../dom';\nimport { IRenderer, ITemplateCompiler } from '../renderer';\nimport { ViewFactory } from './view';\nconst definitionContainerLookup = new WeakMap();\nconst definitionContainerPartsLookup = new WeakMap();\nconst fragmentCache = new WeakMap();\nexport function isRenderContext(value) {\n    return value instanceof RenderContext;\n}\nexport function getRenderContext(partialDefinition, parentContainer, parts) {\n    const definition = CustomElementDefinition.getOrCreate(partialDefinition);\n    if (isRenderContext(parentContainer)) {\n        parts = mergeParts(parentContainer.parts, parts);\n    }\n    // injectable completely prevents caching, ensuring that each instance gets a new render context\n    if (definition.injectable !== null) {\n        return new RenderContext(definition, parentContainer, parts);\n    }\n    if (parts === void 0) {\n        let containerLookup = definitionContainerLookup.get(definition);\n        if (containerLookup === void 0) {\n            definitionContainerLookup.set(definition, containerLookup = new WeakMap());\n        }\n        let context = containerLookup.get(parentContainer);\n        if (context === void 0) {\n            containerLookup.set(parentContainer, context = new RenderContext(definition, parentContainer, parts));\n        }\n        return context;\n    }\n    let containerPartsLookup = definitionContainerPartsLookup.get(definition);\n    if (containerPartsLookup === void 0) {\n        definitionContainerPartsLookup.set(definition, containerPartsLookup = new WeakMap());\n    }\n    let partsLookup = containerPartsLookup.get(parentContainer);\n    if (partsLookup === void 0) {\n        containerPartsLookup.set(parentContainer, partsLookup = new WeakMap());\n    }\n    let context = partsLookup.get(parts);\n    if (context === void 0) {\n        partsLookup.set(parts, context = new RenderContext(definition, parentContainer, parts));\n    }\n    return context;\n}\nexport class RenderContext {\n    constructor(definition, parentContainer, parts) {\n        this.definition = definition;\n        this.parentContainer = parentContainer;\n        this.parts = parts;\n        this.viewModelProvider = void 0;\n        this.fragment = null;\n        this.factory = void 0;\n        this.isCompiled = false;\n        this.compiledDefinition = (void 0);\n        const container = this.container = parentContainer.createChild();\n        this.renderer = container.get(IRenderer);\n        container.registerResolver(IViewFactory, this.factoryProvider = new ViewFactoryProvider());\n        container.registerResolver(IController, this.parentControllerProvider = new InstanceProvider());\n        container.registerResolver(ITargetedInstruction, this.instructionProvider = new InstanceProvider());\n        container.registerResolver(IRenderLocation, this.renderLocationProvider = new InstanceProvider());\n        (this.dom = container.get(IDOM)).registerElementResolver(container, this.elementProvider = new InstanceProvider());\n        container.register(...definition.dependencies);\n    }\n    // #region IServiceLocator api\n    has(key, searchAncestors) {\n        return this.container.has(key, searchAncestors);\n    }\n    get(key) {\n        return this.container.get(key);\n    }\n    getAll(key) {\n        return this.container.getAll(key);\n    }\n    // #endregion\n    // #region IContainer api\n    register(...params) {\n        return this.container.register(...params);\n    }\n    registerResolver(key, resolver) {\n        return this.container.registerResolver(key, resolver);\n    }\n    registerTransformer(key, transformer) {\n        return this.container.registerTransformer(key, transformer);\n    }\n    getResolver(key, autoRegister) {\n        return this.container.getResolver(key, autoRegister);\n    }\n    getFactory(key) {\n        return this.container.getFactory(key);\n    }\n    createChild() {\n        return this.container.createChild();\n    }\n    // #endregion\n    // #region IRenderContext api\n    compile() {\n        let compiledDefinition;\n        if (this.isCompiled) {\n            return this;\n        }\n        this.isCompiled = true;\n        const definition = this.definition;\n        if (definition.needsCompile) {\n            const container = this.container;\n            const compiler = container.get(ITemplateCompiler);\n            compiledDefinition = this.compiledDefinition = compiler.compile(definition, container);\n        }\n        else {\n            compiledDefinition = this.compiledDefinition = definition;\n        }\n        // Support Recursive Components by adding self to own context\n        compiledDefinition.register(this);\n        if (fragmentCache.has(compiledDefinition)) {\n            this.fragment = fragmentCache.get(compiledDefinition);\n        }\n        else {\n            const template = compiledDefinition.template;\n            if (template === null) {\n                fragmentCache.set(compiledDefinition, null);\n            }\n            else {\n                fragmentCache.set(compiledDefinition, this.fragment = this.dom.createDocumentFragment(template));\n            }\n        }\n        return this;\n    }\n    getViewFactory(name) {\n        let factory = this.factory;\n        if (factory === void 0) {\n            if (name === void 0) {\n                name = this.definition.name;\n            }\n            const lifecycle = this.parentContainer.get(ILifecycle);\n            factory = this.factory = new ViewFactory(name, this, lifecycle, this.parts);\n        }\n        return factory;\n    }\n    beginChildComponentOperation(instance) {\n        const definition = this.definition;\n        if (definition.injectable !== null) {\n            if (this.viewModelProvider === void 0) {\n                this.container.registerResolver(definition.injectable, this.viewModelProvider = new InstanceProvider());\n            }\n            this.viewModelProvider.prepare(instance);\n        }\n        return this;\n    }\n    // #endregion\n    // #region ICompiledRenderContext api\n    createNodes() {\n        return this.dom.createNodeSequence(this.fragment);\n    }\n    // TODO: split up into 2 methods? getComponentFactory + getSyntheticFactory or something\n    getComponentFactory(parentController, host, instruction, viewFactory, location) {\n        if (parentController !== void 0) {\n            this.parentControllerProvider.prepare(parentController);\n        }\n        if (host !== void 0) {\n            // TODO: fix provider input type, Key is probably not a good constraint\n            this.elementProvider.prepare(host);\n        }\n        if (instruction !== void 0) {\n            this.instructionProvider.prepare(instruction);\n        }\n        if (location !== void 0) {\n            this.renderLocationProvider.prepare(location);\n        }\n        if (viewFactory !== void 0) {\n            this.factoryProvider.prepare(viewFactory);\n        }\n        return this;\n    }\n    // #endregion\n    // #region IComponentFactory api\n    createComponent(resourceKey) {\n        return this.container.get(resourceKey);\n    }\n    render(flags, controller, targets, templateDefinition, host, parts) {\n        this.renderer.render(flags, this, controller, targets, templateDefinition, host, parts);\n    }\n    renderInstructions(flags, instructions, controller, target, parts) {\n        this.renderer.renderInstructions(flags, this, instructions, controller, target, parts);\n    }\n    dispose() {\n        this.factoryProvider.dispose();\n        this.parentControllerProvider.dispose();\n        this.instructionProvider.dispose();\n        this.elementProvider.dispose();\n        this.renderLocationProvider.dispose();\n    }\n}\n/** @internal */\nexport class ViewFactoryProvider {\n    constructor() {\n        this.factory = null;\n    }\n    prepare(factory) {\n        this.factory = factory;\n    }\n    resolve(handler, requestor) {\n        const factory = this.factory;\n        if (factory === null) { // unmet precondition: call prepare\n            throw Reporter.error(50); // TODO: organize error codes\n        }\n        if (typeof factory.name !== 'string' || factory.name.length === 0) { // unmet invariant: factory must have a name\n            throw Reporter.error(51); // TODO: organize error codes\n        }\n        return factory.resolve(requestor);\n    }\n    dispose() {\n        this.factory = null;\n    }\n}\n//# sourceMappingURL=render-context.js.map","import { mergeDistinct, nextId, } from '@aurelia/kernel';\nimport { HooksDefinition, } from '../definitions';\nimport { AggregateContinuationTask, ContinuationTask, hasAsyncWork, LifecycleTask, } from '../lifecycle-task';\nimport { Scope, } from '../observation/binding-context';\nimport { ProxyObserver, } from '../observation/proxy-observer';\nimport { BindableObserver, } from '../observation/bindable-observer';\nimport { IProjectorLocator, CustomElementDefinition, CustomElement, } from '../resources/custom-element';\nimport { CustomAttribute, } from '../resources/custom-attribute';\nimport { getRenderContext, } from './render-context';\nimport { ChildrenObserver } from './children';\nconst controllerLookup = new WeakMap();\nexport class Controller {\n    constructor(vmKind, flags, lifecycle, hooks, \n    /**\n     * The viewFactory. Only present for synthetic views.\n     */\n    viewFactory, \n    /**\n     * The backing viewModel. This is never a proxy. Only present for custom attributes and elements.\n     */\n    viewModel, \n    /**\n     * The binding context. This may be a proxy. If it is not, then it is the same instance as the viewModel. Only present for custom attributes and elements.\n     */\n    bindingContext, \n    /**\n     * The physical host dom node. Only present for custom elements.\n     */\n    host) {\n        this.vmKind = vmKind;\n        this.flags = flags;\n        this.lifecycle = lifecycle;\n        this.hooks = hooks;\n        this.viewFactory = viewFactory;\n        this.viewModel = viewModel;\n        this.bindingContext = bindingContext;\n        this.host = host;\n        this.id = nextId('au$component');\n        this.nextBound = void 0;\n        this.nextUnbound = void 0;\n        this.prevBound = void 0;\n        this.prevUnbound = void 0;\n        this.nextAttached = void 0;\n        this.nextDetached = void 0;\n        this.prevAttached = void 0;\n        this.prevDetached = void 0;\n        this.nextMount = void 0;\n        this.nextUnmount = void 0;\n        this.prevMount = void 0;\n        this.prevUnmount = void 0;\n        this.parent = void 0;\n        this.bindings = void 0;\n        this.controllers = void 0;\n        this.state = 0 /* none */;\n        this.scopeParts = void 0;\n        this.isStrictBinding = false;\n        this.scope = void 0;\n        this.part = void 0;\n        this.projector = void 0;\n        this.nodes = void 0;\n        this.context = void 0;\n        this.location = void 0;\n        this.mountStrategy = 1 /* insertBefore */;\n    }\n    static getCached(viewModel) {\n        return controllerLookup.get(viewModel);\n    }\n    static getCachedOrThrow(viewModel) {\n        const controller = Controller.getCached(viewModel);\n        if (controller === void 0) {\n            throw new Error(`There is no cached controller for the provided ViewModel: ${String(viewModel)}`);\n        }\n        return controller;\n    }\n    static forCustomElement(viewModel, lifecycle, host, parentContainer, parts, flags = 0 /* none */) {\n        if (controllerLookup.has(viewModel)) {\n            return controllerLookup.get(viewModel);\n        }\n        const definition = CustomElement.getDefinition(viewModel.constructor);\n        flags |= definition.strategy;\n        const controller = new Controller(0 /* customElement */, \n        /* flags          */ flags, \n        /* lifecycle      */ lifecycle, \n        /* hooks          */ definition.hooks, \n        /* viewFactory    */ void 0, \n        /* viewModel      */ viewModel, \n        /* bindingContext */ getBindingContext(flags, viewModel), \n        /* host           */ host);\n        controllerLookup.set(viewModel, controller);\n        controller.hydrateCustomElement(definition, parentContainer, parts);\n        return controller;\n    }\n    static forCustomAttribute(viewModel, lifecycle, flags = 0 /* none */) {\n        if (controllerLookup.has(viewModel)) {\n            return controllerLookup.get(viewModel);\n        }\n        const definition = CustomAttribute.getDefinition(viewModel.constructor);\n        flags |= definition.strategy;\n        const controller = new Controller(1 /* customAttribute */, \n        /* flags          */ flags, \n        /* lifecycle      */ lifecycle, \n        /* hooks          */ definition.hooks, \n        /* viewFactory    */ void 0, \n        /* viewModel      */ viewModel, \n        /* bindingContext */ getBindingContext(flags, viewModel), \n        /* host           */ void 0);\n        controllerLookup.set(viewModel, controller);\n        controller.hydrateCustomAttribute(definition);\n        return controller;\n    }\n    static forSyntheticView(viewFactory, lifecycle, context, flags = 0 /* none */) {\n        const controller = new Controller(2 /* synthetic */, \n        /* flags          */ flags, \n        /* lifecycle      */ lifecycle, \n        /* hooks          */ HooksDefinition.none, \n        /* viewFactory    */ viewFactory, \n        /* viewModel      */ void 0, \n        /* bindingContext */ void 0, \n        /* host           */ void 0);\n        controller.hydrateSynthetic(context, viewFactory.parts);\n        return controller;\n    }\n    hydrateCustomElement(definition, parentContainer, parts) {\n        const flags = this.flags |= definition.strategy;\n        const instance = this.viewModel;\n        createObservers(this.lifecycle, definition, flags, instance);\n        createChildrenObservers(this, definition, flags, instance);\n        this.scope = Scope.create(flags, this.bindingContext, null);\n        const hooks = this.hooks;\n        if (hooks.hasCreate) {\n            const result = instance.create(\n            /* controller      */ this, \n            /* parentContainer */ parentContainer, \n            /* definition      */ definition, \n            /* parts           */ parts);\n            if (result !== void 0 && result !== definition) {\n                definition = CustomElementDefinition.getOrCreate(result);\n            }\n        }\n        const context = this.context = getRenderContext(definition, parentContainer, parts);\n        // Support Recursive Components by adding self to own context\n        definition.register(context);\n        if (definition.injectable !== null) {\n            // If the element is registered as injectable, support injecting the instance into children\n            context.beginChildComponentOperation(instance);\n        }\n        if (hooks.hasBeforeCompile) {\n            instance.beforeCompile(this);\n        }\n        const compiledContext = context.compile();\n        const compiledDefinition = compiledContext.compiledDefinition;\n        this.scopeParts = compiledDefinition.scopeParts;\n        this.isStrictBinding = compiledDefinition.isStrictBinding;\n        const projectorLocator = parentContainer.get(IProjectorLocator);\n        this.projector = projectorLocator.getElementProjector(context.dom, this, this.host, compiledDefinition);\n        instance.$controller = this;\n        const nodes = this.nodes = compiledContext.createNodes();\n        if (hooks.hasAfterCompile) {\n            instance.afterCompile(this);\n        }\n        const targets = nodes.findTargets();\n        compiledContext.render(\n        /* flags      */ this.flags, \n        /* controller */ this, \n        /* targets    */ targets, \n        /* definition */ compiledDefinition, \n        /* host       */ this.host, \n        /* parts      */ parts);\n        if (hooks.hasAfterCompileChildren) {\n            instance.afterCompileChildren(this);\n        }\n    }\n    hydrateCustomAttribute(definition) {\n        const flags = this.flags | definition.strategy;\n        const instance = this.viewModel;\n        createObservers(this.lifecycle, definition, flags, instance);\n        instance.$controller = this;\n    }\n    hydrateSynthetic(context, parts) {\n        this.context = context;\n        const compiledContext = context.compile();\n        const compiledDefinition = compiledContext.compiledDefinition;\n        this.scopeParts = compiledDefinition.scopeParts;\n        this.isStrictBinding = compiledDefinition.isStrictBinding;\n        const nodes = this.nodes = compiledContext.createNodes();\n        const targets = nodes.findTargets();\n        compiledContext.render(\n        /* flags      */ this.flags, \n        /* controller */ this, \n        /* targets    */ targets, \n        /* definition */ compiledDefinition, \n        /* host       */ void 0, \n        /* parts      */ parts);\n    }\n    addBinding(binding) {\n        if (this.bindings === void 0) {\n            this.bindings = [binding];\n        }\n        else {\n            this.bindings[this.bindings.length] = binding;\n        }\n    }\n    addController(controller) {\n        if (this.controllers === void 0) {\n            this.controllers = [controller];\n        }\n        else {\n            this.controllers[this.controllers.length] = controller;\n        }\n    }\n    is(name) {\n        switch (this.vmKind) {\n            case 1 /* customAttribute */: {\n                const def = CustomAttribute.getDefinition(this.viewModel.constructor);\n                return def.name === name;\n            }\n            case 0 /* customElement */: {\n                const def = CustomElement.getDefinition(this.viewModel.constructor);\n                return def.name === name;\n            }\n            case 2 /* synthetic */:\n                return this.viewFactory.name === name;\n        }\n    }\n    lockScope(scope) {\n        this.scope = scope;\n        this.state |= 256 /* hasLockedScope */;\n    }\n    hold(location, mountStrategy) {\n        this.state = (this.state | 512 /* canBeCached */) ^ 512 /* canBeCached */;\n        this.location = location;\n        this.mountStrategy = mountStrategy;\n    }\n    release(flags) {\n        this.state |= 512 /* canBeCached */;\n        if ((this.state & 32 /* isAttached */) > 0) {\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            return this.viewFactory.canReturnToCache(this); // non-null is implied by the hook\n        }\n        return this.unmountSynthetic(flags);\n    }\n    bind(flags, scope, part) {\n        this.part = part;\n        // TODO: benchmark which of these techniques is fastest:\n        // - the current one (enum with switch)\n        // - set the name of the method in the constructor, e.g. this.bindMethod = 'bindCustomElement'\n        //    and then doing this[this.bindMethod](flags, scope) instead of switch (eliminates branching\n        //    but computed property access might be harmful to browser optimizations)\n        // - make bind() a property and set it to one of the 3 methods in the constructor,\n        //    e.g. this.bind = this.bindCustomElement (eliminates branching + reduces call stack depth by 1,\n        //    but might make the call site megamorphic)\n        flags |= 4096 /* fromBind */;\n        switch (this.vmKind) {\n            case 0 /* customElement */:\n                return this.bindCustomElement(flags, scope);\n            case 1 /* customAttribute */:\n                return this.bindCustomAttribute(flags, scope);\n            case 2 /* synthetic */:\n                return this.bindSynthetic(flags, scope);\n        }\n    }\n    unbind(flags) {\n        flags |= 8192 /* fromUnbind */;\n        switch (this.vmKind) {\n            case 0 /* customElement */:\n                return this.unbindCustomElement(flags);\n            case 1 /* customAttribute */:\n                return this.unbindCustomAttribute(flags);\n            case 2 /* synthetic */:\n                return this.unbindSynthetic(flags);\n        }\n    }\n    afterBind(flags) {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        this.bindingContext.afterBind(flags); // non-null is implied by the hook\n    }\n    afterUnbind(flags) {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        this.bindingContext.afterUnbind(flags); // non-null is implied by the hook\n    }\n    attach(flags) {\n        if ((this.state & 40 /* isAttachedOrAttaching */) > 0 && (flags & 33554432 /* reorderNodes */) === 0) {\n            return;\n        }\n        flags |= 16384 /* fromAttach */;\n        switch (this.vmKind) {\n            case 0 /* customElement */:\n                this.attachCustomElement(flags);\n                break;\n            case 1 /* customAttribute */:\n                this.attachCustomAttribute(flags);\n                break;\n            case 2 /* synthetic */:\n                this.attachSynthetic(flags);\n        }\n    }\n    detach(flags) {\n        if ((this.state & 40 /* isAttachedOrAttaching */) === 0) {\n            return;\n        }\n        flags |= 32768 /* fromDetach */;\n        switch (this.vmKind) {\n            case 0 /* customElement */:\n                this.detachCustomElement(flags);\n                break;\n            case 1 /* customAttribute */:\n                this.detachCustomAttribute(flags);\n                break;\n            case 2 /* synthetic */:\n                this.detachSynthetic(flags);\n        }\n    }\n    afterAttach(flags) {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        this.bindingContext.afterAttach(flags); // non-null is implied by the hook\n    }\n    afterDetach(flags) {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        this.bindingContext.afterDetach(flags); // non-null is implied by the hook\n    }\n    mount(flags) {\n        switch (this.vmKind) {\n            case 0 /* customElement */:\n                this.mountCustomElement(flags);\n                break;\n            case 2 /* synthetic */:\n                this.mountSynthetic(flags);\n        }\n    }\n    unmount(flags) {\n        switch (this.vmKind) {\n            case 0 /* customElement */:\n                this.unmountCustomElement(flags);\n                break;\n            case 2 /* synthetic */:\n                this.unmountSynthetic(flags);\n        }\n    }\n    cache(flags) {\n        switch (this.vmKind) {\n            case 0 /* customElement */:\n                this.cacheCustomElement(flags);\n                break;\n            case 1 /* customAttribute */:\n                this.cacheCustomAttribute(flags);\n                break;\n            case 2 /* synthetic */:\n                this.cacheSynthetic(flags);\n        }\n    }\n    getTargetAccessor(propertyName) {\n        const { bindings } = this;\n        if (bindings !== void 0) {\n            const binding = bindings.find(b => b.targetProperty === propertyName);\n            if (binding !== void 0) {\n                return binding.targetObserver;\n            }\n        }\n        return void 0;\n    }\n    // #region bind/unbind\n    bindCustomElement(flags, scope) {\n        const $scope = this.scope;\n        $scope.parentScope = scope === void 0 ? null : scope;\n        $scope.scopeParts = this.scopeParts;\n        if ((this.state & 4 /* isBound */) > 0) {\n            return LifecycleTask.done;\n        }\n        flags |= 4096 /* fromBind */;\n        this.state |= 1 /* isBinding */;\n        this.lifecycle.afterBind.begin();\n        if (this.hooks.hasBeforeBind) {\n            const ret = this.bindingContext.beforeBind(flags);\n            if (hasAsyncWork(ret)) {\n                // this.scope could be reassigned during beforeBind so reference that instead of $scope.\n                return new ContinuationTask(ret, this.bindBindings, this, flags, this.scope);\n            }\n        }\n        return this.bindBindings(flags, this.scope);\n    }\n    bindCustomAttribute(flags, scope) {\n        if ((this.state & 4 /* isBound */) > 0) {\n            if (this.scope === scope) {\n                return LifecycleTask.done;\n            }\n            flags |= 4096 /* fromBind */;\n            const task = this.unbind(flags);\n            if (!task.done) {\n                return new ContinuationTask(task, this.bind, this, flags, scope);\n            }\n        }\n        else {\n            flags |= 4096 /* fromBind */;\n        }\n        this.state |= 1 /* isBinding */;\n        this.scope = scope;\n        this.lifecycle.afterBind.begin();\n        if (this.hooks.hasBeforeBind) {\n            const ret = this.bindingContext.beforeBind(flags);\n            if (hasAsyncWork(ret)) {\n                return new ContinuationTask(ret, this.endBind, this, flags);\n            }\n        }\n        this.endBind(flags);\n        return LifecycleTask.done;\n    }\n    bindSynthetic(flags, scope) {\n        if (scope == void 0) {\n            throw new Error(`Scope is null or undefined`); // TODO: create error code\n        }\n        scope.scopeParts = mergeDistinct(scope.scopeParts, this.scopeParts, false);\n        if ((this.state & 4 /* isBound */) > 0) {\n            if (this.scope === scope || (this.state & 256 /* hasLockedScope */) > 0) {\n                return LifecycleTask.done;\n            }\n            flags |= 4096 /* fromBind */;\n            const task = this.unbind(flags);\n            if (!task.done) {\n                return new ContinuationTask(task, this.bind, this, flags, scope);\n            }\n        }\n        else {\n            flags |= 4096 /* fromBind */;\n        }\n        if ((this.state & 256 /* hasLockedScope */) === 0) {\n            this.scope = scope;\n        }\n        this.state |= 1 /* isBinding */;\n        this.lifecycle.afterBind.begin();\n        return this.bindBindings(flags, this.scope);\n    }\n    bindBindings(flags, scope) {\n        const { bindings } = this;\n        if (bindings !== void 0) {\n            const { length } = bindings;\n            if (this.isStrictBinding) {\n                flags |= 4 /* isStrictBindingStrategy */;\n            }\n            for (let i = 0; i < length; ++i) {\n                bindings[i].$bind(flags, scope, this.part);\n            }\n        }\n        return this.bindControllers(flags, this.scope);\n    }\n    bindControllers(flags, scope) {\n        let tasks = void 0;\n        let task;\n        const { controllers } = this;\n        if (controllers !== void 0) {\n            const { length } = controllers;\n            for (let i = 0; i < length; ++i) {\n                controllers[i].parent = this;\n                task = controllers[i].bind(flags, scope, this.part);\n                if (!task.done) {\n                    if (tasks === void 0) {\n                        tasks = [];\n                    }\n                    tasks.push(task);\n                }\n            }\n        }\n        if (tasks === void 0) {\n            this.endBind(flags);\n            return LifecycleTask.done;\n        }\n        return new AggregateContinuationTask(tasks, this.endBind, this, flags);\n    }\n    endBind(flags) {\n        if (this.hooks.hasAfterBind) {\n            this.lifecycle.afterBind.add(this);\n        }\n        this.state = this.state ^ 1 /* isBinding */ | 4 /* isBound */;\n        this.lifecycle.afterBind.end(flags);\n    }\n    unbindCustomElement(flags) {\n        if ((this.state & 4 /* isBound */) === 0) {\n            return LifecycleTask.done;\n        }\n        this.scope.parentScope = null;\n        this.state |= 2 /* isUnbinding */;\n        flags |= 8192 /* fromUnbind */;\n        this.lifecycle.afterUnbind.begin();\n        if (this.hooks.hasBeforeUnbind) {\n            const ret = this.bindingContext.beforeUnbind(flags);\n            if (hasAsyncWork(ret)) {\n                return new ContinuationTask(ret, this.unbindControllers, this, flags);\n            }\n        }\n        return this.unbindControllers(flags);\n    }\n    unbindCustomAttribute(flags) {\n        if ((this.state & 4 /* isBound */) === 0) {\n            return LifecycleTask.done;\n        }\n        this.state |= 2 /* isUnbinding */;\n        flags |= 8192 /* fromUnbind */;\n        this.lifecycle.afterUnbind.begin();\n        if (this.hooks.hasBeforeUnbind) {\n            const ret = this.bindingContext.beforeUnbind(flags);\n            if (hasAsyncWork(ret)) {\n                return new ContinuationTask(ret, this.endUnbind, this, flags);\n            }\n        }\n        this.endUnbind(flags);\n        return LifecycleTask.done;\n    }\n    unbindSynthetic(flags) {\n        if ((this.state & 4 /* isBound */) === 0) {\n            return LifecycleTask.done;\n        }\n        this.state |= 2 /* isUnbinding */;\n        flags |= 8192 /* fromUnbind */;\n        this.lifecycle.afterUnbind.begin();\n        return this.unbindControllers(flags);\n    }\n    unbindBindings(flags) {\n        const { bindings } = this;\n        if (bindings !== void 0) {\n            for (let i = bindings.length - 1; i >= 0; --i) {\n                bindings[i].$unbind(flags);\n            }\n        }\n        this.endUnbind(flags);\n    }\n    unbindControllers(flags) {\n        let tasks = void 0;\n        let task;\n        const { controllers } = this;\n        if (controllers !== void 0) {\n            for (let i = controllers.length - 1; i >= 0; --i) {\n                task = controllers[i].unbind(flags);\n                controllers[i].parent = void 0;\n                if (!task.done) {\n                    if (tasks === void 0) {\n                        tasks = [];\n                    }\n                    tasks.push(task);\n                }\n            }\n        }\n        if (tasks === void 0) {\n            this.unbindBindings(flags);\n            return LifecycleTask.done;\n        }\n        return new AggregateContinuationTask(tasks, this.unbindBindings, this, flags);\n    }\n    endUnbind(flags) {\n        switch (this.vmKind) {\n            case 1 /* customAttribute */:\n                this.scope = void 0;\n                break;\n            case 2 /* synthetic */:\n                if ((this.state & 256 /* hasLockedScope */) === 0) {\n                    this.scope = void 0;\n                }\n        }\n        if (this.hooks.hasAfterUnbind) {\n            this.lifecycle.afterUnbind.add(this);\n        }\n        this.state = (this.state | 6 /* isBoundOrUnbinding */) ^ 6 /* isBoundOrUnbinding */;\n        this.lifecycle.afterUnbind.end(flags);\n    }\n    // #endregion\n    // #region attach/detach\n    attachCustomElement(flags) {\n        flags |= 16384 /* fromAttach */;\n        this.state |= 8 /* isAttaching */;\n        this.lifecycle.mount.add(this);\n        this.lifecycle.afterAttach.begin();\n        if (this.hooks.hasBeforeAttach) {\n            this.bindingContext.beforeAttach(flags);\n        }\n        this.attachControllers(flags);\n        if (this.hooks.hasAfterAttach) {\n            this.lifecycle.afterAttach.add(this);\n        }\n        this.state = this.state ^ 8 /* isAttaching */ | 32 /* isAttached */;\n        this.lifecycle.afterAttach.end(flags);\n    }\n    attachCustomAttribute(flags) {\n        flags |= 16384 /* fromAttach */;\n        this.state |= 8 /* isAttaching */;\n        this.lifecycle.afterAttach.begin();\n        if (this.hooks.hasBeforeAttach) {\n            this.bindingContext.beforeAttach(flags);\n        }\n        if (this.hooks.hasAfterAttach) {\n            this.lifecycle.afterAttach.add(this);\n        }\n        this.state = this.state ^ 8 /* isAttaching */ | 32 /* isAttached */;\n        this.lifecycle.afterAttach.end(flags);\n    }\n    attachSynthetic(flags) {\n        if (((this.state & 32 /* isAttached */) > 0 && flags & 33554432 /* reorderNodes */) > 0) {\n            this.lifecycle.mount.add(this);\n        }\n        else {\n            flags |= 16384 /* fromAttach */;\n            this.state |= 8 /* isAttaching */;\n            this.lifecycle.mount.add(this);\n            this.lifecycle.afterAttach.begin();\n            this.attachControllers(flags);\n            this.state = this.state ^ 8 /* isAttaching */ | 32 /* isAttached */;\n            this.lifecycle.afterAttach.end(flags);\n        }\n    }\n    detachCustomElement(flags) {\n        flags |= 32768 /* fromDetach */;\n        this.state |= 16 /* isDetaching */;\n        this.lifecycle.afterDetach.begin();\n        this.lifecycle.unmount.add(this);\n        if (this.hooks.hasBeforeDetach) {\n            this.bindingContext.beforeDetach(flags);\n        }\n        this.detachControllers(flags);\n        if (this.hooks.hasAfterDetach) {\n            this.lifecycle.afterDetach.add(this);\n        }\n        this.state = (this.state | 48 /* isAttachedOrDetaching */) ^ 48 /* isAttachedOrDetaching */;\n        this.lifecycle.afterDetach.end(flags);\n    }\n    detachCustomAttribute(flags) {\n        flags |= 32768 /* fromDetach */;\n        this.state |= 16 /* isDetaching */;\n        this.lifecycle.afterDetach.begin();\n        if (this.hooks.hasBeforeDetach) {\n            this.bindingContext.beforeDetach(flags);\n        }\n        if (this.hooks.hasAfterDetach) {\n            this.lifecycle.afterDetach.add(this);\n        }\n        this.state = (this.state | 48 /* isAttachedOrDetaching */) ^ 48 /* isAttachedOrDetaching */;\n        this.lifecycle.afterDetach.end(flags);\n    }\n    detachSynthetic(flags) {\n        flags |= 32768 /* fromDetach */;\n        this.state |= 16 /* isDetaching */;\n        this.lifecycle.afterDetach.begin();\n        this.lifecycle.unmount.add(this);\n        this.detachControllers(flags);\n        this.state = (this.state | 48 /* isAttachedOrDetaching */) ^ 48 /* isAttachedOrDetaching */;\n        this.lifecycle.afterDetach.end(flags);\n    }\n    attachControllers(flags) {\n        const { controllers } = this;\n        if (controllers !== void 0) {\n            const { length } = controllers;\n            for (let i = 0; i < length; ++i) {\n                controllers[i].attach(flags);\n            }\n        }\n    }\n    detachControllers(flags) {\n        const { controllers } = this;\n        if (controllers !== void 0) {\n            for (let i = controllers.length - 1; i >= 0; --i) {\n                controllers[i].detach(flags);\n            }\n        }\n    }\n    // #endregion\n    // #region mount/unmount/cache\n    mountCustomElement(flags) {\n        if ((this.state & 64 /* isMounted */) > 0) {\n            return;\n        }\n        this.state |= 64 /* isMounted */;\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        this.projector.project(this.nodes); // non-null is implied by the hook\n    }\n    mountSynthetic(flags) {\n        const nodes = this.nodes; // non null is implied by the hook\n        const location = this.location; // non null is implied by the hook\n        this.state |= 64 /* isMounted */;\n        switch (this.mountStrategy) {\n            case 2 /* append */:\n                nodes.appendTo(location);\n                break;\n            default:\n                nodes.insertBefore(location);\n        }\n    }\n    unmountCustomElement(flags) {\n        if ((this.state & 64 /* isMounted */) === 0) {\n            return;\n        }\n        this.state = (this.state | 64 /* isMounted */) ^ 64 /* isMounted */;\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        this.projector.take(this.nodes); // non-null is implied by the hook\n    }\n    unmountSynthetic(flags) {\n        if ((this.state & 64 /* isMounted */) === 0) {\n            return false;\n        }\n        this.state = (this.state | 64 /* isMounted */) ^ 64 /* isMounted */;\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        this.nodes.remove(); // non-null is implied by the hook\n        this.nodes.unlink();\n        if ((this.state & 512 /* canBeCached */) > 0) {\n            this.state = (this.state | 512 /* canBeCached */) ^ 512 /* canBeCached */;\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            if (this.viewFactory.tryReturnToCache(this)) { // non-null is implied by the hook\n                return true;\n            }\n        }\n        return false;\n    }\n    cacheCustomElement(flags) {\n        flags |= 65536 /* fromCache */;\n        if (this.hooks.hasCaching) {\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            this.bindingContext.caching(flags); // non-null is implied by the hook\n        }\n    }\n    cacheCustomAttribute(flags) {\n        flags |= 65536 /* fromCache */;\n        if (this.hooks.hasCaching) {\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            this.bindingContext.caching(flags); // non-null is implied by the hook\n        }\n        const { controllers } = this;\n        if (controllers !== void 0) {\n            const { length } = controllers;\n            for (let i = length - 1; i >= 0; --i) {\n                controllers[i].cache(flags);\n            }\n        }\n    }\n    cacheSynthetic(flags) {\n        const { controllers } = this;\n        if (controllers !== void 0) {\n            const { length } = controllers;\n            for (let i = length - 1; i >= 0; --i) {\n                controllers[i].cache(flags);\n            }\n        }\n    }\n}\nfunction getBindingContext(flags, instance) {\n    if (instance.noProxy === true || (flags & 2 /* proxyStrategy */) === 0) {\n        return instance;\n    }\n    return ProxyObserver.getOrCreate(instance).proxy;\n}\nfunction getLookup(instance) {\n    let lookup = instance.$observers;\n    if (lookup === void 0) {\n        Reflect.defineProperty(instance, '$observers', {\n            enumerable: false,\n            value: lookup = {},\n        });\n    }\n    return lookup;\n}\nfunction createObservers(lifecycle, definition, flags, instance) {\n    const bindables = definition.bindables;\n    const observableNames = Object.getOwnPropertyNames(bindables);\n    const length = observableNames.length;\n    if (length > 0) {\n        let name;\n        let bindable;\n        if ((flags & 2 /* proxyStrategy */) > 0) {\n            for (let i = 0; i < length; ++i) {\n                name = observableNames[i];\n                bindable = bindables[name];\n                new BindableObserver(lifecycle, flags, ProxyObserver.getOrCreate(instance).proxy, name, bindable.callback, bindable.set);\n            }\n        }\n        else {\n            const observers = getLookup(instance);\n            for (let i = 0; i < length; ++i) {\n                name = observableNames[i];\n                if (observers[name] === void 0) {\n                    bindable = bindables[name];\n                    observers[name] = new BindableObserver(lifecycle, flags, instance, name, bindable.callback, bindable.set);\n                }\n            }\n        }\n    }\n}\nfunction createChildrenObservers(controller, definition, flags, instance) {\n    const childrenObservers = definition.childrenObservers;\n    const childObserverNames = Object.getOwnPropertyNames(childrenObservers);\n    const length = childObserverNames.length;\n    if (length > 0) {\n        const observers = getLookup(instance);\n        let name;\n        for (let i = 0; i < length; ++i) {\n            name = childObserverNames[i];\n            if (observers[name] == void 0) {\n                const childrenDescription = childrenObservers[name];\n                observers[name] = new ChildrenObserver(controller, instance, flags, name, childrenDescription.callback, childrenDescription.query, childrenDescription.filter, childrenDescription.map, childrenDescription.options);\n            }\n        }\n    }\n}\n//# sourceMappingURL=controller.js.map","import { DI, Registration, Metadata, Protocol } from '@aurelia/kernel';\nimport { Scope } from '../observation/binding-context';\nimport { CustomElement, CustomElementDefinition } from '../resources/custom-element';\nimport { Controller } from './controller';\nimport { mergeParts } from '../definitions';\nimport { getRenderContext } from './render-context';\nexport class ViewFactory {\n    constructor(name, context, lifecycle, parts) {\n        this.name = name;\n        this.context = context;\n        this.lifecycle = lifecycle;\n        this.parts = parts;\n        this.isCaching = false;\n        this.cache = null;\n        this.cacheSize = -1;\n    }\n    setCacheSize(size, doNotOverrideIfAlreadySet) {\n        if (size) {\n            if (size === '*') {\n                size = ViewFactory.maxCacheSize;\n            }\n            else if (typeof size === 'string') {\n                size = parseInt(size, 10);\n            }\n            if (this.cacheSize === -1 || !doNotOverrideIfAlreadySet) {\n                this.cacheSize = size;\n            }\n        }\n        if (this.cacheSize > 0) {\n            this.cache = [];\n        }\n        else {\n            this.cache = null;\n        }\n        this.isCaching = this.cacheSize > 0;\n    }\n    canReturnToCache(controller) {\n        return this.cache != null && this.cache.length < this.cacheSize;\n    }\n    tryReturnToCache(controller) {\n        if (this.canReturnToCache(controller)) {\n            controller.cache(0 /* none */);\n            this.cache.push(controller);\n            return true;\n        }\n        return false;\n    }\n    create(flags) {\n        const cache = this.cache;\n        let controller;\n        if (cache != null && cache.length > 0) {\n            controller = cache.pop();\n            return controller;\n        }\n        controller = Controller.forSyntheticView(this, this.lifecycle, this.context, flags);\n        return controller;\n    }\n    resolve(requestor, parts) {\n        parts = mergeParts(this.parts, parts);\n        if (parts === void 0) {\n            return this;\n        }\n        const part = parts[this.name];\n        if (part === void 0) {\n            return this;\n        }\n        return getRenderContext(part, requestor, parts).getViewFactory(this.name);\n    }\n}\nViewFactory.maxCacheSize = 0xFFFF;\nconst seenViews = new WeakSet();\nfunction notYetSeen($view) {\n    return !seenViews.has($view);\n}\nfunction toCustomElementDefinition($view) {\n    seenViews.add($view);\n    return CustomElementDefinition.create($view);\n}\nexport const Views = {\n    name: Protocol.resource.keyFor('views'),\n    has(value) {\n        return typeof value === 'function' && (Metadata.hasOwn(Views.name, value) || '$views' in value);\n    },\n    get(value) {\n        if (typeof value === 'function' && '$views' in value) {\n            // TODO: a `get` operation with side effects is not a good thing. Should refactor this to a proper resource kind.\n            const $views = value.$views;\n            const definitions = $views.filter(notYetSeen).map(toCustomElementDefinition);\n            for (const def of definitions) {\n                Views.add(value, def);\n            }\n        }\n        let views = Metadata.getOwn(Views.name, value);\n        if (views === void 0) {\n            Metadata.define(Views.name, views = [], value);\n        }\n        return views;\n    },\n    add(Type, partialDefinition) {\n        const definition = CustomElementDefinition.create(partialDefinition);\n        let views = Metadata.getOwn(Views.name, Type);\n        if (views === void 0) {\n            Metadata.define(Views.name, views = [definition], Type);\n        }\n        else {\n            views.push(definition);\n        }\n        return views;\n    },\n};\nexport function view(v) {\n    return function (target) {\n        Views.add(target, v);\n    };\n}\nexport const IViewLocator = DI.createInterface('IViewLocator')\n    .noDefault();\nexport class ViewLocator {\n    constructor() {\n        this.modelInstanceToBoundComponent = new WeakMap();\n        this.modelTypeToUnboundComponent = new Map();\n    }\n    static register(container) {\n        return Registration.singleton(IViewLocator, this).register(container);\n    }\n    getViewComponentForObject(object, viewNameOrSelector) {\n        if (object) {\n            const availableViews = Views.has(object.constructor) ? Views.get(object.constructor) : [];\n            const resolvedViewName = typeof viewNameOrSelector === 'function'\n                ? viewNameOrSelector(object, availableViews)\n                : this.getViewName(availableViews, viewNameOrSelector);\n            return this.getOrCreateBoundComponent(object, availableViews, resolvedViewName);\n        }\n        return null;\n    }\n    getOrCreateBoundComponent(object, availableViews, resolvedViewName) {\n        let lookup = this.modelInstanceToBoundComponent.get(object);\n        let BoundComponent;\n        if (lookup === void 0) {\n            lookup = {};\n            this.modelInstanceToBoundComponent.set(object, lookup);\n        }\n        else {\n            BoundComponent = lookup[resolvedViewName];\n        }\n        if (BoundComponent === void 0) {\n            const UnboundComponent = this.getOrCreateUnboundComponent(object, availableViews, resolvedViewName);\n            BoundComponent = CustomElement.define(CustomElement.getDefinition(UnboundComponent), class extends UnboundComponent {\n                constructor() {\n                    super(object);\n                }\n            });\n            lookup[resolvedViewName] = BoundComponent;\n        }\n        return BoundComponent;\n    }\n    getOrCreateUnboundComponent(object, availableViews, resolvedViewName) {\n        let lookup = this.modelTypeToUnboundComponent.get(object.constructor);\n        let UnboundComponent;\n        if (lookup === void 0) {\n            lookup = {};\n            this.modelTypeToUnboundComponent.set(object.constructor, lookup);\n        }\n        else {\n            UnboundComponent = lookup[resolvedViewName];\n        }\n        if (UnboundComponent === void 0) {\n            UnboundComponent = CustomElement.define(this.getView(availableViews, resolvedViewName), class {\n                constructor(viewModel) {\n                    this.viewModel = viewModel;\n                }\n                create(controller, parentContainer, definition, parts) {\n                    const vm = this.viewModel;\n                    controller.scope = Scope.fromParent(controller.flags, controller.scope, vm);\n                    if (vm.create !== void 0) {\n                        return vm.create(controller, parentContainer, definition, parts);\n                    }\n                }\n            });\n            const proto = UnboundComponent.prototype;\n            if ('beforeCompile' in object) {\n                proto.beforeCompile = function beforeCompile(controller) {\n                    this.viewModel.beforeCompile(controller);\n                };\n            }\n            if ('afterCompile' in object) {\n                proto.afterCompile = function afterCompile(controller) {\n                    this.viewModel.afterCompile(controller);\n                };\n            }\n            if ('afterCompileChildren' in object) {\n                proto.afterCompileChildren = function afterCompileChildren(controller) {\n                    this.viewModel.afterCompileChildren(controller);\n                };\n            }\n            if ('beforeBind' in object) {\n                proto.beforeBind = function beforeBind(flags) {\n                    return this.viewModel.beforeBind(flags);\n                };\n            }\n            if ('afterBind' in object) {\n                proto.afterBind = function afterBind(flags) {\n                    this.viewModel.afterBind(flags);\n                };\n            }\n            if ('beforeUnbind' in object) {\n                proto.beforeUnbind = function beforeUnbind(flags) {\n                    return this.viewModel.beforeUnbind(flags);\n                };\n            }\n            if ('afterUnbind' in object) {\n                proto.afterUnbind = function afterUnbind(flags) {\n                    this.viewModel.afterUnbind(flags);\n                };\n            }\n            if ('beforeAttach' in object) {\n                proto.beforeAttach = function beforeAttach(flags) {\n                    this.viewModel.beforeAttach(flags);\n                };\n            }\n            if ('afterAttach' in object) {\n                proto.afterAttach = function afterAttach(flags) {\n                    this.viewModel.afterAttach(flags);\n                };\n            }\n            if ('beforeDetach' in object) {\n                proto.beforeDetach = function beforeDetach(flags) {\n                    this.viewModel.beforeDetach(flags);\n                };\n            }\n            if ('afterDetach' in object) {\n                proto.afterDetach = function afterDetach(flags) {\n                    this.viewModel.afterDetach(flags);\n                };\n            }\n            if ('caching' in object) {\n                proto.caching = function caching(flags) {\n                    this.viewModel.caching(flags);\n                };\n            }\n            lookup[resolvedViewName] = UnboundComponent;\n        }\n        return UnboundComponent;\n    }\n    getViewName(views, requestedName) {\n        if (requestedName) {\n            return requestedName;\n        }\n        if (views.length === 1) {\n            return views[0].name;\n        }\n        return 'default-view';\n    }\n    getView(views, name) {\n        const v = views.find(x => x.name === name);\n        if (v === void 0) {\n            // TODO: Use Reporter\n            throw new Error(`Could not find view: ${name}`);\n        }\n        return v;\n    }\n}\n//# sourceMappingURL=view.js.map","import { __decorate, __metadata, __param } from \"tslib\";\nimport { IViewLocator } from '../../templating/view';\nimport { valueConverter } from '../value-converter';\nlet ViewValueConverter = class ViewValueConverter {\n    constructor(viewLocator) {\n        this.viewLocator = viewLocator;\n    }\n    toView(object, viewNameOrSelector) {\n        return this.viewLocator.getViewComponentForObject(object, viewNameOrSelector);\n    }\n};\nViewValueConverter = __decorate([\n    valueConverter('view'),\n    __param(0, IViewLocator),\n    __metadata(\"design:paramtypes\", [Object])\n], ViewValueConverter);\nexport { ViewValueConverter };\n//# sourceMappingURL=view.js.map","import { DI, Registration, } from '@aurelia/kernel';\nimport { ILifecycle } from './lifecycle';\nimport { ContinuationTask, IStartTaskManager, } from './lifecycle-task';\nimport { Controller } from './templating/controller';\nexport const IActivator = DI.createInterface('IActivator').withDefault(x => x.singleton(Activator));\n/** @internal */\nexport class Activator {\n    constructor(taskManager) {\n        this.taskManager = taskManager;\n    }\n    static register(container) {\n        return Registration.singleton(IActivator, this).register(container);\n    }\n    activate(host, component, container, flags = 1024 /* fromStartTask */, parentScope) {\n        flags = flags === void 0 ? 0 /* none */ : flags;\n        const mgr = this.taskManager;\n        let task = mgr.runBeforeRender();\n        if (task.done) {\n            this.render(host, component, container, flags);\n        }\n        else {\n            task = new ContinuationTask(task, this.render, this, host, component, container, flags);\n        }\n        if (task.done) {\n            task = mgr.runBeforeBind();\n        }\n        else {\n            task = new ContinuationTask(task, mgr.runBeforeBind, mgr);\n        }\n        if (task.done) {\n            task = this.bind(component, flags, parentScope);\n        }\n        else {\n            task = new ContinuationTask(task, this.bind, this, component, flags, parentScope);\n        }\n        if (task.done) {\n            task = mgr.runBeforeAttach();\n        }\n        else {\n            task = new ContinuationTask(task, mgr.runBeforeAttach, mgr);\n        }\n        if (task.done) {\n            this.attach(component, flags);\n        }\n        else {\n            task = new ContinuationTask(task, this.attach, this, component, flags);\n        }\n        return task;\n    }\n    deactivate(component, flags = 2048 /* fromStopTask */) {\n        const controller = Controller.getCachedOrThrow(component);\n        controller.detach(flags | 32768 /* fromDetach */);\n        return controller.unbind(flags | 8192 /* fromUnbind */);\n    }\n    render(host, component, container, flags) {\n        const lifecycle = container.get(ILifecycle);\n        Controller.forCustomElement(component, lifecycle, host, container, void 0, flags);\n    }\n    bind(component, flags, parentScope) {\n        return Controller.getCachedOrThrow(component).bind(flags | 4096 /* fromBind */, parentScope);\n    }\n    attach(component, flags) {\n        Controller.getCachedOrThrow(component).attach(flags | 16384 /* fromAttach */);\n    }\n}\nActivator.inject = [IStartTaskManager];\n//# sourceMappingURL=activator.js.map","import { DI, PLATFORM, Registration } from '@aurelia/kernel';\nimport { IActivator } from './activator';\nimport { INode } from './dom';\nimport { ILifecycle, } from './lifecycle';\nimport { ContinuationTask, IStartTaskManager, LifecycleTask, } from './lifecycle-task';\nimport { CustomElement } from './resources/custom-element';\nimport { Controller } from './templating/controller';\nexport class CompositionRoot {\n    constructor(config, container) {\n        this.config = config;\n        if (config.host != void 0) {\n            if (container.has(INode, false)) {\n                this.container = container.createChild();\n            }\n            else {\n                this.container = container;\n            }\n            Registration.instance(INode, config.host).register(this.container);\n            this.host = config.host;\n        }\n        else if (container.has(INode, true)) {\n            this.container = container;\n            this.host = container.get(INode);\n        }\n        else {\n            throw new Error(`No host element found.`);\n        }\n        this.strategy = config.strategy != void 0 ? config.strategy : 1 /* getterSetter */;\n        const initializer = this.container.get(IDOMInitializer);\n        this.dom = initializer.initialize(config);\n        this.lifecycle = this.container.get(ILifecycle);\n        this.activator = this.container.get(IActivator);\n        const taskManager = this.container.get(IStartTaskManager);\n        const beforeCreateTask = taskManager.runBeforeCreate();\n        if (beforeCreateTask.done) {\n            this.task = LifecycleTask.done;\n            this.create();\n        }\n        else {\n            this.task = new ContinuationTask(beforeCreateTask, this.create, this);\n        }\n    }\n    activate(antecedent) {\n        const { task, host, viewModel, container, activator, strategy } = this;\n        const flags = strategy | 1024 /* fromStartTask */;\n        if (viewModel === void 0) {\n            if (this.createTask === void 0) {\n                this.createTask = new ContinuationTask(task, this.activate, this, antecedent);\n            }\n            return this.createTask;\n        }\n        if (task.done) {\n            if (antecedent == void 0 || antecedent.done) {\n                this.task = activator.activate(host, viewModel, container, flags, void 0);\n            }\n            else {\n                this.task = new ContinuationTask(antecedent, activator.activate, activator, host, viewModel, container, flags, void 0);\n            }\n        }\n        else {\n            if (antecedent == void 0 || antecedent.done) {\n                this.task = new ContinuationTask(task, activator.activate, activator, host, viewModel, container, flags, void 0);\n            }\n            else {\n                const combinedAntecedent = new ContinuationTask(task, antecedent.wait, antecedent);\n                this.task = new ContinuationTask(combinedAntecedent, activator.activate, activator, host, viewModel, container, flags, void 0);\n            }\n        }\n        return this.task;\n    }\n    deactivate(antecedent) {\n        const { task, viewModel, activator, strategy } = this;\n        const flags = strategy | 2048 /* fromStopTask */;\n        if (viewModel === void 0) {\n            if (this.createTask === void 0) {\n                this.createTask = new ContinuationTask(task, this.deactivate, this, antecedent);\n            }\n            return this.createTask;\n        }\n        if (task.done) {\n            if (antecedent == void 0 || antecedent.done) {\n                this.task = activator.deactivate(viewModel, flags);\n            }\n            else {\n                this.task = new ContinuationTask(antecedent, activator.deactivate, activator, viewModel, flags);\n            }\n        }\n        else {\n            if (antecedent == void 0 || antecedent.done) {\n                this.task = new ContinuationTask(task, activator.deactivate, activator, viewModel, flags);\n            }\n            else {\n                const combinedAntecedent = new ContinuationTask(task, antecedent.wait, antecedent);\n                this.task = new ContinuationTask(combinedAntecedent, activator.deactivate, activator, viewModel, flags);\n            }\n        }\n        return this.task;\n    }\n    create() {\n        const config = this.config;\n        const instance = this.viewModel = CustomElement.isType(config.component)\n            ? this.container.get(config.component)\n            : config.component;\n        const container = this.container;\n        const lifecycle = container.get(ILifecycle);\n        this.controller = Controller.forCustomElement(instance, lifecycle, this.host, container, void 0, this.strategy);\n    }\n}\nexport class Aurelia {\n    constructor(container = DI.createContainer()) {\n        this.container = container;\n        this.task = LifecycleTask.done;\n        this._isRunning = false;\n        this._isStarting = false;\n        this._isStopping = false;\n        this._root = void 0;\n        this.next = (void 0);\n        Registration.instance(Aurelia, this).register(container);\n    }\n    get isRunning() {\n        return this._isRunning;\n    }\n    get isStarting() {\n        return this._isStarting;\n    }\n    get isStopping() {\n        return this._isStopping;\n    }\n    get root() {\n        if (this._root == void 0) {\n            if (this.next == void 0) {\n                throw new Error(`root is not defined`); // TODO: create error code\n            }\n            return this.next;\n        }\n        return this._root;\n    }\n    register(...params) {\n        this.container.register(...params);\n        return this;\n    }\n    app(config) {\n        this.next = new CompositionRoot(config, this.container);\n        if (this.isRunning) {\n            this.start();\n        }\n        return this;\n    }\n    start(root = this.next) {\n        if (root == void 0) {\n            throw new Error(`There is no composition root`); // TODO: create error code\n        }\n        this.stop(root);\n        if (this.task.done) {\n            this.onBeforeStart(root);\n        }\n        else {\n            this.task = new ContinuationTask(this.task, this.onBeforeStart, this, root);\n        }\n        this.task = this.root.activate(this.task);\n        if (this.task.done) {\n            this.task = this.onAfterStart(root);\n        }\n        else {\n            this.task = new ContinuationTask(this.task, this.onAfterStart, this, root);\n        }\n        return this.task;\n    }\n    stop(root = this._root) {\n        if (this._isRunning && root != void 0) {\n            if (this.task.done) {\n                this.onBeforeStop(root);\n            }\n            else {\n                this.task = new ContinuationTask(this.task, this.onBeforeStop, this, root);\n            }\n            this.task = root.deactivate(this.task);\n            if (this.task.done) {\n                this.task = this.onAfterStop(root);\n            }\n            else {\n                this.task = new ContinuationTask(this.task, this.onAfterStop, this, root);\n            }\n        }\n        return this.task;\n    }\n    wait() {\n        return this.task.wait();\n    }\n    onBeforeStart(root) {\n        Reflect.set(root.host, '$aurelia', this);\n        this._root = root;\n        this._isStarting = true;\n    }\n    onAfterStart(root) {\n        this._isRunning = true;\n        this._isStarting = false;\n        this.dispatchEvent(root, 'aurelia-composed', root.dom);\n        this.dispatchEvent(root, 'au-started', root.host);\n        return LifecycleTask.done;\n    }\n    onBeforeStop(root) {\n        this._isRunning = false;\n        this._isStopping = true;\n    }\n    onAfterStop(root) {\n        Reflect.deleteProperty(root.host, '$aurelia');\n        this._root = void 0;\n        this._isStopping = false;\n        this.dispatchEvent(root, 'au-stopped', root.host);\n        return LifecycleTask.done;\n    }\n    dispatchEvent(root, name, target) {\n        target = 'dispatchEvent' in target ? target : root.dom;\n        target.dispatchEvent(root.dom.createCustomEvent(name, { detail: this, bubbles: true, cancelable: true }));\n    }\n}\nPLATFORM.global.Aurelia = Aurelia;\nexport const IDOMInitializer = DI.createInterface('IDOMInitializer').noDefault();\n//# sourceMappingURL=aurelia.js.map","import { DI } from '@aurelia/kernel';\nimport { Lifecycle } from './lifecycle';\nimport { StartTaskManager } from './lifecycle-task';\nimport { ObserverLocator } from './observation/observer-locator';\nimport { CallBindingRenderer, CustomAttributeRenderer, CustomElementRenderer, InterpolationBindingRenderer, IteratorBindingRenderer, LetElementRenderer, PropertyBindingRenderer, RefBindingRenderer, Renderer, SetPropertyRenderer, TemplateControllerRenderer } from './renderer';\nimport { FromViewBindingBehavior, OneTimeBindingBehavior, ToViewBindingBehavior, TwoWayBindingBehavior } from './resources/binding-behaviors/binding-mode';\nimport { DebounceBindingBehavior } from './resources/binding-behaviors/debounce';\nimport { SignalBindingBehavior } from './resources/binding-behaviors/signals';\nimport { ThrottleBindingBehavior } from './resources/binding-behaviors/throttle';\nimport { FrequentMutations, InfrequentMutations, ObserveShallow } from './resources/custom-attributes/flags';\nimport { Else, If } from './resources/custom-attributes/if';\nimport { Repeat } from './resources/custom-attributes/repeat';\nimport { Replaceable } from './resources/custom-attributes/replaceable';\nimport { With } from './resources/custom-attributes/with';\nimport { SanitizeValueConverter } from './resources/value-converters/sanitize';\nimport { ViewValueConverter } from './resources/value-converters/view';\nimport { ViewLocator } from './templating/view';\nimport { Clock } from './scheduler';\nexport const IObserverLocatorRegistration = ObserverLocator;\nexport const ILifecycleRegistration = Lifecycle;\nexport const IRendererRegistration = Renderer;\nexport const IStartTaskManagerRegistration = StartTaskManager;\nexport const IViewLocatorRegistration = ViewLocator;\nexport const IClockRegistration = Clock;\n/**\n * Default implementations for the following interfaces:\n * - `IObserverLocator`\n * - `ILifecycle`\n * - `IRenderer`\n * - `IStartTaskManager`\n * - `IViewLocator`\n * - `IClockRegistration`\n * - `ISchedulerRegistration`\n */\nexport const DefaultComponents = [\n    IObserverLocatorRegistration,\n    ILifecycleRegistration,\n    IRendererRegistration,\n    IStartTaskManagerRegistration,\n    IViewLocatorRegistration,\n    IClockRegistration,\n];\nexport const FrequentMutationsRegistration = FrequentMutations;\nexport const InfrequentMutationsRegistration = InfrequentMutations;\nexport const ObserveShallowRegistration = ObserveShallow;\nexport const IfRegistration = If;\nexport const ElseRegistration = Else;\nexport const RepeatRegistration = Repeat;\nexport const ReplaceableRegistration = Replaceable;\nexport const WithRegistration = With;\nexport const SanitizeValueConverterRegistration = SanitizeValueConverter;\nexport const ViewValueConverterRegistration = ViewValueConverter;\nexport const DebounceBindingBehaviorRegistration = DebounceBindingBehavior;\nexport const OneTimeBindingBehaviorRegistration = OneTimeBindingBehavior;\nexport const ToViewBindingBehaviorRegistration = ToViewBindingBehavior;\nexport const FromViewBindingBehaviorRegistration = FromViewBindingBehavior;\nexport const SignalBindingBehaviorRegistration = SignalBindingBehavior;\nexport const ThrottleBindingBehaviorRegistration = ThrottleBindingBehavior;\nexport const TwoWayBindingBehaviorRegistration = TwoWayBindingBehavior;\n/**\n * Default resources:\n * - Template controllers (`if`/`else`, `repeat`, `replaceable`, `with`)\n * - Value Converters (`sanitize`)\n * - Binding Behaviors (`oneTime`, `toView`, `fromView`, `twoWay`, `signal`, `debounce`, `throttle`)\n */\nexport const DefaultResources = [\n    FrequentMutationsRegistration,\n    InfrequentMutationsRegistration,\n    ObserveShallowRegistration,\n    IfRegistration,\n    ElseRegistration,\n    RepeatRegistration,\n    ReplaceableRegistration,\n    WithRegistration,\n    SanitizeValueConverterRegistration,\n    ViewValueConverterRegistration,\n    DebounceBindingBehaviorRegistration,\n    OneTimeBindingBehaviorRegistration,\n    ToViewBindingBehaviorRegistration,\n    FromViewBindingBehaviorRegistration,\n    SignalBindingBehaviorRegistration,\n    ThrottleBindingBehaviorRegistration,\n    TwoWayBindingBehaviorRegistration\n];\nexport const CallBindingRendererRegistration = CallBindingRenderer;\nexport const CustomAttributeRendererRegistration = CustomAttributeRenderer;\nexport const CustomElementRendererRegistration = CustomElementRenderer;\nexport const InterpolationBindingRendererRegistration = InterpolationBindingRenderer;\nexport const IteratorBindingRendererRegistration = IteratorBindingRenderer;\nexport const LetElementRendererRegistration = LetElementRenderer;\nexport const PropertyBindingRendererRegistration = PropertyBindingRenderer;\nexport const RefBindingRendererRegistration = RefBindingRenderer;\nexport const SetPropertyRendererRegistration = SetPropertyRenderer;\nexport const TemplateControllerRendererRegistration = TemplateControllerRenderer;\n/**\n * Default renderers for:\n * - PropertyBinding: `bind`, `one-time`, `to-view`, `from-view`, `two-way`\n * - IteratorBinding: `for`\n * - CallBinding: `call`\n * - RefBinding: `ref`\n * - InterpolationBinding: `${}`\n * - SetProperty\n * - `customElement` hydration\n * - `customAttribute` hydration\n * - `templateController` hydration\n * - `let` element hydration\n */\nexport const DefaultRenderers = [\n    PropertyBindingRendererRegistration,\n    IteratorBindingRendererRegistration,\n    CallBindingRendererRegistration,\n    RefBindingRendererRegistration,\n    InterpolationBindingRendererRegistration,\n    SetPropertyRendererRegistration,\n    CustomElementRendererRegistration,\n    CustomAttributeRendererRegistration,\n    TemplateControllerRendererRegistration,\n    LetElementRendererRegistration\n];\n/**\n * A DI configuration object containing environment/runtime-agnostic registrations:\n * - `DefaultComponents`\n * - `DefaultResources`\n * - `DefaultRenderers`\n */\nexport const RuntimeConfiguration = {\n    /**\n     * Apply this configuration to the provided container.\n     */\n    register(container) {\n        return container.register(...DefaultComponents, ...DefaultResources, ...DefaultRenderers);\n    },\n    /**\n     * Create a new container with this configuration applied to it.\n     */\n    createContainer() {\n        return this.register(DI.createContainer());\n    }\n};\n//# sourceMappingURL=configuration.js.map","import { BindingMode } from './flags';\nexport class InterpolationInstruction {\n    constructor(from, to) {\n        this.from = from;\n        this.to = to;\n        this.type = \"rf\" /* interpolation */;\n    }\n}\nexport class OneTimeBindingInstruction {\n    constructor(from, to) {\n        this.from = from;\n        this.to = to;\n        this.type = \"rg\" /* propertyBinding */;\n        this.mode = BindingMode.oneTime;\n        this.oneTime = true;\n    }\n}\nexport class ToViewBindingInstruction {\n    constructor(from, to) {\n        this.from = from;\n        this.to = to;\n        this.type = \"rg\" /* propertyBinding */;\n        this.mode = BindingMode.toView;\n        this.oneTime = false;\n    }\n}\nexport class FromViewBindingInstruction {\n    constructor(from, to) {\n        this.from = from;\n        this.to = to;\n        this.type = \"rg\" /* propertyBinding */;\n        this.mode = BindingMode.fromView;\n        this.oneTime = false;\n    }\n}\nexport class TwoWayBindingInstruction {\n    constructor(from, to) {\n        this.from = from;\n        this.to = to;\n        this.type = \"rg\" /* propertyBinding */;\n        this.mode = BindingMode.twoWay;\n        this.oneTime = false;\n    }\n}\nexport class IteratorBindingInstruction {\n    constructor(from, to) {\n        this.from = from;\n        this.to = to;\n        this.type = \"rk\" /* iteratorBinding */;\n    }\n}\nexport class CallBindingInstruction {\n    constructor(from, to) {\n        this.from = from;\n        this.to = to;\n        this.type = \"rh\" /* callBinding */;\n    }\n}\nexport class RefBindingInstruction {\n    constructor(from, to) {\n        this.from = from;\n        this.to = to;\n        this.type = \"rj\" /* refBinding */;\n        this.type = \"rj\" /* refBinding */;\n    }\n}\nexport class SetPropertyInstruction {\n    constructor(value, to) {\n        this.value = value;\n        this.to = to;\n        this.type = \"re\" /* setProperty */;\n    }\n}\nexport class HydrateElementInstruction {\n    constructor(res, instructions, parts) {\n        this.res = res;\n        this.instructions = instructions;\n        this.parts = parts;\n        this.type = \"ra\" /* hydrateElement */;\n    }\n}\nexport class HydrateAttributeInstruction {\n    constructor(res, instructions) {\n        this.res = res;\n        this.instructions = instructions;\n        this.type = \"rb\" /* hydrateAttribute */;\n    }\n}\nexport class HydrateTemplateController {\n    constructor(def, res, instructions, link, parts) {\n        this.def = def;\n        this.res = res;\n        this.instructions = instructions;\n        this.link = link;\n        this.parts = parts;\n        this.type = \"rc\" /* hydrateTemplateController */;\n    }\n}\nexport class LetElementInstruction {\n    constructor(instructions, toBindingContext) {\n        this.instructions = instructions;\n        this.toBindingContext = toBindingContext;\n        this.type = \"rd\" /* hydrateLetElement */;\n    }\n}\nexport class LetBindingInstruction {\n    constructor(from, to) {\n        this.from = from;\n        this.to = to;\n        this.type = \"ri\" /* letBinding */;\n    }\n}\n//# sourceMappingURL=instructions.js.map","export { CallFunctionExpression, connects, observes, callsFunction, hasAncestor, isAssignable, isLeftHandSide, isPrimary, isResource, hasBind, hasUnbind, isLiteral, arePureLiterals, isPureLiteral, CustomExpression, BindingBehaviorExpression, ValueConverterExpression, AssignExpression, ConditionalExpression, AccessThisExpression, AccessScopeExpression, AccessMemberExpression, AccessKeyedExpression, CallScopeExpression, CallMemberExpression, BinaryExpression, UnaryExpression, PrimitiveLiteralExpression, HtmlLiteralExpression, ArrayLiteralExpression, ObjectLiteralExpression, TemplateExpression, TaggedTemplateExpression, ArrayBindingPattern, ObjectBindingPattern, BindingIdentifier, ForOfStatement, Interpolation } from './binding/ast';\nexport { PropertyBinding } from './binding/property-binding';\nexport { CallBinding } from './binding/call-binding';\nexport { connectable } from './binding/connectable';\nexport { IExpressionParser, BindingType } from './binding/expression-parser';\nexport { MultiInterpolationBinding, InterpolationBinding } from './binding/interpolation-binding';\nexport { LetBinding } from './binding/let-binding';\nexport { RefBinding } from './binding/ref-binding';\nexport { ArrayObserver, ArrayIndexObserver, enableArrayObservation, disableArrayObservation, applyMutationsToIndices, synchronizeIndices, } from './observation/array-observer';\nexport { MapObserver, enableMapObservation, disableMapObservation } from './observation/map-observer';\nexport { SetObserver, enableSetObservation, disableSetObservation } from './observation/set-observer';\nexport { BindingContext, Scope, OverrideContext } from './observation/binding-context';\nexport { CollectionLengthObserver, } from './observation/collection-length-observer';\nexport { CollectionSizeObserver, } from './observation/collection-size-observer';\nexport { computed, createComputedObserver, CustomSetterObserver, GetterObserver } from './observation/computed-observer';\nexport { IDirtyChecker, DirtyCheckProperty, DirtyCheckSettings } from './observation/dirty-checker';\nexport { IObserverLocator, ITargetObserverLocator, ITargetAccessorLocator, getCollectionObserver, ObserverLocator } from './observation/observer-locator';\nexport { PrimitiveObserver } from './observation/primitive-observer';\nexport { PropertyAccessor } from './observation/property-accessor';\nexport { ProxyObserver } from './observation/proxy-observer';\nexport { BindableObserver } from './observation/bindable-observer';\nexport { SetterObserver } from './observation/setter-observer';\nexport { ISignaler } from './observation/signaler';\nexport { subscriberCollection, collectionSubscriberCollection, proxySubscriberCollection, } from './observation/subscriber-collection';\nexport { bindingBehavior, BindingBehavior, BindingBehaviorDefinition, } from './resources/binding-behavior';\nexport { BindingModeBehavior, OneTimeBindingBehavior, ToViewBindingBehavior, FromViewBindingBehavior, TwoWayBindingBehavior } from './resources/binding-behaviors/binding-mode';\nexport { DebounceBindingBehavior } from './resources/binding-behaviors/debounce';\nexport { SignalBindingBehavior } from './resources/binding-behaviors/signals';\nexport { ThrottleBindingBehavior } from './resources/binding-behaviors/throttle';\nexport { customAttribute, CustomAttribute, CustomAttributeDefinition, templateController, } from './resources/custom-attribute';\nexport { FrequentMutations, InfrequentMutations, ObserveShallow, } from './resources/custom-attributes/flags';\nexport { If, Else } from './resources/custom-attributes/if';\nexport { Repeat } from './resources/custom-attributes/repeat';\nexport { Replaceable } from './resources/custom-attributes/replaceable';\nexport { With } from './resources/custom-attributes/with';\nexport { containerless, customElement, CustomElement, CustomElementDefinition, IProjectorLocator, useShadowDOM } from './resources/custom-element';\nexport { ValueConverter, ValueConverterDefinition, valueConverter, } from './resources/value-converter';\nexport { ISanitizer, SanitizeValueConverter } from './resources/value-converters/sanitize';\nexport { ViewValueConverter } from './resources/value-converters/view';\nexport { Clock, IClock, IScheduler, Task, TaskAbortError, TaskQueue, TaskQueuePriority, } from './scheduler';\nexport { bindable, BindableDefinition, Bindable, } from './templating/bindable';\nexport { ChildrenDefinition, Children, children, ChildrenObserver, } from './templating/children';\n// These exports are temporary until we have a proper way to unit test them\nexport { Controller, } from './templating/controller';\nexport { ViewFactory, IViewLocator, ViewLocator, view, Views, } from './templating/view';\nexport { Aurelia, IDOMInitializer, CompositionRoot, } from './aurelia';\nexport { IfRegistration, ElseRegistration, RepeatRegistration, ReplaceableRegistration, WithRegistration, SanitizeValueConverterRegistration, DebounceBindingBehaviorRegistration, OneTimeBindingBehaviorRegistration, ToViewBindingBehaviorRegistration, FromViewBindingBehaviorRegistration, SignalBindingBehaviorRegistration, ThrottleBindingBehaviorRegistration, TwoWayBindingBehaviorRegistration, RefBindingRendererRegistration, CallBindingRendererRegistration, CustomAttributeRendererRegistration, CustomElementRendererRegistration, InterpolationBindingRendererRegistration, IteratorBindingRendererRegistration, LetElementRendererRegistration, PropertyBindingRendererRegistration, SetPropertyRendererRegistration, TemplateControllerRendererRegistration, DefaultResources, IObserverLocatorRegistration, ILifecycleRegistration, IRendererRegistration, RuntimeConfiguration } from './configuration';\nexport { HooksDefinition, isTargetedInstruction, ITargetedInstruction, TargetedInstructionType, alias, registerAliases } from './definitions';\nexport { DOM, INode, IRenderLocation, IDOM, NodeSequence } from './dom';\nexport { BindingMode, BindingStrategy, ExpressionKind, LifecycleFlags, State } from './flags';\nexport { CallBindingInstruction, FromViewBindingInstruction, HydrateAttributeInstruction, HydrateElementInstruction, HydrateTemplateController, InterpolationInstruction, IteratorBindingInstruction, LetBindingInstruction, LetElementInstruction, OneTimeBindingInstruction, RefBindingInstruction, SetPropertyInstruction, ToViewBindingInstruction, TwoWayBindingInstruction } from './instructions';\nexport { ViewModelKind, ILifecycle, IController, IViewFactory, MountStrategy, } from './lifecycle';\nexport { getRenderContext, isRenderContext, } from './templating/render-context';\nexport { AggregateContinuationTask, TerminalTask, AggregateTerminalTask, ContinuationTask, LifecycleTask, PromiseTask, TaskSlot, StartTask, IStartTask, IStartTaskManager, ProviderTask, } from './lifecycle-task';\nexport { CollectionKind, DelegationStrategy, isIndexMap, copyIndexMap, cloneIndexMap, createIndexMap, } from './observation';\nexport { applyBindingBehavior, IInstructionRenderer, IRenderer, ITemplateCompiler, instructionRenderer, ensureExpression, } from './renderer';\n//# sourceMappingURL=index.js.map","export class AttrSyntax {\n    constructor(rawName, rawValue, target, command) {\n        this.rawName = rawName;\n        this.rawValue = rawValue;\n        this.target = target;\n        this.command = command;\n    }\n}\n//# sourceMappingURL=ast.js.map","import { DI, Metadata, PLATFORM, Protocol, Registration, Reporter } from '@aurelia/kernel';\n/** @internal */\nexport class CharSpec {\n    constructor(chars, repeat, isSymbol, isInverted) {\n        this.chars = chars;\n        this.repeat = repeat;\n        this.isSymbol = isSymbol;\n        this.isInverted = isInverted;\n        if (isInverted) {\n            switch (chars.length) {\n                case 0:\n                    this.has = this.hasOfNoneInverse;\n                    break;\n                case 1:\n                    this.has = this.hasOfSingleInverse;\n                    break;\n                default:\n                    this.has = this.hasOfMultipleInverse;\n            }\n        }\n        else {\n            switch (chars.length) {\n                case 0:\n                    this.has = this.hasOfNone;\n                    break;\n                case 1:\n                    this.has = this.hasOfSingle;\n                    break;\n                default:\n                    this.has = this.hasOfMultiple;\n            }\n        }\n    }\n    equals(other) {\n        return this.chars === other.chars\n            && this.repeat === other.repeat\n            && this.isSymbol === other.isSymbol\n            && this.isInverted === other.isInverted;\n    }\n    hasOfMultiple(char) {\n        return this.chars.includes(char);\n    }\n    hasOfSingle(char) {\n        return this.chars === char;\n    }\n    hasOfNone(char) {\n        return false;\n    }\n    hasOfMultipleInverse(char) {\n        return !this.chars.includes(char);\n    }\n    hasOfSingleInverse(char) {\n        return this.chars !== char;\n    }\n    hasOfNoneInverse(char) {\n        return true;\n    }\n}\nexport class Interpretation {\n    constructor() {\n        this.parts = PLATFORM.emptyArray;\n        this._pattern = '';\n        this.currentRecord = {};\n        this.partsRecord = {};\n    }\n    get pattern() {\n        const value = this._pattern;\n        if (value === '') {\n            return null;\n        }\n        else {\n            return value;\n        }\n    }\n    set pattern(value) {\n        if (value == null) {\n            this._pattern = '';\n            this.parts = PLATFORM.emptyArray;\n        }\n        else {\n            this._pattern = value;\n            this.parts = this.partsRecord[value];\n        }\n    }\n    append(pattern, ch) {\n        const { currentRecord } = this;\n        if (currentRecord[pattern] === undefined) {\n            currentRecord[pattern] = ch;\n        }\n        else {\n            currentRecord[pattern] += ch;\n        }\n    }\n    next(pattern) {\n        const { currentRecord } = this;\n        if (currentRecord[pattern] !== undefined) {\n            const { partsRecord } = this;\n            if (partsRecord[pattern] === undefined) {\n                partsRecord[pattern] = [currentRecord[pattern]];\n            }\n            else {\n                partsRecord[pattern].push(currentRecord[pattern]);\n            }\n            currentRecord[pattern] = undefined;\n        }\n    }\n}\n/** @internal */\nexport class State {\n    constructor(charSpec, ...patterns) {\n        this.charSpec = charSpec;\n        this.nextStates = [];\n        this.types = null;\n        this.isEndpoint = false;\n        this.patterns = patterns;\n    }\n    get pattern() {\n        return this.isEndpoint ? this.patterns[0] : null;\n    }\n    findChild(charSpec) {\n        const nextStates = this.nextStates;\n        const len = nextStates.length;\n        let child = null;\n        for (let i = 0; i < len; ++i) {\n            child = nextStates[i];\n            if (charSpec.equals(child.charSpec)) {\n                return child;\n            }\n        }\n        return null;\n    }\n    append(charSpec, pattern) {\n        const { patterns } = this;\n        if (!patterns.includes(pattern)) {\n            patterns.push(pattern);\n        }\n        let state = this.findChild(charSpec);\n        if (state == null) {\n            state = new State(charSpec, pattern);\n            this.nextStates.push(state);\n            if (charSpec.repeat) {\n                state.nextStates.push(state);\n            }\n        }\n        return state;\n    }\n    findMatches(ch, interpretation) {\n        // TODO: reuse preallocated arrays\n        const results = [];\n        const nextStates = this.nextStates;\n        const len = nextStates.length;\n        let childLen = 0;\n        let child = null;\n        let i = 0;\n        let j = 0;\n        for (; i < len; ++i) {\n            child = nextStates[i];\n            if (child.charSpec.has(ch)) {\n                results.push(child);\n                childLen = child.patterns.length;\n                j = 0;\n                if (child.charSpec.isSymbol) {\n                    for (; j < childLen; ++j) {\n                        interpretation.next(child.patterns[j]);\n                    }\n                }\n                else {\n                    for (; j < childLen; ++j) {\n                        interpretation.append(child.patterns[j], ch);\n                    }\n                }\n            }\n        }\n        return results;\n    }\n}\n/** @internal */\nexport class StaticSegment {\n    constructor(text) {\n        this.text = text;\n        this.text = text;\n        const len = this.len = text.length;\n        const specs = this.specs = [];\n        for (let i = 0; i < len; ++i) {\n            specs.push(new CharSpec(text[i], false, false, false));\n        }\n    }\n    eachChar(callback) {\n        const { len, specs } = this;\n        for (let i = 0; i < len; ++i) {\n            callback(specs[i]);\n        }\n    }\n}\n/** @internal */\nexport class DynamicSegment {\n    constructor(symbols) {\n        this.text = 'PART';\n        this.spec = new CharSpec(symbols, true, false, true);\n    }\n    eachChar(callback) {\n        callback(this.spec);\n    }\n}\n/** @internal */\nexport class SymbolSegment {\n    constructor(text) {\n        this.text = text;\n        this.spec = new CharSpec(text, false, true, false);\n    }\n    eachChar(callback) {\n        callback(this.spec);\n    }\n}\n/** @internal */\nexport class SegmentTypes {\n    constructor() {\n        this.statics = 0;\n        this.dynamics = 0;\n        this.symbols = 0;\n    }\n}\nexport const ISyntaxInterpreter = DI.createInterface('ISyntaxInterpreter').withDefault(x => x.singleton(SyntaxInterpreter));\n/** @internal */\nexport class SyntaxInterpreter {\n    constructor() {\n        this.rootState = new State(null);\n        this.initialStates = [this.rootState];\n    }\n    add(defOrDefs) {\n        let i = 0;\n        if (Array.isArray(defOrDefs)) {\n            const ii = defOrDefs.length;\n            for (; i < ii; ++i) {\n                this.add(defOrDefs[i]);\n            }\n            return;\n        }\n        let currentState = this.rootState;\n        const def = defOrDefs;\n        const pattern = def.pattern;\n        const types = new SegmentTypes();\n        const segments = this.parse(def, types);\n        const len = segments.length;\n        const callback = (ch) => {\n            currentState = currentState.append(ch, pattern);\n        };\n        for (i = 0; i < len; ++i) {\n            segments[i].eachChar(callback);\n        }\n        currentState.types = types;\n        currentState.isEndpoint = true;\n    }\n    interpret(name) {\n        const interpretation = new Interpretation();\n        let states = this.initialStates;\n        const len = name.length;\n        for (let i = 0; i < len; ++i) {\n            states = this.getNextStates(states, name.charAt(i), interpretation);\n            if (states.length === 0) {\n                break;\n            }\n        }\n        states.sort((a, b) => {\n            if (a.isEndpoint) {\n                if (!b.isEndpoint) {\n                    return -1;\n                }\n            }\n            else if (b.isEndpoint) {\n                return 1;\n            }\n            else {\n                return 0;\n            }\n            const aTypes = a.types;\n            const bTypes = b.types;\n            if (aTypes.statics !== bTypes.statics) {\n                return bTypes.statics - aTypes.statics;\n            }\n            if (aTypes.dynamics !== bTypes.dynamics) {\n                return bTypes.dynamics - aTypes.dynamics;\n            }\n            if (aTypes.symbols !== bTypes.symbols) {\n                return bTypes.symbols - aTypes.symbols;\n            }\n            return 0;\n        });\n        if (states.length > 0) {\n            const state = states[0];\n            if (!state.charSpec.isSymbol) {\n                interpretation.next(state.pattern);\n            }\n            interpretation.pattern = state.pattern;\n        }\n        return interpretation;\n    }\n    getNextStates(states, ch, interpretation) {\n        // TODO: reuse preallocated arrays\n        const nextStates = [];\n        let state = null;\n        const len = states.length;\n        for (let i = 0; i < len; ++i) {\n            state = states[i];\n            nextStates.push(...state.findMatches(ch, interpretation));\n        }\n        return nextStates;\n    }\n    parse(def, types) {\n        const result = [];\n        const pattern = def.pattern;\n        const len = pattern.length;\n        let i = 0;\n        let start = 0;\n        let c = '';\n        while (i < len) {\n            c = pattern.charAt(i);\n            if (!def.symbols.includes(c)) {\n                if (i === start) {\n                    if (c === 'P' && pattern.slice(i, i + 4) === 'PART') {\n                        start = i = (i + 4);\n                        result.push(new DynamicSegment(def.symbols));\n                        ++types.dynamics;\n                    }\n                    else {\n                        ++i;\n                    }\n                }\n                else {\n                    ++i;\n                }\n            }\n            else if (i !== start) {\n                result.push(new StaticSegment(pattern.slice(start, i)));\n                ++types.statics;\n                start = i;\n            }\n            else {\n                result.push(new SymbolSegment(pattern.slice(start, i + 1)));\n                ++types.symbols;\n                start = ++i;\n            }\n        }\n        if (start !== i) {\n            result.push(new StaticSegment(pattern.slice(start, i)));\n            ++types.statics;\n        }\n        return result;\n    }\n}\nfunction validatePrototype(handler, patternDefs) {\n    for (const def of patternDefs) {\n        // note: we're intentionally not throwing here\n        if (!(def.pattern in handler)) {\n            Reporter.write(401, def.pattern); // TODO: organize error codes\n        }\n        else if (typeof handler[def.pattern] !== 'function') {\n            Reporter.write(402, def.pattern); // TODO: organize error codes\n        }\n    }\n}\nexport const IAttributePattern = DI.createInterface('IAttributePattern').noDefault();\nexport function attributePattern(...patternDefs) {\n    return function decorator(target) {\n        return AttributePattern.define(patternDefs, target);\n    };\n}\nexport class AttributePatternResourceDefinition {\n    constructor(Type) {\n        this.Type = Type;\n        this.name = (void 0);\n    }\n    register(container) {\n        Registration.singleton(IAttributePattern, this.Type).register(container);\n    }\n}\nexport const AttributePattern = Object.freeze({\n    name: Protocol.resource.keyFor('attribute-pattern'),\n    definitionAnnotationKey: 'attribute-pattern-definitions',\n    define(patternDefs, Type) {\n        validatePrototype(Type.prototype, patternDefs);\n        const definition = new AttributePatternResourceDefinition(Type);\n        const { name, definitionAnnotationKey } = AttributePattern;\n        Metadata.define(name, definition, Type);\n        Protocol.resource.appendTo(Type, name);\n        Protocol.annotation.set(Type, definitionAnnotationKey, patternDefs);\n        Protocol.annotation.appendTo(Type, definitionAnnotationKey);\n        return Type;\n    },\n    getPatternDefinitions(Type) {\n        return Protocol.annotation.get(Type, AttributePattern.definitionAnnotationKey);\n    }\n});\n//# sourceMappingURL=attribute-pattern.js.map","import { __decorate, __metadata, __param } from \"tslib\";\nimport { all, DI } from '@aurelia/kernel';\nimport { AttrSyntax } from './ast';\nimport { AttributePattern, IAttributePattern, ISyntaxInterpreter } from './attribute-pattern';\nexport const IAttributeParser = DI.createInterface('IAttributeParser').withDefault(x => x.singleton(AttributeParser));\n/** @internal */\nlet AttributeParser = class AttributeParser {\n    constructor(interpreter, attrPatterns) {\n        this.interpreter = interpreter;\n        this.cache = {};\n        this.interpreter = interpreter;\n        const patterns = this.patterns = {};\n        attrPatterns.forEach(attrPattern => {\n            const defs = AttributePattern.getPatternDefinitions(attrPattern.constructor);\n            interpreter.add(defs);\n            defs.forEach(def => {\n                patterns[def.pattern] = attrPattern;\n            });\n        });\n    }\n    parse(name, value) {\n        let interpretation = this.cache[name];\n        if (interpretation == null) {\n            interpretation = this.cache[name] = this.interpreter.interpret(name);\n        }\n        const pattern = interpretation.pattern;\n        if (pattern == null) {\n            return new AttrSyntax(name, value, name, null);\n        }\n        else {\n            return this.patterns[pattern][pattern](name, value, interpretation.parts);\n        }\n    }\n};\nAttributeParser = __decorate([\n    __param(0, ISyntaxInterpreter),\n    __param(1, all(IAttributePattern)),\n    __metadata(\"design:paramtypes\", [Object, Array])\n], AttributeParser);\nexport { AttributeParser };\n//# sourceMappingURL=attribute-parser.js.map","import { __decorate } from \"tslib\";\nimport { AttrSyntax } from './ast';\nimport { attributePattern } from './attribute-pattern';\nlet DotSeparatedAttributePattern = class DotSeparatedAttributePattern {\n    ['PART.PART'](rawName, rawValue, parts) {\n        return new AttrSyntax(rawName, rawValue, parts[0], parts[1]);\n    }\n    ['PART.PART.PART'](rawName, rawValue, parts) {\n        return new AttrSyntax(rawName, rawValue, parts[0], parts[2]);\n    }\n};\nDotSeparatedAttributePattern = __decorate([\n    attributePattern({ pattern: 'PART.PART', symbols: '.' }, { pattern: 'PART.PART.PART', symbols: '.' })\n], DotSeparatedAttributePattern);\nexport { DotSeparatedAttributePattern };\nlet RefAttributePattern = class RefAttributePattern {\n    ['ref'](rawName, rawValue, parts) {\n        return new AttrSyntax(rawName, rawValue, 'element', 'ref');\n    }\n    ['PART.ref'](rawName, rawValue, parts) {\n        return new AttrSyntax(rawName, rawValue, parts[0], 'ref');\n    }\n};\nRefAttributePattern = __decorate([\n    attributePattern({ pattern: 'ref', symbols: '' }, { pattern: 'PART.ref', symbols: '.' })\n], RefAttributePattern);\nexport { RefAttributePattern };\nlet ColonPrefixedBindAttributePattern = class ColonPrefixedBindAttributePattern {\n    [':PART'](rawName, rawValue, parts) {\n        return new AttrSyntax(rawName, rawValue, parts[0], 'bind');\n    }\n};\nColonPrefixedBindAttributePattern = __decorate([\n    attributePattern({ pattern: ':PART', symbols: ':' })\n], ColonPrefixedBindAttributePattern);\nexport { ColonPrefixedBindAttributePattern };\nlet AtPrefixedTriggerAttributePattern = class AtPrefixedTriggerAttributePattern {\n    ['@PART'](rawName, rawValue, parts) {\n        return new AttrSyntax(rawName, rawValue, parts[0], 'trigger');\n    }\n};\nAtPrefixedTriggerAttributePattern = __decorate([\n    attributePattern({ pattern: '@PART', symbols: '@' })\n], AtPrefixedTriggerAttributePattern);\nexport { AtPrefixedTriggerAttributePattern };\n//# sourceMappingURL=attribute-patterns.js.map","import { camelCase, Registration, mergeArrays, Protocol, firstDefined, Metadata } from '@aurelia/kernel';\nimport { registerAliases } from '@aurelia/runtime';\nexport function bindingCommand(nameOrDefinition) {\n    return function (target) {\n        return BindingCommand.define(nameOrDefinition, target);\n    };\n}\nexport class BindingCommandDefinition {\n    constructor(Type, name, aliases, key, type) {\n        this.Type = Type;\n        this.name = name;\n        this.aliases = aliases;\n        this.key = key;\n        this.type = type;\n    }\n    static create(nameOrDef, Type) {\n        let name;\n        let def;\n        if (typeof nameOrDef === 'string') {\n            name = nameOrDef;\n            def = { name };\n        }\n        else {\n            name = nameOrDef.name;\n            def = nameOrDef;\n        }\n        return new BindingCommandDefinition(Type, firstDefined(BindingCommand.getAnnotation(Type, 'name'), name), mergeArrays(BindingCommand.getAnnotation(Type, 'aliases'), def.aliases, Type.aliases), BindingCommand.keyFrom(name), firstDefined(BindingCommand.getAnnotation(Type, 'type'), def.type, Type.type, null));\n    }\n    register(container) {\n        const { Type, key, aliases } = this;\n        Registration.singleton(key, Type).register(container);\n        Registration.alias(key, Type).register(container);\n        registerAliases(aliases, BindingCommand, key, container);\n    }\n}\nexport const BindingCommand = {\n    name: Protocol.resource.keyFor('binding-command'),\n    keyFrom(name) {\n        return `${BindingCommand.name}:${name}`;\n    },\n    isType(value) {\n        return typeof value === 'function' && Metadata.hasOwn(BindingCommand.name, value);\n    },\n    define(nameOrDef, Type) {\n        const definition = BindingCommandDefinition.create(nameOrDef, Type);\n        Metadata.define(BindingCommand.name, definition, definition.Type);\n        Metadata.define(BindingCommand.name, definition, definition);\n        Protocol.resource.appendTo(Type, BindingCommand.name);\n        return definition.Type;\n    },\n    getDefinition(Type) {\n        const def = Metadata.getOwn(BindingCommand.name, Type);\n        if (def === void 0) {\n            throw new Error(`No definition found for type ${Type.name}`);\n        }\n        return def;\n    },\n    annotate(Type, prop, value) {\n        Metadata.define(Protocol.annotation.keyFor(prop), value, Type);\n    },\n    getAnnotation(Type, prop) {\n        return Metadata.getOwn(Protocol.annotation.keyFor(prop), Type);\n    },\n};\nexport function getTarget(binding, makeCamelCase) {\n    if (binding.flags & 256 /* isBinding */) {\n        return binding.bindable.propName;\n    }\n    else if (makeCamelCase) {\n        return camelCase(binding.syntax.target);\n    }\n    else {\n        return binding.syntax.target;\n    }\n}\n//# sourceMappingURL=binding-command.js.map","export var SymbolFlags;\n(function (SymbolFlags) {\n    SymbolFlags[SymbolFlags[\"type\"] = 511] = \"type\";\n    SymbolFlags[SymbolFlags[\"isTemplateController\"] = 1] = \"isTemplateController\";\n    SymbolFlags[SymbolFlags[\"isReplacePart\"] = 2] = \"isReplacePart\";\n    SymbolFlags[SymbolFlags[\"isCustomAttribute\"] = 4] = \"isCustomAttribute\";\n    SymbolFlags[SymbolFlags[\"isPlainAttribute\"] = 8] = \"isPlainAttribute\";\n    SymbolFlags[SymbolFlags[\"isCustomElement\"] = 16] = \"isCustomElement\";\n    SymbolFlags[SymbolFlags[\"isLetElement\"] = 32] = \"isLetElement\";\n    SymbolFlags[SymbolFlags[\"isPlainElement\"] = 64] = \"isPlainElement\";\n    SymbolFlags[SymbolFlags[\"isText\"] = 128] = \"isText\";\n    SymbolFlags[SymbolFlags[\"isBinding\"] = 256] = \"isBinding\";\n    SymbolFlags[SymbolFlags[\"hasMarker\"] = 512] = \"hasMarker\";\n    SymbolFlags[SymbolFlags[\"hasTemplate\"] = 1024] = \"hasTemplate\";\n    SymbolFlags[SymbolFlags[\"hasAttributes\"] = 2048] = \"hasAttributes\";\n    SymbolFlags[SymbolFlags[\"hasBindings\"] = 4096] = \"hasBindings\";\n    SymbolFlags[SymbolFlags[\"hasChildNodes\"] = 8192] = \"hasChildNodes\";\n    SymbolFlags[SymbolFlags[\"hasParts\"] = 16384] = \"hasParts\";\n})(SymbolFlags || (SymbolFlags = {}));\nfunction createMarker(dom) {\n    const marker = dom.createElement('au-m');\n    dom.makeTarget(marker);\n    return marker;\n}\n/**\n * A html attribute that is associated with a registered resource, specifically a template controller.\n */\nexport class TemplateControllerSymbol {\n    constructor(dom, syntax, info, partName, res = info.name) {\n        this.syntax = syntax;\n        this.info = info;\n        this.res = res;\n        this.flags = 1 /* isTemplateController */ | 512 /* hasMarker */;\n        this.physicalNode = null;\n        this.template = null;\n        this.templateController = null;\n        this._bindings = null;\n        this._parts = null;\n        this.partName = info.name === 'replaceable' ? partName : null;\n        this.marker = createMarker(dom);\n    }\n    get bindings() {\n        if (this._bindings === null) {\n            this._bindings = [];\n            this.flags |= 4096 /* hasBindings */;\n        }\n        return this._bindings;\n    }\n    get parts() {\n        if (this._parts === null) {\n            this._parts = [];\n            this.flags |= 16384 /* hasParts */;\n        }\n        return this._parts;\n    }\n}\n/**\n * Wrapper for an element (with all of its attributes, regardless of the order in which they are declared)\n * that has a replace attribute on it.\n *\n * This element will be lifted from the DOM just like a template controller.\n */\nexport class ReplacePartSymbol {\n    constructor(name, physicalNode = null, parent = null, template = null) {\n        this.name = name;\n        this.physicalNode = physicalNode;\n        this.parent = parent;\n        this.template = template;\n        this.flags = 2 /* isReplacePart */;\n    }\n}\n/**\n * A html attribute that is associated with a registered resource, but not a template controller.\n */\nexport class CustomAttributeSymbol {\n    constructor(syntax, info, res = info.name) {\n        this.syntax = syntax;\n        this.info = info;\n        this.res = res;\n        this.flags = 4 /* isCustomAttribute */;\n        this._bindings = null;\n    }\n    get bindings() {\n        if (this._bindings === null) {\n            this._bindings = [];\n            this.flags |= 4096 /* hasBindings */;\n        }\n        return this._bindings;\n    }\n}\n/**\n * An attribute, with either a binding command or an interpolation, whose target is the html\n * attribute of the element.\n *\n * This will never target a bindable property of a custom attribute or element;\n */\nexport class PlainAttributeSymbol {\n    constructor(syntax, command, expression) {\n        this.syntax = syntax;\n        this.command = command;\n        this.expression = expression;\n        this.flags = 8 /* isPlainAttribute */;\n    }\n}\n/**\n * Either an attribute on an custom element that maps to a declared bindable property of that element,\n * a single-value bound custom attribute, or one of several bindables that were extracted from the attribute\n * value of a custom attribute with multiple bindings usage.\n *\n * This will always target a bindable property of a custom attribute or element;\n */\nexport class BindingSymbol {\n    constructor(command, bindable, expression, rawValue, target) {\n        this.command = command;\n        this.bindable = bindable;\n        this.expression = expression;\n        this.rawValue = rawValue;\n        this.target = target;\n        this.flags = 256 /* isBinding */;\n    }\n}\n/**\n * A html element that is associated with a registered resource either via its (lowerCase) `nodeName`\n * or the value of its `as-element` attribute.\n */\nexport class CustomElementSymbol {\n    constructor(dom, physicalNode, info, res = info.name, bindables = info.bindables) {\n        this.physicalNode = physicalNode;\n        this.info = info;\n        this.res = res;\n        this.bindables = bindables;\n        this.flags = 16 /* isCustomElement */;\n        this.isTarget = true;\n        this.templateController = null;\n        this._customAttributes = null;\n        this._plainAttributes = null;\n        this._bindings = null;\n        this._childNodes = null;\n        this._parts = null;\n        if (info.containerless) {\n            this.isContainerless = true;\n            this.marker = createMarker(dom);\n            this.flags |= 512 /* hasMarker */;\n        }\n        else {\n            this.isContainerless = false;\n            this.marker = null;\n        }\n    }\n    get customAttributes() {\n        if (this._customAttributes === null) {\n            this._customAttributes = [];\n            this.flags |= 2048 /* hasAttributes */;\n        }\n        return this._customAttributes;\n    }\n    get plainAttributes() {\n        if (this._plainAttributes === null) {\n            this._plainAttributes = [];\n            this.flags |= 2048 /* hasAttributes */;\n        }\n        return this._plainAttributes;\n    }\n    get bindings() {\n        if (this._bindings === null) {\n            this._bindings = [];\n            this.flags |= 4096 /* hasBindings */;\n        }\n        return this._bindings;\n    }\n    get childNodes() {\n        if (this._childNodes === null) {\n            this._childNodes = [];\n            this.flags |= 8192 /* hasChildNodes */;\n        }\n        return this._childNodes;\n    }\n    get parts() {\n        if (this._parts === null) {\n            this._parts = [];\n            this.flags |= 16384 /* hasParts */;\n        }\n        return this._parts;\n    }\n}\nexport class LetElementSymbol {\n    constructor(dom, physicalNode, marker = createMarker(dom)) {\n        this.physicalNode = physicalNode;\n        this.marker = marker;\n        this.flags = 32 /* isLetElement */ | 512 /* hasMarker */;\n        this.toBindingContext = false;\n        this._bindings = null;\n    }\n    get bindings() {\n        if (this._bindings === null) {\n            this._bindings = [];\n            this.flags |= 4096 /* hasBindings */;\n        }\n        return this._bindings;\n    }\n}\n/**\n * A normal html element that may or may not have attribute behaviors and/or child node behaviors.\n *\n * It is possible for a PlainElementSymbol to not yield any instructions during compilation.\n */\nexport class PlainElementSymbol {\n    constructor(dom, physicalNode) {\n        this.physicalNode = physicalNode;\n        this.flags = 64 /* isPlainElement */;\n        this.isTarget = false;\n        this.templateController = null;\n        this.hasSlots = false;\n        this._customAttributes = null;\n        this._plainAttributes = null;\n        this._childNodes = null;\n    }\n    get customAttributes() {\n        if (this._customAttributes === null) {\n            this._customAttributes = [];\n            this.flags |= 2048 /* hasAttributes */;\n        }\n        return this._customAttributes;\n    }\n    get plainAttributes() {\n        if (this._plainAttributes === null) {\n            this._plainAttributes = [];\n            this.flags |= 2048 /* hasAttributes */;\n        }\n        return this._plainAttributes;\n    }\n    get childNodes() {\n        if (this._childNodes === null) {\n            this._childNodes = [];\n            this.flags |= 8192 /* hasChildNodes */;\n        }\n        return this._childNodes;\n    }\n}\n/**\n * A standalone text node that has an interpolation.\n */\nexport class TextSymbol {\n    constructor(dom, physicalNode, interpolation, marker = createMarker(dom)) {\n        this.physicalNode = physicalNode;\n        this.interpolation = interpolation;\n        this.marker = marker;\n        this.flags = 128 /* isText */ | 512 /* hasMarker */;\n    }\n}\n//# sourceMappingURL=semantic-model.js.map","import { __decorate } from \"tslib\";\nimport { BindingMode, CallBindingInstruction, FromViewBindingInstruction, IteratorBindingInstruction, OneTimeBindingInstruction, ToViewBindingInstruction, TwoWayBindingInstruction, } from '@aurelia/runtime';\nimport { bindingCommand, getTarget, } from './binding-command';\nimport { BindingSymbol, } from './semantic-model';\nlet OneTimeBindingCommand = class OneTimeBindingCommand {\n    constructor() {\n        this.bindingType = 49 /* OneTimeCommand */;\n    }\n    compile(binding) {\n        return new OneTimeBindingInstruction(binding.expression, getTarget(binding, false));\n    }\n};\nOneTimeBindingCommand = __decorate([\n    bindingCommand('one-time')\n], OneTimeBindingCommand);\nexport { OneTimeBindingCommand };\nlet ToViewBindingCommand = class ToViewBindingCommand {\n    constructor() {\n        this.bindingType = 50 /* ToViewCommand */;\n    }\n    compile(binding) {\n        return new ToViewBindingInstruction(binding.expression, getTarget(binding, false));\n    }\n};\nToViewBindingCommand = __decorate([\n    bindingCommand('to-view')\n], ToViewBindingCommand);\nexport { ToViewBindingCommand };\nlet FromViewBindingCommand = class FromViewBindingCommand {\n    constructor() {\n        this.bindingType = 51 /* FromViewCommand */;\n    }\n    compile(binding) {\n        return new FromViewBindingInstruction(binding.expression, getTarget(binding, false));\n    }\n};\nFromViewBindingCommand = __decorate([\n    bindingCommand('from-view')\n], FromViewBindingCommand);\nexport { FromViewBindingCommand };\nlet TwoWayBindingCommand = class TwoWayBindingCommand {\n    constructor() {\n        this.bindingType = 52 /* TwoWayCommand */;\n    }\n    compile(binding) {\n        return new TwoWayBindingInstruction(binding.expression, getTarget(binding, false));\n    }\n};\nTwoWayBindingCommand = __decorate([\n    bindingCommand('two-way')\n], TwoWayBindingCommand);\nexport { TwoWayBindingCommand };\nlet DefaultBindingCommand = class DefaultBindingCommand {\n    constructor() {\n        this.bindingType = 53 /* BindCommand */;\n    }\n    compile(binding) {\n        let mode = BindingMode.default;\n        if (binding instanceof BindingSymbol) {\n            mode = binding.bindable.mode;\n        }\n        else {\n            const command = binding.syntax.command;\n            switch (command) {\n                case 'bind':\n                case 'to-view':\n                    mode = BindingMode.toView;\n                    break;\n                case 'one-time':\n                    mode = BindingMode.oneTime;\n                    break;\n                case 'from-view':\n                    mode = BindingMode.fromView;\n                    break;\n                case 'two-way':\n                    mode = BindingMode.twoWay;\n                    break;\n            }\n        }\n        switch (mode) {\n            case BindingMode.default:\n            case BindingMode.toView:\n                return ToViewBindingCommand.prototype.compile(binding);\n            case BindingMode.oneTime:\n                return OneTimeBindingCommand.prototype.compile(binding);\n            case BindingMode.fromView:\n                return FromViewBindingCommand.prototype.compile(binding);\n            case BindingMode.twoWay:\n                return TwoWayBindingCommand.prototype.compile(binding);\n        }\n    }\n};\nDefaultBindingCommand = __decorate([\n    bindingCommand('bind')\n], DefaultBindingCommand);\nexport { DefaultBindingCommand };\nlet CallBindingCommand = class CallBindingCommand {\n    constructor() {\n        this.bindingType = 153 /* CallCommand */;\n    }\n    compile(binding) {\n        return new CallBindingInstruction(binding.expression, getTarget(binding, true));\n    }\n};\nCallBindingCommand = __decorate([\n    bindingCommand('call')\n], CallBindingCommand);\nexport { CallBindingCommand };\nlet ForBindingCommand = class ForBindingCommand {\n    constructor() {\n        this.bindingType = 539 /* ForCommand */;\n    }\n    compile(binding) {\n        return new IteratorBindingInstruction(binding.expression, getTarget(binding, false));\n    }\n};\nForBindingCommand = __decorate([\n    bindingCommand('for')\n], ForBindingCommand);\nexport { ForBindingCommand };\n//# sourceMappingURL=binding-commands.js.map","export function unescapeCode(code) {\n    switch (code) {\n        case 98 /* LowerB */: return 8 /* Backspace */;\n        case 116 /* LowerT */: return 9 /* Tab */;\n        case 110 /* LowerN */: return 10 /* LineFeed */;\n        case 118 /* LowerV */: return 11 /* VerticalTab */;\n        case 102 /* LowerF */: return 12 /* FormFeed */;\n        case 114 /* LowerR */: return 13 /* CarriageReturn */;\n        case 34 /* DoubleQuote */: return 34 /* DoubleQuote */;\n        case 39 /* SingleQuote */: return 39 /* SingleQuote */;\n        case 92 /* Backslash */: return 92 /* Backslash */;\n        default: return code;\n    }\n}\nexport var Access;\n(function (Access) {\n    Access[Access[\"Reset\"] = 0] = \"Reset\";\n    Access[Access[\"Ancestor\"] = 511] = \"Ancestor\";\n    Access[Access[\"This\"] = 512] = \"This\";\n    Access[Access[\"Scope\"] = 1024] = \"Scope\";\n    Access[Access[\"Member\"] = 2048] = \"Member\";\n    Access[Access[\"Keyed\"] = 4096] = \"Keyed\";\n})(Access || (Access = {}));\nexport var Precedence;\n(function (Precedence) {\n    Precedence[Precedence[\"Variadic\"] = 61] = \"Variadic\";\n    Precedence[Precedence[\"Assign\"] = 62] = \"Assign\";\n    Precedence[Precedence[\"Conditional\"] = 63] = \"Conditional\";\n    Precedence[Precedence[\"LogicalOR\"] = 64] = \"LogicalOR\";\n    Precedence[Precedence[\"LogicalAND\"] = 128] = \"LogicalAND\";\n    Precedence[Precedence[\"Equality\"] = 192] = \"Equality\";\n    Precedence[Precedence[\"Relational\"] = 256] = \"Relational\";\n    Precedence[Precedence[\"Additive\"] = 320] = \"Additive\";\n    Precedence[Precedence[\"Multiplicative\"] = 384] = \"Multiplicative\";\n    Precedence[Precedence[\"Binary\"] = 448] = \"Binary\";\n    Precedence[Precedence[\"LeftHandSide\"] = 449] = \"LeftHandSide\";\n    Precedence[Precedence[\"Primary\"] = 450] = \"Primary\";\n    Precedence[Precedence[\"Unary\"] = 451] = \"Unary\";\n})(Precedence || (Precedence = {}));\n/** @internal */\nexport var Token;\n(function (Token) {\n    Token[Token[\"EOF\"] = 1572864] = \"EOF\";\n    Token[Token[\"ExpressionTerminal\"] = 1048576] = \"ExpressionTerminal\";\n    Token[Token[\"AccessScopeTerminal\"] = 524288] = \"AccessScopeTerminal\";\n    Token[Token[\"ClosingToken\"] = 262144] = \"ClosingToken\";\n    Token[Token[\"OpeningToken\"] = 131072] = \"OpeningToken\";\n    Token[Token[\"BinaryOp\"] = 65536] = \"BinaryOp\";\n    Token[Token[\"UnaryOp\"] = 32768] = \"UnaryOp\";\n    Token[Token[\"LeftHandSide\"] = 16384] = \"LeftHandSide\";\n    Token[Token[\"StringOrNumericLiteral\"] = 12288] = \"StringOrNumericLiteral\";\n    Token[Token[\"NumericLiteral\"] = 8192] = \"NumericLiteral\";\n    Token[Token[\"StringLiteral\"] = 4096] = \"StringLiteral\";\n    Token[Token[\"IdentifierName\"] = 3072] = \"IdentifierName\";\n    Token[Token[\"Keyword\"] = 2048] = \"Keyword\";\n    Token[Token[\"Identifier\"] = 1024] = \"Identifier\";\n    Token[Token[\"Contextual\"] = 512] = \"Contextual\";\n    Token[Token[\"Precedence\"] = 448] = \"Precedence\";\n    Token[Token[\"Type\"] = 63] = \"Type\";\n    Token[Token[\"FalseKeyword\"] = 2048] = \"FalseKeyword\";\n    Token[Token[\"TrueKeyword\"] = 2049] = \"TrueKeyword\";\n    Token[Token[\"NullKeyword\"] = 2050] = \"NullKeyword\";\n    Token[Token[\"UndefinedKeyword\"] = 2051] = \"UndefinedKeyword\";\n    Token[Token[\"ThisScope\"] = 3076] = \"ThisScope\";\n    Token[Token[\"ParentScope\"] = 3077] = \"ParentScope\";\n    Token[Token[\"OpenParen\"] = 671750] = \"OpenParen\";\n    Token[Token[\"OpenBrace\"] = 131079] = \"OpenBrace\";\n    Token[Token[\"Dot\"] = 16392] = \"Dot\";\n    Token[Token[\"CloseBrace\"] = 1835017] = \"CloseBrace\";\n    Token[Token[\"CloseParen\"] = 1835018] = \"CloseParen\";\n    Token[Token[\"Comma\"] = 1572875] = \"Comma\";\n    Token[Token[\"OpenBracket\"] = 671756] = \"OpenBracket\";\n    Token[Token[\"CloseBracket\"] = 1835021] = \"CloseBracket\";\n    Token[Token[\"Colon\"] = 1572878] = \"Colon\";\n    Token[Token[\"Question\"] = 1572879] = \"Question\";\n    Token[Token[\"Ampersand\"] = 1572880] = \"Ampersand\";\n    Token[Token[\"Bar\"] = 1572883] = \"Bar\";\n    Token[Token[\"BarBar\"] = 1638548] = \"BarBar\";\n    Token[Token[\"AmpersandAmpersand\"] = 1638613] = \"AmpersandAmpersand\";\n    Token[Token[\"EqualsEquals\"] = 1638678] = \"EqualsEquals\";\n    Token[Token[\"ExclamationEquals\"] = 1638679] = \"ExclamationEquals\";\n    Token[Token[\"EqualsEqualsEquals\"] = 1638680] = \"EqualsEqualsEquals\";\n    Token[Token[\"ExclamationEqualsEquals\"] = 1638681] = \"ExclamationEqualsEquals\";\n    Token[Token[\"LessThan\"] = 1638746] = \"LessThan\";\n    Token[Token[\"GreaterThan\"] = 1638747] = \"GreaterThan\";\n    Token[Token[\"LessThanEquals\"] = 1638748] = \"LessThanEquals\";\n    Token[Token[\"GreaterThanEquals\"] = 1638749] = \"GreaterThanEquals\";\n    Token[Token[\"InKeyword\"] = 1640798] = \"InKeyword\";\n    Token[Token[\"InstanceOfKeyword\"] = 1640799] = \"InstanceOfKeyword\";\n    Token[Token[\"Plus\"] = 623008] = \"Plus\";\n    Token[Token[\"Minus\"] = 623009] = \"Minus\";\n    Token[Token[\"TypeofKeyword\"] = 34850] = \"TypeofKeyword\";\n    Token[Token[\"VoidKeyword\"] = 34851] = \"VoidKeyword\";\n    Token[Token[\"Asterisk\"] = 1638884] = \"Asterisk\";\n    Token[Token[\"Percent\"] = 1638885] = \"Percent\";\n    Token[Token[\"Slash\"] = 1638886] = \"Slash\";\n    Token[Token[\"Equals\"] = 1048615] = \"Equals\";\n    Token[Token[\"Exclamation\"] = 32808] = \"Exclamation\";\n    Token[Token[\"TemplateTail\"] = 540713] = \"TemplateTail\";\n    Token[Token[\"TemplateContinuation\"] = 540714] = \"TemplateContinuation\";\n    Token[Token[\"OfKeyword\"] = 1051179] = \"OfKeyword\";\n})(Token || (Token = {}));\nexport var Char;\n(function (Char) {\n    Char[Char[\"Null\"] = 0] = \"Null\";\n    Char[Char[\"Backspace\"] = 8] = \"Backspace\";\n    Char[Char[\"Tab\"] = 9] = \"Tab\";\n    Char[Char[\"LineFeed\"] = 10] = \"LineFeed\";\n    Char[Char[\"VerticalTab\"] = 11] = \"VerticalTab\";\n    Char[Char[\"FormFeed\"] = 12] = \"FormFeed\";\n    Char[Char[\"CarriageReturn\"] = 13] = \"CarriageReturn\";\n    Char[Char[\"Space\"] = 32] = \"Space\";\n    Char[Char[\"Exclamation\"] = 33] = \"Exclamation\";\n    Char[Char[\"DoubleQuote\"] = 34] = \"DoubleQuote\";\n    Char[Char[\"Dollar\"] = 36] = \"Dollar\";\n    Char[Char[\"Percent\"] = 37] = \"Percent\";\n    Char[Char[\"Ampersand\"] = 38] = \"Ampersand\";\n    Char[Char[\"SingleQuote\"] = 39] = \"SingleQuote\";\n    Char[Char[\"OpenParen\"] = 40] = \"OpenParen\";\n    Char[Char[\"CloseParen\"] = 41] = \"CloseParen\";\n    Char[Char[\"Asterisk\"] = 42] = \"Asterisk\";\n    Char[Char[\"Plus\"] = 43] = \"Plus\";\n    Char[Char[\"Comma\"] = 44] = \"Comma\";\n    Char[Char[\"Minus\"] = 45] = \"Minus\";\n    Char[Char[\"Dot\"] = 46] = \"Dot\";\n    Char[Char[\"Slash\"] = 47] = \"Slash\";\n    Char[Char[\"Semicolon\"] = 59] = \"Semicolon\";\n    Char[Char[\"Backtick\"] = 96] = \"Backtick\";\n    Char[Char[\"OpenBracket\"] = 91] = \"OpenBracket\";\n    Char[Char[\"Backslash\"] = 92] = \"Backslash\";\n    Char[Char[\"CloseBracket\"] = 93] = \"CloseBracket\";\n    Char[Char[\"Caret\"] = 94] = \"Caret\";\n    Char[Char[\"Underscore\"] = 95] = \"Underscore\";\n    Char[Char[\"OpenBrace\"] = 123] = \"OpenBrace\";\n    Char[Char[\"Bar\"] = 124] = \"Bar\";\n    Char[Char[\"CloseBrace\"] = 125] = \"CloseBrace\";\n    Char[Char[\"Colon\"] = 58] = \"Colon\";\n    Char[Char[\"LessThan\"] = 60] = \"LessThan\";\n    Char[Char[\"Equals\"] = 61] = \"Equals\";\n    Char[Char[\"GreaterThan\"] = 62] = \"GreaterThan\";\n    Char[Char[\"Question\"] = 63] = \"Question\";\n    Char[Char[\"Zero\"] = 48] = \"Zero\";\n    Char[Char[\"One\"] = 49] = \"One\";\n    Char[Char[\"Two\"] = 50] = \"Two\";\n    Char[Char[\"Three\"] = 51] = \"Three\";\n    Char[Char[\"Four\"] = 52] = \"Four\";\n    Char[Char[\"Five\"] = 53] = \"Five\";\n    Char[Char[\"Six\"] = 54] = \"Six\";\n    Char[Char[\"Seven\"] = 55] = \"Seven\";\n    Char[Char[\"Eight\"] = 56] = \"Eight\";\n    Char[Char[\"Nine\"] = 57] = \"Nine\";\n    Char[Char[\"UpperA\"] = 65] = \"UpperA\";\n    Char[Char[\"UpperB\"] = 66] = \"UpperB\";\n    Char[Char[\"UpperC\"] = 67] = \"UpperC\";\n    Char[Char[\"UpperD\"] = 68] = \"UpperD\";\n    Char[Char[\"UpperE\"] = 69] = \"UpperE\";\n    Char[Char[\"UpperF\"] = 70] = \"UpperF\";\n    Char[Char[\"UpperG\"] = 71] = \"UpperG\";\n    Char[Char[\"UpperH\"] = 72] = \"UpperH\";\n    Char[Char[\"UpperI\"] = 73] = \"UpperI\";\n    Char[Char[\"UpperJ\"] = 74] = \"UpperJ\";\n    Char[Char[\"UpperK\"] = 75] = \"UpperK\";\n    Char[Char[\"UpperL\"] = 76] = \"UpperL\";\n    Char[Char[\"UpperM\"] = 77] = \"UpperM\";\n    Char[Char[\"UpperN\"] = 78] = \"UpperN\";\n    Char[Char[\"UpperO\"] = 79] = \"UpperO\";\n    Char[Char[\"UpperP\"] = 80] = \"UpperP\";\n    Char[Char[\"UpperQ\"] = 81] = \"UpperQ\";\n    Char[Char[\"UpperR\"] = 82] = \"UpperR\";\n    Char[Char[\"UpperS\"] = 83] = \"UpperS\";\n    Char[Char[\"UpperT\"] = 84] = \"UpperT\";\n    Char[Char[\"UpperU\"] = 85] = \"UpperU\";\n    Char[Char[\"UpperV\"] = 86] = \"UpperV\";\n    Char[Char[\"UpperW\"] = 87] = \"UpperW\";\n    Char[Char[\"UpperX\"] = 88] = \"UpperX\";\n    Char[Char[\"UpperY\"] = 89] = \"UpperY\";\n    Char[Char[\"UpperZ\"] = 90] = \"UpperZ\";\n    Char[Char[\"LowerA\"] = 97] = \"LowerA\";\n    Char[Char[\"LowerB\"] = 98] = \"LowerB\";\n    Char[Char[\"LowerC\"] = 99] = \"LowerC\";\n    Char[Char[\"LowerD\"] = 100] = \"LowerD\";\n    Char[Char[\"LowerE\"] = 101] = \"LowerE\";\n    Char[Char[\"LowerF\"] = 102] = \"LowerF\";\n    Char[Char[\"LowerG\"] = 103] = \"LowerG\";\n    Char[Char[\"LowerH\"] = 104] = \"LowerH\";\n    Char[Char[\"LowerI\"] = 105] = \"LowerI\";\n    Char[Char[\"LowerJ\"] = 106] = \"LowerJ\";\n    Char[Char[\"LowerK\"] = 107] = \"LowerK\";\n    Char[Char[\"LowerL\"] = 108] = \"LowerL\";\n    Char[Char[\"LowerM\"] = 109] = \"LowerM\";\n    Char[Char[\"LowerN\"] = 110] = \"LowerN\";\n    Char[Char[\"LowerO\"] = 111] = \"LowerO\";\n    Char[Char[\"LowerP\"] = 112] = \"LowerP\";\n    Char[Char[\"LowerQ\"] = 113] = \"LowerQ\";\n    Char[Char[\"LowerR\"] = 114] = \"LowerR\";\n    Char[Char[\"LowerS\"] = 115] = \"LowerS\";\n    Char[Char[\"LowerT\"] = 116] = \"LowerT\";\n    Char[Char[\"LowerU\"] = 117] = \"LowerU\";\n    Char[Char[\"LowerV\"] = 118] = \"LowerV\";\n    Char[Char[\"LowerW\"] = 119] = \"LowerW\";\n    Char[Char[\"LowerX\"] = 120] = \"LowerX\";\n    Char[Char[\"LowerY\"] = 121] = \"LowerY\";\n    Char[Char[\"LowerZ\"] = 122] = \"LowerZ\";\n})(Char || (Char = {}));\n//# sourceMappingURL=common.js.map","import { Reporter } from '@aurelia/kernel';\nimport { AccessKeyedExpression, AccessMemberExpression, AccessScopeExpression, AccessThisExpression, ArrayBindingPattern, ArrayLiteralExpression, AssignExpression, BinaryExpression, BindingBehaviorExpression, BindingIdentifier, CallFunctionExpression, CallMemberExpression, CallScopeExpression, ConditionalExpression, CustomExpression, ForOfStatement, Interpolation, ObjectBindingPattern, ObjectLiteralExpression, PrimitiveLiteralExpression, TaggedTemplateExpression, TemplateExpression, UnaryExpression, ValueConverterExpression } from '@aurelia/runtime';\nimport { unescapeCode } from './common';\nconst $false = PrimitiveLiteralExpression.$false;\nconst $true = PrimitiveLiteralExpression.$true;\nconst $null = PrimitiveLiteralExpression.$null;\nconst $undefined = PrimitiveLiteralExpression.$undefined;\nconst $this = AccessThisExpression.$this;\nconst $parent = AccessThisExpression.$parent;\n/** @internal */\nexport class ParserState {\n    constructor(input) {\n        this.input = input;\n        this.index = 0;\n        this.startIndex = 0;\n        this.lastIndex = 0;\n        this.currentToken = 1572864 /* EOF */;\n        this.tokenValue = '';\n        this.assignable = true;\n        this.length = input.length;\n        this.currentChar = input.charCodeAt(0);\n    }\n    get tokenRaw() {\n        return this.input.slice(this.startIndex, this.index);\n    }\n}\nconst $state = new ParserState('');\nvar SyntaxError;\n(function (SyntaxError) {\n    SyntaxError[SyntaxError[\"InvalidExpressionStart\"] = 100] = \"InvalidExpressionStart\";\n    SyntaxError[SyntaxError[\"UnconsumedToken\"] = 101] = \"UnconsumedToken\";\n    SyntaxError[SyntaxError[\"DoubleDot\"] = 102] = \"DoubleDot\";\n    SyntaxError[SyntaxError[\"InvalidMemberExpression\"] = 103] = \"InvalidMemberExpression\";\n    SyntaxError[SyntaxError[\"UnexpectedEndOfExpression\"] = 104] = \"UnexpectedEndOfExpression\";\n    SyntaxError[SyntaxError[\"ExpectedIdentifier\"] = 105] = \"ExpectedIdentifier\";\n    SyntaxError[SyntaxError[\"InvalidForDeclaration\"] = 106] = \"InvalidForDeclaration\";\n    SyntaxError[SyntaxError[\"InvalidObjectLiteralPropertyDefinition\"] = 107] = \"InvalidObjectLiteralPropertyDefinition\";\n    SyntaxError[SyntaxError[\"UnterminatedQuote\"] = 108] = \"UnterminatedQuote\";\n    SyntaxError[SyntaxError[\"UnterminatedTemplate\"] = 109] = \"UnterminatedTemplate\";\n    SyntaxError[SyntaxError[\"MissingExpectedToken\"] = 110] = \"MissingExpectedToken\";\n    SyntaxError[SyntaxError[\"UnexpectedCharacter\"] = 111] = \"UnexpectedCharacter\";\n    SyntaxError[SyntaxError[\"MissingValueConverter\"] = 112] = \"MissingValueConverter\";\n    SyntaxError[SyntaxError[\"MissingBindingBehavior\"] = 113] = \"MissingBindingBehavior\";\n})(SyntaxError || (SyntaxError = {}));\nvar SemanticError;\n(function (SemanticError) {\n    SemanticError[SemanticError[\"NotAssignable\"] = 150] = \"NotAssignable\";\n    SemanticError[SemanticError[\"UnexpectedForOf\"] = 151] = \"UnexpectedForOf\";\n})(SemanticError || (SemanticError = {}));\nexport function parseExpression(input, bindingType) {\n    $state.input = input;\n    $state.length = input.length;\n    $state.index = 0;\n    $state.currentChar = input.charCodeAt(0);\n    return parse($state, 0 /* Reset */, 61 /* Variadic */, bindingType === void 0 ? 53 /* BindCommand */ : bindingType);\n}\n/** @internal */\n// JUSTIFICATION: This is performance-critical code which follows a subset of the well-known ES spec.\n// Knowing the spec, or parsers in general, will help with understanding this code and it is therefore not the\n// single source of information for being able to figure it out.\n// It generally does not need to change unless the spec changes or spec violations are found, or optimization\n// opportunities are found (which would likely not fix these warnings in any case).\n// It's therefore not considered to have any tangible impact on the maintainability of the code base.\n// For reference, most of the parsing logic is based on: https://tc39.github.io/ecma262/#sec-ecmascript-language-expressions\n// eslint-disable-next-line max-lines-per-function\nexport function parse(state, access, minPrecedence, bindingType) {\n    if (bindingType === 284 /* CustomCommand */) {\n        return new CustomExpression(state.input);\n    }\n    if (state.index === 0) {\n        if (bindingType & 2048 /* Interpolation */) {\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            return parseInterpolation(state);\n        }\n        nextToken(state);\n        if (state.currentToken & 1048576 /* ExpressionTerminal */) {\n            throw Reporter.error(100 /* InvalidExpressionStart */, { state });\n        }\n    }\n    state.assignable = 448 /* Binary */ > minPrecedence;\n    let result = void 0;\n    if (state.currentToken & 32768 /* UnaryOp */) {\n        /** parseUnaryExpression\n         * https://tc39.github.io/ecma262/#sec-unary-operators\n         *\n         * UnaryExpression :\n         * 1. LeftHandSideExpression\n         * 2. void UnaryExpression\n         * 3. typeof UnaryExpression\n         * 4. + UnaryExpression\n         * 5. - UnaryExpression\n         * 6. ! UnaryExpression\n         *\n         * IsValidAssignmentTarget\n         * 2,3,4,5,6 = false\n         * 1 = see parseLeftHandSideExpression\n         *\n         * Note: technically we should throw on ++ / -- / +++ / ---, but there's nothing to gain from that\n         */\n        const op = TokenValues[state.currentToken & 63 /* Type */];\n        nextToken(state);\n        result = new UnaryExpression(op, parse(state, access, 449 /* LeftHandSide */, bindingType));\n        state.assignable = false;\n    }\n    else {\n        /** parsePrimaryExpression\n         * https://tc39.github.io/ecma262/#sec-primary-expression\n         *\n         * PrimaryExpression :\n         * 1. this\n         * 2. IdentifierName\n         * 3. Literal\n         * 4. ArrayLiteralExpression\n         * 5. ObjectLiteralExpression\n         * 6. TemplateLiteral\n         * 7. ParenthesizedExpression\n         *\n         * Literal :\n         * NullLiteral\n         * BooleanLiteral\n         * NumericLiteral\n         * StringLiteral\n         *\n         * ParenthesizedExpression :\n         * ( AssignmentExpression )\n         *\n         * IsValidAssignmentTarget\n         * 1,3,4,5,6,7 = false\n         * 2 = true\n         */\n        primary: switch (state.currentToken) {\n            case 3077 /* ParentScope */: // $parent\n                state.assignable = false;\n                do {\n                    nextToken(state);\n                    access++; // ancestor\n                    if (consumeOpt(state, 16392 /* Dot */)) {\n                        if (state.currentToken === 16392 /* Dot */) {\n                            throw Reporter.error(102 /* DoubleDot */, { state });\n                        }\n                        else if (state.currentToken === 1572864 /* EOF */) {\n                            throw Reporter.error(105 /* ExpectedIdentifier */, { state });\n                        }\n                    }\n                    else if (state.currentToken & 524288 /* AccessScopeTerminal */) {\n                        const ancestor = access & 511 /* Ancestor */;\n                        result = ancestor === 0 ? $this : ancestor === 1 ? $parent : new AccessThisExpression(ancestor);\n                        access = 512 /* This */;\n                        break primary;\n                    }\n                    else {\n                        throw Reporter.error(103 /* InvalidMemberExpression */, { state });\n                    }\n                } while (state.currentToken === 3077 /* ParentScope */);\n            // falls through\n            case 1024 /* Identifier */: // identifier\n                if (bindingType & 512 /* IsIterator */) {\n                    result = new BindingIdentifier(state.tokenValue);\n                }\n                else {\n                    result = new AccessScopeExpression(state.tokenValue, access & 511 /* Ancestor */);\n                    access = 1024 /* Scope */;\n                }\n                state.assignable = true;\n                nextToken(state);\n                break;\n            case 3076 /* ThisScope */: // $this\n                state.assignable = false;\n                nextToken(state);\n                result = $this;\n                access = 512 /* This */;\n                break;\n            case 671750 /* OpenParen */: // parenthesized expression\n                nextToken(state);\n                result = parse(state, 0 /* Reset */, 62 /* Assign */, bindingType);\n                consume(state, 1835018 /* CloseParen */);\n                access = 0 /* Reset */;\n                break;\n            case 671756 /* OpenBracket */:\n                result = parseArrayLiteralExpression(state, access, bindingType);\n                access = 0 /* Reset */;\n                break;\n            case 131079 /* OpenBrace */:\n                result = parseObjectLiteralExpression(state, bindingType);\n                access = 0 /* Reset */;\n                break;\n            case 540713 /* TemplateTail */:\n                result = new TemplateExpression([state.tokenValue]);\n                state.assignable = false;\n                nextToken(state);\n                access = 0 /* Reset */;\n                break;\n            case 540714 /* TemplateContinuation */:\n                result = parseTemplate(state, access, bindingType, result, false);\n                access = 0 /* Reset */;\n                break;\n            case 4096 /* StringLiteral */:\n            case 8192 /* NumericLiteral */:\n                result = new PrimitiveLiteralExpression(state.tokenValue);\n                state.assignable = false;\n                nextToken(state);\n                access = 0 /* Reset */;\n                break;\n            case 2050 /* NullKeyword */:\n            case 2051 /* UndefinedKeyword */:\n            case 2049 /* TrueKeyword */:\n            case 2048 /* FalseKeyword */:\n                result = TokenValues[state.currentToken & 63 /* Type */];\n                state.assignable = false;\n                nextToken(state);\n                access = 0 /* Reset */;\n                break;\n            default:\n                if (state.index >= state.length) {\n                    throw Reporter.error(104 /* UnexpectedEndOfExpression */, { state });\n                }\n                else {\n                    throw Reporter.error(101 /* UnconsumedToken */, { state });\n                }\n        }\n        if (bindingType & 512 /* IsIterator */) {\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            return parseForOfStatement(state, result);\n        }\n        if (449 /* LeftHandSide */ < minPrecedence) {\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            return result;\n        }\n        /** parseMemberExpression (Token.Dot, Token.OpenBracket, Token.TemplateContinuation)\n         * MemberExpression :\n         * 1. PrimaryExpression\n         * 2. MemberExpression [ AssignmentExpression ]\n         * 3. MemberExpression . IdentifierName\n         * 4. MemberExpression TemplateLiteral\n         *\n         * IsValidAssignmentTarget\n         * 1,4 = false\n         * 2,3 = true\n         *\n         *\n         * parseCallExpression (Token.OpenParen)\n         * CallExpression :\n         * 1. MemberExpression Arguments\n         * 2. CallExpression Arguments\n         * 3. CallExpression [ AssignmentExpression ]\n         * 4. CallExpression . IdentifierName\n         * 5. CallExpression TemplateLiteral\n         *\n         * IsValidAssignmentTarget\n         * 1,2,5 = false\n         * 3,4 = true\n         */\n        let name = state.tokenValue;\n        while ((state.currentToken & 16384 /* LeftHandSide */) > 0) {\n            const args = [];\n            let strings;\n            switch (state.currentToken) {\n                case 16392 /* Dot */:\n                    state.assignable = true;\n                    nextToken(state);\n                    if ((state.currentToken & 3072 /* IdentifierName */) === 0) {\n                        throw Reporter.error(105 /* ExpectedIdentifier */, { state });\n                    }\n                    name = state.tokenValue;\n                    nextToken(state);\n                    // Change $This to $Scope, change $Scope to $Member, keep $Member as-is, change $Keyed to $Member, disregard other flags\n                    access = ((access & (512 /* This */ | 1024 /* Scope */)) << 1) | (access & 2048 /* Member */) | ((access & 4096 /* Keyed */) >> 1);\n                    if (state.currentToken === 671750 /* OpenParen */) {\n                        if (access === 0 /* Reset */) { // if the left hand side is a literal, make sure we parse a CallMemberExpression\n                            access = 2048 /* Member */;\n                        }\n                        continue;\n                    }\n                    if (access & 1024 /* Scope */) {\n                        result = new AccessScopeExpression(name, result.ancestor);\n                    }\n                    else { // if it's not $Scope, it's $Member\n                        result = new AccessMemberExpression(result, name);\n                    }\n                    continue;\n                case 671756 /* OpenBracket */:\n                    state.assignable = true;\n                    nextToken(state);\n                    access = 4096 /* Keyed */;\n                    result = new AccessKeyedExpression(result, parse(state, 0 /* Reset */, 62 /* Assign */, bindingType));\n                    consume(state, 1835021 /* CloseBracket */);\n                    break;\n                case 671750 /* OpenParen */:\n                    state.assignable = false;\n                    nextToken(state);\n                    while (state.currentToken !== 1835018 /* CloseParen */) {\n                        args.push(parse(state, 0 /* Reset */, 62 /* Assign */, bindingType));\n                        if (!consumeOpt(state, 1572875 /* Comma */)) {\n                            break;\n                        }\n                    }\n                    consume(state, 1835018 /* CloseParen */);\n                    if (access & 1024 /* Scope */) {\n                        result = new CallScopeExpression(name, args, result.ancestor);\n                    }\n                    else if (access & 2048 /* Member */) {\n                        result = new CallMemberExpression(result, name, args);\n                    }\n                    else {\n                        result = new CallFunctionExpression(result, args);\n                    }\n                    access = 0;\n                    break;\n                case 540713 /* TemplateTail */:\n                    state.assignable = false;\n                    strings = [state.tokenValue];\n                    result = new TaggedTemplateExpression(strings, strings, result);\n                    nextToken(state);\n                    break;\n                case 540714 /* TemplateContinuation */:\n                    result = parseTemplate(state, access, bindingType, result, true);\n                default:\n            }\n        }\n    }\n    if (448 /* Binary */ < minPrecedence) {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        return result;\n    }\n    /** parseBinaryExpression\n     * https://tc39.github.io/ecma262/#sec-multiplicative-operators\n     *\n     * MultiplicativeExpression : (local precedence 6)\n     * UnaryExpression\n     * MultiplicativeExpression * / % UnaryExpression\n     *\n     * AdditiveExpression : (local precedence 5)\n     * MultiplicativeExpression\n     * AdditiveExpression + - MultiplicativeExpression\n     *\n     * RelationalExpression : (local precedence 4)\n     * AdditiveExpression\n     * RelationalExpression < > <= >= instanceof in AdditiveExpression\n     *\n     * EqualityExpression : (local precedence 3)\n     * RelationalExpression\n     * EqualityExpression == != === !== RelationalExpression\n     *\n     * LogicalANDExpression : (local precedence 2)\n     * EqualityExpression\n     * LogicalANDExpression && EqualityExpression\n     *\n     * LogicalORExpression : (local precedence 1)\n     * LogicalANDExpression\n     * LogicalORExpression || LogicalANDExpression\n     */\n    while ((state.currentToken & 65536 /* BinaryOp */) > 0) {\n        const opToken = state.currentToken;\n        if ((opToken & 448 /* Precedence */) <= minPrecedence) {\n            break;\n        }\n        nextToken(state);\n        result = new BinaryExpression(TokenValues[opToken & 63 /* Type */], result, parse(state, access, opToken & 448 /* Precedence */, bindingType));\n        state.assignable = false;\n    }\n    if (63 /* Conditional */ < minPrecedence) {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        return result;\n    }\n    /**\n     * parseConditionalExpression\n     * https://tc39.github.io/ecma262/#prod-ConditionalExpression\n     *\n     * ConditionalExpression :\n     * 1. BinaryExpression\n     * 2. BinaryExpression ? AssignmentExpression : AssignmentExpression\n     *\n     * IsValidAssignmentTarget\n     * 1,2 = false\n     */\n    if (consumeOpt(state, 1572879 /* Question */)) {\n        const yes = parse(state, access, 62 /* Assign */, bindingType);\n        consume(state, 1572878 /* Colon */);\n        result = new ConditionalExpression(result, yes, parse(state, access, 62 /* Assign */, bindingType));\n        state.assignable = false;\n    }\n    if (62 /* Assign */ < minPrecedence) {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        return result;\n    }\n    /** parseAssignmentExpression\n     * https://tc39.github.io/ecma262/#prod-AssignmentExpression\n     * Note: AssignmentExpression here is equivalent to ES Expression because we don't parse the comma operator\n     *\n     * AssignmentExpression :\n     * 1. ConditionalExpression\n     * 2. LeftHandSideExpression = AssignmentExpression\n     *\n     * IsValidAssignmentTarget\n     * 1,2 = false\n     */\n    if (consumeOpt(state, 1048615 /* Equals */)) {\n        if (!state.assignable) {\n            throw Reporter.error(150 /* NotAssignable */, { state });\n        }\n        result = new AssignExpression(result, parse(state, access, 62 /* Assign */, bindingType));\n    }\n    if (61 /* Variadic */ < minPrecedence) {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        return result;\n    }\n    /** parseValueConverter\n     */\n    while (consumeOpt(state, 1572883 /* Bar */)) {\n        if (state.currentToken === 1572864 /* EOF */) {\n            throw Reporter.error(112);\n        }\n        const name = state.tokenValue;\n        nextToken(state);\n        const args = new Array();\n        while (consumeOpt(state, 1572878 /* Colon */)) {\n            args.push(parse(state, access, 62 /* Assign */, bindingType));\n        }\n        result = new ValueConverterExpression(result, name, args);\n    }\n    /** parseBindingBehavior\n     */\n    while (consumeOpt(state, 1572880 /* Ampersand */)) {\n        if (state.currentToken === 1572864 /* EOF */) {\n            throw Reporter.error(113);\n        }\n        const name = state.tokenValue;\n        nextToken(state);\n        const args = new Array();\n        while (consumeOpt(state, 1572878 /* Colon */)) {\n            args.push(parse(state, access, 62 /* Assign */, bindingType));\n        }\n        result = new BindingBehaviorExpression(result, name, args);\n    }\n    if (state.currentToken !== 1572864 /* EOF */) {\n        if (bindingType & 2048 /* Interpolation */) {\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            return result;\n        }\n        if (state.tokenRaw === 'of') {\n            throw Reporter.error(151 /* UnexpectedForOf */, { state });\n        }\n        throw Reporter.error(101 /* UnconsumedToken */, { state });\n    }\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    return result;\n}\n/**\n * parseArrayLiteralExpression\n * https://tc39.github.io/ecma262/#prod-ArrayLiteralExpression\n *\n * ArrayLiteralExpression :\n * [ Elision(opt) ]\n * [ ElementList ]\n * [ ElementList, Elision(opt) ]\n *\n * ElementList :\n * Elision(opt) AssignmentExpression\n * ElementList, Elision(opt) AssignmentExpression\n *\n * Elision :\n * ,\n * Elision ,\n */\nfunction parseArrayLiteralExpression(state, access, bindingType) {\n    nextToken(state);\n    const elements = new Array();\n    while (state.currentToken !== 1835021 /* CloseBracket */) {\n        if (consumeOpt(state, 1572875 /* Comma */)) {\n            elements.push($undefined);\n            if (state.currentToken === 1835021 /* CloseBracket */) {\n                break;\n            }\n        }\n        else {\n            elements.push(parse(state, access, 62 /* Assign */, bindingType & ~512 /* IsIterator */));\n            if (consumeOpt(state, 1572875 /* Comma */)) {\n                if (state.currentToken === 1835021 /* CloseBracket */) {\n                    break;\n                }\n            }\n            else {\n                break;\n            }\n        }\n    }\n    consume(state, 1835021 /* CloseBracket */);\n    if (bindingType & 512 /* IsIterator */) {\n        return new ArrayBindingPattern(elements);\n    }\n    else {\n        state.assignable = false;\n        return new ArrayLiteralExpression(elements);\n    }\n}\nfunction parseForOfStatement(state, result) {\n    if ((result.$kind & 65536 /* IsForDeclaration */) === 0) {\n        throw Reporter.error(106 /* InvalidForDeclaration */, { state });\n    }\n    if (state.currentToken !== 1051179 /* OfKeyword */) {\n        throw Reporter.error(106 /* InvalidForDeclaration */, { state });\n    }\n    nextToken(state);\n    const declaration = result;\n    const statement = parse(state, 0 /* Reset */, 61 /* Variadic */, 0 /* None */);\n    return new ForOfStatement(declaration, statement);\n}\n/**\n * parseObjectLiteralExpression\n * https://tc39.github.io/ecma262/#prod-Literal\n *\n * ObjectLiteralExpression :\n * { }\n * { PropertyDefinitionList }\n *\n * PropertyDefinitionList :\n * PropertyDefinition\n * PropertyDefinitionList, PropertyDefinition\n *\n * PropertyDefinition :\n * IdentifierName\n * PropertyName : AssignmentExpression\n *\n * PropertyName :\n * IdentifierName\n * StringLiteral\n * NumericLiteral\n */\nfunction parseObjectLiteralExpression(state, bindingType) {\n    const keys = new Array();\n    const values = new Array();\n    nextToken(state);\n    while (state.currentToken !== 1835017 /* CloseBrace */) {\n        keys.push(state.tokenValue);\n        // Literal = mandatory colon\n        if (state.currentToken & 12288 /* StringOrNumericLiteral */) {\n            nextToken(state);\n            consume(state, 1572878 /* Colon */);\n            values.push(parse(state, 0 /* Reset */, 62 /* Assign */, bindingType & ~512 /* IsIterator */));\n        }\n        else if (state.currentToken & 3072 /* IdentifierName */) {\n            // IdentifierName = optional colon\n            const { currentChar, currentToken, index } = state;\n            nextToken(state);\n            if (consumeOpt(state, 1572878 /* Colon */)) {\n                values.push(parse(state, 0 /* Reset */, 62 /* Assign */, bindingType & ~512 /* IsIterator */));\n            }\n            else {\n                // Shorthand\n                state.currentChar = currentChar;\n                state.currentToken = currentToken;\n                state.index = index;\n                values.push(parse(state, 0 /* Reset */, 450 /* Primary */, bindingType & ~512 /* IsIterator */));\n            }\n        }\n        else {\n            throw Reporter.error(107 /* InvalidObjectLiteralPropertyDefinition */, { state });\n        }\n        if (state.currentToken !== 1835017 /* CloseBrace */) {\n            consume(state, 1572875 /* Comma */);\n        }\n    }\n    consume(state, 1835017 /* CloseBrace */);\n    if (bindingType & 512 /* IsIterator */) {\n        return new ObjectBindingPattern(keys, values);\n    }\n    else {\n        state.assignable = false;\n        return new ObjectLiteralExpression(keys, values);\n    }\n}\nfunction parseInterpolation(state) {\n    const parts = [];\n    const expressions = [];\n    const length = state.length;\n    let result = '';\n    while (state.index < length) {\n        switch (state.currentChar) {\n            case 36 /* Dollar */:\n                if (state.input.charCodeAt(state.index + 1) === 123 /* OpenBrace */) {\n                    parts.push(result);\n                    result = '';\n                    state.index += 2;\n                    state.currentChar = state.input.charCodeAt(state.index);\n                    nextToken(state);\n                    const expression = parse(state, 0 /* Reset */, 61 /* Variadic */, 2048 /* Interpolation */);\n                    expressions.push(expression);\n                    continue;\n                }\n                else {\n                    result += '$';\n                }\n                break;\n            case 92 /* Backslash */:\n                result += String.fromCharCode(unescapeCode(nextChar(state)));\n                break;\n            default:\n                result += String.fromCharCode(state.currentChar);\n        }\n        nextChar(state);\n    }\n    if (expressions.length) {\n        parts.push(result);\n        return new Interpolation(parts, expressions);\n    }\n    return null;\n}\n/**\n * parseTemplateLiteralExpression\n * https://tc39.github.io/ecma262/#prod-Literal\n *\n * TemplateExpression :\n * NoSubstitutionTemplate\n * TemplateHead\n *\n * NoSubstitutionTemplate :\n * ` TemplateCharacters(opt) `\n *\n * TemplateHead :\n * ` TemplateCharacters(opt) ${\n *\n * TemplateSubstitutionTail :\n * TemplateMiddle\n * TemplateTail\n *\n * TemplateMiddle :\n * } TemplateCharacters(opt) ${\n *\n * TemplateTail :\n * } TemplateCharacters(opt) `\n *\n * TemplateCharacters :\n * TemplateCharacter TemplateCharacters(opt)\n *\n * TemplateCharacter :\n * $ [lookahead  {]\n * \\ EscapeSequence\n * SourceCharacter (but not one of ` or \\ or $)\n */\nfunction parseTemplate(state, access, bindingType, result, tagged) {\n    const cooked = [state.tokenValue];\n    // TODO: properly implement raw parts / decide whether we want this\n    consume(state, 540714 /* TemplateContinuation */);\n    const expressions = [parse(state, access, 62 /* Assign */, bindingType)];\n    while ((state.currentToken = scanTemplateTail(state)) !== 540713 /* TemplateTail */) {\n        cooked.push(state.tokenValue);\n        consume(state, 540714 /* TemplateContinuation */);\n        expressions.push(parse(state, access, 62 /* Assign */, bindingType));\n    }\n    cooked.push(state.tokenValue);\n    state.assignable = false;\n    if (tagged) {\n        nextToken(state);\n        return new TaggedTemplateExpression(cooked, cooked, result, expressions);\n    }\n    else {\n        nextToken(state);\n        return new TemplateExpression(cooked, expressions);\n    }\n}\nfunction nextToken(state) {\n    while (state.index < state.length) {\n        state.startIndex = state.index;\n        if ((state.currentToken = (CharScanners[state.currentChar](state))) != null) { // a null token means the character must be skipped\n            return;\n        }\n    }\n    state.currentToken = 1572864 /* EOF */;\n}\nfunction nextChar(state) {\n    return state.currentChar = state.input.charCodeAt(++state.index);\n}\nfunction scanIdentifier(state) {\n    // run to the next non-idPart\n    while (IdParts[nextChar(state)])\n        ;\n    const token = KeywordLookup[state.tokenValue = state.tokenRaw];\n    return token === undefined ? 1024 /* Identifier */ : token;\n}\nfunction scanNumber(state, isFloat) {\n    let char = state.currentChar;\n    if (isFloat === false) {\n        do {\n            char = nextChar(state);\n        } while (char <= 57 /* Nine */ && char >= 48 /* Zero */);\n        if (char !== 46 /* Dot */) {\n            state.tokenValue = parseInt(state.tokenRaw, 10);\n            return 8192 /* NumericLiteral */;\n        }\n        // past this point it's always a float\n        char = nextChar(state);\n        if (state.index >= state.length) {\n            // unless the number ends with a dot - that behaves a little different in native ES expressions\n            // but in our AST that behavior has no effect because numbers are always stored in variables\n            state.tokenValue = parseInt(state.tokenRaw.slice(0, -1), 10);\n            return 8192 /* NumericLiteral */;\n        }\n    }\n    if (char <= 57 /* Nine */ && char >= 48 /* Zero */) {\n        do {\n            char = nextChar(state);\n        } while (char <= 57 /* Nine */ && char >= 48 /* Zero */);\n    }\n    else {\n        state.currentChar = state.input.charCodeAt(--state.index);\n    }\n    state.tokenValue = parseFloat(state.tokenRaw);\n    return 8192 /* NumericLiteral */;\n}\nfunction scanString(state) {\n    const quote = state.currentChar;\n    nextChar(state); // Skip initial quote.\n    let unescaped = 0;\n    const buffer = new Array();\n    let marker = state.index;\n    while (state.currentChar !== quote) {\n        if (state.currentChar === 92 /* Backslash */) {\n            buffer.push(state.input.slice(marker, state.index));\n            nextChar(state);\n            unescaped = unescapeCode(state.currentChar);\n            nextChar(state);\n            buffer.push(String.fromCharCode(unescaped));\n            marker = state.index;\n        }\n        else if (state.index >= state.length) {\n            throw Reporter.error(108 /* UnterminatedQuote */, { state });\n        }\n        else {\n            nextChar(state);\n        }\n    }\n    const last = state.input.slice(marker, state.index);\n    nextChar(state); // Skip terminating quote.\n    // Compute the unescaped string value.\n    buffer.push(last);\n    const unescapedStr = buffer.join('');\n    state.tokenValue = unescapedStr;\n    return 4096 /* StringLiteral */;\n}\nfunction scanTemplate(state) {\n    let tail = true;\n    let result = '';\n    while (nextChar(state) !== 96 /* Backtick */) {\n        if (state.currentChar === 36 /* Dollar */) {\n            if ((state.index + 1) < state.length && state.input.charCodeAt(state.index + 1) === 123 /* OpenBrace */) {\n                state.index++;\n                tail = false;\n                break;\n            }\n            else {\n                result += '$';\n            }\n        }\n        else if (state.currentChar === 92 /* Backslash */) {\n            result += String.fromCharCode(unescapeCode(nextChar(state)));\n        }\n        else {\n            if (state.index >= state.length) {\n                throw Reporter.error(109 /* UnterminatedTemplate */, { state });\n            }\n            result += String.fromCharCode(state.currentChar);\n        }\n    }\n    nextChar(state);\n    state.tokenValue = result;\n    if (tail) {\n        return 540713 /* TemplateTail */;\n    }\n    return 540714 /* TemplateContinuation */;\n}\nfunction scanTemplateTail(state) {\n    if (state.index >= state.length) {\n        throw Reporter.error(109 /* UnterminatedTemplate */, { state });\n    }\n    state.index--;\n    return scanTemplate(state);\n}\nfunction consumeOpt(state, token) {\n    if (state.currentToken === token) {\n        nextToken(state);\n        return true;\n    }\n    return false;\n}\nfunction consume(state, token) {\n    if (state.currentToken === token) {\n        nextToken(state);\n    }\n    else {\n        throw Reporter.error(110 /* MissingExpectedToken */, { state, expected: token });\n    }\n}\n/**\n * Array for mapping tokens to token values. The indices of the values\n * correspond to the token bits 0-38.\n * For this to work properly, the values in the array must be kept in\n * the same order as the token bits.\n * Usage: TokenValues[token & Token.Type]\n */\nconst TokenValues = [\n    $false, $true, $null, $undefined, '$this', '$parent',\n    '(', '{', '.', '}', ')', ',', '[', ']', ':', '?', '\\'', '\"',\n    '&', '|', '||', '&&', '==', '!=', '===', '!==', '<', '>',\n    '<=', '>=', 'in', 'instanceof', '+', '-', 'typeof', 'void', '*', '%', '/', '=', '!',\n    540713 /* TemplateTail */, 540714 /* TemplateContinuation */,\n    'of'\n];\nconst KeywordLookup = Object.create(null);\nKeywordLookup.true = 2049 /* TrueKeyword */;\nKeywordLookup.null = 2050 /* NullKeyword */;\nKeywordLookup.false = 2048 /* FalseKeyword */;\nKeywordLookup.undefined = 2051 /* UndefinedKeyword */;\nKeywordLookup.$this = 3076 /* ThisScope */;\nKeywordLookup.$parent = 3077 /* ParentScope */;\nKeywordLookup.in = 1640798 /* InKeyword */;\nKeywordLookup.instanceof = 1640799 /* InstanceOfKeyword */;\nKeywordLookup.typeof = 34850 /* TypeofKeyword */;\nKeywordLookup.void = 34851 /* VoidKeyword */;\nKeywordLookup.of = 1051179 /* OfKeyword */;\n/**\n * Ranges of code points in pairs of 2 (eg 0x41-0x5B, 0x61-0x7B, ...) where the second value is not inclusive (5-7 means 5 and 6)\n * Single values are denoted by the second value being a 0\n *\n * Copied from output generated with \"node build/generate-unicode.js\"\n *\n * See also: https://en.wikibooks.org/wiki/Unicode/Character_reference/0000-0FFF\n */\nconst codes = {\n    /* [$0-9A-Za_a-z] */\n    AsciiIdPart: [0x24, 0, 0x30, 0x3A, 0x41, 0x5B, 0x5F, 0, 0x61, 0x7B],\n    IdStart: /* IdentifierStart */ [0x24, 0, 0x41, 0x5B, 0x5F, 0, 0x61, 0x7B, 0xAA, 0, 0xBA, 0, 0xC0, 0xD7, 0xD8, 0xF7, 0xF8, 0x2B9, 0x2E0, 0x2E5, 0x1D00, 0x1D26, 0x1D2C, 0x1D5D, 0x1D62, 0x1D66, 0x1D6B, 0x1D78, 0x1D79, 0x1DBF, 0x1E00, 0x1F00, 0x2071, 0, 0x207F, 0, 0x2090, 0x209D, 0x212A, 0x212C, 0x2132, 0, 0x214E, 0, 0x2160, 0x2189, 0x2C60, 0x2C80, 0xA722, 0xA788, 0xA78B, 0xA7AF, 0xA7B0, 0xA7B8, 0xA7F7, 0xA800, 0xAB30, 0xAB5B, 0xAB5C, 0xAB65, 0xFB00, 0xFB07, 0xFF21, 0xFF3B, 0xFF41, 0xFF5B],\n    Digit: /* DecimalNumber */ [0x30, 0x3A],\n    Skip: /* Skippable */ [0, 0x21, 0x7F, 0xA1]\n};\n/**\n * Decompress the ranges into an array of numbers so that the char code\n * can be used as an index to the lookup\n */\nfunction decompress(lookup, $set, compressed, value) {\n    const rangeCount = compressed.length;\n    for (let i = 0; i < rangeCount; i += 2) {\n        const start = compressed[i];\n        let end = compressed[i + 1];\n        end = end > 0 ? end : start + 1;\n        if (lookup) {\n            lookup.fill(value, start, end);\n        }\n        if ($set) {\n            for (let ch = start; ch < end; ch++) {\n                $set.add(ch);\n            }\n        }\n    }\n}\n// CharFuncLookup functions\nfunction returnToken(token) {\n    return s => {\n        nextChar(s);\n        return token;\n    };\n}\nconst unexpectedCharacter = s => {\n    throw Reporter.error(111 /* UnexpectedCharacter */, { state: s });\n};\nunexpectedCharacter.notMapped = true;\n// ASCII IdentifierPart lookup\nconst AsciiIdParts = new Set();\ndecompress(null, AsciiIdParts, codes.AsciiIdPart, true);\n// IdentifierPart lookup\nconst IdParts = new Uint8Array(0xFFFF);\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\ndecompress(IdParts, null, codes.IdStart, 1);\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\ndecompress(IdParts, null, codes.Digit, 1);\n// Character scanning function lookup\nconst CharScanners = new Array(0xFFFF);\nCharScanners.fill(unexpectedCharacter, 0, 0xFFFF);\ndecompress(CharScanners, null, codes.Skip, s => {\n    nextChar(s);\n    return null;\n});\ndecompress(CharScanners, null, codes.IdStart, scanIdentifier);\ndecompress(CharScanners, null, codes.Digit, s => scanNumber(s, false));\nCharScanners[34 /* DoubleQuote */] =\n    CharScanners[39 /* SingleQuote */] = s => {\n        return scanString(s);\n    };\nCharScanners[96 /* Backtick */] = s => {\n    return scanTemplate(s);\n};\n// !, !=, !==\nCharScanners[33 /* Exclamation */] = s => {\n    if (nextChar(s) !== 61 /* Equals */) {\n        return 32808 /* Exclamation */;\n    }\n    if (nextChar(s) !== 61 /* Equals */) {\n        return 1638679 /* ExclamationEquals */;\n    }\n    nextChar(s);\n    return 1638681 /* ExclamationEqualsEquals */;\n};\n// =, ==, ===\nCharScanners[61 /* Equals */] = s => {\n    if (nextChar(s) !== 61 /* Equals */) {\n        return 1048615 /* Equals */;\n    }\n    if (nextChar(s) !== 61 /* Equals */) {\n        return 1638678 /* EqualsEquals */;\n    }\n    nextChar(s);\n    return 1638680 /* EqualsEqualsEquals */;\n};\n// &, &&\nCharScanners[38 /* Ampersand */] = s => {\n    if (nextChar(s) !== 38 /* Ampersand */) {\n        return 1572880 /* Ampersand */;\n    }\n    nextChar(s);\n    return 1638613 /* AmpersandAmpersand */;\n};\n// |, ||\nCharScanners[124 /* Bar */] = s => {\n    if (nextChar(s) !== 124 /* Bar */) {\n        return 1572883 /* Bar */;\n    }\n    nextChar(s);\n    return 1638548 /* BarBar */;\n};\n// .\nCharScanners[46 /* Dot */] = s => {\n    if (nextChar(s) <= 57 /* Nine */ && s.currentChar >= 48 /* Zero */) {\n        return scanNumber(s, true);\n    }\n    return 16392 /* Dot */;\n};\n// <, <=\nCharScanners[60 /* LessThan */] = s => {\n    if (nextChar(s) !== 61 /* Equals */) {\n        return 1638746 /* LessThan */;\n    }\n    nextChar(s);\n    return 1638748 /* LessThanEquals */;\n};\n// >, >=\nCharScanners[62 /* GreaterThan */] = s => {\n    if (nextChar(s) !== 61 /* Equals */) {\n        return 1638747 /* GreaterThan */;\n    }\n    nextChar(s);\n    return 1638749 /* GreaterThanEquals */;\n};\nCharScanners[37 /* Percent */] = returnToken(1638885 /* Percent */);\nCharScanners[40 /* OpenParen */] = returnToken(671750 /* OpenParen */);\nCharScanners[41 /* CloseParen */] = returnToken(1835018 /* CloseParen */);\nCharScanners[42 /* Asterisk */] = returnToken(1638884 /* Asterisk */);\nCharScanners[43 /* Plus */] = returnToken(623008 /* Plus */);\nCharScanners[44 /* Comma */] = returnToken(1572875 /* Comma */);\nCharScanners[45 /* Minus */] = returnToken(623009 /* Minus */);\nCharScanners[47 /* Slash */] = returnToken(1638886 /* Slash */);\nCharScanners[58 /* Colon */] = returnToken(1572878 /* Colon */);\nCharScanners[63 /* Question */] = returnToken(1572879 /* Question */);\nCharScanners[91 /* OpenBracket */] = returnToken(671756 /* OpenBracket */);\nCharScanners[93 /* CloseBracket */] = returnToken(1835021 /* CloseBracket */);\nCharScanners[123 /* OpenBrace */] = returnToken(131079 /* OpenBrace */);\nCharScanners[125 /* CloseBrace */] = returnToken(1835017 /* CloseBrace */);\n//# sourceMappingURL=expression-parser.js.map","import { DI } from '@aurelia/kernel';\nimport { IExpressionParser, RuntimeConfiguration } from '@aurelia/runtime';\nimport { AtPrefixedTriggerAttributePattern, ColonPrefixedBindAttributePattern, DotSeparatedAttributePattern, RefAttributePattern } from './attribute-patterns';\nimport { CallBindingCommand, DefaultBindingCommand, ForBindingCommand, FromViewBindingCommand, OneTimeBindingCommand, ToViewBindingCommand, TwoWayBindingCommand } from './binding-commands';\nimport { parseExpression } from './expression-parser';\nexport const IExpressionParserRegistration = {\n    register(container) {\n        container.registerTransformer(IExpressionParser, parser => {\n            Reflect.set(parser, 'parseCore', parseExpression);\n            return parser;\n        });\n    }\n};\n/**\n * Default runtime/environment-agnostic implementations for the following interfaces:\n * - `IExpressionParser`\n */\nexport const DefaultComponents = [\n    IExpressionParserRegistration\n];\nexport const AtPrefixedTriggerAttributePatternRegistration = AtPrefixedTriggerAttributePattern;\nexport const ColonPrefixedBindAttributePatternRegistration = ColonPrefixedBindAttributePattern;\nexport const RefAttributePatternRegistration = RefAttributePattern;\nexport const DotSeparatedAttributePatternRegistration = DotSeparatedAttributePattern;\n/**\n * Default binding syntax for the following attribute name patterns:\n * - `ref`\n * - `target.command` (dot-separated)\n */\nexport const DefaultBindingSyntax = [\n    RefAttributePatternRegistration,\n    DotSeparatedAttributePatternRegistration\n];\n/**\n * Binding syntax for short-hand attribute name patterns:\n * - `@target` (short-hand for `target.trigger`)\n * - `:target` (short-hand for `target.bind`)\n */\nexport const ShortHandBindingSyntax = [\n    AtPrefixedTriggerAttributePatternRegistration,\n    ColonPrefixedBindAttributePatternRegistration\n];\nexport const CallBindingCommandRegistration = CallBindingCommand;\nexport const DefaultBindingCommandRegistration = DefaultBindingCommand;\nexport const ForBindingCommandRegistration = ForBindingCommand;\nexport const FromViewBindingCommandRegistration = FromViewBindingCommand;\nexport const OneTimeBindingCommandRegistration = OneTimeBindingCommand;\nexport const ToViewBindingCommandRegistration = ToViewBindingCommand;\nexport const TwoWayBindingCommandRegistration = TwoWayBindingCommand;\n/**\n * Default runtime/environment-agnostic binding commands:\n * - Property observation: `.bind`, `.one-time`, `.from-view`, `.to-view`, `.two-way`\n * - Function call: `.call`\n * - Collection observation: `.for`\n */\nexport const DefaultBindingLanguage = [\n    DefaultBindingCommandRegistration,\n    OneTimeBindingCommandRegistration,\n    FromViewBindingCommandRegistration,\n    ToViewBindingCommandRegistration,\n    TwoWayBindingCommandRegistration,\n    CallBindingCommandRegistration,\n    ForBindingCommandRegistration\n];\n/**\n * A DI configuration object containing runtime/environment-agnostic registrations:\n * - `RuntimeConfiguration` from `@aurelia/runtime`\n * - `DefaultComponents`\n * - `DefaultBindingSyntax`\n * - `DefaultBindingLanguage`\n */\nexport const JitConfiguration = {\n    /**\n     * Apply this configuration to the provided container.\n     */\n    register(container) {\n        return RuntimeConfiguration\n            .register(container)\n            .register(...DefaultComponents, ...DefaultBindingSyntax, ...DefaultBindingLanguage);\n    },\n    /**\n     * Create a new container with this configuration applied to it.\n     */\n    createContainer() {\n        return this.register(DI.createContainer());\n    }\n};\n//# sourceMappingURL=configuration.js.map","import { kebabCase, Metadata, } from '@aurelia/kernel';\nimport { BindingMode, CustomAttribute, CustomElement, } from '@aurelia/runtime';\nimport { BindingCommand } from './binding-command';\n/**\n * A pre-processed piece of information about a defined bindable property on a custom\n * element or attribute, optimized for consumption by the template compiler.\n */\nexport class BindableInfo {\n    constructor(\n    /**\n     * The pre-processed *property* (not attribute) name of the bindable, which is\n     * (in order of priority):\n     *\n     * 1. The `property` from the description (if defined)\n     * 2. The name of the property of the bindable itself\n     */\n    propName, \n    /**\n     * The pre-processed (default) bindingMode of the bindable, which is (in order of priority):\n     *\n     * 1. The `mode` from the bindable (if defined and not bindingMode.default)\n     * 2. The `defaultBindingMode` (if it's an attribute, defined, and not bindingMode.default)\n     * 3. `bindingMode.toView`\n     */\n    mode) {\n        this.propName = propName;\n        this.mode = mode;\n    }\n}\n/**\n * Pre-processed information about a custom element resource, optimized\n * for consumption by the template compiler.\n */\nexport class ElementInfo {\n    constructor(name, containerless) {\n        this.name = name;\n        this.containerless = containerless;\n        /**\n         * A lookup of the bindables of this element, indexed by the (pre-processed)\n         * attribute names as they would be found in parsed markup.\n         */\n        this.bindables = Object.create(null);\n    }\n    static from(def) {\n        const info = new ElementInfo(def.name, def.containerless);\n        const bindables = def.bindables;\n        const defaultBindingMode = BindingMode.toView;\n        let bindable;\n        let prop;\n        let attr;\n        let mode;\n        for (prop in bindables) {\n            bindable = bindables[prop];\n            // explicitly provided property name has priority over the implicit property name\n            if (bindable.property !== void 0) {\n                prop = bindable.property;\n            }\n            // explicitly provided attribute name has priority over the derived implicit attribute name\n            if (bindable.attribute !== void 0) {\n                attr = bindable.attribute;\n            }\n            else {\n                // derive the attribute name from the resolved property name\n                attr = kebabCase(prop);\n            }\n            if (bindable.mode !== void 0 && bindable.mode !== BindingMode.default) {\n                mode = bindable.mode;\n            }\n            else {\n                mode = defaultBindingMode;\n            }\n            info.bindables[attr] = new BindableInfo(prop, mode);\n        }\n        return info;\n    }\n}\n/**\n * Pre-processed information about a custom attribute resource, optimized\n * for consumption by the template compiler.\n */\nexport class AttrInfo {\n    constructor(name, isTemplateController, noMultiBindings) {\n        this.name = name;\n        this.isTemplateController = isTemplateController;\n        this.noMultiBindings = noMultiBindings;\n        /**\n         * A lookup of the bindables of this attribute, indexed by the (pre-processed)\n         * bindable names as they would be found in the attribute value.\n         *\n         * Only applicable to multi attribute bindings (semicolon-separated).\n         */\n        this.bindables = Object.create(null);\n        /**\n         * The single or first bindable of this attribute, or a default 'value'\n         * bindable if no bindables were defined on the attribute.\n         *\n         * Only applicable to single attribute bindings (where the attribute value\n         * contains no semicolons)\n         */\n        this.bindable = null;\n    }\n    static from(def) {\n        const info = new AttrInfo(def.name, def.isTemplateController, def.noMultiBindings);\n        const bindables = def.bindables;\n        const defaultBindingMode = def.defaultBindingMode !== void 0 && def.defaultBindingMode !== BindingMode.default\n            ? def.defaultBindingMode\n            : BindingMode.toView;\n        let bindable;\n        let prop;\n        let mode;\n        let hasPrimary = false;\n        let isPrimary = false;\n        let bindableInfo;\n        for (prop in bindables) {\n            bindable = bindables[prop];\n            // explicitly provided property name has priority over the implicit property name\n            if (bindable.property !== void 0) {\n                prop = bindable.property;\n            }\n            if (bindable.mode !== void 0 && bindable.mode !== BindingMode.default) {\n                mode = bindable.mode;\n            }\n            else {\n                mode = defaultBindingMode;\n            }\n            isPrimary = bindable.primary === true;\n            bindableInfo = info.bindables[prop] = new BindableInfo(prop, mode);\n            if (isPrimary) {\n                if (hasPrimary) {\n                    throw new Error('primary already exists');\n                }\n                hasPrimary = true;\n                info.bindable = bindableInfo;\n            }\n            // set to first bindable by convention\n            if (info.bindable === null) {\n                info.bindable = bindableInfo;\n            }\n        }\n        // if no bindables are present, default to \"value\"\n        if (info.bindable === null) {\n            info.bindable = new BindableInfo('value', defaultBindingMode);\n        }\n        return info;\n    }\n}\nconst contextLookup = new WeakMap();\n/**\n * A pre-processed piece of information about declared custom elements, attributes and\n * binding commands, optimized for consumption by the template compiler.\n */\nexport class ResourceModel {\n    constructor(container) {\n        this.elementLookup = Object.create(null);\n        this.attributeLookup = Object.create(null);\n        this.commandLookup = Object.create(null);\n        // Note: don't do this sort of thing elsewhere, this is purely for perf reasons\n        this.container = container;\n        const rootContainer = container.root;\n        this.resourceResolvers = container.resourceResolvers;\n        this.rootResourceResolvers = rootContainer.resourceResolvers;\n    }\n    static getOrCreate(context) {\n        let model = contextLookup.get(context);\n        if (model === void 0) {\n            contextLookup.set(context, model = new ResourceModel(context));\n        }\n        return model;\n    }\n    /**\n     * Retrieve information about a custom element resource.\n     *\n     * @param element - The original DOM element.\n     *\n     * @returns The resource information if the element exists, or `null` if it does not exist.\n     */\n    getElementInfo(name) {\n        let result = this.elementLookup[name];\n        if (result === void 0) {\n            const def = this.find(CustomElement, name);\n            this.elementLookup[name] = result = def === null ? null : ElementInfo.from(def);\n        }\n        return result;\n    }\n    /**\n     * Retrieve information about a custom attribute resource.\n     *\n     * @param syntax - The parsed `AttrSyntax`\n     *\n     * @returns The resource information if the attribute exists, or `null` if it does not exist.\n     */\n    getAttributeInfo(syntax) {\n        let result = this.attributeLookup[syntax.target];\n        if (result === void 0) {\n            const def = this.find(CustomAttribute, syntax.target);\n            this.attributeLookup[syntax.target] = result = def === null ? null : AttrInfo.from(def);\n        }\n        return result;\n    }\n    /**\n     * Retrieve a binding command resource.\n     *\n     * @param name - The parsed `AttrSyntax`\n     *\n     * @returns An instance of the command if it exists, or `null` if it does not exist.\n     */\n    getBindingCommand(syntax, optional) {\n        const name = syntax.command;\n        if (name === null) {\n            return null;\n        }\n        let result = this.commandLookup[name];\n        if (result === void 0) {\n            result = this.create(BindingCommand, name);\n            if (result === null) {\n                if (optional) {\n                    return null;\n                }\n                throw new Error(`Unknown binding command: ${name}`);\n            }\n            this.commandLookup[name] = result;\n        }\n        return result;\n    }\n    find(kind, name) {\n        const key = kind.keyFrom(name);\n        let resolver = this.resourceResolvers[key];\n        if (resolver === void 0) {\n            resolver = this.rootResourceResolvers[key];\n            if (resolver === void 0) {\n                return null;\n            }\n        }\n        if (resolver === null) {\n            return null;\n        }\n        if (typeof resolver.getFactory === 'function') {\n            const factory = resolver.getFactory(this.container);\n            if (factory === null || factory === void 0) {\n                return null;\n            }\n            const definition = Metadata.getOwn(kind.name, factory.Type);\n            if (definition === void 0) {\n                // TODO: we may want to log a warning here, or even throw. This would happen if a dependency is registered with a resource-like key\n                // but does not actually have a definition associated via the type's metadata. That *should* generally not happen.\n                return null;\n            }\n            return definition;\n        }\n        return null;\n    }\n    create(kind, name) {\n        const key = kind.keyFrom(name);\n        let resolver = this.resourceResolvers[key];\n        if (resolver === void 0) {\n            resolver = this.rootResourceResolvers[key];\n            if (resolver === void 0) {\n                return null;\n            }\n        }\n        if (resolver === null) {\n            return null;\n        }\n        const instance = resolver.resolve(this.container, this.container);\n        if (instance === void 0) {\n            return null;\n        }\n        return instance;\n    }\n}\n//# sourceMappingURL=resource-model.js.map","export { AttrSyntax } from './ast';\nexport { IAttributeParser } from './attribute-parser';\nexport { attributePattern, IAttributePattern, AttributePattern, Interpretation, ISyntaxInterpreter, } from './attribute-pattern';\nexport { AtPrefixedTriggerAttributePattern, ColonPrefixedBindAttributePattern, DotSeparatedAttributePattern, RefAttributePattern, } from './attribute-patterns';\nexport { bindingCommand, BindingCommand, BindingCommandDefinition, getTarget, } from './binding-command';\nexport { CallBindingCommand, DefaultBindingCommand, ForBindingCommand, FromViewBindingCommand, OneTimeBindingCommand, ToViewBindingCommand, TwoWayBindingCommand } from './binding-commands';\nexport { IExpressionParserRegistration, DefaultComponents, RefAttributePatternRegistration, DotSeparatedAttributePatternRegistration, DefaultBindingSyntax, AtPrefixedTriggerAttributePatternRegistration, ColonPrefixedBindAttributePatternRegistration, ShortHandBindingSyntax, CallBindingCommandRegistration, DefaultBindingCommandRegistration, ForBindingCommandRegistration, FromViewBindingCommandRegistration, OneTimeBindingCommandRegistration, ToViewBindingCommandRegistration, TwoWayBindingCommandRegistration, DefaultBindingLanguage, JitConfiguration } from './configuration';\nexport { Access, Precedence, Char, } from './common';\nexport { parseExpression, parse, ParserState, } from './expression-parser';\nexport { ResourceModel, BindableInfo, ElementInfo, AttrInfo } from './resource-model';\nexport { BindingSymbol, CustomAttributeSymbol, CustomElementSymbol, LetElementSymbol, PlainAttributeSymbol, PlainElementSymbol, ReplacePartSymbol, SymbolFlags, TemplateControllerSymbol, TextSymbol, } from './semantic-model';\n//# sourceMappingURL=index.js.map","import { hasBind, hasUnbind } from '@aurelia/runtime';\n/**\n * Listener binding. Handle event binding between view and view model\n */\nexport class Listener {\n    constructor(dom, targetEvent, delegationStrategy, sourceExpression, target, preventDefault, eventManager, locator) {\n        this.dom = dom;\n        this.targetEvent = targetEvent;\n        this.delegationStrategy = delegationStrategy;\n        this.sourceExpression = sourceExpression;\n        this.target = target;\n        this.preventDefault = preventDefault;\n        this.eventManager = eventManager;\n        this.locator = locator;\n        this.interceptor = this;\n        this.$state = 0 /* none */;\n    }\n    callSource(event) {\n        const overrideContext = this.$scope.overrideContext;\n        overrideContext.$event = event;\n        const result = this.sourceExpression.evaluate(2097152 /* mustEvaluate */, this.$scope, this.locator, this.part);\n        Reflect.deleteProperty(overrideContext, '$event');\n        if (result !== true && this.preventDefault) {\n            event.preventDefault();\n        }\n        return result;\n    }\n    handleEvent(event) {\n        this.interceptor.callSource(event);\n    }\n    $bind(flags, scope, part) {\n        if (this.$state & 4 /* isBound */) {\n            if (this.$scope === scope) {\n                return;\n            }\n            this.interceptor.$unbind(flags | 4096 /* fromBind */);\n        }\n        // add isBinding flag\n        this.$state |= 1 /* isBinding */;\n        this.$scope = scope;\n        this.part = part;\n        const sourceExpression = this.sourceExpression;\n        if (hasBind(sourceExpression)) {\n            sourceExpression.bind(flags, scope, this.interceptor);\n        }\n        this.handler = this.eventManager.addEventListener(this.dom, this.target, this.targetEvent, this.interceptor, this.delegationStrategy);\n        // add isBound flag and remove isBinding flag\n        this.$state |= 4 /* isBound */;\n        this.$state &= ~1 /* isBinding */;\n    }\n    $unbind(flags) {\n        if (!(this.$state & 4 /* isBound */)) {\n            return;\n        }\n        // add isUnbinding flag\n        this.$state |= 2 /* isUnbinding */;\n        const sourceExpression = this.sourceExpression;\n        if (hasUnbind(sourceExpression)) {\n            sourceExpression.unbind(flags, this.$scope, this.interceptor);\n        }\n        this.$scope = null;\n        this.handler.dispose();\n        this.handler = null;\n        // remove isBound and isUnbinding flags\n        this.$state &= ~(4 /* isBound */ | 2 /* isUnbinding */);\n    }\n    observeProperty(flags, obj, propertyName) {\n        return;\n    }\n    handleChange(newValue, previousValue, flags) {\n        return;\n    }\n}\n//# sourceMappingURL=listener.js.map","import { __decorate, __metadata } from \"tslib\";\nimport { DOM, IObserverLocator, subscriberCollection, IScheduler, } from '@aurelia/runtime';\n/**\n * Observer for handling two-way binding with attributes\n * Has different strategy for class/style and normal attributes\n * TODO: handle SVG/attributes with namespace\n */\nlet AttributeObserver = class AttributeObserver {\n    constructor(scheduler, flags, observerLocator, obj, propertyKey, targetAttribute) {\n        this.scheduler = scheduler;\n        this.observerLocator = observerLocator;\n        this.obj = obj;\n        this.propertyKey = propertyKey;\n        this.targetAttribute = targetAttribute;\n        this.currentValue = null;\n        this.oldValue = null;\n        this.hasChanges = false;\n        this.task = null;\n        this.persistentFlags = flags & 805306383 /* targetObserverFlags */;\n    }\n    getValue() {\n        return this.currentValue;\n    }\n    setValue(newValue, flags) {\n        this.currentValue = newValue;\n        this.hasChanges = newValue !== this.oldValue;\n        if ((flags & 4096 /* fromBind */) > 0 || this.persistentFlags === 268435456 /* noTargetObserverQueue */) {\n            this.flushChanges(flags);\n        }\n        else if (this.persistentFlags !== 536870912 /* persistentTargetObserverQueue */ && this.task === null) {\n            this.task = this.scheduler.queueRenderTask(() => {\n                this.flushChanges(flags);\n                this.task = null;\n            });\n        }\n    }\n    flushChanges(flags) {\n        if (this.hasChanges) {\n            this.hasChanges = false;\n            const { currentValue } = this;\n            this.oldValue = currentValue;\n            switch (this.targetAttribute) {\n                case 'class': {\n                    // Why is class attribute observer setValue look different with class attribute accessor?\n                    // ==============\n                    // For class list\n                    // newValue is simply checked if truthy or falsy\n                    // and toggle the class accordingly\n                    // -- the rule of this is quite different to normal attribute\n                    //\n                    // for class attribute, observer is different in a way that it only observe a particular class at a time\n                    // this also comes from syntax, where it would typically be my-class.class=\"someProperty\"\n                    //\n                    // so there is no need for separating class by space and add all of them like class accessor\n                    if (!!currentValue) {\n                        this.obj.classList.add(this.propertyKey);\n                    }\n                    else {\n                        this.obj.classList.remove(this.propertyKey);\n                    }\n                    break;\n                }\n                case 'style': {\n                    let priority = '';\n                    let newValue = currentValue;\n                    if (typeof newValue === 'string' && newValue.includes('!important')) {\n                        priority = 'important';\n                        newValue = newValue.replace('!important', '');\n                    }\n                    this.obj.style.setProperty(this.propertyKey, newValue, priority);\n                }\n            }\n        }\n    }\n    handleMutation(mutationRecords) {\n        let shouldProcess = false;\n        for (let i = 0, ii = mutationRecords.length; ii > i; ++i) {\n            const record = mutationRecords[i];\n            if (record.type === 'attributes' && record.attributeName === this.propertyKey) {\n                shouldProcess = true;\n                break;\n            }\n        }\n        if (shouldProcess) {\n            let newValue;\n            switch (this.targetAttribute) {\n                case 'class':\n                    newValue = this.obj.classList.contains(this.propertyKey);\n                    break;\n                case 'style':\n                    newValue = this.obj.style.getPropertyValue(this.propertyKey);\n                    break;\n                default:\n                    throw new Error(`Unsupported targetAttribute: ${this.targetAttribute}`);\n            }\n            if (newValue !== this.currentValue) {\n                const { currentValue } = this;\n                this.currentValue = this.oldValue = newValue;\n                this.hasChanges = false;\n                this.callSubscribers(newValue, currentValue, 131072 /* fromDOMEvent */);\n            }\n        }\n    }\n    subscribe(subscriber) {\n        if (!this.hasSubscribers()) {\n            this.currentValue = this.oldValue = this.obj.getAttribute(this.propertyKey);\n            startObservation(this.obj, this);\n        }\n        this.addSubscriber(subscriber);\n    }\n    unsubscribe(subscriber) {\n        this.removeSubscriber(subscriber);\n        if (!this.hasSubscribers()) {\n            stopObservation(this.obj, this);\n        }\n    }\n    bind(flags) {\n        if (this.persistentFlags === 536870912 /* persistentTargetObserverQueue */) {\n            if (this.task !== null) {\n                this.task.cancel();\n            }\n            this.task = this.scheduler.queueRenderTask(() => this.flushChanges(flags), { persistent: true });\n        }\n    }\n    unbind(flags) {\n        if (this.task !== null) {\n            this.task.cancel();\n            this.task = null;\n        }\n    }\n};\nAttributeObserver = __decorate([\n    subscriberCollection(),\n    __metadata(\"design:paramtypes\", [Object, Number, Object, Object, String, String])\n], AttributeObserver);\nexport { AttributeObserver };\nconst startObservation = (element, subscription) => {\n    if (element.$eMObservers === undefined) {\n        element.$eMObservers = new Set();\n    }\n    if (element.$mObserver === undefined) {\n        element.$mObserver = DOM.createNodeObserver(element, handleMutation, { attributes: true });\n    }\n    element.$eMObservers.add(subscription);\n};\nconst stopObservation = (element, subscription) => {\n    const $eMObservers = element.$eMObservers;\n    if ($eMObservers && $eMObservers.delete(subscription)) {\n        if ($eMObservers.size === 0) {\n            element.$mObserver.disconnect();\n            element.$mObserver = undefined;\n        }\n        return true;\n    }\n    return false;\n};\nconst handleMutation = (mutationRecords) => {\n    mutationRecords[0].target.$eMObservers.forEach(invokeHandleMutation, mutationRecords);\n};\nfunction invokeHandleMutation(s) {\n    s.handleMutation(this);\n}\n//# sourceMappingURL=element-attribute-observer.js.map","import { __decorate, __metadata } from \"tslib\";\nimport { IServiceLocator, Reporter, } from '@aurelia/kernel';\nimport { BindingMode, connectable, hasBind, hasUnbind, IObserverLocator, IScheduler, INode, } from '@aurelia/runtime';\nimport { AttributeObserver, } from '../observation/element-attribute-observer';\n// BindingMode is not a const enum (and therefore not inlined), so assigning them to a variable to save a member accessor is a minor perf tweak\nconst { oneTime, toView, fromView } = BindingMode;\n// pre-combining flags for bitwise checks is a minor perf tweak\nconst toViewOrOneTime = toView | oneTime;\n/**\n * Attribute binding. Handle attribute binding betwen view/view model. Understand Html special attributes\n */\nlet AttributeBinding = class AttributeBinding {\n    constructor(sourceExpression, target, \n    // some attributes may have inner structure\n    // such as class -> collection of class names\n    // such as style -> collection of style rules\n    //\n    // for normal attributes, targetAttribute and targetProperty are the same and can be ignore\n    targetAttribute, targetProperty, mode, observerLocator, locator) {\n        this.sourceExpression = sourceExpression;\n        this.targetAttribute = targetAttribute;\n        this.targetProperty = targetProperty;\n        this.mode = mode;\n        this.observerLocator = observerLocator;\n        this.locator = locator;\n        this.interceptor = this;\n        this.$state = 0 /* none */;\n        this.$scope = null;\n        this.persistentFlags = 0 /* none */;\n        this.target = target;\n        connectable.assignIdTo(this);\n        this.$scheduler = locator.get(IScheduler);\n    }\n    updateTarget(value, flags) {\n        flags |= this.persistentFlags;\n        this.targetObserver.setValue(value, flags | 16 /* updateTargetInstance */);\n    }\n    updateSource(value, flags) {\n        flags |= this.persistentFlags;\n        this.sourceExpression.assign(flags | 32 /* updateSourceExpression */, this.$scope, this.locator, value);\n    }\n    handleChange(newValue, _previousValue, flags) {\n        if (!(this.$state & 4 /* isBound */)) {\n            return;\n        }\n        flags |= this.persistentFlags;\n        if (this.mode === BindingMode.fromView) {\n            flags &= ~16 /* updateTargetInstance */;\n            flags |= 32 /* updateSourceExpression */;\n        }\n        if (flags & 16 /* updateTargetInstance */) {\n            const previousValue = this.targetObserver.getValue();\n            // if the only observable is an AccessScope then we can assume the passed-in newValue is the correct and latest value\n            if (this.sourceExpression.$kind !== 10082 /* AccessScope */ || this.observerSlots > 1) {\n                newValue = this.sourceExpression.evaluate(flags, this.$scope, this.locator, this.part);\n            }\n            if (newValue !== previousValue) {\n                this.interceptor.updateTarget(newValue, flags);\n            }\n            if ((this.mode & oneTime) === 0) {\n                this.version++;\n                this.sourceExpression.connect(flags, this.$scope, this.interceptor, this.part);\n                this.interceptor.unobserve(false);\n            }\n            return;\n        }\n        if (flags & 32 /* updateSourceExpression */) {\n            if (newValue !== this.sourceExpression.evaluate(flags, this.$scope, this.locator, this.part)) {\n                this.interceptor.updateSource(newValue, flags);\n            }\n            return;\n        }\n        throw Reporter.error(15, flags);\n    }\n    $bind(flags, scope, part) {\n        if (this.$state & 4 /* isBound */) {\n            if (this.$scope === scope) {\n                return;\n            }\n            this.interceptor.$unbind(flags | 4096 /* fromBind */);\n        }\n        // add isBinding flag\n        this.$state |= 1 /* isBinding */;\n        // Store flags which we can only receive during $bind and need to pass on\n        // to the AST during evaluate/connect/assign\n        this.persistentFlags = flags & 2080374799 /* persistentBindingFlags */;\n        this.$scope = scope;\n        this.part = part;\n        let sourceExpression = this.sourceExpression;\n        if (hasBind(sourceExpression)) {\n            sourceExpression.bind(flags, scope, this.interceptor);\n        }\n        let targetObserver = this.targetObserver;\n        if (!targetObserver) {\n            targetObserver = this.targetObserver = new AttributeObserver(this.$scheduler, flags, this.observerLocator, this.target, this.targetProperty, this.targetAttribute);\n        }\n        if (targetObserver.bind) {\n            targetObserver.bind(flags);\n        }\n        // during bind, binding behavior might have changed sourceExpression\n        sourceExpression = this.sourceExpression;\n        if (this.mode & toViewOrOneTime) {\n            this.interceptor.updateTarget(sourceExpression.evaluate(flags, scope, this.locator, part), flags);\n        }\n        if (this.mode & toView) {\n            sourceExpression.connect(flags, scope, this, part);\n        }\n        if (this.mode & fromView) {\n            targetObserver[this.id] |= 32 /* updateSourceExpression */;\n            targetObserver.subscribe(this.interceptor);\n        }\n        // add isBound flag and remove isBinding flag\n        this.$state |= 4 /* isBound */;\n        this.$state &= ~1 /* isBinding */;\n    }\n    $unbind(flags) {\n        if (!(this.$state & 4 /* isBound */)) {\n            return;\n        }\n        // add isUnbinding flag\n        this.$state |= 2 /* isUnbinding */;\n        // clear persistent flags\n        this.persistentFlags = 0 /* none */;\n        if (hasUnbind(this.sourceExpression)) {\n            this.sourceExpression.unbind(flags, this.$scope, this.interceptor);\n        }\n        this.$scope = null;\n        if (this.targetObserver.unbind) {\n            this.targetObserver.unbind(flags);\n        }\n        if (this.targetObserver.unsubscribe) {\n            this.targetObserver.unsubscribe(this.interceptor);\n            this.targetObserver[this.id] &= ~32 /* updateSourceExpression */;\n        }\n        this.interceptor.unobserve(true);\n        // remove isBound and isUnbinding flags\n        this.$state &= ~(4 /* isBound */ | 2 /* isUnbinding */);\n    }\n    connect(flags) {\n        if (this.$state & 4 /* isBound */) {\n            flags |= this.persistentFlags;\n            this.sourceExpression.connect(flags | 2097152 /* mustEvaluate */, this.$scope, this.interceptor, this.part); // why do we have a connect method here in the first place? will this be called after bind?\n        }\n    }\n};\nAttributeBinding = __decorate([\n    connectable(),\n    __metadata(\"design:paramtypes\", [Object, Object, String, String, Number, Object, Object])\n], AttributeBinding);\nexport { AttributeBinding };\n//# sourceMappingURL=attribute.js.map","/**\n * Attribute accessor in a XML document/element that can be accessed via a namespace.\n * Wraps [`getAttributeNS`](https://developer.mozilla.org/en-US/docs/Web/API/Element/getAttributeNS).\n */\nexport class AttributeNSAccessor {\n    constructor(scheduler, flags, obj, propertyKey, namespace) {\n        this.scheduler = scheduler;\n        this.propertyKey = propertyKey;\n        this.namespace = namespace;\n        this.currentValue = null;\n        this.oldValue = null;\n        this.hasChanges = false;\n        this.task = null;\n        this.obj = obj;\n        this.persistentFlags = flags & 805306383 /* targetObserverFlags */;\n    }\n    getValue() {\n        return this.currentValue;\n    }\n    setValue(newValue, flags) {\n        this.currentValue = newValue;\n        this.hasChanges = newValue !== this.oldValue;\n        if ((flags & 4096 /* fromBind */) > 0 || this.persistentFlags === 268435456 /* noTargetObserverQueue */) {\n            this.flushChanges(flags);\n        }\n        else if (this.persistentFlags !== 536870912 /* persistentTargetObserverQueue */ && this.task === null) {\n            this.task = this.scheduler.queueRenderTask(() => {\n                this.flushChanges(flags);\n                this.task = null;\n            });\n        }\n    }\n    flushChanges(flags) {\n        if (this.hasChanges) {\n            this.hasChanges = false;\n            const { currentValue } = this;\n            this.oldValue = currentValue;\n            if (currentValue == void 0) {\n                this.obj.removeAttributeNS(this.namespace, this.propertyKey);\n            }\n            else {\n                this.obj.setAttributeNS(this.namespace, this.propertyKey, currentValue);\n            }\n        }\n    }\n    bind(flags) {\n        if (this.persistentFlags === 536870912 /* persistentTargetObserverQueue */) {\n            if (this.task !== null) {\n                this.task.cancel();\n            }\n            this.task = this.scheduler.queueRenderTask(() => this.flushChanges(flags), { persistent: true });\n        }\n        this.currentValue = this.oldValue = this.obj.getAttributeNS(this.namespace, this.propertyKey);\n    }\n    unbind(flags) {\n        if (this.task !== null) {\n            this.task.cancel();\n            this.task = null;\n        }\n    }\n}\n//# sourceMappingURL=attribute-ns-accessor.js.map","import { __decorate, __metadata } from \"tslib\";\nimport { IObserverLocator, subscriberCollection, IScheduler, } from '@aurelia/runtime';\nfunction defaultMatcher(a, b) {\n    return a === b;\n}\nlet CheckedObserver = class CheckedObserver {\n    constructor(scheduler, flags, observerLocator, handler, obj) {\n        this.scheduler = scheduler;\n        this.observerLocator = observerLocator;\n        this.handler = handler;\n        this.obj = obj;\n        this.currentValue = void 0;\n        this.oldValue = void 0;\n        this.hasChanges = false;\n        this.task = null;\n        this.arrayObserver = void 0;\n        this.valueObserver = void 0;\n        this.persistentFlags = flags & 805306383 /* targetObserverFlags */;\n    }\n    getValue() {\n        return this.currentValue;\n    }\n    setValue(newValue, flags) {\n        this.currentValue = newValue;\n        this.hasChanges = newValue !== this.oldValue;\n        if ((flags & 4096 /* fromBind */) > 0 || this.persistentFlags === 268435456 /* noTargetObserverQueue */) {\n            this.flushChanges(flags);\n        }\n        else if (this.persistentFlags !== 536870912 /* persistentTargetObserverQueue */ && this.task === null) {\n            this.task = this.scheduler.queueRenderTask(() => {\n                this.flushChanges(flags);\n                this.task = null;\n            });\n        }\n    }\n    flushChanges(flags) {\n        if (this.hasChanges) {\n            this.hasChanges = false;\n            const currentValue = this.currentValue;\n            this.oldValue = currentValue;\n            if (this.valueObserver === void 0) {\n                if (this.obj.$observers !== void 0) {\n                    if (this.obj.$observers.model !== void 0) {\n                        this.valueObserver = this.obj.$observers.model;\n                    }\n                    else if (this.obj.$observers.value !== void 0) {\n                        this.valueObserver = this.obj.$observers.value;\n                    }\n                }\n                if (this.valueObserver !== void 0) {\n                    this.valueObserver.subscribe(this);\n                }\n            }\n            if (this.arrayObserver !== void 0) {\n                this.arrayObserver.unsubscribeFromCollection(this);\n                this.arrayObserver = void 0;\n            }\n            if (this.obj.type === 'checkbox' && Array.isArray(currentValue)) {\n                this.arrayObserver = this.observerLocator.getArrayObserver(flags, currentValue);\n                this.arrayObserver.subscribeToCollection(this);\n            }\n            this.synchronizeElement();\n        }\n    }\n    handleCollectionChange(indexMap, flags) {\n        const { currentValue, oldValue } = this;\n        if ((flags & 4096 /* fromBind */) > 0 || this.persistentFlags === 268435456 /* noTargetObserverQueue */) {\n            this.oldValue = currentValue;\n            this.synchronizeElement();\n        }\n        else {\n            this.hasChanges = true;\n        }\n        if (this.persistentFlags !== 536870912 /* persistentTargetObserverQueue */ && this.task === null) {\n            this.task = this.scheduler.queueRenderTask(() => {\n                this.flushChanges(flags);\n                this.task = null;\n            });\n        }\n        this.callSubscribers(currentValue, oldValue, flags);\n    }\n    handleChange(newValue, previousValue, flags) {\n        if ((flags & 4096 /* fromBind */) > 0 || this.persistentFlags === 268435456 /* noTargetObserverQueue */) {\n            this.synchronizeElement();\n        }\n        else {\n            this.hasChanges = true;\n        }\n        if (this.persistentFlags !== 536870912 /* persistentTargetObserverQueue */ && this.task === null) {\n            this.task = this.scheduler.queueRenderTask(() => this.flushChanges(flags));\n        }\n        this.callSubscribers(newValue, previousValue, flags);\n    }\n    synchronizeElement() {\n        const currentValue = this.currentValue;\n        const obj = this.obj;\n        const elementValue = Object.prototype.hasOwnProperty.call(obj, 'model') ? obj.model : obj.value;\n        const isRadio = obj.type === 'radio';\n        const matcher = obj.matcher !== void 0 ? obj.matcher : defaultMatcher;\n        if (isRadio) {\n            obj.checked = !!matcher(currentValue, elementValue);\n        }\n        else if (currentValue === true) {\n            obj.checked = true;\n        }\n        else if (Array.isArray(currentValue)) {\n            obj.checked = currentValue.findIndex(item => !!matcher(item, elementValue)) !== -1;\n        }\n        else {\n            obj.checked = false;\n        }\n    }\n    handleEvent() {\n        this.oldValue = this.currentValue;\n        let { currentValue } = this;\n        const { obj } = this;\n        const elementValue = Object.prototype.hasOwnProperty.call(obj, 'model') ? obj.model : obj.value;\n        let index;\n        const matcher = obj.matcher !== void 0 ? obj.matcher : defaultMatcher;\n        if (obj.type === 'checkbox') {\n            if (Array.isArray(currentValue)) {\n                index = currentValue.findIndex(item => !!matcher(item, elementValue));\n                if (obj.checked && index === -1) {\n                    currentValue.push(elementValue);\n                }\n                else if (!obj.checked && index !== -1) {\n                    currentValue.splice(index, 1);\n                }\n                // when existing currentValue is array, do not invoke callback as only the array obj has changed\n                return;\n            }\n            currentValue = obj.checked;\n        }\n        else if (obj.checked) {\n            currentValue = elementValue;\n        }\n        else {\n            return;\n        }\n        this.currentValue = currentValue;\n        this.callSubscribers(this.currentValue, this.oldValue, 131072 /* fromDOMEvent */ | 524288 /* allowPublishRoundtrip */);\n    }\n    bind(flags) {\n        if (this.persistentFlags === 536870912 /* persistentTargetObserverQueue */) {\n            if (this.task !== null) {\n                this.task.cancel();\n            }\n            this.task = this.scheduler.queueRenderTask(() => this.flushChanges(flags), { persistent: true });\n        }\n        this.currentValue = this.obj.checked;\n    }\n    unbind(flags) {\n        if (this.arrayObserver !== void 0) {\n            this.arrayObserver.unsubscribeFromCollection(this);\n            this.arrayObserver = void 0;\n        }\n        if (this.valueObserver !== void 0) {\n            this.valueObserver.unsubscribe(this);\n        }\n        if (this.task !== null) {\n            this.task.cancel();\n            this.task = null;\n        }\n    }\n    subscribe(subscriber) {\n        if (!this.hasSubscribers()) {\n            this.handler.subscribe(this.obj, this);\n        }\n        this.addSubscriber(subscriber);\n    }\n    unsubscribe(subscriber) {\n        this.removeSubscriber(subscriber);\n        if (!this.hasSubscribers()) {\n            this.handler.dispose();\n        }\n    }\n};\nCheckedObserver = __decorate([\n    subscriberCollection(),\n    __metadata(\"design:paramtypes\", [Object, Number, Object, Object, Object])\n], CheckedObserver);\nexport { CheckedObserver };\n//# sourceMappingURL=checked-observer.js.map","import { PLATFORM } from '@aurelia/kernel';\nexport class ClassAttributeAccessor {\n    constructor(scheduler, flags, obj) {\n        this.scheduler = scheduler;\n        this.currentValue = '';\n        this.oldValue = '';\n        this.doNotCache = true;\n        this.nameIndex = {};\n        this.version = 0;\n        this.hasChanges = false;\n        this.isActive = false;\n        this.task = null;\n        this.obj = obj;\n        this.persistentFlags = flags & 805306383 /* targetObserverFlags */;\n    }\n    getValue() {\n        return this.currentValue;\n    }\n    setValue(newValue, flags) {\n        this.currentValue = newValue;\n        this.hasChanges = newValue !== this.oldValue;\n        if ((flags & 4096 /* fromBind */) > 0 || this.persistentFlags === 268435456 /* noTargetObserverQueue */) {\n            this.flushChanges(flags);\n        }\n        else if (this.persistentFlags !== 536870912 /* persistentTargetObserverQueue */ && this.task === null) {\n            this.task = this.scheduler.queueRenderTask(() => {\n                this.flushChanges(flags);\n                this.task = null;\n            });\n        }\n    }\n    flushChanges(flags) {\n        if (this.hasChanges) {\n            this.hasChanges = false;\n            const { currentValue, nameIndex } = this;\n            let { version } = this;\n            this.oldValue = currentValue;\n            const classesToAdd = getClassesToAdd(currentValue);\n            // Get strings split on a space not including empties\n            if (classesToAdd.length > 0) {\n                this.addClassesAndUpdateIndex(classesToAdd);\n            }\n            this.version += 1;\n            // First call to setValue?  We're done.\n            if (version === 0) {\n                return;\n            }\n            // Remove classes from previous version.\n            version -= 1;\n            for (const name in nameIndex) {\n                if (!Object.prototype.hasOwnProperty.call(nameIndex, name) || nameIndex[name] !== version) {\n                    continue;\n                }\n                // TODO: this has the side-effect that classes already present which are added again,\n                // will be removed if they're not present in the next update.\n                // Better would be do have some configurability for this behavior, allowing the user to\n                // decide whether initial classes always need to be kept, always removed, or something in between\n                this.obj.classList.remove(name);\n            }\n        }\n    }\n    bind(flags) {\n        if (this.persistentFlags === 536870912 /* persistentTargetObserverQueue */) {\n            if (this.task !== null) {\n                this.task.cancel();\n            }\n            this.task = this.scheduler.queueRenderTask(() => this.flushChanges(flags), { persistent: true });\n        }\n    }\n    unbind(flags) {\n        if (this.task !== null) {\n            this.task.cancel();\n            this.task = null;\n        }\n    }\n    addClassesAndUpdateIndex(classes) {\n        const node = this.obj;\n        for (let i = 0, ii = classes.length; i < ii; i++) {\n            const className = classes[i];\n            if (className.length === 0) {\n                continue;\n            }\n            this.nameIndex[className] = this.version;\n            node.classList.add(className);\n        }\n    }\n}\nexport function getClassesToAdd(object) {\n    function splitClassString(classString) {\n        const matches = classString.match(/\\S+/g);\n        if (matches === null) {\n            return PLATFORM.emptyArray;\n        }\n        return matches;\n    }\n    if (typeof object === 'string') {\n        return splitClassString(object);\n    }\n    if (object instanceof Array) {\n        const len = object.length;\n        if (len > 0) {\n            const classes = [];\n            for (let i = 0; i < len; ++i) {\n                classes.push(...getClassesToAdd(object[i]));\n            }\n            return classes;\n        }\n        else {\n            return PLATFORM.emptyArray;\n        }\n    }\n    else if (object instanceof Object) {\n        const classes = [];\n        for (const property in object) {\n            // Let non typical values also evaluate true so disable bool check\n            // eslint-disable-next-line @typescript-eslint/strict-boolean-expressions, no-extra-boolean-cast\n            if (Boolean(object[property])) {\n                // We must do this in case object property has a space in the name which results in two classes\n                if (property.includes(' ')) {\n                    classes.push(...splitClassString(property));\n                }\n                else {\n                    classes.push(property);\n                }\n            }\n        }\n        return classes;\n    }\n    return PLATFORM.emptyArray;\n}\n//# sourceMappingURL=class-attribute-accessor.js.map","/**\n * Attribute accessor for HTML elements.\n * Note that Aurelia works with properties, so in all case it will try to assign to property instead of attributes.\n * Unless the property falls into a special set, then it will use attribute for it.\n *\n * @see ElementPropertyAccessor\n */\nexport class DataAttributeAccessor {\n    constructor(scheduler, flags, obj, propertyKey) {\n        this.scheduler = scheduler;\n        this.propertyKey = propertyKey;\n        this.currentValue = null;\n        this.oldValue = null;\n        this.hasChanges = false;\n        this.task = null;\n        this.obj = obj;\n        this.persistentFlags = flags & 805306383 /* targetObserverFlags */;\n    }\n    getValue() {\n        return this.currentValue;\n    }\n    setValue(newValue, flags) {\n        this.currentValue = newValue;\n        this.hasChanges = newValue !== this.oldValue;\n        if ((flags & 4096 /* fromBind */) > 0 || this.persistentFlags === 268435456 /* noTargetObserverQueue */) {\n            this.flushChanges(flags);\n        }\n        else if (this.persistentFlags !== 536870912 /* persistentTargetObserverQueue */ && this.task === null) {\n            this.task = this.scheduler.queueRenderTask(() => {\n                this.flushChanges(flags);\n                this.task = null;\n            });\n        }\n    }\n    flushChanges(flags) {\n        if (this.hasChanges) {\n            this.hasChanges = false;\n            const { currentValue } = this;\n            this.oldValue = currentValue;\n            if (currentValue == void 0) {\n                this.obj.removeAttribute(this.propertyKey);\n            }\n            else {\n                this.obj.setAttribute(this.propertyKey, currentValue);\n            }\n        }\n    }\n    bind(flags) {\n        if (this.persistentFlags === 536870912 /* persistentTargetObserverQueue */) {\n            if (this.task !== null) {\n                this.task.cancel();\n            }\n            this.task = this.scheduler.queueRenderTask(() => this.flushChanges(flags), { persistent: true });\n        }\n        this.currentValue = this.oldValue = this.obj.getAttribute(this.propertyKey);\n    }\n    unbind(flags) {\n        if (this.task !== null) {\n            this.task.cancel();\n            this.task = null;\n        }\n    }\n}\n//# sourceMappingURL=data-attribute-accessor.js.map","/**\n * Property accessor for HTML Elements.\n * Note that Aurelia works with properties, so in all case it will try to assign to property instead of attributes.\n * Unless the property falls into a special set, then it will use attribute for it.\n *\n * @see DataAttributeAccessor\n */\nexport class ElementPropertyAccessor {\n    constructor(scheduler, flags, obj, propertyKey) {\n        this.scheduler = scheduler;\n        this.obj = obj;\n        this.propertyKey = propertyKey;\n        this.currentValue = void 0;\n        this.oldValue = void 0;\n        this.hasChanges = false;\n        this.task = null;\n        this.persistentFlags = flags & 805306383 /* targetObserverFlags */;\n    }\n    getValue() {\n        return this.currentValue;\n    }\n    setValue(newValue, flags) {\n        this.currentValue = newValue;\n        this.hasChanges = newValue !== this.oldValue;\n        if ((flags & 4096 /* fromBind */) > 0 || this.persistentFlags === 268435456 /* noTargetObserverQueue */) {\n            this.flushChanges(flags);\n        }\n        else if (this.persistentFlags !== 536870912 /* persistentTargetObserverQueue */ && this.task === null) {\n            this.task = this.scheduler.queueRenderTask(() => {\n                this.flushChanges(flags);\n                this.task = null;\n            });\n        }\n    }\n    flushChanges(flags) {\n        if (this.hasChanges) {\n            this.hasChanges = false;\n            const { currentValue } = this;\n            this.oldValue = currentValue;\n            this.obj[this.propertyKey] = currentValue;\n        }\n    }\n    bind(flags) {\n        if (this.persistentFlags === 536870912 /* persistentTargetObserverQueue */) {\n            if (this.task !== null) {\n                this.task.cancel();\n            }\n            this.task = this.scheduler.queueRenderTask(() => this.flushChanges(flags), { persistent: true });\n        }\n        this.currentValue = this.oldValue = this.obj[this.propertyKey];\n    }\n    unbind(flags) {\n        if (this.task !== null) {\n            this.task.cancel();\n            this.task = null;\n        }\n    }\n}\n//# sourceMappingURL=element-property-accessor.js.map","import { DI } from '@aurelia/kernel';\nimport { DelegationStrategy } from '@aurelia/runtime';\n// Note: path and deepPath are designed to handle v0 and v1 shadow dom specs respectively\n/** @internal */\nexport function findOriginalEventTarget(event) {\n    return (event.composedPath && event.composedPath()[0]) || (event.deepPath && event.deepPath()[0]) || (event.path && event.path[0]) || event.target;\n}\nfunction stopPropagation() {\n    this.standardStopPropagation();\n    this.propagationStopped = true;\n}\nfunction handleCapturedEvent(event) {\n    event.propagationStopped = false;\n    let target = findOriginalEventTarget(event);\n    const orderedCallbacks = [];\n    /**\n     * During capturing phase, event 'bubbles' down from parent. Needs to reorder callback from root down to target\n     */\n    while (target) {\n        if (target.capturedCallbacks) {\n            const callback = target.capturedCallbacks[event.type];\n            if (callback) {\n                if (event.stopPropagation !== stopPropagation) {\n                    event.standardStopPropagation = event.stopPropagation;\n                    event.stopPropagation = stopPropagation;\n                }\n                orderedCallbacks.push(callback);\n            }\n        }\n        target = target.parentNode;\n    }\n    for (let i = orderedCallbacks.length - 1; i >= 0 && !event.propagationStopped; i--) {\n        const orderedCallback = orderedCallbacks[i];\n        if ('handleEvent' in orderedCallback) {\n            orderedCallback.handleEvent(event);\n        }\n        else {\n            orderedCallback(event);\n        }\n    }\n}\nfunction handleDelegatedEvent(event) {\n    event.propagationStopped = false;\n    let target = findOriginalEventTarget(event);\n    while (target && !event.propagationStopped) {\n        if (target.delegatedCallbacks) {\n            const callback = target.delegatedCallbacks[event.type];\n            if (callback) {\n                if (event.stopPropagation !== stopPropagation) {\n                    event.standardStopPropagation = event.stopPropagation;\n                    event.stopPropagation = stopPropagation;\n                }\n                if ('handleEvent' in callback) {\n                    callback.handleEvent(event);\n                }\n                else {\n                    callback(event);\n                }\n            }\n        }\n        target = target.parentNode;\n    }\n}\nexport class ListenerTracker {\n    constructor(dom, eventName, listener, capture) {\n        this.dom = dom;\n        this.eventName = eventName;\n        this.listener = listener;\n        this.capture = capture;\n        this.count = 0;\n    }\n    increment() {\n        this.count++;\n        if (this.count === 1) {\n            this.dom.addEventListener(this.eventName, this.listener, null, this.capture);\n        }\n    }\n    decrement() {\n        this.count--;\n        if (this.count === 0) {\n            this.dom.removeEventListener(this.eventName, this.listener, null, this.capture);\n        }\n    }\n    /* @internal */\n    dispose() {\n        if (this.count > 0) {\n            this.count = 0;\n            this.dom.removeEventListener(this.eventName, this.listener, null, this.capture);\n        }\n    }\n}\n/**\n * Enable dispose() pattern for `delegate` & `capture` commands\n */\nexport class DelegateOrCaptureSubscription {\n    constructor(entry, lookup, targetEvent, callback) {\n        this.entry = entry;\n        this.lookup = lookup;\n        this.targetEvent = targetEvent;\n        lookup[targetEvent] = callback;\n    }\n    dispose() {\n        this.entry.decrement();\n        this.lookup[this.targetEvent] = null;\n    }\n}\n/**\n * Enable dispose() pattern for addEventListener for `trigger`\n */\nexport class TriggerSubscription {\n    constructor(dom, target, targetEvent, callback) {\n        this.dom = dom;\n        this.target = target;\n        this.targetEvent = targetEvent;\n        this.callback = callback;\n        dom.addEventListener(targetEvent, callback, target);\n    }\n    dispose() {\n        this.dom.removeEventListener(this.targetEvent, this.callback, this.target);\n    }\n}\nexport class EventSubscriber {\n    constructor(dom, events) {\n        this.dom = dom;\n        this.events = events;\n        this.target = null;\n        this.handler = null;\n    }\n    subscribe(node, callbackOrListener) {\n        this.target = node;\n        this.handler = callbackOrListener;\n        const add = this.dom.addEventListener;\n        const events = this.events;\n        for (let i = 0, ii = events.length; ii > i; ++i) {\n            add(events[i], callbackOrListener, node);\n        }\n    }\n    dispose() {\n        const node = this.target;\n        const callbackOrListener = this.handler;\n        const events = this.events;\n        const dom = this.dom;\n        for (let i = 0, ii = events.length; ii > i; ++i) {\n            dom.removeEventListener(events[i], callbackOrListener, node);\n        }\n        this.target = this.handler = null;\n    }\n}\nexport const IEventManager = DI.createInterface('IEventManager').withDefault(x => x.singleton(EventManager));\n/** @internal */\nexport class EventManager {\n    constructor() {\n        this.delegatedHandlers = {};\n        this.capturedHandlers = {};\n    }\n    addEventListener(dom, target, targetEvent, callbackOrListener, strategy) {\n        let delegatedHandlers;\n        let capturedHandlers;\n        let handlerEntry;\n        if (strategy === DelegationStrategy.bubbling) {\n            delegatedHandlers = this.delegatedHandlers;\n            handlerEntry = delegatedHandlers[targetEvent] || (delegatedHandlers[targetEvent] = new ListenerTracker(dom, targetEvent, handleDelegatedEvent, false));\n            handlerEntry.increment();\n            const delegatedCallbacks = target.delegatedCallbacks || (target.delegatedCallbacks = {});\n            return new DelegateOrCaptureSubscription(handlerEntry, delegatedCallbacks, targetEvent, callbackOrListener);\n        }\n        if (strategy === DelegationStrategy.capturing) {\n            capturedHandlers = this.capturedHandlers;\n            handlerEntry = capturedHandlers[targetEvent] || (capturedHandlers[targetEvent] = new ListenerTracker(dom, targetEvent, handleCapturedEvent, true));\n            handlerEntry.increment();\n            const capturedCallbacks = target.capturedCallbacks || (target.capturedCallbacks = {});\n            return new DelegateOrCaptureSubscription(handlerEntry, capturedCallbacks, targetEvent, callbackOrListener);\n        }\n        return new TriggerSubscription(dom, target, targetEvent, callbackOrListener);\n    }\n    dispose() {\n        let key;\n        const { delegatedHandlers, capturedHandlers } = this;\n        for (key in delegatedHandlers) {\n            delegatedHandlers[key].dispose();\n        }\n        for (key in capturedHandlers) {\n            capturedHandlers[key].dispose();\n        }\n    }\n}\n//# sourceMappingURL=event-manager.js.map","import { __decorate, __metadata } from \"tslib\";\nimport { IDOM, IObserverLocator, subscriberCollection, IScheduler, } from '@aurelia/runtime';\nimport { bound } from '@aurelia/kernel';\nconst childObserverOptions = {\n    childList: true,\n    subtree: true,\n    characterData: true\n};\nfunction defaultMatcher(a, b) {\n    return a === b;\n}\nlet SelectValueObserver = class SelectValueObserver {\n    constructor(scheduler, flags, observerLocator, dom, handler, obj) {\n        this.scheduler = scheduler;\n        this.observerLocator = observerLocator;\n        this.dom = dom;\n        this.handler = handler;\n        this.obj = obj;\n        this.currentValue = void 0;\n        this.oldValue = void 0;\n        this.hasChanges = false;\n        this.task = null;\n        this.arrayObserver = void 0;\n        this.nodeObserver = void 0;\n        this.persistentFlags = flags & 805306383 /* targetObserverFlags */;\n    }\n    getValue() {\n        return this.currentValue;\n    }\n    setValue(newValue, flags) {\n        this.currentValue = newValue;\n        this.hasChanges = newValue !== this.oldValue;\n        if ((flags & 4096 /* fromBind */) > 0 || this.persistentFlags === 268435456 /* noTargetObserverQueue */) {\n            this.flushChanges(flags);\n        }\n        else if (this.persistentFlags !== 536870912 /* persistentTargetObserverQueue */ && this.task === null) {\n            this.task = this.scheduler.queueRenderTask(() => {\n                this.flushChanges(flags);\n                this.task = null;\n            });\n        }\n    }\n    flushChanges(flags) {\n        if (this.hasChanges) {\n            this.hasChanges = false;\n            const { currentValue } = this;\n            this.oldValue = currentValue;\n            const isArray = Array.isArray(currentValue);\n            if (!isArray && currentValue != void 0 && this.obj.multiple) {\n                throw new Error('Only null or Array instances can be bound to a multi-select.');\n            }\n            if (this.arrayObserver) {\n                this.arrayObserver.unsubscribeFromCollection(this);\n                this.arrayObserver = void 0;\n            }\n            if (isArray) {\n                this.arrayObserver = this.observerLocator.getArrayObserver(flags, currentValue);\n                this.arrayObserver.subscribeToCollection(this);\n            }\n            this.synchronizeOptions();\n            this.notify(flags);\n        }\n    }\n    handleCollectionChange(indexMap, flags) {\n        if ((flags & 4096 /* fromBind */) > 0 || this.persistentFlags === 268435456 /* noTargetObserverQueue */) {\n            this.synchronizeOptions();\n        }\n        else {\n            this.hasChanges = true;\n        }\n        if (this.persistentFlags !== 536870912 /* persistentTargetObserverQueue */ && this.task === null) {\n            this.task = this.scheduler.queueRenderTask(() => {\n                this.flushChanges(flags);\n                this.task = null;\n            });\n        }\n        this.callSubscribers(this.currentValue, this.oldValue, flags);\n    }\n    handleChange(newValue, previousValue, flags) {\n        if ((flags & 4096 /* fromBind */) > 0 || this.persistentFlags === 268435456 /* noTargetObserverQueue */) {\n            this.synchronizeOptions();\n        }\n        else {\n            this.hasChanges = true;\n        }\n        if (this.persistentFlags !== 536870912 /* persistentTargetObserverQueue */ && this.task === null) {\n            this.task = this.scheduler.queueRenderTask(() => {\n                this.flushChanges(flags);\n                this.task = null;\n            });\n        }\n        this.callSubscribers(newValue, previousValue, flags);\n    }\n    notify(flags) {\n        if ((flags & 4096 /* fromBind */) > 0 || this.persistentFlags === 268435456 /* noTargetObserverQueue */) {\n            return;\n        }\n        const oldValue = this.oldValue;\n        const newValue = this.currentValue;\n        if (newValue === oldValue) {\n            return;\n        }\n        this.callSubscribers(newValue, oldValue, flags);\n    }\n    handleEvent() {\n        // \"from-view\" changes are always synchronous now, so immediately sync the value and notify subscribers\n        const shouldNotify = this.synchronizeValue();\n        if (shouldNotify) {\n            this.callSubscribers(this.currentValue, this.oldValue, 131072 /* fromDOMEvent */ | 524288 /* allowPublishRoundtrip */);\n        }\n    }\n    synchronizeOptions(indexMap) {\n        const { currentValue, obj } = this;\n        const isArray = Array.isArray(currentValue);\n        const matcher = obj.matcher !== void 0 ? obj.matcher : defaultMatcher;\n        const options = obj.options;\n        let i = options.length;\n        while (i-- > 0) {\n            const option = options[i];\n            const optionValue = Object.prototype.hasOwnProperty.call(option, 'model') ? option.model : option.value;\n            if (isArray) {\n                option.selected = currentValue.findIndex(item => !!matcher(optionValue, item)) !== -1;\n                continue;\n            }\n            option.selected = !!matcher(optionValue, currentValue);\n        }\n    }\n    synchronizeValue() {\n        // Spec for synchronizing value from `SelectObserver` to `<select/>`\n        // When synchronizing value to observed <select/> element, do the following steps:\n        // A. If `<select/>` is multiple\n        //    1. Check if current value, called `currentValue` is an array\n        //      a. If not an array, return true to signal value has changed\n        //      b. If is an array:\n        //        i. gather all current selected <option/>, in to array called `values`\n        //        ii. loop through the `currentValue` array and remove items that are nolonger selected based on matcher\n        //        iii. loop through the `values` array and add items that are selected based on matcher\n        //        iv. Return false to signal value hasn't changed\n        // B. If the select is single\n        //    1. Let `value` equal the first selected option, if no option selected, then `value` is `null`\n        //    2. assign `this.currentValue` to `this.oldValue`\n        //    3. assign `value` to `this.currentValue`\n        //    4. return `true` to signal value has changed\n        const obj = this.obj;\n        const options = obj.options;\n        const len = options.length;\n        const currentValue = this.currentValue;\n        let i = 0;\n        if (obj.multiple) {\n            // A.\n            if (!Array.isArray(currentValue)) {\n                // A.1.a\n                return true;\n            }\n            // A.1.b\n            // multi select\n            let option;\n            const matcher = obj.matcher || defaultMatcher;\n            // A.1.b.i\n            const values = [];\n            while (i < len) {\n                option = options[i];\n                if (option.selected) {\n                    values.push(Object.prototype.hasOwnProperty.call(option, 'model')\n                        ? option.model\n                        : option.value);\n                }\n                ++i;\n            }\n            // A.1.b.ii\n            i = 0;\n            while (i < currentValue.length) {\n                const a = currentValue[i];\n                // Todo: remove arrow fn\n                if (values.findIndex(b => !!matcher(a, b)) === -1) {\n                    currentValue.splice(i, 1);\n                }\n                else {\n                    ++i;\n                }\n            }\n            // A.1.b.iii\n            i = 0;\n            while (i < values.length) {\n                const a = values[i];\n                // Todo: remove arrow fn\n                if (currentValue.findIndex(b => !!matcher(a, b)) === -1) {\n                    currentValue.push(a);\n                }\n                ++i;\n            }\n            // A.1.b.iv\n            return false;\n        }\n        // B. single select\n        // B.1\n        let value = null;\n        while (i < len) {\n            const option = options[i];\n            if (option.selected) {\n                value = Object.prototype.hasOwnProperty.call(option, 'model')\n                    ? option.model\n                    : option.value;\n                break;\n            }\n            ++i;\n        }\n        // B.2\n        this.oldValue = this.currentValue;\n        // B.3\n        this.currentValue = value;\n        // B.4\n        return true;\n    }\n    bind(flags) {\n        this.nodeObserver = this.dom.createNodeObserver(this.obj, this.handleNodeChange, childObserverOptions);\n        if (this.persistentFlags === 536870912 /* persistentTargetObserverQueue */) {\n            if (this.task !== null) {\n                this.task.cancel();\n            }\n            this.task = this.scheduler.queueRenderTask(() => this.flushChanges(flags), { persistent: true });\n        }\n    }\n    unbind(flags) {\n        this.nodeObserver.disconnect();\n        this.nodeObserver = null;\n        if (this.task !== null) {\n            this.task.cancel();\n            this.task = null;\n        }\n        if (this.arrayObserver) {\n            this.arrayObserver.unsubscribeFromCollection(this);\n            this.arrayObserver = null;\n        }\n    }\n    handleNodeChange() {\n        this.synchronizeOptions();\n        const shouldNotify = this.synchronizeValue();\n        if (shouldNotify) {\n            this.notify(131072 /* fromDOMEvent */);\n        }\n    }\n    subscribe(subscriber) {\n        if (!this.hasSubscribers()) {\n            this.handler.subscribe(this.obj, this);\n        }\n        this.addSubscriber(subscriber);\n    }\n    unsubscribe(subscriber) {\n        this.removeSubscriber(subscriber);\n        if (!this.hasSubscribers()) {\n            this.handler.dispose();\n        }\n    }\n};\n__decorate([\n    bound,\n    __metadata(\"design:type\", Function),\n    __metadata(\"design:paramtypes\", []),\n    __metadata(\"design:returntype\", void 0)\n], SelectValueObserver.prototype, \"handleNodeChange\", null);\nSelectValueObserver = __decorate([\n    subscriberCollection(),\n    __metadata(\"design:paramtypes\", [Object, Number, Object, Object, Object, Object])\n], SelectValueObserver);\nexport { SelectValueObserver };\n//# sourceMappingURL=select-value-observer.js.map","import { PLATFORM, kebabCase } from '@aurelia/kernel';\nexport class StyleAttributeAccessor {\n    constructor(scheduler, flags, obj) {\n        this.scheduler = scheduler;\n        this.currentValue = '';\n        this.oldValue = '';\n        this.styles = {};\n        this.version = 0;\n        this.hasChanges = false;\n        this.task = null;\n        this.obj = obj;\n        this.persistentFlags = flags & 805306383 /* targetObserverFlags */;\n    }\n    getValue() {\n        return this.obj.style.cssText;\n    }\n    setValue(newValue, flags) {\n        this.currentValue = newValue;\n        this.hasChanges = newValue !== this.oldValue;\n        if ((flags & 4096 /* fromBind */) > 0 || this.persistentFlags === 268435456 /* noTargetObserverQueue */) {\n            this.flushChanges(flags);\n        }\n        else if (this.persistentFlags !== 536870912 /* persistentTargetObserverQueue */ && this.task === null) {\n            this.task = this.scheduler.queueRenderTask(() => {\n                this.flushChanges(flags);\n                this.task = null;\n            });\n        }\n    }\n    getStyleTuplesFromString(currentValue) {\n        const styleTuples = [];\n        const rx = /\\s*([\\w-]+)\\s*:\\s*((?:(?:[\\w-]+\\(\\s*(?:\"(?:\\\\\"|[^\"])*\"|'(?:\\\\'|[^'])*'|[\\w-]+\\(\\s*(?:[^\"](?:\\\\\"|[^\"])*\"|'(?:\\\\'|[^'])*'|[^)]*)\\),?|[^)]*)\\),?|\"(?:\\\\\"|[^\"])*\"|'(?:\\\\'|[^'])*'|[^;]*),?\\s*)+);?/g;\n        let pair;\n        let name;\n        while ((pair = rx.exec(currentValue)) !== null) {\n            name = pair[1];\n            if (name.length === 0) {\n                continue;\n            }\n            styleTuples.push([name, pair[2]]);\n        }\n        return styleTuples;\n    }\n    getStyleTuplesFromObject(currentValue) {\n        let value;\n        const styles = [];\n        for (const property in currentValue) {\n            value = currentValue[property];\n            if (value == null) {\n                continue;\n            }\n            if (typeof value === 'string') {\n                styles.push([kebabCase(property), value]);\n                continue;\n            }\n            styles.push(...this.getStyleTuples(value));\n        }\n        return styles;\n    }\n    getStyleTuplesFromArray(currentValue) {\n        const len = currentValue.length;\n        if (len > 0) {\n            const styles = [];\n            for (let i = 0; i < len; ++i) {\n                styles.push(...this.getStyleTuples(currentValue[i]));\n            }\n            return styles;\n        }\n        return PLATFORM.emptyArray;\n    }\n    getStyleTuples(currentValue) {\n        if (typeof currentValue === 'string') {\n            return this.getStyleTuplesFromString(currentValue);\n        }\n        if (currentValue instanceof Array) {\n            return this.getStyleTuplesFromArray(currentValue);\n        }\n        if (currentValue instanceof Object) {\n            return this.getStyleTuplesFromObject(currentValue);\n        }\n        return PLATFORM.emptyArray;\n    }\n    flushChanges(flags) {\n        if (this.hasChanges) {\n            this.hasChanges = false;\n            const { currentValue } = this;\n            this.oldValue = currentValue;\n            const styles = this.styles;\n            let style;\n            let version = this.version;\n            const styleTuples = this.getStyleTuples(currentValue);\n            let tuple;\n            let name;\n            let value;\n            const len = styleTuples.length;\n            for (let i = 0; i < len; ++i) {\n                tuple = styleTuples[i];\n                name = tuple[0];\n                value = tuple[1];\n                this.setProperty(name, value);\n                styles[name] = version;\n            }\n            this.styles = styles;\n            this.version += 1;\n            if (version === 0) {\n                return;\n            }\n            version -= 1;\n            for (style in styles) {\n                if (!Object.prototype.hasOwnProperty.call(styles, style) || styles[style] !== version) {\n                    continue;\n                }\n                this.obj.style.removeProperty(style);\n            }\n        }\n    }\n    setProperty(style, value) {\n        let priority = '';\n        if (value != null && typeof value.indexOf === 'function' && value.includes('!important')) {\n            priority = 'important';\n            value = value.replace('!important', '');\n        }\n        this.obj.style.setProperty(style, value, priority);\n    }\n    bind(flags) {\n        if (this.persistentFlags === 536870912 /* persistentTargetObserverQueue */) {\n            if (this.task !== null) {\n                this.task.cancel();\n            }\n            this.task = this.scheduler.queueRenderTask(() => this.flushChanges(flags), { persistent: true });\n        }\n        this.oldValue = this.currentValue = this.obj.style.cssText;\n    }\n    unbind(flags) {\n        if (this.task !== null) {\n            this.task.cancel();\n            this.task = null;\n        }\n    }\n}\n//# sourceMappingURL=style-attribute-accessor.js.map","import { DI } from '@aurelia/kernel';\nexport const ISVGAnalyzer = DI.createInterface('ISVGAnalyzer').withDefault(x => x.singleton(class {\n    isStandardSvgAttribute(node, attributeName) {\n        return false;\n    }\n}));\n//# sourceMappingURL=svg-analyzer.js.map","import { __decorate, __metadata } from \"tslib\";\nimport { subscriberCollection, IScheduler, } from '@aurelia/runtime';\n// TODO: handle file attribute properly again, etc\n/**\n * Observer for non-radio, non-checkbox input.\n */\nlet ValueAttributeObserver = class ValueAttributeObserver {\n    constructor(scheduler, flags, handler, obj, propertyKey) {\n        this.scheduler = scheduler;\n        this.handler = handler;\n        this.obj = obj;\n        this.propertyKey = propertyKey;\n        this.currentValue = '';\n        this.oldValue = '';\n        this.hasChanges = false;\n        this.task = null;\n        this.persistentFlags = flags & 805306383 /* targetObserverFlags */;\n    }\n    getValue() {\n        return this.currentValue;\n    }\n    setValue(newValue, flags) {\n        this.currentValue = newValue;\n        this.hasChanges = newValue !== this.oldValue;\n        if ((flags & 4096 /* fromBind */) > 0 || this.persistentFlags === 268435456 /* noTargetObserverQueue */) {\n            this.flushChanges(flags);\n        }\n        else if (this.persistentFlags !== 536870912 /* persistentTargetObserverQueue */ && this.task === null) {\n            this.task = this.scheduler.queueRenderTask(() => {\n                this.flushChanges(flags);\n                this.task = null;\n            });\n        }\n    }\n    flushChanges(flags) {\n        if (this.hasChanges) {\n            this.hasChanges = false;\n            const { currentValue, oldValue } = this;\n            this.oldValue = currentValue;\n            if (currentValue == void 0) {\n                this.obj[this.propertyKey] = '';\n            }\n            else {\n                this.obj[this.propertyKey] = currentValue;\n            }\n            if ((flags & 4096 /* fromBind */) === 0) {\n                this.callSubscribers(currentValue, oldValue, flags);\n            }\n        }\n    }\n    handleEvent() {\n        const oldValue = this.oldValue = this.currentValue;\n        const currentValue = this.currentValue = this.obj[this.propertyKey];\n        if (oldValue !== currentValue) {\n            this.oldValue = currentValue;\n            this.callSubscribers(currentValue, oldValue, 131072 /* fromDOMEvent */ | 524288 /* allowPublishRoundtrip */);\n        }\n    }\n    subscribe(subscriber) {\n        if (!this.hasSubscribers()) {\n            this.handler.subscribe(this.obj, this);\n            this.currentValue = this.oldValue = this.obj[this.propertyKey];\n        }\n        this.addSubscriber(subscriber);\n    }\n    unsubscribe(subscriber) {\n        this.removeSubscriber(subscriber);\n        if (!this.hasSubscribers()) {\n            this.handler.dispose();\n        }\n    }\n    bind(flags) {\n        if (this.persistentFlags === 536870912 /* persistentTargetObserverQueue */) {\n            if (this.task !== null) {\n                this.task.cancel();\n            }\n            this.task = this.scheduler.queueRenderTask(() => this.flushChanges(flags), { persistent: true });\n        }\n    }\n    unbind(flags) {\n        if (this.task !== null) {\n            this.task.cancel();\n            this.task = null;\n        }\n    }\n};\nValueAttributeObserver = __decorate([\n    subscriberCollection(),\n    __metadata(\"design:paramtypes\", [Object, Number, Object, Object, String])\n], ValueAttributeObserver);\nexport { ValueAttributeObserver };\n//# sourceMappingURL=value-attribute-observer.js.map","import { __decorate, __metadata, __param } from \"tslib\";\nimport { Registration } from '@aurelia/kernel';\nimport { IDOM, ITargetAccessorLocator, ITargetObserverLocator, SetterObserver } from '@aurelia/runtime';\nimport { AttributeNSAccessor } from './attribute-ns-accessor';\nimport { CheckedObserver } from './checked-observer';\nimport { ClassAttributeAccessor } from './class-attribute-accessor';\nimport { DataAttributeAccessor } from './data-attribute-accessor';\nimport { ElementPropertyAccessor } from './element-property-accessor';\nimport { EventSubscriber } from './event-manager';\nimport { SelectValueObserver } from './select-value-observer';\nimport { StyleAttributeAccessor } from './style-attribute-accessor';\nimport { ISVGAnalyzer } from './svg-analyzer';\nimport { ValueAttributeObserver } from './value-attribute-observer';\n// https://infra.spec.whatwg.org/#namespaces\nconst htmlNS = 'http://www.w3.org/1999/xhtml';\nconst mathmlNS = 'http://www.w3.org/1998/Math/MathML';\nconst svgNS = 'http://www.w3.org/2000/svg';\nconst xlinkNS = 'http://www.w3.org/1999/xlink';\nconst xmlNS = 'http://www.w3.org/XML/1998/namespace';\nconst xmlnsNS = 'http://www.w3.org/2000/xmlns/';\n// https://html.spec.whatwg.org/multipage/syntax.html#attributes-2\nconst nsAttributes = Object.assign(Object.create(null), {\n    'xlink:actuate': ['actuate', xlinkNS],\n    'xlink:arcrole': ['arcrole', xlinkNS],\n    'xlink:href': ['href', xlinkNS],\n    'xlink:role': ['role', xlinkNS],\n    'xlink:show': ['show', xlinkNS],\n    'xlink:title': ['title', xlinkNS],\n    'xlink:type': ['type', xlinkNS],\n    'xml:lang': ['lang', xmlNS],\n    'xml:space': ['space', xmlNS],\n    'xmlns': ['xmlns', xmlnsNS],\n    'xmlns:xlink': ['xlink', xmlnsNS],\n});\nconst inputEvents = ['change', 'input'];\nconst selectEvents = ['change'];\nconst contentEvents = ['change', 'input', 'blur', 'keyup', 'paste'];\nconst scrollEvents = ['scroll'];\nconst overrideProps = Object.assign(Object.create(null), {\n    'class': true,\n    'style': true,\n    'css': true,\n    'checked': true,\n    'value': true,\n    'model': true,\n    'xlink:actuate': true,\n    'xlink:arcrole': true,\n    'xlink:href': true,\n    'xlink:role': true,\n    'xlink:show': true,\n    'xlink:title': true,\n    'xlink:type': true,\n    'xml:lang': true,\n    'xml:space': true,\n    'xmlns': true,\n    'xmlns:xlink': true,\n});\nlet TargetObserverLocator = class TargetObserverLocator {\n    constructor(dom, svgAnalyzer) {\n        this.dom = dom;\n        this.svgAnalyzer = svgAnalyzer;\n    }\n    static register(container) {\n        return Registration.singleton(ITargetObserverLocator, this).register(container);\n    }\n    getObserver(flags, scheduler, lifecycle, observerLocator, obj, propertyName) {\n        switch (propertyName) {\n            case 'checked':\n                return new CheckedObserver(scheduler, flags, observerLocator, new EventSubscriber(this.dom, inputEvents), obj);\n            case 'value':\n                if (obj.tagName === 'SELECT') {\n                    return new SelectValueObserver(scheduler, flags, observerLocator, this.dom, new EventSubscriber(this.dom, selectEvents), obj);\n                }\n                return new ValueAttributeObserver(scheduler, flags, new EventSubscriber(this.dom, inputEvents), obj, propertyName);\n            case 'files':\n                return new ValueAttributeObserver(scheduler, flags, new EventSubscriber(this.dom, inputEvents), obj, propertyName);\n            case 'textContent':\n            case 'innerHTML':\n                return new ValueAttributeObserver(scheduler, flags, new EventSubscriber(this.dom, contentEvents), obj, propertyName);\n            case 'scrollTop':\n            case 'scrollLeft':\n                return new ValueAttributeObserver(scheduler, flags, new EventSubscriber(this.dom, scrollEvents), obj, propertyName);\n            case 'class':\n                return new ClassAttributeAccessor(scheduler, flags, obj);\n            case 'style':\n            case 'css':\n                return new StyleAttributeAccessor(scheduler, flags, obj);\n            case 'model':\n                return new SetterObserver(lifecycle, flags, obj, propertyName);\n            case 'role':\n                return new DataAttributeAccessor(scheduler, flags, obj, propertyName);\n            default:\n                if (nsAttributes[propertyName] !== undefined) {\n                    const nsProps = nsAttributes[propertyName];\n                    return new AttributeNSAccessor(scheduler, flags, obj, nsProps[0], nsProps[1]);\n                }\n                if (isDataAttribute(obj, propertyName, this.svgAnalyzer)) {\n                    return new DataAttributeAccessor(scheduler, flags, obj, propertyName);\n                }\n        }\n        return null;\n    }\n    overridesAccessor(flags, obj, propertyName) {\n        return overrideProps[propertyName] === true;\n    }\n    handles(flags, obj) {\n        return this.dom.isNodeInstance(obj);\n    }\n};\nTargetObserverLocator = __decorate([\n    __param(0, IDOM),\n    __param(1, ISVGAnalyzer),\n    __metadata(\"design:paramtypes\", [Object, Object])\n], TargetObserverLocator);\nexport { TargetObserverLocator };\nlet TargetAccessorLocator = class TargetAccessorLocator {\n    constructor(dom, svgAnalyzer) {\n        this.dom = dom;\n        this.svgAnalyzer = svgAnalyzer;\n    }\n    static register(container) {\n        return Registration.singleton(ITargetAccessorLocator, this).register(container);\n    }\n    getAccessor(flags, scheduler, lifecycle, obj, propertyName) {\n        switch (propertyName) {\n            case 'textContent':\n                // note: this case is just an optimization (textContent is the most often used property)\n                return new ElementPropertyAccessor(scheduler, flags, obj, propertyName);\n            case 'class':\n                return new ClassAttributeAccessor(scheduler, flags, obj);\n            case 'style':\n            case 'css':\n                return new StyleAttributeAccessor(scheduler, flags, obj);\n            // TODO: there are (many) more situation where we want to default to DataAttributeAccessor,\n            // but for now stick to what vCurrent does\n            case 'src':\n            case 'href':\n            // https://html.spec.whatwg.org/multipage/dom.html#wai-aria\n            case 'role':\n                return new DataAttributeAccessor(scheduler, flags, obj, propertyName);\n            default:\n                if (nsAttributes[propertyName] !== undefined) {\n                    const nsProps = nsAttributes[propertyName];\n                    return new AttributeNSAccessor(scheduler, flags, obj, nsProps[0], nsProps[1]);\n                }\n                if (isDataAttribute(obj, propertyName, this.svgAnalyzer)) {\n                    return new DataAttributeAccessor(scheduler, flags, obj, propertyName);\n                }\n                return new ElementPropertyAccessor(scheduler, flags, obj, propertyName);\n        }\n    }\n    handles(flags, obj) {\n        return this.dom.isNodeInstance(obj);\n    }\n};\nTargetAccessorLocator = __decorate([\n    __param(0, IDOM),\n    __param(1, ISVGAnalyzer),\n    __metadata(\"design:paramtypes\", [Object, Object])\n], TargetAccessorLocator);\nexport { TargetAccessorLocator };\nconst IsDataAttribute = {};\nfunction isDataAttribute(obj, propertyName, svgAnalyzer) {\n    if (IsDataAttribute[propertyName] === true) {\n        return true;\n    }\n    const prefix = propertyName.slice(0, 5);\n    // https://html.spec.whatwg.org/multipage/dom.html#wai-aria\n    // https://html.spec.whatwg.org/multipage/dom.html#custom-data-attribute\n    return IsDataAttribute[propertyName] =\n        prefix === 'aria-' ||\n            prefix === 'data-' ||\n            svgAnalyzer.isStandardSvgAttribute(obj, propertyName);\n}\n//# sourceMappingURL=observer-locator.js.map","import { __decorate } from \"tslib\";\nimport { bindingBehavior, IScheduler } from '@aurelia/runtime';\nimport { DataAttributeAccessor } from '../../observation/data-attribute-accessor';\nlet AttrBindingBehavior = class AttrBindingBehavior {\n    bind(flags, scope, binding) {\n        binding.targetObserver = new DataAttributeAccessor(binding.locator.get(IScheduler), flags, binding.target, binding.targetProperty);\n    }\n    unbind(flags, scope, binding) {\n        return;\n    }\n};\nAttrBindingBehavior = __decorate([\n    bindingBehavior('attr')\n], AttrBindingBehavior);\nexport { AttrBindingBehavior };\n//# sourceMappingURL=attr.js.map","import { __decorate } from \"tslib\";\nimport { Reporter } from '@aurelia/kernel';\nimport { bindingBehavior } from '@aurelia/runtime';\nimport { findOriginalEventTarget } from '../../observation/event-manager';\n/** @internal */\nexport function handleSelfEvent(event) {\n    const target = findOriginalEventTarget(event);\n    if (this.target !== target) {\n        return;\n    }\n    return this.selfEventCallSource(event);\n}\nlet SelfBindingBehavior = class SelfBindingBehavior {\n    bind(flags, scope, binding) {\n        if (!binding.callSource || !binding.targetEvent) {\n            throw Reporter.error(8);\n        }\n        binding.selfEventCallSource = binding.callSource;\n        binding.callSource = handleSelfEvent;\n    }\n    unbind(flags, scope, binding) {\n        binding.callSource = binding.selfEventCallSource;\n        binding.selfEventCallSource = null;\n    }\n};\nSelfBindingBehavior = __decorate([\n    bindingBehavior('self')\n], SelfBindingBehavior);\nexport { SelfBindingBehavior };\n//# sourceMappingURL=self.js.map","import { __decorate, __metadata, __param } from \"tslib\";\nimport { Reporter } from '@aurelia/kernel';\nimport { BindingMode, IDOM, IObserverLocator, bindingBehavior } from '@aurelia/runtime';\nimport { EventSubscriber } from '../../observation/event-manager';\nlet UpdateTriggerBindingBehavior = class UpdateTriggerBindingBehavior {\n    constructor(observerLocator) {\n        this.observerLocator = observerLocator;\n    }\n    bind(flags, scope, binding, ...events) {\n        if (events.length === 0) {\n            throw Reporter.error(9);\n        }\n        if (binding.mode !== BindingMode.twoWay && binding.mode !== BindingMode.fromView) {\n            throw Reporter.error(10);\n        }\n        this.persistentFlags = flags & 2080374799 /* persistentBindingFlags */;\n        // ensure the binding's target observer has been set.\n        const targetObserver = this.observerLocator.getObserver(this.persistentFlags | flags, binding.target, binding.targetProperty);\n        if (!targetObserver.handler) {\n            throw Reporter.error(10);\n        }\n        binding.targetObserver = targetObserver;\n        // stash the original element subscribe function.\n        targetObserver.originalHandler = binding.targetObserver.handler;\n        // replace the element subscribe function with one that uses the correct events.\n        targetObserver.handler = new EventSubscriber(binding.locator.get(IDOM), events);\n    }\n    unbind(flags, scope, binding) {\n        // restore the state of the binding.\n        binding.targetObserver.handler.dispose();\n        binding.targetObserver.handler = binding.targetObserver.originalHandler;\n        binding.targetObserver.originalHandler = null;\n    }\n};\nUpdateTriggerBindingBehavior = __decorate([\n    bindingBehavior('updateTrigger'),\n    __param(0, IObserverLocator),\n    __metadata(\"design:paramtypes\", [Object])\n], UpdateTriggerBindingBehavior);\nexport { UpdateTriggerBindingBehavior };\n//# sourceMappingURL=update-trigger.js.map","import { DI, PLATFORM } from '@aurelia/kernel';\nexport const noopShadowDOMStyles = Object.freeze({\n    applyTo: PLATFORM.noop\n});\nexport const IShadowDOMStyles = DI.createInterface('IShadowDOMStyles').noDefault();\nexport const IShadowDOMGlobalStyles = DI.createInterface('IShadowDOMGlobalStyles')\n    .withDefault(x => x.instance(noopShadowDOMStyles));\nexport class AdoptedStyleSheetsStyles {\n    constructor(dom, localStyles, styleSheetCache, sharedStyles = null) {\n        this.sharedStyles = sharedStyles;\n        this.styleSheets = localStyles.map(x => {\n            let sheet;\n            if (x instanceof dom.CSSStyleSheet) {\n                sheet = x;\n            }\n            else {\n                sheet = styleSheetCache.get(x);\n                if (!sheet) {\n                    sheet = new dom.CSSStyleSheet();\n                    sheet.replaceSync(x);\n                    styleSheetCache.set(x, sheet);\n                }\n            }\n            return sheet;\n        });\n    }\n    static supported(dom) {\n        return 'adoptedStyleSheets' in dom.ShadowRoot.prototype;\n    }\n    applyTo(shadowRoot) {\n        if (this.sharedStyles !== null) {\n            this.sharedStyles.applyTo(shadowRoot);\n        }\n        // https://wicg.github.io/construct-stylesheets/\n        // https://developers.google.com/web/updates/2019/02/constructable-stylesheets\n        shadowRoot.adoptedStyleSheets = [\n            ...shadowRoot.adoptedStyleSheets,\n            ...this.styleSheets\n        ];\n    }\n}\nexport class StyleElementStyles {\n    constructor(dom, localStyles, sharedStyles = null) {\n        this.dom = dom;\n        this.localStyles = localStyles;\n        this.sharedStyles = sharedStyles;\n    }\n    applyTo(shadowRoot) {\n        const styles = this.localStyles;\n        const dom = this.dom;\n        for (let i = styles.length - 1; i > -1; --i) {\n            const element = dom.createElement('style');\n            element.innerHTML = styles[i];\n            shadowRoot.prepend(element);\n        }\n        if (this.sharedStyles !== null) {\n            this.sharedStyles.applyTo(shadowRoot);\n        }\n    }\n}\n//# sourceMappingURL=shadow-dom-styles.js.map","import { PLATFORM, Registration, Reporter, toArray, Metadata } from '@aurelia/kernel';\nimport { IProjectorLocator, CustomElement, } from '@aurelia/runtime';\nimport { IShadowDOMStyles, IShadowDOMGlobalStyles } from './styles/shadow-dom-styles';\nconst defaultShadowOptions = {\n    mode: 'open'\n};\nexport class HTMLProjectorLocator {\n    static register(container) {\n        return Registration.singleton(IProjectorLocator, this).register(container);\n    }\n    getElementProjector(dom, $component, host, def) {\n        if (def.shadowOptions || def.hasSlots) {\n            if (def.containerless) {\n                throw Reporter.error(21);\n            }\n            return new ShadowDOMProjector(dom, $component, host, def);\n        }\n        if (def.containerless) {\n            return new ContainerlessProjector(dom, $component, host);\n        }\n        return new HostProjector($component, host);\n    }\n}\nconst childObserverOptions = { childList: true };\n/** @internal */\nexport class ShadowDOMProjector {\n    constructor(dom, \n    // eslint-disable-next-line @typescript-eslint/prefer-readonly\n    $controller, host, definition) {\n        this.dom = dom;\n        this.$controller = $controller;\n        this.host = host;\n        let shadowOptions;\n        if (definition.shadowOptions instanceof Object &&\n            'mode' in definition.shadowOptions) {\n            shadowOptions = definition.shadowOptions;\n        }\n        else {\n            shadowOptions = defaultShadowOptions;\n        }\n        this.shadowRoot = host.attachShadow(shadowOptions);\n        Metadata.define(CustomElement.name, $controller, this.host);\n        Metadata.define(CustomElement.name, $controller, this.shadowRoot);\n    }\n    get children() {\n        return this.host.childNodes;\n    }\n    subscribeToChildrenChange(callback, options = childObserverOptions) {\n        // TODO: add a way to dispose/disconnect\n        this.dom.createNodeObserver(this.host, callback, options);\n    }\n    provideEncapsulationSource() {\n        return this.shadowRoot;\n    }\n    project(nodes) {\n        const context = this.$controller.context;\n        const styles = context.has(IShadowDOMStyles, false)\n            ? context.get(IShadowDOMStyles)\n            : context.get(IShadowDOMGlobalStyles);\n        styles.applyTo(this.shadowRoot);\n        nodes.appendTo(this.shadowRoot);\n    }\n    take(nodes) {\n        nodes.remove();\n        nodes.unlink();\n    }\n}\n/** @internal */\nexport class ContainerlessProjector {\n    constructor(dom, $controller, host) {\n        if (host.childNodes.length) {\n            this.childNodes = toArray(host.childNodes);\n        }\n        else {\n            this.childNodes = PLATFORM.emptyArray;\n        }\n        this.host = dom.convertToRenderLocation(host);\n        Metadata.define(CustomElement.name, $controller, this.host);\n    }\n    get children() {\n        return this.childNodes;\n    }\n    subscribeToChildrenChange(callback) {\n        // TODO: turn this into an error\n        // Containerless does not have a container node to observe children on.\n    }\n    provideEncapsulationSource() {\n        return this.host.getRootNode();\n    }\n    project(nodes) {\n        nodes.insertBefore(this.host);\n    }\n    take(nodes) {\n        nodes.remove();\n        nodes.unlink();\n    }\n}\n/** @internal */\nexport class HostProjector {\n    constructor($controller, host) {\n        this.host = host;\n        Metadata.define(CustomElement.name, $controller, host);\n    }\n    get children() {\n        return this.host.childNodes;\n    }\n    subscribeToChildrenChange(callback) {\n        // Do nothing since this scenario will never have children.\n    }\n    provideEncapsulationSource() {\n        return this.host.getRootNode();\n    }\n    project(nodes) {\n        nodes.appendTo(this.host);\n    }\n    take(nodes) {\n        nodes.remove();\n        nodes.unlink();\n    }\n}\n//# sourceMappingURL=projectors.js.map","import { PLATFORM, Registration, Reporter } from '@aurelia/kernel';\nimport { DOM, IDOM, INode, CustomElement } from '@aurelia/runtime';\nimport { ShadowDOMProjector } from './projectors';\nexport var NodeType;\n(function (NodeType) {\n    NodeType[NodeType[\"Element\"] = 1] = \"Element\";\n    NodeType[NodeType[\"Attr\"] = 2] = \"Attr\";\n    NodeType[NodeType[\"Text\"] = 3] = \"Text\";\n    NodeType[NodeType[\"CDATASection\"] = 4] = \"CDATASection\";\n    NodeType[NodeType[\"EntityReference\"] = 5] = \"EntityReference\";\n    NodeType[NodeType[\"Entity\"] = 6] = \"Entity\";\n    NodeType[NodeType[\"ProcessingInstruction\"] = 7] = \"ProcessingInstruction\";\n    NodeType[NodeType[\"Comment\"] = 8] = \"Comment\";\n    NodeType[NodeType[\"Document\"] = 9] = \"Document\";\n    NodeType[NodeType[\"DocumentType\"] = 10] = \"DocumentType\";\n    NodeType[NodeType[\"DocumentFragment\"] = 11] = \"DocumentFragment\";\n    NodeType[NodeType[\"Notation\"] = 12] = \"Notation\";\n})(NodeType || (NodeType = {}));\nconst effectiveParentNodeOverrides = new WeakMap();\n/**\n * IDOM implementation for Html.\n */\nexport class HTMLDOM {\n    constructor(window, document, TNode, TElement, THTMLElement, TCustomEvent, TCSSStyleSheet, TShadowRoot) {\n        this.window = window;\n        this.document = document;\n        this.Node = TNode;\n        this.Element = TElement;\n        this.HTMLElement = THTMLElement;\n        this.CustomEvent = TCustomEvent;\n        this.CSSStyleSheet = TCSSStyleSheet;\n        this.ShadowRoot = TShadowRoot;\n        if (DOM.isInitialized) {\n            Reporter.write(1001); // TODO: create reporters code // DOM already initialized (just info)\n            DOM.destroy();\n        }\n        DOM.initialize(this);\n        this.emptyNodes = new FragmentNodeSequence(this, document.createDocumentFragment());\n    }\n    static register(container) {\n        return Registration.alias(IDOM, this).register(container);\n    }\n    addEventListener(eventName, subscriber, publisher, options) {\n        (publisher || this.document).addEventListener(eventName, subscriber, options);\n    }\n    appendChild(parent, child) {\n        parent.appendChild(child);\n    }\n    cloneNode(node, deep) {\n        return node.cloneNode(deep !== false);\n    }\n    convertToRenderLocation(node) {\n        if (this.isRenderLocation(node)) {\n            return node; // it's already a IRenderLocation (converted by FragmentNodeSequence)\n        }\n        if (node.parentNode == null) {\n            throw Reporter.error(52);\n        }\n        const locationEnd = this.document.createComment('au-end');\n        const locationStart = this.document.createComment('au-start');\n        node.parentNode.replaceChild(locationEnd, node);\n        locationEnd.parentNode.insertBefore(locationStart, locationEnd);\n        locationEnd.$start = locationStart;\n        locationStart.$nodes = null;\n        return locationEnd;\n    }\n    createDocumentFragment(markupOrNode) {\n        if (markupOrNode == null) {\n            return this.document.createDocumentFragment();\n        }\n        if (this.isNodeInstance(markupOrNode)) {\n            if (markupOrNode.content !== undefined) {\n                return markupOrNode.content;\n            }\n            const fragment = this.document.createDocumentFragment();\n            fragment.appendChild(markupOrNode);\n            return fragment;\n        }\n        return this.createTemplate(markupOrNode).content;\n    }\n    createNodeSequence(fragment) {\n        if (fragment === null) {\n            return this.emptyNodes;\n        }\n        return new FragmentNodeSequence(this, fragment.cloneNode(true));\n    }\n    createElement(name) {\n        return this.document.createElement(name);\n    }\n    fetch(input, init) {\n        return this.window.fetch(input, init);\n    }\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    createCustomEvent(eventType, options) {\n        return new this.CustomEvent(eventType, options);\n    }\n    dispatchEvent(evt) {\n        this.document.dispatchEvent(evt);\n    }\n    createNodeObserver(node, cb, init) {\n        if (typeof MutationObserver === 'undefined') {\n            // TODO: find a proper response for this scenario\n            return {\n                disconnect() { },\n                observe() { },\n                takeRecords() { return PLATFORM.emptyArray; }\n            };\n        }\n        const observer = new MutationObserver(cb);\n        observer.observe(node, init);\n        return observer;\n    }\n    createTemplate(markup) {\n        if (markup == null) {\n            return this.document.createElement('template');\n        }\n        const template = this.document.createElement('template');\n        template.innerHTML = markup.toString();\n        return template;\n    }\n    createTextNode(text) {\n        return this.document.createTextNode(text);\n    }\n    /**\n     * Returns the effective parentNode according to Aurelia's component hierarchy.\n     *\n     * Used by Aurelia to find the closest parent controller relative to a node.\n     *\n     * This method supports 3 additional scenarios that `node.parentNode` does not support:\n     * - Containerless elements. The parentNode in this case is a comment precending the element under specific conditions, rather than a node wrapping the element.\n     * - ShadowDOM. If a `ShadowRoot` is encountered, this method retrieves the associated controller via the metadata api to locate the original host.\n     * - Portals. If the provided node was moved to a different location in the DOM by a `portal` attribute, then the original parent of the node will be returned.\n     *\n     * @param node - The node to get the parent for.\n     * @returns Either the closest parent node, the closest `IRenderLocation` (comment node that is the containerless host), original portal host, or `null` if this is either the absolute document root or a disconnected node.\n     */\n    getEffectiveParentNode(node) {\n        // TODO: this method needs more tests!\n        // First look for any overrides\n        if (effectiveParentNodeOverrides.has(node)) {\n            return effectiveParentNodeOverrides.get(node);\n        }\n        // Then try to get the nearest au-start render location, which would be the containerless parent,\n        // again looking for any overrides along the way.\n        // otherwise return the normal parent node\n        let containerlessOffset = 0;\n        let next = node.nextSibling;\n        while (next !== null) {\n            if (next.nodeType === 8 /* Comment */) {\n                switch (next.textContent) {\n                    case 'au-start':\n                        // If we see an au-start before we see au-end, it will precede the host of a sibling containerless element rather than a parent.\n                        // So we use the offset to ignore the next au-end\n                        ++containerlessOffset;\n                        break;\n                    case 'au-end':\n                        if (containerlessOffset-- === 0) {\n                            return next;\n                        }\n                }\n            }\n            next = next.nextSibling;\n        }\n        if (node.parentNode === null && node.nodeType === 11 /* DocumentFragment */) {\n            // Could be a shadow root; see if there's a controller and if so, get the original host via the projector\n            const controller = CustomElement.for(node);\n            if (controller === void 0) {\n                // Not a shadow root (or at least, not one created by Aurelia)\n                // Nothing more we can try, just return null\n                return null;\n            }\n            const projector = controller.projector;\n            if (projector instanceof ShadowDOMProjector) {\n                // Now we can use the original host to traverse further up\n                return this.getEffectiveParentNode(projector.host);\n            }\n        }\n        return node.parentNode;\n    }\n    setEffectiveParentNode(childNodeOrNodeSequence, parentNode) {\n        if (this.isNodeInstance(childNodeOrNodeSequence)) {\n            effectiveParentNodeOverrides.set(childNodeOrNodeSequence, parentNode);\n        }\n        else {\n            const nodes = childNodeOrNodeSequence.childNodes;\n            for (let i = 0, ii = nodes.length; i < ii; ++i) {\n                effectiveParentNodeOverrides.set(nodes[i], parentNode);\n            }\n        }\n    }\n    insertBefore(nodeToInsert, referenceNode) {\n        referenceNode.parentNode.insertBefore(nodeToInsert, referenceNode);\n    }\n    isMarker(node) {\n        return node.nodeName === 'AU-M';\n    }\n    isNodeInstance(potentialNode) {\n        return potentialNode != null && potentialNode.nodeType > 0;\n    }\n    isRenderLocation(node) {\n        return node.textContent === 'au-end';\n    }\n    makeTarget(node) {\n        node.className = 'au';\n    }\n    registerElementResolver(container, resolver) {\n        container.registerResolver(INode, resolver);\n        container.registerResolver(this.Node, resolver);\n        container.registerResolver(this.Element, resolver);\n        container.registerResolver(this.HTMLElement, resolver);\n    }\n    remove(node) {\n        if (node.remove) {\n            node.remove();\n        }\n        else {\n            node.parentNode.removeChild(node);\n        }\n    }\n    removeEventListener(eventName, subscriber, publisher, options) {\n        (publisher || this.document).removeEventListener(eventName, subscriber, options);\n    }\n    setAttribute(node, name, value) {\n        node.setAttribute(name, value);\n    }\n}\nconst $DOM = DOM;\nexport { $DOM as DOM };\n/* eslint-enable @typescript-eslint/no-explicit-any */\n// This is the most common form of INodeSequence.\n// Every custom element or template controller whose node sequence is based on an HTML template\n// has an instance of this under the hood. Anyone who wants to create a node sequence from\n// a string of markup would also receive an instance of this.\n// CompiledTemplates create instances of FragmentNodeSequence.\n/**\n * This is the most common form of INodeSequence.\n *\n * @internal\n */\nexport class FragmentNodeSequence {\n    constructor(dom, fragment) {\n        this.dom = dom;\n        this.fragment = fragment;\n        this.isMounted = false;\n        this.isLinked = false;\n        this.next = void 0;\n        this.refNode = void 0;\n        const targetNodeList = fragment.querySelectorAll('.au');\n        let i = 0;\n        let ii = targetNodeList.length;\n        const targets = this.targets = Array(ii);\n        while (i < ii) {\n            // eagerly convert all markers to RenderLocations (otherwise the renderer\n            // will do it anyway) and store them in the target list (since the comments\n            // can't be queried)\n            const target = targetNodeList[i];\n            if (target.nodeName === 'AU-M') {\n                // note the renderer will still call this method, but it will just return the\n                // location if it sees it's already a location\n                targets[i] = this.dom.convertToRenderLocation(target);\n            }\n            else {\n                // also store non-markers for consistent ordering\n                targets[i] = target;\n            }\n            ++i;\n        }\n        const childNodeList = fragment.childNodes;\n        i = 0;\n        ii = childNodeList.length;\n        const childNodes = this.childNodes = Array(ii);\n        while (i < ii) {\n            childNodes[i] = childNodeList[i];\n            ++i;\n        }\n        this.firstChild = fragment.firstChild;\n        this.lastChild = fragment.lastChild;\n    }\n    findTargets() {\n        return this.targets;\n    }\n    insertBefore(refNode) {\n        if (this.isLinked && !!this.refNode) {\n            this.addToLinked();\n        }\n        else {\n            const parent = refNode.parentNode;\n            if (this.isMounted) {\n                let current = this.firstChild;\n                const end = this.lastChild;\n                let next;\n                while (current != null) {\n                    next = current.nextSibling;\n                    parent.insertBefore(current, refNode);\n                    if (current === end) {\n                        break;\n                    }\n                    current = next;\n                }\n            }\n            else {\n                this.isMounted = true;\n                refNode.parentNode.insertBefore(this.fragment, refNode);\n            }\n        }\n    }\n    appendTo(parent) {\n        if (this.isMounted) {\n            let current = this.firstChild;\n            const end = this.lastChild;\n            let next;\n            while (current != null) {\n                next = current.nextSibling;\n                parent.appendChild(current);\n                if (current === end) {\n                    break;\n                }\n                current = next;\n            }\n        }\n        else {\n            this.isMounted = true;\n            parent.appendChild(this.fragment);\n        }\n    }\n    remove() {\n        if (this.isMounted) {\n            this.isMounted = false;\n            const fragment = this.fragment;\n            const end = this.lastChild;\n            let next;\n            let current = this.firstChild;\n            while (current !== null) {\n                next = current.nextSibling;\n                fragment.appendChild(current);\n                if (current === end) {\n                    break;\n                }\n                current = next;\n            }\n        }\n    }\n    addToLinked() {\n        const refNode = this.refNode;\n        const parent = refNode.parentNode;\n        if (this.isMounted) {\n            let current = this.firstChild;\n            const end = this.lastChild;\n            let next;\n            while (current != null) {\n                next = current.nextSibling;\n                parent.insertBefore(current, refNode);\n                if (current === end) {\n                    break;\n                }\n                current = next;\n            }\n        }\n        else {\n            this.isMounted = true;\n            parent.insertBefore(this.fragment, refNode);\n        }\n    }\n    unlink() {\n        this.isLinked = false;\n        this.next = void 0;\n        this.refNode = void 0;\n    }\n    link(next) {\n        this.isLinked = true;\n        if (this.dom.isRenderLocation(next)) {\n            this.refNode = next;\n        }\n        else {\n            this.next = next;\n            this.obtainRefNode();\n        }\n    }\n    obtainRefNode() {\n        if (this.next !== void 0) {\n            this.refNode = this.next.firstChild;\n        }\n        else {\n            this.refNode = void 0;\n        }\n    }\n}\n/** @internal */\nexport class AuMarker {\n    constructor(nextSibling) {\n        this.nextSibling = nextSibling;\n        this.textContent = '';\n    }\n    get parentNode() {\n        return this.nextSibling.parentNode;\n    }\n    remove() { }\n}\n(proto => {\n    proto.previousSibling = null;\n    proto.childNodes = PLATFORM.emptyArray;\n    proto.nodeName = 'AU-M';\n    proto.nodeType = 1 /* Element */;\n})(AuMarker.prototype);\n//# sourceMappingURL=dom.js.map","import { __decorate, __metadata, __param } from \"tslib\";\nimport { PLATFORM } from '@aurelia/kernel';\nimport { bindable, customAttribute, IDOM, INode, IScheduler } from '@aurelia/runtime';\nimport { HTMLDOM } from '../../dom';\nconst unset = Symbol();\n// Using passive to help with performance\nconst defaultCaptureEventInit = {\n    passive: true,\n    capture: true\n};\n// Using passive to help with performance\nconst defaultBubbleEventInit = {\n    passive: true\n};\n// weakly connect a document to a blur manager\n// to avoid polluting the document properties\nconst blurDocMap = new WeakMap();\nexport class BlurManager {\n    constructor(dom, scheduler) {\n        this.dom = dom;\n        this.scheduler = scheduler;\n        this.blurs = [];\n        blurDocMap.set(dom.document, this);\n        this.handler = createHandler(this, this.blurs);\n    }\n    static createFor(dom, scheduler) {\n        return blurDocMap.get(dom.document) || new BlurManager(dom, scheduler);\n    }\n    register(blur) {\n        const blurs = this.blurs;\n        if (!blurs.includes(blur) && blurs.push(blur) === 1) {\n            this.addListeners();\n        }\n    }\n    unregister(blur) {\n        const blurs = this.blurs;\n        const index = blurs.indexOf(blur);\n        if (index > -1) {\n            blurs.splice(index, 1);\n        }\n        if (blurs.length === 0) {\n            this.removeListeners();\n        }\n    }\n    addListeners() {\n        const dom = this.dom;\n        const doc = dom.document;\n        const win = dom.window;\n        const handler = this.handler;\n        if (win.navigator.pointerEnabled) {\n            doc.addEventListener('pointerdown', handler, defaultCaptureEventInit);\n        }\n        doc.addEventListener('touchstart', handler, defaultCaptureEventInit);\n        doc.addEventListener('mousedown', handler, defaultCaptureEventInit);\n        doc.addEventListener('focus', handler, defaultCaptureEventInit);\n        win.addEventListener('blur', handler, defaultBubbleEventInit);\n    }\n    removeListeners() {\n        const dom = this.dom;\n        const doc = dom.document;\n        const win = dom.window;\n        const handler = this.handler;\n        if (win.navigator.pointerEnabled) {\n            doc.removeEventListener('pointerdown', handler, defaultCaptureEventInit);\n        }\n        doc.removeEventListener('touchstart', handler, defaultCaptureEventInit);\n        doc.removeEventListener('mousedown', handler, defaultCaptureEventInit);\n        doc.removeEventListener('focus', handler, defaultCaptureEventInit);\n        win.removeEventListener('blur', handler, defaultBubbleEventInit);\n    }\n}\nlet Blur = class Blur {\n    constructor(element, dom, scheduler) {\n        this.dom = dom;\n        this.element = element;\n        /**\n         * By default, the behavior should be least surprise possible, that:\n         *\n         * it searches for anything from root context,\n         * and root context is document body\n         */\n        this.linkedMultiple = true;\n        this.searchSubTree = true;\n        this.linkingContext = null;\n        this.value = unset;\n        this.manager = BlurManager.createFor(dom, scheduler);\n    }\n    afterAttach() {\n        this.manager.register(this);\n    }\n    beforeDetach() {\n        this.manager.unregister(this);\n    }\n    handleEventTarget(target) {\n        if (this.value === false) {\n            return;\n        }\n        const dom = this.dom;\n        if (target === dom.window || target === dom.document || !this.contains(target)) {\n            this.triggerBlur();\n        }\n    }\n    contains(target) {\n        if (!this.value) {\n            return false;\n        }\n        let els;\n        let i;\n        let j, jj;\n        let link;\n        const element = this.element;\n        if (containsElementOrShadowRoot(element, target)) {\n            return true;\n        }\n        if (!this.linkedWith) {\n            return false;\n        }\n        const doc = this.dom.document;\n        const linkedWith = this.linkedWith;\n        const linkingContext = this.linkingContext;\n        const searchSubTree = this.searchSubTree;\n        const linkedMultiple = this.linkedMultiple;\n        const links = Array.isArray(linkedWith) ? linkedWith : [linkedWith];\n        const contextNode = (typeof linkingContext === 'string'\n            ? doc.querySelector(linkingContext)\n            : linkingContext)\n            || doc.body;\n        const ii = links.length;\n        for (i = 0; ii > i; ++i) {\n            link = links[i];\n            // When user specify to link with something by a string, it acts as a CSS selector\n            // We need to do some querying stuff to determine if target above is contained.\n            if (typeof link === 'string') {\n                // Default behavior, search the whole tree, from context that user specified, which default to document body\n                if (searchSubTree) {\n                    // todo: are there too many knobs?? Consider remove \"linkedMultiple\"??\n                    if (!linkedMultiple) {\n                        const el = contextNode.querySelector(link);\n                        els = el !== null ? [el] : PLATFORM.emptyArray;\n                    }\n                    else {\n                        els = contextNode.querySelectorAll(link);\n                    }\n                    jj = els.length;\n                    for (j = 0; jj > j; ++j) {\n                        if (els[j].contains(target)) {\n                            return true;\n                        }\n                    }\n                }\n                else {\n                    // default to document body, if user didn't define a linking context, and wanted to ignore subtree.\n                    // This is specifically performant and useful for dialogs, plugins\n                    // that usually generate contents to document body\n                    els = contextNode.children;\n                    jj = els.length;\n                    for (j = 0; jj > j; ++j) {\n                        if (els[j].matches(link)) {\n                            return true;\n                        }\n                    }\n                }\n            }\n            else {\n                // When user passed in something that is not a string,\n                // simply check if has method `contains` (allow duck typing)\n                // and call it against target.\n                // This enables flexible usages\n                if (link && link.contains(target)) {\n                    return true;\n                }\n            }\n        }\n        return false;\n    }\n    triggerBlur() {\n        this.value = false;\n        if (typeof this.onBlur === 'function') {\n            this.onBlur.call(null);\n        }\n    }\n};\n__decorate([\n    bindable(),\n    __metadata(\"design:type\", Object)\n], Blur.prototype, \"value\", void 0);\n__decorate([\n    bindable(),\n    __metadata(\"design:type\", Function)\n], Blur.prototype, \"onBlur\", void 0);\n__decorate([\n    bindable(),\n    __metadata(\"design:type\", Object)\n], Blur.prototype, \"linkedWith\", void 0);\n__decorate([\n    bindable(),\n    __metadata(\"design:type\", Boolean)\n], Blur.prototype, \"linkedMultiple\", void 0);\n__decorate([\n    bindable(),\n    __metadata(\"design:type\", Boolean)\n], Blur.prototype, \"searchSubTree\", void 0);\n__decorate([\n    bindable(),\n    __metadata(\"design:type\", Object)\n], Blur.prototype, \"linkingContext\", void 0);\nBlur = __decorate([\n    customAttribute('blur'),\n    __param(0, INode), __param(1, IDOM), __param(2, IScheduler),\n    __metadata(\"design:paramtypes\", [Object, HTMLDOM, Object])\n], Blur);\nexport { Blur };\nconst containsElementOrShadowRoot = (container, target) => {\n    if (container.contains(target)) {\n        return true;\n    }\n    let parentNode = null;\n    while (target != null) {\n        if (target === container) {\n            return true;\n        }\n        parentNode = target.parentNode;\n        if (parentNode === null && target.nodeType === 11 /* DocumentFragment */) {\n            target = target.host;\n            continue;\n        }\n        target = parentNode;\n    }\n    return false;\n};\nconst createHandler = (manager, checkTargets) => {\n    // *******************************\n    // EVENTS ORDER\n    // -----------------------------\n    // pointerdown\n    // touchstart\n    // pointerup\n    // touchend\n    // mousedown\n    // --------------\n    // BLUR\n    // FOCUS\n    // --------------\n    // mouseup\n    // click\n    //\n    // ******************************\n    //\n    // There are cases focus happens without mouse interaction (keyboard)\n    // So it needs to capture both mouse / focus movement\n    //\n    // ******************************\n    let hasChecked = false;\n    const revertCheckage = () => {\n        hasChecked = false;\n    };\n    const markChecked = () => {\n        hasChecked = true;\n        manager.scheduler.queueRenderTask(revertCheckage, { preempt: true });\n    };\n    const handleMousedown = (e) => {\n        if (!hasChecked) {\n            handleEvent(e);\n            markChecked();\n        }\n    };\n    /**\n     * Handle globally captured focus event\n     * This can happen via a few way:\n     * User clicks on a focusable element\n     * User uses keyboard to navigate to a focusable element\n     * User goes back to the window from another browser tab\n     * User clicks on a non-focusable element\n     * User clicks on the window, outside of the document\n     */\n    const handleFocus = (e) => {\n        if (hasChecked) {\n            return;\n        }\n        // there are two way a focus gets captured on window\n        // when the windows itself got focus\n        // and when an element in the document gets focus\n        // when the window itself got focus, reacting to it is quite unnecessary\n        // as it doesn't really affect element inside the document\n        // Do a simple check and bail immediately\n        const isWindow = e.target === manager.dom.window;\n        if (isWindow) {\n            for (let i = 0, ii = checkTargets.length; ii > i; ++i) {\n                checkTargets[i].triggerBlur();\n            }\n        }\n        else {\n            handleEvent(e);\n        }\n        markChecked();\n    };\n    const handleWindowBlur = () => {\n        hasChecked = false;\n        for (let i = 0, ii = checkTargets.length; i < ii; ++i) {\n            checkTargets[i].triggerBlur();\n        }\n    };\n    const handleEvent = (e) => {\n        const target = e.composed ? e.composedPath()[0] : e.target;\n        if (target === null) {\n            return;\n        }\n        for (let i = 0, ii = checkTargets.length; i < ii; ++i) {\n            checkTargets[i].handleEventTarget(target);\n        }\n    };\n    return {\n        onpointerdown: handleMousedown,\n        ontouchstart: handleMousedown,\n        onmousedown: handleMousedown,\n        onfocus: handleFocus,\n        onblur: handleWindowBlur,\n        handleEvent(e) {\n            this[`on${e.type}`](e);\n        }\n    };\n};\n//# sourceMappingURL=blur.js.map","import { __decorate, __metadata, __param } from \"tslib\";\nimport { bindable, BindingMode, customAttribute, IDOM, INode } from '@aurelia/runtime';\nimport { HTMLDOM } from '../../dom';\n/**\n * Focus attribute for element focus binding\n */\nlet Focus = class Focus {\n    constructor(element, dom) {\n        this.dom = dom;\n        /**\n         * Indicates whether `apply` should be called when `afterAttach` callback is invoked\n         */\n        this.needsApply = false;\n        this.element = element;\n    }\n    beforeBind() {\n        this.valueChanged();\n    }\n    /**\n     * Invoked everytime the bound value changes.\n     *\n     * @param newValue - The new value.\n     */\n    valueChanged() {\n        // In theory, we could/should react immediately\n        // but focus state of an element cannot be achieved\n        // while it's disconnected from the document\n        // thus, there neesd to be a check if it's currently connected or not\n        // before applying the value to the element\n        if (this.$controller.state & 32 /* isAttached */) {\n            this.apply();\n        }\n        else {\n            // If the element is not currently connect\n            // toggle the flag to add pending work for later\n            // in afterAttach lifecycle\n            this.needsApply = true;\n        }\n    }\n    /**\n     * Invoked when the attribute is afterAttach to the DOM.\n     */\n    afterAttach() {\n        if (this.needsApply) {\n            this.needsApply = false;\n            this.apply();\n        }\n        const el = this.element;\n        el.addEventListener('focus', this);\n        el.addEventListener('blur', this);\n    }\n    /**\n     * Invoked when the attribute is afterDetach from the DOM.\n     */\n    afterDetach() {\n        const el = this.element;\n        el.removeEventListener('focus', this);\n        el.removeEventListener('blur', this);\n    }\n    /**\n     * EventTarget interface handler for better memory usage\n     */\n    handleEvent(e) {\n        // there are only two event listened to\n        // if the even is focus, it menans the element is focused\n        // only need to switch the value to true\n        if (e.type === 'focus') {\n            this.value = true;\n        }\n        else if (this.dom.document.activeElement !== this.element) {\n            // else, it's blur event\n            // when a blur event happens, there are two situations\n            // 1. the element itself lost the focus\n            // 2. window lost the focus\n            // To handle both (1) and (2), only need to check if\n            // current active element is still the same element of this focus custom attribute\n            // If it's not, it's a blur event happened on Window because the browser tab lost focus\n            this.value = false;\n        }\n    }\n    /**\n     * Focus/blur based on current value\n     */\n    apply() {\n        const el = this.element;\n        if (this.value) {\n            el.focus();\n        }\n        else {\n            el.blur();\n        }\n    }\n};\n__decorate([\n    bindable({ mode: BindingMode.twoWay }),\n    __metadata(\"design:type\", Object)\n], Focus.prototype, \"value\", void 0);\nFocus = __decorate([\n    customAttribute('focus'),\n    __param(0, INode), __param(1, IDOM),\n    __metadata(\"design:paramtypes\", [Object, HTMLDOM])\n], Focus);\nexport { Focus };\n//# sourceMappingURL=focus.js.map","import { __decorate, __metadata, __param } from \"tslib\";\nimport { nextId, } from '@aurelia/kernel';\nimport { bindable, ContinuationTask, IDOM, IRenderLocation, IViewFactory, LifecycleTask, templateController, TerminalTask, } from '@aurelia/runtime';\nimport { HTMLDOM, } from '../../dom';\nfunction toTask(maybePromiseOrTask) {\n    if (maybePromiseOrTask == null) {\n        return LifecycleTask.done;\n    }\n    if (typeof maybePromiseOrTask.then === 'function') {\n        return new TerminalTask(maybePromiseOrTask);\n    }\n    return maybePromiseOrTask;\n}\nlet Portal = class Portal {\n    constructor(factory, originalLoc, dom) {\n        this.factory = factory;\n        this.originalLoc = originalLoc;\n        this.dom = dom;\n        this.id = nextId('au$component');\n        this.strict = false;\n        this.task = LifecycleTask.done;\n        // to make the shape of this object consistent.\n        // todo: is this necessary\n        this.currentTarget = dom.createElement('div');\n        this.view = this.factory.create();\n        dom.setEffectiveParentNode(this.view.nodes, originalLoc);\n        this.view.hold(originalLoc, 1 /* insertBefore */);\n    }\n    beforeBind(flags) {\n        if (this.callbackContext == null) {\n            this.callbackContext = this.$controller.scope.bindingContext;\n        }\n        return this.view.bind(flags, this.$controller.scope);\n    }\n    afterAttach(flags) {\n        this.targetChanged();\n    }\n    beforeDetach(flags) {\n        this.task = this.deactivate(flags);\n    }\n    beforeUnbind(flags) {\n        this.callbackContext = null;\n        return this.view.unbind(flags);\n    }\n    targetChanged() {\n        const $controller = this.$controller;\n        if (($controller.state & 4 /* isBound */) === 0) {\n            return;\n        }\n        this.project($controller.flags);\n    }\n    project(flags) {\n        const oldTarget = this.currentTarget;\n        const newTarget = this.currentTarget = this.resolveTarget();\n        if (oldTarget === newTarget) {\n            return;\n        }\n        this.task = this.deactivate(flags);\n        this.task = this.activate(newTarget, flags);\n    }\n    activate(target, flags) {\n        const { activating, activated, callbackContext, view } = this;\n        let task = this.task;\n        view.hold(target, 2 /* append */);\n        if ((this.$controller.state & 40 /* isAttachedOrAttaching */) === 0) {\n            return task;\n        }\n        if (typeof activating === 'function') {\n            if (task.done) {\n                task = toTask(activating.call(callbackContext, target, view));\n            }\n            else {\n                task = new ContinuationTask(task, activating, callbackContext, target, view);\n            }\n        }\n        if (task.done) {\n            view.attach(flags);\n        }\n        else {\n            task = new ContinuationTask(task, view.attach, view, flags);\n        }\n        if (typeof activated === 'function') {\n            if (task.done) {\n                // TODO: chain this up with RAF queue mount callback so activated is called only when\n                // node is actually mounted (is this needed as per the spec of this resource?)\n                task = toTask(activated.call(callbackContext, target, view));\n            }\n            else {\n                task = new ContinuationTask(task, activated, callbackContext, target, view);\n            }\n        }\n        return task;\n    }\n    deactivate(flags) {\n        const { deactivating, deactivated, callbackContext, view, target: target } = this;\n        let task = this.task;\n        if (typeof deactivating === 'function') {\n            if (task.done) {\n                task = toTask(deactivating.call(callbackContext, target, view));\n            }\n            else {\n                task = new ContinuationTask(task, deactivating, callbackContext, target, view);\n            }\n        }\n        if (task.done) {\n            view.detach(flags);\n        }\n        else {\n            task = new ContinuationTask(task, view.detach, view, flags);\n        }\n        if (typeof deactivated === 'function') {\n            if (task.done) {\n                task = toTask(deactivated.call(callbackContext, target, view));\n            }\n            else {\n                task = new ContinuationTask(task, deactivated, callbackContext, target, view);\n            }\n        }\n        return task;\n    }\n    resolveTarget() {\n        const dom = this.dom;\n        // with a $ in front to make it less confusing/error prone\n        const $document = dom.document;\n        let target = this.target;\n        let context = this.renderContext;\n        if (typeof target === 'string') {\n            let queryContext = $document;\n            if (typeof context === 'string') {\n                context = $document.querySelector(context);\n            }\n            if (dom.isNodeInstance(context)) {\n                queryContext = context;\n            }\n            target = queryContext.querySelector(target);\n        }\n        if (dom.isNodeInstance(target)) {\n            return target;\n        }\n        if (target == null) {\n            if (this.strict) {\n                throw new Error('Render target not found');\n            }\n            else {\n                target = $document.body;\n            }\n        }\n        return target;\n    }\n};\n__decorate([\n    bindable({ primary: true }),\n    __metadata(\"design:type\", Object)\n], Portal.prototype, \"target\", void 0);\n__decorate([\n    bindable({ callback: 'targetChanged' }),\n    __metadata(\"design:type\", Object)\n], Portal.prototype, \"renderContext\", void 0);\n__decorate([\n    bindable(),\n    __metadata(\"design:type\", Boolean)\n], Portal.prototype, \"strict\", void 0);\n__decorate([\n    bindable(),\n    __metadata(\"design:type\", Function)\n], Portal.prototype, \"deactivating\", void 0);\n__decorate([\n    bindable(),\n    __metadata(\"design:type\", Function)\n], Portal.prototype, \"activating\", void 0);\n__decorate([\n    bindable(),\n    __metadata(\"design:type\", Function)\n], Portal.prototype, \"deactivated\", void 0);\n__decorate([\n    bindable(),\n    __metadata(\"design:type\", Function)\n], Portal.prototype, \"activated\", void 0);\n__decorate([\n    bindable(),\n    __metadata(\"design:type\", Object)\n], Portal.prototype, \"callbackContext\", void 0);\nPortal = __decorate([\n    templateController('portal'),\n    __param(0, IViewFactory),\n    __param(1, IRenderLocation),\n    __param(2, IDOM),\n    __metadata(\"design:paramtypes\", [Object, Object, HTMLDOM])\n], Portal);\nexport { Portal };\n//# sourceMappingURL=portal.js.map","export var HTMLTargetedInstructionType;\n(function (HTMLTargetedInstructionType) {\n    HTMLTargetedInstructionType[\"textBinding\"] = \"ha\";\n    HTMLTargetedInstructionType[\"listenerBinding\"] = \"hb\";\n    HTMLTargetedInstructionType[\"attributeBinding\"] = \"hc\";\n    HTMLTargetedInstructionType[\"stylePropertyBinding\"] = \"hd\";\n    HTMLTargetedInstructionType[\"setAttribute\"] = \"he\";\n    HTMLTargetedInstructionType[\"setClassAttribute\"] = \"hf\";\n    HTMLTargetedInstructionType[\"setStyleAttribute\"] = \"hg\";\n})(HTMLTargetedInstructionType || (HTMLTargetedInstructionType = {}));\nexport function isHTMLTargetedInstruction(value) {\n    const type = value.type;\n    return typeof type === 'string' && type.length === 2;\n}\n//# sourceMappingURL=definitions.js.map","import { DelegationStrategy } from '@aurelia/runtime';\nexport class TextBindingInstruction {\n    constructor(from) {\n        this.from = from;\n        this.type = \"ha\" /* textBinding */;\n    }\n}\nexport class TriggerBindingInstruction {\n    constructor(from, to) {\n        this.from = from;\n        this.to = to;\n        this.type = \"hb\" /* listenerBinding */;\n        this.preventDefault = true;\n        this.strategy = DelegationStrategy.none;\n    }\n}\nexport class DelegateBindingInstruction {\n    constructor(from, to) {\n        this.from = from;\n        this.to = to;\n        this.type = \"hb\" /* listenerBinding */;\n        this.preventDefault = false;\n        this.strategy = DelegationStrategy.bubbling;\n    }\n}\nexport class CaptureBindingInstruction {\n    constructor(from, to) {\n        this.from = from;\n        this.to = to;\n        this.type = \"hb\" /* listenerBinding */;\n        this.preventDefault = false;\n        this.strategy = DelegationStrategy.capturing;\n    }\n}\nexport class StylePropertyBindingInstruction {\n    constructor(from, to) {\n        this.from = from;\n        this.to = to;\n        this.type = \"hd\" /* stylePropertyBinding */;\n    }\n}\nexport class SetAttributeInstruction {\n    constructor(value, to) {\n        this.value = value;\n        this.to = to;\n        this.type = \"he\" /* setAttribute */;\n    }\n}\nexport class SetClassAttributeInstruction {\n    constructor(value) {\n        this.value = value;\n        this.type = \"hf\" /* setClassAttribute */;\n    }\n}\nexport class SetStyleAttributeInstruction {\n    constructor(value) {\n        this.value = value;\n        this.type = \"hg\" /* setStyleAttribute */;\n    }\n}\nexport class AttributeBindingInstruction {\n    constructor(\n    /**\n     * `attr` and `to` have the same value on a normal attribute\n     * Will be different on `class` and `style`\n     * on `class`: attr = `class` (from binding command), to = attribute name\n     * on `style`: attr = `style` (from binding command), to = attribute name\n     */\n    attr, from, to) {\n        this.attr = attr;\n        this.from = from;\n        this.to = to;\n        this.type = \"hc\" /* attributeBinding */;\n    }\n}\n//# sourceMappingURL=instructions.js.map","import { CustomElement, HydrateElementInstruction, CustomElementDefinition, getRenderContext, } from '@aurelia/runtime';\nimport { isHTMLTargetedInstruction } from './definitions';\nimport { SetAttributeInstruction } from './instructions';\nexport function createElement(dom, tagOrType, props, children) {\n    if (typeof tagOrType === 'string') {\n        return createElementForTag(dom, tagOrType, props, children);\n    }\n    else if (CustomElement.isType(tagOrType)) {\n        return createElementForType(dom, tagOrType, props, children);\n    }\n    else {\n        throw new Error(`Invalid tagOrType.`);\n    }\n}\n/**\n * RenderPlan. Todo: describe goal of this class\n */\nexport class RenderPlan {\n    constructor(dom, node, instructions, dependencies) {\n        this.dom = dom;\n        this.node = node;\n        this.instructions = instructions;\n        this.dependencies = dependencies;\n        this.lazyDefinition = void 0;\n    }\n    get definition() {\n        if (this.lazyDefinition === void 0) {\n            this.lazyDefinition = CustomElementDefinition.create({\n                name: CustomElement.generateName(),\n                template: this.node,\n                needsCompile: typeof this.node === 'string',\n                instructions: this.instructions,\n                dependencies: this.dependencies,\n            });\n        }\n        return this.lazyDefinition;\n    }\n    getContext(parentContainer) {\n        return getRenderContext(this.definition, parentContainer, void 0);\n    }\n    createView(parentContainer) {\n        return this.getViewFactory(parentContainer).create();\n    }\n    getViewFactory(parentContainer) {\n        return this.getContext(parentContainer).getViewFactory();\n    }\n    /** @internal */\n    mergeInto(parent, instructions, dependencies) {\n        this.dom.appendChild(parent, this.node);\n        instructions.push(...this.instructions);\n        dependencies.push(...this.dependencies);\n    }\n}\nfunction createElementForTag(dom, tagName, props, children) {\n    const instructions = [];\n    const allInstructions = [];\n    const dependencies = [];\n    const element = dom.createElement(tagName);\n    let hasInstructions = false;\n    if (props) {\n        Object.keys(props)\n            .forEach(to => {\n            const value = props[to];\n            if (isHTMLTargetedInstruction(value)) {\n                hasInstructions = true;\n                instructions.push(value);\n            }\n            else {\n                dom.setAttribute(element, to, value);\n            }\n        });\n    }\n    if (hasInstructions) {\n        dom.makeTarget(element);\n        allInstructions.push(instructions);\n    }\n    if (children) {\n        addChildren(dom, element, children, allInstructions, dependencies);\n    }\n    return new RenderPlan(dom, element, allInstructions, dependencies);\n}\nfunction createElementForType(dom, Type, props, children) {\n    const definition = CustomElement.getDefinition(Type);\n    const tagName = definition.name;\n    const instructions = [];\n    const allInstructions = [instructions];\n    const dependencies = [];\n    const childInstructions = [];\n    const bindables = definition.bindables;\n    const element = dom.createElement(tagName);\n    dom.makeTarget(element);\n    if (!dependencies.includes(Type)) {\n        dependencies.push(Type);\n    }\n    instructions.push(new HydrateElementInstruction(tagName, childInstructions));\n    if (props) {\n        Object.keys(props)\n            .forEach(to => {\n            const value = props[to];\n            if (isHTMLTargetedInstruction(value)) {\n                childInstructions.push(value);\n            }\n            else {\n                const bindable = bindables[to];\n                if (bindable !== void 0) {\n                    childInstructions.push({\n                        type: \"re\" /* setProperty */,\n                        to,\n                        value\n                    });\n                }\n                else {\n                    childInstructions.push(new SetAttributeInstruction(value, to));\n                }\n            }\n        });\n    }\n    if (children) {\n        addChildren(dom, element, children, allInstructions, dependencies);\n    }\n    return new RenderPlan(dom, element, allInstructions, dependencies);\n}\nfunction addChildren(dom, parent, children, allInstructions, dependencies) {\n    for (let i = 0, ii = children.length; i < ii; ++i) {\n        const current = children[i];\n        switch (typeof current) {\n            case 'string':\n                dom.appendChild(parent, dom.createTextNode(current));\n                break;\n            case 'object':\n                if (dom.isNodeInstance(current)) {\n                    dom.appendChild(parent, current);\n                }\n                else if ('mergeInto' in current) {\n                    current.mergeInto(parent, allInstructions, dependencies);\n                }\n        }\n    }\n}\n//# sourceMappingURL=create-element.js.map","import { __decorate, __metadata, __param } from \"tslib\";\nimport { nextId, PLATFORM, } from '@aurelia/kernel';\nimport { BindingMode, ContinuationTask, IDOM, ITargetedInstruction, LifecycleTask, PromiseTask, CustomElementDefinition, bindable, customElement, getRenderContext, } from '@aurelia/runtime';\nimport { createElement, } from '../../create-element';\nconst bindables = ['subject', 'composing'];\nlet Compose = class Compose {\n    constructor(dom, instruction) {\n        this.dom = dom;\n        this.id = nextId('au$component');\n        this.subject = void 0;\n        this.composing = false;\n        this.view = void 0;\n        this.task = LifecycleTask.done;\n        this.lastSubject = void 0;\n        this.properties = instruction.instructions\n            .filter((x) => !bindables.includes(x.to))\n            .reduce((acc, item) => {\n            if (item.to) {\n                acc[item.to] = item;\n            }\n            return acc;\n        }, {});\n    }\n    beforeBind(flags) {\n        if (this.task.done) {\n            this.task = this.compose(this.subject, flags);\n        }\n        else {\n            this.task = new ContinuationTask(this.task, this.compose, this, this.subject, flags);\n        }\n        if (this.task.done) {\n            this.task = this.bindView(flags);\n        }\n        else {\n            this.task = new ContinuationTask(this.task, this.bindView, this, flags);\n        }\n        return this.task;\n    }\n    beforeAttach(flags) {\n        if (this.task.done) {\n            this.attachView(flags);\n        }\n        else {\n            this.task = new ContinuationTask(this.task, this.attachView, this, flags);\n        }\n    }\n    beforeDetach(flags) {\n        if (this.view != void 0) {\n            if (this.task.done) {\n                this.view.detach(flags);\n            }\n            else {\n                this.task = new ContinuationTask(this.task, this.view.detach, this.view, flags);\n            }\n        }\n    }\n    beforeUnbind(flags) {\n        this.lastSubject = void 0;\n        if (this.view != void 0) {\n            if (this.task.done) {\n                this.task = this.view.unbind(flags);\n            }\n            else {\n                this.task = new ContinuationTask(this.task, this.view.unbind, this.view, flags);\n            }\n        }\n        return this.task;\n    }\n    caching(flags) {\n        this.view = void 0;\n    }\n    subjectChanged(newValue, previousValue, flags) {\n        flags |= this.$controller.flags;\n        if (this.task.done) {\n            this.task = this.compose(newValue, flags);\n        }\n        else {\n            this.task = new ContinuationTask(this.task, this.compose, this, newValue, flags);\n        }\n    }\n    compose(subject, flags) {\n        if (this.lastSubject === subject) {\n            return LifecycleTask.done;\n        }\n        this.lastSubject = subject;\n        this.composing = true;\n        let task = this.deactivate(flags);\n        if (subject instanceof Promise) {\n            let viewPromise;\n            if (task.done) {\n                viewPromise = subject.then(s => this.resolveView(s, flags));\n            }\n            else {\n                viewPromise = task.wait().then(() => subject.then(s => this.resolveView(s, flags)));\n            }\n            task = new PromiseTask(viewPromise, this.activate, this, flags);\n        }\n        else {\n            const view = this.resolveView(subject, flags);\n            if (task.done) {\n                task = this.activate(view, flags);\n            }\n            else {\n                task = new ContinuationTask(task, this.activate, this, view, flags);\n            }\n        }\n        if (task.done) {\n            this.onComposed();\n        }\n        else {\n            task = new ContinuationTask(task, this.onComposed, this);\n        }\n        return task;\n    }\n    deactivate(flags) {\n        const view = this.view;\n        if (view == void 0) {\n            return LifecycleTask.done;\n        }\n        view.detach(flags);\n        return view.unbind(flags);\n    }\n    activate(view, flags) {\n        this.view = view;\n        if (view == void 0) {\n            return LifecycleTask.done;\n        }\n        let task = this.bindView(flags);\n        if (task.done) {\n            this.attachView(flags);\n        }\n        else {\n            task = new ContinuationTask(task, this.attachView, this, flags);\n        }\n        return task;\n    }\n    bindView(flags) {\n        if (this.view != void 0 && (this.$controller.state & (5 /* isBoundOrBinding */)) > 0) {\n            return this.view.bind(flags, this.$controller.scope, this.$controller.part);\n        }\n        return LifecycleTask.done;\n    }\n    attachView(flags) {\n        if (this.view != void 0 && (this.$controller.state & (40 /* isAttachedOrAttaching */)) > 0) {\n            this.view.attach(flags);\n        }\n    }\n    onComposed() {\n        this.composing = false;\n    }\n    resolveView(subject, flags) {\n        const view = this.provideViewFor(subject, flags);\n        if (view) {\n            view.hold(this.$controller.projector.host, 1 /* insertBefore */);\n            view.lockScope(this.$controller.scope);\n            return view;\n        }\n        return void 0;\n    }\n    provideViewFor(subject, flags) {\n        if (!subject) {\n            return void 0;\n        }\n        if (isController(subject)) { // IController\n            return subject;\n        }\n        if ('createView' in subject) { // RenderPlan\n            return subject.createView(this.$controller.context);\n        }\n        if ('create' in subject) { // IViewFactory\n            return subject.create(flags);\n        }\n        if ('template' in subject) { // Raw Template Definition\n            const definition = CustomElementDefinition.getOrCreate(subject);\n            return getRenderContext(definition, this.$controller.context, void 0).getViewFactory().create(flags);\n        }\n        // Constructable (Custom Element Constructor)\n        return createElement(this.dom, subject, this.properties, this.$controller.projector === void 0\n            ? PLATFORM.emptyArray\n            : this.$controller.projector.children).createView(this.$controller.context);\n    }\n};\n__decorate([\n    bindable,\n    __metadata(\"design:type\", Object)\n], Compose.prototype, \"subject\", void 0);\n__decorate([\n    bindable({ mode: BindingMode.fromView }),\n    __metadata(\"design:type\", Boolean)\n], Compose.prototype, \"composing\", void 0);\nCompose = __decorate([\n    customElement({ name: 'au-compose', template: null, containerless: true }),\n    __param(0, IDOM),\n    __param(1, ITargetedInstruction),\n    __metadata(\"design:paramtypes\", [Object, Object])\n], Compose);\nexport { Compose };\nfunction isController(subject) {\n    return 'lockScope' in subject;\n}\n//# sourceMappingURL=compose.js.map","import { __decorate, __metadata, __param } from \"tslib\";\nimport { BindingMode, ensureExpression, IExpressionParser, instructionRenderer, InterpolationBinding, IObserverLocator, MultiInterpolationBinding, PropertyBinding, applyBindingBehavior, } from '@aurelia/runtime';\nimport { AttributeBinding } from './binding/attribute';\nimport { Listener } from './binding/listener';\nimport { IEventManager } from './observation/event-manager';\nlet TextBindingRenderer = \n/** @internal */\nclass TextBindingRenderer {\n    constructor(parser, observerLocator) {\n        this.parser = parser;\n        this.observerLocator = observerLocator;\n    }\n    render(flags, context, controller, target, instruction) {\n        const next = target.nextSibling;\n        if (context.dom.isMarker(target)) {\n            context.dom.remove(target);\n        }\n        let binding;\n        const expr = ensureExpression(this.parser, instruction.from, 2048 /* Interpolation */);\n        if (expr.isMulti) {\n            binding = applyBindingBehavior(new MultiInterpolationBinding(this.observerLocator, expr, next, 'textContent', BindingMode.toView, context), expr, context);\n        }\n        else {\n            binding = applyBindingBehavior(new InterpolationBinding(expr.firstExpression, expr, next, 'textContent', BindingMode.toView, this.observerLocator, context, true), expr, context);\n        }\n        controller.addBinding(binding);\n    }\n};\nTextBindingRenderer = __decorate([\n    instructionRenderer(\"ha\" /* textBinding */)\n    /** @internal */\n    ,\n    __param(0, IExpressionParser),\n    __param(1, IObserverLocator),\n    __metadata(\"design:paramtypes\", [Object, Object])\n], TextBindingRenderer);\nexport { TextBindingRenderer };\nlet ListenerBindingRenderer = \n/** @internal */\nclass ListenerBindingRenderer {\n    constructor(parser, eventManager) {\n        this.parser = parser;\n        this.eventManager = eventManager;\n    }\n    render(flags, context, controller, target, instruction) {\n        // eslint-disable-next-line @typescript-eslint/restrict-plus-operands\n        const expr = ensureExpression(this.parser, instruction.from, 80 /* IsEventCommand */ | (instruction.strategy + 6 /* DelegationStrategyDelta */));\n        const binding = applyBindingBehavior(new Listener(context.dom, instruction.to, instruction.strategy, expr, target, instruction.preventDefault, this.eventManager, context), expr, context);\n        controller.addBinding(binding);\n    }\n};\nListenerBindingRenderer = __decorate([\n    instructionRenderer(\"hb\" /* listenerBinding */)\n    /** @internal */\n    ,\n    __param(0, IExpressionParser),\n    __param(1, IEventManager),\n    __metadata(\"design:paramtypes\", [Object, Object])\n], ListenerBindingRenderer);\nexport { ListenerBindingRenderer };\nlet SetAttributeRenderer = \n/** @internal */\nclass SetAttributeRenderer {\n    render(flags, context, controller, target, instruction) {\n        target.setAttribute(instruction.to, instruction.value);\n    }\n};\nSetAttributeRenderer = __decorate([\n    instructionRenderer(\"he\" /* setAttribute */)\n    /** @internal */\n], SetAttributeRenderer);\nexport { SetAttributeRenderer };\nlet SetClassAttributeRenderer = class SetClassAttributeRenderer {\n    render(flags, context, controller, target, instruction) {\n        addClasses(target.classList, instruction.value);\n    }\n};\nSetClassAttributeRenderer = __decorate([\n    instructionRenderer(\"hf\" /* setClassAttribute */)\n], SetClassAttributeRenderer);\nexport { SetClassAttributeRenderer };\nlet SetStyleAttributeRenderer = class SetStyleAttributeRenderer {\n    render(flags, context, controller, target, instruction) {\n        target.style.cssText += instruction.value;\n    }\n};\nSetStyleAttributeRenderer = __decorate([\n    instructionRenderer(\"hg\" /* setStyleAttribute */)\n], SetStyleAttributeRenderer);\nexport { SetStyleAttributeRenderer };\nlet StylePropertyBindingRenderer = \n/** @internal */\nclass StylePropertyBindingRenderer {\n    constructor(parser, observerLocator) {\n        this.parser = parser;\n        this.observerLocator = observerLocator;\n    }\n    render(flags, context, controller, target, instruction) {\n        const expr = ensureExpression(this.parser, instruction.from, 48 /* IsPropertyCommand */ | BindingMode.toView);\n        const binding = applyBindingBehavior(new PropertyBinding(expr, target.style, instruction.to, BindingMode.toView, this.observerLocator, context), expr, context);\n        controller.addBinding(binding);\n    }\n};\nStylePropertyBindingRenderer = __decorate([\n    instructionRenderer(\"hd\" /* stylePropertyBinding */)\n    /** @internal */\n    ,\n    __param(0, IExpressionParser),\n    __param(1, IObserverLocator),\n    __metadata(\"design:paramtypes\", [Object, Object])\n], StylePropertyBindingRenderer);\nexport { StylePropertyBindingRenderer };\nlet AttributeBindingRenderer = \n/** @internal */\nclass AttributeBindingRenderer {\n    constructor(parser, observerLocator) {\n        this.parser = parser;\n        this.observerLocator = observerLocator;\n    }\n    render(flags, context, controller, target, instruction) {\n        const expr = ensureExpression(this.parser, instruction.from, 48 /* IsPropertyCommand */ | BindingMode.toView);\n        const binding = applyBindingBehavior(new AttributeBinding(expr, target, instruction.attr /* targetAttribute */, instruction.to /* targetKey */, BindingMode.toView, this.observerLocator, context), expr, context);\n        controller.addBinding(binding);\n    }\n};\nAttributeBindingRenderer = __decorate([\n    instructionRenderer(\"hc\" /* attributeBinding */)\n    /** @internal */\n    ,\n    __param(0, IExpressionParser),\n    __param(1, IObserverLocator),\n    __metadata(\"design:paramtypes\", [Object, Object])\n], AttributeBindingRenderer);\nexport { AttributeBindingRenderer };\n// http://jsben.ch/7n5Kt\nfunction addClasses(classList, className) {\n    const len = className.length;\n    let start = 0;\n    for (let i = 0; i < len; ++i) {\n        if (className.charCodeAt(i) === 0x20) {\n            if (i !== start) {\n                classList.add(className.slice(start, i));\n            }\n            start = i + 1;\n        }\n        else if (i + 1 === len) {\n            classList.add(className.slice(start));\n        }\n    }\n}\n//# sourceMappingURL=html-renderer.js.map","import { DI } from '@aurelia/kernel';\nimport { RuntimeConfiguration } from '@aurelia/runtime';\nimport { AttributeBindingRenderer, ListenerBindingRenderer, SetAttributeRenderer, StylePropertyBindingRenderer, TextBindingRenderer, SetClassAttributeRenderer, SetStyleAttributeRenderer } from './html-renderer';\nimport { TargetAccessorLocator, TargetObserverLocator } from './observation/observer-locator';\nimport { HTMLProjectorLocator } from './projectors';\nimport { AttrBindingBehavior } from './resources/binding-behaviors/attr';\nimport { SelfBindingBehavior } from './resources/binding-behaviors/self';\nimport { UpdateTriggerBindingBehavior } from './resources/binding-behaviors/update-trigger';\nimport { Blur } from './resources/custom-attributes/blur';\nimport { Focus } from './resources/custom-attributes/focus';\nimport { Portal } from './resources/custom-attributes/portal';\nimport { Compose } from './resources/custom-elements/compose';\nexport const IProjectorLocatorRegistration = HTMLProjectorLocator;\nexport const ITargetAccessorLocatorRegistration = TargetAccessorLocator;\nexport const ITargetObserverLocatorRegistration = TargetObserverLocator;\n/**\n * Default HTML-specific (but environment-agnostic) implementations for the following interfaces:\n * - `IProjectorLocator`\n * - `ITargetAccessorLocator`\n * - `ITargetObserverLocator`\n * - `ITemplateFactory`\n */\nexport const DefaultComponents = [\n    IProjectorLocatorRegistration,\n    ITargetAccessorLocatorRegistration,\n    ITargetObserverLocatorRegistration,\n];\nexport const AttrBindingBehaviorRegistration = AttrBindingBehavior;\nexport const SelfBindingBehaviorRegistration = SelfBindingBehavior;\nexport const UpdateTriggerBindingBehaviorRegistration = UpdateTriggerBindingBehavior;\nexport const ComposeRegistration = Compose;\nexport const PortalRegistration = Portal;\nexport const FocusRegistration = Focus;\nexport const BlurRegistration = Blur;\n/**\n * Default HTML-specific (but environment-agnostic) resources:\n * - Binding Behaviors: `attr`, `self`, `updateTrigger`\n * - Custom Elements: `au-compose`\n * - Custom Attributes: `blur`, `focus`, `portal`\n */\nexport const DefaultResources = [\n    AttrBindingBehaviorRegistration,\n    SelfBindingBehaviorRegistration,\n    UpdateTriggerBindingBehaviorRegistration,\n    ComposeRegistration,\n    PortalRegistration,\n    FocusRegistration,\n    BlurRegistration\n];\nexport const ListenerBindingRendererRegistration = ListenerBindingRenderer;\nexport const AttributeBindingRendererRegistration = AttributeBindingRenderer;\nexport const SetAttributeRendererRegistration = SetAttributeRenderer;\nexport const SetClassAttributeRendererRegistration = SetClassAttributeRenderer;\nexport const SetStyleAttributeRendererRegistration = SetStyleAttributeRenderer;\nexport const StylePropertyBindingRendererRegistration = StylePropertyBindingRenderer;\nexport const TextBindingRendererRegistration = TextBindingRenderer;\n/**\n * Default HTML-specfic (but environment-agnostic) renderers for:\n * - Listener Bindings: `trigger`, `capture`, `delegate`\n * - SetAttribute\n * - StyleProperty: `style`, `css`\n * - TextBinding: `${}`\n */\nexport const DefaultRenderers = [\n    ListenerBindingRendererRegistration,\n    AttributeBindingRendererRegistration,\n    SetAttributeRendererRegistration,\n    SetClassAttributeRendererRegistration,\n    SetStyleAttributeRendererRegistration,\n    StylePropertyBindingRendererRegistration,\n    TextBindingRendererRegistration\n];\n/**\n * A DI configuration object containing html-specific (but environment-agnostic) registrations:\n * - `RuntimeConfiguration` from `@aurelia/runtime`\n * - `DefaultComponents`\n * - `DefaultResources`\n * - `DefaultRenderers`\n */\nexport const RuntimeHtmlConfiguration = {\n    /**\n     * Apply this configuration to the provided container.\n     */\n    register(container) {\n        return RuntimeConfiguration\n            .register(container)\n            .register(...DefaultComponents, ...DefaultResources, ...DefaultRenderers);\n    },\n    /**\n     * Create a new container with this configuration applied to it.\n     */\n    createContainer() {\n        return this.register(DI.createContainer());\n    }\n};\n//# sourceMappingURL=configuration.js.map","export { Listener } from './binding/listener';\nexport { AttributeBinding } from './binding/attribute';\nexport { AttributeNSAccessor } from './observation/attribute-ns-accessor';\nexport { CheckedObserver } from './observation/checked-observer';\nexport { ClassAttributeAccessor } from './observation/class-attribute-accessor';\nexport { DataAttributeAccessor } from './observation/data-attribute-accessor';\nexport { ElementPropertyAccessor } from './observation/element-property-accessor';\nexport { ListenerTracker, DelegateOrCaptureSubscription, TriggerSubscription, IEventManager, EventSubscriber, EventManager } from './observation/event-manager';\nexport { TargetAccessorLocator, TargetObserverLocator } from './observation/observer-locator';\nexport { SelectValueObserver } from './observation/select-value-observer';\nexport { StyleAttributeAccessor } from './observation/style-attribute-accessor';\nexport { ISVGAnalyzer } from './observation/svg-analyzer';\nexport { ValueAttributeObserver } from './observation/value-attribute-observer';\nexport { AttrBindingBehavior } from './resources/binding-behaviors/attr';\nexport { SelfBindingBehavior } from './resources/binding-behaviors/self';\nexport { UpdateTriggerBindingBehavior } from './resources/binding-behaviors/update-trigger';\nexport { Blur, BlurManager } from './resources/custom-attributes/blur';\nexport { Focus } from './resources/custom-attributes/focus';\nexport { Portal } from './resources/custom-attributes/portal';\nexport { Compose } from './resources/custom-elements/compose';\nexport { IProjectorLocatorRegistration, ITargetAccessorLocatorRegistration, ITargetObserverLocatorRegistration, DefaultComponents, AttrBindingBehaviorRegistration, SelfBindingBehaviorRegistration, UpdateTriggerBindingBehaviorRegistration, ComposeRegistration, DefaultResources, AttributeBindingRendererRegistration, ListenerBindingRendererRegistration, SetAttributeRendererRegistration, SetClassAttributeRendererRegistration, SetStyleAttributeRendererRegistration, StylePropertyBindingRendererRegistration, TextBindingRendererRegistration, DefaultRenderers, RuntimeHtmlConfiguration } from './configuration';\nexport { createElement, RenderPlan } from './create-element';\nexport { HTMLTargetedInstructionType, isHTMLTargetedInstruction } from './definitions';\nexport { NodeType, HTMLDOM, DOM, FragmentNodeSequence } from './dom';\nexport { AttributeBindingInstruction, CaptureBindingInstruction, DelegateBindingInstruction, SetAttributeInstruction, SetClassAttributeInstruction, SetStyleAttributeInstruction, StylePropertyBindingInstruction, TextBindingInstruction, TriggerBindingInstruction } from './instructions';\nexport { ContainerlessProjector, HostProjector, HTMLProjectorLocator, ShadowDOMProjector } from './projectors';\nexport { StyleConfiguration, styles } from './styles/style-configuration';\nexport { CSSModulesProcessorRegistry } from './styles/css-modules-registry';\nexport { ShadowDOMRegistry } from './styles/shadow-dom-registry';\nexport { AdoptedStyleSheetsStyles, StyleElementStyles, IShadowDOMStyles, IShadowDOMGlobalStyles } from './styles/shadow-dom-styles';\n//# sourceMappingURL=index.js.map","function $noop() { return; }\nconst $global = (function () {\n    if (typeof global !== 'undefined') {\n        return global;\n    }\n    if (typeof self !== 'undefined') {\n        return self;\n    }\n    if (typeof window !== 'undefined') {\n        return window;\n    }\n    try {\n        // Not all environments allow eval and Function. Use only as a last resort:\n        // eslint-disable-next-line no-new-func\n        return new Function('return this')();\n    }\n    catch (_a) {\n        // If all fails, give up and create an object.\n        // eslint-disable-next-line @typescript-eslint/consistent-type-assertions\n        return {};\n    }\n})();\nconst isBrowserLike = (typeof window !== 'undefined'\n    && typeof window.document !== 'undefined');\nconst isWebWorkerLike = (typeof self === 'object'\n    && self.constructor != null\n    && self.constructor.name === 'DedicatedWorkerGlobalScope');\nconst isNodeLike = (typeof process !== 'undefined'\n    && process.versions != null\n    && process.versions.node != null);\n// performance.now polyfill for non-browser envs based on https://github.com/myrne/performance-now\nconst $now = (function () {\n    let getNanoSeconds;\n    let hrtime;\n    let moduleLoadTime;\n    let nodeLoadTime;\n    let upTime;\n    if ($global.performance != null && $global.performance.now != null) {\n        const $performance = $global.performance;\n        return function () {\n            return $performance.now();\n        };\n    }\n    else if ($global.process != null && $global.process.hrtime != null) {\n        const now = function () {\n            return (getNanoSeconds() - nodeLoadTime) / 1e6;\n        };\n        hrtime = $global.process.hrtime;\n        getNanoSeconds = function () {\n            const hr = hrtime();\n            return hr[0] * 1e9 + hr[1];\n        };\n        moduleLoadTime = getNanoSeconds();\n        upTime = $global.process.uptime() * 1e9;\n        nodeLoadTime = moduleLoadTime - upTime;\n        return now;\n    }\n    else {\n        const now = function () {\n            return Date.now() - nodeLoadTime;\n        };\n        nodeLoadTime = Date.now();\n        return now;\n    }\n})();\nconst hasOwnProperty = Object.prototype.hasOwnProperty;\nconst emptyArray = Object.freeze([]);\nconst emptyObject = Object.freeze({});\nconst $PLATFORM = {\n    /**\n     * `true` if there is a `window` variable in the global scope with a `document` property.\n     *\n     * NOTE: this does not guarantee that the code is actually running in a browser, as some libraries tamper with globals.\n     * The only conclusion that can be drawn is that the `window` global is available and likely behaves similar to how it would in a browser.\n     */\n    isBrowserLike,\n    /**\n     * `true` if there is a `self` variable (of type `object`) in the global scope with constructor name `'DedicatedWorkerGlobalScope'`.\n     *\n     * NOTE: this does not guarantee that the code is actually running in a web worker, as some libraries tamper with globals.\n     * The only conclusion that can be drawn is that the `self` global is available and likely behaves similar to how it would in a web worker.\n     */\n    isWebWorkerLike,\n    /**\n     * `true` if there is a `process` variable in the global scope with a `versions` property which has a `node` property.\n     *\n     * NOTE: this is not a guarantee that the code is actually running in nodejs, as some libraries tamper with globals.\n     * The only conclusion that can be drawn is that the `process` global is available and likely behaves similar to how it would in nodejs.\n     */\n    isNodeLike,\n    global: $global,\n    emptyArray,\n    emptyObject,\n    noop: $noop,\n    now: $now,\n    hasOwnProperty,\n    restore() {\n        Object.assign(PLATFORM, $PLATFORM);\n    },\n};\nexport const PLATFORM = { ...$PLATFORM };\n//# sourceMappingURL=platform.js.map","function $noop() { return; }\nconst $global = (function () {\n    if (typeof global !== 'undefined') {\n        return global;\n    }\n    if (typeof self !== 'undefined') {\n        return self;\n    }\n    if (typeof window !== 'undefined') {\n        return window;\n    }\n    try {\n        // Not all environments allow eval and Function. Use only as a last resort:\n        // eslint-disable-next-line no-new-func\n        return new Function('return this')();\n    }\n    catch (_a) {\n        // If all fails, give up and create an object.\n        // eslint-disable-next-line @typescript-eslint/consistent-type-assertions\n        return {};\n    }\n})();\nconst isBrowserLike = (typeof window !== 'undefined'\n    && typeof window.document !== 'undefined');\nconst isWebWorkerLike = (typeof self === 'object'\n    && self.constructor != null\n    && self.constructor.name === 'DedicatedWorkerGlobalScope');\nconst isNodeLike = (typeof process !== 'undefined'\n    && process.versions != null\n    && process.versions.node != null);\n// performance.now polyfill for non-browser envs based on https://github.com/myrne/performance-now\nconst $now = (function () {\n    let getNanoSeconds;\n    let hrtime;\n    let moduleLoadTime;\n    let nodeLoadTime;\n    let upTime;\n    if ($global.performance != null && $global.performance.now != null) {\n        const $performance = $global.performance;\n        return function () {\n            return $performance.now();\n        };\n    }\n    else if ($global.process != null && $global.process.hrtime != null) {\n        const now = function () {\n            return (getNanoSeconds() - nodeLoadTime) / 1e6;\n        };\n        hrtime = $global.process.hrtime;\n        getNanoSeconds = function () {\n            const hr = hrtime();\n            return hr[0] * 1e9 + hr[1];\n        };\n        moduleLoadTime = getNanoSeconds();\n        upTime = $global.process.uptime() * 1e9;\n        nodeLoadTime = moduleLoadTime - upTime;\n        return now;\n    }\n    else {\n        const now = function () {\n            return Date.now() - nodeLoadTime;\n        };\n        nodeLoadTime = Date.now();\n        return now;\n    }\n})();\nconst hasOwnProperty = Object.prototype.hasOwnProperty;\nconst emptyArray = Object.freeze([]);\nconst emptyObject = Object.freeze({});\nconst $PLATFORM = {\n    /**\n     * `true` if there is a `window` variable in the global scope with a `document` property.\n     *\n     * NOTE: this does not guarantee that the code is actually running in a browser, as some libraries tamper with globals.\n     * The only conclusion that can be drawn is that the `window` global is available and likely behaves similar to how it would in a browser.\n     */\n    isBrowserLike,\n    /**\n     * `true` if there is a `self` variable (of type `object`) in the global scope with constructor name `'DedicatedWorkerGlobalScope'`.\n     *\n     * NOTE: this does not guarantee that the code is actually running in a web worker, as some libraries tamper with globals.\n     * The only conclusion that can be drawn is that the `self` global is available and likely behaves similar to how it would in a web worker.\n     */\n    isWebWorkerLike,\n    /**\n     * `true` if there is a `process` variable in the global scope with a `versions` property which has a `node` property.\n     *\n     * NOTE: this is not a guarantee that the code is actually running in nodejs, as some libraries tamper with globals.\n     * The only conclusion that can be drawn is that the `process` global is available and likely behaves similar to how it would in nodejs.\n     */\n    isNodeLike,\n    global: $global,\n    emptyArray,\n    emptyObject,\n    noop: $noop,\n    now: $now,\n    hasOwnProperty,\n    restore() {\n        Object.assign(PLATFORM, $PLATFORM);\n    },\n};\nexport const PLATFORM = { ...$PLATFORM };\n//# sourceMappingURL=platform.js.map","import * as AST from '@aurelia/runtime';\nconst astTypeMap = [\n    { type: AST.AccessKeyedExpression, name: 'AccessKeyedExpression' },\n    { type: AST.AccessMemberExpression, name: 'AccessMemberExpression' },\n    { type: AST.AccessScopeExpression, name: 'AccessScopeExpression' },\n    { type: AST.AccessThisExpression, name: 'AccessThisExpression' },\n    { type: AST.ArrayBindingPattern, name: 'ArrayBindingPattern' },\n    { type: AST.ArrayLiteralExpression, name: 'ArrayLiteralExpression' },\n    { type: AST.AssignExpression, name: 'AssignExpression' },\n    { type: AST.BinaryExpression, name: 'BinaryExpression' },\n    { type: AST.BindingBehaviorExpression, name: 'BindingBehaviorExpression' },\n    { type: AST.BindingIdentifier, name: 'BindingIdentifier' },\n    { type: AST.CallFunctionExpression, name: 'CallFunctionExpression' },\n    { type: AST.CallMemberExpression, name: 'CallMemberExpression' },\n    { type: AST.CallScopeExpression, name: 'CallScopeExpression' },\n    { type: AST.ConditionalExpression, name: 'ConditionalExpression' },\n    { type: AST.ForOfStatement, name: 'ForOfStatement' },\n    { type: AST.HtmlLiteralExpression, name: 'HtmlLiteralExpression' },\n    { type: AST.Interpolation, name: 'Interpolation' },\n    { type: AST.ObjectBindingPattern, name: 'ObjectBindingPattern' },\n    { type: AST.ObjectLiteralExpression, name: 'ObjectLiteralExpression' },\n    { type: AST.PrimitiveLiteralExpression, name: 'PrimitiveLiteralExpression' },\n    { type: AST.TaggedTemplateExpression, name: 'TaggedTemplateExpression' },\n    { type: AST.TemplateExpression, name: 'TemplateExpression' },\n    { type: AST.UnaryExpression, name: 'UnaryExpression' },\n    { type: AST.ValueConverterExpression, name: 'ValueConverterExpression' }\n];\nexport function enableImprovedExpressionDebugging() {\n    astTypeMap.forEach(x => { adoptDebugMethods(x.type, x.name); });\n}\n/** @internal */\nexport function adoptDebugMethods($type, name) {\n    $type.prototype.toString = function () { return Unparser.unparse(this); };\n}\nexport class Unparser {\n    constructor() {\n        this.text = '';\n    }\n    static unparse(expr) {\n        const visitor = new Unparser();\n        expr.accept(visitor);\n        return visitor.text;\n    }\n    visitAccessMember(expr) {\n        expr.object.accept(this);\n        this.text += `.${expr.name}`;\n    }\n    visitAccessKeyed(expr) {\n        expr.object.accept(this);\n        this.text += '[';\n        expr.key.accept(this);\n        this.text += ']';\n    }\n    visitAccessThis(expr) {\n        if (expr.ancestor === 0) {\n            this.text += '$this';\n            return;\n        }\n        this.text += '$parent';\n        let i = expr.ancestor - 1;\n        while (i--) {\n            this.text += '.$parent';\n        }\n    }\n    visitAccessScope(expr) {\n        let i = expr.ancestor;\n        while (i--) {\n            this.text += '$parent.';\n        }\n        this.text += expr.name;\n    }\n    visitArrayLiteral(expr) {\n        const elements = expr.elements;\n        this.text += '[';\n        for (let i = 0, length = elements.length; i < length; ++i) {\n            if (i !== 0) {\n                this.text += ',';\n            }\n            elements[i].accept(this);\n        }\n        this.text += ']';\n    }\n    visitObjectLiteral(expr) {\n        const keys = expr.keys;\n        const values = expr.values;\n        this.text += '{';\n        for (let i = 0, length = keys.length; i < length; ++i) {\n            if (i !== 0) {\n                this.text += ',';\n            }\n            this.text += `'${keys[i]}':`;\n            values[i].accept(this);\n        }\n        this.text += '}';\n    }\n    visitPrimitiveLiteral(expr) {\n        this.text += '(';\n        if (typeof expr.value === 'string') {\n            const escaped = expr.value.replace(/'/g, '\\\\\\'');\n            this.text += `'${escaped}'`;\n        }\n        else {\n            this.text += `${expr.value}`;\n        }\n        this.text += ')';\n    }\n    visitCallFunction(expr) {\n        this.text += '(';\n        expr.func.accept(this);\n        this.writeArgs(expr.args);\n        this.text += ')';\n    }\n    visitCallMember(expr) {\n        this.text += '(';\n        expr.object.accept(this);\n        this.text += `.${expr.name}`;\n        this.writeArgs(expr.args);\n        this.text += ')';\n    }\n    visitCallScope(expr) {\n        this.text += '(';\n        let i = expr.ancestor;\n        while (i--) {\n            this.text += '$parent.';\n        }\n        this.text += expr.name;\n        this.writeArgs(expr.args);\n        this.text += ')';\n    }\n    visitTemplate(expr) {\n        const { cooked, expressions } = expr;\n        const length = expressions.length;\n        this.text += '`';\n        this.text += cooked[0];\n        for (let i = 0; i < length; i++) {\n            expressions[i].accept(this);\n            this.text += cooked[i + 1];\n        }\n        this.text += '`';\n    }\n    visitTaggedTemplate(expr) {\n        const { cooked, expressions } = expr;\n        const length = expressions.length;\n        expr.func.accept(this);\n        this.text += '`';\n        this.text += cooked[0];\n        for (let i = 0; i < length; i++) {\n            expressions[i].accept(this);\n            this.text += cooked[i + 1];\n        }\n        this.text += '`';\n    }\n    visitUnary(expr) {\n        this.text += `(${expr.operation}`;\n        if (expr.operation.charCodeAt(0) >= /* a */ 97) {\n            this.text += ' ';\n        }\n        expr.expression.accept(this);\n        this.text += ')';\n    }\n    visitBinary(expr) {\n        this.text += '(';\n        expr.left.accept(this);\n        if (expr.operation.charCodeAt(0) === /* i */ 105) {\n            this.text += ` ${expr.operation} `;\n        }\n        else {\n            this.text += expr.operation;\n        }\n        expr.right.accept(this);\n        this.text += ')';\n    }\n    visitConditional(expr) {\n        this.text += '(';\n        expr.condition.accept(this);\n        this.text += '?';\n        expr.yes.accept(this);\n        this.text += ':';\n        expr.no.accept(this);\n        this.text += ')';\n    }\n    visitAssign(expr) {\n        this.text += '(';\n        expr.target.accept(this);\n        this.text += '=';\n        expr.value.accept(this);\n        this.text += ')';\n    }\n    visitValueConverter(expr) {\n        const args = expr.args;\n        expr.expression.accept(this);\n        this.text += `|${expr.name}`;\n        for (let i = 0, length = args.length; i < length; ++i) {\n            this.text += ':';\n            args[i].accept(this);\n        }\n    }\n    visitBindingBehavior(expr) {\n        const args = expr.args;\n        expr.expression.accept(this);\n        this.text += `&${expr.name}`;\n        for (let i = 0, length = args.length; i < length; ++i) {\n            this.text += ':';\n            args[i].accept(this);\n        }\n    }\n    visitArrayBindingPattern(expr) {\n        const elements = expr.elements;\n        this.text += '[';\n        for (let i = 0, length = elements.length; i < length; ++i) {\n            if (i !== 0) {\n                this.text += ',';\n            }\n            elements[i].accept(this);\n        }\n        this.text += ']';\n    }\n    visitObjectBindingPattern(expr) {\n        const keys = expr.keys;\n        const values = expr.values;\n        this.text += '{';\n        for (let i = 0, length = keys.length; i < length; ++i) {\n            if (i !== 0) {\n                this.text += ',';\n            }\n            this.text += `'${keys[i]}':`;\n            values[i].accept(this);\n        }\n        this.text += '}';\n    }\n    visitBindingIdentifier(expr) {\n        this.text += expr.name;\n    }\n    visitHtmlLiteral(expr) { throw new Error('visitHtmlLiteral'); }\n    visitForOfStatement(expr) {\n        expr.declaration.accept(this);\n        this.text += ' of ';\n        expr.iterable.accept(this);\n    }\n    visitInterpolation(expr) {\n        const { parts, expressions } = expr;\n        const length = expressions.length;\n        this.text += '${';\n        this.text += parts[0];\n        for (let i = 0; i < length; i++) {\n            expressions[i].accept(this);\n            this.text += parts[i + 1];\n        }\n        this.text += '}';\n    }\n    writeArgs(args) {\n        this.text += '(';\n        for (let i = 0, length = args.length; i < length; ++i) {\n            if (i !== 0) {\n                this.text += ',';\n            }\n            args[i].accept(this);\n        }\n        this.text += ')';\n    }\n}\nexport class Serializer {\n    static serialize(expr) {\n        const visitor = new Serializer();\n        if (expr == null || typeof expr.accept !== 'function') {\n            return `${expr}`;\n        }\n        return expr.accept(visitor);\n    }\n    visitAccessMember(expr) {\n        return `{\"type\":\"AccessMemberExpression\",\"name\":${expr.name},\"object\":${expr.object.accept(this)}}`;\n    }\n    visitAccessKeyed(expr) {\n        return `{\"type\":\"AccessKeyedExpression\",\"object\":${expr.object.accept(this)},\"key\":${expr.key.accept(this)}}`;\n    }\n    visitAccessThis(expr) {\n        return `{\"type\":\"AccessThisExpression\",\"ancestor\":${expr.ancestor}}`;\n    }\n    visitAccessScope(expr) {\n        return `{\"type\":\"AccessScopeExpression\",\"name\":\"${expr.name}\",\"ancestor\":${expr.ancestor}}`;\n    }\n    visitArrayLiteral(expr) {\n        return `{\"type\":\"ArrayLiteralExpression\",\"elements\":${this.serializeExpressions(expr.elements)}}`;\n    }\n    visitObjectLiteral(expr) {\n        return `{\"type\":\"ObjectLiteralExpression\",\"keys\":${serializePrimitives(expr.keys)},\"values\":${this.serializeExpressions(expr.values)}}`;\n    }\n    visitPrimitiveLiteral(expr) {\n        return `{\"type\":\"PrimitiveLiteralExpression\",\"value\":${serializePrimitive(expr.value)}}`;\n    }\n    visitCallFunction(expr) {\n        return `{\"type\":\"CallFunctionExpression\",\"func\":${expr.func.accept(this)},\"args\":${this.serializeExpressions(expr.args)}}`;\n    }\n    visitCallMember(expr) {\n        return `{\"type\":\"CallMemberExpression\",\"name\":\"${expr.name}\",\"object\":${expr.object.accept(this)},\"args\":${this.serializeExpressions(expr.args)}}`;\n    }\n    visitCallScope(expr) {\n        return `{\"type\":\"CallScopeExpression\",\"name\":\"${expr.name}\",\"ancestor\":${expr.ancestor},\"args\":${this.serializeExpressions(expr.args)}}`;\n    }\n    visitTemplate(expr) {\n        return `{\"type\":\"TemplateExpression\",\"cooked\":${serializePrimitives(expr.cooked)},\"expressions\":${this.serializeExpressions(expr.expressions)}}`;\n    }\n    visitTaggedTemplate(expr) {\n        return `{\"type\":\"TaggedTemplateExpression\",\"cooked\":${serializePrimitives(expr.cooked)},\"raw\":${serializePrimitives(expr.cooked.raw)},\"expressions\":${this.serializeExpressions(expr.expressions)}}`;\n    }\n    visitUnary(expr) {\n        return `{\"type\":\"UnaryExpression\",\"operation\":\"${expr.operation}\",\"expression\":${expr.expression.accept(this)}}`;\n    }\n    visitBinary(expr) {\n        return `{\"type\":\"BinaryExpression\",\"operation\":\"${expr.operation}\",\"left\":${expr.left.accept(this)},\"right\":${expr.right.accept(this)}}`;\n    }\n    visitConditional(expr) {\n        return `{\"type\":\"ConditionalExpression\",\"condition\":${expr.condition.accept(this)},\"yes\":${expr.yes.accept(this)},\"no\":${expr.no.accept(this)}}`;\n    }\n    visitAssign(expr) {\n        return `{\"type\":\"AssignExpression\",\"target\":${expr.target.accept(this)},\"value\":${expr.value.accept(this)}}`;\n    }\n    visitValueConverter(expr) {\n        return `{\"type\":\"ValueConverterExpression\",\"name\":\"${expr.name}\",\"expression\":${expr.expression.accept(this)},\"args\":${this.serializeExpressions(expr.args)}}`;\n    }\n    visitBindingBehavior(expr) {\n        return `{\"type\":\"BindingBehaviorExpression\",\"name\":\"${expr.name}\",\"expression\":${expr.expression.accept(this)},\"args\":${this.serializeExpressions(expr.args)}}`;\n    }\n    visitArrayBindingPattern(expr) {\n        return `{\"type\":\"ArrayBindingPattern\",\"elements\":${this.serializeExpressions(expr.elements)}}`;\n    }\n    visitObjectBindingPattern(expr) {\n        return `{\"type\":\"ObjectBindingPattern\",\"keys\":${serializePrimitives(expr.keys)},\"values\":${this.serializeExpressions(expr.values)}}`;\n    }\n    visitBindingIdentifier(expr) {\n        return `{\"type\":\"BindingIdentifier\",\"name\":\"${expr.name}\"}`;\n    }\n    visitHtmlLiteral(expr) { throw new Error('visitHtmlLiteral'); }\n    visitForOfStatement(expr) {\n        return `{\"type\":\"ForOfStatement\",\"declaration\":${expr.declaration.accept(this)},\"iterable\":${expr.iterable.accept(this)}}`;\n    }\n    visitInterpolation(expr) {\n        return `{\"type\":\"Interpolation\",\"cooked\":${serializePrimitives(expr.parts)},\"expressions\":${this.serializeExpressions(expr.expressions)}}`;\n    }\n    serializeExpressions(args) {\n        let text = '[';\n        for (let i = 0, ii = args.length; i < ii; ++i) {\n            if (i !== 0) {\n                text += ',';\n            }\n            text += args[i].accept(this);\n        }\n        text += ']';\n        return text;\n    }\n}\nfunction serializePrimitives(values) {\n    let text = '[';\n    for (let i = 0, ii = values.length; i < ii; ++i) {\n        if (i !== 0) {\n            text += ',';\n        }\n        text += serializePrimitive(values[i]);\n    }\n    text += ']';\n    return text;\n}\nfunction serializePrimitive(value) {\n    if (typeof value === 'string') {\n        return `\"\\\\\"${escapeString(value)}\\\\\"\"`;\n    }\n    else if (value == null) {\n        return `\"${value}\"`;\n    }\n    else {\n        return `${value}`;\n    }\n}\nfunction escapeString(str) {\n    let ret = '';\n    for (let i = 0, ii = str.length; i < ii; ++i) {\n        ret += escape(str.charAt(i));\n    }\n    return ret;\n}\nfunction escape(ch) {\n    switch (ch) {\n        case '\\b': return '\\\\b';\n        case '\\t': return '\\\\t';\n        case '\\n': return '\\\\n';\n        case '\\v': return '\\\\v';\n        case '\\f': return '\\\\f';\n        case '\\r': return '\\\\r';\n        case '\"': return '\\\\\"';\n        case '\\'': return '\\\\\\'';\n        case '\\\\': return '\\\\\\\\';\n        default: return ch;\n    }\n}\n//# sourceMappingURL=unparser.js.map","import { Reporter as RuntimeReporter } from '@aurelia/kernel';\nfunction applyFormat(message, ...params) {\n    while (message.includes('%s')) {\n        message = message.replace('%s', String(params.shift()));\n    }\n    return message;\n}\nexport const Reporter = {\n    ...RuntimeReporter,\n    get level() {\n        return RuntimeReporter.level;\n    },\n    write(code, ...params) {\n        const info = getMessageInfoForCode(code);\n        const message = `Code ${code}: ${info.message}`;\n        switch (info.level) {\n            case 1 /* debug */:\n                if (this.level <= 1 /* debug */) {\n                    console.debug(message, ...params);\n                }\n                break;\n            case 2 /* info */:\n                if (this.level <= 2 /* info */) {\n                    console.info(message, ...params);\n                }\n                break;\n            case 3 /* warn */:\n                if (this.level <= 3 /* warn */) {\n                    console.warn(message, ...params);\n                }\n                break;\n            case 4 /* error */: {\n                throw this.error(code, ...params);\n            }\n        }\n    },\n    error(code, ...params) {\n        const info = getMessageInfoForCode(code);\n        const error = new Error(`Code ${code}: ${applyFormat(info.message, ...params)}`);\n        error.data = params;\n        return error;\n    }\n};\nfunction getMessageInfoForCode(code) {\n    const info = codeLookup[code];\n    return info !== undefined ? info : createInvalidCodeMessageInfo(code);\n}\nfunction createInvalidCodeMessageInfo(code) {\n    return {\n        level: 4 /* error */,\n        message: `Attempted to report with unknown code ${code}.`\n    };\n}\nconst codeLookup = {\n    0: {\n        level: 3 /* warn */,\n        message: 'Cannot add observers to object.'\n    },\n    1: {\n        level: 3 /* warn */,\n        message: 'Cannot observe property of object.'\n    },\n    2: {\n        level: 2 /* info */,\n        message: 'Starting application in debug mode.'\n    },\n    3: {\n        level: 4 /* error */,\n        message: 'Runtime expression compilation is only available when including JIT support.'\n    },\n    4: {\n        level: 4 /* error */,\n        message: 'Invalid animation direction.'\n    },\n    5: {\n        level: 4 /* error */,\n        message: 'key/value cannot be null or undefined. Are you trying to inject/register something that doesn\\'t exist with DI?'\n    },\n    6: {\n        level: 4 /* error */,\n        message: 'Invalid resolver strategy specified.'\n    },\n    7: {\n        level: 4 /* error */,\n        message: 'Constructor Parameter with index cannot be null or undefined. Are you trying to inject/register something that doesn\\'t exist with DI?'\n    },\n    8: {\n        level: 4 /* error */,\n        message: 'Self binding behavior only supports events.'\n    },\n    9: {\n        level: 4 /* error */,\n        message: 'The updateTrigger binding behavior requires at least one event name argument: eg <input value.bind=\"firstName & updateTrigger:\\'blur\\'\">'\n    },\n    10: {\n        level: 4 /* error */,\n        message: 'The updateTrigger binding behavior can only be applied to two-way/ from-view bindings on input/select elements.'\n    },\n    11: {\n        level: 4 /* error */,\n        message: 'Only property bindings and string interpolation bindings can be signaled. Trigger, delegate and call bindings cannot be signaled.'\n    },\n    12: {\n        level: 4 /* error */,\n        message: 'Signal name is required.'\n    },\n    14: {\n        level: 4 /* error */,\n        message: 'Property cannot be assigned.'\n    },\n    15: {\n        level: 4 /* error */,\n        message: 'Unexpected call context.'\n    },\n    16: {\n        level: 4 /* error */,\n        message: 'A dependency registration is missing for the interface %s.'\n    },\n    17: {\n        level: 4 /* error */,\n        message: 'You can only define one default implementation for an interface.'\n    },\n    18: {\n        level: 4 /* error */,\n        message: 'You cannot observe a setter only property.'\n    },\n    19: {\n        level: 4 /* error */,\n        message: 'Value for expression is non-repeatable.'\n    },\n    20: {\n        level: 4 /* error */,\n        message: 'No template compiler found with the specified name. JIT support or a custom compiler is required.'\n    },\n    21: {\n        level: 4 /* error */,\n        message: 'You cannot combine the containerless custom element option with Shadow DOM.'\n    },\n    22: {\n        level: 4 /* error */,\n        message: 'A containerless custom element cannot be the root component of an application.'\n    },\n    30: {\n        level: 4 /* error */,\n        message: 'There are more targets than there are target instructions.'\n    },\n    31: {\n        level: 4 /* error */,\n        message: 'There are more target instructions than there are targets.'\n    },\n    100: {\n        level: 4 /* error */,\n        message: 'Invalid start of expression.'\n    },\n    101: {\n        level: 4 /* error */,\n        message: 'Unconsumed token.'\n    },\n    102: {\n        level: 4 /* error */,\n        message: 'Double dot and spread operators are not supported.'\n    },\n    103: {\n        level: 4 /* error */,\n        message: 'Invalid member expression.'\n    },\n    104: {\n        level: 4 /* error */,\n        message: 'Unexpected end of expression.'\n    },\n    105: {\n        level: 4 /* error */,\n        message: 'Expected identifier.'\n    },\n    106: {\n        level: 4 /* error */,\n        message: 'Invalid BindingIdentifier at left hand side of \"of\".'\n    },\n    107: {\n        level: 4 /* error */,\n        message: 'Invalid or unsupported property definition in object literal.'\n    },\n    108: {\n        level: 4 /* error */,\n        message: 'Unterminated quote in string literal.'\n    },\n    109: {\n        level: 4 /* error */,\n        message: 'Unterminated template string.'\n    },\n    110: {\n        level: 4 /* error */,\n        message: 'Missing expected token.'\n    },\n    111: {\n        level: 4 /* error */,\n        message: 'Unexpected character.'\n    },\n    150: {\n        level: 4 /* error */,\n        message: 'Left hand side of expression is not assignable.'\n    },\n    151: {\n        level: 4 /* error */,\n        message: 'Unexpected keyword \"of\"'\n    },\n    401: {\n        level: 3 /* warn */,\n        message: `AttributePattern is missing a handler for '%s'.`\n    },\n    402: {\n        level: 3 /* warn */,\n        message: `AttributePattern handler for '%s' is not a function.`\n    },\n    800: {\n        level: 4 /* error */,\n        message: `Property '%s' is being dirty-checked.`\n    },\n    801: {\n        level: 3 /* warn */,\n        message: `Property '%s' is being dirty-checked.`\n    },\n    2000: {\n        level: 4 /* error */,\n        message: 'Router has not been activated.'\n    },\n    2001: {\n        level: 4 /* error */,\n        message: 'Router has already been activated.'\n    },\n    2002: {\n        level: 4 /* error */,\n        message: 'Failed to resolve all viewports.'\n    },\n    2003: {\n        level: 4 /* error */,\n        message: 'Browser navigation has already been activated.'\n    },\n    2004: {\n        level: 4 /* error */,\n        message: 'LinkHandler has already been activated.'\n    },\n    1001: {\n        level: 2 /* info */,\n        message: 'DOM already initialized. Destroying and re-initializing..'\n    },\n    10000: {\n        level: 1 /* debug */,\n        message: '%s'\n    }\n};\n//# sourceMappingURL=reporter.js.map","import { PLATFORM, Reporter, Tracer } from '@aurelia/kernel';\nconst marker = {\n    objName: 'marker',\n    methodName: 'noop',\n    params: PLATFORM.emptyArray,\n    depth: -1,\n    prev: null,\n    next: null\n};\nclass TraceInfo {\n    constructor(objName, methodName, params) {\n        this.objName = objName;\n        this.methodName = methodName;\n        this.params = params;\n        this.objName = objName;\n        this.methodName = methodName;\n        this.depth = TraceInfo.stack.length;\n        this.params = params;\n        this.next = marker;\n        this.prev = TraceInfo.tail;\n        TraceInfo.tail.next = this;\n        TraceInfo.tail = this;\n        TraceInfo.stack.push(this);\n    }\n    static reset() {\n        let current = TraceInfo.head;\n        let next = null;\n        while (current != null) {\n            next = current.next;\n            current.next = null;\n            current.prev = null;\n            current.params = null;\n            current = next;\n        }\n        TraceInfo.head = marker;\n        TraceInfo.tail = marker;\n        TraceInfo.stack = [];\n    }\n    static enter(objName, methodName, params) {\n        return new TraceInfo(objName, methodName, params);\n    }\n    static leave() {\n        return TraceInfo.stack.pop();\n    }\n}\nTraceInfo.head = marker;\nTraceInfo.tail = marker;\nTraceInfo.stack = [];\nexport const DebugTracer = {\n    ...Tracer,\n    /**\n     * A convenience property for the user to conditionally call the tracer.\n     * This saves unnecessary `noop` and `slice` calls in non-AOT scenarios even if debugging is disabled.\n     * In AOT these calls will simply be removed entirely.\n     *\n     * This property **only** turns on tracing if `@aurelia/debug` is included and configured as well.\n     */\n    enabled: false,\n    liveLoggingEnabled: false,\n    liveWriter: null,\n    /**\n     * Call this at the start of a method/function.\n     * Each call to `enter` **must** have an accompanying call to `leave` for the tracer to work properly.\n     *\n     * @param objName - Any human-friendly name to identify the traced object with.\n     * @param methodName - Any human-friendly name to identify the traced method with.\n     * @param args - Pass in `Array.prototype.slice.call(arguments)` to also trace the parameters, or `null` if this is not needed (to save memory/cpu)\n     */\n    enter(objName, methodName, args) {\n        if (this.enabled) {\n            const info = TraceInfo.enter(objName, methodName, args);\n            if (this.liveLoggingEnabled) {\n                this.liveWriter.write(info);\n            }\n        }\n    },\n    /**\n     * Call this at the end of a method/function. Pops one trace item off the stack.\n     */\n    leave() {\n        if (this.enabled) {\n            TraceInfo.leave();\n        }\n    },\n    /**\n     * Writes only the trace info leading up to the current method call.\n     *\n     * @param writer - An object to write the output to.\n     */\n    writeStack(writer) {\n        let i = 0;\n        const stack = TraceInfo.stack;\n        const len = stack.length;\n        while (i < len) {\n            writer.write(stack[i]);\n            ++i;\n        }\n    },\n    /**\n     * Writes all trace info captured since the previous flushAll operation.\n     *\n     * @param writer - An object to write the output to. Can be null to simply reset the tracer state.\n     */\n    flushAll(writer) {\n        if (writer != null) {\n            let current = TraceInfo.head.next; // skip the marker\n            while (current != null && current !== marker) {\n                writer.write(current);\n                current = current.next;\n            }\n        }\n        TraceInfo.reset();\n    },\n    enableLiveLogging,\n    /**\n     * Stops writing out each trace info item as they are traced.\n     */\n    disableLiveLogging() {\n        this.liveLoggingEnabled = false;\n        this.liveWriter = null;\n    }\n};\nconst defaultOptions = {\n    rendering: true,\n    binding: true,\n    observation: true,\n    beforeAttach: true,\n    mounting: true,\n    di: true,\n    lifecycle: true,\n    jit: true\n};\nfunction enableLiveLogging(optionsOrWriter) {\n    this.liveLoggingEnabled = true;\n    if (optionsOrWriter && 'write' in optionsOrWriter) {\n        this.liveWriter = optionsOrWriter;\n    }\n    else {\n        const options = optionsOrWriter !== undefined ? optionsOrWriter : defaultOptions;\n        this.liveWriter = createLiveTraceWriter(options);\n    }\n}\nconst toString = Object.prototype.toString;\nfunction flagsText(info, i = 0) {\n    if (info.params != null && info.params.length > i) {\n        return stringifyLifecycleFlags(info.params[i]);\n    }\n    return 'none';\n}\nfunction _ctorName(obj) {\n    let name;\n    if (obj === undefined) {\n        name = 'undefined';\n    }\n    else if (obj === null) {\n        name = 'null';\n    }\n    else if (obj.constructor !== undefined) {\n        if (obj.constructor.description) {\n            name = `Resource{'${obj.constructor.description.name}'}`;\n        }\n        else {\n            name = obj.constructor.name;\n        }\n    }\n    else if (typeof obj === 'string') {\n        name = `'${obj}'`;\n    }\n    else {\n        name = toString.call(obj);\n    }\n    return name;\n}\nfunction ctorName(info, i = 0) {\n    if (info.params != null && info.params.length > i) {\n        return _ctorName(info.params[i]);\n    }\n    return 'undefined';\n}\nfunction scopeText(info, i = 0) {\n    let $ctorName;\n    if (info.params != null && info.params.length > i) {\n        const $scope = info.params[i];\n        if ($scope != null && $scope.bindingContext != null) {\n            $ctorName = _ctorName($scope.bindingContext);\n        }\n        else {\n            $ctorName = 'undefined';\n        }\n        return `Scope{${$ctorName}}`;\n    }\n    return 'undefined';\n}\nfunction keyText(info, i = 0) {\n    if (info.params != null && info.params.length > i) {\n        const $key = info.params[i];\n        if (typeof $key === 'string') {\n            return `'${$key}'`;\n        }\n        if ($key !== undefined && Reflect.has($key, 'friendlyName')) {\n            return $key['friendlyName'];\n        }\n        return _ctorName($key);\n    }\n    return 'undefined';\n}\nfunction primitive(info, i = 0) {\n    if (info.params != null && info.params.length > i) {\n        const $key = info.params[i];\n        if (typeof $key === 'string') {\n            return `'${$key}'`;\n        }\n        return $key.toString();\n    }\n    return 'undefined';\n}\nconst RenderingArgsProcessor = {\n    $hydrate(info) {\n        return flagsText(info);\n    },\n    render(info) {\n        return `${flagsText(info)},IDOM,IContainer,${ctorName(info, 3)}`;\n    },\n    addBinding(info) {\n        return `${ctorName(info)},${ctorName(info, 1)}`;\n    },\n    addComponent(info) {\n        return `${ctorName(info)},${ctorName(info, 1)}`;\n    }\n};\nconst BindingArgsProcessor = {\n    $bind(info) {\n        return flagsText(info);\n    },\n    $unbind(info) {\n        return flagsText(info);\n    },\n    connect(info) {\n        return flagsText(info);\n    },\n    // currently only observers trace constructor calls but keep an eye on this if others are added, then we'd need additional filtering\n    constructor(info) {\n        switch (info.objName) {\n            case 'ArrayObserver':\n            case 'MapObserver':\n            case 'SetObserver':\n                return flagsText(info);\n            case 'SetterObserver':\n            case 'BindableObserver':\n                return `${flagsText(info)},${ctorName(info, 1)},${primitive(info, 2)}`;\n            case 'ProxyObserver':\n                return ctorName(info);\n            case 'ProxySubscriberCollection':\n            case 'DirtyCheckProperty':\n                return `${ctorName(info, 1)},${primitive(info, 2)}`;\n            case 'PrimitiveObserver':\n            case 'PropertyAccessor':\n                return `${ctorName(info)},${primitive(info, 1)}`;\n            default:\n                return '';\n        }\n    },\n    lockedBind(info) {\n        return flagsText(info);\n    },\n    lockedUnbind(info) {\n        return flagsText(info);\n    },\n    InternalObserversLookup(info) {\n        return `${flagsText(info)},${ctorName(info, 1)},${primitive(info, 2)}`;\n    },\n    BindingContext(info) {\n        switch (info.methodName) {\n            case 'get':\n                return `${scopeText(info)},${primitive(info, 1)},${primitive(info, 2)},${flagsText(info, 3)}`;\n            case 'getObservers':\n                return flagsText(info);\n            default:\n                return 'unknown';\n        }\n    },\n    Scope(info) {\n        switch (info.methodName) {\n            case 'create':\n                return `${flagsText(info)},${ctorName(info, 1)},${ctorName(info, 2)}`;\n            case 'fromOverride':\n                return `${flagsText(info)},${ctorName(info, 1)}`;\n            case 'fromParent':\n                return `${flagsText(info)},${scopeText(info, 1)},${ctorName(info, 2)}`;\n            default:\n                return 'unknown';\n        }\n    },\n    OverrideContext(info) {\n        switch (info.methodName) {\n            case 'create':\n                return `${flagsText(info)},${ctorName(info, 1)},${ctorName(info, 2)}`;\n            case 'getObservers':\n                return '';\n            default:\n                return 'unknown';\n        }\n    }\n};\nconst ObservationArgsProcessor = {\n    callSource(info) {\n        const names = [];\n        switch (info.objName) {\n            case 'Listener':\n                return (info.params[0]).type;\n            case 'CallBinding':\n                if (info.params != null) {\n                    for (let i = 0, ii = info.params.length; i < ii; ++i) {\n                        names.push(ctorName(info, i));\n                    }\n                }\n                return names.join(',');\n            default:\n                return 'unknown';\n        }\n    },\n    setValue(info) {\n        let valueText;\n        const value = info.params[0];\n        switch (typeof value) {\n            case 'undefined':\n                valueText = 'undefined';\n                break;\n            case 'object':\n                if (value === null) {\n                    valueText = 'null';\n                }\n                else {\n                    valueText = _ctorName(value);\n                }\n                break;\n            case 'string':\n                valueText = `'${value}'`;\n                break;\n            case 'number':\n                valueText = value.toString();\n                break;\n            default:\n                valueText = _ctorName(value);\n        }\n        return `${valueText},${flagsText(info, 1)}`;\n    },\n    flush(info) {\n        return flagsText(info);\n    },\n    handleChange(info) {\n        return `${primitive(info)},${primitive(info, 1)},${flagsText(info, 2)}`;\n    },\n    lockScope(info) {\n        return scopeText(info);\n    }\n};\nconst AttachingArgsProcessor = {\n    $attach(info) {\n        return flagsText(info);\n    },\n    $detach(info) {\n        return flagsText(info);\n    },\n    $cache(info) {\n        return flagsText(info);\n    },\n    hold(info) {\n        return `Node{'${(info.params[0]).textContent}'}`;\n    },\n    release(info) {\n        return flagsText(info);\n    }\n};\nconst MountingArgsProcessor = {\n    $mount(info) {\n        return flagsText(info);\n    },\n    $unmount(info) {\n        return flagsText(info);\n    },\n    project(info) {\n        return ctorName(info);\n    },\n    take(info) {\n        return ctorName(info);\n    }\n};\nconst DIArgsProcessor = {\n    construct(info) {\n        return ctorName(info);\n    },\n    Container(info) {\n        const names = [];\n        switch (info.methodName) {\n            case 'get':\n            case 'getAll':\n                return keyText(info);\n            case 'register':\n                if (info.params != null) {\n                    for (let i = 0, ii = info.params.length; i < ii; ++i) {\n                        names.push(keyText(info, i));\n                    }\n                }\n                return names.join(',');\n            case 'createChild':\n                return '';\n            default:\n                return 'unknown';\n        }\n    }\n};\nconst LifecycleArgsProcessor = {\n    Lifecycle(info) {\n        switch (info.methodName.slice(0, 3)) {\n            case 'beg':\n                return '';\n            case 'enq':\n                return ctorName(info);\n            case 'end':\n            case 'pro':\n                return flagsText(info);\n            default:\n                return 'unknown';\n        }\n    },\n    CompositionCoordinator(info) {\n        switch (info.methodName) {\n            case 'enqueue':\n                return 'IController';\n            case 'swap':\n                return `IController,${flagsText(info, 1)}`;\n            case 'processNext':\n                return '';\n            default:\n                return 'unknown';\n        }\n    },\n    AggregateLifecycleTask(info) {\n        switch (info.methodName) {\n            case 'addTask':\n            case 'removeTask':\n                return ctorName(info);\n            case 'complete':\n                return `${primitive(info, 2)}`;\n            default:\n                return 'unknown';\n        }\n    }\n};\nconst JitArgsProcessor = {\n    TemplateBinder(info) {\n        return ''; // TODO\n    }\n};\nfunction createLiveTraceWriter(options) {\n    const Processors = {};\n    if (options.rendering) {\n        Object.assign(Processors, RenderingArgsProcessor);\n    }\n    if (options.binding) {\n        Object.assign(Processors, BindingArgsProcessor);\n    }\n    if (options.observation) {\n        Object.assign(Processors, ObservationArgsProcessor);\n    }\n    if (options.beforeAttach) {\n        Object.assign(Processors, AttachingArgsProcessor);\n    }\n    if (options.mounting) {\n        Object.assign(Processors, MountingArgsProcessor);\n    }\n    if (options.di) {\n        Object.assign(Processors, DIArgsProcessor);\n    }\n    if (options.lifecycle) {\n        Object.assign(Processors, LifecycleArgsProcessor);\n    }\n    if (options.jit) {\n        Object.assign(Processors, JitArgsProcessor);\n    }\n    return {\n        write(info) {\n            let output;\n            if (Processors[info.methodName] !== undefined) {\n                output = Processors[info.methodName](info);\n            }\n            else if (Processors[info.objName] !== undefined) {\n                output = Processors[info.objName](info);\n            }\n            else {\n                return;\n            }\n            Reporter.write(10000, `${'-'.repeat(info.depth)}${info.objName}.${info.methodName}(${output})`);\n        }\n    };\n}\nexport function stringifyLifecycleFlags(flags) {\n    const flagNames = [];\n    if (flags & 2097152 /* mustEvaluate */) {\n        flagNames.push('mustEvaluate');\n    }\n    if (flags & 16777216 /* isCollectionMutation */) {\n        flagNames.push('isCollectionMutation');\n    }\n    if (flags & 16 /* updateTargetInstance */) {\n        flagNames.push('updateTargetInstance');\n    }\n    if (flags & 32 /* updateSourceExpression */) {\n        flagNames.push('updateSourceExpression');\n    }\n    if (flags & 64 /* fromAsyncFlush */) {\n        flagNames.push('fromAsyncFlush');\n    }\n    if (flags & 128 /* fromSyncFlush */) {\n        flagNames.push('fromSyncFlush');\n    }\n    if (flags & 256 /* fromTick */) {\n        flagNames.push('fromTick');\n    }\n    if (flags & 1024 /* fromStartTask */) {\n        flagNames.push('fromStartTask');\n    }\n    if (flags & 2048 /* fromStopTask */) {\n        flagNames.push('fromStopTask');\n    }\n    if (flags & 4096 /* fromBind */) {\n        flagNames.push('fromBind');\n    }\n    if (flags & 8192 /* fromUnbind */) {\n        flagNames.push('fromUnbind');\n    }\n    if (flags & 16384 /* fromAttach */) {\n        flagNames.push('fromAttach');\n    }\n    if (flags & 32768 /* fromDetach */) {\n        flagNames.push('fromDetach');\n    }\n    if (flags & 65536 /* fromCache */) {\n        flagNames.push('fromCache');\n    }\n    if (flags & 131072 /* fromDOMEvent */) {\n        flagNames.push('fromDOMEvent');\n    }\n    if (flags & 262144 /* fromLifecycleTask */) {\n        flagNames.push('fromLifecycleTask');\n    }\n    if (flags & 4194304 /* isTraversingParentScope */) {\n        flagNames.push('isTraversingParentScope');\n    }\n    if (flags & 67108864 /* allowParentScopeTraversal */) {\n        flagNames.push('allowParentScopeTraversal');\n    }\n    if (flags & 1 /* getterSetterStrategy */) {\n        flagNames.push('getterSetterStrategy');\n    }\n    if (flags & 2 /* proxyStrategy */) {\n        flagNames.push('proxyStrategy');\n    }\n    if (flags & 1073741824 /* secondaryExpression */) {\n        flagNames.push('secondaryExpression');\n    }\n    if (flagNames.length === 0) {\n        return 'none';\n    }\n    return flagNames.join('|');\n}\n//# sourceMappingURL=tracer.js.map","import { DI } from '@aurelia/kernel';\nexport const IAttrSyntaxTransformer = DI\n    .createInterface('IAttrSyntaxTransformer')\n    .noDefault();\n//# sourceMappingURL=attribute-syntax-transformer.js.map","import { __decorate } from \"tslib\";\nimport { bindingCommand, getTarget, } from '@aurelia/jit';\nimport { RefBindingInstruction } from '@aurelia/runtime';\nimport { AttributeBindingInstruction, CaptureBindingInstruction, DelegateBindingInstruction, TriggerBindingInstruction } from '@aurelia/runtime-html';\n/**\n * Trigger binding command. Compile attr with binding symbol with command `trigger` to `TriggerBindingInstruction`\n */\nlet TriggerBindingCommand = class TriggerBindingCommand {\n    constructor() {\n        this.bindingType = 4182 /* TriggerCommand */;\n    }\n    compile(binding) {\n        return new TriggerBindingInstruction(binding.expression, getTarget(binding, false));\n    }\n};\nTriggerBindingCommand = __decorate([\n    bindingCommand('trigger')\n], TriggerBindingCommand);\nexport { TriggerBindingCommand };\n/**\n * Delegate binding command. Compile attr with binding symbol with command `delegate` to `DelegateBindingInstruction`\n */\nlet DelegateBindingCommand = class DelegateBindingCommand {\n    constructor() {\n        this.bindingType = 4184 /* DelegateCommand */;\n    }\n    compile(binding) {\n        return new DelegateBindingInstruction(binding.expression, getTarget(binding, false));\n    }\n};\nDelegateBindingCommand = __decorate([\n    bindingCommand('delegate')\n], DelegateBindingCommand);\nexport { DelegateBindingCommand };\n/**\n * Capture binding command. Compile attr with binding symbol with command `capture` to `CaptureBindingInstruction`\n */\nlet CaptureBindingCommand = class CaptureBindingCommand {\n    constructor() {\n        this.bindingType = 4183 /* CaptureCommand */;\n    }\n    compile(binding) {\n        return new CaptureBindingInstruction(binding.expression, getTarget(binding, false));\n    }\n};\nCaptureBindingCommand = __decorate([\n    bindingCommand('capture')\n], CaptureBindingCommand);\nexport { CaptureBindingCommand };\n/**\n * Attr binding command. Compile attr with binding symbol with command `attr` to `AttributeBindingInstruction`\n */\nlet AttrBindingCommand = class AttrBindingCommand {\n    constructor() {\n        this.bindingType = 32 /* IsProperty */;\n    }\n    compile(binding) {\n        const target = getTarget(binding, false);\n        return new AttributeBindingInstruction(target, binding.expression, target);\n    }\n};\nAttrBindingCommand = __decorate([\n    bindingCommand('attr')\n], AttrBindingCommand);\nexport { AttrBindingCommand };\n/**\n * Style binding command. Compile attr with binding symbol with command `style` to `AttributeBindingInstruction`\n */\nlet StyleBindingCommand = class StyleBindingCommand {\n    constructor() {\n        this.bindingType = 32 /* IsProperty */;\n    }\n    compile(binding) {\n        return new AttributeBindingInstruction('style', binding.expression, getTarget(binding, false));\n    }\n};\nStyleBindingCommand = __decorate([\n    bindingCommand('style')\n], StyleBindingCommand);\nexport { StyleBindingCommand };\n/**\n * Class binding command. Compile attr with binding symbol with command `class` to `AttributeBindingInstruction`\n */\nlet ClassBindingCommand = class ClassBindingCommand {\n    constructor() {\n        this.bindingType = 32 /* IsProperty */;\n    }\n    compile(binding) {\n        return new AttributeBindingInstruction('class', binding.expression, getTarget(binding, false));\n    }\n};\nClassBindingCommand = __decorate([\n    bindingCommand('class')\n], ClassBindingCommand);\nexport { ClassBindingCommand };\n/**\n * Binding command to refer different targets (element, custom element/attribute view models, controller) afterAttach to an element\n */\nlet RefBindingCommand = class RefBindingCommand {\n    constructor() {\n        this.bindingType = 32 /* IsProperty */ | 4096 /* IgnoreCustomAttr */;\n    }\n    compile(binding) {\n        return new RefBindingInstruction(binding.expression, getTarget(binding, false));\n    }\n};\nRefBindingCommand = __decorate([\n    bindingCommand('ref')\n], RefBindingCommand);\nexport { RefBindingCommand };\n//# sourceMappingURL=binding-commands.js.map","import { BindingSymbol, CustomAttributeSymbol, CustomElementSymbol as $CustomElementSymbol, LetElementSymbol as $LetElementSymbol, PlainAttributeSymbol, PlainElementSymbol as $PlainElementSymbol, ReplacePartSymbol as $ReplacePartSymbol, TemplateControllerSymbol as $TemplateControllerSymbol, TextSymbol as $TextSymbol, } from '@aurelia/jit';\nexport const CustomElementSymbol = $CustomElementSymbol;\nexport const LetElementSymbol = $LetElementSymbol;\nexport const PlainElementSymbol = $PlainElementSymbol;\nexport const ReplacePartSymbol = $ReplacePartSymbol;\nexport const TemplateControllerSymbol = $TemplateControllerSymbol;\nexport const TextSymbol = $TextSymbol;\nexport { BindingSymbol, CustomAttributeSymbol, PlainAttributeSymbol, };\n//# sourceMappingURL=semantic-model.js.map","/* eslint-disable compat/compat */\nimport { BindableInfo, } from '@aurelia/jit';\nimport { camelCase, } from '@aurelia/kernel';\nimport { BindingMode } from '@aurelia/runtime';\nimport { BindingSymbol, CustomAttributeSymbol, CustomElementSymbol, LetElementSymbol, PlainAttributeSymbol, PlainElementSymbol, ReplacePartSymbol, TemplateControllerSymbol, TextSymbol, } from './semantic-model';\nconst invalidSurrogateAttribute = Object.assign(Object.create(null), {\n    'id': true,\n    'replace': true\n});\nconst attributesToIgnore = Object.assign(Object.create(null), {\n    'as-element': true,\n    'replace': true\n});\nfunction hasInlineBindings(rawValue) {\n    const len = rawValue.length;\n    let ch = 0;\n    for (let i = 0; i < len; ++i) {\n        ch = rawValue.charCodeAt(i);\n        if (ch === 92 /* Backslash */) {\n            ++i;\n            // Ignore whatever comes next because it's escaped\n        }\n        else if (ch === 58 /* Colon */) {\n            return true;\n        }\n        else if (ch === 36 /* Dollar */ && rawValue.charCodeAt(i + 1) === 123 /* OpenBrace */) {\n            return false;\n        }\n    }\n    return false;\n}\nfunction processInterpolationText(symbol) {\n    const node = symbol.physicalNode;\n    const parentNode = node.parentNode;\n    while (node.nextSibling !== null && node.nextSibling.nodeType === 3 /* Text */) {\n        parentNode.removeChild(node.nextSibling);\n    }\n    node.textContent = '';\n    parentNode.insertBefore(symbol.marker, node);\n}\nfunction isTemplateControllerOf(proxy, manifest) {\n    return proxy !== manifest;\n}\n/**\n * A (temporary) standalone function that purely does the DOM processing (lifting) related to template controllers.\n * It's a first refactoring step towards separating DOM parsing/binding from mutations.\n */\nfunction processTemplateControllers(dom, manifestProxy, manifest) {\n    const manifestNode = manifest.physicalNode;\n    let current = manifestProxy;\n    let currentTemplate;\n    while (isTemplateControllerOf(current, manifest)) {\n        if (current.template === manifest) {\n            // the DOM linkage is still in its original state here so we can safely assume the parentNode is non-null\n            manifestNode.parentNode.replaceChild(current.marker, manifestNode);\n            // if the manifest is a template element (e.g. <template repeat.for=\"...\">) then we can skip one lift operation\n            // and simply use the template directly, saving a bit of work\n            if (manifestNode.nodeName === 'TEMPLATE') {\n                current.physicalNode = manifestNode;\n                // the template could safely stay without affecting anything visible, but let's keep the DOM tidy\n                manifestNode.remove();\n            }\n            else {\n                // the manifest is not a template element so we need to wrap it in one\n                currentTemplate = current.physicalNode = dom.createTemplate();\n                currentTemplate.content.appendChild(manifestNode);\n            }\n        }\n        else {\n            currentTemplate = current.physicalNode = dom.createTemplate();\n            currentTemplate.content.appendChild(current.marker);\n        }\n        manifestNode.removeAttribute(current.syntax.rawName);\n        current = current.template;\n    }\n}\nfunction processReplacePart(dom, replacePart, manifestProxy) {\n    let proxyNode;\n    let currentTemplate;\n    if ((manifestProxy.flags & 512 /* hasMarker */) > 0) {\n        proxyNode = manifestProxy.marker;\n    }\n    else {\n        proxyNode = manifestProxy.physicalNode;\n    }\n    if (proxyNode.nodeName === 'TEMPLATE') {\n        // if it's a template element, no need to do anything special, just assign it to the replacePart\n        replacePart.physicalNode = proxyNode;\n    }\n    else {\n        // otherwise wrap the replace in a template\n        currentTemplate = replacePart.physicalNode = dom.createTemplate();\n        currentTemplate.content.appendChild(proxyNode);\n    }\n}\n/**\n * TemplateBinder. Todo: describe goal of this class\n */\nexport class TemplateBinder {\n    constructor(dom, resources, attrParser, exprParser, attrSyntaxTransformer) {\n        this.dom = dom;\n        this.resources = resources;\n        this.attrParser = attrParser;\n        this.exprParser = exprParser;\n        this.attrSyntaxTransformer = attrSyntaxTransformer;\n    }\n    bind(node) {\n        const surrogate = new PlainElementSymbol(this.dom, node);\n        const resources = this.resources;\n        const attrSyntaxTransformer = this.attrSyntaxTransformer;\n        const attributes = node.attributes;\n        let i = 0;\n        while (i < attributes.length) {\n            const attr = attributes[i];\n            const attrSyntax = this.attrParser.parse(attr.name, attr.value);\n            if (invalidSurrogateAttribute[attrSyntax.target] === true) {\n                throw new Error(`Invalid surrogate attribute: ${attrSyntax.target}`);\n                // TODO: use reporter\n            }\n            const bindingCommand = resources.getBindingCommand(attrSyntax, true);\n            if (bindingCommand === null || (bindingCommand.bindingType & 4096 /* IgnoreCustomAttr */) === 0) {\n                const attrInfo = resources.getAttributeInfo(attrSyntax);\n                if (attrInfo === null) {\n                    // map special html attributes to their corresponding properties\n                    attrSyntaxTransformer.transform(node, attrSyntax);\n                    // it's not a custom attribute but might be a regular bound attribute or interpolation (it might also be nothing)\n                    this.bindPlainAttribute(\n                    /* attrSyntax */ attrSyntax, \n                    /* attr       */ attr, \n                    /* surrogate  */ surrogate, \n                    /* manifest   */ surrogate);\n                }\n                else if (attrInfo.isTemplateController) {\n                    throw new Error('Cannot have template controller on surrogate element.');\n                    // TODO: use reporter\n                }\n                else {\n                    this.bindCustomAttribute(\n                    /* attrSyntax */ attrSyntax, \n                    /* attrInfo   */ attrInfo, \n                    /* command    */ bindingCommand, \n                    /* manifest   */ surrogate);\n                }\n            }\n            else {\n                // map special html attributes to their corresponding properties\n                attrSyntaxTransformer.transform(node, attrSyntax);\n                // it's not a custom attribute but might be a regular bound attribute or interpolation (it might also be nothing)\n                this.bindPlainAttribute(\n                /* attrSyntax */ attrSyntax, \n                /* attr       */ attr, \n                /* surrogate  */ surrogate, \n                /* manifest   */ surrogate);\n            }\n            ++i;\n        }\n        this.bindChildNodes(\n        /* node               */ node, \n        /* surrogate          */ surrogate, \n        /* manifest           */ surrogate, \n        /* manifestRoot       */ null, \n        /* parentManifestRoot */ null, \n        /* partName           */ null);\n        return surrogate;\n    }\n    bindManifest(parentManifest, node, surrogate, manifest, manifestRoot, parentManifestRoot, partName) {\n        switch (node.nodeName) {\n            case 'LET':\n                // let cannot have children and has some different processing rules, so return early\n                this.bindLetElement(\n                /* parentManifest */ parentManifest, \n                /* node           */ node);\n                return;\n            case 'SLOT':\n                surrogate.hasSlots = true;\n        }\n        // get the part name to override the name of the compiled definition\n        partName = node.getAttribute('replaceable');\n        if (partName === '') {\n            partName = 'default';\n        }\n        let name = node.getAttribute('as-element');\n        if (name === null) {\n            name = node.nodeName.toLowerCase();\n        }\n        const elementInfo = this.resources.getElementInfo(name);\n        if (elementInfo === null) {\n            // there is no registered custom element with this name\n            manifest = new PlainElementSymbol(this.dom, node);\n        }\n        else {\n            // it's a custom element so we set the manifestRoot as well (for storing replaces)\n            parentManifestRoot = manifestRoot;\n            manifestRoot = manifest = new CustomElementSymbol(this.dom, node, elementInfo);\n        }\n        // lifting operations done by template controllers and replaces effectively unlink the nodes, so start at the bottom\n        this.bindChildNodes(\n        /* node               */ node, \n        /* surrogate          */ surrogate, \n        /* manifest           */ manifest, \n        /* manifestRoot       */ manifestRoot, \n        /* parentManifestRoot */ parentManifestRoot, \n        /* partName           */ partName);\n        // the parentManifest will receive either the direct child nodes, or the template controllers / replaces\n        // wrapping them\n        this.bindAttributes(\n        /* node               */ node, \n        /* parentManifest     */ parentManifest, \n        /* surrogate          */ surrogate, \n        /* manifest           */ manifest, \n        /* manifestRoot       */ manifestRoot, \n        /* parentManifestRoot */ parentManifestRoot, \n        /* partName           */ partName);\n        if (manifestRoot === manifest && manifest.isContainerless) {\n            node.parentNode.replaceChild(manifest.marker, node);\n        }\n        else if (manifest.isTarget) {\n            node.classList.add('au');\n        }\n    }\n    bindLetElement(parentManifest, node) {\n        const symbol = new LetElementSymbol(this.dom, node);\n        parentManifest.childNodes.push(symbol);\n        const attributes = node.attributes;\n        let i = 0;\n        while (i < attributes.length) {\n            const attr = attributes[i];\n            if (attr.name === 'to-binding-context') {\n                node.removeAttribute('to-binding-context');\n                symbol.toBindingContext = true;\n                continue;\n            }\n            const attrSyntax = this.attrParser.parse(attr.name, attr.value);\n            const command = this.resources.getBindingCommand(attrSyntax, false);\n            const bindingType = command === null ? 2048 /* Interpolation */ : command.bindingType;\n            const expr = this.exprParser.parse(attrSyntax.rawValue, bindingType);\n            const to = camelCase(attrSyntax.target);\n            const info = new BindableInfo(to, BindingMode.toView);\n            symbol.bindings.push(new BindingSymbol(command, info, expr, attrSyntax.rawValue, to));\n            ++i;\n        }\n        node.parentNode.replaceChild(symbol.marker, node);\n    }\n    bindAttributes(node, parentManifest, surrogate, manifest, manifestRoot, parentManifestRoot, partName) {\n        // This is the top-level symbol for the current depth.\n        // If there are no template controllers or replaces, it is always the manifest itself.\n        // If there are template controllers, then this will be the outer-most TemplateControllerSymbol.\n        let manifestProxy = manifest;\n        let previousController = (void 0);\n        let currentController = (void 0);\n        const attributes = node.attributes;\n        let i = 0;\n        while (i < attributes.length) {\n            const attr = attributes[i];\n            ++i;\n            if (attributesToIgnore[attr.name] === true) {\n                continue;\n            }\n            const attrSyntax = this.attrParser.parse(attr.name, attr.value);\n            const bindingCommand = this.resources.getBindingCommand(attrSyntax, true);\n            if (bindingCommand === null || (bindingCommand.bindingType & 4096 /* IgnoreCustomAttr */) === 0) {\n                const attrInfo = this.resources.getAttributeInfo(attrSyntax);\n                if (attrInfo === null) {\n                    // map special html attributes to their corresponding properties\n                    this.attrSyntaxTransformer.transform(node, attrSyntax);\n                    // it's not a custom attribute but might be a regular bound attribute or interpolation (it might also be nothing)\n                    this.bindPlainAttribute(\n                    /* attrSyntax */ attrSyntax, \n                    /* attr       */ attr, \n                    /* surrogate  */ surrogate, \n                    /* manifest   */ manifest);\n                }\n                else if (attrInfo.isTemplateController) {\n                    // the manifest is wrapped by the inner-most template controller (if there are multiple on the same element)\n                    // so keep setting manifest.templateController to the latest template controller we find\n                    currentController = manifest.templateController = this.declareTemplateController(\n                    /* attrSyntax */ attrSyntax, \n                    /* attrInfo   */ attrInfo, \n                    /* partName   */ partName);\n                    // the proxy and the manifest are only identical when we're at the first template controller (since the controller\n                    // is assigned to the proxy), so this evaluates to true at most once per node\n                    if (manifestProxy === manifest) {\n                        currentController.template = manifest;\n                        manifestProxy = currentController;\n                    }\n                    else {\n                        currentController.templateController = previousController;\n                        currentController.template = previousController.template;\n                        previousController.template = currentController;\n                    }\n                    previousController = currentController;\n                }\n                else {\n                    // a regular custom attribute\n                    this.bindCustomAttribute(\n                    /* attrSyntax */ attrSyntax, \n                    /* attrInfo   */ attrInfo, \n                    /* command    */ bindingCommand, \n                    /* manifest   */ manifest);\n                }\n            }\n            else {\n                // map special html attributes to their corresponding properties\n                this.attrSyntaxTransformer.transform(node, attrSyntax);\n                // it's not a custom attribute but might be a regular bound attribute or interpolation (it might also be nothing)\n                this.bindPlainAttribute(\n                /* attrSyntax */ attrSyntax, \n                /* attr       */ attr, \n                /* surrogate  */ surrogate, \n                /* manifest   */ manifest);\n            }\n        }\n        if (node.tagName === 'INPUT') {\n            const type = node.type;\n            if (type === 'checkbox' || type === 'radio') {\n                this.ensureAttributeOrder(manifest);\n            }\n        }\n        processTemplateControllers(this.dom, manifestProxy, manifest);\n        let replace = node.getAttribute('replace');\n        if (replace === '' || (replace === null && manifestRoot !== null && manifestRoot.isContainerless && ((parentManifest.flags & 16 /* isCustomElement */) > 0))) {\n            replace = 'default';\n        }\n        const partOwner = manifest === manifestRoot ? parentManifestRoot : manifestRoot;\n        if (replace === null || partOwner === null) {\n            // the proxy is either the manifest itself or the outer-most controller; add it directly to the parent\n            parentManifest.childNodes.push(manifestProxy);\n        }\n        else {\n            // there is a replace attribute on this node, so add it to the parts collection of the manifestRoot\n            // instead of to the childNodes\n            const replacePart = new ReplacePartSymbol(replace);\n            replacePart.parent = parentManifest;\n            replacePart.template = manifestProxy;\n            partOwner.parts.push(replacePart);\n            if (parentManifest.templateController != null) {\n                parentManifest.templateController.parts.push(replacePart);\n            }\n            processReplacePart(this.dom, replacePart, manifestProxy);\n        }\n    }\n    // TODO: refactor to use render priority slots (this logic shouldn't be in the template binder)\n    ensureAttributeOrder(manifest) {\n        // swap the order of checked and model/value attribute, so that the required observers are prepared for checked-observer\n        const attributes = manifest.plainAttributes;\n        let modelOrValueIndex = void 0;\n        let checkedIndex = void 0;\n        let found = 0;\n        for (let i = 0; i < attributes.length && found < 3; i++) {\n            switch (attributes[i].syntax.target) {\n                case 'model':\n                case 'value':\n                case 'matcher':\n                    modelOrValueIndex = i;\n                    found++;\n                    break;\n                case 'checked':\n                    checkedIndex = i;\n                    found++;\n                    break;\n            }\n        }\n        if (checkedIndex !== void 0 && modelOrValueIndex !== void 0 && checkedIndex < modelOrValueIndex) {\n            [attributes[modelOrValueIndex], attributes[checkedIndex]] = [attributes[checkedIndex], attributes[modelOrValueIndex]];\n        }\n    }\n    bindChildNodes(node, surrogate, manifest, manifestRoot, parentManifestRoot, partName) {\n        let childNode;\n        if (node.nodeName === 'TEMPLATE') {\n            childNode = node.content.firstChild;\n        }\n        else {\n            childNode = node.firstChild;\n        }\n        let nextChild;\n        while (childNode !== null) {\n            switch (childNode.nodeType) {\n                case 1 /* Element */:\n                    nextChild = childNode.nextSibling;\n                    this.bindManifest(\n                    /* parentManifest     */ manifest, \n                    /* node               */ childNode, \n                    /* surrogate          */ surrogate, \n                    /* manifest           */ manifest, \n                    /* manifestRoot       */ manifestRoot, \n                    /* parentManifestRoot */ parentManifestRoot, \n                    /* partName           */ partName);\n                    childNode = nextChild;\n                    break;\n                case 3 /* Text */:\n                    childNode = this.bindText(\n                    /* textNode */ childNode, \n                    /* manifest */ manifest).nextSibling;\n                    break;\n                case 4 /* CDATASection */:\n                case 7 /* ProcessingInstruction */:\n                case 8 /* Comment */:\n                case 10 /* DocumentType */:\n                    childNode = childNode.nextSibling;\n                    break;\n                case 9 /* Document */:\n                case 11 /* DocumentFragment */:\n                    childNode = childNode.firstChild;\n            }\n        }\n    }\n    bindText(textNode, manifest) {\n        const interpolation = this.exprParser.parse(textNode.wholeText, 2048 /* Interpolation */);\n        if (interpolation !== null) {\n            const symbol = new TextSymbol(this.dom, textNode, interpolation);\n            manifest.childNodes.push(symbol);\n            processInterpolationText(symbol);\n        }\n        let next = textNode;\n        while (next.nextSibling !== null && next.nextSibling.nodeType === 3 /* Text */) {\n            next = next.nextSibling;\n        }\n        return next;\n    }\n    declareTemplateController(attrSyntax, attrInfo, partName) {\n        let symbol;\n        const attrRawValue = attrSyntax.rawValue;\n        const command = this.resources.getBindingCommand(attrSyntax, false);\n        // multi-bindings logic here is similar to (and explained in) bindCustomAttribute\n        const isMultiBindings = attrInfo.noMultiBindings === false && command === null && hasInlineBindings(attrRawValue);\n        if (isMultiBindings) {\n            symbol = new TemplateControllerSymbol(this.dom, attrSyntax, attrInfo, partName);\n            this.bindMultiAttribute(symbol, attrInfo, attrRawValue);\n        }\n        else {\n            symbol = new TemplateControllerSymbol(this.dom, attrSyntax, attrInfo, partName);\n            const bindingType = command === null ? 2048 /* Interpolation */ : command.bindingType;\n            const expr = this.exprParser.parse(attrRawValue, bindingType);\n            symbol.bindings.push(new BindingSymbol(command, attrInfo.bindable, expr, attrRawValue, attrSyntax.target));\n        }\n        return symbol;\n    }\n    bindCustomAttribute(attrSyntax, attrInfo, command, manifest) {\n        let symbol;\n        const attrRawValue = attrSyntax.rawValue;\n        // Custom attributes are always in multiple binding mode,\n        // except when they can't be\n        // When they cannot be:\n        //        * has explicit configuration noMultiBindings: false\n        //        * has binding command, ie: <div my-attr.bind=\"...\">.\n        //          In this scenario, the value of the custom attributes is required to be a valid expression\n        //        * has no colon: ie: <div my-attr=\"abcd\">\n        //          In this scenario, it's simply invalid syntax. Consider style attribute rule-value pair: <div style=\"rule: ruleValue\">\n        const isMultiBindings = attrInfo.noMultiBindings === false && command === null && hasInlineBindings(attrRawValue);\n        if (isMultiBindings) {\n            // a multiple-bindings attribute usage (semicolon separated binding) is only valid without a binding command;\n            // the binding commands must be declared in each of the property bindings\n            symbol = new CustomAttributeSymbol(attrSyntax, attrInfo);\n            this.bindMultiAttribute(symbol, attrInfo, attrRawValue);\n        }\n        else {\n            symbol = new CustomAttributeSymbol(attrSyntax, attrInfo);\n            const bindingType = command === null ? 2048 /* Interpolation */ : command.bindingType;\n            const expr = this.exprParser.parse(attrRawValue, bindingType);\n            symbol.bindings.push(new BindingSymbol(command, attrInfo.bindable, expr, attrRawValue, attrSyntax.target));\n        }\n        manifest.customAttributes.push(symbol);\n        manifest.isTarget = true;\n    }\n    bindMultiAttribute(symbol, attrInfo, value) {\n        const bindables = attrInfo.bindables;\n        const valueLength = value.length;\n        let attrName = void 0;\n        let attrValue = void 0;\n        let start = 0;\n        let ch = 0;\n        for (let i = 0; i < valueLength; ++i) {\n            ch = value.charCodeAt(i);\n            if (ch === 92 /* Backslash */) {\n                ++i;\n                // Ignore whatever comes next because it's escaped\n            }\n            else if (ch === 58 /* Colon */) {\n                attrName = value.slice(start, i);\n                // Skip whitespace after colon\n                while (value.charCodeAt(++i) <= 32 /* Space */)\n                    ;\n                start = i;\n                for (; i < valueLength; ++i) {\n                    ch = value.charCodeAt(i);\n                    if (ch === 92 /* Backslash */) {\n                        ++i;\n                        // Ignore whatever comes next because it's escaped\n                    }\n                    else if (ch === 59 /* Semicolon */) {\n                        attrValue = value.slice(start, i);\n                        break;\n                    }\n                }\n                if (attrValue === void 0) {\n                    // No semicolon found, so just grab the rest of the value\n                    attrValue = value.slice(start);\n                }\n                const attrSyntax = this.attrParser.parse(attrName, attrValue);\n                const attrTarget = camelCase(attrSyntax.target);\n                const command = this.resources.getBindingCommand(attrSyntax, false);\n                const bindingType = command === null ? 2048 /* Interpolation */ : command.bindingType;\n                const expr = this.exprParser.parse(attrValue, bindingType);\n                let bindable = bindables[attrTarget];\n                if (bindable === undefined) {\n                    // everything in a multi-bindings expression must be used,\n                    // so if it's not a bindable then we create one on the spot\n                    bindable = bindables[attrTarget] = new BindableInfo(attrTarget, BindingMode.toView);\n                }\n                symbol.bindings.push(new BindingSymbol(command, bindable, expr, attrValue, attrTarget));\n                // Skip whitespace after semicolon\n                while (i < valueLength && value.charCodeAt(++i) <= 32 /* Space */)\n                    ;\n                start = i;\n                attrName = void 0;\n                attrValue = void 0;\n            }\n        }\n    }\n    bindPlainAttribute(attrSyntax, attr, surrogate, manifest) {\n        const command = this.resources.getBindingCommand(attrSyntax, false);\n        const bindingType = command === null ? 2048 /* Interpolation */ : command.bindingType;\n        const attrTarget = attrSyntax.target;\n        const attrRawValue = attrSyntax.rawValue;\n        let expr;\n        if (attrRawValue.length === 0\n            && (bindingType & 53 /* BindCommand */ | 49 /* OneTimeCommand */ | 50 /* ToViewCommand */ | 52 /* TwoWayCommand */) > 0) {\n            if ((bindingType & 53 /* BindCommand */ | 49 /* OneTimeCommand */ | 50 /* ToViewCommand */ | 52 /* TwoWayCommand */) > 0) {\n                // Default to the name of the attr for empty binding commands\n                expr = this.exprParser.parse(camelCase(attrTarget), bindingType);\n            }\n            else {\n                return;\n            }\n        }\n        else {\n            expr = this.exprParser.parse(attrRawValue, bindingType);\n        }\n        if ((manifest.flags & 16 /* isCustomElement */) > 0) {\n            const bindable = manifest.bindables[attrTarget];\n            if (bindable != null) {\n                // if the attribute name matches a bindable property name, add it regardless of whether it's a command, interpolation, or just a plain string;\n                // the template compiler will translate it to the correct instruction\n                manifest.bindings.push(new BindingSymbol(command, bindable, expr, attrRawValue, attrTarget));\n                manifest.isTarget = true;\n            }\n            else if (expr != null) {\n                // if it does not map to a bindable, only add it if we were able to parse an expression (either a command or interpolation)\n                manifest.plainAttributes.push(new PlainAttributeSymbol(attrSyntax, command, expr));\n                manifest.isTarget = true;\n            }\n        }\n        else if (expr != null) {\n            // either a binding command, an interpolation, or a ref\n            manifest.plainAttributes.push(new PlainAttributeSymbol(attrSyntax, command, expr));\n            manifest.isTarget = true;\n        }\n        else if (manifest === surrogate) {\n            // any attributes, even if they are plain (no command/interpolation etc), should be added if they\n            // are on the surrogate element\n            manifest.plainAttributes.push(new PlainAttributeSymbol(attrSyntax, command, expr));\n        }\n        if (command == null && expr != null) {\n            // if it's an interpolation, clear the attribute value\n            attr.value = '';\n        }\n    }\n}\n//# sourceMappingURL=template-binder.js.map","import { __decorate, __metadata, __param } from \"tslib\";\nimport { DI, Registration } from '@aurelia/kernel';\nimport { IDOM } from '@aurelia/runtime';\n// For some reason rollup complains about `DI.createInterface<ITemplateElementFactory>().noDefault()` with this message:\n// \"semantic error TS2742 The inferred type of 'ITemplateElementFactory' cannot be named without a reference to '@aurelia/jit/node_modules/@aurelia/kernel'. This is likely not portable. A type annotation is necessary\"\n// So.. investigate why that happens (or rather, why it *only* happens here and not for the other 50)\nexport const ITemplateElementFactory = DI.createInterface('ITemplateElementFactory').noDefault();\nconst markupCache = {};\n/**\n * Default implementation for `ITemplateFactory` for use in an HTML based runtime.\n *\n * @internal\n */\nlet HTMLTemplateElementFactory = class HTMLTemplateElementFactory {\n    constructor(dom) {\n        this.dom = dom;\n        this.template = dom.createTemplate();\n    }\n    static register(container) {\n        return Registration.singleton(ITemplateElementFactory, this).register(container);\n    }\n    createTemplate(input) {\n        if (typeof input === 'string') {\n            let result = markupCache[input];\n            if (result === void 0) {\n                const template = this.template;\n                template.innerHTML = input;\n                const node = template.content.firstElementChild;\n                // if the input is either not wrapped in a template or there is more than one node,\n                // return the whole template that wraps it/them (and create a new one for the next input)\n                if (node == null || node.nodeName !== 'TEMPLATE' || node.nextElementSibling != null) {\n                    this.template = this.dom.createTemplate();\n                    result = template;\n                }\n                else {\n                    // the node to return is both a template and the only node, so return just the node\n                    // and clean up the template for the next input\n                    template.content.removeChild(node);\n                    result = node;\n                }\n                markupCache[input] = result;\n            }\n            return result.cloneNode(true);\n        }\n        if (input.nodeName !== 'TEMPLATE') {\n            // if we get one node that is not a template, wrap it in one\n            const template = this.dom.createTemplate();\n            template.content.appendChild(input);\n            return template;\n        }\n        // we got a template element, remove it from the DOM if it's present there and don't\n        // do any other processing\n        if (input.parentNode != null) {\n            input.parentNode.removeChild(input);\n        }\n        return input;\n    }\n};\nHTMLTemplateElementFactory = __decorate([\n    __param(0, IDOM),\n    __metadata(\"design:paramtypes\", [Object])\n], HTMLTemplateElementFactory);\nexport { HTMLTemplateElementFactory };\n//# sourceMappingURL=template-element-factory.js.map","import { __decorate, __metadata, __param } from \"tslib\";\nimport { IAttributeParser, ResourceModel, } from '@aurelia/jit';\nimport { mergeDistinct, PLATFORM, Registration, mergeArrays, } from '@aurelia/kernel';\nimport { HydrateAttributeInstruction, HydrateElementInstruction, HydrateTemplateController, IExpressionParser, InterpolationInstruction, ITemplateCompiler, LetBindingInstruction, LetElementInstruction, SetPropertyInstruction, CustomElementDefinition, IDOM } from '@aurelia/runtime';\nimport { SetAttributeInstruction, TextBindingInstruction, SetClassAttributeInstruction, SetStyleAttributeInstruction, } from '@aurelia/runtime-html';\nimport { IAttrSyntaxTransformer } from './attribute-syntax-transformer';\nimport { TemplateBinder } from './template-binder';\nimport { ITemplateElementFactory } from './template-element-factory';\nclass CustomElementCompilationUnit {\n    constructor(partialDefinition, surrogate, template) {\n        this.partialDefinition = partialDefinition;\n        this.surrogate = surrogate;\n        this.template = template;\n        this.instructions = [];\n        this.surrogates = [];\n        this.scopeParts = [];\n        this.parts = {};\n    }\n    toDefinition() {\n        const def = this.partialDefinition;\n        return CustomElementDefinition.create({\n            ...def,\n            instructions: mergeArrays(def.instructions, this.instructions),\n            surrogates: mergeArrays(def.surrogates, this.surrogates),\n            scopeParts: mergeArrays(def.scopeParts, this.scopeParts),\n            template: this.template,\n            needsCompile: false,\n            hasSlots: this.surrogate.hasSlots,\n        });\n    }\n}\n/**\n * Default (runtime-agnostic) implementation for `ITemplateCompiler`.\n *\n * @internal\n */\nlet TemplateCompiler = class TemplateCompiler {\n    constructor(factory, attrParser, exprParser, attrSyntaxModifier) {\n        this.factory = factory;\n        this.attrParser = attrParser;\n        this.exprParser = exprParser;\n        this.attrSyntaxModifier = attrSyntaxModifier;\n    }\n    get name() {\n        return 'default';\n    }\n    static register(container) {\n        return Registration.singleton(ITemplateCompiler, this).register(container);\n    }\n    compile(partialDefinition, context) {\n        const definition = CustomElementDefinition.getOrCreate(partialDefinition);\n        if (definition.template === null || definition.template === void 0) {\n            return definition;\n        }\n        const resources = ResourceModel.getOrCreate(context);\n        const { attrParser, exprParser, attrSyntaxModifier, factory } = this;\n        const binder = new TemplateBinder(context.get(IDOM), resources, attrParser, exprParser, attrSyntaxModifier);\n        const template = factory.createTemplate(definition.template);\n        const surrogate = binder.bind(template);\n        const compilation = this.compilation = new CustomElementCompilationUnit(definition, surrogate, template);\n        const customAttributes = surrogate.customAttributes;\n        const plainAttributes = surrogate.plainAttributes;\n        const customAttributeLength = customAttributes.length;\n        const plainAttributeLength = plainAttributes.length;\n        if (customAttributeLength + plainAttributeLength > 0) {\n            let offset = 0;\n            for (let i = 0; customAttributeLength > i; ++i) {\n                compilation.surrogates[offset] = this.compileCustomAttribute(customAttributes[i]);\n                offset++;\n            }\n            for (let i = 0; i < plainAttributeLength; ++i) {\n                compilation.surrogates[offset] = this.compilePlainAttribute(plainAttributes[i], true);\n                offset++;\n            }\n        }\n        this.compileChildNodes(surrogate, compilation.instructions, compilation.scopeParts);\n        const compiledDefinition = compilation.toDefinition();\n        this.compilation = null;\n        return compiledDefinition;\n    }\n    compileChildNodes(parent, instructionRows, scopeParts) {\n        if ((parent.flags & 8192 /* hasChildNodes */) > 0) {\n            const childNodes = parent.childNodes;\n            const ii = childNodes.length;\n            let childNode;\n            for (let i = 0; i < ii; ++i) {\n                childNode = childNodes[i];\n                if ((childNode.flags & 128 /* isText */) > 0) {\n                    instructionRows.push([new TextBindingInstruction(childNode.interpolation)]);\n                }\n                else if ((childNode.flags & 32 /* isLetElement */) > 0) {\n                    const bindings = childNode.bindings;\n                    const instructions = [];\n                    let binding;\n                    const jj = bindings.length;\n                    for (let j = 0; j < jj; ++j) {\n                        binding = bindings[j];\n                        instructions[j] = new LetBindingInstruction(binding.expression, binding.target);\n                    }\n                    instructionRows.push([new LetElementInstruction(instructions, childNode.toBindingContext)]);\n                }\n                else {\n                    this.compileParentNode(childNode, instructionRows, scopeParts);\n                }\n            }\n        }\n    }\n    compileCustomElement(symbol, instructionRows, scopeParts) {\n        // offset 1 to leave a spot for the hydrate instruction so we don't need to create 2 arrays with a spread etc\n        const instructionRow = this.compileAttributes(symbol, 1);\n        instructionRow[0] = new HydrateElementInstruction(symbol.res, this.compileBindings(symbol), this.compileParts(symbol, scopeParts));\n        instructionRows.push(instructionRow);\n        this.compileChildNodes(symbol, instructionRows, scopeParts);\n    }\n    compilePlainElement(symbol, instructionRows, scopeParts) {\n        const attributes = this.compileAttributes(symbol, 0);\n        if (attributes.length > 0) {\n            instructionRows.push(attributes);\n        }\n        this.compileChildNodes(symbol, instructionRows, scopeParts);\n    }\n    compileParentNode(symbol, instructionRows, scopeParts) {\n        switch (symbol.flags & 511 /* type */) {\n            case 16 /* isCustomElement */:\n                this.compileCustomElement(symbol, instructionRows, scopeParts);\n                break;\n            case 64 /* isPlainElement */:\n                this.compilePlainElement(symbol, instructionRows, scopeParts);\n                break;\n            case 1 /* isTemplateController */:\n                this.compileTemplateController(symbol, instructionRows, scopeParts);\n        }\n    }\n    compileTemplateController(symbol, instructionRows, scopeParts) {\n        const bindings = this.compileBindings(symbol);\n        const controllerInstructionRows = [];\n        const controllerScopeParts = [];\n        this.compileParentNode(symbol.template, controllerInstructionRows, controllerScopeParts);\n        mergeDistinct(scopeParts, controllerScopeParts, false);\n        const def = CustomElementDefinition.create({\n            name: symbol.partName === null ? symbol.res : symbol.partName,\n            scopeParts: controllerScopeParts,\n            template: symbol.physicalNode,\n            instructions: controllerInstructionRows,\n            needsCompile: false,\n        });\n        let parts = void 0;\n        if ((symbol.flags & 16384 /* hasParts */) > 0) {\n            parts = {};\n            for (const part of symbol.parts) {\n                parts[part.name] = this.compilation.parts[part.name];\n            }\n        }\n        instructionRows.push([new HydrateTemplateController(def, symbol.res, bindings, symbol.res === 'else', parts)]);\n    }\n    compileBindings(symbol) {\n        let bindingInstructions;\n        if ((symbol.flags & 4096 /* hasBindings */) > 0) {\n            // either a custom element with bindings, a custom attribute / template controller with dynamic options,\n            // or a single value custom attribute binding\n            const { bindings } = symbol;\n            const len = bindings.length;\n            bindingInstructions = Array(len);\n            let i = 0;\n            for (; i < len; ++i) {\n                bindingInstructions[i] = this.compileBinding(bindings[i]);\n            }\n        }\n        else {\n            bindingInstructions = PLATFORM.emptyArray;\n        }\n        return bindingInstructions;\n    }\n    compileBinding(symbol) {\n        if (symbol.command === null) {\n            // either an interpolation or a normal string value assigned to an element or attribute binding\n            if (symbol.expression === null) {\n                // the template binder already filtered out non-bindables, so we know we need a setProperty here\n                return new SetPropertyInstruction(symbol.rawValue, symbol.bindable.propName);\n            }\n            else {\n                // either an element binding interpolation or a dynamic options attribute binding interpolation\n                return new InterpolationInstruction(symbol.expression, symbol.bindable.propName);\n            }\n        }\n        else {\n            // either an element binding command, dynamic options attribute binding command,\n            // or custom attribute / template controller (single value) binding command\n            return symbol.command.compile(symbol);\n        }\n    }\n    compileAttributes(symbol, offset) {\n        let attributeInstructions;\n        if ((symbol.flags & 2048 /* hasAttributes */) > 0) {\n            // any attributes on a custom element (which are not bindables) or a plain element\n            const customAttributes = symbol.customAttributes;\n            const plainAttributes = symbol.plainAttributes;\n            const customAttributeLength = customAttributes.length;\n            const plainAttributesLength = plainAttributes.length;\n            attributeInstructions = Array(offset + customAttributeLength + plainAttributesLength);\n            for (let i = 0; customAttributeLength > i; ++i) {\n                attributeInstructions[offset] = this.compileCustomAttribute(customAttributes[i]);\n                offset++;\n            }\n            for (let i = 0; plainAttributesLength > i; ++i) {\n                attributeInstructions[offset] = this.compilePlainAttribute(plainAttributes[i], false);\n                offset++;\n            }\n        }\n        else if (offset > 0) {\n            attributeInstructions = Array(offset);\n        }\n        else {\n            attributeInstructions = PLATFORM.emptyArray;\n        }\n        return attributeInstructions;\n    }\n    compileCustomAttribute(symbol) {\n        // a normal custom attribute (not template controller)\n        const bindings = this.compileBindings(symbol);\n        return new HydrateAttributeInstruction(symbol.res, bindings);\n    }\n    compilePlainAttribute(symbol, isOnSurrogate) {\n        if (symbol.command === null) {\n            const syntax = symbol.syntax;\n            if (symbol.expression === null) {\n                const attrRawValue = syntax.rawValue;\n                if (isOnSurrogate) {\n                    switch (syntax.target) {\n                        case 'class':\n                            return new SetClassAttributeInstruction(attrRawValue);\n                        case 'style':\n                            return new SetStyleAttributeInstruction(attrRawValue);\n                        // todo:  define how to merge other attribute peacefully\n                        //        this is an existing feature request\n                    }\n                }\n                // a plain attribute on a surrogate\n                return new SetAttributeInstruction(attrRawValue, syntax.target);\n            }\n            else {\n                // a plain attribute with an interpolation\n                return new InterpolationInstruction(symbol.expression, syntax.target);\n            }\n        }\n        else {\n            // a plain attribute with a binding command\n            return symbol.command.compile(symbol);\n        }\n    }\n    // private compileAttribute(symbol: IAttributeSymbol): HTMLAttributeInstruction {\n    //   // any attribute on a custom element (which is not a bindable) or a plain element\n    //   if (symbol.flags & SymbolFlags.isCustomAttribute) {\n    //     return this.compileCustomAttribute(symbol as CustomAttributeSymbol);\n    //   } else {\n    //     return this.compilePlainAttribute(symbol as PlainAttributeSymbol);\n    //   }\n    // }\n    compileParts(symbol, scopeParts) {\n        const parts = {};\n        if ((symbol.flags & 16384 /* hasParts */) > 0) {\n            const replaceParts = symbol.parts;\n            const len = replaceParts.length;\n            let s = scopeParts.length;\n            for (let i = 0; i < len; ++i) {\n                const replacePart = replaceParts[i];\n                if (!scopeParts.includes(replacePart.name)) {\n                    scopeParts[s++] = replacePart.name;\n                }\n                const partScopeParts = [];\n                const partInstructionRows = [];\n                this.compileParentNode(replacePart.template, partInstructionRows, partScopeParts);\n                // TODO: the assignment to `this.compilation.parts[replacePart.name]` might be the cause of replaceable bug reported by rluba\n                // need to verify this\n                this.compilation.parts[replacePart.name] = parts[replacePart.name] = CustomElementDefinition.create({\n                    name: replacePart.name,\n                    scopeParts: partScopeParts,\n                    template: replacePart.physicalNode,\n                    instructions: partInstructionRows,\n                    needsCompile: false,\n                });\n            }\n        }\n        return parts;\n    }\n};\nTemplateCompiler = __decorate([\n    __param(0, ITemplateElementFactory),\n    __param(1, IAttributeParser),\n    __param(2, IExpressionParser),\n    __param(3, IAttrSyntaxTransformer),\n    __metadata(\"design:paramtypes\", [Object, Object, Object, Object])\n], TemplateCompiler);\nexport { TemplateCompiler };\n//# sourceMappingURL=template-compiler.js.map","import { DefaultBindingLanguage as JitDefaultBindingLanguage, DefaultBindingSyntax as JitDefaultBindingSyntax, DefaultComponents as JitDefaultComponents } from '@aurelia/jit';\nimport { DI } from '@aurelia/kernel';\nimport { RuntimeHtmlConfiguration } from '@aurelia/runtime-html';\nimport { AttrBindingCommand, CaptureBindingCommand, ClassBindingCommand, DelegateBindingCommand, RefBindingCommand, StyleBindingCommand, TriggerBindingCommand } from './binding-commands';\nimport { HtmlAttrSyntaxTransformer } from './html-attribute-syntax-transformer';\nimport { TemplateCompiler } from './template-compiler';\nimport { HTMLTemplateElementFactory } from './template-element-factory';\nexport const ITemplateCompilerRegistration = TemplateCompiler;\nexport const ITemplateElementFactoryRegistration = HTMLTemplateElementFactory;\nexport const IAttrSyntaxTransformerRegistation = HtmlAttrSyntaxTransformer;\n/**\n * Default HTML-specific (but environment-agnostic) implementations for the following interfaces:\n * - `ITemplateCompiler`\n * - `ITemplateElementFactory`\n */\nexport const DefaultComponents = [\n    ITemplateCompilerRegistration,\n    ITemplateElementFactoryRegistration,\n    IAttrSyntaxTransformerRegistation\n];\nexport const RefBindingCommandRegistration = RefBindingCommand;\nexport const TriggerBindingCommandRegistration = TriggerBindingCommand;\nexport const DelegateBindingCommandRegistration = DelegateBindingCommand;\nexport const CaptureBindingCommandRegistration = CaptureBindingCommand;\nexport const AttrBindingCommandRegistration = AttrBindingCommand;\nexport const ClassBindingCommandRegistration = ClassBindingCommand;\nexport const StyleBindingCommandRegistration = StyleBindingCommand;\n/**\n * Default HTML-specific (but environment-agnostic) binding commands:\n * - Event listeners: `.trigger`, `.delegate`, `.capture`\n */\nexport const DefaultBindingLanguage = [\n    RefBindingCommandRegistration,\n    TriggerBindingCommandRegistration,\n    DelegateBindingCommandRegistration,\n    CaptureBindingCommandRegistration,\n    ClassBindingCommandRegistration,\n    StyleBindingCommandRegistration,\n    AttrBindingCommandRegistration\n];\n/**\n * A DI configuration object containing html-specific (but environment-agnostic) registrations:\n * - `RuntimeHtmlConfiguration` from `@aurelia/runtime-html`\n * - `DefaultComponents` from `@aurelia/jit`\n * - `DefaultBindingSyntax` from `@aurelia/jit`\n * - `DefaultBindingLanguage` from `@aurelia/jit`\n * - `DefaultComponents`\n * - `DefaultBindingLanguage`\n */\nexport const JitHtmlConfiguration = {\n    /**\n     * Apply this configuration to the provided container.\n     */\n    register(container) {\n        return RuntimeHtmlConfiguration\n            .register(container)\n            .register(...JitDefaultComponents, ...JitDefaultBindingSyntax, ...JitDefaultBindingLanguage, ...DefaultComponents, ...DefaultBindingLanguage);\n    },\n    /**\n     * Create a new container with this configuration applied to it.\n     */\n    createContainer() {\n        return this.register(DI.createContainer());\n    }\n};\n//# sourceMappingURL=configuration.js.map","import { Registration } from '@aurelia/kernel';\nimport { IAttrSyntaxTransformer } from './attribute-syntax-transformer';\nexport class HtmlAttrSyntaxTransformer {\n    static register(container) {\n        return Registration.singleton(IAttrSyntaxTransformer, this).register(container);\n    }\n    transform(node, attrSyntax) {\n        if (attrSyntax.command === 'bind' && shouldDefaultToTwoWay(node, attrSyntax)) {\n            attrSyntax.command = 'two-way';\n        }\n        attrSyntax.target = this.map(node.tagName, attrSyntax.target);\n    }\n    map(tagName, attr) {\n        switch (tagName) {\n            case 'LABEL':\n                switch (attr) {\n                    case 'for':\n                        return 'htmlFor';\n                    default:\n                        return attr;\n                }\n            case 'IMG':\n                switch (attr) {\n                    case 'usemap':\n                        return 'useMap';\n                    default:\n                        return attr;\n                }\n            case 'INPUT':\n                switch (attr) {\n                    case 'maxlength':\n                        return 'maxLength';\n                    case 'minlength':\n                        return 'minLength';\n                    case 'formaction':\n                        return 'formAction';\n                    case 'formenctype':\n                        return 'formEncType';\n                    case 'formmethod':\n                        return 'formMethod';\n                    case 'formnovalidate':\n                        return 'formNoValidate';\n                    case 'formtarget':\n                        return 'formTarget';\n                    case 'inputmode':\n                        return 'inputMode';\n                    default:\n                        return attr;\n                }\n            case 'TEXTAREA':\n                switch (attr) {\n                    case 'maxlength':\n                        return 'maxLength';\n                    default:\n                        return attr;\n                }\n            case 'TD':\n            case 'TH':\n                switch (attr) {\n                    case 'rowspan':\n                        return 'rowSpan';\n                    case 'colspan':\n                        return 'colSpan';\n                    default:\n                        return attr;\n                }\n            default:\n                switch (attr) {\n                    case 'accesskey':\n                        return 'accessKey';\n                    case 'contenteditable':\n                        return 'contentEditable';\n                    case 'tabindex':\n                        return 'tabIndex';\n                    case 'textcontent':\n                        return 'textContent';\n                    case 'innerhtml':\n                        return 'innerHTML';\n                    case 'scrolltop':\n                        return 'scrollTop';\n                    case 'scrollleft':\n                        return 'scrollLeft';\n                    case 'readonly':\n                        return 'readOnly';\n                    default:\n                        return attr;\n                }\n        }\n    }\n}\nfunction shouldDefaultToTwoWay(element, attr) {\n    switch (element.tagName) {\n        case 'INPUT':\n            switch (element.type) {\n                case 'checkbox':\n                case 'radio':\n                    return attr.target === 'checked';\n                default:\n                    return attr.target === 'value' || attr.target === 'files';\n            }\n        case 'TEXTAREA':\n        case 'SELECT':\n            return attr.target === 'value';\n        default:\n            switch (attr.target) {\n                case 'textcontent':\n                case 'innerhtml':\n                    return element.hasAttribute('contenteditable');\n                case 'scrolltop':\n                case 'scrollleft':\n                    return true;\n                default:\n                    return false;\n            }\n    }\n}\n//# sourceMappingURL=html-attribute-syntax-transformer.js.map","import { __decorate, __metadata, __param } from \"tslib\";\n/* eslint-disable no-await-in-loop */\nimport { bound } from '@aurelia/kernel';\nimport { IDOM, IScheduler, TaskQueue, IClock, DOM } from '@aurelia/runtime';\nimport { HTMLDOM } from '@aurelia/runtime-html';\n// Note on the flush requestors: we're probably overdoing it here with the binds and all the wrapping.\n// Just want to start off with something as robust as possible, add many tests first so that we're sure it all works, etc.\n// Once all the proper tests are in place, we can then start simplifying and rely on those tests to tell us precisely which things are necessary and which aren't.\n// Besides looking at test results, we also need to look at benchmark results, memory usage, memory leaks, etc.\nfunction createQueueMicrotaskFlushRequestor(window, flush) {\n    return (function ($window, $flush) {\n        const callFlush = function () {\n            $flush();\n            // eslint-disable-next-line no-extra-bind\n        }.bind(void 0);\n        return function () {\n            $window.queueMicrotask(callFlush);\n            // eslint-disable-next-line no-extra-bind\n        }.bind(void 0);\n    })(window, flush);\n}\nfunction createPromiseFlushRequestor(flush) {\n    return (function ($flush) {\n        const callFlush = function () {\n            $flush();\n            // eslint-disable-next-line no-extra-bind\n        }.bind(void 0);\n        // eslint-disable-next-line compat/compat\n        const p = Promise.resolve();\n        return function () {\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\n            p.then(callFlush);\n            // eslint-disable-next-line no-extra-bind\n        }.bind(void 0);\n    })(flush);\n}\nfunction createMutationObserverFlushRequestor(window, flush) {\n    return (function ($window, $flush) {\n        const callFlush = function () {\n            $flush();\n            // eslint-disable-next-line no-extra-bind\n        }.bind(void 0);\n        const observer = new $window.MutationObserver(callFlush);\n        const node = $window.document.createTextNode('a');\n        // eslint-disable-next-line compat/compat\n        const flip = Object.assign(Object.create(null), { a: 'b', b: 'a' });\n        let val = 'a';\n        observer.observe(node, { characterData: true });\n        return function () {\n            node.data = val = flip[val];\n            // eslint-disable-next-line no-extra-bind\n        }.bind(void 0);\n    })(window, flush);\n}\n// Create a microtask queue, trying the available options starting with the most performant\nconst createMicrotaskFlushRequestor = (function () {\n    // Ensure we only ever create one requestor (at least, per loaded bundle..).\n    let called = false;\n    return function (wnd, flush) {\n        if (called) {\n            throw new Error('Cannot have more than one global MicrotaskFlushRequestor');\n        }\n        called = true;\n        if (wnd.queueMicrotask !== void 0 && wnd.queueMicrotask.toString().includes('[native code]')) {\n            return createQueueMicrotaskFlushRequestor(wnd, flush);\n        }\n        else if (Promise.toString().includes('[native code]')) {\n            return createPromiseFlushRequestor(flush);\n        }\n        else {\n            return createMutationObserverFlushRequestor(wnd, flush);\n        }\n    };\n})();\nconst createPostMessageFlushRequestor = (function () {\n    let called = false;\n    return function (window, flush) {\n        if (called) {\n            throw new Error('Cannot have more than one global PostMessageFlushRequestor');\n        }\n        called = true;\n        return (function ($window, $flush) {\n            const handleMessage = function (event) {\n                if (event.data === 'au-message' && event.source === $window) {\n                    $flush();\n                }\n                // eslint-disable-next-line no-extra-bind\n            }.bind(void 0);\n            $window.addEventListener('message', handleMessage);\n            return function () {\n                $window.postMessage('au-message', $window.origin);\n                // eslint-disable-next-line no-extra-bind\n            }.bind(void 0);\n        })(window, flush);\n    };\n})();\nconst createSetTimeoutFlushRequestor = (function () {\n    let called = false;\n    return function (window, flush) {\n        if (called) {\n            throw new Error('Cannot have more than one global SetTimeoutFlushRequestor');\n        }\n        called = true;\n        return (function ($window, $flush) {\n            let handle = -1;\n            const callFlush = function () {\n                if (handle > -1) {\n                    handle = -1;\n                    $flush();\n                }\n                // eslint-disable-next-line no-extra-bind\n            }.bind(void 0);\n            const cancel = function () {\n                if (handle > -1) {\n                    $window.clearTimeout(handle);\n                    handle = -1;\n                }\n                // eslint-disable-next-line no-extra-bind\n            }.bind(void 0);\n            const request = function () {\n                if (handle === -1) {\n                    handle = $window.setTimeout(callFlush, 0);\n                }\n                // eslint-disable-next-line no-extra-bind\n            }.bind(void 0);\n            return {\n                cancel,\n                request,\n            };\n        })(window, flush);\n    };\n})();\nconst createRequestAnimationFrameFlushRequestor = (function () {\n    let called = false;\n    return function (window, flush) {\n        if (called) {\n            throw new Error('Cannot have more than one global RequestAnimationFrameFlushRequestor');\n        }\n        called = true;\n        return (function ($window, $flush) {\n            let handle = -1;\n            const callFlush = function () {\n                if (handle > -1) {\n                    handle = -1;\n                    $flush();\n                }\n                // eslint-disable-next-line no-extra-bind\n            }.bind(void 0);\n            const cancel = function () {\n                if (handle > -1) {\n                    $window.cancelAnimationFrame(handle);\n                    handle = -1;\n                }\n                // eslint-disable-next-line no-extra-bind\n            }.bind(void 0);\n            const request = function () {\n                if (handle === -1) {\n                    handle = $window.requestAnimationFrame(callFlush);\n                }\n                // eslint-disable-next-line no-extra-bind\n            }.bind(void 0);\n            return {\n                cancel,\n                request,\n            };\n        })(window, flush);\n    };\n})();\nconst createPostRequestAnimationFrameFlushRequestor = (function () {\n    let called = false;\n    return function (window, flush) {\n        if (called) {\n            throw new Error('Cannot have more than one global PostRequestAnimationFrameFlushRequestor');\n        }\n        called = true;\n        return (function ($window, $flush) {\n            let rafHandle = -1;\n            let timeoutHandle = -1;\n            const callFlush = function () {\n                if (timeoutHandle > -1) {\n                    timeoutHandle = -1;\n                    $flush();\n                }\n                // eslint-disable-next-line no-extra-bind\n            }.bind(void 0);\n            const queueFlush = function () {\n                if (rafHandle > -1) {\n                    rafHandle = -1;\n                    if (timeoutHandle === -1) {\n                        timeoutHandle = $window.setTimeout(callFlush, 0);\n                    }\n                }\n                // eslint-disable-next-line no-extra-bind\n            }.bind(void 0);\n            const cancel = function () {\n                if (rafHandle > -1) {\n                    $window.cancelAnimationFrame(rafHandle);\n                    rafHandle = -1;\n                }\n                if (timeoutHandle > -1) {\n                    $window.clearTimeout(timeoutHandle);\n                    timeoutHandle = -1;\n                }\n                // eslint-disable-next-line no-extra-bind\n            }.bind(void 0);\n            const request = function () {\n                if (rafHandle === -1) {\n                    rafHandle = $window.requestAnimationFrame(queueFlush);\n                }\n                // eslint-disable-next-line no-extra-bind\n            }.bind(void 0);\n            return {\n                cancel,\n                request,\n            };\n        })(window, flush);\n    };\n})();\nconst createRequestIdleCallbackFlushRequestor = (function () {\n    let called = false;\n    return function (window, flush) {\n        if (called) {\n            throw new Error('Cannot have more than one global RequestIdleCallbackFlushRequestor');\n        }\n        called = true;\n        const hasNative = window.requestIdleCallback !== void 0 && window.requestIdleCallback.toString().includes('[native code]');\n        return (function ($window, $flush) {\n            let handle = -1;\n            const options = { timeout: 1000 }; // TODO: make this configurable\n            const callFlush = function () {\n                if (handle > -1) {\n                    handle = -1;\n                    $flush();\n                }\n                // eslint-disable-next-line no-extra-bind\n            }.bind(void 0);\n            const cancel = hasNative\n                ? function () {\n                    if (handle > -1) {\n                        $window.cancelIdleCallback(handle);\n                        handle = -1;\n                    }\n                    // eslint-disable-next-line no-extra-bind\n                }.bind(void 0)\n                : function () {\n                    if (handle > -1) {\n                        $window.clearTimeout(handle);\n                        handle = -1;\n                    }\n                    // eslint-disable-next-line no-extra-bind\n                }.bind(void 0);\n            const request = hasNative\n                ? function () {\n                    if (handle === -1) {\n                        handle = $window.requestIdleCallback(callFlush, options);\n                    }\n                    // eslint-disable-next-line no-extra-bind\n                }.bind(void 0)\n                : function () {\n                    if (handle === -1) {\n                        // Instead of trying anything fancy with event handler debouncers (we could do that if there was a request for it),\n                        // we just wait 45ms which is approximately the interval in a native idleCallback loop in chrome, to at least make it look\n                        // the same from a timing perspective\n                        handle = $window.setTimeout(callFlush, 45);\n                    }\n                    // eslint-disable-next-line no-extra-bind\n                }.bind(void 0);\n            return {\n                cancel,\n                request,\n            };\n        })(window, flush);\n    };\n})();\nconst defaultQueueTaskOptions = {\n    delay: 0,\n    preempt: false,\n    priority: 1 /* render */,\n    reusable: true,\n    persistent: false,\n};\nlet BrowserScheduler = class BrowserScheduler {\n    constructor(clock, dom) {\n        const microTaskTaskQueue = new TaskQueue({ clock, scheduler: this, priority: 0 /* microTask */ });\n        const renderTaskQueue = new TaskQueue({ clock, scheduler: this, priority: 1 /* render */ });\n        const macroTaskTaskQueue = new TaskQueue({ clock, scheduler: this, priority: 2 /* macroTask */ });\n        const postRenderTaskQueue = new TaskQueue({ clock, scheduler: this, priority: 3 /* postRender */ });\n        const idleTaskQueue = new TaskQueue({ clock, scheduler: this, priority: 4 /* idle */ });\n        this.taskQueue = [\n            microTaskTaskQueue,\n            renderTaskQueue,\n            macroTaskTaskQueue,\n            postRenderTaskQueue,\n            idleTaskQueue,\n        ];\n        const wnd = dom.window;\n        this.flush = [\n            createMicrotaskFlushRequestor(wnd, microTaskTaskQueue.flush.bind(microTaskTaskQueue)),\n            createRequestAnimationFrameFlushRequestor(wnd, renderTaskQueue.flush.bind(renderTaskQueue)),\n            createSetTimeoutFlushRequestor(wnd, macroTaskTaskQueue.flush.bind(macroTaskTaskQueue)),\n            createPostRequestAnimationFrameFlushRequestor(wnd, postRenderTaskQueue.flush.bind(postRenderTaskQueue)),\n            createRequestIdleCallbackFlushRequestor(wnd, idleTaskQueue.flush.bind(idleTaskQueue)),\n        ];\n    }\n    static register(container) {\n        container.registerResolver(IScheduler, {\n            resolve() {\n                if (DOM.scheduler === void 0) {\n                    const clock = container.get(IClock);\n                    const dom = container.get(IDOM);\n                    const scheduler = new BrowserScheduler(clock, dom);\n                    Reflect.defineProperty(DOM, 'scheduler', {\n                        value: scheduler,\n                        writable: false,\n                        enumerable: false,\n                        configurable: false,\n                    });\n                }\n                return DOM.scheduler;\n            }\n        });\n    }\n    getTaskQueue(priority) {\n        return this.taskQueue[priority];\n    }\n    yield(priority) {\n        return this.taskQueue[priority].yield();\n    }\n    queueTask(callback, opts) {\n        const { delay, preempt, priority, persistent, reusable } = { ...defaultQueueTaskOptions, ...opts };\n        return this.taskQueue[priority].queueTask(callback, { delay, preempt, persistent, reusable });\n    }\n    getMicroTaskQueue() {\n        return this.taskQueue[0 /* microTask */];\n    }\n    getRenderTaskQueue() {\n        return this.taskQueue[1 /* render */];\n    }\n    getMacroTaskQueue() {\n        return this.taskQueue[2 /* macroTask */];\n    }\n    getPostRenderTaskQueue() {\n        return this.taskQueue[3 /* postRender */];\n    }\n    getIdleTaskQueue() {\n        return this.taskQueue[4 /* idle */];\n    }\n    yieldMicroTask() {\n        return this.taskQueue[0 /* microTask */].yield();\n    }\n    yieldRenderTask() {\n        return this.taskQueue[1 /* render */].yield();\n    }\n    yieldMacroTask() {\n        return this.taskQueue[2 /* macroTask */].yield();\n    }\n    yieldPostRenderTask() {\n        return this.taskQueue[3 /* postRender */].yield();\n    }\n    yieldIdleTask() {\n        return this.taskQueue[4 /* idle */].yield();\n    }\n    async yieldAll(repeat = 1) {\n        // Yield sequentially from \"large\" to \"small\" so that any smaller tasks initiated by larger tasks are also still awaited,\n        // as well as guaranteeing a single round of persistent tasks from each queue.\n        // Don't change the order or into parallel, without thoroughly testing the ramifications on persistent and recursively queued tasks.\n        // These aspects are currently relatively poorly tested.\n        while (repeat-- > 0) {\n            await this.yieldIdleTask();\n            await this.yieldPostRenderTask();\n            await this.yieldMacroTask();\n            await this.yieldRenderTask();\n            await this.yieldMicroTask();\n        }\n    }\n    queueMicroTask(callback, opts) {\n        return this.taskQueue[0 /* microTask */].queueTask(callback, opts);\n    }\n    queueRenderTask(callback, opts) {\n        return this.taskQueue[1 /* render */].queueTask(callback, opts);\n    }\n    queueMacroTask(callback, opts) {\n        return this.taskQueue[2 /* macroTask */].queueTask(callback, opts);\n    }\n    queuePostRenderTask(callback, opts) {\n        return this.taskQueue[3 /* postRender */].queueTask(callback, opts);\n    }\n    queueIdleTask(callback, opts) {\n        return this.taskQueue[4 /* idle */].queueTask(callback, opts);\n    }\n    requestFlush(taskQueue) {\n        switch (taskQueue.priority) {\n            case 0 /* microTask */:\n                return this.flush[taskQueue.priority]();\n            case 1 /* render */:\n            case 2 /* macroTask */:\n            case 3 /* postRender */:\n            case 4 /* idle */:\n                return this.flush[taskQueue.priority].request();\n        }\n    }\n    cancelFlush(taskQueue) {\n        switch (taskQueue.priority) {\n            case 0 /* microTask */:\n                return;\n            case 1 /* render */:\n            case 2 /* macroTask */:\n            case 3 /* postRender */:\n            case 4 /* idle */:\n                return this.flush[taskQueue.priority].cancel();\n        }\n    }\n};\n__decorate([\n    bound,\n    __metadata(\"design:type\", Function),\n    __metadata(\"design:paramtypes\", []),\n    __metadata(\"design:returntype\", Promise)\n], BrowserScheduler.prototype, \"yieldMicroTask\", null);\n__decorate([\n    bound,\n    __metadata(\"design:type\", Function),\n    __metadata(\"design:paramtypes\", []),\n    __metadata(\"design:returntype\", Promise)\n], BrowserScheduler.prototype, \"yieldRenderTask\", null);\n__decorate([\n    bound,\n    __metadata(\"design:type\", Function),\n    __metadata(\"design:paramtypes\", []),\n    __metadata(\"design:returntype\", Promise)\n], BrowserScheduler.prototype, \"yieldMacroTask\", null);\n__decorate([\n    bound,\n    __metadata(\"design:type\", Function),\n    __metadata(\"design:paramtypes\", []),\n    __metadata(\"design:returntype\", Promise)\n], BrowserScheduler.prototype, \"yieldPostRenderTask\", null);\n__decorate([\n    bound,\n    __metadata(\"design:type\", Function),\n    __metadata(\"design:paramtypes\", []),\n    __metadata(\"design:returntype\", Promise)\n], BrowserScheduler.prototype, \"yieldIdleTask\", null);\n__decorate([\n    bound,\n    __metadata(\"design:type\", Function),\n    __metadata(\"design:paramtypes\", [Number]),\n    __metadata(\"design:returntype\", Promise)\n], BrowserScheduler.prototype, \"yieldAll\", null);\nBrowserScheduler = __decorate([\n    __param(0, IClock), __param(1, IDOM),\n    __metadata(\"design:paramtypes\", [Object, HTMLDOM])\n], BrowserScheduler);\nexport { BrowserScheduler };\n//# sourceMappingURL=browser-scheduler.js.map","import { __decorate, __metadata, __param } from \"tslib\";\nimport { DI, IContainer, Registration } from '@aurelia/kernel';\nimport { IDOM, IDOMInitializer, IScheduler, DOM } from '@aurelia/runtime';\nimport { RuntimeHtmlConfiguration, HTMLDOM } from '@aurelia/runtime-html';\nimport { BrowserScheduler } from './browser-scheduler';\nlet BrowserDOMInitializer = class BrowserDOMInitializer {\n    constructor(container) {\n        this.container = container;\n    }\n    static register(container) {\n        return Registration.singleton(IDOMInitializer, this).register(container);\n    }\n    initialize(config) {\n        if (this.container.has(IDOM, false)) {\n            return this.container.get(IDOM);\n        }\n        let dom;\n        if (config !== undefined) {\n            if (config.dom !== undefined) {\n                dom = config.dom;\n            }\n            else if (config.host.ownerDocument !== null) {\n                dom = new HTMLDOM(window, config.host.ownerDocument, Node, Element, HTMLElement, CustomEvent, CSSStyleSheet, ShadowRoot);\n            }\n            else {\n                dom = new HTMLDOM(window, document, Node, Element, HTMLElement, CustomEvent, CSSStyleSheet, ShadowRoot);\n            }\n        }\n        else {\n            dom = new HTMLDOM(window, document, Node, Element, HTMLElement, CustomEvent, CSSStyleSheet, ShadowRoot);\n        }\n        Registration.instance(IDOM, dom).register(this.container);\n        if (DOM.scheduler === void 0) {\n            this.container.register(BrowserScheduler);\n        }\n        else {\n            Registration.instance(IScheduler, DOM.scheduler).register(this.container);\n        }\n        return dom;\n    }\n};\nBrowserDOMInitializer = __decorate([\n    __param(0, IContainer),\n    __metadata(\"design:paramtypes\", [Object])\n], BrowserDOMInitializer);\nexport const IDOMInitializerRegistration = BrowserDOMInitializer;\nexport const IBrowserSchedulerRegistration = BrowserScheduler;\n/**\n * Default HTML-specific, browser-specific implementations for the following interfaces:\n * - `IDOMInitializer`\n */\nexport const DefaultComponents = [\n    IDOMInitializerRegistration,\n    IBrowserSchedulerRegistration,\n];\n/**\n * A DI configuration object containing html-specific, browser-specific registrations:\n * - `RuntimeHtmlConfiguration` from `@aurelia/runtime-html`\n * - `DefaultComponents`\n */\nexport const RuntimeHtmlBrowserConfiguration = {\n    /**\n     * Apply this configuration to the provided container.\n     */\n    register(container) {\n        return RuntimeHtmlConfiguration\n            .register(container)\n            .register(...DefaultComponents);\n    },\n    /**\n     * Create a new container with this configuration applied to it.\n     */\n    createContainer() {\n        return this.register(DI.createContainer());\n    }\n};\nexport { BrowserDOMInitializer, BrowserScheduler, };\n//# sourceMappingURL=index.js.map","import { DefaultBindingLanguage as JitDefaultBindingLanguage, DefaultBindingSyntax as JitDefaultBindingSyntax, DefaultComponents as JitDefaultComponents } from '@aurelia/jit';\nimport { DefaultBindingLanguage as JitHtmlDefaultBindingLanguage, DefaultComponents as JitHtmlDefaultComponents } from '@aurelia/jit-html';\nimport { DI, Profiler } from '@aurelia/kernel';\nimport { RuntimeHtmlBrowserConfiguration } from '@aurelia/runtime-html-browser';\nconst { enter, leave } = Profiler.createTimer('JitHtmlBrowserConfiguration');\n/**\n * A DI configuration object containing html-specific, browser-specific registrations:\n * - `RuntimeHtmlBrowserConfiguration` from `@aurelia/runtime-html-browser`\n * - `DefaultComponents` from `@aurelia/jit`\n * - `DefaultBindingSyntax` from `@aurelia/jit`\n * - `DefaultBindingLanguage` from `@aurelia/jit`\n * - `DefaultComponents` from `@aurelia/jit-html`\n * - `DefaultBindingLanguage` from `@aurelia/jit-html`\n */\nexport const JitHtmlBrowserConfiguration = {\n    /**\n     * Apply this configuration to the provided container.\n     */\n    register(container) {\n        RuntimeHtmlBrowserConfiguration\n            .register(container)\n            .register(...JitDefaultBindingLanguage, ...JitDefaultBindingSyntax, ...JitDefaultComponents, ...JitHtmlDefaultBindingLanguage, ...JitHtmlDefaultComponents);\n        return container;\n    },\n    /**\n     * Create a new container with this configuration applied to it.\n     */\n    createContainer() {\n        return this.register(DI.createContainer());\n    }\n};\n//# sourceMappingURL=index.js.map","import { DebugConfiguration } from '@aurelia/debug';\nimport { JitHtmlBrowserConfiguration } from '@aurelia/jit-html-browser';\nimport { DI } from '@aurelia/kernel';\nimport { Aurelia as $Aurelia, CustomElement } from '@aurelia/runtime';\n// TODO: SSR?? abstract HTMLElement and document.\nfunction createAurelia() {\n    const au = new Aurelia();\n    au.register(JitHtmlBrowserConfiguration);\n    // eslint-disable-next-line sonarjs/no-collapsible-if\n    if (typeof process !== 'undefined' && typeof process.env === 'object') {\n        // Just use NODE_ENV to control build process.\n        // Bundlers (at least webpack/dumber/parcel) have feature to remove this branch in production.\n        // Then tree-shaking/minifier will remove unused DebugConfiguration import.\n        if (process.env.NODE_ENV !== 'production') {\n            au.register(DebugConfiguration);\n        }\n    }\n    return au;\n}\nexport class Aurelia extends $Aurelia {\n    constructor(container = DI.createContainer()) {\n        super(container);\n    }\n    static start(root) {\n        return createAurelia().start(root);\n    }\n    static app(config) {\n        return createAurelia().app(config);\n    }\n    static register(...params) {\n        return createAurelia().register(...params);\n    }\n    app(config) {\n        if (CustomElement.isType(config)) {\n            // Default to custom element element name\n            const definition = CustomElement.getDefinition(config);\n            let host = document.querySelector(definition.name);\n            if (host === null) {\n                // When no target is found, default to body.\n                // For example, when user forgot to write <my-app></my-app> in html.\n                host = document.body;\n            }\n            return super.app({\n                host: host,\n                component: config\n            });\n        }\n        return super.app(config);\n    }\n}\n//# sourceMappingURL=quick-start.js.map","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || new Function(\"return this\")();\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n","\"use strict\";\n\nvar isOldIE = function isOldIE() {\n  var memo;\n  return function memorize() {\n    if (typeof memo === 'undefined') {\n      // Test for IE <= 9 as proposed by Browserhacks\n      // @see http://browserhacks.com/#hack-e71d8692f65334173fee715c222cb805\n      // Tests for existence of standard globals is to allow style-loader\n      // to operate correctly into non-standard environments\n      // @see https://github.com/webpack-contrib/style-loader/issues/177\n      memo = Boolean(window && document && document.all && !window.atob);\n    }\n\n    return memo;\n  };\n}();\n\nvar getTarget = function getTarget() {\n  var memo = {};\n  return function memorize(target) {\n    if (typeof memo[target] === 'undefined') {\n      var styleTarget = document.querySelector(target); // Special case to return head of iframe instead of iframe itself\n\n      if (window.HTMLIFrameElement && styleTarget instanceof window.HTMLIFrameElement) {\n        try {\n          // This will throw an exception if access to iframe is blocked\n          // due to cross-origin restrictions\n          styleTarget = styleTarget.contentDocument.head;\n        } catch (e) {\n          // istanbul ignore next\n          styleTarget = null;\n        }\n      }\n\n      memo[target] = styleTarget;\n    }\n\n    return memo[target];\n  };\n}();\n\nvar stylesInDom = {};\n\nfunction modulesToDom(moduleId, list, options) {\n  for (var i = 0; i < list.length; i++) {\n    var part = {\n      css: list[i][1],\n      media: list[i][2],\n      sourceMap: list[i][3]\n    };\n\n    if (stylesInDom[moduleId][i]) {\n      stylesInDom[moduleId][i](part);\n    } else {\n      stylesInDom[moduleId].push(addStyle(part, options));\n    }\n  }\n}\n\nfunction insertStyleElement(options) {\n  var style = document.createElement('style');\n  var attributes = options.attributes || {};\n\n  if (typeof attributes.nonce === 'undefined') {\n    var nonce = typeof __webpack_nonce__ !== 'undefined' ? __webpack_nonce__ : null;\n\n    if (nonce) {\n      attributes.nonce = nonce;\n    }\n  }\n\n  Object.keys(attributes).forEach(function (key) {\n    style.setAttribute(key, attributes[key]);\n  });\n\n  if (typeof options.insert === 'function') {\n    options.insert(style);\n  } else {\n    var target = getTarget(options.insert || 'head');\n\n    if (!target) {\n      throw new Error(\"Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.\");\n    }\n\n    target.appendChild(style);\n  }\n\n  return style;\n}\n\nfunction removeStyleElement(style) {\n  // istanbul ignore if\n  if (style.parentNode === null) {\n    return false;\n  }\n\n  style.parentNode.removeChild(style);\n}\n/* istanbul ignore next  */\n\n\nvar replaceText = function replaceText() {\n  var textStore = [];\n  return function replace(index, replacement) {\n    textStore[index] = replacement;\n    return textStore.filter(Boolean).join('\\n');\n  };\n}();\n\nfunction applyToSingletonTag(style, index, remove, obj) {\n  var css = remove ? '' : obj.css; // For old IE\n\n  /* istanbul ignore if  */\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = replaceText(index, css);\n  } else {\n    var cssNode = document.createTextNode(css);\n    var childNodes = style.childNodes;\n\n    if (childNodes[index]) {\n      style.removeChild(childNodes[index]);\n    }\n\n    if (childNodes.length) {\n      style.insertBefore(cssNode, childNodes[index]);\n    } else {\n      style.appendChild(cssNode);\n    }\n  }\n}\n\nfunction applyToTag(style, options, obj) {\n  var css = obj.css;\n  var media = obj.media;\n  var sourceMap = obj.sourceMap;\n\n  if (media) {\n    style.setAttribute('media', media);\n  } else {\n    style.removeAttribute('media');\n  }\n\n  if (sourceMap && btoa) {\n    css += \"\\n/*# sourceMappingURL=data:application/json;base64,\".concat(btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap)))), \" */\");\n  } // For old IE\n\n  /* istanbul ignore if  */\n\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    while (style.firstChild) {\n      style.removeChild(style.firstChild);\n    }\n\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nvar singleton = null;\nvar singletonCounter = 0;\n\nfunction addStyle(obj, options) {\n  var style;\n  var update;\n  var remove;\n\n  if (options.singleton) {\n    var styleIndex = singletonCounter++;\n    style = singleton || (singleton = insertStyleElement(options));\n    update = applyToSingletonTag.bind(null, style, styleIndex, false);\n    remove = applyToSingletonTag.bind(null, style, styleIndex, true);\n  } else {\n    style = insertStyleElement(options);\n    update = applyToTag.bind(null, style, options);\n\n    remove = function remove() {\n      removeStyleElement(style);\n    };\n  }\n\n  update(obj);\n  return function updateStyle(newObj) {\n    if (newObj) {\n      if (newObj.css === obj.css && newObj.media === obj.media && newObj.sourceMap === obj.sourceMap) {\n        return;\n      }\n\n      update(obj = newObj);\n    } else {\n      remove();\n    }\n  };\n}\n\nmodule.exports = function (moduleId, list, options) {\n  options = options || {}; // Force single-tag solution on IE6-9, which has a hard limit on the # of <style>\n  // tags it will allow on a page\n\n  if (!options.singleton && typeof options.singleton !== 'boolean') {\n    options.singleton = isOldIE();\n  }\n\n  moduleId = options.base ? moduleId + options.base : moduleId;\n  list = list || [];\n\n  if (!stylesInDom[moduleId]) {\n    stylesInDom[moduleId] = [];\n  }\n\n  modulesToDom(moduleId, list, options);\n  return function update(newList) {\n    newList = newList || [];\n\n    if (Object.prototype.toString.call(newList) !== '[object Array]') {\n      return;\n    }\n\n    if (!stylesInDom[moduleId]) {\n      stylesInDom[moduleId] = [];\n    }\n\n    modulesToDom(moduleId, newList, options);\n\n    for (var j = newList.length; j < stylesInDom[moduleId].length; j++) {\n      stylesInDom[moduleId][j]();\n    }\n\n    stylesInDom[moduleId].length = newList.length;\n\n    if (stylesInDom[moduleId].length === 0) {\n      delete stylesInDom[moduleId];\n    }\n  };\n};","\"use strict\";\n\n/*\n  MIT License http://www.opensource.org/licenses/mit-license.php\n  Author Tobias Koppers @sokra\n*/\n// css base code, injected by the css-loader\n// eslint-disable-next-line func-names\nmodule.exports = function (useSourceMap) {\n  var list = []; // return the list of modules as css string\n\n  list.toString = function toString() {\n    return this.map(function (item) {\n      var content = cssWithMappingToString(item, useSourceMap);\n\n      if (item[2]) {\n        return \"@media \".concat(item[2], \" {\").concat(content, \"}\");\n      }\n\n      return content;\n    }).join('');\n  }; // import a list of modules into the list\n  // eslint-disable-next-line func-names\n\n\n  list.i = function (modules, mediaQuery, dedupe) {\n    if (typeof modules === 'string') {\n      // eslint-disable-next-line no-param-reassign\n      modules = [[null, modules, '']];\n    }\n\n    var alreadyImportedModules = {};\n\n    if (dedupe) {\n      for (var i = 0; i < this.length; i++) {\n        // eslint-disable-next-line prefer-destructuring\n        var id = this[i][0];\n\n        if (id != null) {\n          alreadyImportedModules[id] = true;\n        }\n      }\n    }\n\n    for (var _i = 0; _i < modules.length; _i++) {\n      var item = [].concat(modules[_i]);\n\n      if (dedupe && alreadyImportedModules[item[0]]) {\n        // eslint-disable-next-line no-continue\n        continue;\n      }\n\n      if (mediaQuery) {\n        if (!item[2]) {\n          item[2] = mediaQuery;\n        } else {\n          item[2] = \"\".concat(mediaQuery, \" and \").concat(item[2]);\n        }\n      }\n\n      list.push(item);\n    }\n  };\n\n  return list;\n};\n\nfunction cssWithMappingToString(item, useSourceMap) {\n  var content = item[1] || ''; // eslint-disable-next-line prefer-destructuring\n\n  var cssMapping = item[3];\n\n  if (!cssMapping) {\n    return content;\n  }\n\n  if (useSourceMap && typeof btoa === 'function') {\n    var sourceMapping = toComment(cssMapping);\n    var sourceURLs = cssMapping.sources.map(function (source) {\n      return \"/*# sourceURL=\".concat(cssMapping.sourceRoot || '').concat(source, \" */\");\n    });\n    return [content].concat(sourceURLs).concat([sourceMapping]).join('\\n');\n  }\n\n  return [content].join('\\n');\n} // Adapted from convert-source-map (MIT)\n\n\nfunction toComment(sourceMap) {\n  // eslint-disable-next-line no-undef\n  var base64 = btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap))));\n  var data = \"sourceMappingURL=data:application/json;charset=utf-8;base64,\".concat(base64);\n  return \"/*# \".concat(data, \" */\");\n}","var api = require(\"!../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\");\n            var content = require(\"!!../node_modules/css-loader/dist/cjs.js!../node_modules/postcss-loader/src/index.js??ref--4-2!./my-app.css\");\n\n            content = content.__esModule ? content.default : content;\n\n            if (typeof content === 'string') {\n              content = [[module.id, content, '']];\n            }\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(module.id, content, options);\n\nvar exported = content.locals ? content.locals : {};\n\n\n\nmodule.exports = exported;","var api = require(\"!../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\");\n            var content = require(\"!!../node_modules/css-loader/dist/cjs.js!../node_modules/postcss-loader/src/index.js??ref--4-2!./audio-player.css\");\n\n            content = content.__esModule ? content.default : content;\n\n            if (typeof content === 'string') {\n              content = [[module.id, content, '']];\n            }\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(module.id, content, options);\n\nvar exported = content.locals ? content.locals : {};\n\n\n\nmodule.exports = exported;","// Imports\nvar ___CSS_LOADER_API_IMPORT___ = require(\"../node_modules/css-loader/dist/runtime/api.js\");\nexports = ___CSS_LOADER_API_IMPORT___(false);\n// Module\nexports.push([module.id, \":root {\\n  /* --main-bg-color: #382901; */\\n  --main-bg-color-rgb: 31, 23, 1;\\n  --main-bg-color: rgb(var(--main-bg-color-rgb));\\n  --inverse-txt-color: #dad8d0;\\n\\n  --base-fnt-size: 16px;\\n}\\n\\n* {\\n  box-sizing: border-box;\\n  font-family: 'Ubuntu', serif;\\n}\\n\\nbody {\\n  font-size: var(--base-fnt-size);\\n  height: 100vh;\\n  margin: 0;\\n}\\n\\nmy-app {\\n  display: -webkit-box;\\n  display: flex;\\n  -webkit-box-orient: vertical;\\n  -webkit-box-direction: normal;\\n          flex-direction: column;\\n  height: 100vh;\\n  margin: 0;\\n}\\n\\nheader {\\n  background-color: var(--main-bg-color);\\n  color: var(--inverse-txt-color);\\n  padding: .75em 1em;\\n}\\n\\nheader>h1 {\\n  margin: 0;\\n}\\n\\nfooter {\\n  background-color: var(--main-bg-color);\\n  color: var(--inverse-txt-color);\\n  font-size: .75em;\\n  padding: .75em 1em;\\n  text-align: center;\\n}\\n\\nmain {\\n  -webkit-box-flex: 1;\\n          flex-grow: 1;\\n  margin: 0;\\n  overflow-x: auto;\\n  padding: 1.75em 1em .75em 0;\\n  width: 100vw;\\n}\\n\\n.card:not(:last-of-type) {\\n  margin-left: calc(var(--card-width) * -.5);\\n}\\n\\n.card:hover:not(:last-of-type) {\\n  margin-left: 0;\\n}\\n\\n.card>.inner-border {\\n  bottom: initial;\\n  border-radius: 5px;\\n  border: 1px solid var(--inverse-txt-color);\\n  height: calc(var(--card-height) - 1.25em);\\n  pointer-events: none;\\n  position: absolute;\\n  right: initial;\\n  width: calc(var(--card-width) - 1.25em);\\n}\\n\\n.card {\\n  --card-height: 200px;\\n  --card-width: 250px;\\n\\n  -webkit-box-align: center;\\n\\n          align-items: center;\\n  background: -webkit-gradient(linear, left top, left bottom, from(rgba(179, 156, 95, 0.5)), to(rgba(150, 117, 24, 0.75))), no-repeat center url('/assets/img/talmud_scroll.jpg');\\n  background: linear-gradient(rgba(179, 156, 95, 0.5), rgba(150, 117, 24, 0.75)), no-repeat center url('/assets/img/talmud_scroll.jpg');\\n  border-radius: 5px;\\n  box-shadow: 1.5rem 0 2rem #222;\\n  color: #000;\\n  display: -webkit-box;\\n  display: flex;\\n  -webkit-box-orient: vertical;\\n  -webkit-box-direction: normal;\\n          flex-direction: column;\\n  height: var(--card-height);\\n  -webkit-box-pack: center;\\n          justify-content: center;\\n  min-width: var(--card-width);\\n  position: relative;\\n  text-align: center;\\n  -webkit-transition: all .15s ease-in-out;\\n  transition: all .15s ease-in-out;\\n  -webkit-transition: margin .3s ease-in-out;\\n  transition: margin .3s ease-in-out;\\n  width: var(--card-width);\\n}\\n\\n.card>h3,\\n.card>h5,\\n.card>div {\\n  margin: 0;\\n}\\n\\n.card>h3 {\\n  font-size: 26px;\\n  font-weight: 900;\\n}\\n\\n.card>h5 {\\n  font-size: 12px;\\n  font-style: italic;\\n  margin-bottom: .75em;\\n  margin-top: -30px;\\n  -webkit-transition: all .15s ease-in-out;\\n  transition: all .15s ease-in-out;\\n  display: -webkit-box;\\n  display: flex;\\n  -webkit-box-orient: vertical;\\n  -webkit-box-direction: normal;\\n          flex-direction: column;\\n}\\n\\n.card>h5 a {\\n  color: #000;\\n}\\n\\n.card>h5 a:hover {\\n  color: #38362f;\\n}\\n\\n.card>h5 button {\\n  font-weight: 900;\\n  border: 0;\\n  border-radius: 5px;\\n  background-color: white;\\n  color: black;\\n  cursor: pointer;\\n}\\n\\n.card:hover>h5 {\\n  margin-top: -20px;\\n}\\n\\n.card>div {\\n  font-weight: 900;\\n}\\n\\n.card>span {\\n  bottom: 5px;\\n  font-size: .75em;\\n  padding-bottom: 5px;\\n  padding-right: 5px;\\n  position: absolute;\\n  right: 5px;\\n}\\n\\n.card>h3:after {\\n  content: \\\"\\\";\\n  background-color: #38362f;\\n  display: inline-block;\\n  height: 5px;\\n  opacity: .01;\\n  margin-bottom: 20px;\\n  -webkit-transition: all 0.2s ease-in-out;\\n  transition: all 0.2s ease-in-out;\\n  -webkit-transition-duration: 0.75s;\\n          transition-duration: 0.75s;\\n  width: 5%;\\n}\\n\\n.card:hover>h3:after {\\n  opacity: 1;\\n  width: 100%;\\n}\\n\\nmain>h4 {\\n  background-color: var(--main-bg-color);\\n  border-radius: 5px;\\n  color: var(--inverse-txt-color);\\n  height: 200px;\\n  margin: 0;\\n  padding: 1em .5em;\\n  -webkit-text-orientation: upright;\\n          text-orientation: upright;\\n  -webkit-writing-mode: sideways-lr;\\n      -ms-writing-mode: sideways-lr;\\n          writing-mode: sideways-lr;\\n}\\n\\n.wrapper {\\n  display: -webkit-box;\\n  display: flex;\\n  -webkit-box-orient: horizontal;\\n  -webkit-box-direction: reverse;\\n          flex-direction: row-reverse;\\n  -webkit-box-pack: end;\\n          justify-content: flex-end;\\n}\\n\\n\\n\\n\\n\\n\\n\\n.faux-dialog {\\n  -webkit-box-align: center;\\n          align-items: center;\\n  background-color: rgba(var(--main-bg-color-rgb), .9);\\n  bottom: 50%;\\n  color: var(--inverse-txt-color);\\n  display: -webkit-box;\\n  display: flex;\\n  height: 0;\\n  -webkit-box-pack: center;\\n          justify-content: center;\\n  left: 50%;\\n  position: absolute;\\n  right: 50%;\\n  top: 50%;\\n  -webkit-transition: all 0.5s ease-in-out;\\n  transition: all 0.5s ease-in-out;\\n  width: 0;\\n  -webkit-box-orient: vertical;\\n  -webkit-box-direction: normal;\\n          flex-direction: column;\\n  padding: 1em;\\n}\\n\\n.faux-dialog.full {\\n  height: calc(100vh - 60px - 4em);\\n  left: 1em;\\n  right: 0;\\n  top: calc(60px + 1em);\\n  width: calc(100vw - 2em);\\n  bottom: 0;\\n  border-radius: 5px;\\n}\\n\\n.faux-dialog .close {\\n  top: 1em;\\n  position: absolute;\\n  right: 1em;\\n}\\n\\n.faux-dialog .close:hover {\\n  cursor: pointer;\\n}\\n\\n.faux-dialog audio-player {\\n  width: 100%;\\n}\", \"\"]);\n// Exports\nmodule.exports = exports;\n","// Imports\nvar ___CSS_LOADER_API_IMPORT___ = require(\"../node_modules/css-loader/dist/runtime/api.js\");\nexports = ___CSS_LOADER_API_IMPORT___(false);\n// Module\nexports.push([module.id, \".current-time {\\r\\n    width: 100%;\\r\\n}\\r\\n\\r\\n.controls button {\\r\\n    display: -webkit-box;\\r\\n    display: flex;\\r\\n    -webkit-box-orient: vertical;\\r\\n    -webkit-box-direction: normal;\\r\\n            flex-direction: column;\\r\\n\\r\\n    border-radius: 5px;\\r\\n    border: 1px solid transparent;\\r\\n    padding: 5px 10px;\\r\\n    font-size: .8em;\\r\\n    min-width: 100px;\\r\\n\\r\\n    -webkit-box-flex: 1;\\r\\n\\r\\n            flex: 1 1 5em;\\r\\n    margin: .5rem;\\r\\n    box-shadow: 0 .75rem .5rem -.5rem hsl(57, 0%, 37%);\\r\\n    cursor: pointer;\\r\\n    -webkit-transition: all .5s;\\r\\n    transition: all .5s;\\r\\n    -webkit-box-align: center;\\r\\n            align-items: center;\\r\\n}\\r\\n\\r\\n.controls button:hover,\\r\\n.controls button:focus {\\r\\n    background-color: rgba(179, 156, 95, 0.5);\\r\\n    box-shadow: 0 .75rem .5rem -.5rem rgba(179, 156, 95, 0.5);\\r\\n}\\r\\n\\r\\n.icon {\\r\\n    font-style: normal;\\r\\n}\\r\\n\\r\\n.controls {\\r\\n    display: -webkit-box;\\r\\n    display: flex;\\r\\n    flex-wrap: wrap;\\r\\n}\\r\\n\\r\\n\\r\\n/* .seek::before {\\r\\n    content: \\\"15\\\";\\r\\n    color: #aaa;\\r\\n    position: absolute;\\r\\n    margin-left: 4px;\\r\\n    border: 1px solid #aaa;\\r\\n    border-radius: 50%;\\r\\n    font-size: 12px;\\r\\n} */\\r\\n\\r\\n.play {\\r\\n    margin-right: 1em;\\r\\n    -webkit-box-flex: 3;\\r\\n            flex: 3 1 20em;\\r\\n}\\r\\n\\r\\n.volume {\\r\\n    display: -webkit-box;\\r\\n    display: flex;\\r\\n    -webkit-box-align: center;\\r\\n            align-items: center;\\r\\n}\\r\\n\\r\\n.volume i {\\r\\n    line-height: 1em;\\r\\n}\", \"\"]);\n// Exports\nmodule.exports = exports;\n","import { DOM } from '@aurelia/runtime-html';\nexport const retryStrategy = {\n    fixed: 0,\n    incremental: 1,\n    exponential: 2,\n    random: 3\n};\nconst defaultRetryConfig = {\n    maxRetries: 3,\n    interval: 1000,\n    strategy: retryStrategy.fixed\n};\n/**\n * Interceptor that retries requests on error, based on a given RetryConfiguration.\n */\nexport class RetryInterceptor {\n    /**\n     * Creates an instance of RetryInterceptor.\n     */\n    constructor(retryConfig) {\n        this.retryConfig = { ...defaultRetryConfig, ...(retryConfig !== undefined ? retryConfig : {}) };\n        if (this.retryConfig.strategy === retryStrategy.exponential &&\n            this.retryConfig.interval <= 1000) {\n            throw new Error('An interval less than or equal to 1 second is not allowed when using the exponential retry strategy');\n        }\n    }\n    /**\n     * Called with the request before it is sent. It remembers the request so it can be retried on error.\n     *\n     * @param request - The request to be sent.\n     * @returns The existing request, a new request or a response; or a Promise for any of these.\n     */\n    request(request) {\n        if (!request.retryConfig) {\n            request.retryConfig = { ...this.retryConfig };\n            request.retryConfig.counter = 0;\n        }\n        // do this on every request\n        request.retryConfig.requestClone = request.clone();\n        return request;\n    }\n    /**\n     * Called with the response after it is received. Clears the remembered request, as it was succesfull.\n     *\n     * @param response - The response.\n     * @returns The response; or a Promise for one.\n     */\n    response(response, request) {\n        // retry was successful, so clean up after ourselves\n        Reflect.deleteProperty(request, 'retryConfig');\n        return response;\n    }\n    /**\n     * Handles fetch errors and errors generated by previous interceptors. This\n     * function acts as a Promise rejection handler. It wil retry the remembered request based on the\n     * configured RetryConfiguration.\n     *\n     * @param error - The rejection value from the fetch request or from a\n     * previous interceptor.\n     * @returns The response of the retry; or a Promise for one.\n     */\n    responseError(error, request, httpClient) {\n        const { retryConfig } = request;\n        const { requestClone } = retryConfig;\n        return Promise.resolve().then(() => {\n            if (retryConfig.counter < retryConfig.maxRetries) {\n                const result = retryConfig.doRetry !== undefined ? retryConfig.doRetry(error, request) : true;\n                return Promise.resolve(result).then(doRetry => {\n                    if (doRetry) {\n                        retryConfig.counter++;\n                        const delay = calculateDelay(retryConfig);\n                        return new Promise((resolve) => DOM.window.setTimeout(resolve, !isNaN(delay) ? delay : 0))\n                            .then(() => {\n                            const newRequest = requestClone.clone();\n                            if (typeof (retryConfig.beforeRetry) === 'function') {\n                                return retryConfig.beforeRetry(newRequest, httpClient);\n                            }\n                            return newRequest;\n                        })\n                            .then(newRequest => {\n                            const retryableRequest = { ...newRequest, retryConfig };\n                            return httpClient.fetch(retryableRequest);\n                        });\n                    }\n                    // no more retries, so clean up\n                    Reflect.deleteProperty(request, 'retryConfig');\n                    throw error;\n                });\n            }\n            // no more retries, so clean up\n            Reflect.deleteProperty(request, 'retryConfig');\n            throw error;\n        });\n    }\n}\nfunction calculateDelay(retryConfig) {\n    const { interval, strategy, minRandomInterval, maxRandomInterval, counter } = retryConfig;\n    if (typeof (strategy) === 'function') {\n        return retryConfig.strategy(counter);\n    }\n    switch (strategy) {\n        case (retryStrategy.fixed):\n            return retryStrategies[retryStrategy.fixed](interval);\n        case (retryStrategy.incremental):\n            return retryStrategies[retryStrategy.incremental](counter, interval);\n        case (retryStrategy.exponential):\n            return retryStrategies[retryStrategy.exponential](counter, interval);\n        case (retryStrategy.random):\n            return retryStrategies[retryStrategy.random](counter, interval, minRandomInterval, maxRandomInterval);\n        default:\n            throw new Error('Unrecognized retry strategy');\n    }\n}\nconst retryStrategies = [\n    // fixed\n    interval => interval,\n    // incremental\n    (retryCount, interval) => interval * retryCount,\n    // exponential\n    (retryCount, interval) => retryCount === 1 ? interval : interval ** retryCount / 1000,\n    // random\n    (retryCount, interval, minRandomInterval = 0, maxRandomInterval = 60000) => {\n        return Math.random() * (maxRandomInterval - minRandomInterval) + minRandomInterval;\n    }\n];\n//# sourceMappingURL=retry-interceptor.js.map","import { RetryInterceptor } from './retry-interceptor';\n/**\n * A class for configuring HttpClients.\n */\nexport class HttpClientConfiguration {\n    constructor() {\n        /**\n         * The base URL to be prepended to each Request's url before sending.\n         */\n        this.baseUrl = '';\n        /**\n         * Default values to apply to init objects when creating Requests. Note that\n         * defaults cannot be applied when Request objects are manually created because\n         * Request provides its own defaults and discards the original init object.\n         * See also https://developer.mozilla.org/en-US/docs/Web/API/Request/Request\n         */\n        this.defaults = {};\n        /**\n         * Interceptors to be added to the HttpClient.\n         */\n        this.interceptors = [];\n    }\n    /**\n     * Sets the baseUrl.\n     *\n     * @param baseUrl - The base URL.\n     * @returns The chainable instance of this configuration object.\n     * @chainable\n     */\n    withBaseUrl(baseUrl) {\n        this.baseUrl = baseUrl;\n        return this;\n    }\n    /**\n     * Sets the defaults.\n     *\n     * @param defaults - The defaults.\n     * @returns The chainable instance of this configuration object.\n     * @chainable\n     */\n    withDefaults(defaults) {\n        this.defaults = defaults;\n        return this;\n    }\n    /**\n     * Adds an interceptor to be run on all requests or responses.\n     *\n     * @param interceptor - An object with request, requestError,\n     * response, or responseError methods. request and requestError act as\n     * resolve and reject handlers for the Request before it is sent.\n     * response and responseError act as resolve and reject handlers for\n     * the Response after it has been received.\n     * @returns The chainable instance of this configuration object.\n     * @chainable\n     */\n    withInterceptor(interceptor) {\n        this.interceptors.push(interceptor);\n        return this;\n    }\n    /**\n     * Applies a configuration that addresses common application needs, including\n     * configuring same-origin credentials, and using rejectErrorResponses.\n     *\n     * @returns The chainable instance of this configuration object.\n     * @chainable\n     */\n    useStandardConfiguration() {\n        const standardConfig = { credentials: 'same-origin' };\n        Object.assign(this.defaults, standardConfig, this.defaults);\n        return this.rejectErrorResponses();\n    }\n    /**\n     * Causes Responses whose status codes fall outside the range 200-299 to reject.\n     * The fetch API only rejects on network errors or other conditions that prevent\n     * the request from completing, meaning consumers must inspect Response.ok in the\n     * Promise continuation to determine if the server responded with a success code.\n     * This method adds a response interceptor that causes Responses with error codes\n     * to be rejected, which is common behavior in HTTP client libraries.\n     *\n     * @returns The chainable instance of this configuration object.\n     * @chainable\n     */\n    rejectErrorResponses() {\n        return this.withInterceptor({ response: rejectOnError });\n    }\n    withRetry(config) {\n        const interceptor = new RetryInterceptor(config);\n        return this.withInterceptor(interceptor);\n    }\n}\nfunction rejectOnError(response) {\n    if (!response.ok) {\n        throw response;\n    }\n    return response;\n}\n//# sourceMappingURL=http-client-configuration.js.map","import { __decorate, __metadata, __param } from \"tslib\";\nimport { IDOM } from '@aurelia/runtime';\nimport { DOM, HTMLDOM } from '@aurelia/runtime-html';\nimport { HttpClientConfiguration } from './http-client-configuration';\nimport { RetryInterceptor } from './retry-interceptor';\nconst absoluteUrlRegexp = /^([a-z][a-z0-9+\\-.]*:)?\\/\\//i;\n/**\n * An HTTP client based on the Fetch API.\n */\nlet HttpClient = class HttpClient {\n    /**\n     * Creates an instance of HttpClient.\n     */\n    constructor(dom) {\n        this.dom = dom;\n        if (dom.window.fetch === undefined) {\n            throw new Error('HttpClient requires a Fetch API implementation, but the current environment doesn\\'t support it. You may need to load a polyfill such as https://github.com/github/fetch');\n        }\n        this.dom = dom;\n        this.activeRequestCount = 0;\n        this.isRequesting = false;\n        this.isConfigured = false;\n        this.baseUrl = '';\n        this.defaults = null;\n        this.interceptors = [];\n    }\n    /**\n     * Configure this client with default settings to be used by all requests.\n     *\n     * @param config - A configuration object, or a function that takes a config\n     * object and configures it.\n     * @returns The chainable instance of this HttpClient.\n     * @chainable\n     */\n    configure(config) {\n        let normalizedConfig;\n        if (typeof config === 'object') {\n            const requestInitConfiguration = { defaults: config };\n            normalizedConfig = requestInitConfiguration;\n        }\n        else if (typeof config === 'function') {\n            normalizedConfig = new HttpClientConfiguration();\n            normalizedConfig.baseUrl = this.baseUrl;\n            normalizedConfig.defaults = { ...this.defaults };\n            normalizedConfig.interceptors = this.interceptors;\n            const c = config(normalizedConfig);\n            if (Object.prototype.isPrototypeOf.call(HttpClientConfiguration.prototype, c)) {\n                normalizedConfig = c;\n            }\n        }\n        else {\n            throw new Error('invalid config');\n        }\n        const defaults = normalizedConfig.defaults;\n        if (defaults !== undefined && Object.prototype.isPrototypeOf.call(Headers.prototype, defaults.headers)) {\n            // Headers instances are not iterable in all browsers. Require a plain\n            // object here to allow default headers to be merged into request headers.\n            throw new Error('Default headers must be a plain object.');\n        }\n        const interceptors = normalizedConfig.interceptors;\n        if (interceptors !== undefined && interceptors.length) {\n            // find if there is a RetryInterceptor\n            if (interceptors.filter(x => Object.prototype.isPrototypeOf.call(RetryInterceptor.prototype, x)).length > 1) {\n                throw new Error('Only one RetryInterceptor is allowed.');\n            }\n            const retryInterceptorIndex = interceptors.findIndex(x => Object.prototype.isPrototypeOf.call(RetryInterceptor.prototype, x));\n            if (retryInterceptorIndex >= 0 && retryInterceptorIndex !== interceptors.length - 1) {\n                throw new Error('The retry interceptor must be the last interceptor defined.');\n            }\n        }\n        this.baseUrl = normalizedConfig.baseUrl;\n        this.defaults = defaults;\n        this.interceptors = normalizedConfig.interceptors !== undefined ? normalizedConfig.interceptors : [];\n        this.isConfigured = true;\n        return this;\n    }\n    /**\n     * Starts the process of fetching a resource. Default configuration parameters\n     * will be applied to the Request. The constructed Request will be passed to\n     * registered request interceptors before being sent. The Response will be passed\n     * to registered Response interceptors before it is returned.\n     *\n     * See also https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API\n     *\n     * @param input - The resource that you wish to fetch. Either a\n     * Request object, or a string containing the URL of the resource.\n     * @param init - An options object containing settings to be applied to\n     * the Request.\n     * @returns A Promise for the Response from the fetch request.\n     */\n    fetch(input, init) {\n        this.trackRequestStart();\n        let request = this.buildRequest(input, init);\n        return this.processRequest(request, this.interceptors).then(result => {\n            let response;\n            if (Object.prototype.isPrototypeOf.call(Response.prototype, result)) {\n                response = Promise.resolve(result);\n            }\n            else if (Object.prototype.isPrototypeOf.call(Request.prototype, result)) {\n                request = result;\n                response = fetch(request);\n            }\n            else {\n                throw new Error(`An invalid result was returned by the interceptor chain. Expected a Request or Response instance, but got [${result}]`);\n            }\n            return this.processResponse(response, this.interceptors, request);\n        })\n            .then(result => {\n            if (Object.prototype.isPrototypeOf.call(Request.prototype, result)) {\n                return this.fetch(result);\n            }\n            return result;\n        })\n            .then(result => {\n            this.trackRequestEnd();\n            return result;\n        }, error => {\n            this.trackRequestEnd();\n            throw error;\n        });\n    }\n    buildRequest(input, init) {\n        const defaults = this.defaults !== null ? this.defaults : {};\n        let request;\n        let body;\n        let requestContentType;\n        const parsedDefaultHeaders = parseHeaderValues(defaults.headers);\n        if (Object.prototype.isPrototypeOf.call(Request.prototype, input)) {\n            request = input;\n            requestContentType = new Headers(request.headers).get('Content-Type');\n        }\n        else {\n            if (!init) {\n                init = {};\n            }\n            body = init.body;\n            const bodyObj = body !== undefined ? { body: body } : null;\n            const requestInit = { ...defaults, headers: {}, ...init, ...bodyObj };\n            requestContentType = new Headers(requestInit.headers).get('Content-Type');\n            request = new Request(getRequestUrl(this.baseUrl, input), requestInit);\n        }\n        if (!requestContentType) {\n            if (new Headers(parsedDefaultHeaders).has('content-type')) {\n                request.headers.set('Content-Type', new Headers(parsedDefaultHeaders).get('content-type'));\n            }\n            else if (body !== undefined && isJSON(body)) {\n                request.headers.set('Content-Type', 'application/json');\n            }\n        }\n        setDefaultHeaders(request.headers, parsedDefaultHeaders);\n        if (body !== undefined && Object.prototype.isPrototypeOf.call(Blob.prototype, body) && body.type) {\n            // work around bug in IE & Edge where the Blob type is ignored in the request\n            // https://connect.microsoft.com/IE/feedback/details/2136163\n            request.headers.set('Content-Type', body.type);\n        }\n        return request;\n    }\n    /**\n     * Calls fetch as a GET request.\n     *\n     * @param input - The resource that you wish to fetch. Either a\n     * Request object, or a string containing the URL of the resource.\n     * @param init - An options object containing settings to be applied to\n     * the Request.\n     * @returns A Promise for the Response from the fetch request.\n     */\n    get(input, init) {\n        return this.fetch(input, init);\n    }\n    /**\n     * Calls fetch with request method set to POST.\n     *\n     * @param input - The resource that you wish to fetch. Either a\n     * Request object, or a string containing the URL of the resource.\n     * @param body - The body of the request.\n     * @param init - An options object containing settings to be applied to\n     * the Request.\n     * @returns A Promise for the Response from the fetch request.\n     */\n    post(input, body, init) {\n        return this.callFetch(input, body, init, 'POST');\n    }\n    /**\n     * Calls fetch with request method set to PUT.\n     *\n     * @param input - The resource that you wish to fetch. Either a\n     * Request object, or a string containing the URL of the resource.\n     * @param body - The body of the request.\n     * @param init - An options object containing settings to be applied to\n     * the Request.\n     * @returns A Promise for the Response from the fetch request.\n     */\n    put(input, body, init) {\n        return this.callFetch(input, body, init, 'PUT');\n    }\n    /**\n     * Calls fetch with request method set to PATCH.\n     *\n     * @param input - The resource that you wish to fetch. Either a\n     * Request object, or a string containing the URL of the resource.\n     * @param body - The body of the request.\n     * @param init - An options object containing settings to be applied to\n     * the Request.\n     * @returns A Promise for the Response from the fetch request.\n     */\n    patch(input, body, init) {\n        return this.callFetch(input, body, init, 'PATCH');\n    }\n    /**\n     * Calls fetch with request method set to DELETE.\n     *\n     * @param input - The resource that you wish to fetch. Either a\n     * Request object, or a string containing the URL of the resource.\n     * @param body - The body of the request.\n     * @param init - An options object containing settings to be applied to\n     * the Request.\n     * @returns A Promise for the Response from the fetch request.\n     */\n    delete(input, body, init) {\n        return this.callFetch(input, body, init, 'DELETE');\n    }\n    trackRequestStart() {\n        this.isRequesting = !!(++this.activeRequestCount);\n        if (this.isRequesting) {\n            const evt = DOM.createCustomEvent('aurelia-fetch-client-request-started', { bubbles: true, cancelable: true });\n            DOM.window.setTimeout(() => { DOM.dispatchEvent(evt); }, 1);\n        }\n    }\n    trackRequestEnd() {\n        this.isRequesting = !!(--this.activeRequestCount);\n        if (!this.isRequesting) {\n            const evt = DOM.createCustomEvent('aurelia-fetch-client-requests-drained', { bubbles: true, cancelable: true });\n            DOM.window.setTimeout(() => { DOM.dispatchEvent(evt); }, 1);\n        }\n    }\n    processRequest(request, interceptors) {\n        return this.applyInterceptors(request, interceptors, 'request', 'requestError', this);\n    }\n    processResponse(response, interceptors, request) {\n        return this.applyInterceptors(response, interceptors, 'response', 'responseError', request, this);\n    }\n    applyInterceptors(input, interceptors, successName, errorName, ...interceptorArgs) {\n        return (interceptors !== undefined ? interceptors : [])\n            .reduce((chain, interceptor) => {\n            const successHandler = interceptor[successName];\n            const errorHandler = interceptor[errorName];\n            // TODO: Fix this, as it violates `strictBindCallApply`.\n            return chain.then(successHandler ? (value => successHandler.call(interceptor, value, ...interceptorArgs)) : identity, errorHandler ? (reason => errorHandler.call(interceptor, reason, ...interceptorArgs)) : thrower);\n        }, Promise.resolve(input));\n    }\n    callFetch(input, body, init, method) {\n        if (!init) {\n            init = {};\n        }\n        init.method = method;\n        if (body) {\n            init.body = body;\n        }\n        return this.fetch(input, init);\n    }\n};\nHttpClient = __decorate([\n    __param(0, IDOM),\n    __metadata(\"design:paramtypes\", [HTMLDOM])\n], HttpClient);\nexport { HttpClient };\nfunction parseHeaderValues(headers) {\n    const parsedHeaders = {};\n    const $headers = headers !== undefined ? headers : {};\n    for (const name in $headers) {\n        if (Object.prototype.hasOwnProperty.call($headers, name)) {\n            parsedHeaders[name] = (typeof $headers[name] === 'function')\n                ? $headers[name]()\n                : $headers[name];\n        }\n    }\n    return parsedHeaders;\n}\nfunction getRequestUrl(baseUrl, url) {\n    if (absoluteUrlRegexp.test(url)) {\n        return url;\n    }\n    return (baseUrl !== undefined ? baseUrl : '') + url;\n}\nfunction setDefaultHeaders(headers, defaultHeaders) {\n    const $defaultHeaders = defaultHeaders !== undefined ? defaultHeaders : {};\n    for (const name in $defaultHeaders) {\n        if (Object.prototype.hasOwnProperty.call($defaultHeaders, name) && !headers.has(name)) {\n            headers.set(name, $defaultHeaders[name]);\n        }\n    }\n}\nfunction isJSON(str) {\n    try {\n        JSON.parse(str);\n    }\n    catch (err) {\n        return false;\n    }\n    return true;\n}\nfunction identity(x) {\n    return x;\n}\nfunction thrower(x) {\n    throw x;\n}\n//# sourceMappingURL=http-client.js.map","export var LogLevel;\n(function (LogLevel) {\n    /**\n     * The most detailed information about internal app state.\n     *\n     * Disabled by default and should never be enabled in a production environment.\n     */\n    LogLevel[LogLevel[\"trace\"] = 0] = \"trace\";\n    /**\n     * Information that is useful for debugging during development and has no long-term value.\n     */\n    LogLevel[LogLevel[\"debug\"] = 1] = \"debug\";\n    /**\n     * Information about the general flow of the application that has long-term value.\n     */\n    LogLevel[LogLevel[\"info\"] = 2] = \"info\";\n    /**\n     * Unexpected circumstances that require attention but do not otherwise cause the current flow of execution to stop.\n     */\n    LogLevel[LogLevel[\"warn\"] = 3] = \"warn\";\n    /**\n     * Unexpected circumstances that cause the flow of execution in the current activity to stop but do not cause an app-wide failure.\n     */\n    LogLevel[LogLevel[\"error\"] = 4] = \"error\";\n    /**\n     * Unexpected circumstances that cause an app-wide failure or otherwise require immediate attention.\n     */\n    LogLevel[LogLevel[\"fatal\"] = 5] = \"fatal\";\n    /**\n     * No messages should be written.\n     */\n    LogLevel[LogLevel[\"none\"] = 6] = \"none\";\n})(LogLevel || (LogLevel = {}));\nexport const Reporter = {\n    level: 3 /* warn */,\n    write(code, ...params) { return; },\n    error(code, ...params) { return new Error(`Code ${code}`); }\n};\nexport const Tracer = {\n    /**\n     * A convenience property for the user to conditionally call the tracer.\n     * This saves unnecessary `noop` and `slice` calls in non-AOT scenarios even if debugging is disabled.\n     * In AOT these calls will simply be removed entirely.\n     *\n     * This property **only** turns on tracing if `@aurelia/debug` is included and configured as well.\n     */\n    enabled: false,\n    liveLoggingEnabled: false,\n    liveWriter: null,\n    /**\n     * Call this at the start of a method/function.\n     * Each call to `enter` **must** have an accompanying call to `leave` for the tracer to work properly.\n     *\n     * @param objName - Any human-friendly name to identify the traced object with.\n     * @param methodName - Any human-friendly name to identify the traced method with.\n     * @param args - Pass in `Array.prototype.slice.call(arguments)` to also trace the parameters, or `null` if this is not needed (to save memory/cpu)\n     */\n    enter(objName, methodName, args) { return; },\n    /**\n     * Call this at the end of a method/function. Pops one trace item off the stack.\n     */\n    leave() { return; },\n    /**\n     * Writes only the trace info leading up to the current method call.\n     *\n     * @param writer - An object to write the output to.\n     */\n    writeStack(writer) { return; },\n    /**\n     * Writes all trace info captured since the previous flushAll operation.\n     *\n     * @param writer - An object to write the output to. Can be null to simply reset the tracer state.\n     */\n    flushAll(writer) { return; },\n    enableLiveLogging,\n    /**\n     * Stops writing out each trace info item as they are traced.\n     */\n    disableLiveLogging() { return; }\n};\nfunction enableLiveLogging(optionsOrWriter) { return; }\n//# sourceMappingURL=reporter.js.map","import { PLATFORM } from './platform';\nconst isNumericLookup = {};\n/**\n * Efficiently determine whether the provided property key is numeric\n * (and thus could be an array indexer) or not.\n *\n * Always returns true for values of type `'number'`.\n *\n * Otherwise, only returns true for strings that consist only of positive integers.\n *\n * Results are cached.\n */\nexport function isArrayIndex(value) {\n    switch (typeof value) {\n        case 'number':\n            return value >= 0 && (value | 0) === value;\n        case 'string': {\n            const result = isNumericLookup[value];\n            if (result !== void 0) {\n                return result;\n            }\n            const length = value.length;\n            if (length === 0) {\n                return isNumericLookup[value] = false;\n            }\n            let ch = 0;\n            for (let i = 0; i < length; ++i) {\n                ch = value.charCodeAt(i);\n                if (i === 0 && ch === 0x30 && length > 1 /* must not start with 0 */ || ch < 0x30 /* 0 */ || ch > 0x39 /* 9 */) {\n                    return isNumericLookup[value] = false;\n                }\n            }\n            return isNumericLookup[value] = true;\n        }\n        default:\n            return false;\n    }\n}\n/**\n * Determines if the value passed is a number or bigint for parsing purposes\n *\n * @param value - Value to evaluate\n */\nexport function isNumberOrBigInt(value) {\n    switch (typeof value) {\n        case 'number':\n        case 'bigint':\n            return true;\n        default:\n            return false;\n    }\n}\n/**\n * Determines if the value passed is a number or bigint for parsing purposes\n *\n * @param value - Value to evaluate\n */\nexport function isStringOrDate(value) {\n    switch (typeof value) {\n        case 'string':\n            return true;\n        case 'object':\n            return value instanceof Date;\n        default:\n            return false;\n    }\n}\n/**\n * Base implementation of camel and kebab cases\n */\nconst baseCase = (function () {\n    let CharKind;\n    (function (CharKind) {\n        CharKind[CharKind[\"none\"] = 0] = \"none\";\n        CharKind[CharKind[\"digit\"] = 1] = \"digit\";\n        CharKind[CharKind[\"upper\"] = 2] = \"upper\";\n        CharKind[CharKind[\"lower\"] = 3] = \"lower\";\n    })(CharKind || (CharKind = {}));\n    // eslint-disable-next-line @typescript-eslint/consistent-type-assertions\n    const isDigit = Object.assign(Object.create(null), {\n        '0': true,\n        '1': true,\n        '2': true,\n        '3': true,\n        '4': true,\n        '5': true,\n        '6': true,\n        '7': true,\n        '8': true,\n        '9': true,\n    });\n    function charToKind(char) {\n        if (char === '') {\n            // We get this if we do charAt() with an index out of range\n            return 0 /* none */;\n        }\n        if (char !== char.toUpperCase()) {\n            return 3 /* lower */;\n        }\n        if (char !== char.toLowerCase()) {\n            return 2 /* upper */;\n        }\n        if (isDigit[char] === true) {\n            return 1 /* digit */;\n        }\n        return 0 /* none */;\n    }\n    return function (input, cb) {\n        const len = input.length;\n        if (len === 0) {\n            return input;\n        }\n        let sep = false;\n        let output = '';\n        let prevKind;\n        let curChar = '';\n        let curKind = 0 /* none */;\n        let nextChar = input.charAt(0);\n        let nextKind = charToKind(nextChar);\n        for (let i = 0; i < len; ++i) {\n            prevKind = curKind;\n            curChar = nextChar;\n            curKind = nextKind;\n            nextChar = input.charAt(i + 1);\n            nextKind = charToKind(nextChar);\n            if (curKind === 0 /* none */) {\n                if (output.length > 0) {\n                    // Only set sep to true if it's not at the beginning of output.\n                    sep = true;\n                }\n            }\n            else {\n                if (!sep && output.length > 0 && curKind === 2 /* upper */) {\n                    // Separate UAFoo into UA Foo.\n                    // Separate uaFOO into ua FOO.\n                    sep = prevKind === 3 /* lower */ || nextKind === 3 /* lower */;\n                }\n                output += cb(curChar, sep);\n                sep = false;\n            }\n        }\n        return output;\n    };\n})();\n/**\n * Efficiently convert a string to camelCase.\n *\n * Non-alphanumeric characters are treated as separators.\n *\n * Primarily used by Aurelia to convert DOM attribute names to ViewModel property names.\n *\n * Results are cached.\n */\nexport const camelCase = (function () {\n    const cache = Object.create(null);\n    function callback(char, sep) {\n        return sep ? char.toUpperCase() : char.toLowerCase();\n    }\n    return function (input) {\n        let output = cache[input];\n        if (output === void 0) {\n            output = cache[input] = baseCase(input, callback);\n        }\n        return output;\n    };\n})();\n/**\n * Efficiently convert a string to PascalCase.\n *\n * Non-alphanumeric characters are treated as separators.\n *\n * Primarily used by Aurelia to convert element names to class names for synthetic types.\n *\n * Results are cached.\n */\nexport const pascalCase = (function () {\n    const cache = Object.create(null);\n    return function (input) {\n        let output = cache[input];\n        if (output === void 0) {\n            output = camelCase(input);\n            if (output.length > 0) {\n                output = output[0].toUpperCase() + output.slice(1);\n            }\n            cache[input] = output;\n        }\n        return output;\n    };\n})();\n/**\n * Efficiently convert a string to kebab-case.\n *\n * Non-alphanumeric characters are treated as separators.\n *\n * Primarily used by Aurelia to convert ViewModel property names to DOM attribute names.\n *\n * Results are cached.\n */\nexport const kebabCase = (function () {\n    const cache = Object.create(null);\n    function callback(char, sep) {\n        return sep ? `-${char.toLowerCase()}` : char.toLowerCase();\n    }\n    return function (input) {\n        let output = cache[input];\n        if (output === void 0) {\n            output = cache[input] = baseCase(input, callback);\n        }\n        return output;\n    };\n})();\n/**\n * Efficiently (up to 10x faster than `Array.from`) convert an `ArrayLike` to a real array.\n *\n * Primarily used by Aurelia to convert DOM node lists to arrays.\n */\nexport function toArray(input) {\n    // benchmark: http://jsben.ch/xjsyF\n    const { length } = input;\n    const arr = Array(length);\n    for (let i = 0; i < length; ++i) {\n        arr[i] = input[i];\n    }\n    return arr;\n}\nconst ids = {};\n/**\n * Retrieve the next ID in a sequence for a given string, starting with `1`.\n *\n * Used by Aurelia to assign unique ID's to controllers and resources.\n *\n * Aurelia will always prepend the context name with `au$`, so as long as you avoid\n * using that convention you should be safe from collisions.\n */\nexport function nextId(context) {\n    if (ids[context] === void 0) {\n        ids[context] = 0;\n    }\n    return ++ids[context];\n}\n/**\n * Reset the ID for the given string, so that `nextId` will return `1` again for the next call.\n *\n * Used by Aurelia to reset ID's in between unit tests.\n */\nexport function resetId(context) {\n    ids[context] = 0;\n}\n/**\n * A compare function to pass to `Array.prototype.sort` for sorting numbers.\n * This is needed for numeric sort, since the default sorts them as strings.\n */\nexport function compareNumber(a, b) {\n    return a - b;\n}\nconst emptyArray = PLATFORM.emptyArray;\n/**\n * Efficiently merge and deduplicate the (primitive) values in two arrays.\n *\n * Does not deduplicate existing values in the first array.\n *\n * Guards against null or undefined arrays.\n *\n * Returns `PLATFORM.emptyArray` if both arrays are either `null`, `undefined` or `PLATFORM.emptyArray`\n *\n * @param slice - If `true`, always returns a new array copy (unless neither array is/has a value)\n */\nexport function mergeDistinct(arr1, arr2, slice) {\n    if (arr1 === void 0 || arr1 === null || arr1 === emptyArray) {\n        if (arr2 === void 0 || arr2 === null || arr2 === emptyArray) {\n            return emptyArray;\n        }\n        else {\n            return slice ? arr2.slice(0) : arr2;\n        }\n    }\n    else if (arr2 === void 0 || arr2 === null || arr2 === emptyArray) {\n        return slice ? arr1.slice(0) : arr1;\n    }\n    const lookup = {};\n    const arr3 = slice ? arr1.slice(0) : arr1;\n    let len1 = arr1.length;\n    let len2 = arr2.length;\n    while (len1-- > 0) {\n        lookup[arr1[len1]] = true;\n    }\n    let item;\n    while (len2-- > 0) {\n        item = arr2[len2];\n        // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n        if (lookup[item] === void 0) {\n            arr3.push(item);\n            lookup[item] = true;\n        }\n    }\n    return arr3;\n}\n/**\n * Decorator. (lazily) bind the method to the class instance on first call.\n */\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport function bound(target, key, descriptor) {\n    return {\n        configurable: true,\n        enumerable: descriptor.enumerable,\n        get() {\n            // eslint-disable-next-line @typescript-eslint/no-unnecessary-type-assertion\n            const boundFn = descriptor.value.bind(this);\n            Reflect.defineProperty(this, key, {\n                value: boundFn,\n                writable: true,\n                configurable: true,\n                enumerable: descriptor.enumerable,\n            });\n            return boundFn;\n        },\n    };\n}\nexport function mergeArrays(...arrays) {\n    const result = [];\n    let k = 0;\n    const arraysLen = arrays.length;\n    let arrayLen = 0;\n    let array;\n    for (let i = 0; i < arraysLen; ++i) {\n        array = arrays[i];\n        if (array !== void 0) {\n            arrayLen = array.length;\n            for (let j = 0; j < arrayLen; ++j) {\n                result[k++] = array[j];\n            }\n        }\n    }\n    return result;\n}\nexport function mergeObjects(...objects) {\n    const result = {};\n    const objectsLen = objects.length;\n    let object;\n    let key;\n    for (let i = 0; i < objectsLen; ++i) {\n        object = objects[i];\n        if (object !== void 0) {\n            for (key in object) {\n                result[key] = object[key];\n            }\n        }\n    }\n    return result;\n}\nexport function firstDefined(...values) {\n    const len = values.length;\n    let value;\n    for (let i = 0; i < len; ++i) {\n        value = values[i];\n        if (value !== void 0) {\n            return value;\n        }\n    }\n    throw new Error(`No default value found`);\n}\nexport const getPrototypeChain = (function () {\n    const functionPrototype = Function.prototype;\n    // eslint-disable-next-line @typescript-eslint/unbound-method\n    const getPrototypeOf = Object.getPrototypeOf;\n    const cache = new WeakMap();\n    let proto = functionPrototype;\n    let i = 0;\n    let chain = void 0;\n    return function (Type) {\n        chain = cache.get(Type);\n        if (chain === void 0) {\n            cache.set(Type, chain = [proto = Type]);\n            i = 0;\n            while ((proto = getPrototypeOf(proto)) !== functionPrototype) {\n                chain[++i] = proto;\n            }\n        }\n        return chain;\n    };\n})();\nexport function toLookup(...objs) {\n    return Object.assign(Object.create(null), ...objs);\n}\n/**\n * Determine whether a value is an object.\n *\n * Uses `typeof` to guarantee this works cross-realm, which is where `instanceof Object` might fail.\n *\n * Some environments where these issues are known to arise:\n * - same-origin iframes (accessing the other realm via `window.top`)\n * - `jest`.\n *\n * The exact test is:\n * ```ts\n * typeof value === 'object' && value !== null || typeof value === 'function'\n * ```\n *\n * @param value - The value to test.\n * @returns `true` if the value is an object, otherwise `false`.\n * Also performs a type assertion that defaults to `value is Object | Function` which, if the input type is a union with an object type, will infer the correct type.\n * This can be overridden with the generic type argument.\n *\n * @example\n *\n * ```ts\n * class Foo {\n *   bar = 42;\n * }\n *\n * function doStuff(input?: Foo | null) {\n *   input.bar; // Object is possibly 'null' or 'undefined'\n *\n *   // input has an object type in its union (Foo) so that type will be extracted for the 'true' condition\n *   if (isObject(input)) {\n *     input.bar; // OK (input is now typed as Foo)\n *   }\n * }\n *\n * function doOtherStuff(input: unknown) {\n *   input.bar; // Object is of type 'unknown'\n *\n *   // input is 'unknown' so there is no union type to match and it will default to 'Object | Function'\n *   if (isObject(input)) {\n *     input.bar; // Property 'bar' does not exist on type 'Object | Function'\n *   }\n *\n *   // if we know for sure that, if input is an object, it must be a specific type, we can explicitly tell the function to assert that for us\n *   if (isObject<Foo>(input)) {\n *    input.bar; // OK (input is now typed as Foo)\n *   }\n * }\n * ```\n */\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport function isObject(value) {\n    return typeof value === 'object' && value !== null || typeof value === 'function';\n}\n/**\n * Determine whether a value is `null` or `undefined`.\n *\n * @param value - The value to test.\n * @returns `true` if the value is `null` or `undefined`, otherwise `false`.\n * Also performs a type assertion that ensures TypeScript treats the value appropriately in the `if` and `else` branches after this check.\n */\nexport function isNullOrUndefined(value) {\n    return value === null || value === void 0;\n}\n/**\n * Determine whether the value is a native function.\n *\n * @param fn - The function to check.\n * @returns `true` is the function is a native function, otherwise `false`\n */\nexport const isNativeFunction = (function () {\n    // eslint-disable-next-line @typescript-eslint/ban-types\n    const lookup = new WeakMap();\n    let isNative = false;\n    let sourceText = '';\n    let i = 0;\n    // eslint-disable-next-line @typescript-eslint/ban-types\n    return function (fn) {\n        isNative = lookup.get(fn);\n        if (isNative === void 0) {\n            sourceText = fn.toString();\n            i = sourceText.length;\n            // http://www.ecma-international.org/ecma-262/#prod-NativeFunction\n            isNative = (\n            // 29 is the length of 'function () { [native code] }' which is the smallest length of a native function string\n            i >= 29 &&\n                // 100 seems to be a safe upper bound of the max length of a native function. In Chrome and FF it's 56, in Edge it's 61.\n                i <= 100 &&\n                // This whole heuristic *could* be tricked by a comment. Do we need to care about that?\n                sourceText.charCodeAt(i - 1) === 0x7D && // }\n                // TODO: the spec is a little vague about the precise constraints, so we do need to test this across various browsers to make sure just one whitespace is a safe assumption.\n                sourceText.charCodeAt(i - 2) <= 0x20 && // whitespace\n                sourceText.charCodeAt(i - 3) === 0x5D && // ]\n                sourceText.charCodeAt(i - 4) === 0x65 && // e\n                sourceText.charCodeAt(i - 5) === 0x64 && // d\n                sourceText.charCodeAt(i - 6) === 0x6F && // o\n                sourceText.charCodeAt(i - 7) === 0x63 && // c\n                sourceText.charCodeAt(i - 8) === 0x20 && //\n                sourceText.charCodeAt(i - 9) === 0x65 && // e\n                sourceText.charCodeAt(i - 10) === 0x76 && // v\n                sourceText.charCodeAt(i - 11) === 0x69 && // i\n                sourceText.charCodeAt(i - 12) === 0x74 && // t\n                sourceText.charCodeAt(i - 13) === 0x61 && // a\n                sourceText.charCodeAt(i - 14) === 0x6E && // n\n                sourceText.charCodeAt(i - 15) === 0x58 // [\n            );\n            lookup.set(fn, isNative);\n        }\n        return isNative;\n    };\n})();\n//# sourceMappingURL=functions.js.map","import { isObject, isNullOrUndefined } from './functions';\n/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable @typescript-eslint/ban-types */\nconst metadataInternalSlot = new WeakMap();\nfunction $typeError(operation, args, paramName, actualValue, expectedType) {\n    return new TypeError(`${operation}(${args.map(String).join(',')}) - Expected '${paramName}' to be of type ${expectedType}, but got: ${Object.prototype.toString.call(actualValue)} (${String(actualValue)})`);\n}\nfunction toPropertyKeyOrUndefined(propertyKey) {\n    switch (typeof propertyKey) {\n        case 'undefined':\n        case 'string':\n        case 'symbol':\n            return propertyKey;\n        default:\n            return `${propertyKey}`;\n    }\n}\nfunction toPropertyKey(propertyKey) {\n    switch (typeof propertyKey) {\n        case 'string':\n        case 'symbol':\n            return propertyKey;\n        default:\n            return `${propertyKey}`;\n    }\n}\nfunction ensurePropertyKeyOrUndefined(propertyKey) {\n    switch (typeof propertyKey) {\n        case 'undefined':\n        case 'string':\n        case 'symbol':\n            return propertyKey;\n        default:\n            throw new TypeError(`Invalid metadata propertyKey: ${propertyKey}.`);\n    }\n}\nfunction GetOrCreateMetadataMap(O, P, Create) {\n    // 1. Assert: P is undefined or IsPropertyKey(P) is true.\n    // 2. Let targetMetadata be the value of O's [[Metadata]] internal slot.\n    let targetMetadata = metadataInternalSlot.get(O);\n    // 3. If targetMetadata is undefined, then\n    if (targetMetadata === void 0) {\n        // 3. a. If Create is false, return undefined.\n        if (!Create) {\n            return void 0;\n        }\n        // 3. b. Set targetMetadata to be a newly created Map object.\n        targetMetadata = new Map();\n        // 3. c. Set the [[Metadata]] internal slot of O to targetMetadata.\n        metadataInternalSlot.set(O, targetMetadata);\n    }\n    // 4. Let metadataMap be ? Invoke(targetMetadata, \"get\", P).\n    let metadataMap = targetMetadata.get(P);\n    // 5. If metadataMap is undefined, then\n    if (metadataMap === void 0) {\n        // 5. a. If Create is false, return undefined.\n        if (!Create) {\n            return void 0;\n        }\n        // 5. b. Set metadataMap to be a newly created Map object.\n        metadataMap = new Map();\n        // 5. c. Perform ? Invoke(targetMetadata, \"set\", P, metadataMap).\n        targetMetadata.set(P, metadataMap);\n    }\n    // 6. Return metadataMap.\n    return metadataMap;\n}\n// 3.1.2.1 OrdinaryHasOwnMetadata(MetadataKey, O, P)\n// https://rbuckton.github.io/reflect-metadata/#ordinaryhasownmetadata\nfunction OrdinaryHasOwnMetadata(MetadataKey, O, P) {\n    // 1. Assert: P is undefined or IsPropertyKey(P) is true.\n    // 2. Let metadataMap be ? GetOrCreateMetadataMap(O, P, false).\n    const metadataMap = GetOrCreateMetadataMap(O, P, /* Create */ false);\n    // 3. If metadataMap is undefined, return false.\n    if (metadataMap === void 0) {\n        return false;\n    }\n    // 4. Return ? ToBoolean(? Invoke(metadataMap, \"has\", MetadataKey)).\n    return metadataMap.has(MetadataKey);\n}\n// 3.1.1.1 OrdinaryHasMetadata(MetadataKey, O, P)\n// https://rbuckton.github.io/reflect-metadata/#ordinaryhasmetadata\nfunction OrdinaryHasMetadata(MetadataKey, O, P) {\n    // 1. Assert: P is undefined or IsPropertyKey(P) is true.\n    // 2. Let hasOwn be ? OrdinaryHasOwnMetadata(MetadataKey, O, P).\n    // 3. If hasOwn is true, return true.\n    if (OrdinaryHasOwnMetadata(MetadataKey, O, P)) {\n        return true;\n    }\n    // 4. Let parent be ? O.[[GetPrototypeOf]]().\n    const parent = Object.getPrototypeOf(O);\n    // 5. If parent is not null, Return ? parent.[[HasMetadata]](MetadataKey, P).\n    if (parent !== null) {\n        return OrdinaryHasMetadata(MetadataKey, parent, P);\n    }\n    // 6. Return false.\n    return false;\n}\n// 3.1.4.1 OrdinaryGetOwnMetadata(MetadataKey, O, P)\n// https://rbuckton.github.io/reflect-metadata/#ordinarygetownmetadata\nfunction OrdinaryGetOwnMetadata(MetadataKey, O, P) {\n    // 1. Assert: P is undefined or IsPropertyKey(P) is true.\n    // 2. Let metadataMap be ? GetOrCreateMetadataMap(O, P, false).\n    const metadataMap = GetOrCreateMetadataMap(O, P, /* Create */ false);\n    // 3. If metadataMap is undefined, return undefined.\n    if (metadataMap === void 0) {\n        return void 0;\n    }\n    // 4. Return ? Invoke(metadataMap, \"get\", MetadataKey).\n    return metadataMap.get(MetadataKey);\n}\n// 3.1.3.1 OrdinaryGetMetadata(MetadataKey, O, P)\n// https://rbuckton.github.io/reflect-metadata/#ordinarygetmetadata\nfunction OrdinaryGetMetadata(MetadataKey, O, P) {\n    // 1. Assert: P is undefined or IsPropertyKey(P) is true.\n    // 2. Let hasOwn be ? OrdinaryHasOwnMetadata(MetadataKey, O, P).\n    // 3. If hasOwn is true, return ? OrdinaryGetOwnMetadata(MetadataKey, O, P).\n    if (OrdinaryHasOwnMetadata(MetadataKey, O, P)) {\n        return OrdinaryGetOwnMetadata(MetadataKey, O, P);\n    }\n    // 4. Let parent be ? O.[[GetPrototypeOf]]().\n    const parent = Object.getPrototypeOf(O);\n    // 5. If parent is not null, return ? parent.[[GetMetadata]](MetadataKey, P).\n    if (parent !== null) {\n        return OrdinaryGetMetadata(MetadataKey, parent, P);\n    }\n    // 6. Return undefined.\n    return void 0;\n}\n// 3.1.5.1 OrdinaryDefineOwnMetadata(MetadataKey, MetadataValue, O, P)\n// https://rbuckton.github.io/reflect-metadata/#ordinarydefineownmetadata\nfunction OrdinaryDefineOwnMetadata(MetadataKey, MetadataValue, O, P) {\n    // 1. Assert: P is undefined or IsPropertyKey(P) is true.\n    // 2. Let metadataMap be ? GetOrCreateMetadataMap(O, P, true).\n    const metadataMap = GetOrCreateMetadataMap(O, P, /* Create */ true);\n    // 3. Return ? Invoke(metadataMap, \"set\", MetadataKey, MetadataValue).\n    metadataMap.set(MetadataKey, MetadataValue);\n}\n// 3.1.7.1 OrdinaryOwnMetadataKeys(O, P)\n// https://rbuckton.github.io/reflect-metadata/#ordinaryownmetadatakeys\nfunction OrdinaryOwnMetadataKeys(O, P) {\n    // 1. Assert: P is undefined or IsPropertyKey(P) is true.\n    // 2. Let keys be ? ArrayCreate(0).\n    const keys = [];\n    // 3. Let metadataMap be ? GetOrCreateMetadataMap(O, P, false).\n    const metadataMap = GetOrCreateMetadataMap(O, P, /* Create */ false);\n    // 4. If metadataMap is undefined, return keys.\n    if (metadataMap === void 0) {\n        return keys;\n    }\n    // 5. Let keysObj be ? Invoke(metadataMap, \"keys\").\n    const keysObj = metadataMap.keys();\n    // 6. Let iterator be ? GetIterator(keysObj).\n    // 7. Let k be 0.\n    let k = 0;\n    // 8. Repeat\n    for (const key of keysObj) {\n        // 8. a. Let Pk be ! ToString(k).\n        // 8. b. Let next be ? IteratorStep(iterator).\n        // 8. c. If next is false, then\n        // 8. c. i. Let setStatus be ? Set(keys, \"length\", k, true).\n        // 8. c. ii. Assert: setStatus is true.\n        // 8. c. iii. Return keys.\n        // 8. d. Let nextValue be ? IteratorValue(next).\n        // 8. e. Let defineStatus be CreateDataPropertyOrThrow(keys, Pk, nextValue).\n        keys[k] = key;\n        // 8. f. If defineStatus is an abrupt completion, return ? IteratorClose(iterator, defineStatus).\n        // 8. g. Increase k by 1.\n        ++k;\n    }\n    return keys;\n}\n// 3.1.6.1 OrdinaryMetadataKeys(O, P)\n// https://rbuckton.github.io/reflect-metadata/#ordinarymetadatakeys\nfunction OrdinaryMetadataKeys(O, P) {\n    // 1. Assert: P is undefined or IsPropertyKey(P) is true.\n    // 2. Let ownKeys be ? OrdinaryOwnMetadataKeys(O, P).\n    const ownKeys = OrdinaryOwnMetadataKeys(O, P);\n    // 3. Let parent be ? O.[[GetPrototypeOf]]().\n    const parent = Object.getPrototypeOf(O);\n    // 4. If parent is null, then return ownKeys.\n    if (parent === null) {\n        return ownKeys;\n    }\n    // 5. Let parentKeys be ? O.[[OrdinaryMetadataKeys]](P).\n    const parentKeys = OrdinaryMetadataKeys(parent, P);\n    // 6. Let ownKeysLen = ? Get(ownKeys, \"length\").\n    const ownKeysLen = ownKeys.length;\n    // 7. If ownKeysLen is 0, return parentKeys.\n    if (ownKeysLen === 0) {\n        return parentKeys;\n    }\n    // 8. Let parentKeysLen = ? Get(parentKeys, \"length\").\n    const parentKeysLen = parentKeys.length;\n    // 9. If parentKeysLen is 0, return ownKeys.\n    if (parentKeysLen === 0) {\n        return ownKeys;\n    }\n    // 10. Let set be a newly created Set object.\n    const set = new Set();\n    // 11. Let keys be ? ArrayCreate(0).\n    const keys = [];\n    // 12. Let k be 0.\n    let k = 0;\n    // 13. For each element key of ownKeys\n    let key;\n    for (let i = 0; i < ownKeysLen; ++i) {\n        key = ownKeys[i];\n        // 13. a. Let hasKey be ? Invoke(set, \"has\", key).\n        // 13. b. If hasKey is false, then\n        if (!set.has(key)) {\n            // 13. b. i. Let Pk be ! ToString(k).\n            // 13. b. ii. Perform ? Invoke(set, \"add\", key).\n            set.add(key);\n            // 13. b. iii. Let defineStatus be CreateDataProperty(keys, Pk, key).\n            // 13. b. iv. Assert: defineStatus is true.\n            keys[k] = key;\n            // 13. b. v. Increase k by 1.\n            ++k;\n        }\n    }\n    // 14. For each element key of parentKeys\n    for (let i = 0; i < parentKeysLen; ++i) {\n        key = parentKeys[i];\n        // 14. a. Let hasKey be ? Invoke(set, \"has\", key).\n        // 14. b. If hasKey is false, then\n        if (!set.has(key)) {\n            // 14. b. i. Let Pk be ! ToString(k).\n            // 14. b. ii. Perform ? Invoke(set, \"add\", key).\n            set.add(key);\n            // 14. b. iii. Let defineStatus be CreateDataProperty(keys, Pk, key).\n            // 14. b. iv. Assert: defineStatus is true.\n            keys[k] = key;\n            // 14. b. v. Increase k by 1.\n            ++k;\n        }\n    }\n    // 15. Perform ? Set(keys, \"length\", k).\n    // 16. return keys.\n    return keys;\n}\n// 3.1.8 DeleteMetadata(MetadataKey, P)\n// https://rbuckton.github.io/reflect-metadata/#ordinary-object-internal-methods-and-internal-slots-deletemetadata\nfunction OrdinaryDeleteMetadata(O, MetadataKey, P) {\n    // 1. Assert: P is undefined or IsPropertyKey(P) is true.\n    // 2. Let metadataMap be ? GetOrCreateMetadataMap(O, P, false).\n    const metadataMap = GetOrCreateMetadataMap(O, P, false);\n    // 3. If metadataMap is undefined, return false.\n    if (metadataMap === void 0) {\n        return false;\n    }\n    // 4. Return ? Invoke(metadataMap, \"delete\", MetadataKey).\n    return metadataMap.delete(MetadataKey);\n}\n// 4.1.2 Reflect.metadata(metadataKey, metadataValue)\n// https://rbuckton.github.io/reflect-metadata/#reflect.metadata\n/**\n * A default metadata decorator factory that can be used on a class, class member, or parameter.\n *\n * @param metadataKey - The key for the metadata entry.\n * If `metadataKey` is already defined for the target and target key, the\n * metadataValue for that key will be overwritten.\n * @param metadataValue - The value for the metadata entry.\n * @returns A decorator function.\n */\nfunction metadata(metadataKey, metadataValue) {\n    function decorator(target, propertyKey) {\n        // 1. Assert: F has a [[MetadataKey]] internal slot whose value is an ECMAScript language value, or undefined.\n        // 2. Assert: F has a [[MetadataValue]] internal slot whose value is an ECMAScript language value, or undefined.\n        // 3. If Type(target) is not Object, throw a TypeError exception.\n        if (!isObject(target)) {\n            throw $typeError('@metadata', [metadataKey, metadataValue, target, propertyKey], 'target', target, 'Object or Function');\n        }\n        // 4. If key is not undefined and IsPropertyKey(key) is false, throw a TypeError exception.\n        // 5. Let metadataKey be the value of F's [[MetadataKey]] internal slot.\n        // 6. Let metadataValue be the value of F's [[MetadataValue]] internal slot.\n        // 7. Perform ? target.[[DefineMetadata]](metadataKey, metadataValue, target, key).\n        OrdinaryDefineOwnMetadata(metadataKey, metadataValue, target, ensurePropertyKeyOrUndefined(propertyKey));\n        // 8. Return undefined.\n    }\n    return decorator;\n}\nfunction decorate(decorators, target, propertyKey, attributes) {\n    if (propertyKey !== void 0) {\n        if (!Array.isArray(decorators)) {\n            throw $typeError('Metadata.decorate', [decorators, target, propertyKey, attributes], 'decorators', decorators, 'Array');\n        }\n        if (!isObject(target)) {\n            throw $typeError('Metadata.decorate', [decorators, target, propertyKey, attributes], 'target', target, 'Object or Function');\n        }\n        if (!isObject(attributes) && !isNullOrUndefined(attributes)) {\n            throw $typeError('Metadata.decorate', [decorators, target, propertyKey, attributes], 'attributes', attributes, 'Object, Function, null, or undefined');\n        }\n        if (attributes === null) {\n            attributes = void 0;\n        }\n        propertyKey = toPropertyKey(propertyKey);\n        return DecorateProperty(decorators, target, propertyKey, attributes);\n    }\n    else {\n        if (!Array.isArray(decorators)) {\n            throw $typeError('Metadata.decorate', [decorators, target, propertyKey, attributes], 'decorators', decorators, 'Array');\n        }\n        if (typeof target !== 'function') {\n            throw $typeError('Metadata.decorate', [decorators, target, propertyKey, attributes], 'target', target, 'Function');\n        }\n        return DecorateConstructor(decorators, target);\n    }\n}\nfunction DecorateConstructor(decorators, target) {\n    for (let i = decorators.length - 1; i >= 0; --i) {\n        const decorator = decorators[i];\n        const decorated = decorator(target);\n        if (!isNullOrUndefined(decorated)) {\n            if (typeof decorated !== 'function') {\n                throw $typeError('DecorateConstructor', [decorators, target], 'decorated', decorated, 'Function, null, or undefined');\n            }\n            target = decorated;\n        }\n    }\n    return target;\n}\nfunction DecorateProperty(decorators, target, propertyKey, descriptor) {\n    for (let i = decorators.length - 1; i >= 0; --i) {\n        const decorator = decorators[i];\n        const decorated = decorator(target, propertyKey, descriptor);\n        if (!isNullOrUndefined(decorated)) {\n            if (!isObject(decorated)) {\n                throw $typeError('DecorateProperty', [decorators, target, propertyKey, descriptor], 'decorated', decorated, 'Object, Function, null, or undefined');\n            }\n            descriptor = decorated;\n        }\n    }\n    return descriptor;\n}\nfunction $define(metadataKey, metadataValue, target, propertyKey) {\n    // 1. If Type(target) is not Object, throw a TypeError exception.\n    if (!isObject(target)) {\n        throw $typeError('Metadata.define', [metadataKey, metadataValue, target, propertyKey], 'target', target, 'Object or Function');\n    }\n    // 2. Return ? target.[[DefineMetadata]](metadataKey, metadataValue, propertyKey).\n    return OrdinaryDefineOwnMetadata(metadataKey, metadataValue, target, toPropertyKeyOrUndefined(propertyKey));\n}\nfunction $has(metadataKey, target, propertyKey) {\n    // 1. If Type(target) is not Object, throw a TypeError exception.\n    if (!isObject(target)) {\n        throw $typeError('Metadata.has', [metadataKey, target, propertyKey], 'target', target, 'Object or Function');\n    }\n    // 2. Return ? target.[[HasMetadata]](metadataKey, propertyKey).\n    return OrdinaryHasMetadata(metadataKey, target, toPropertyKeyOrUndefined(propertyKey));\n}\nfunction $hasOwn(metadataKey, target, propertyKey) {\n    // 1. If Type(target) is not Object, throw a TypeError exception.\n    if (!isObject(target)) {\n        throw $typeError('Metadata.hasOwn', [metadataKey, target, propertyKey], 'target', target, 'Object or Function');\n    }\n    // 2. Return ? target.[[HasOwn]](metadataKey, propertyKey).\n    return OrdinaryHasOwnMetadata(metadataKey, target, toPropertyKeyOrUndefined(propertyKey));\n}\nfunction $get(metadataKey, target, propertyKey) {\n    // 1. If Type(target) is not Object, throw a TypeError exception.\n    if (!isObject(target)) {\n        throw $typeError('Metadata.get', [metadataKey, target, propertyKey], 'target', target, 'Object or Function');\n    }\n    // 2. Return ? target.[[GetMetadata]](metadataKey, propertyKey).\n    return OrdinaryGetMetadata(metadataKey, target, toPropertyKeyOrUndefined(propertyKey));\n}\nfunction $getOwn(metadataKey, target, propertyKey) {\n    // 1. If Type(target) is not Object, throw a TypeError exception.\n    if (!isObject(target)) {\n        throw $typeError('Metadata.getOwn', [metadataKey, target, propertyKey], 'target', target, 'Object or Function');\n    }\n    // 2. Return ? target.[[GetOwnMetadata]](metadataKey, propertyKey).\n    return OrdinaryGetOwnMetadata(metadataKey, target, toPropertyKeyOrUndefined(propertyKey));\n}\nfunction $getKeys(target, propertyKey) {\n    // 1. If Type(target) is not Object, throw a TypeError exception.\n    if (!isObject(target)) {\n        throw $typeError('Metadata.getKeys', [target, propertyKey], 'target', target, 'Object or Function');\n    }\n    // 2. Return ? target.[[GetMetadataKeys]](propertyKey).\n    return OrdinaryMetadataKeys(target, toPropertyKeyOrUndefined(propertyKey));\n}\nfunction $getOwnKeys(target, propertyKey) {\n    // 1. If Type(target) is not Object, throw a TypeError exception.\n    if (!isObject(target)) {\n        throw $typeError('Metadata.getOwnKeys', [target, propertyKey], 'target', target, 'Object or Function');\n    }\n    // 2. Return ? target.[[GetOwnMetadataKeys]](propertyKey).\n    return OrdinaryOwnMetadataKeys(target, toPropertyKeyOrUndefined(propertyKey));\n}\nfunction $delete(metadataKey, target, propertyKey) {\n    // 1. If Type(target) is not Object, throw a TypeError exception.\n    if (!isObject(target)) {\n        throw $typeError('Metadata.delete', [metadataKey, target, propertyKey], 'target', target, 'Object or Function');\n    }\n    // 2. Return ? target.[[DeleteMetadata]](metadataKey, propertyKey).\n    return OrdinaryDeleteMetadata(target, metadataKey, toPropertyKeyOrUndefined(propertyKey));\n}\nconst Metadata = {\n    define: $define,\n    has: $has,\n    hasOwn: $hasOwn,\n    get: $get,\n    getOwn: $getOwn,\n    getKeys: $getKeys,\n    getOwnKeys: $getOwnKeys,\n    delete: $delete,\n};\nfunction def(obj, key, value) {\n    Reflect.defineProperty(obj, key, {\n        writable: true,\n        enumerable: false,\n        configurable: true,\n        value,\n    });\n}\ndef(Metadata, '$Internal', metadataInternalSlot);\nconst hasMetadata = 'metadata' in Reflect;\nconst hasDecorate = 'decorate' in Reflect;\nconst hasDefineMetadata = 'defineMetadata' in Reflect;\nconst hasHasMetadata = 'hasMetadata' in Reflect;\nconst hasHasOwnMetadata = 'hasOwnMetadata' in Reflect;\nconst hasGetMetadata = 'getMetadata' in Reflect;\nconst hasGetOwnMetadata = 'getOwnMetadata' in Reflect;\nconst hasGetMetadataKeys = 'getMetadataKeys' in Reflect;\nconst hasGetOwnMetadataKeys = 'getOwnMetadataKeys' in Reflect;\nconst hasDeleteMetadata = 'deleteMetadata' in Reflect;\nconst hasSome = (hasMetadata ||\n    hasDecorate ||\n    hasDefineMetadata ||\n    hasHasMetadata ||\n    hasHasOwnMetadata ||\n    hasGetMetadata ||\n    hasGetOwnMetadata ||\n    hasGetMetadataKeys ||\n    hasGetOwnMetadataKeys ||\n    hasDeleteMetadata);\nconst hasAll = (hasMetadata &&\n    hasDecorate &&\n    hasDefineMetadata &&\n    hasHasMetadata &&\n    hasHasOwnMetadata &&\n    hasGetMetadata &&\n    hasGetOwnMetadata &&\n    hasGetMetadataKeys &&\n    hasGetOwnMetadataKeys &&\n    hasDeleteMetadata);\nif (hasSome && !hasAll) {\n    // This is temporary until we have the reporter / logging component working properly.\n    // We should kind of throw here, but it's a bit harsh to completely stop Aurelia from loading for something that's not guaranteed to fail,\n    // so just log a warning instead.\n    /* eslint-disable no-console, no-undef, @typescript-eslint/ban-ts-ignore */\n    // @ts-ignore\n    console.warn('Partial existing Reflect.metadata polyfill found. Working environment cannot be guaranteed. Please file an issue at https://github.com/aurelia/aurelia/issues so that we can look into compatibility options for this scenario.');\n}\nif (!hasMetadata) {\n    def(Reflect, 'metadata', metadata);\n}\nif (!hasDecorate) {\n    def(Reflect, 'decorate', decorate);\n}\nif (!hasDefineMetadata) {\n    def(Reflect, 'defineMetadata', $define);\n}\nif (!hasHasMetadata) {\n    def(Reflect, 'hasMetadata', $has);\n}\nif (!hasHasOwnMetadata) {\n    def(Reflect, 'hasOwnMetadata', $hasOwn);\n}\nif (!hasGetMetadata) {\n    def(Reflect, 'getMetadata', $get);\n}\nif (!hasGetOwnMetadata) {\n    def(Reflect, 'getOwnMetadata', $getOwn);\n}\nif (!hasGetMetadataKeys) {\n    def(Reflect, 'getMetadataKeys', $getKeys);\n}\nif (!hasGetOwnMetadataKeys) {\n    def(Reflect, 'getOwnMetadataKeys', $getOwnKeys);\n}\nif (!hasDeleteMetadata) {\n    def(Reflect, 'deleteMetadata', $delete);\n}\nexport { Metadata, metadata };\n//# sourceMappingURL=metadata.js.map","import { Metadata } from './metadata';\nimport { PLATFORM } from './platform';\nconst annotation = {\n    name: 'au:annotation',\n    appendTo(target, key) {\n        const keys = Metadata.getOwn(annotation.name, target);\n        if (keys === void 0) {\n            Metadata.define(annotation.name, [key], target);\n        }\n        else {\n            keys.push(key);\n        }\n    },\n    set(target, prop, value) {\n        Metadata.define(annotation.keyFor(prop), value, target);\n    },\n    get(target, prop) {\n        return Metadata.getOwn(annotation.keyFor(prop), target);\n    },\n    getKeys(target) {\n        let keys = Metadata.getOwn(annotation.name, target);\n        if (keys === void 0) {\n            Metadata.define(annotation.name, keys = [], target);\n        }\n        return keys;\n    },\n    isKey(key) {\n        return key.startsWith(annotation.name);\n    },\n    keyFor(name, context) {\n        if (context === void 0) {\n            return `${annotation.name}:${name}`;\n        }\n        return `${annotation.name}:${name}:${context}`;\n    },\n};\nconst resource = {\n    name: 'au:resource',\n    appendTo(target, key) {\n        const keys = Metadata.getOwn(resource.name, target);\n        if (keys === void 0) {\n            Metadata.define(resource.name, [key], target);\n        }\n        else {\n            keys.push(key);\n        }\n    },\n    has(target) {\n        return Metadata.hasOwn(resource.name, target);\n    },\n    getAll(target) {\n        const keys = Metadata.getOwn(resource.name, target);\n        if (keys === void 0) {\n            return PLATFORM.emptyArray;\n        }\n        else {\n            return keys.map(k => Metadata.getOwn(k, target));\n        }\n    },\n    getKeys(target) {\n        let keys = Metadata.getOwn(resource.name, target);\n        if (keys === void 0) {\n            Metadata.define(resource.name, keys = [], target);\n        }\n        return keys;\n    },\n    isKey(key) {\n        return key.startsWith(resource.name);\n    },\n    keyFor(name, context) {\n        if (context === void 0) {\n            return `${resource.name}:${name}`;\n        }\n        return `${resource.name}:${name}:${context}`;\n    },\n};\nexport const Protocol = {\n    annotation,\n    resource,\n};\n// eslint-disable-next-line @typescript-eslint/unbound-method\nconst hasOwn = Object.prototype.hasOwnProperty;\n/**\n * The order in which the values are checked:\n * 1. Annotations (usually set by decorators) have the highest priority; they override the definition as well as static properties on the type.\n * 2. Definition properties (usually set by the customElement decorator object literal) come next. They override static properties on the type.\n * 3. Static properties on the type come last. Note that this does not look up the prototype chain (bindables are an exception here, but we do that differently anyway)\n * 4. The default property that is provided last. The function is only called if the default property is needed\n */\nexport function fromAnnotationOrDefinitionOrTypeOrDefault(name, def, Type, getDefault) {\n    let value = Metadata.getOwn(Protocol.annotation.keyFor(name), Type);\n    if (value === void 0) {\n        value = def[name];\n        if (value === void 0) {\n            value = Type[name];\n            // eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n            if (value === void 0 || !hasOwn.call(Type, name)) { // First just check the value (common case is faster), but do make sure it doesn't come from the proto chain\n                return getDefault();\n            }\n            return value;\n        }\n        return value;\n    }\n    return value;\n}\n/**\n * The order in which the values are checked:\n * 1. Annotations (usually set by decorators) have the highest priority; they override static properties on the type.\n * 2. Static properties on the typ. Note that this does not look up the prototype chain (bindables are an exception here, but we do that differently anyway)\n * 3. The default property that is provided last. The function is only called if the default property is needed\n */\nexport function fromAnnotationOrTypeOrDefault(name, Type, getDefault) {\n    let value = Metadata.getOwn(Protocol.annotation.keyFor(name), Type);\n    if (value === void 0) {\n        value = Type[name];\n        // eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n        if (value === void 0 || !hasOwn.call(Type, name)) { // First just check the value (common case is faster), but do make sure it doesn't come from the proto chain\n            return getDefault();\n        }\n        return value;\n    }\n    return value;\n}\n/**\n * The order in which the values are checked:\n * 1. Definition properties.\n * 2. The default property that is provided last. The function is only called if the default property is needed\n */\nexport function fromDefinitionOrDefault(name, def, getDefault) {\n    const value = def[name];\n    if (value === void 0) {\n        return getDefault();\n    }\n    return value;\n}\n//# sourceMappingURL=resource.js.map","import { PLATFORM } from './platform';\nimport { Reporter } from './reporter';\nimport { Protocol } from './resource';\nimport { Metadata } from './metadata';\nimport { isArrayIndex, isNativeFunction, isObject } from './functions';\nexport class ResolverBuilder {\n    constructor(container, key) {\n        this.container = container;\n        this.key = key;\n    }\n    instance(value) {\n        return this.registerResolver(0 /* instance */, value);\n    }\n    singleton(value) {\n        return this.registerResolver(1 /* singleton */, value);\n    }\n    transient(value) {\n        return this.registerResolver(2 /* transient */, value);\n    }\n    callback(value) {\n        return this.registerResolver(3 /* callback */, value);\n    }\n    aliasTo(destinationKey) {\n        return this.registerResolver(5 /* alias */, destinationKey);\n    }\n    registerResolver(strategy, state) {\n        const { container, key } = this;\n        this.container = this.key = (void 0);\n        return container.registerResolver(key, new Resolver(key, strategy, state));\n    }\n}\nfunction cloneArrayWithPossibleProps(source) {\n    const clone = source.slice();\n    const keys = Object.keys(source);\n    const len = keys.length;\n    let key;\n    for (let i = 0; i < len; ++i) {\n        key = keys[i];\n        if (!isArrayIndex(key)) {\n            clone[key] = source[key];\n        }\n    }\n    return clone;\n}\nexport const DI = {\n    createContainer(...params) {\n        if (params.length === 0) {\n            return new Container(null);\n        }\n        else {\n            return new Container(null).register(...params);\n        }\n    },\n    getDesignParamtypes(Type) {\n        return Metadata.getOwn('design:paramtypes', Type);\n    },\n    getAnnotationParamtypes(Type) {\n        const key = Protocol.annotation.keyFor('di:paramtypes');\n        return Metadata.getOwn(key, Type);\n    },\n    getOrCreateAnnotationParamTypes(Type) {\n        const key = Protocol.annotation.keyFor('di:paramtypes');\n        let annotationParamtypes = Metadata.getOwn(key, Type);\n        if (annotationParamtypes === void 0) {\n            Metadata.define(key, annotationParamtypes = [], Type);\n            Protocol.annotation.appendTo(Type, key);\n        }\n        return annotationParamtypes;\n    },\n    getDependencies(Type) {\n        // Note: Every detail of this getDependencies method is pretty deliberate at the moment, and probably not yet 100% tested from every possible angle,\n        // so be careful with making changes here as it can have a huge impact on complex end user apps.\n        // Preferably, only make changes to the dependency resolution process via a RFC.\n        const key = Protocol.annotation.keyFor('di:dependencies');\n        let dependencies = Metadata.getOwn(key, Type);\n        if (dependencies === void 0) {\n            // Type.length is the number of constructor parameters. If this is 0, it could mean the class has an empty constructor\n            // but it could also mean the class has no constructor at all (in which case it inherits the constructor from the prototype).\n            // Non-zero constructor length + no paramtypes means emitDecoratorMetadata is off, or the class has no decorator.\n            // We're not doing anything with the above right now, but it's good to keep in mind for any future issues.\n            const inject = Type.inject;\n            if (inject === void 0) {\n                // design:paramtypes is set by tsc when emitDecoratorMetadata is enabled.\n                const designParamtypes = DI.getDesignParamtypes(Type);\n                // au:annotation:di:paramtypes is set by the parameter decorator from DI.createInterface or by @inject\n                const annotationParamtypes = DI.getAnnotationParamtypes(Type);\n                if (designParamtypes === void 0) {\n                    if (annotationParamtypes === void 0) {\n                        // Only go up the prototype if neither static inject nor any of the paramtypes is defined, as\n                        // there is no sound way to merge a type's deps with its prototype's deps\n                        const Proto = Object.getPrototypeOf(Type);\n                        if (typeof Proto === 'function' && Proto !== Function.prototype) {\n                            dependencies = cloneArrayWithPossibleProps(DI.getDependencies(Proto));\n                        }\n                        else {\n                            dependencies = [];\n                        }\n                    }\n                    else {\n                        // No design:paramtypes so just use the au:annotation:di:paramtypes\n                        dependencies = cloneArrayWithPossibleProps(annotationParamtypes);\n                    }\n                }\n                else if (annotationParamtypes === void 0) {\n                    // No au:annotation:di:paramtypes so just use the design:paramtypes\n                    dependencies = cloneArrayWithPossibleProps(designParamtypes);\n                }\n                else {\n                    // We've got both, so merge them (in case of conflict on same index, au:annotation:di:paramtypes take precedence)\n                    dependencies = cloneArrayWithPossibleProps(designParamtypes);\n                    let len = annotationParamtypes.length;\n                    let auAnnotationParamtype;\n                    for (let i = 0; i < len; ++i) {\n                        auAnnotationParamtype = annotationParamtypes[i];\n                        if (auAnnotationParamtype !== void 0) {\n                            dependencies[i] = auAnnotationParamtype;\n                        }\n                    }\n                    const keys = Object.keys(annotationParamtypes);\n                    len = keys.length;\n                    let key;\n                    for (let i = 0; i < len; ++i) {\n                        key = keys[i];\n                        if (!isArrayIndex(key)) {\n                            dependencies[key] = annotationParamtypes[key];\n                        }\n                    }\n                }\n            }\n            else {\n                // Ignore paramtypes if we have static inject\n                dependencies = cloneArrayWithPossibleProps(inject);\n            }\n            Metadata.define(key, dependencies, Type);\n            Protocol.annotation.appendTo(Type, key);\n        }\n        return dependencies;\n    },\n    createInterface(friendlyName) {\n        const Interface = function (target, property, index) {\n            if (target == null) {\n                throw Reporter.error(16, Interface.friendlyName, Interface); // TODO: add error (trying to resolve an InterfaceSymbol that has no registrations)\n            }\n            const annotationParamtypes = DI.getOrCreateAnnotationParamTypes(target);\n            annotationParamtypes[index] = Interface;\n            return target;\n        };\n        Interface.friendlyName = friendlyName == null ? 'Interface' : friendlyName;\n        Interface.noDefault = function () {\n            return Interface;\n        };\n        Interface.withDefault = function (configure) {\n            Interface.withDefault = function () {\n                throw Reporter.error(17, Interface);\n            };\n            Interface.register = function (container, key) {\n                return configure(new ResolverBuilder(container, (key !== null && key !== void 0 ? key : Interface)));\n            };\n            return Interface;\n        };\n        return Interface;\n    },\n    inject(...dependencies) {\n        return function (target, key, descriptor) {\n            if (typeof descriptor === 'number') { // It's a parameter decorator.\n                const annotationParamtypes = DI.getOrCreateAnnotationParamTypes(target);\n                const dep = dependencies[0];\n                if (dep !== void 0) {\n                    annotationParamtypes[descriptor] = dep;\n                }\n            }\n            else if (key) { // It's a property decorator. Not supported by the container without plugins.\n                const annotationParamtypes = DI.getOrCreateAnnotationParamTypes(target.constructor);\n                const dep = dependencies[0];\n                if (dep !== void 0) {\n                    annotationParamtypes[key] = dep;\n                }\n            }\n            else if (descriptor) { // It's a function decorator (not a Class constructor)\n                const fn = descriptor.value;\n                const annotationParamtypes = DI.getOrCreateAnnotationParamTypes(fn);\n                let dep;\n                for (let i = 0; i < dependencies.length; ++i) {\n                    dep = dependencies[i];\n                    if (dep !== void 0) {\n                        annotationParamtypes[i] = dep;\n                    }\n                }\n            }\n            else { // It's a class decorator.\n                const annotationParamtypes = DI.getOrCreateAnnotationParamTypes(target);\n                let dep;\n                for (let i = 0; i < dependencies.length; ++i) {\n                    dep = dependencies[i];\n                    if (dep !== void 0) {\n                        annotationParamtypes[i] = dep;\n                    }\n                }\n            }\n        };\n    },\n    /**\n     * Registers the `target` class as a transient dependency; each time the dependency is resolved\n     * a new instance will be created.\n     *\n     * @param target - The class / constructor function to register as transient.\n     * @returns The same class, with a static `register` method that takes a container and returns the appropriate resolver.\n     *\n     * @example ```ts\n     * // On an existing class\n     * class Foo { }\n     * DI.transient(Foo);\n     *\n     * // Inline declaration\n     * const Foo = DI.transient(class { });\n     * // Foo is now strongly typed with register\n     * Foo.register(container);\n     * ```\n     */\n    transient(target) {\n        target.register = function register(container) {\n            const registration = Registration.transient(target, target);\n            return registration.register(container, target);\n        };\n        return target;\n    },\n    /**\n     * Registers the `target` class as a singleton dependency; the class will only be created once. Each\n     * consecutive time the dependency is resolved, the same instance will be returned.\n     *\n     * @param target - The class / constructor function to register as a singleton.\n     * @returns The same class, with a static `register` method that takes a container and returns the appropriate resolver.\n     * @example ```ts\n     * // On an existing class\n     * class Foo { }\n     * DI.singleton(Foo);\n     *\n     * // Inline declaration\n     * const Foo = DI.singleton(class { });\n     * // Foo is now strongly typed with register\n     * Foo.register(container);\n     * ```\n     */\n    singleton(target) {\n        target.register = function register(container) {\n            const registration = Registration.singleton(target, target);\n            return registration.register(container, target);\n        };\n        return target;\n    },\n};\nexport const IContainer = DI.createInterface('IContainer').noDefault();\nexport const IServiceLocator = IContainer;\nfunction createResolver(getter) {\n    return function (key) {\n        const resolver = function (target, property, descriptor) {\n            DI.inject(resolver)(target, property, descriptor);\n        };\n        resolver.resolve = function (handler, requestor) {\n            return getter(key, handler, requestor);\n        };\n        return resolver;\n    };\n}\nexport const inject = DI.inject;\nfunction transientDecorator(target) {\n    return DI.transient(target);\n}\nexport function transient(target) {\n    return target == null ? transientDecorator : transientDecorator(target);\n}\nfunction singletonDecorator(target) {\n    return DI.singleton(target);\n}\nexport function singleton(target) {\n    return target == null ? singletonDecorator : singletonDecorator(target);\n}\nexport const all = createResolver((key, handler, requestor) => requestor.getAll(key));\nexport const lazy = createResolver((key, handler, requestor) => {\n    let instance = null; // cache locally so that lazy always returns the same instance once resolved\n    return () => {\n        if (instance == null) {\n            instance = requestor.get(key);\n        }\n        return instance;\n    };\n});\nexport const optional = createResolver((key, handler, requestor) => {\n    if (requestor.has(key, true)) {\n        return requestor.get(key);\n    }\n    else {\n        return null;\n    }\n});\n/** @internal */\nexport var ResolverStrategy;\n(function (ResolverStrategy) {\n    ResolverStrategy[ResolverStrategy[\"instance\"] = 0] = \"instance\";\n    ResolverStrategy[ResolverStrategy[\"singleton\"] = 1] = \"singleton\";\n    ResolverStrategy[ResolverStrategy[\"transient\"] = 2] = \"transient\";\n    ResolverStrategy[ResolverStrategy[\"callback\"] = 3] = \"callback\";\n    ResolverStrategy[ResolverStrategy[\"array\"] = 4] = \"array\";\n    ResolverStrategy[ResolverStrategy[\"alias\"] = 5] = \"alias\";\n})(ResolverStrategy || (ResolverStrategy = {}));\n/** @internal */\nexport class Resolver {\n    constructor(key, strategy, state) {\n        this.key = key;\n        this.strategy = strategy;\n        this.state = state;\n    }\n    register(container, key) {\n        return container.registerResolver(key || this.key, this);\n    }\n    resolve(handler, requestor) {\n        switch (this.strategy) {\n            case 0 /* instance */:\n                return this.state;\n            case 1 /* singleton */: {\n                this.strategy = 0 /* instance */;\n                const factory = handler.getFactory(this.state);\n                if (factory === null) {\n                    throw new Error(`Resolver for ${String(this.key)} returned a null factory`);\n                }\n                return this.state = factory.construct(requestor);\n            }\n            case 2 /* transient */: {\n                // Always create transients from the requesting container\n                const factory = handler.getFactory(this.state);\n                if (factory === null) {\n                    throw new Error(`Resolver for ${String(this.key)} returned a null factory`);\n                }\n                return factory.construct(requestor);\n            }\n            case 3 /* callback */:\n                return this.state(handler, requestor, this);\n            case 4 /* array */:\n                return this.state[0].resolve(handler, requestor);\n            case 5 /* alias */:\n                return handler.get(this.state);\n            default:\n                throw Reporter.error(6, this.strategy);\n        }\n    }\n    getFactory(container) {\n        let resolver;\n        switch (this.strategy) {\n            case 1 /* singleton */:\n            case 2 /* transient */:\n                return container.getFactory(this.state);\n            case 5 /* alias */:\n                resolver = container.getResolver(this.state);\n                if (resolver == null || resolver.getFactory === void 0) {\n                    return null;\n                }\n                return resolver.getFactory(container);\n            default:\n                return null;\n        }\n    }\n}\n/** @internal */\nexport class Factory {\n    constructor(Type, invoker, dependencies) {\n        this.Type = Type;\n        this.invoker = invoker;\n        this.dependencies = dependencies;\n        this.transformers = null;\n    }\n    construct(container, dynamicDependencies) {\n        const transformers = this.transformers;\n        let instance = dynamicDependencies !== void 0\n            ? this.invoker.invokeWithDynamicDependencies(container, this.Type, this.dependencies, dynamicDependencies)\n            : this.invoker.invoke(container, this.Type, this.dependencies);\n        if (transformers == null) {\n            return instance;\n        }\n        for (let i = 0, ii = transformers.length; i < ii; ++i) {\n            instance = transformers[i](instance);\n        }\n        return instance;\n    }\n    registerTransformer(transformer) {\n        if (this.transformers == null) {\n            this.transformers = [];\n        }\n        this.transformers.push(transformer);\n        return true;\n    }\n}\nconst createFactory = (function () {\n    function invokeWithDynamicDependencies(container, Type, staticDependencies, dynamicDependencies) {\n        let i = staticDependencies.length;\n        let args = new Array(i);\n        let lookup;\n        while (i-- > 0) {\n            lookup = staticDependencies[i];\n            if (lookup == null) {\n                throw Reporter.error(7, `Index ${i}.`);\n            }\n            else {\n                args[i] = container.get(lookup);\n            }\n        }\n        if (dynamicDependencies !== void 0) {\n            args = args.concat(dynamicDependencies);\n        }\n        return Reflect.construct(Type, args);\n    }\n    const classInvokers = [\n        {\n            invoke(container, Type) {\n                return new Type();\n            },\n            invokeWithDynamicDependencies\n        },\n        {\n            invoke(container, Type, deps) {\n                return new Type(container.get(deps[0]));\n            },\n            invokeWithDynamicDependencies\n        },\n        {\n            invoke(container, Type, deps) {\n                return new Type(container.get(deps[0]), container.get(deps[1]));\n            },\n            invokeWithDynamicDependencies\n        },\n        {\n            invoke(container, Type, deps) {\n                return new Type(container.get(deps[0]), container.get(deps[1]), container.get(deps[2]));\n            },\n            invokeWithDynamicDependencies\n        },\n        {\n            invoke(container, Type, deps) {\n                return new Type(container.get(deps[0]), container.get(deps[1]), container.get(deps[2]), container.get(deps[3]));\n            },\n            invokeWithDynamicDependencies\n        },\n        {\n            invoke(container, Type, deps) {\n                return new Type(container.get(deps[0]), container.get(deps[1]), container.get(deps[2]), container.get(deps[3]), container.get(deps[4]));\n            },\n            invokeWithDynamicDependencies\n        }\n    ];\n    const fallbackInvoker = {\n        invoke: invokeWithDynamicDependencies,\n        invokeWithDynamicDependencies\n    };\n    return function (Type) {\n        if (isNativeFunction(Type)) {\n            Reporter.write(5, Type.name);\n        }\n        const dependencies = DI.getDependencies(Type);\n        const invoker = classInvokers.length > dependencies.length ? classInvokers[dependencies.length] : fallbackInvoker;\n        return new Factory(Type, invoker, dependencies);\n    };\n})();\nconst containerResolver = {\n    resolve(handler, requestor) {\n        return requestor;\n    }\n};\nfunction isRegistry(obj) {\n    return typeof obj.register === 'function';\n}\nfunction isClass(obj) {\n    return obj.prototype !== void 0;\n}\nfunction isResourceKey(key) {\n    return typeof key === 'string' && key.indexOf(':') > 0;\n}\n/** @internal */\nexport class Container {\n    constructor(parent) {\n        this.parent = parent;\n        this.registerDepth = 0;\n        if (parent === null) {\n            this.root = this;\n            this.resolvers = new Map();\n            this.resourceResolvers = Object.create(null);\n        }\n        else {\n            this.root = parent.root;\n            this.resolvers = new Map();\n            this.resourceResolvers = Object.assign(Object.create(null), this.root.resourceResolvers);\n        }\n        this.resolvers.set(IContainer, containerResolver);\n    }\n    register(...params) {\n        if (++this.registerDepth === 100) {\n            throw new Error('Unable to autoregister dependency');\n            // TODO: change to reporter.error and add various possible causes in description.\n            // Most likely cause is trying to register a plain object that does not have a\n            // register method and is not a class constructor\n        }\n        let current;\n        let keys;\n        let value;\n        let j;\n        let jj;\n        for (let i = 0, ii = params.length; i < ii; ++i) {\n            current = params[i];\n            if (!isObject(current)) {\n                continue;\n            }\n            if (isRegistry(current)) {\n                current.register(this);\n            }\n            else if (Protocol.resource.has(current)) {\n                const defs = Protocol.resource.getAll(current);\n                if (defs.length === 1) {\n                    // Fast path for the very common case\n                    defs[0].register(this);\n                }\n                else {\n                    const len = defs.length;\n                    for (let d = 0; d < len; ++d) {\n                        defs[d].register(this);\n                    }\n                }\n            }\n            else if (isClass(current)) {\n                Registration.singleton(current, current).register(this);\n            }\n            else {\n                keys = Object.keys(current);\n                j = 0;\n                jj = keys.length;\n                for (; j < jj; ++j) {\n                    value = current[keys[j]];\n                    if (!isObject(value)) {\n                        continue;\n                    }\n                    // note: we could remove this if-branch and call this.register directly\n                    // - the extra check is just a perf tweak to create fewer unnecessary arrays by the spread operator\n                    if (isRegistry(value)) {\n                        value.register(this);\n                    }\n                    else {\n                        this.register(value);\n                    }\n                }\n            }\n        }\n        --this.registerDepth;\n        return this;\n    }\n    registerResolver(key, resolver) {\n        validateKey(key);\n        const resolvers = this.resolvers;\n        const result = resolvers.get(key);\n        if (result == null) {\n            resolvers.set(key, resolver);\n            if (isResourceKey(key)) {\n                this.resourceResolvers[key] = resolver;\n            }\n        }\n        else if (result instanceof Resolver && result.strategy === 4 /* array */) {\n            result.state.push(resolver);\n        }\n        else {\n            resolvers.set(key, new Resolver(key, 4 /* array */, [result, resolver]));\n        }\n        return resolver;\n    }\n    registerTransformer(key, transformer) {\n        const resolver = this.getResolver(key);\n        if (resolver == null) {\n            return false;\n        }\n        if (resolver.getFactory) {\n            const factory = resolver.getFactory(this);\n            if (factory == null) {\n                return false;\n            }\n            // This type cast is a bit of a hacky one, necessary due to the duplicity of IResolverLike.\n            // Problem is that that interface's type arg can be of type Key, but the getFactory method only works on\n            // type Constructable. So the return type of that optional method has this additional constraint, which\n            // seems to confuse the type checker.\n            return factory.registerTransformer(transformer);\n        }\n        return false;\n    }\n    getResolver(key, autoRegister = true) {\n        validateKey(key);\n        if (key.resolve !== void 0) {\n            return key;\n        }\n        let current = this;\n        let resolver;\n        while (current != null) {\n            resolver = current.resolvers.get(key);\n            if (resolver == null) {\n                if (current.parent == null) {\n                    return autoRegister ? this.jitRegister(key, current) : null;\n                }\n                current = current.parent;\n            }\n            else {\n                return resolver;\n            }\n        }\n        return null;\n    }\n    has(key, searchAncestors = false) {\n        return this.resolvers.has(key)\n            ? true\n            : searchAncestors && this.parent != null\n                ? this.parent.has(key, true)\n                : false;\n    }\n    get(key) {\n        validateKey(key);\n        if (key.resolve !== void 0) {\n            return key.resolve(this, this);\n        }\n        let current = this;\n        let resolver;\n        while (current != null) {\n            resolver = current.resolvers.get(key);\n            if (resolver == null) {\n                if (current.parent == null) {\n                    resolver = this.jitRegister(key, current);\n                    return resolver.resolve(current, this);\n                }\n                current = current.parent;\n            }\n            else {\n                return resolver.resolve(current, this);\n            }\n        }\n        throw new Error(`Unable to resolve key: ${key}`);\n    }\n    getAll(key) {\n        validateKey(key);\n        let current = this;\n        let resolver;\n        while (current != null) {\n            resolver = current.resolvers.get(key);\n            if (resolver == null) {\n                if (this.parent == null) {\n                    return PLATFORM.emptyArray;\n                }\n                current = current.parent;\n            }\n            else {\n                return buildAllResponse(resolver, current, this);\n            }\n        }\n        return PLATFORM.emptyArray;\n    }\n    getFactory(Type) {\n        const key = Protocol.annotation.keyFor('di:factory');\n        let factory = Metadata.getOwn(key, Type);\n        if (factory === void 0) {\n            Metadata.define(key, factory = createFactory(Type), Type);\n            Protocol.annotation.appendTo(Type, key);\n        }\n        return factory;\n    }\n    createChild() {\n        return new Container(this);\n    }\n    jitRegister(keyAsValue, handler) {\n        if (typeof keyAsValue !== 'function') {\n            throw new Error(`Attempted to jitRegister something that is not a constructor: '${keyAsValue}'. Did you forget to register this resource?`);\n        }\n        if (isRegistry(keyAsValue)) {\n            const registrationResolver = keyAsValue.register(handler, keyAsValue);\n            if (!(registrationResolver instanceof Object) || registrationResolver.resolve == null) {\n                const newResolver = handler.resolvers.get(keyAsValue);\n                if (newResolver != void 0) {\n                    return newResolver;\n                }\n                throw Reporter.error(40); // did not return a valid resolver from the static register method\n            }\n            return registrationResolver;\n        }\n        else if (Protocol.resource.has(keyAsValue)) {\n            const defs = Protocol.resource.getAll(keyAsValue);\n            if (defs.length === 1) {\n                // Fast path for the very common case\n                defs[0].register(handler);\n            }\n            else {\n                const len = defs.length;\n                for (let d = 0; d < len; ++d) {\n                    defs[d].register(handler);\n                }\n            }\n            const newResolver = handler.resolvers.get(keyAsValue);\n            if (newResolver != void 0) {\n                return newResolver;\n            }\n            throw Reporter.error(40); // did not return a valid resolver from the static register method\n        }\n        else {\n            const resolver = new Resolver(keyAsValue, 1 /* singleton */, keyAsValue);\n            handler.resolvers.set(keyAsValue, resolver);\n            return resolver;\n        }\n    }\n}\n/**\n * An implementation of IRegistry that delegates registration to a\n * separately registered class. The ParameterizedRegistry facilitates the\n * passing of parameters to the final registry.\n */\nexport class ParameterizedRegistry {\n    constructor(key, params) {\n        this.key = key;\n        this.params = params;\n    }\n    register(container) {\n        if (container.has(this.key, true)) {\n            const registry = container.get(this.key);\n            registry.register(container, ...this.params);\n        }\n        else {\n            container.register(...this.params.filter(x => typeof x === 'object'));\n        }\n    }\n}\nexport const Registration = {\n    instance(key, value) {\n        return new Resolver(key, 0 /* instance */, value);\n    },\n    singleton(key, value) {\n        return new Resolver(key, 1 /* singleton */, value);\n    },\n    transient(key, value) {\n        return new Resolver(key, 2 /* transient */, value);\n    },\n    callback(key, callback) {\n        return new Resolver(key, 3 /* callback */, callback);\n    },\n    alias(originalKey, aliasKey) {\n        return new Resolver(aliasKey, 5 /* alias */, originalKey);\n    },\n    defer(key, ...params) {\n        return new ParameterizedRegistry(key, params);\n    }\n};\nexport class InstanceProvider {\n    constructor() {\n        this.instance = null;\n    }\n    prepare(instance) {\n        this.instance = instance;\n    }\n    resolve(handler, requestor) {\n        if (this.instance === undefined) { // unmet precondition: call prepare\n            throw Reporter.error(50); // TODO: organize error codes\n        }\n        return this.instance;\n    }\n    dispose() {\n        this.instance = null;\n    }\n}\n/** @internal */\nexport function validateKey(key) {\n    if (key === null || key === void 0) {\n        throw Reporter.error(5);\n    }\n}\nfunction buildAllResponse(resolver, handler, requestor) {\n    if (resolver instanceof Resolver && resolver.strategy === 4 /* array */) {\n        const state = resolver.state;\n        let i = state.length;\n        const results = new Array(i);\n        while (i--) {\n            results[i] = state[i].resolve(handler, requestor);\n        }\n        return results;\n    }\n    return [resolver.resolve(handler, requestor)];\n}\n//# sourceMappingURL=di.js.map","import { __decorate, __metadata, __param } from \"tslib\";\nimport { toLookup } from './functions';\nimport { DI, all, Registration } from './di';\n/**\n * Flags to enable/disable color usage in the logging output.\n */\nexport var ColorOptions;\n(function (ColorOptions) {\n    /**\n     * Do not use ASCII color codes in logging output.\n     */\n    ColorOptions[ColorOptions[\"noColors\"] = 0] = \"noColors\";\n    /**\n     * Use ASCII color codes in logging output. By default, timestamps and the TRC and DBG prefix are colored grey. INF white, WRN yellow, and ERR and FTL red.\n     */\n    ColorOptions[ColorOptions[\"colors\"] = 1] = \"colors\";\n})(ColorOptions || (ColorOptions = {}));\nexport const ILogConfig = DI.createInterface('ILogConfig').withDefault(x => x.instance(new LogConfig(0 /* noColors */, 3 /* warn */)));\nexport const ISink = DI.createInterface('ISink').noDefault();\nexport const ILogEventFactory = DI.createInterface('ILogEventFactory').withDefault(x => x.singleton(DefaultLogEventFactory));\nexport const ILogger = DI.createInterface('ILogger').withDefault(x => x.singleton(DefaultLogger));\n// http://en.wikipedia.org/wiki/ANSI_escape_code#graphics\nexport const format = toLookup({\n    red(str) {\n        return `\\u001b[31m${str}\\u001b[39m`;\n    },\n    green(str) {\n        return `\\u001b[32m${str}\\u001b[39m`;\n    },\n    yellow(str) {\n        return `\\u001b[33m${str}\\u001b[39m`;\n    },\n    blue(str) {\n        return `\\u001b[34m${str}\\u001b[39m`;\n    },\n    magenta(str) {\n        return `\\u001b[35m${str}\\u001b[39m`;\n    },\n    cyan(str) {\n        return `\\u001b[36m${str}\\u001b[39m`;\n    },\n    white(str) {\n        return `\\u001b[37m${str}\\u001b[39m`;\n    },\n    grey(str) {\n        return `\\u001b[90m${str}\\u001b[39m`;\n    },\n});\nexport class LogConfig {\n    constructor(colorOptions, level) {\n        this.colorOptions = colorOptions;\n        this.level = level;\n    }\n}\nconst getLogLevelString = (function () {\n    const logLevelString = [\n        toLookup({\n            TRC: 'TRC',\n            DBG: 'DBG',\n            INF: 'INF',\n            WRN: 'WRN',\n            ERR: 'ERR',\n            FTL: 'FTL',\n            QQQ: '???',\n        }),\n        toLookup({\n            TRC: format.grey('TRC'),\n            DBG: format.grey('DBG'),\n            INF: format.white('INF'),\n            WRN: format.yellow('WRN'),\n            ERR: format.red('ERR'),\n            FTL: format.red('FTL'),\n            QQQ: format.grey('???'),\n        }),\n    ];\n    return function (level, colorOptions) {\n        if (level <= 0 /* trace */) {\n            return logLevelString[colorOptions].TRC;\n        }\n        if (level <= 1 /* debug */) {\n            return logLevelString[colorOptions].DBG;\n        }\n        if (level <= 2 /* info */) {\n            return logLevelString[colorOptions].INF;\n        }\n        if (level <= 3 /* warn */) {\n            return logLevelString[colorOptions].WRN;\n        }\n        if (level <= 4 /* error */) {\n            return logLevelString[colorOptions].ERR;\n        }\n        if (level <= 5 /* fatal */) {\n            return logLevelString[colorOptions].FTL;\n        }\n        return logLevelString[colorOptions].QQQ;\n    };\n})();\nfunction getScopeString(scope, colorOptions) {\n    if (colorOptions === 0 /* noColors */) {\n        return scope.join('.');\n    }\n    // eslint-disable-next-line @typescript-eslint/unbound-method\n    return scope.map(format.cyan).join('.');\n}\nfunction getIsoString(timestamp, colorOptions) {\n    if (colorOptions === 0 /* noColors */) {\n        return new Date(timestamp).toISOString();\n    }\n    return format.grey(new Date(timestamp).toISOString());\n}\nexport class DefaultLogEvent {\n    constructor(severity, message, optionalParams, scope, colorOptions, timestamp) {\n        this.severity = severity;\n        this.message = message;\n        this.optionalParams = optionalParams;\n        this.scope = scope;\n        this.colorOptions = colorOptions;\n        this.timestamp = timestamp;\n    }\n    toString() {\n        const { severity, message, scope, colorOptions, timestamp } = this;\n        if (scope.length === 0) {\n            return `${getIsoString(timestamp, colorOptions)} [${getLogLevelString(severity, colorOptions)}] ${message}`;\n        }\n        return `${getIsoString(timestamp, colorOptions)} [${getLogLevelString(severity, colorOptions)} ${getScopeString(scope, colorOptions)}] ${message}`;\n    }\n}\nlet DefaultLogEventFactory = class DefaultLogEventFactory {\n    constructor(config) {\n        this.config = config;\n    }\n    createLogEvent(logger, level, message, optionalParams) {\n        return new DefaultLogEvent(level, message, optionalParams, logger.scope, this.config.colorOptions, Date.now());\n    }\n};\nDefaultLogEventFactory = __decorate([\n    __param(0, ILogConfig),\n    __metadata(\"design:paramtypes\", [Object])\n], DefaultLogEventFactory);\nexport { DefaultLogEventFactory };\nexport class ConsoleSink {\n    constructor($console) {\n        this.emit = function emit(event) {\n            const optionalParams = event.optionalParams;\n            if (optionalParams === void 0 || optionalParams.length === 0) {\n                switch (event.severity) {\n                    case 0 /* trace */:\n                    case 1 /* debug */:\n                        return $console.debug(event.toString());\n                    case 2 /* info */:\n                        return $console.info(event.toString());\n                    case 3 /* warn */:\n                        return $console.warn(event.toString());\n                    case 4 /* error */:\n                    case 5 /* fatal */:\n                        return $console.error(event.toString());\n                }\n            }\n            else {\n                switch (event.severity) {\n                    case 0 /* trace */:\n                    case 1 /* debug */:\n                        return $console.debug(event.toString(), ...optionalParams);\n                    case 2 /* info */:\n                        return $console.info(event.toString(), ...optionalParams);\n                    case 3 /* warn */:\n                        return $console.warn(event.toString(), ...optionalParams);\n                    case 4 /* error */:\n                    case 5 /* fatal */:\n                        return $console.error(event.toString(), ...optionalParams);\n                }\n            }\n        };\n    }\n}\nlet DefaultLogger = class DefaultLogger {\n    constructor(config, factory, sinks, scope = [], parent = null) {\n        this.config = config;\n        this.factory = factory;\n        this.sinks = sinks;\n        this.scope = scope;\n        this.scopedLoggers = Object.create(null);\n        if (parent === null) {\n            this.root = this;\n            this.parent = this;\n        }\n        else {\n            this.root = parent.root;\n            this.parent = parent;\n        }\n        const sinksLen = sinks.length;\n        let i = 0;\n        const emit = (level, msgOrGetMsg, optionalParams) => {\n            const message = typeof msgOrGetMsg === 'function' ? msgOrGetMsg() : msgOrGetMsg;\n            const event = factory.createLogEvent(this, level, message, optionalParams);\n            for (i = 0; i < sinksLen; ++i) {\n                sinks[i].emit(event);\n            }\n        };\n        this.trace = function trace(messageOrGetMessage, ...optionalParams) {\n            if (config.level <= 0 /* trace */) {\n                emit(0 /* trace */, messageOrGetMessage, optionalParams);\n            }\n        };\n        this.debug = function debug(messageOrGetMessage, ...optionalParams) {\n            if (config.level <= 1 /* debug */) {\n                emit(1 /* debug */, messageOrGetMessage, optionalParams);\n            }\n        };\n        this.info = function info(messageOrGetMessage, ...optionalParams) {\n            if (config.level <= 2 /* info */) {\n                emit(2 /* info */, messageOrGetMessage, optionalParams);\n            }\n        };\n        this.warn = function warn(messageOrGetMessage, ...optionalParams) {\n            if (config.level <= 3 /* warn */) {\n                emit(3 /* warn */, messageOrGetMessage, optionalParams);\n            }\n        };\n        this.error = function error(messageOrGetMessage, ...optionalParams) {\n            if (config.level <= 4 /* error */) {\n                emit(4 /* error */, messageOrGetMessage, optionalParams);\n            }\n        };\n        this.fatal = function fatal(messageOrGetMessage, ...optionalParams) {\n            if (config.level <= 5 /* fatal */) {\n                emit(5 /* fatal */, messageOrGetMessage, optionalParams);\n            }\n        };\n    }\n    scopeTo(name) {\n        const scopedLoggers = this.scopedLoggers;\n        let scopedLogger = scopedLoggers[name];\n        if (scopedLogger === void 0) {\n            scopedLogger = scopedLoggers[name] = new DefaultLogger(this.config, this.factory, this.sinks, this.scope.concat(name), this);\n        }\n        return scopedLogger;\n    }\n};\nDefaultLogger = __decorate([\n    __param(0, ILogConfig),\n    __param(1, ILogEventFactory),\n    __param(2, all(ISink)),\n    __metadata(\"design:paramtypes\", [Object, Object, Array, Array, Object])\n], DefaultLogger);\nexport { DefaultLogger };\n/**\n * A basic `ILogger` configuration that configures a single `console` sink based on provided options.\n *\n * NOTE: You *must* register the return value of `.create` with the container / au instance, not this `LoggerConfiguration` object itself.\n *\n * ```ts\n * // GOOD\n * container.register(LoggerConfiguration.create(console))\n * // GOOD\n * container.register(LoggerConfiguration.create(console, LogLevel.debug))\n * // GOOD\n * container.register(LoggerConfiguration.create({\n *   debug: PLATFORM.noop,\n *   info: PLATFORM.noop,\n *   warn: PLATFORM.noop,\n *   error: msg => {\n *     throw new Error(msg);\n *   }\n * }, LogLevel.debug))\n *\n * // BAD\n * container.register(LoggerConfiguration)\n * ```\n */\nexport const LoggerConfiguration = toLookup({\n    /**\n     * @param $console - The `console` object to use. Can be the native `window.console` / `global.console`, but can also be a wrapper or mock that implements the same interface.\n     * @param level - The global `LogLevel` to configure. Defaults to `warn` or higher.\n     * @param colorOptions - Whether to use colors or not. Defaults to `noColors`. Colors are especially nice in nodejs environments but don't necessarily work (well) in all environments, such as browsers.\n     */\n    create($console, level = 3 /* warn */, colorOptions = 0 /* noColors */) {\n        return toLookup({\n            register(container) {\n                return container.register(Registration.instance(ILogConfig, new LogConfig(colorOptions, level)), Registration.instance(ISink, new ConsoleSink($console)));\n            },\n        });\n    },\n});\n//# sourceMappingURL=logger.js.map","function trimDots(ary) {\n    const len = ary.length;\n    let i = 0;\n    let part;\n    for (; i < len; ++i) {\n        part = ary[i];\n        if (part === '.') {\n            ary.splice(i, 1);\n            i -= 1;\n        }\n        else if (part === '..') {\n            // If at the start, or previous value is still ..,\n            // keep them so that when converted to a path it may\n            // still work when converted to a path, even though\n            // as an ID it is less than ideal. In larger point\n            // releases, may be better to just kick out an error.\n            if (i === 0 || (i === 1 && ary[2] === '..') || ary[i - 1] === '..') {\n                continue;\n            }\n            if (i > 0) {\n                ary.splice(i - 1, 2);\n                i -= 2;\n            }\n        }\n    }\n}\n/**\n * Calculates a path relative to a file.\n *\n * @param name - The relative path.\n * @param file - The file path.\n * @returns The calculated path.\n */\nexport function relativeToFile(name, file) {\n    const fileParts = !file ? file : file.split('/');\n    const nameParts = name.trim().split('/');\n    if (nameParts[0].startsWith('.') && fileParts) {\n        // Convert file to array, and lop off the last part,\n        // so that . matches that 'directory' and not name of the file's\n        // module. For instance, file of 'one/two/three', maps to\n        // 'one/two/three.js', but we want the directory, 'one/two' for\n        // this normalization.\n        const normalizedBaseParts = fileParts.slice(0, fileParts.length - 1);\n        nameParts.unshift(...normalizedBaseParts);\n    }\n    trimDots(nameParts);\n    return nameParts.join('/');\n}\n/**\n * Joins two paths.\n *\n * @param path1 - The first path.\n * @param path2 - The second path.\n * @returns The joined path.\n */\nexport function join(path1, path2) {\n    if (!path1) {\n        return path2;\n    }\n    if (!path2) {\n        return path1;\n    }\n    const schemeMatch = /^([^/]*?:)\\//.exec(path1);\n    const scheme = (schemeMatch && schemeMatch.length > 0) ? schemeMatch[1] : '';\n    path1 = path1.slice(scheme.length);\n    let urlPrefix;\n    if (path1.startsWith('///') && scheme === 'file:') {\n        urlPrefix = '///';\n    }\n    else if (path1.startsWith('//')) {\n        urlPrefix = '//';\n    }\n    else if (path1.startsWith('/')) {\n        urlPrefix = '/';\n    }\n    else {\n        urlPrefix = '';\n    }\n    const trailingSlash = path2.endsWith('/') ? '/' : '';\n    const url1 = path1.split('/');\n    const url2 = path2.split('/');\n    const url3 = [];\n    for (let i = 0, ii = url1.length; i < ii; ++i) {\n        if (url1[i] === '..') {\n            url3.pop();\n        }\n        else if (url1[i] !== '.' && url1[i] !== '') {\n            url3.push(url1[i]);\n        }\n    }\n    for (let i = 0, ii = url2.length; i < ii; ++i) {\n        if (url2[i] === '..') {\n            url3.pop();\n        }\n        else if (url2[i] !== '.' && url2[i] !== '') {\n            url3.push(url2[i]);\n        }\n    }\n    return scheme + urlPrefix + url3.join('/') + trailingSlash;\n}\nconst encode = encodeURIComponent;\nconst encodeKey = (k) => encode(k).replace('%24', '$');\n/**\n * Recursively builds part of query string for parameter.\n *\n * @param key - Parameter name for query string.\n * @param value - Parameter value to deserialize.\n * @param traditional - Boolean Use the old URI template standard (RFC6570)\n * @returns Array with serialized parameter(s)\n */\nfunction buildParam(key, value, traditional) {\n    let result = [];\n    if (value == null) {\n        return result;\n    }\n    if (Array.isArray(value)) {\n        for (let i = 0, l = value.length; i < l; i++) {\n            if (traditional) {\n                result.push(`${encodeKey(key)}=${encode(value[i])}`);\n            }\n            else {\n                const arrayKey = `${key}[${(typeof value[i] === 'object' && value[i] != null ? i : '')}]`;\n                result = result.concat(buildParam(arrayKey, value[i]));\n            }\n        }\n    }\n    else if (typeof value === 'object' && !traditional) {\n        for (const propertyName in value) {\n            result = result.concat(buildParam(`${key}[${propertyName}]`, value[propertyName]));\n        }\n    }\n    else {\n        result.push(`${encodeKey(key)}=${encode(value)}`);\n    }\n    return result;\n}\n/**\n * Generate a query string from an object.\n *\n * @param params - Object containing the keys and values to be used.\n * @param traditional - Boolean Use the old URI template standard (RFC6570)\n * @returns The generated query string, excluding leading '?'.\n */\nexport function buildQueryString(params, traditional) {\n    if (params == null) {\n        return '';\n    }\n    const pairs = [];\n    const keys = Object.keys(params).sort();\n    let key;\n    for (let i = 0, len = keys.length; i < len; ++i) {\n        key = keys[i];\n        pairs.push(...buildParam(key, params[key], traditional));\n    }\n    if (pairs.length === 0) {\n        return '';\n    }\n    return pairs.join('&');\n}\n/**\n * Process parameter that was recognized as scalar param (primitive value or shallow array).\n *\n * @param existedParam - Object with previously parsed values for specified key.\n * @param value - Parameter value to append.\n * @returns Initial primitive value or transformed existedParam if parameter was recognized as an array.\n */\nfunction processScalarParam(existedParam, value) {\n    if (Array.isArray(existedParam)) {\n        // value is already an array, so push on the next value.\n        existedParam.push(value);\n        return existedParam;\n    }\n    if (existedParam !== undefined) {\n        // value isn't an array, but since a second value has been specified,\n        // convert value into an array.\n        return [existedParam, value];\n    }\n    // value is a scalar.\n    return value;\n}\n/**\n * Sequentially process parameter that was recognized as complex value (object or array).\n * For each keys part, if the current level is undefined create an\n * object or array based on the type of the next keys part.\n *\n * @param queryParams - root-level result object.\n * @param keys - Collection of keys related to this parameter.\n * @param value - Parameter value to append.\n */\nfunction parseComplexParam(queryParams, keys, value) {\n    let currentParams = queryParams;\n    const keysLastIndex = keys.length - 1;\n    let key;\n    let prevValue;\n    for (let j = 0; j <= keysLastIndex; ++j) {\n        key = (keys[j] === '' ? currentParams.length : keys[j]);\n        if (j < keysLastIndex) {\n            // The value has to be an array or a false value\n            // It can happen that the value is no array if the key was repeated with traditional style like `list=1&list[]=2`\n            if (!currentParams[key] || typeof currentParams[key] === 'object') {\n                prevValue = currentParams[key];\n            }\n            else {\n                prevValue = [currentParams[key]];\n            }\n            if (prevValue) {\n                currentParams = currentParams[key] = prevValue;\n            }\n            else if (isNaN(keys[j + 1])) {\n                // Kinda have no choice here\n                // eslint-disable-next-line @typescript-eslint/consistent-type-assertions\n                currentParams = currentParams[key] = {};\n            }\n            else {\n                currentParams = currentParams[key] = [];\n            }\n        }\n        else {\n            currentParams = currentParams[key] = value;\n        }\n    }\n}\n/**\n * Parse a query string into a queryParams object.\n *\n * @param queryString - The query string to parse.\n * @returns Object with keys and values mapped from the query string.\n */\nexport function parseQueryString(queryString) {\n    const queryParams = {};\n    if (!queryString || typeof queryString !== 'string') {\n        return queryParams;\n    }\n    let query = queryString;\n    if (query.startsWith('?')) {\n        query = query.slice(1);\n    }\n    const pairs = query.replace(/\\+/g, ' ').split('&');\n    for (let i = 0; i < pairs.length; i++) {\n        const pair = pairs[i].split('=');\n        const key = decodeURIComponent(pair[0]);\n        if (!key) {\n            continue;\n        }\n        // split object key into its parts\n        let keys = key.split('][');\n        let keysLastIndex = keys.length - 1;\n        // If the first keys part contains [ and the last ends with ], then []\n        // are correctly balanced, split key to parts\n        // Else it's basic key\n        if (keys[0].includes(\"[\") && keys[keysLastIndex].endsWith(\"]\")) {\n            keys[keysLastIndex] = keys[keysLastIndex].replace(/\\]$/, '');\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            keys = keys.shift().split('[').concat(keys); // outer condition already ensures not-null\n            keysLastIndex = keys.length - 1;\n        }\n        else {\n            keysLastIndex = 0;\n        }\n        if (pair.length >= 2) {\n            const value = pair[1] ? decodeURIComponent(pair[1]) : '';\n            if (keysLastIndex) {\n                parseComplexParam(queryParams, keys, value);\n            }\n            else {\n                queryParams[key] = processScalarParam(queryParams[key], value);\n            }\n        }\n        else {\n            queryParams[key] = true;\n        }\n    }\n    return queryParams;\n}\n//# sourceMappingURL=path.js.map","import { PLATFORM } from './platform';\nexport const Profiler = (function () {\n    const now = PLATFORM.now;\n    const timers = [];\n    let profileMap;\n    const profiler = {\n        createTimer,\n        enable,\n        disable,\n        report,\n        enabled: false\n    };\n    return profiler;\n    function createTimer(name) {\n        timers.push(name);\n        let depth = 0;\n        let mark = 0;\n        return {\n            enter,\n            leave\n        };\n        function enter() {\n            if (++depth === 1) {\n                mark = now();\n                ++profileMap[name].topLevelCount;\n            }\n            ++profileMap[name].totalCount;\n        }\n        function leave() {\n            if (--depth === 0) {\n                profileMap[name].duration += (now() - mark);\n            }\n        }\n    }\n    function enable() {\n        profileMap = {};\n        for (const timer of timers) {\n            profileMap[timer] = {\n                name: timer,\n                duration: 0,\n                topLevelCount: 0,\n                totalCount: 0\n            };\n        }\n        profiler.enabled = true;\n    }\n    function disable() {\n        profiler.enabled = false;\n    }\n    function report(cb) {\n        Object.keys(profileMap).map(key => profileMap[key]).sort((a, b) => b.duration - a.duration).forEach(p => {\n            cb(p.name, p.duration, p.topLevelCount, p.totalCount);\n        });\n    }\n})();\n//# sourceMappingURL=profiler.js.map","import { DI } from './di';\nimport { Reporter } from './reporter';\n/**\n * Represents a handler for an EventAggregator event.\n */\nclass Handler {\n    constructor(\n    /** @internal */\n    messageType, \n    /** @internal */\n    callback) {\n        this.messageType = messageType;\n        this.callback = callback;\n    }\n    handle(message) {\n        if (message instanceof this.messageType) {\n            this.callback.call(null, message);\n        }\n    }\n}\nfunction invokeCallback(callback, data, event) {\n    try {\n        callback(data, event);\n    }\n    catch (e) {\n        Reporter.error(0, e); // TODO: create error code\n    }\n}\nfunction invokeHandler(handler, data) {\n    try {\n        handler.handle(data);\n    }\n    catch (e) {\n        Reporter.error(0, e); // TODO: create error code\n    }\n}\nexport const IEventAggregator = DI.createInterface('IEventAggregator').withDefault(x => x.singleton(EventAggregator));\n/**\n * Enables loosely coupled publish/subscribe messaging.\n */\nexport class EventAggregator {\n    constructor() {\n        /** @internal */\n        this.eventLookup = {};\n        /** @internal */\n        this.messageHandlers = [];\n    }\n    publish(channelOrInstance, data) {\n        let subscribers;\n        let i;\n        if (!channelOrInstance) {\n            throw Reporter.error(0); // TODO: create error code for 'Event was invalid.'\n        }\n        if (typeof channelOrInstance === 'string') {\n            const channel = channelOrInstance;\n            subscribers = this.eventLookup[channel];\n            if (subscribers != null) {\n                subscribers = subscribers.slice();\n                i = subscribers.length;\n                while (i--) {\n                    invokeCallback(subscribers[i], data, channel);\n                }\n            }\n        }\n        else {\n            const instance = channelOrInstance;\n            subscribers = this.messageHandlers.slice();\n            i = subscribers.length;\n            while (i--) {\n                invokeHandler(subscribers[i], instance);\n            }\n        }\n    }\n    subscribe(channelOrType, callback) {\n        let handler;\n        let subscribers;\n        if (!channelOrType) {\n            throw Reporter.error(0); // TODO: create error code for 'Event channel/type was invalid.'\n        }\n        if (typeof channelOrType === 'string') {\n            const channel = channelOrType;\n            handler = callback;\n            if (this.eventLookup[channel] === void 0) {\n                this.eventLookup[channel] = [];\n            }\n            subscribers = this.eventLookup[channel];\n        }\n        else {\n            handler = new Handler(channelOrType, callback);\n            subscribers = this.messageHandlers;\n        }\n        subscribers.push(handler);\n        return {\n            dispose() {\n                const idx = subscribers.indexOf(handler);\n                if (idx !== -1) {\n                    subscribers.splice(idx, 1);\n                }\n            }\n        };\n    }\n    subscribeOnce(channelOrType, callback) {\n        const sub = this.subscribe(channelOrType, (data, event) => {\n            sub.dispose();\n            return callback(data, event);\n        });\n        return sub;\n    }\n}\n//# sourceMappingURL=eventaggregator.js.map","// TODO: see if we can de-duplicate these 3 decorators and their functions without killing performance or readability\nexport function subscriberCollection() {\n    // eslint-disable-next-line @typescript-eslint/ban-types\n    return function (target) {\n        const proto = target.prototype;\n        proto._subscriberFlags = 0 /* None */;\n        proto.addSubscriber = addSubscriber;\n        proto.removeSubscriber = removeSubscriber;\n        proto.hasSubscriber = hasSubscriber;\n        proto.hasSubscribers = hasSubscribers;\n        proto.callSubscribers = callSubscribers;\n        if (proto.subscribe === void 0)\n            proto.subscribe = addSubscriber;\n        if (proto.unsubscribe === void 0)\n            proto.unsubscribe = removeSubscriber;\n    };\n}\nexport function proxySubscriberCollection() {\n    // eslint-disable-next-line @typescript-eslint/ban-types\n    return function (target) {\n        const proto = target.prototype;\n        proto._proxySubscriberFlags = 0 /* None */;\n        proto.addProxySubscriber = addProxySubscriber;\n        proto.removeProxySubscriber = removeProxySubscriber;\n        proto.hasProxySubscriber = hasProxySubscriber;\n        proto.hasProxySubscribers = hasProxySubscribers;\n        proto.callProxySubscribers = callProxySubscribers;\n        if (proto.subscribeToProxy === void 0)\n            proto.subscribeToProxy = addProxySubscriber;\n        if (proto.unsubscribeFromProxy === void 0)\n            proto.unsubscribeFromProxy = removeProxySubscriber;\n    };\n}\nexport function collectionSubscriberCollection() {\n    // eslint-disable-next-line @typescript-eslint/ban-types\n    return function (target) {\n        const proto = target.prototype;\n        proto._collectionSubscriberFlags = 0 /* None */;\n        proto.addCollectionSubscriber = addCollectionSubscriber;\n        proto.removeCollectionSubscriber = removeCollectionSubscriber;\n        proto.hasCollectionSubscriber = hasCollectionSubscriber;\n        proto.hasCollectionSubscribers = hasCollectionSubscribers;\n        proto.callCollectionSubscribers = callCollectionSubscribers;\n        if (proto.subscribeToCollection === void 0)\n            proto.subscribeToCollection = addCollectionSubscriber;\n        if (proto.unsubscribeFromCollection === void 0)\n            proto.unsubscribeFromCollection = removeCollectionSubscriber;\n    };\n}\nfunction addSubscriber(subscriber) {\n    if (this.hasSubscriber(subscriber)) {\n        return false;\n    }\n    const subscriberFlags = this._subscriberFlags;\n    if ((subscriberFlags & 1 /* Subscriber0 */) === 0) {\n        this._subscriber0 = subscriber;\n        this._subscriberFlags |= 1 /* Subscriber0 */;\n    }\n    else if ((subscriberFlags & 2 /* Subscriber1 */) === 0) {\n        this._subscriber1 = subscriber;\n        this._subscriberFlags |= 2 /* Subscriber1 */;\n    }\n    else if ((subscriberFlags & 4 /* Subscriber2 */) === 0) {\n        this._subscriber2 = subscriber;\n        this._subscriberFlags |= 4 /* Subscriber2 */;\n    }\n    else if ((subscriberFlags & 8 /* SubscribersRest */) === 0) {\n        this._subscribersRest = [subscriber];\n        this._subscriberFlags |= 8 /* SubscribersRest */;\n    }\n    else {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        this._subscribersRest.push(subscriber); // Non-null is implied by else branch of (subscriberFlags & SF.SubscribersRest) === 0\n    }\n    return true;\n}\nfunction addProxySubscriber(subscriber) {\n    if (this.hasProxySubscriber(subscriber)) {\n        return false;\n    }\n    const subscriberFlags = this._proxySubscriberFlags;\n    if ((subscriberFlags & 1 /* Subscriber0 */) === 0) {\n        this._proxySubscriber0 = subscriber;\n        this._proxySubscriberFlags |= 1 /* Subscriber0 */;\n    }\n    else if ((subscriberFlags & 2 /* Subscriber1 */) === 0) {\n        this._proxySubscriber1 = subscriber;\n        this._proxySubscriberFlags |= 2 /* Subscriber1 */;\n    }\n    else if ((subscriberFlags & 4 /* Subscriber2 */) === 0) {\n        this._proxySubscriber2 = subscriber;\n        this._proxySubscriberFlags |= 4 /* Subscriber2 */;\n    }\n    else if ((subscriberFlags & 8 /* SubscribersRest */) === 0) {\n        this._proxySubscribersRest = [subscriber];\n        this._proxySubscriberFlags |= 8 /* SubscribersRest */;\n    }\n    else {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        this._proxySubscribersRest.push(subscriber); // Non-null is implied by else branch of (subscriberFlags & SF.SubscribersRest) === 0\n    }\n    return true;\n}\nfunction addCollectionSubscriber(subscriber) {\n    if (this.hasCollectionSubscriber(subscriber)) {\n        return false;\n    }\n    const subscriberFlags = this._collectionSubscriberFlags;\n    if ((subscriberFlags & 1 /* Subscriber0 */) === 0) {\n        this._collectionSubscriber0 = subscriber;\n        this._collectionSubscriberFlags |= 1 /* Subscriber0 */;\n    }\n    else if ((subscriberFlags & 2 /* Subscriber1 */) === 0) {\n        this._collectionSubscriber1 = subscriber;\n        this._collectionSubscriberFlags |= 2 /* Subscriber1 */;\n    }\n    else if ((subscriberFlags & 4 /* Subscriber2 */) === 0) {\n        this._collectionSubscriber2 = subscriber;\n        this._collectionSubscriberFlags |= 4 /* Subscriber2 */;\n    }\n    else if ((subscriberFlags & 8 /* SubscribersRest */) === 0) {\n        this._collectionSubscribersRest = [subscriber];\n        this._collectionSubscriberFlags |= 8 /* SubscribersRest */;\n    }\n    else {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        this._collectionSubscribersRest.push(subscriber); // Non-null is implied by else branch of (subscriberFlags & SF.SubscribersRest) === 0\n    }\n    return true;\n}\nfunction removeSubscriber(subscriber) {\n    const subscriberFlags = this._subscriberFlags;\n    if ((subscriberFlags & 1 /* Subscriber0 */) > 0 && this._subscriber0 === subscriber) {\n        this._subscriber0 = void 0;\n        this._subscriberFlags = (this._subscriberFlags | 1 /* Subscriber0 */) ^ 1 /* Subscriber0 */;\n        return true;\n    }\n    else if ((subscriberFlags & 2 /* Subscriber1 */) > 0 && this._subscriber1 === subscriber) {\n        this._subscriber1 = void 0;\n        this._subscriberFlags = (this._subscriberFlags | 2 /* Subscriber1 */) ^ 2 /* Subscriber1 */;\n        return true;\n    }\n    else if ((subscriberFlags & 4 /* Subscriber2 */) > 0 && this._subscriber2 === subscriber) {\n        this._subscriber2 = void 0;\n        this._subscriberFlags = (this._subscriberFlags | 4 /* Subscriber2 */) ^ 4 /* Subscriber2 */;\n        return true;\n    }\n    else if ((subscriberFlags & 8 /* SubscribersRest */) > 0) {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        const subscribers = this._subscribersRest; // Non-null is implied by (subscriberFlags & SF.SubscribersRest) > 0\n        for (let i = 0, ii = subscribers.length; i < ii; ++i) {\n            if (subscribers[i] === subscriber) {\n                subscribers.splice(i, 1);\n                if (ii === 1) {\n                    this._subscriberFlags = (this._subscriberFlags | 8 /* SubscribersRest */) ^ 8 /* SubscribersRest */;\n                }\n                return true;\n            }\n        }\n    }\n    return false;\n}\nfunction removeProxySubscriber(subscriber) {\n    const subscriberFlags = this._proxySubscriberFlags;\n    if ((subscriberFlags & 1 /* Subscriber0 */) > 0 && this._proxySubscriber0 === subscriber) {\n        this._proxySubscriber0 = void 0;\n        this._proxySubscriberFlags = (this._proxySubscriberFlags | 1 /* Subscriber0 */) ^ 1 /* Subscriber0 */;\n        return true;\n    }\n    else if ((subscriberFlags & 2 /* Subscriber1 */) > 0 && this._proxySubscriber1 === subscriber) {\n        this._proxySubscriber1 = void 0;\n        this._proxySubscriberFlags = (this._proxySubscriberFlags | 2 /* Subscriber1 */) ^ 2 /* Subscriber1 */;\n        return true;\n    }\n    else if ((subscriberFlags & 4 /* Subscriber2 */) > 0 && this._proxySubscriber2 === subscriber) {\n        this._proxySubscriber2 = void 0;\n        this._proxySubscriberFlags = (this._proxySubscriberFlags | 4 /* Subscriber2 */) ^ 4 /* Subscriber2 */;\n        return true;\n    }\n    else if ((subscriberFlags & 8 /* SubscribersRest */) > 0) {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        const subscribers = this._proxySubscribersRest; // Non-null is implied by (subscriberFlags & SF.SubscribersRest) > 0\n        for (let i = 0, ii = subscribers.length; i < ii; ++i) {\n            if (subscribers[i] === subscriber) {\n                subscribers.splice(i, 1);\n                if (ii === 1) {\n                    this._proxySubscriberFlags = (this._proxySubscriberFlags | 8 /* SubscribersRest */) ^ 8 /* SubscribersRest */;\n                }\n                return true;\n            }\n        }\n    }\n    return false;\n}\nfunction removeCollectionSubscriber(subscriber) {\n    const subscriberFlags = this._collectionSubscriberFlags;\n    if ((subscriberFlags & 1 /* Subscriber0 */) > 0 && this._collectionSubscriber0 === subscriber) {\n        this._collectionSubscriber0 = void 0;\n        this._collectionSubscriberFlags = (this._collectionSubscriberFlags | 1 /* Subscriber0 */) ^ 1 /* Subscriber0 */;\n        return true;\n    }\n    else if ((subscriberFlags & 2 /* Subscriber1 */) > 0 && this._collectionSubscriber1 === subscriber) {\n        this._collectionSubscriber1 = void 0;\n        this._collectionSubscriberFlags = (this._collectionSubscriberFlags | 2 /* Subscriber1 */) ^ 2 /* Subscriber1 */;\n        return true;\n    }\n    else if ((subscriberFlags & 4 /* Subscriber2 */) > 0 && this._collectionSubscriber2 === subscriber) {\n        this._collectionSubscriber2 = void 0;\n        this._collectionSubscriberFlags = (this._collectionSubscriberFlags | 4 /* Subscriber2 */) ^ 4 /* Subscriber2 */;\n        return true;\n    }\n    else if ((subscriberFlags & 8 /* SubscribersRest */) > 0) {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        const subscribers = this._collectionSubscribersRest; // Non-null is implied by (subscriberFlags & SF.SubscribersRest) > 0\n        for (let i = 0, ii = subscribers.length; i < ii; ++i) {\n            if (subscribers[i] === subscriber) {\n                subscribers.splice(i, 1);\n                if (ii === 1) {\n                    this._collectionSubscriberFlags = (this._collectionSubscriberFlags | 8 /* SubscribersRest */) ^ 8 /* SubscribersRest */;\n                }\n                return true;\n            }\n        }\n    }\n    return false;\n}\nfunction hasSubscribers() {\n    return this._subscriberFlags !== 0 /* None */;\n}\nfunction hasProxySubscribers() {\n    return this._proxySubscriberFlags !== 0 /* None */;\n}\nfunction hasCollectionSubscribers() {\n    return this._collectionSubscriberFlags !== 0 /* None */;\n}\nfunction hasSubscriber(subscriber) {\n    // Flags here is just a perf tweak\n    // Compared to not using flags, it's a moderate speed-up when this collection does not have the subscriber;\n    // and minor slow-down when it does, and the former is more common than the latter.\n    const subscriberFlags = this._subscriberFlags;\n    if ((subscriberFlags & 1 /* Subscriber0 */) > 0 && this._subscriber0 === subscriber) {\n        return true;\n    }\n    if ((subscriberFlags & 2 /* Subscriber1 */) > 0 && this._subscriber1 === subscriber) {\n        return true;\n    }\n    if ((subscriberFlags & 4 /* Subscriber2 */) > 0 && this._subscriber2 === subscriber) {\n        return true;\n    }\n    if ((subscriberFlags & 8 /* SubscribersRest */) > 0) {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        const subscribers = this._subscribersRest; // Non-null is implied by (subscriberFlags & SF.SubscribersRest) > 0\n        for (let i = 0, ii = subscribers.length; i < ii; ++i) {\n            if (subscribers[i] === subscriber) {\n                return true;\n            }\n        }\n    }\n    return false;\n}\nfunction hasProxySubscriber(subscriber) {\n    const subscriberFlags = this._proxySubscriberFlags;\n    if ((subscriberFlags & 1 /* Subscriber0 */) > 0 && this._proxySubscriber0 === subscriber) {\n        return true;\n    }\n    if ((subscriberFlags & 2 /* Subscriber1 */) > 0 && this._proxySubscriber1 === subscriber) {\n        return true;\n    }\n    if ((subscriberFlags & 4 /* Subscriber2 */) > 0 && this._proxySubscriber2 === subscriber) {\n        return true;\n    }\n    if ((subscriberFlags & 8 /* SubscribersRest */) > 0) {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        const subscribers = this._proxySubscribersRest; // Non-null is implied by (subscriberFlags & SF.SubscribersRest) > 0\n        for (let i = 0, ii = subscribers.length; i < ii; ++i) {\n            if (subscribers[i] === subscriber) {\n                return true;\n            }\n        }\n    }\n    return false;\n}\nfunction hasCollectionSubscriber(subscriber) {\n    const subscriberFlags = this._collectionSubscriberFlags;\n    if ((subscriberFlags & 1 /* Subscriber0 */) > 0 && this._collectionSubscriber0 === subscriber) {\n        return true;\n    }\n    if ((subscriberFlags & 2 /* Subscriber1 */) > 0 && this._collectionSubscriber1 === subscriber) {\n        return true;\n    }\n    if ((subscriberFlags & 4 /* Subscriber2 */) > 0 && this._collectionSubscriber2 === subscriber) {\n        return true;\n    }\n    if ((subscriberFlags & 8 /* SubscribersRest */) > 0) {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        const subscribers = this._collectionSubscribersRest; // Non-null is implied by (subscriberFlags & SF.SubscribersRest) > 0\n        for (let i = 0, ii = subscribers.length; i < ii; ++i) {\n            if (subscribers[i] === subscriber) {\n                return true;\n            }\n        }\n    }\n    return false;\n}\nfunction callSubscribers(newValue, previousValue, flags) {\n    /**\n     * Note: change handlers may have the side-effect of adding/removing subscribers to this collection during this\n     * callSubscribers invocation, so we're caching them all before invoking any.\n     * Subscribers added during this invocation are not invoked (and they shouldn't be).\n     * Subscribers removed during this invocation will still be invoked (and they also shouldn't be,\n     * however this is accounted for via $isBound and similar flags on the subscriber objects)\n     */\n    const subscriber0 = this._subscriber0;\n    const subscriber1 = this._subscriber1;\n    const subscriber2 = this._subscriber2;\n    let subscribers = this._subscribersRest;\n    if (subscribers !== void 0) {\n        subscribers = subscribers.slice();\n    }\n    if (subscriber0 !== void 0) {\n        callSubscriber(subscriber0, newValue, previousValue, flags, subscriber0.id === void 0 ? 0 : this[subscriber0.id]);\n    }\n    if (subscriber1 !== void 0) {\n        callSubscriber(subscriber1, newValue, previousValue, flags, subscriber1.id === void 0 ? 0 : this[subscriber1.id]);\n    }\n    if (subscriber2 !== void 0) {\n        callSubscriber(subscriber2, newValue, previousValue, flags, subscriber2.id === void 0 ? 0 : this[subscriber2.id]);\n    }\n    if (subscribers !== void 0) {\n        const { length } = subscribers;\n        let subscriber;\n        for (let i = 0; i < length; ++i) {\n            subscriber = subscribers[i];\n            if (subscriber !== void 0) {\n                callSubscriber(subscriber, newValue, previousValue, flags, subscriber.id === void 0 ? 0 : this[subscriber.id]);\n            }\n        }\n    }\n}\nfunction callSubscriber(subscriber, newValue, previousValue, flags, ownFlags) {\n    subscriber.handleChange(newValue, previousValue, ((flags | 48 /* update */) ^ 48 /* update */) | ownFlags);\n}\nfunction callProxySubscribers(key, newValue, previousValue, flags) {\n    const subscriber0 = this._proxySubscriber0;\n    const subscriber1 = this._proxySubscriber1;\n    const subscriber2 = this._proxySubscriber2;\n    let subscribers = this._proxySubscribersRest;\n    if (subscribers !== void 0) {\n        subscribers = subscribers.slice();\n    }\n    if (subscriber0 !== void 0) {\n        subscriber0.handleProxyChange(key, newValue, previousValue, flags);\n    }\n    if (subscriber1 !== void 0) {\n        subscriber1.handleProxyChange(key, newValue, previousValue, flags);\n    }\n    if (subscriber2 !== void 0) {\n        subscriber2.handleProxyChange(key, newValue, previousValue, flags);\n    }\n    if (subscribers !== void 0) {\n        const { length } = subscribers;\n        let subscriber;\n        for (let i = 0; i < length; ++i) {\n            subscriber = subscribers[i];\n            if (subscriber !== void 0) {\n                subscriber.handleProxyChange(key, newValue, previousValue, flags);\n            }\n        }\n    }\n}\nfunction callCollectionSubscribers(indexMap, flags) {\n    const subscriber0 = this._collectionSubscriber0;\n    const subscriber1 = this._collectionSubscriber1;\n    const subscriber2 = this._collectionSubscriber2;\n    let subscribers = this._collectionSubscribersRest;\n    if (subscribers !== void 0) {\n        subscribers = subscribers.slice();\n    }\n    if (subscriber0 !== void 0) {\n        subscriber0.handleCollectionChange(indexMap, flags);\n    }\n    if (subscriber1 !== void 0) {\n        subscriber1.handleCollectionChange(indexMap, flags);\n    }\n    if (subscriber2 !== void 0) {\n        subscriber2.handleCollectionChange(indexMap, flags);\n    }\n    if (subscribers !== void 0) {\n        const { length } = subscribers;\n        let subscriber;\n        for (let i = 0; i < length; ++i) {\n            subscriber = subscribers[i];\n            if (subscriber !== void 0) {\n                subscriber.handleCollectionChange(indexMap, flags);\n            }\n        }\n    }\n}\n//# sourceMappingURL=subscriber-collection.js.map","var ProxyObserver_1;\nimport { __decorate, __metadata } from \"tslib\";\nimport { PLATFORM } from '@aurelia/kernel';\nimport { proxySubscriberCollection, subscriberCollection } from './subscriber-collection';\nconst lookup = new WeakMap();\nlet ProxySubscriberCollection = class ProxySubscriberCollection {\n    constructor(proxy, raw, key) {\n        this.proxy = proxy;\n        this.raw = raw;\n        this.key = key;\n        this.inBatch = false;\n        this.subscribe = this.addSubscriber;\n        this.unsubscribe = this.removeSubscriber;\n        if (raw[key] instanceof Object) { // Ensure we observe array indices and newly created object properties\n            raw[key] = ProxyObserver.getOrCreate(raw[key]).proxy;\n        }\n    }\n    setValue(value, flags) {\n        const oldValue = this.raw[this.key];\n        if (oldValue !== value) {\n            this.raw[this.key] = value;\n            this.callSubscribers(value, oldValue, flags | 2 /* proxyStrategy */ | 16 /* updateTargetInstance */);\n        }\n    }\n    getValue() {\n        return this.raw[this.key];\n    }\n    flushBatch(flags) {\n        return;\n    }\n};\nProxySubscriberCollection = __decorate([\n    subscriberCollection(),\n    __metadata(\"design:paramtypes\", [Object, Object, Object])\n], ProxySubscriberCollection);\nexport { ProxySubscriberCollection };\nlet ProxyObserver = ProxyObserver_1 = class ProxyObserver {\n    constructor(obj) {\n        this.raw = obj;\n        this.proxy = new Proxy(obj, this);\n        lookup.set(obj, this.proxy);\n        this.subscribers = {};\n    }\n    static getProxyOrSelf(obj) {\n        if (obj.$raw === void 0) {\n            const proxy = lookup.get(obj);\n            if (proxy === void 0) {\n                return obj;\n            }\n            return proxy;\n        }\n        return obj;\n    }\n    static getRawIfProxy(obj) {\n        const raw = obj.$raw;\n        if (raw === void 0) {\n            return obj;\n        }\n        return raw;\n    }\n    static getOrCreate(obj, key) {\n        let proxyObserver;\n        if (obj.$raw === void 0) {\n            const proxy = lookup.get(obj);\n            if (proxy === void 0) {\n                proxyObserver = new ProxyObserver_1(obj);\n            }\n            else {\n                proxyObserver = proxy.$observer;\n            }\n        }\n        else {\n            proxyObserver = obj.$observer;\n        }\n        if (key === void 0) {\n            return proxyObserver;\n        }\n        let subscribers = proxyObserver.subscribers[key];\n        if (subscribers === void 0) {\n            const raw = this.getRawIfProxy(obj);\n            const proxy = proxyObserver.proxy;\n            subscribers = proxyObserver.subscribers[key] = new ProxySubscriberCollection(proxy, raw, key);\n        }\n        return subscribers;\n    }\n    static isProxy(obj) {\n        return obj.$raw !== void 0;\n    }\n    get(target, p, receiver) {\n        if (p === '$observer') {\n            return this;\n        }\n        if (p === '$raw') {\n            return target;\n        }\n        return target[p];\n    }\n    set(target, p, value, receiver) {\n        const oldValue = target[p];\n        if (oldValue !== value) {\n            target[p] = value;\n            this.callPropertySubscribers(value, oldValue, p);\n            this.callProxySubscribers(p, value, oldValue, 2 /* proxyStrategy */ | 16 /* updateTargetInstance */);\n        }\n        return true;\n    }\n    deleteProperty(target, p) {\n        const oldValue = target[p];\n        if (Reflect.deleteProperty(target, p)) {\n            if (oldValue !== void 0) {\n                this.callPropertySubscribers(undefined, oldValue, p);\n                this.callProxySubscribers(p, undefined, oldValue, 2 /* proxyStrategy */ | 16 /* updateTargetInstance */);\n            }\n            return true;\n        }\n        return false;\n    }\n    defineProperty(target, p, attributes) {\n        const oldValue = target[p];\n        if (Reflect.defineProperty(target, p, attributes)) {\n            if (attributes.value !== oldValue) {\n                this.callPropertySubscribers(attributes.value, oldValue, p);\n                this.callProxySubscribers(p, attributes.value, oldValue, 2 /* proxyStrategy */ | 16 /* updateTargetInstance */);\n            }\n            return true;\n        }\n        return false;\n    }\n    apply(target, thisArg, argArray = PLATFORM.emptyArray) {\n        // eslint-disable-next-line @typescript-eslint/ban-types\n        return Reflect.apply(target, target, argArray); // Reflect API dictates this\n    }\n    subscribe(subscriber, key) {\n        if (key === void 0) {\n            this.addProxySubscriber(subscriber);\n        }\n        else {\n            let subscribers = this.subscribers[key];\n            if (subscribers === void 0) {\n                subscribers = this.subscribers[key] = new ProxySubscriberCollection(this.proxy, this.raw, key);\n            }\n            subscribers.addSubscriber(subscriber);\n        }\n    }\n    unsubscribe(subscriber, key) {\n        if (key === void 0) {\n            this.removeProxySubscriber(subscriber);\n        }\n        else {\n            const subscribers = this.subscribers[key];\n            if (subscribers !== undefined) {\n                subscribers.removeSubscriber(subscriber);\n            }\n        }\n    }\n    callPropertySubscribers(newValue, oldValue, key) {\n        const subscribers = this.subscribers[key];\n        if (subscribers !== void 0) {\n            subscribers.callSubscribers(newValue, oldValue, 2 /* proxyStrategy */ | 16 /* updateTargetInstance */);\n        }\n    }\n};\nProxyObserver = ProxyObserver_1 = __decorate([\n    proxySubscriberCollection(),\n    __metadata(\"design:paramtypes\", [Object])\n], ProxyObserver);\nexport { ProxyObserver };\n//# sourceMappingURL=proxy-observer.js.map","import { __decorate, __metadata, __param } from \"tslib\";\nimport { DI, Registration, } from '@aurelia/kernel';\nexport var ViewModelKind;\n(function (ViewModelKind) {\n    ViewModelKind[ViewModelKind[\"customElement\"] = 0] = \"customElement\";\n    ViewModelKind[ViewModelKind[\"customAttribute\"] = 1] = \"customAttribute\";\n    ViewModelKind[ViewModelKind[\"synthetic\"] = 2] = \"synthetic\";\n})(ViewModelKind || (ViewModelKind = {}));\nexport const IController = DI.createInterface('IController').noDefault();\n/**\n * Describing characteristics of a mounting operation a controller will perform\n */\nexport var MountStrategy;\n(function (MountStrategy) {\n    MountStrategy[MountStrategy[\"insertBefore\"] = 1] = \"insertBefore\";\n    MountStrategy[MountStrategy[\"append\"] = 2] = \"append\";\n})(MountStrategy || (MountStrategy = {}));\nexport const IViewFactory = DI.createInterface('IViewFactory').noDefault();\nexport const ILifecycle = DI.createInterface('ILifecycle').withDefault(x => x.singleton(Lifecycle));\nlet BoundQueue = class BoundQueue {\n    constructor(lifecycle) {\n        this.lifecycle = lifecycle;\n        this.depth = 0;\n        this.head = void 0;\n        this.tail = void 0;\n    }\n    begin() {\n        ++this.depth;\n    }\n    end(flags) {\n        if (flags === void 0) {\n            flags = 0 /* none */;\n        }\n        if (--this.depth === 0) {\n            this.process(flags);\n        }\n    }\n    inline(fn, flags) {\n        this.begin();\n        fn();\n        this.end(flags);\n    }\n    add(controller) {\n        if (this.head === void 0) {\n            this.head = controller;\n        }\n        else {\n            controller.prevBound = this.tail;\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            this.tail.nextBound = controller; // implied by boundHead not being undefined\n        }\n        this.tail = controller;\n    }\n    remove(controller) {\n        if (controller.prevBound !== void 0) {\n            controller.prevBound.nextBound = controller.nextBound;\n        }\n        if (controller.nextBound !== void 0) {\n            controller.nextBound.prevBound = controller.prevBound;\n        }\n        controller.prevBound = void 0;\n        controller.nextBound = void 0;\n        if (this.tail === controller) {\n            this.tail = controller.prevBound;\n        }\n        if (this.head === controller) {\n            this.head = controller.nextBound;\n        }\n    }\n    process(flags) {\n        while (this.head !== void 0) {\n            let cur = this.head;\n            this.head = this.tail = void 0;\n            let next;\n            do {\n                cur.afterBind(flags);\n                next = cur.nextBound;\n                cur.nextBound = void 0;\n                cur.prevBound = void 0;\n                // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n                cur = next; // we're checking it for undefined the next line\n            } while (cur !== void 0);\n        }\n    }\n};\nBoundQueue = __decorate([\n    __param(0, ILifecycle),\n    __metadata(\"design:paramtypes\", [Object])\n], BoundQueue);\nexport { BoundQueue };\nlet UnboundQueue = class UnboundQueue {\n    constructor(lifecycle) {\n        this.lifecycle = lifecycle;\n        this.depth = 0;\n        this.head = void 0;\n        this.tail = void 0;\n    }\n    begin() {\n        ++this.depth;\n    }\n    end(flags) {\n        if (flags === void 0) {\n            flags = 0 /* none */;\n        }\n        if (--this.depth === 0) {\n            this.process(flags);\n        }\n    }\n    inline(fn, flags) {\n        this.begin();\n        fn();\n        this.end(flags);\n    }\n    add(controller) {\n        if (this.head === void 0) {\n            this.head = controller;\n        }\n        else {\n            controller.prevUnbound = this.tail;\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            this.tail.nextUnbound = controller; // implied by unboundHead not being undefined\n        }\n        this.tail = controller;\n    }\n    remove(controller) {\n        if (controller.prevUnbound !== void 0) {\n            controller.prevUnbound.nextUnbound = controller.nextUnbound;\n        }\n        if (controller.nextUnbound !== void 0) {\n            controller.nextUnbound.prevUnbound = controller.prevUnbound;\n        }\n        controller.prevUnbound = void 0;\n        controller.nextUnbound = void 0;\n        if (this.tail === controller) {\n            this.tail = controller.prevUnbound;\n        }\n        if (this.head === controller) {\n            this.head = controller.nextUnbound;\n        }\n    }\n    process(flags) {\n        while (this.head !== void 0) {\n            let cur = this.head;\n            this.head = this.tail = void 0;\n            let next;\n            do {\n                cur.afterUnbind(flags);\n                next = cur.nextUnbound;\n                cur.nextUnbound = void 0;\n                cur.prevUnbound = void 0;\n                // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n                cur = next; // we're checking it for undefined the next line\n            } while (cur !== void 0);\n        }\n    }\n};\nUnboundQueue = __decorate([\n    __param(0, ILifecycle),\n    __metadata(\"design:paramtypes\", [Object])\n], UnboundQueue);\nexport { UnboundQueue };\nlet AttachedQueue = class AttachedQueue {\n    constructor(lifecycle) {\n        this.lifecycle = lifecycle;\n        this.depth = 0;\n        this.head = void 0;\n        this.tail = void 0;\n    }\n    begin() {\n        ++this.depth;\n    }\n    end(flags) {\n        if (flags === void 0) {\n            flags = 0 /* none */;\n        }\n        if (--this.depth === 0) {\n            // temporary, until everything else works and we're ready for integrating mount/unmount in the RAF queue\n            this.lifecycle.mount.process(flags);\n            this.process(flags);\n        }\n    }\n    inline(fn, flags) {\n        this.begin();\n        fn();\n        this.end(flags);\n    }\n    add(controller) {\n        if (this.head === void 0) {\n            this.head = controller;\n        }\n        else {\n            controller.prevAttached = this.tail;\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            this.tail.nextAttached = controller; // implied by attachedHead not being undefined\n        }\n        this.tail = controller;\n    }\n    remove(controller) {\n        if (controller.prevAttached !== void 0) {\n            controller.prevAttached.nextAttached = controller.nextAttached;\n        }\n        if (controller.nextAttached !== void 0) {\n            controller.nextAttached.prevAttached = controller.prevAttached;\n        }\n        controller.prevAttached = void 0;\n        controller.nextAttached = void 0;\n        if (this.tail === controller) {\n            this.tail = controller.prevAttached;\n        }\n        if (this.head === controller) {\n            this.head = controller.nextAttached;\n        }\n    }\n    process(flags) {\n        while (this.head !== void 0) {\n            let cur = this.head;\n            this.head = this.tail = void 0;\n            let next;\n            do {\n                cur.afterAttach(flags);\n                next = cur.nextAttached;\n                cur.nextAttached = void 0;\n                cur.prevAttached = void 0;\n                // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n                cur = next; // we're checking it for undefined the next line\n            } while (cur !== void 0);\n        }\n    }\n};\nAttachedQueue = __decorate([\n    __param(0, ILifecycle),\n    __metadata(\"design:paramtypes\", [Object])\n], AttachedQueue);\nexport { AttachedQueue };\nlet DetachedQueue = class DetachedQueue {\n    constructor(lifecycle) {\n        this.lifecycle = lifecycle;\n        this.depth = 0;\n        this.head = void 0;\n        this.tail = void 0;\n    }\n    begin() {\n        ++this.depth;\n    }\n    end(flags) {\n        if (flags === void 0) {\n            flags = 0 /* none */;\n        }\n        if (--this.depth === 0) {\n            // temporary, until everything else works and we're ready for integrating mount/unmount in the RAF queue\n            this.lifecycle.unmount.process(flags);\n            this.process(flags);\n        }\n    }\n    inline(fn, flags) {\n        this.begin();\n        fn();\n        this.end(flags);\n    }\n    add(controller) {\n        if (this.head === void 0) {\n            this.head = controller;\n        }\n        else {\n            controller.prevDetached = this.tail;\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            this.tail.nextDetached = controller; // implied by detachedHead not being undefined\n        }\n        this.tail = controller;\n    }\n    remove(controller) {\n        if (controller.prevDetached !== void 0) {\n            controller.prevDetached.nextDetached = controller.nextDetached;\n        }\n        if (controller.nextDetached !== void 0) {\n            controller.nextDetached.prevDetached = controller.prevDetached;\n        }\n        controller.prevDetached = void 0;\n        controller.nextDetached = void 0;\n        if (this.tail === controller) {\n            this.tail = controller.prevDetached;\n        }\n        if (this.head === controller) {\n            this.head = controller.nextDetached;\n        }\n    }\n    process(flags) {\n        while (this.head !== void 0) {\n            let cur = this.head;\n            this.head = this.tail = void 0;\n            let next;\n            do {\n                cur.afterDetach(flags);\n                next = cur.nextDetached;\n                cur.nextDetached = void 0;\n                cur.prevDetached = void 0;\n                // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n                cur = next; // we're checking it for undefined the next line\n            } while (cur !== void 0);\n        }\n    }\n};\nDetachedQueue = __decorate([\n    __param(0, ILifecycle),\n    __metadata(\"design:paramtypes\", [Object])\n], DetachedQueue);\nexport { DetachedQueue };\nlet MountQueue = class MountQueue {\n    constructor(lifecycle) {\n        this.lifecycle = lifecycle;\n        this.depth = 0;\n        this.head = void 0;\n        this.tail = void 0;\n    }\n    add(controller) {\n        if (this.head === void 0) {\n            this.head = controller;\n        }\n        else {\n            controller.prevMount = this.tail;\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            this.tail.nextMount = controller; // implied by mountHead not being undefined\n        }\n        this.tail = controller;\n    }\n    remove(controller) {\n        if (controller.prevMount !== void 0) {\n            controller.prevMount.nextMount = controller.nextMount;\n        }\n        if (controller.nextMount !== void 0) {\n            controller.nextMount.prevMount = controller.prevMount;\n        }\n        controller.prevMount = void 0;\n        controller.nextMount = void 0;\n        if (this.tail === controller) {\n            this.tail = controller.prevMount;\n        }\n        if (this.head === controller) {\n            this.head = controller.nextMount;\n        }\n    }\n    process(flags) {\n        let i = 0;\n        while (this.head !== void 0) {\n            let cur = this.head;\n            this.head = this.tail = void 0;\n            let next;\n            do {\n                ++i;\n                cur.mount(flags);\n                next = cur.nextMount;\n                cur.nextMount = void 0;\n                cur.prevMount = void 0;\n                // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n                cur = next; // we're checking it for undefined the next line\n            } while (cur !== void 0);\n        }\n    }\n};\nMountQueue = __decorate([\n    __param(0, ILifecycle),\n    __metadata(\"design:paramtypes\", [Object])\n], MountQueue);\nexport { MountQueue };\nlet UnmountQueue = class UnmountQueue {\n    constructor(lifecycle) {\n        this.lifecycle = lifecycle;\n        this.head = void 0;\n        this.tail = void 0;\n    }\n    add(controller) {\n        if (this.head === void 0) {\n            this.head = controller;\n        }\n        else {\n            controller.prevUnmount = this.tail;\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            this.tail.nextUnmount = controller; // implied by unmountHead not being undefined\n        }\n        this.tail = controller;\n    }\n    remove(controller) {\n        if (controller.prevUnmount !== void 0) {\n            controller.prevUnmount.nextUnmount = controller.nextUnmount;\n        }\n        if (controller.nextUnmount !== void 0) {\n            controller.nextUnmount.prevUnmount = controller.prevUnmount;\n        }\n        controller.prevUnmount = void 0;\n        controller.nextUnmount = void 0;\n        if (this.tail === controller) {\n            this.tail = controller.prevUnmount;\n        }\n        if (this.head === controller) {\n            this.head = controller.nextUnmount;\n        }\n    }\n    process(flags) {\n        let i = 0;\n        while (this.head !== void 0) {\n            let cur = this.head;\n            this.head = this.tail = void 0;\n            let next;\n            do {\n                ++i;\n                cur.unmount(flags);\n                next = cur.nextUnmount;\n                cur.nextUnmount = void 0;\n                cur.prevUnmount = void 0;\n                // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n                cur = next; // we're checking it for undefined the next line\n            } while (cur !== void 0);\n        }\n    }\n};\nUnmountQueue = __decorate([\n    __param(0, ILifecycle),\n    __metadata(\"design:paramtypes\", [Object])\n], UnmountQueue);\nexport { UnmountQueue };\nlet BatchQueue = class BatchQueue {\n    constructor(lifecycle) {\n        this.lifecycle = lifecycle;\n        this.queue = [];\n        this.depth = 0;\n    }\n    begin() {\n        ++this.depth;\n    }\n    end(flags) {\n        if (flags === void 0) {\n            flags = 0 /* none */;\n        }\n        if (--this.depth === 0) {\n            this.process(flags);\n        }\n    }\n    inline(fn, flags) {\n        this.begin();\n        fn();\n        this.end(flags);\n    }\n    add(requestor) {\n        this.queue.push(requestor);\n    }\n    remove(requestor) {\n        const index = this.queue.indexOf(requestor);\n        if (index > -1) {\n            this.queue.splice(index, 1);\n        }\n    }\n    process(flags) {\n        flags |= 512 /* fromBatch */;\n        while (this.queue.length > 0) {\n            const batch = this.queue.slice();\n            this.queue = [];\n            const { length } = batch;\n            for (let i = 0; i < length; ++i) {\n                batch[i].flushBatch(flags);\n            }\n        }\n    }\n};\nBatchQueue = __decorate([\n    __param(0, ILifecycle),\n    __metadata(\"design:paramtypes\", [Object])\n], BatchQueue);\nexport { BatchQueue };\nexport class Lifecycle {\n    constructor() {\n        this.batch = new BatchQueue(this);\n        this.mount = new MountQueue(this);\n        this.unmount = new UnmountQueue(this);\n        this.afterBind = new BoundQueue(this);\n        this.afterUnbind = new UnboundQueue(this);\n        this.afterAttach = new AttachedQueue(this);\n        this.afterDetach = new DetachedQueue(this);\n    }\n    static register(container) {\n        return Registration.singleton(ILifecycle, this).register(container);\n    }\n}\n//# sourceMappingURL=lifecycle.js.map","import { __decorate, __metadata } from \"tslib\";\nimport { Reporter } from '@aurelia/kernel';\nimport { ILifecycle } from '../lifecycle';\nimport { subscriberCollection } from './subscriber-collection';\n/**\n * Observer for the mutation of object property value employing getter-setter strategy.\n * This is used for observing object properties that has no decorator.\n */\nlet SetterObserver = class SetterObserver {\n    constructor(lifecycle, flags, obj, propertyKey) {\n        this.lifecycle = lifecycle;\n        this.obj = obj;\n        this.propertyKey = propertyKey;\n        this.currentValue = void 0;\n        this.oldValue = void 0;\n        this.inBatch = false;\n        this.observing = false;\n        this.persistentFlags = flags & 2080374799 /* persistentBindingFlags */;\n    }\n    getValue() {\n        return this.currentValue;\n    }\n    setValue(newValue, flags) {\n        if (this.observing) {\n            const currentValue = this.currentValue;\n            this.currentValue = newValue;\n            if (this.lifecycle.batch.depth === 0) {\n                this.callSubscribers(newValue, currentValue, this.persistentFlags | flags);\n            }\n            else if (!this.inBatch) {\n                this.inBatch = true;\n                this.oldValue = currentValue;\n                this.lifecycle.batch.add(this);\n            }\n        }\n        else {\n            // If subscribe() has been called, the target property descriptor is replaced by these getter/setter methods,\n            // so calling obj[propertyKey] will actually return this.currentValue.\n            // However, if subscribe() was not yet called (indicated by !this.observing), the target descriptor\n            // is unmodified and we need to explicitly set the property value.\n            // This will happen in one-time, to-view and two-way bindings during $bind, meaning that the $bind will not actually update the target value.\n            // This wasn't visible in vCurrent due to connect-queue always doing a delayed update, so in many cases it didn't matter whether $bind updated the target or not.\n            this.obj[this.propertyKey] = newValue;\n        }\n    }\n    flushBatch(flags) {\n        this.inBatch = false;\n        const currentValue = this.currentValue;\n        const oldValue = this.oldValue;\n        this.oldValue = currentValue;\n        this.callSubscribers(currentValue, oldValue, this.persistentFlags | flags);\n    }\n    subscribe(subscriber) {\n        if (this.observing === false) {\n            this.observing = true;\n            this.currentValue = this.obj[this.propertyKey];\n            if (!Reflect.defineProperty(this.obj, this.propertyKey, {\n                enumerable: true,\n                configurable: true,\n                get: () => {\n                    return this.getValue();\n                },\n                set: value => {\n                    this.setValue(value, 0 /* none */);\n                },\n            })) {\n                Reporter.write(1, this.propertyKey, this.obj);\n            }\n        }\n        this.addSubscriber(subscriber);\n    }\n};\nSetterObserver = __decorate([\n    subscriberCollection(),\n    __metadata(\"design:paramtypes\", [Object, Number, Object, String])\n], SetterObserver);\nexport { SetterObserver };\n//# sourceMappingURL=setter-observer.js.map","import { PLATFORM, Reporter } from '@aurelia/kernel';\nimport { ProxyObserver } from './proxy-observer';\nimport { SetterObserver } from './setter-observer';\nvar RuntimeError;\n(function (RuntimeError) {\n    RuntimeError[RuntimeError[\"NilScope\"] = 250] = \"NilScope\";\n    RuntimeError[RuntimeError[\"NilOverrideContext\"] = 252] = \"NilOverrideContext\";\n    RuntimeError[RuntimeError[\"NilParentScope\"] = 253] = \"NilParentScope\";\n})(RuntimeError || (RuntimeError = {}));\nconst marker = Object.freeze({});\n/** @internal */\nexport class InternalObserversLookup {\n    getOrCreate(lifecycle, flags, obj, key) {\n        if (this[key] === void 0) {\n            this[key] = new SetterObserver(lifecycle, flags, obj, key);\n        }\n        return this[key];\n    }\n}\nexport class BindingContext {\n    constructor(keyOrObj, value) {\n        this.$synthetic = true;\n        if (keyOrObj !== void 0) {\n            if (value !== void 0) {\n                // if value is defined then it's just a property and a value to initialize with\n                this[keyOrObj] = value;\n            }\n            else {\n                // can either be some random object or another bindingContext to clone from\n                for (const prop in keyOrObj) {\n                    if (Object.prototype.hasOwnProperty.call(keyOrObj, prop)) {\n                        this[prop] = keyOrObj[prop];\n                    }\n                }\n            }\n        }\n    }\n    static create(flags, keyOrObj, value) {\n        const bc = new BindingContext(keyOrObj, value);\n        if (flags & 2 /* proxyStrategy */) {\n            return ProxyObserver.getOrCreate(bc).proxy;\n        }\n        return bc;\n    }\n    static get(scope, name, ancestor, flags, part) {\n        if (scope == null) {\n            throw Reporter.error(250 /* NilScope */);\n        }\n        let overrideContext = scope.overrideContext;\n        if (ancestor > 0) {\n            // jump up the required number of ancestor contexts (eg $parent.$parent requires two jumps)\n            while (ancestor > 0) {\n                if (overrideContext.parentOverrideContext == null) {\n                    return void 0;\n                }\n                ancestor--;\n                overrideContext = overrideContext.parentOverrideContext;\n            }\n            return name in overrideContext ? overrideContext : overrideContext.bindingContext;\n        }\n        // traverse the context and it's ancestors, searching for a context that has the name.\n        while (overrideContext && !(name in overrideContext) && !(overrideContext.bindingContext && name in overrideContext.bindingContext)) {\n            overrideContext = overrideContext.parentOverrideContext;\n        }\n        if (overrideContext) {\n            // we located a context with the property.  return it.\n            return name in overrideContext ? overrideContext : overrideContext.bindingContext;\n        }\n        // the name wasn't found. see if parent scope traversal is allowed and if so, try that\n        if ((flags & 67108864 /* allowParentScopeTraversal */) > 0) {\n            let parent = scope.parentScope;\n            while (parent !== null) {\n                if (parent.scopeParts.includes(part)) {\n                    const result = this.get(parent, name, ancestor, flags\n                        // unset the flag; only allow one level of scope boundary traversal\n                        & ~67108864 /* allowParentScopeTraversal */\n                        // tell the scope to return null if the name could not be found\n                        | 4194304 /* isTraversingParentScope */);\n                    if (result === marker) {\n                        return scope.bindingContext || scope.overrideContext;\n                    }\n                    else {\n                        return result;\n                    }\n                }\n                else {\n                    parent = parent.parentScope;\n                }\n            }\n            if (parent === null) {\n                throw new Error(`No target scope could be found for part \"${part}\"`);\n            }\n        }\n        // still nothing found. return the root binding context (or null\n        // if this is a parent scope traversal, to ensure we fall back to the\n        // correct level)\n        if (flags & 4194304 /* isTraversingParentScope */) {\n            return marker;\n        }\n        return scope.bindingContext || scope.overrideContext;\n    }\n    getObservers(flags) {\n        if (this.$observers == null) {\n            this.$observers = new InternalObserversLookup();\n        }\n        return this.$observers;\n    }\n}\nexport class Scope {\n    constructor(parentScope, bindingContext, overrideContext) {\n        this.parentScope = parentScope;\n        this.scopeParts = PLATFORM.emptyArray;\n        this.bindingContext = bindingContext;\n        this.overrideContext = overrideContext;\n    }\n    static create(flags, bc, oc) {\n        return new Scope(null, bc, oc == null ? OverrideContext.create(flags, bc, oc) : oc);\n    }\n    static fromOverride(flags, oc) {\n        if (oc == null) {\n            throw Reporter.error(252 /* NilOverrideContext */);\n        }\n        return new Scope(null, oc.bindingContext, oc);\n    }\n    static fromParent(flags, ps, bc) {\n        if (ps == null) {\n            throw Reporter.error(253 /* NilParentScope */);\n        }\n        return new Scope(ps, bc, OverrideContext.create(flags, bc, ps.overrideContext));\n    }\n}\nexport class OverrideContext {\n    constructor(bindingContext, parentOverrideContext) {\n        this.$synthetic = true;\n        this.bindingContext = bindingContext;\n        this.parentOverrideContext = parentOverrideContext;\n    }\n    static create(flags, bc, poc) {\n        return new OverrideContext(bc, poc === void 0 ? null : poc);\n    }\n    getObservers() {\n        if (this.$observers === void 0) {\n            this.$observers = new InternalObserversLookup();\n        }\n        return this.$observers;\n    }\n}\n//# sourceMappingURL=binding-context.js.map","import { DI } from '@aurelia/kernel';\nexport const ISignaler = DI.createInterface('ISignaler').withDefault(x => x.singleton(Signaler));\n/** @internal */\nexport class Signaler {\n    constructor() {\n        this.signals = Object.create(null);\n    }\n    dispatchSignal(name, flags) {\n        const listeners = this.signals[name];\n        if (listeners === undefined) {\n            return;\n        }\n        for (const listener of listeners.keys()) {\n            listener.handleChange(undefined, undefined, flags | 16 /* updateTargetInstance */);\n        }\n    }\n    addSignalListener(name, listener) {\n        const signals = this.signals;\n        const listeners = signals[name];\n        if (listeners === undefined) {\n            signals[name] = new Set([listener]);\n        }\n        else {\n            listeners.add(listener);\n        }\n    }\n    removeSignalListener(name, listener) {\n        const listeners = this.signals[name];\n        if (listeners) {\n            listeners.delete(listener);\n        }\n    }\n}\n//# sourceMappingURL=signaler.js.map","import { DI, Registration, Metadata, Protocol, } from '@aurelia/kernel';\n/**\n * TargetedInstructionType enum values become the property names for the associated renderers when they are injected\n * into the `Renderer`.\n *\n * Additional instruction types can be added as long as they are 2 characters long and do not clash with existing ones.\n *\n * By convention, the instruction types for a particular runtime start with the same first letter, and the second letter\n * starts counting from letter `a`. The standard runtime instruction types all start with the letter `r`.\n */\nexport var TargetedInstructionType;\n(function (TargetedInstructionType) {\n    TargetedInstructionType[\"hydrateElement\"] = \"ra\";\n    TargetedInstructionType[\"hydrateAttribute\"] = \"rb\";\n    TargetedInstructionType[\"hydrateTemplateController\"] = \"rc\";\n    TargetedInstructionType[\"hydrateLetElement\"] = \"rd\";\n    TargetedInstructionType[\"setProperty\"] = \"re\";\n    TargetedInstructionType[\"interpolation\"] = \"rf\";\n    TargetedInstructionType[\"propertyBinding\"] = \"rg\";\n    TargetedInstructionType[\"callBinding\"] = \"rh\";\n    TargetedInstructionType[\"letBinding\"] = \"ri\";\n    TargetedInstructionType[\"refBinding\"] = \"rj\";\n    TargetedInstructionType[\"iteratorBinding\"] = \"rk\";\n})(TargetedInstructionType || (TargetedInstructionType = {}));\nconst parentPartsOwnPartsLookup = new WeakMap();\n/**\n * Efficiently merge parts, performing the minimal amount of work / using the minimal amount of memory.\n *\n * If either of the two part records is undefined, the other will simply be returned.\n *\n * If both are undefined, undefined will be returned.\n *\n * If neither are undefined, a new object will be returned where parts of the second value will be written last (and thus may overwrite duplicate named parts).\n *\n * This function is idempotent via a WeakMap cache: results are cached and if the same two variables are provided again, the same object will be returned.\n */\nexport function mergeParts(parentParts, ownParts) {\n    if (parentParts === ownParts) {\n        return parentParts;\n    }\n    if (parentParts === void 0) {\n        return ownParts;\n    }\n    if (ownParts === void 0) {\n        return parentParts;\n    }\n    let ownPartsLookup = parentPartsOwnPartsLookup.get(parentParts);\n    if (ownPartsLookup === void 0) {\n        parentPartsOwnPartsLookup.set(parentParts, ownPartsLookup = new WeakMap());\n    }\n    let mergedParts = ownPartsLookup.get(ownParts);\n    if (mergedParts === void 0) {\n        ownPartsLookup.set(ownParts, mergedParts = {\n            ...parentParts,\n            ...ownParts,\n        });\n    }\n    return mergedParts;\n}\nexport const ITargetedInstruction = DI.createInterface('ITargetedInstruction').noDefault();\nexport function isTargetedInstruction(value) {\n    const type = value.type;\n    return typeof type === 'string' && type.length === 2;\n}\nexport class HooksDefinition {\n    constructor(target) {\n        this.hasCreate = 'create' in target;\n        this.hasBeforeCompile = 'beforeCompile' in target;\n        this.hasAfterCompile = 'afterCompile' in target;\n        this.hasAfterCompileChildren = 'afterCompileChildren' in target;\n        this.hasBeforeBind = 'beforeBind' in target;\n        this.hasAfterBind = 'afterBind' in target;\n        this.hasBeforeUnbind = 'beforeUnbind' in target;\n        this.hasAfterUnbind = 'afterUnbind' in target;\n        this.hasBeforeAttach = 'beforeAttach' in target;\n        this.hasAfterAttach = 'afterAttach' in target;\n        this.hasBeforeDetach = 'beforeDetach' in target;\n        this.hasAfterDetach = 'afterDetach' in target;\n        this.hasCaching = 'caching' in target;\n    }\n}\nHooksDefinition.none = new HooksDefinition({});\nexport function alias(...aliases) {\n    return function (target) {\n        const key = Protocol.annotation.keyFor('aliases');\n        const existing = Metadata.getOwn(key, target);\n        if (existing === void 0) {\n            Metadata.define(key, aliases, target);\n        }\n        else {\n            existing.push(...aliases);\n        }\n    };\n}\nexport function registerAliases(aliases, resource, key, container) {\n    for (let i = 0, ii = aliases.length; i < ii; ++i) {\n        Registration.alias(key, resource.keyFrom(aliases[i])).register(container);\n    }\n}\n//# sourceMappingURL=definitions.js.map","// TODO: add connect-queue (or something similar) back in when everything else is working, to improve startup time\nconst slice = Array.prototype.slice;\nconst slotNames = [];\nconst versionSlotNames = [];\nlet lastSlot = -1;\nfunction ensureEnoughSlotNames(currentSlot) {\n    if (currentSlot === lastSlot) {\n        lastSlot += 5;\n        const ii = slotNames.length = versionSlotNames.length = lastSlot + 1;\n        for (let i = currentSlot + 1; i < ii; ++i) {\n            slotNames[i] = `_observer${i}`;\n            versionSlotNames[i] = `_observerVersion${i}`;\n        }\n    }\n}\nensureEnoughSlotNames(-1);\n/** @internal */\nexport function addObserver(observer) {\n    // find the observer.\n    const observerSlots = this.observerSlots == null ? 0 : this.observerSlots;\n    let i = observerSlots;\n    while (i-- && this[slotNames[i]] !== observer)\n        ;\n    // if we are not already observing, put the observer in an open slot and subscribe.\n    if (i === -1) {\n        i = 0;\n        while (this[slotNames[i]]) {\n            i++;\n        }\n        this[slotNames[i]] = observer;\n        observer.subscribe(this);\n        observer[this.id] |= 16 /* updateTargetInstance */;\n        // increment the slot count.\n        if (i === observerSlots) {\n            this.observerSlots = i + 1;\n        }\n    }\n    // set the \"version\" when the observer was used.\n    if (this.version == null) {\n        this.version = 0;\n    }\n    this[versionSlotNames[i]] = this.version;\n    ensureEnoughSlotNames(i);\n}\n/** @internal */\nexport function observeProperty(flags, obj, propertyName) {\n    const observer = this.observerLocator.getObserver(flags, obj, propertyName);\n    /* Note: we need to cast here because we can indeed get an accessor instead of an observer,\n     *  in which case the call to observer.subscribe will throw. It's not very clean and we can solve this in 2 ways:\n     *  1. Fail earlier: only let the locator resolve observers from .getObserver, and throw if no branches are left (e.g. it would otherwise return an accessor)\n     *  2. Fail silently (without throwing): give all accessors a no-op subscribe method\n     *\n     * We'll probably want to implement some global configuration (like a \"strict\" toggle) so users can pick between enforced correctness vs. ease-of-use\n     */\n    this.addObserver(observer);\n}\n/** @internal */\nexport function unobserve(all) {\n    const slots = this.observerSlots;\n    let slotName;\n    let observer;\n    if (all === true) {\n        for (let i = 0; i < slots; ++i) {\n            slotName = slotNames[i];\n            observer = this[slotName];\n            if (observer != null) {\n                this[slotName] = void 0;\n                observer.unsubscribe(this);\n                observer[this.id] &= ~16 /* updateTargetInstance */;\n            }\n        }\n    }\n    else {\n        const version = this.version;\n        for (let i = 0; i < slots; ++i) {\n            if (this[versionSlotNames[i]] !== version) {\n                slotName = slotNames[i];\n                observer = this[slotName];\n                if (observer != null) {\n                    this[slotName] = void 0;\n                    observer.unsubscribe(this);\n                    observer[this.id] &= ~16 /* updateTargetInstance */;\n                }\n            }\n        }\n    }\n}\nfunction connectableDecorator(target) {\n    const proto = target.prototype;\n    if (!Object.prototype.hasOwnProperty.call(proto, 'observeProperty'))\n        proto.observeProperty = observeProperty;\n    if (!Object.prototype.hasOwnProperty.call(proto, 'unobserve'))\n        proto.unobserve = unobserve;\n    if (!Object.prototype.hasOwnProperty.call(proto, 'addObserver'))\n        proto.addObserver = addObserver;\n    return target;\n}\nexport function connectable(target) {\n    return target == null ? connectableDecorator : connectableDecorator(target);\n}\nlet value = 0;\nconnectable.assignIdTo = (instance) => {\n    instance.id = ++value;\n};\n//# sourceMappingURL=connectable.js.map","import { __decorate, __metadata } from \"tslib\";\nimport { Registration, Metadata, Protocol, mergeArrays, firstDefined, DI, fromAnnotationOrDefinitionOrTypeOrDefault, } from '@aurelia/kernel';\nimport { registerAliases } from '../definitions';\nimport { connectable } from '../binding/connectable';\nexport var BindingBehaviorStrategy;\n(function (BindingBehaviorStrategy) {\n    BindingBehaviorStrategy[BindingBehaviorStrategy[\"singleton\"] = 1] = \"singleton\";\n    BindingBehaviorStrategy[BindingBehaviorStrategy[\"interceptor\"] = 2] = \"interceptor\";\n})(BindingBehaviorStrategy || (BindingBehaviorStrategy = {}));\nexport function bindingBehavior(nameOrDef) {\n    return function (target) {\n        return BindingBehavior.define(nameOrDef, target);\n    };\n}\nexport class BindingBehaviorDefinition {\n    constructor(Type, name, aliases, key, strategy) {\n        this.Type = Type;\n        this.name = name;\n        this.aliases = aliases;\n        this.key = key;\n        this.strategy = strategy;\n    }\n    static create(nameOrDef, Type) {\n        let name;\n        let def;\n        if (typeof nameOrDef === 'string') {\n            name = nameOrDef;\n            def = { name };\n        }\n        else {\n            name = nameOrDef.name;\n            def = nameOrDef;\n        }\n        const inheritsFromInterceptor = Object.getPrototypeOf(Type) === BindingInterceptor;\n        return new BindingBehaviorDefinition(Type, firstDefined(BindingBehavior.getAnnotation(Type, 'name'), name), mergeArrays(BindingBehavior.getAnnotation(Type, 'aliases'), def.aliases, Type.aliases), BindingBehavior.keyFrom(name), fromAnnotationOrDefinitionOrTypeOrDefault('strategy', def, Type, () => inheritsFromInterceptor ? 2 /* interceptor */ : 1 /* singleton */));\n    }\n    register(container) {\n        const { Type, key, aliases, strategy } = this;\n        switch (strategy) {\n            case 1 /* singleton */:\n                Registration.singleton(key, Type).register(container);\n                break;\n            case 2 /* interceptor */:\n                Registration.instance(key, new BindingBehaviorFactory(container, Type)).register(container);\n                break;\n        }\n        Registration.alias(key, Type).register(container);\n        registerAliases(aliases, BindingBehavior, key, container);\n    }\n}\nexport class BindingBehaviorFactory {\n    constructor(container, Type) {\n        this.container = container;\n        this.Type = Type;\n        this.deps = DI.getDependencies(Type);\n    }\n    construct(binding, expr) {\n        const container = this.container;\n        const deps = this.deps;\n        switch (deps.length) {\n            case 0:\n            case 1:\n            case 2:\n                return new this.Type(binding, expr);\n            case 3:\n                return new this.Type(container.get(deps[0]), binding, expr);\n            case 4:\n                return new this.Type(container.get(deps[0]), container.get(deps[1]), binding, expr);\n            default:\n                return new this.Type(...deps.map(d => container.get(d)), binding, expr);\n        }\n    }\n}\nlet BindingInterceptor = class BindingInterceptor {\n    constructor(binding, expr) {\n        this.binding = binding;\n        this.expr = expr;\n        this.interceptor = this;\n        let interceptor;\n        while (binding.interceptor !== this) {\n            interceptor = binding.interceptor;\n            binding.interceptor = this;\n            binding = interceptor;\n        }\n    }\n    get id() {\n        return this.binding.id;\n    }\n    get observerLocator() {\n        return this.binding.observerLocator;\n    }\n    get locator() {\n        return this.binding.locator;\n    }\n    get $scope() {\n        return this.binding.$scope;\n    }\n    get part() {\n        return this.binding.part;\n    }\n    get $state() {\n        return this.binding.$state;\n    }\n    updateTarget(value, flags) {\n        this.binding.updateTarget(value, flags);\n    }\n    updateSource(value, flags) {\n        this.binding.updateSource(value, flags);\n    }\n    callSource(args) {\n        return this.binding.callSource(args);\n    }\n    handleChange(newValue, previousValue, flags) {\n        this.binding.handleChange(newValue, previousValue, flags);\n    }\n    $bind(flags, scope, part) {\n        this.binding.$bind(flags, scope, part);\n    }\n    $unbind(flags) {\n        this.binding.$unbind(flags);\n    }\n};\nBindingInterceptor = __decorate([\n    connectable,\n    __metadata(\"design:paramtypes\", [Object, Object])\n], BindingInterceptor);\nexport { BindingInterceptor };\nexport const BindingBehavior = {\n    name: Protocol.resource.keyFor('binding-behavior'),\n    keyFrom(name) {\n        return `${BindingBehavior.name}:${name}`;\n    },\n    isType(value) {\n        return typeof value === 'function' && Metadata.hasOwn(BindingBehavior.name, value);\n    },\n    define(nameOrDef, Type) {\n        const definition = BindingBehaviorDefinition.create(nameOrDef, Type);\n        Metadata.define(BindingBehavior.name, definition, definition.Type);\n        Metadata.define(BindingBehavior.name, definition, definition);\n        Protocol.resource.appendTo(Type, BindingBehavior.name);\n        return definition.Type;\n    },\n    getDefinition(Type) {\n        const def = Metadata.getOwn(BindingBehavior.name, Type);\n        if (def === void 0) {\n            throw new Error(`No definition found for type ${Type.name}`);\n        }\n        return def;\n    },\n    annotate(Type, prop, value) {\n        Metadata.define(Protocol.annotation.keyFor(prop), value, Type);\n    },\n    getAnnotation(Type, prop) {\n        return Metadata.getOwn(Protocol.annotation.keyFor(prop), Type);\n    },\n};\n//# sourceMappingURL=binding-behavior.js.map","import { Registration, Metadata, Protocol, mergeArrays, firstDefined, } from '@aurelia/kernel';\nimport { registerAliases } from '../definitions';\nexport function valueConverter(nameOrDef) {\n    return function (target) {\n        return ValueConverter.define(nameOrDef, target);\n    };\n}\nexport class ValueConverterDefinition {\n    constructor(Type, name, aliases, key) {\n        this.Type = Type;\n        this.name = name;\n        this.aliases = aliases;\n        this.key = key;\n    }\n    static create(nameOrDef, Type) {\n        let name;\n        let def;\n        if (typeof nameOrDef === 'string') {\n            name = nameOrDef;\n            def = { name };\n        }\n        else {\n            name = nameOrDef.name;\n            def = nameOrDef;\n        }\n        return new ValueConverterDefinition(Type, firstDefined(ValueConverter.getAnnotation(Type, 'name'), name), mergeArrays(ValueConverter.getAnnotation(Type, 'aliases'), def.aliases, Type.aliases), ValueConverter.keyFrom(name));\n    }\n    register(container) {\n        const { Type, key, aliases } = this;\n        Registration.singleton(key, Type).register(container);\n        Registration.alias(key, Type).register(container);\n        registerAliases(aliases, ValueConverter, key, container);\n    }\n}\nexport const ValueConverter = {\n    name: Protocol.resource.keyFor('value-converter'),\n    keyFrom(name) {\n        return `${ValueConverter.name}:${name}`;\n    },\n    isType(value) {\n        return typeof value === 'function' && Metadata.hasOwn(ValueConverter.name, value);\n    },\n    define(nameOrDef, Type) {\n        const definition = ValueConverterDefinition.create(nameOrDef, Type);\n        Metadata.define(ValueConverter.name, definition, definition.Type);\n        Metadata.define(ValueConverter.name, definition, definition);\n        Protocol.resource.appendTo(Type, ValueConverter.name);\n        return definition.Type;\n    },\n    getDefinition(Type) {\n        const def = Metadata.getOwn(ValueConverter.name, Type);\n        if (def === void 0) {\n            throw new Error(`No definition found for type ${Type.name}`);\n        }\n        return def;\n    },\n    annotate(Type, prop, value) {\n        Metadata.define(Protocol.annotation.keyFor(prop), value, Type);\n    },\n    getAnnotation(Type, prop) {\n        return Metadata.getOwn(Protocol.annotation.keyFor(prop), Type);\n    },\n};\n//# sourceMappingURL=value-converter.js.map","import { PLATFORM, Reporter, isNumberOrBigInt, isStringOrDate, } from '@aurelia/kernel';\nimport { BindingContext } from '../observation/binding-context';\nimport { ProxyObserver } from '../observation/proxy-observer';\nimport { ISignaler } from '../observation/signaler';\nimport { BindingBehavior, BindingBehaviorFactory, } from '../resources/binding-behavior';\nimport { ValueConverter, } from '../resources/value-converter';\nexport function connects(expr) {\n    return (expr.$kind & 32 /* Connects */) === 32 /* Connects */;\n}\nexport function observes(expr) {\n    return (expr.$kind & 64 /* Observes */) === 64 /* Observes */;\n}\nexport function callsFunction(expr) {\n    return (expr.$kind & 128 /* CallsFunction */) === 128 /* CallsFunction */;\n}\nexport function hasAncestor(expr) {\n    return (expr.$kind & 256 /* HasAncestor */) === 256 /* HasAncestor */;\n}\nexport function isAssignable(expr) {\n    return (expr.$kind & 8192 /* IsAssignable */) === 8192 /* IsAssignable */;\n}\nexport function isLeftHandSide(expr) {\n    return (expr.$kind & 1024 /* IsLeftHandSide */) === 1024 /* IsLeftHandSide */;\n}\nexport function isPrimary(expr) {\n    return (expr.$kind & 512 /* IsPrimary */) === 512 /* IsPrimary */;\n}\nexport function isResource(expr) {\n    return (expr.$kind & 32768 /* IsResource */) === 32768 /* IsResource */;\n}\nexport function hasBind(expr) {\n    return (expr.$kind & 2048 /* HasBind */) === 2048 /* HasBind */;\n}\nexport function hasUnbind(expr) {\n    return (expr.$kind & 4096 /* HasUnbind */) === 4096 /* HasUnbind */;\n}\nexport function isLiteral(expr) {\n    return (expr.$kind & 16384 /* IsLiteral */) === 16384 /* IsLiteral */;\n}\nexport function arePureLiterals(expressions) {\n    if (expressions === void 0 || expressions.length === 0) {\n        return true;\n    }\n    for (let i = 0; i < expressions.length; ++i) {\n        if (!isPureLiteral(expressions[i])) {\n            return false;\n        }\n    }\n    return true;\n}\nexport function isPureLiteral(expr) {\n    if (isLiteral(expr)) {\n        switch (expr.$kind) {\n            case 17955 /* ArrayLiteral */:\n                return arePureLiterals(expr.elements);\n            case 17956 /* ObjectLiteral */:\n                return arePureLiterals(expr.values);\n            case 17958 /* Template */:\n                return arePureLiterals(expr.expressions);\n            case 17925 /* PrimitiveLiteral */:\n                return true;\n        }\n    }\n    return false;\n}\nvar RuntimeError;\n(function (RuntimeError) {\n    RuntimeError[RuntimeError[\"NoLocator\"] = 202] = \"NoLocator\";\n    RuntimeError[RuntimeError[\"NoBehaviorFound\"] = 203] = \"NoBehaviorFound\";\n    RuntimeError[RuntimeError[\"BehaviorAlreadyApplied\"] = 204] = \"BehaviorAlreadyApplied\";\n    RuntimeError[RuntimeError[\"NoConverterFound\"] = 205] = \"NoConverterFound\";\n    RuntimeError[RuntimeError[\"NoBinding\"] = 206] = \"NoBinding\";\n    RuntimeError[RuntimeError[\"NotAFunction\"] = 207] = \"NotAFunction\";\n    RuntimeError[RuntimeError[\"UnknownOperator\"] = 208] = \"UnknownOperator\";\n    RuntimeError[RuntimeError[\"NilScope\"] = 250] = \"NilScope\";\n})(RuntimeError || (RuntimeError = {}));\nexport class CustomExpression {\n    constructor(value) {\n        this.value = value;\n    }\n    evaluate(flags, scope, locator, part) {\n        return this.value;\n    }\n}\nexport class BindingBehaviorExpression {\n    constructor(expression, name, args) {\n        this.expression = expression;\n        this.name = name;\n        this.args = args;\n        this.$kind = 38962 /* BindingBehavior */;\n        this.behaviorKey = BindingBehavior.keyFrom(name);\n    }\n    evaluate(flags, scope, locator, part) {\n        return this.expression.evaluate(flags, scope, locator, part);\n    }\n    assign(flags, scope, locator, value, part) {\n        return this.expression.assign(flags, scope, locator, value, part);\n    }\n    connect(flags, scope, binding, part) {\n        this.expression.connect(flags, scope, binding, part);\n    }\n    bind(flags, scope, binding) {\n        if (scope == null) {\n            throw Reporter.error(250 /* NilScope */, this);\n        }\n        if (!binding) {\n            throw Reporter.error(206 /* NoBinding */, this);\n        }\n        const locator = binding.locator;\n        if (!locator) {\n            throw Reporter.error(202 /* NoLocator */, this);\n        }\n        if (hasBind(this.expression)) {\n            this.expression.bind(flags, scope, binding);\n        }\n        const behaviorKey = this.behaviorKey;\n        const behavior = locator.get(behaviorKey);\n        if (!behavior) {\n            throw Reporter.error(203 /* NoBehaviorFound */, this);\n        }\n        if (!(behavior instanceof BindingBehaviorFactory)) {\n            if (binding[behaviorKey] === void 0) {\n                binding[behaviorKey] = behavior;\n                behavior.bind.call(behavior, flags, scope, binding, ...evalList(flags, scope, locator, this.args));\n            }\n            else {\n                Reporter.write(204 /* BehaviorAlreadyApplied */, this);\n            }\n        }\n    }\n    unbind(flags, scope, binding) {\n        const behaviorKey = this.behaviorKey;\n        if (binding[behaviorKey] !== void 0) {\n            binding[behaviorKey].unbind(flags, scope, binding);\n            binding[behaviorKey] = void 0;\n        }\n        if (hasUnbind(this.expression)) {\n            this.expression.unbind(flags, scope, binding);\n        }\n    }\n    accept(visitor) {\n        return visitor.visitBindingBehavior(this);\n    }\n}\nexport class ValueConverterExpression {\n    constructor(expression, name, args) {\n        this.expression = expression;\n        this.name = name;\n        this.args = args;\n        this.$kind = 36913 /* ValueConverter */;\n        this.converterKey = ValueConverter.keyFrom(name);\n    }\n    evaluate(flags, scope, locator, part) {\n        if (!locator) {\n            throw Reporter.error(202 /* NoLocator */, this);\n        }\n        const converter = locator.get(this.converterKey);\n        if (!converter) {\n            throw Reporter.error(205 /* NoConverterFound */, this);\n        }\n        if ('toView' in converter) {\n            const args = this.args;\n            const len = args.length;\n            const result = Array(len + 1);\n            result[0] = this.expression.evaluate(flags, scope, locator, part);\n            for (let i = 0; i < len; ++i) {\n                result[i + 1] = args[i].evaluate(flags, scope, locator, part);\n            }\n            return converter.toView.call(converter, ...result);\n        }\n        return this.expression.evaluate(flags, scope, locator, part);\n    }\n    assign(flags, scope, locator, value, part) {\n        if (!locator) {\n            throw Reporter.error(202 /* NoLocator */, this);\n        }\n        const converter = locator.get(this.converterKey);\n        if (!converter) {\n            throw Reporter.error(205 /* NoConverterFound */, this);\n        }\n        if ('fromView' in converter) {\n            value = converter.fromView.call(converter, value, ...(evalList(flags, scope, locator, this.args)));\n        }\n        return this.expression.assign(flags, scope, locator, value, part);\n    }\n    connect(flags, scope, binding, part) {\n        if (scope == null) {\n            throw Reporter.error(250 /* NilScope */, this);\n        }\n        if (!binding) {\n            throw Reporter.error(206 /* NoBinding */, this);\n        }\n        const locator = binding.locator;\n        if (!locator) {\n            throw Reporter.error(202 /* NoLocator */, this);\n        }\n        this.expression.connect(flags, scope, binding, part);\n        const args = this.args;\n        for (let i = 0, ii = args.length; i < ii; ++i) {\n            args[i].connect(flags, scope, binding, part);\n        }\n        const converter = locator.get(this.converterKey);\n        if (!converter) {\n            throw Reporter.error(205 /* NoConverterFound */, this);\n        }\n        const signals = converter.signals;\n        if (signals === void 0) {\n            return;\n        }\n        const signaler = locator.get(ISignaler);\n        for (let i = 0, ii = signals.length; i < ii; ++i) {\n            signaler.addSignalListener(signals[i], binding);\n        }\n    }\n    unbind(flags, scope, binding) {\n        const locator = binding.locator;\n        const converter = locator.get(this.converterKey);\n        const signals = converter.signals;\n        if (signals === void 0) {\n            return;\n        }\n        const signaler = locator.get(ISignaler);\n        for (let i = 0, ii = signals.length; i < ii; ++i) {\n            signaler.removeSignalListener(signals[i], binding);\n        }\n    }\n    accept(visitor) {\n        return visitor.visitValueConverter(this);\n    }\n}\nexport class AssignExpression {\n    constructor(target, value) {\n        this.target = target;\n        this.value = value;\n        this.$kind = 8208 /* Assign */;\n    }\n    evaluate(flags, scope, locator, part) {\n        return this.target.assign(flags, scope, locator, this.value.evaluate(flags, scope, locator), part);\n    }\n    connect(flags, scope, binding, part) {\n        return;\n    }\n    assign(flags, scope, locator, value, part) {\n        this.value.assign(flags, scope, locator, value, part);\n        return this.target.assign(flags, scope, locator, value, part);\n    }\n    accept(visitor) {\n        return visitor.visitAssign(this);\n    }\n}\nexport class ConditionalExpression {\n    constructor(condition, yes, no) {\n        this.condition = condition;\n        this.yes = yes;\n        this.no = no;\n        this.$kind = 63 /* Conditional */;\n    }\n    evaluate(flags, scope, locator, part) {\n        return (!!this.condition.evaluate(flags, scope, locator, part))\n            ? this.yes.evaluate(flags, scope, locator, part)\n            : this.no.evaluate(flags, scope, locator, part);\n    }\n    assign(flags, scope, locator, obj, part) {\n        return void 0;\n    }\n    connect(flags, scope, binding, part) {\n        const condition = this.condition;\n        if (condition.evaluate(flags, scope, null, part)) {\n            this.condition.connect(flags, scope, binding, part);\n            this.yes.connect(flags, scope, binding, part);\n        }\n        else {\n            this.condition.connect(flags, scope, binding, part);\n            this.no.connect(flags, scope, binding, part);\n        }\n    }\n    accept(visitor) {\n        return visitor.visitConditional(this);\n    }\n}\nexport class AccessThisExpression {\n    constructor(ancestor = 0) {\n        this.ancestor = ancestor;\n        this.$kind = 1793 /* AccessThis */;\n    }\n    evaluate(flags, scope, locator, part) {\n        if (scope == null) {\n            throw Reporter.error(250 /* NilScope */, this);\n        }\n        if ((flags & 67108864 /* allowParentScopeTraversal */) > 0) {\n            let parent = scope.parentScope;\n            while (parent !== null) {\n                if (!parent.scopeParts.includes(part)) {\n                    parent = parent.parentScope;\n                }\n            }\n            if (parent === null) {\n                throw new Error(`No target scope cold be found for part \"${part}\"`);\n            }\n        }\n        let oc = scope.overrideContext;\n        let i = this.ancestor;\n        while (i-- && oc) {\n            oc = oc.parentOverrideContext;\n        }\n        return i < 1 && oc ? oc.bindingContext : void 0;\n    }\n    assign(flags, scope, locator, obj, part) {\n        return void 0;\n    }\n    connect(flags, scope, binding, part) {\n        return;\n    }\n    accept(visitor) {\n        return visitor.visitAccessThis(this);\n    }\n}\nAccessThisExpression.$this = new AccessThisExpression(0);\nAccessThisExpression.$parent = new AccessThisExpression(1);\nexport class AccessScopeExpression {\n    constructor(name, ancestor = 0) {\n        this.name = name;\n        this.ancestor = ancestor;\n        this.$kind = 10082 /* AccessScope */;\n    }\n    evaluate(flags, scope, locator, part) {\n        const obj = BindingContext.get(scope, this.name, this.ancestor, flags, part);\n        const evaluatedValue = obj[this.name];\n        if (flags & 4 /* isStrictBindingStrategy */) {\n            return evaluatedValue;\n        }\n        return evaluatedValue == null ? '' : evaluatedValue;\n    }\n    assign(flags, scope, locator, value, part) {\n        const obj = BindingContext.get(scope, this.name, this.ancestor, flags, part);\n        if (obj instanceof Object) {\n            if (obj.$observers !== void 0 && obj.$observers[this.name] !== void 0) {\n                obj.$observers[this.name].setValue(value, flags);\n                return value;\n            }\n            else {\n                return obj[this.name] = value;\n            }\n        }\n        return void 0;\n    }\n    connect(flags, scope, binding, part) {\n        const context = BindingContext.get(scope, this.name, this.ancestor, flags, part);\n        binding.observeProperty(flags, context, this.name);\n    }\n    accept(visitor) {\n        return visitor.visitAccessScope(this);\n    }\n}\nexport class AccessMemberExpression {\n    constructor(object, name) {\n        this.object = object;\n        this.name = name;\n        this.$kind = 9323 /* AccessMember */;\n    }\n    evaluate(flags, scope, locator, part) {\n        const instance = this.object.evaluate(flags, scope, locator, part);\n        if (flags & 4 /* isStrictBindingStrategy */) {\n            return instance == null ? instance : instance[this.name];\n        }\n        return instance ? instance[this.name] : '';\n    }\n    assign(flags, scope, locator, value, part) {\n        const obj = this.object.evaluate(flags, scope, locator, part);\n        if (obj instanceof Object) {\n            if (obj.$observers !== void 0 && obj.$observers[this.name] !== void 0) {\n                obj.$observers[this.name].setValue(value, flags);\n            }\n            else {\n                obj[this.name] = value;\n            }\n        }\n        else {\n            this.object.assign(flags, scope, locator, { [this.name]: value });\n        }\n        return value;\n    }\n    connect(flags, scope, binding, part) {\n        const obj = this.object.evaluate(flags, scope, null, part);\n        if ((flags & 134217728 /* observeLeafPropertiesOnly */) === 0) {\n            this.object.connect(flags, scope, binding, part);\n        }\n        if (obj instanceof Object) {\n            binding.observeProperty(flags, obj, this.name);\n        }\n    }\n    accept(visitor) {\n        return visitor.visitAccessMember(this);\n    }\n}\nexport class AccessKeyedExpression {\n    constructor(object, key) {\n        this.object = object;\n        this.key = key;\n        this.$kind = 9324 /* AccessKeyed */;\n    }\n    evaluate(flags, scope, locator, part) {\n        const instance = this.object.evaluate(flags, scope, locator, part);\n        if (instance instanceof Object) {\n            const key = this.key.evaluate(flags, scope, locator, part);\n            return instance[key];\n        }\n        return void 0;\n    }\n    assign(flags, scope, locator, value, part) {\n        const instance = this.object.evaluate(flags, scope, locator, part);\n        const key = this.key.evaluate(flags, scope, locator, part);\n        return instance[key] = value;\n    }\n    connect(flags, scope, binding, part) {\n        const obj = this.object.evaluate(flags, scope, null, part);\n        if ((flags & 134217728 /* observeLeafPropertiesOnly */) === 0) {\n            this.object.connect(flags, scope, binding, part);\n        }\n        if (obj instanceof Object) {\n            this.key.connect(flags, scope, binding, part);\n            const key = this.key.evaluate(flags, scope, null, part);\n            // (note: string indexers behave the same way as numeric indexers as long as they represent numbers)\n            binding.observeProperty(flags, obj, key);\n        }\n    }\n    accept(visitor) {\n        return visitor.visitAccessKeyed(this);\n    }\n}\nexport class CallScopeExpression {\n    constructor(name, args, ancestor = 0) {\n        this.name = name;\n        this.args = args;\n        this.ancestor = ancestor;\n        this.$kind = 1448 /* CallScope */;\n    }\n    evaluate(flags, scope, locator, part) {\n        const args = evalList(flags, scope, locator, this.args, part);\n        const context = BindingContext.get(scope, this.name, this.ancestor, flags, part);\n        const func = getFunction(flags, context, this.name);\n        if (func) {\n            return func.apply(context, args);\n        }\n        return void 0;\n    }\n    assign(flags, scope, locator, obj, part) {\n        return void 0;\n    }\n    connect(flags, scope, binding, part) {\n        const args = this.args;\n        for (let i = 0, ii = args.length; i < ii; ++i) {\n            args[i].connect(flags, scope, binding, part);\n        }\n    }\n    accept(visitor) {\n        return visitor.visitCallScope(this);\n    }\n}\nexport class CallMemberExpression {\n    constructor(object, name, args) {\n        this.object = object;\n        this.name = name;\n        this.args = args;\n        this.$kind = 1161 /* CallMember */;\n    }\n    evaluate(flags, scope, locator, part) {\n        const instance = this.object.evaluate(flags, scope, locator, part);\n        const args = evalList(flags, scope, locator, this.args, part);\n        const func = getFunction(flags, instance, this.name);\n        if (func) {\n            return func.apply(instance, args);\n        }\n        return void 0;\n    }\n    assign(flags, scope, locator, obj, part) {\n        return void 0;\n    }\n    connect(flags, scope, binding, part) {\n        const obj = this.object.evaluate(flags, scope, null, part);\n        if ((flags & 134217728 /* observeLeafPropertiesOnly */) === 0) {\n            this.object.connect(flags, scope, binding, part);\n        }\n        if (getFunction(flags & ~2097152 /* mustEvaluate */, obj, this.name)) {\n            const args = this.args;\n            for (let i = 0, ii = args.length; i < ii; ++i) {\n                args[i].connect(flags, scope, binding, part);\n            }\n        }\n    }\n    accept(visitor) {\n        return visitor.visitCallMember(this);\n    }\n}\nexport class CallFunctionExpression {\n    constructor(func, args) {\n        this.func = func;\n        this.args = args;\n        this.$kind = 1162 /* CallFunction */;\n    }\n    evaluate(flags, scope, locator, part) {\n        const func = this.func.evaluate(flags, scope, locator, part);\n        if (typeof func === 'function') {\n            return func(...evalList(flags, scope, locator, this.args, part));\n        }\n        if (!(flags & 2097152 /* mustEvaluate */) && (func == null)) {\n            return void 0;\n        }\n        throw Reporter.error(207 /* NotAFunction */, this);\n    }\n    assign(flags, scope, locator, obj, part) {\n        return void 0;\n    }\n    connect(flags, scope, binding, part) {\n        const func = this.func.evaluate(flags, scope, null, part);\n        this.func.connect(flags, scope, binding, part);\n        if (typeof func === 'function') {\n            const args = this.args;\n            for (let i = 0, ii = args.length; i < ii; ++i) {\n                args[i].connect(flags, scope, binding, part);\n            }\n        }\n    }\n    accept(visitor) {\n        return visitor.visitCallFunction(this);\n    }\n}\nexport class BinaryExpression {\n    constructor(operation, left, right) {\n        this.operation = operation;\n        this.left = left;\n        this.right = right;\n        this.$kind = 46 /* Binary */;\n        // what we're doing here is effectively moving the large switch statement from evaluate to the constructor\n        // so that the check only needs to be done once, and evaluate (which is called many times) will have a lot less\n        // work to do; we can do this because the operation can't change after it's parsed\n        this.evaluate = this[operation];\n    }\n    evaluate(flags, scope, locator, part) {\n        throw Reporter.error(208 /* UnknownOperator */, this);\n    }\n    assign(flags, scope, locator, obj, part) {\n        return void 0;\n    }\n    connect(flags, scope, binding, part) {\n        this.left.connect(flags, scope, binding, part);\n        this.right.connect(flags, scope, binding, part);\n    }\n    ['&&'](f, s, l, p) {\n        return this.left.evaluate(f, s, l, p) && this.right.evaluate(f, s, l, p);\n    }\n    ['||'](f, s, l, p) {\n        return this.left.evaluate(f, s, l, p) || this.right.evaluate(f, s, l, p);\n    }\n    ['=='](f, s, l, p) {\n        // eslint-disable-next-line eqeqeq\n        return this.left.evaluate(f, s, l, p) == this.right.evaluate(f, s, l, p);\n    }\n    ['==='](f, s, l, p) {\n        return this.left.evaluate(f, s, l, p) === this.right.evaluate(f, s, l, p);\n    }\n    ['!='](f, s, l, p) {\n        // eslint-disable-next-line eqeqeq\n        return this.left.evaluate(f, s, l, p) != this.right.evaluate(f, s, l, p);\n    }\n    ['!=='](f, s, l, p) {\n        return this.left.evaluate(f, s, l, p) !== this.right.evaluate(f, s, l, p);\n    }\n    ['instanceof'](f, s, l, p) {\n        const right = this.right.evaluate(f, s, l, p);\n        if (typeof right === 'function') {\n            return this.left.evaluate(f, s, l, p) instanceof right;\n        }\n        return false;\n    }\n    ['in'](f, s, l, p) {\n        const right = this.right.evaluate(f, s, l, p);\n        if (right instanceof Object) {\n            return this.left.evaluate(f, s, l, p) in right;\n        }\n        return false;\n    }\n    // note: autoConvertAdd (and the null check) is removed because the default spec behavior is already largely similar\n    // and where it isn't, you kind of want it to behave like the spec anyway (e.g. return NaN when adding a number to undefined)\n    // this makes bugs in user code easier to track down for end users\n    // also, skipping these checks and leaving it to the runtime is a nice little perf boost and simplifies our code\n    ['+'](f, s, l, p) {\n        const left = this.left.evaluate(f, s, l, p);\n        const right = this.right.evaluate(f, s, l, p);\n        if ((f & 4 /* isStrictBindingStrategy */) > 0) {\n            return left + right;\n        }\n        // eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n        if (!left || !right) {\n            if (isNumberOrBigInt(left) || isNumberOrBigInt(right)) {\n                // eslint-disable-next-line @typescript-eslint/strict-boolean-expressions, @typescript-eslint/no-unnecessary-condition\n                return (left || 0) + (right || 0);\n            }\n            if (isStringOrDate(left) || isStringOrDate(right)) {\n                // eslint-disable-next-line @typescript-eslint/strict-boolean-expressions, @typescript-eslint/no-unnecessary-condition\n                return (left || '') + (right || '');\n            }\n        }\n        return left + right;\n    }\n    ['-'](f, s, l, p) {\n        return this.left.evaluate(f, s, l, p) - this.right.evaluate(f, s, l, p);\n    }\n    ['*'](f, s, l, p) {\n        return this.left.evaluate(f, s, l, p) * this.right.evaluate(f, s, l, p);\n    }\n    ['/'](f, s, l, p) {\n        return this.left.evaluate(f, s, l, p) / this.right.evaluate(f, s, l, p);\n    }\n    ['%'](f, s, l, p) {\n        return this.left.evaluate(f, s, l, p) % this.right.evaluate(f, s, l, p);\n    }\n    ['<'](f, s, l, p) {\n        return this.left.evaluate(f, s, l, p) < this.right.evaluate(f, s, l, p);\n    }\n    ['>'](f, s, l, p) {\n        return this.left.evaluate(f, s, l, p) > this.right.evaluate(f, s, l, p);\n    }\n    ['<='](f, s, l, p) {\n        return this.left.evaluate(f, s, l, p) <= this.right.evaluate(f, s, l, p);\n    }\n    ['>='](f, s, l, p) {\n        return this.left.evaluate(f, s, l, p) >= this.right.evaluate(f, s, l, p);\n    }\n    accept(visitor) {\n        return visitor.visitBinary(this);\n    }\n}\nexport class UnaryExpression {\n    constructor(operation, expression) {\n        this.operation = operation;\n        this.expression = expression;\n        this.$kind = 39 /* Unary */;\n        // see Binary (we're doing the same thing here)\n        this.evaluate = this[operation];\n    }\n    evaluate(flags, scope, locator, part) {\n        throw Reporter.error(208 /* UnknownOperator */, this);\n    }\n    assign(flags, scope, locator, obj, part) {\n        return void 0;\n    }\n    connect(flags, scope, binding, part) {\n        this.expression.connect(flags, scope, binding, part);\n    }\n    ['void'](f, s, l, p) {\n        return void this.expression.evaluate(f, s, l, p);\n    }\n    ['typeof'](f, s, l, p) {\n        return typeof this.expression.evaluate(f | 4 /* isStrictBindingStrategy */, s, l, p);\n    }\n    ['!'](f, s, l, p) {\n        return !this.expression.evaluate(f, s, l, p);\n    }\n    ['-'](f, s, l, p) {\n        return -this.expression.evaluate(f, s, l, p);\n    }\n    ['+'](f, s, l, p) {\n        return +this.expression.evaluate(f, s, l, p);\n    }\n    accept(visitor) {\n        return visitor.visitUnary(this);\n    }\n}\nexport class PrimitiveLiteralExpression {\n    constructor(value) {\n        this.value = value;\n        this.$kind = 17925 /* PrimitiveLiteral */;\n    }\n    evaluate(flags, scope, locator, part) {\n        return this.value;\n    }\n    assign(flags, scope, locator, obj, part) {\n        return void 0;\n    }\n    connect(flags, scope, binding, part) {\n        return;\n    }\n    accept(visitor) {\n        return visitor.visitPrimitiveLiteral(this);\n    }\n}\nPrimitiveLiteralExpression.$undefined = new PrimitiveLiteralExpression(void 0);\nPrimitiveLiteralExpression.$null = new PrimitiveLiteralExpression(null);\nPrimitiveLiteralExpression.$true = new PrimitiveLiteralExpression(true);\nPrimitiveLiteralExpression.$false = new PrimitiveLiteralExpression(false);\nPrimitiveLiteralExpression.$empty = new PrimitiveLiteralExpression('');\nexport class HtmlLiteralExpression {\n    constructor(parts) {\n        this.parts = parts;\n        this.$kind = 51 /* HtmlLiteral */;\n    }\n    evaluate(flags, scope, locator, part) {\n        const elements = this.parts;\n        let result = '';\n        let value;\n        for (let i = 0, ii = elements.length; i < ii; ++i) {\n            value = elements[i].evaluate(flags, scope, locator, part);\n            if (value == null) {\n                continue;\n            }\n            result += value;\n        }\n        return result;\n    }\n    assign(flags, scope, locator, obj, part) {\n        return void 0;\n    }\n    connect(flags, scope, binding, part) {\n        for (let i = 0, ii = this.parts.length; i < ii; ++i) {\n            this.parts[i].connect(flags, scope, binding, part);\n        }\n    }\n    accept(visitor) {\n        return visitor.visitHtmlLiteral(this);\n    }\n}\nexport class ArrayLiteralExpression {\n    constructor(elements) {\n        this.elements = elements;\n        this.$kind = 17955 /* ArrayLiteral */;\n    }\n    evaluate(flags, scope, locator, part) {\n        const elements = this.elements;\n        const length = elements.length;\n        const result = Array(length);\n        for (let i = 0; i < length; ++i) {\n            result[i] = elements[i].evaluate(flags, scope, locator, part);\n        }\n        return result;\n    }\n    assign(flags, scope, locator, obj, part) {\n        return void 0;\n    }\n    connect(flags, scope, binding, part) {\n        const elements = this.elements;\n        for (let i = 0, ii = elements.length; i < ii; ++i) {\n            elements[i].connect(flags, scope, binding, part);\n        }\n    }\n    accept(visitor) {\n        return visitor.visitArrayLiteral(this);\n    }\n}\nArrayLiteralExpression.$empty = new ArrayLiteralExpression(PLATFORM.emptyArray);\nexport class ObjectLiteralExpression {\n    constructor(keys, values) {\n        this.keys = keys;\n        this.values = values;\n        this.$kind = 17956 /* ObjectLiteral */;\n    }\n    evaluate(flags, scope, locator, part) {\n        const instance = {};\n        const keys = this.keys;\n        const values = this.values;\n        for (let i = 0, ii = keys.length; i < ii; ++i) {\n            instance[keys[i]] = values[i].evaluate(flags, scope, locator, part);\n        }\n        return instance;\n    }\n    assign(flags, scope, locator, obj, part) {\n        return void 0;\n    }\n    connect(flags, scope, binding, part) {\n        const keys = this.keys;\n        const values = this.values;\n        for (let i = 0, ii = keys.length; i < ii; ++i) {\n            values[i].connect(flags, scope, binding, part);\n        }\n    }\n    accept(visitor) {\n        return visitor.visitObjectLiteral(this);\n    }\n}\nObjectLiteralExpression.$empty = new ObjectLiteralExpression(PLATFORM.emptyArray, PLATFORM.emptyArray);\nexport class TemplateExpression {\n    constructor(cooked, expressions = PLATFORM.emptyArray) {\n        this.cooked = cooked;\n        this.expressions = expressions;\n        this.$kind = 17958 /* Template */;\n    }\n    evaluate(flags, scope, locator, part) {\n        const expressions = this.expressions;\n        const cooked = this.cooked;\n        let result = cooked[0];\n        for (let i = 0, ii = expressions.length; i < ii; ++i) {\n            result += expressions[i].evaluate(flags, scope, locator, part);\n            result += cooked[i + 1];\n        }\n        return result;\n    }\n    assign(flags, scope, locator, obj, part) {\n        return void 0;\n    }\n    connect(flags, scope, binding, part) {\n        const expressions = this.expressions;\n        for (let i = 0, ii = expressions.length; i < ii; ++i) {\n            expressions[i].connect(flags, scope, binding, part);\n            i++;\n        }\n    }\n    accept(visitor) {\n        return visitor.visitTemplate(this);\n    }\n}\nTemplateExpression.$empty = new TemplateExpression(['']);\nexport class TaggedTemplateExpression {\n    constructor(cooked, raw, func, expressions = PLATFORM.emptyArray) {\n        this.cooked = cooked;\n        this.func = func;\n        this.expressions = expressions;\n        this.$kind = 1197 /* TaggedTemplate */;\n        cooked.raw = raw;\n    }\n    evaluate(flags, scope, locator, part) {\n        const expressions = this.expressions;\n        const len = expressions.length;\n        const results = Array(len);\n        for (let i = 0, ii = len; i < ii; ++i) {\n            results[i] = expressions[i].evaluate(flags, scope, locator, part);\n        }\n        const func = this.func.evaluate(flags, scope, locator, part);\n        if (typeof func !== 'function') {\n            throw Reporter.error(207 /* NotAFunction */, this);\n        }\n        return func(this.cooked, ...results);\n    }\n    assign(flags, scope, locator, obj, part) {\n        return void 0;\n    }\n    connect(flags, scope, binding, part) {\n        const expressions = this.expressions;\n        for (let i = 0, ii = expressions.length; i < ii; ++i) {\n            expressions[i].connect(flags, scope, binding);\n        }\n        this.func.connect(flags, scope, binding);\n    }\n    accept(visitor) {\n        return visitor.visitTaggedTemplate(this);\n    }\n}\nexport class ArrayBindingPattern {\n    // We'll either have elements, or keys+values, but never all 3\n    constructor(elements) {\n        this.elements = elements;\n        this.$kind = 65556 /* ArrayBindingPattern */;\n    }\n    evaluate(flags, scope, locator, part) {\n        // TODO\n        return void 0;\n    }\n    assign(flags, scope, locator, obj, part) {\n        // TODO\n        return void 0;\n    }\n    connect(flags, scope, binding, part) {\n        return;\n    }\n    accept(visitor) {\n        return visitor.visitArrayBindingPattern(this);\n    }\n}\nexport class ObjectBindingPattern {\n    // We'll either have elements, or keys+values, but never all 3\n    constructor(keys, values) {\n        this.keys = keys;\n        this.values = values;\n        this.$kind = 65557 /* ObjectBindingPattern */;\n    }\n    evaluate(flags, scope, locator, part) {\n        // TODO\n        return void 0;\n    }\n    assign(flags, scope, locator, obj, part) {\n        // TODO\n        return void 0;\n    }\n    connect(flags, scope, binding, part) {\n        return;\n    }\n    accept(visitor) {\n        return visitor.visitObjectBindingPattern(this);\n    }\n}\nexport class BindingIdentifier {\n    constructor(name) {\n        this.name = name;\n        this.$kind = 65558 /* BindingIdentifier */;\n    }\n    evaluate(flags, scope, locator, part) {\n        return this.name;\n    }\n    connect(flags, scope, binding, part) {\n        return;\n    }\n    accept(visitor) {\n        return visitor.visitBindingIdentifier(this);\n    }\n}\nconst toStringTag = Object.prototype.toString;\n// https://tc39.github.io/ecma262/#sec-iteration-statements\n// https://tc39.github.io/ecma262/#sec-for-in-and-for-of-statements\nexport class ForOfStatement {\n    constructor(declaration, iterable) {\n        this.declaration = declaration;\n        this.iterable = iterable;\n        this.$kind = 6199 /* ForOfStatement */;\n    }\n    evaluate(flags, scope, locator, part) {\n        return this.iterable.evaluate(flags, scope, locator, part);\n    }\n    assign(flags, scope, locator, obj, part) {\n        return void 0;\n    }\n    count(flags, result) {\n        switch (toStringTag.call(result)) {\n            case '[object Array]': return result.length;\n            case '[object Map]': return result.size;\n            case '[object Set]': return result.size;\n            case '[object Number]': return result;\n            case '[object Null]': return 0;\n            case '[object Undefined]': return 0;\n            default: throw Reporter.error(0); // TODO: Set error code\n        }\n    }\n    iterate(flags, result, func) {\n        switch (toStringTag.call(result)) {\n            case '[object Array]': return $array(flags | 8388608 /* isOriginalArray */, result, func);\n            case '[object Map]': return $map(flags | 8388608 /* isOriginalArray */, result, func);\n            case '[object Set]': return $set(flags | 8388608 /* isOriginalArray */, result, func);\n            case '[object Number]': return $number(flags | 8388608 /* isOriginalArray */, result, func);\n            case '[object Null]': return;\n            case '[object Undefined]': return;\n            default: throw Reporter.error(0); // TODO: Set error code\n        }\n    }\n    connect(flags, scope, binding, part) {\n        this.declaration.connect(flags, scope, binding, part);\n        this.iterable.connect(flags, scope, binding, part);\n    }\n    bind(flags, scope, binding) {\n        if (hasBind(this.iterable)) {\n            this.iterable.bind(flags, scope, binding);\n        }\n    }\n    unbind(flags, scope, binding) {\n        if (hasUnbind(this.iterable)) {\n            this.iterable.unbind(flags, scope, binding);\n        }\n    }\n    accept(visitor) {\n        return visitor.visitForOfStatement(this);\n    }\n}\n/*\n* Note: this implementation is far simpler than the one in vCurrent and might be missing important stuff (not sure yet)\n* so while this implementation is identical to Template and we could reuse that one, we don't want to lock outselves in to potentially the wrong abstraction\n* but this class might be a candidate for removal if it turns out it does provide all we need\n*/\nexport class Interpolation {\n    constructor(parts, expressions = PLATFORM.emptyArray) {\n        this.parts = parts;\n        this.expressions = expressions;\n        this.$kind = 24 /* Interpolation */;\n        this.isMulti = expressions.length > 1;\n        this.firstExpression = expressions[0];\n    }\n    evaluate(flags, scope, locator, part) {\n        if (this.isMulti) {\n            const expressions = this.expressions;\n            const parts = this.parts;\n            let result = parts[0];\n            for (let i = 0, ii = expressions.length; i < ii; ++i) {\n                result += expressions[i].evaluate(flags, scope, locator, part);\n                result += parts[i + 1];\n            }\n            return result;\n        }\n        else {\n            const parts = this.parts;\n            return `${parts[0]}${this.firstExpression.evaluate(flags, scope, locator, part)}${parts[1]}`;\n        }\n    }\n    assign(flags, scope, locator, obj, part) {\n        return void 0;\n    }\n    connect(flags, scope, binding, part) {\n        return;\n    }\n    accept(visitor) {\n        return visitor.visitInterpolation(this);\n    }\n}\n/// Evaluate the [list] in context of the [scope].\nfunction evalList(flags, scope, locator, list, part) {\n    const len = list.length;\n    const result = Array(len);\n    for (let i = 0; i < len; ++i) {\n        result[i] = list[i].evaluate(flags, scope, locator, part);\n    }\n    return result;\n}\nfunction getFunction(flags, obj, name) {\n    const func = obj == null ? null : obj[name];\n    if (typeof func === 'function') {\n        return func;\n    }\n    if (!(flags & 2097152 /* mustEvaluate */) && func == null) {\n        return null;\n    }\n    throw Reporter.error(207 /* NotAFunction */, obj, name, func);\n}\nconst proxyAndOriginalArray = 2 /* proxyStrategy */ | 8388608 /* isOriginalArray */;\nfunction $array(flags, result, func) {\n    if ((flags & proxyAndOriginalArray) === proxyAndOriginalArray) {\n        // If we're in proxy mode, and the array is the original \"items\" (and not an array we created here to iterate over e.g. a set)\n        // then replace all items (which are Objects) with proxies so their properties are observed in the source view model even if no\n        // observers are explicitly created\n        const rawArray = ProxyObserver.getRawIfProxy(result);\n        const len = rawArray.length;\n        let item;\n        let i = 0;\n        for (; i < len; ++i) {\n            item = rawArray[i];\n            if (item instanceof Object) {\n                item = rawArray[i] = ProxyObserver.getOrCreate(item).proxy;\n            }\n            func(rawArray, i, item);\n        }\n    }\n    else {\n        for (let i = 0, ii = result.length; i < ii; ++i) {\n            func(result, i, result[i]);\n        }\n    }\n}\nfunction $map(flags, result, func) {\n    const arr = Array(result.size);\n    let i = -1;\n    for (const entry of result.entries()) {\n        arr[++i] = entry;\n    }\n    $array(flags & ~8388608 /* isOriginalArray */, arr, func);\n}\nfunction $set(flags, result, func) {\n    const arr = Array(result.size);\n    let i = -1;\n    for (const key of result.keys()) {\n        arr[++i] = key;\n    }\n    $array(flags & ~8388608 /* isOriginalArray */, arr, func);\n}\nfunction $number(flags, result, func) {\n    const arr = Array(result);\n    for (let i = 0; i < result; ++i) {\n        arr[i] = i;\n    }\n    $array(flags & ~8388608 /* isOriginalArray */, arr, func);\n}\n//# sourceMappingURL=ast.js.map","/*\n* Note: the oneTime binding now has a non-zero value for 2 reasons:\n*  - plays nicer with bitwise operations (more consistent code, more explicit settings)\n*  - allows for potentially having something like BindingMode.oneTime | BindingMode.fromView, where an initial value is set once to the view but updates from the view also propagate back to the view model\n*\n* Furthermore, the \"default\" mode would be for simple \".bind\" expressions to make it explicit for our logic that the default is being used.\n* This essentially adds extra information which binding could use to do smarter things and allows bindingBehaviors that add a mode instead of simply overwriting it\n*/\nexport var BindingMode;\n(function (BindingMode) {\n    BindingMode[BindingMode[\"oneTime\"] = 1] = \"oneTime\";\n    BindingMode[BindingMode[\"toView\"] = 2] = \"toView\";\n    BindingMode[BindingMode[\"fromView\"] = 4] = \"fromView\";\n    BindingMode[BindingMode[\"twoWay\"] = 6] = \"twoWay\";\n    BindingMode[BindingMode[\"default\"] = 8] = \"default\";\n})(BindingMode || (BindingMode = {}));\nexport var BindingStrategy;\n(function (BindingStrategy) {\n    /**\n     * Configures all components \"below\" this one to operate in getterSetter binding mode.\n     * This is the default; if no strategy is specified, this one is implied.\n     *\n     * This strategy is the most compatible, convenient and has the best performance on frequently updated bindings on components that are infrequently replaced.\n     * However, it also consumes the most resources on initialization.\n     */\n    BindingStrategy[BindingStrategy[\"getterSetter\"] = 1] = \"getterSetter\";\n    /**\n     * Configures all components \"below\" this one to operate in proxy binding mode.\n     * No getters/setters are created.\n     *\n     * This strategy consumes significantly fewer resources than `getterSetter` on initialization and has the best performance on infrequently updated bindings on\n     * components that are frequently replaced.\n     * However, it consumes more resources on updates.\n     */\n    BindingStrategy[BindingStrategy[\"proxies\"] = 2] = \"proxies\";\n})(BindingStrategy || (BindingStrategy = {}));\nconst mandatoryStrategy = 1 /* getterSetter */ | 2 /* proxies */;\nexport function ensureValidStrategy(strategy) {\n    if ((strategy & mandatoryStrategy) === 0) {\n        // TODO: probably want to validate that user isn't trying to mix getterSetter/proxy\n        // TODO: also need to make sure that strategy can be changed away from proxies inside the component tree (not here though, but just making a note)\n        return strategy | 1 /* getterSetter */;\n    }\n    return strategy;\n}\nexport var State;\n(function (State) {\n    State[State[\"none\"] = 0] = \"none\";\n    State[State[\"isBinding\"] = 1] = \"isBinding\";\n    State[State[\"isUnbinding\"] = 2] = \"isUnbinding\";\n    State[State[\"isBound\"] = 4] = \"isBound\";\n    State[State[\"isBoundOrBinding\"] = 5] = \"isBoundOrBinding\";\n    State[State[\"isBoundOrUnbinding\"] = 6] = \"isBoundOrUnbinding\";\n    State[State[\"isAttaching\"] = 8] = \"isAttaching\";\n    State[State[\"isDetaching\"] = 16] = \"isDetaching\";\n    State[State[\"isAttached\"] = 32] = \"isAttached\";\n    State[State[\"isAttachedOrAttaching\"] = 40] = \"isAttachedOrAttaching\";\n    State[State[\"isAttachedOrDetaching\"] = 48] = \"isAttachedOrDetaching\";\n    State[State[\"isMounted\"] = 64] = \"isMounted\";\n    State[State[\"hasLockedScope\"] = 256] = \"hasLockedScope\";\n    State[State[\"canBeCached\"] = 512] = \"canBeCached\";\n})(State || (State = {}));\nexport var LifecycleFlags;\n(function (LifecycleFlags) {\n    LifecycleFlags[LifecycleFlags[\"none\"] = 0] = \"none\";\n    // Bitmask for flags that need to be stored on a binding during $bind for mutation\n    // callbacks outside of $bind\n    LifecycleFlags[LifecycleFlags[\"persistentBindingFlags\"] = 2080374799] = \"persistentBindingFlags\";\n    LifecycleFlags[LifecycleFlags[\"allowParentScopeTraversal\"] = 67108864] = \"allowParentScopeTraversal\";\n    LifecycleFlags[LifecycleFlags[\"observeLeafPropertiesOnly\"] = 134217728] = \"observeLeafPropertiesOnly\";\n    LifecycleFlags[LifecycleFlags[\"targetObserverFlags\"] = 805306383] = \"targetObserverFlags\";\n    LifecycleFlags[LifecycleFlags[\"noTargetObserverQueue\"] = 268435456] = \"noTargetObserverQueue\";\n    LifecycleFlags[LifecycleFlags[\"persistentTargetObserverQueue\"] = 536870912] = \"persistentTargetObserverQueue\";\n    LifecycleFlags[LifecycleFlags[\"secondaryExpression\"] = 1073741824] = \"secondaryExpression\";\n    LifecycleFlags[LifecycleFlags[\"bindingStrategy\"] = 15] = \"bindingStrategy\";\n    LifecycleFlags[LifecycleFlags[\"getterSetterStrategy\"] = 1] = \"getterSetterStrategy\";\n    LifecycleFlags[LifecycleFlags[\"proxyStrategy\"] = 2] = \"proxyStrategy\";\n    LifecycleFlags[LifecycleFlags[\"isStrictBindingStrategy\"] = 4] = \"isStrictBindingStrategy\";\n    LifecycleFlags[LifecycleFlags[\"update\"] = 48] = \"update\";\n    LifecycleFlags[LifecycleFlags[\"updateTargetInstance\"] = 16] = \"updateTargetInstance\";\n    LifecycleFlags[LifecycleFlags[\"updateSourceExpression\"] = 32] = \"updateSourceExpression\";\n    LifecycleFlags[LifecycleFlags[\"from\"] = 524224] = \"from\";\n    LifecycleFlags[LifecycleFlags[\"fromFlush\"] = 960] = \"fromFlush\";\n    LifecycleFlags[LifecycleFlags[\"fromAsyncFlush\"] = 64] = \"fromAsyncFlush\";\n    LifecycleFlags[LifecycleFlags[\"fromSyncFlush\"] = 128] = \"fromSyncFlush\";\n    LifecycleFlags[LifecycleFlags[\"fromTick\"] = 256] = \"fromTick\";\n    LifecycleFlags[LifecycleFlags[\"fromBatch\"] = 512] = \"fromBatch\";\n    LifecycleFlags[LifecycleFlags[\"fromStartTask\"] = 1024] = \"fromStartTask\";\n    LifecycleFlags[LifecycleFlags[\"fromStopTask\"] = 2048] = \"fromStopTask\";\n    LifecycleFlags[LifecycleFlags[\"fromBind\"] = 4096] = \"fromBind\";\n    LifecycleFlags[LifecycleFlags[\"fromUnbind\"] = 8192] = \"fromUnbind\";\n    LifecycleFlags[LifecycleFlags[\"fromAttach\"] = 16384] = \"fromAttach\";\n    LifecycleFlags[LifecycleFlags[\"fromDetach\"] = 32768] = \"fromDetach\";\n    LifecycleFlags[LifecycleFlags[\"fromCache\"] = 65536] = \"fromCache\";\n    LifecycleFlags[LifecycleFlags[\"fromDOMEvent\"] = 131072] = \"fromDOMEvent\";\n    LifecycleFlags[LifecycleFlags[\"fromLifecycleTask\"] = 262144] = \"fromLifecycleTask\";\n    LifecycleFlags[LifecycleFlags[\"allowPublishRoundtrip\"] = 524288] = \"allowPublishRoundtrip\";\n    LifecycleFlags[LifecycleFlags[\"isPublishing\"] = 1048576] = \"isPublishing\";\n    LifecycleFlags[LifecycleFlags[\"mustEvaluate\"] = 2097152] = \"mustEvaluate\";\n    LifecycleFlags[LifecycleFlags[\"isTraversingParentScope\"] = 4194304] = \"isTraversingParentScope\";\n    LifecycleFlags[LifecycleFlags[\"isOriginalArray\"] = 8388608] = \"isOriginalArray\";\n    LifecycleFlags[LifecycleFlags[\"isCollectionMutation\"] = 16777216] = \"isCollectionMutation\";\n    LifecycleFlags[LifecycleFlags[\"reorderNodes\"] = 33554432] = \"reorderNodes\";\n})(LifecycleFlags || (LifecycleFlags = {}));\nexport var ExpressionKind;\n(function (ExpressionKind) {\n    ExpressionKind[ExpressionKind[\"Connects\"] = 32] = \"Connects\";\n    ExpressionKind[ExpressionKind[\"Observes\"] = 64] = \"Observes\";\n    ExpressionKind[ExpressionKind[\"CallsFunction\"] = 128] = \"CallsFunction\";\n    ExpressionKind[ExpressionKind[\"HasAncestor\"] = 256] = \"HasAncestor\";\n    ExpressionKind[ExpressionKind[\"IsPrimary\"] = 512] = \"IsPrimary\";\n    ExpressionKind[ExpressionKind[\"IsLeftHandSide\"] = 1024] = \"IsLeftHandSide\";\n    ExpressionKind[ExpressionKind[\"HasBind\"] = 2048] = \"HasBind\";\n    ExpressionKind[ExpressionKind[\"HasUnbind\"] = 4096] = \"HasUnbind\";\n    ExpressionKind[ExpressionKind[\"IsAssignable\"] = 8192] = \"IsAssignable\";\n    ExpressionKind[ExpressionKind[\"IsLiteral\"] = 16384] = \"IsLiteral\";\n    ExpressionKind[ExpressionKind[\"IsResource\"] = 32768] = \"IsResource\";\n    ExpressionKind[ExpressionKind[\"IsForDeclaration\"] = 65536] = \"IsForDeclaration\";\n    ExpressionKind[ExpressionKind[\"Type\"] = 31] = \"Type\";\n    // ---------------------------------------------------------------------------------------------------------------------------\n    ExpressionKind[ExpressionKind[\"AccessThis\"] = 1793] = \"AccessThis\";\n    ExpressionKind[ExpressionKind[\"AccessScope\"] = 10082] = \"AccessScope\";\n    ExpressionKind[ExpressionKind[\"ArrayLiteral\"] = 17955] = \"ArrayLiteral\";\n    ExpressionKind[ExpressionKind[\"ObjectLiteral\"] = 17956] = \"ObjectLiteral\";\n    ExpressionKind[ExpressionKind[\"PrimitiveLiteral\"] = 17925] = \"PrimitiveLiteral\";\n    ExpressionKind[ExpressionKind[\"Template\"] = 17958] = \"Template\";\n    ExpressionKind[ExpressionKind[\"Unary\"] = 39] = \"Unary\";\n    ExpressionKind[ExpressionKind[\"CallScope\"] = 1448] = \"CallScope\";\n    ExpressionKind[ExpressionKind[\"CallMember\"] = 1161] = \"CallMember\";\n    ExpressionKind[ExpressionKind[\"CallFunction\"] = 1162] = \"CallFunction\";\n    ExpressionKind[ExpressionKind[\"AccessMember\"] = 9323] = \"AccessMember\";\n    ExpressionKind[ExpressionKind[\"AccessKeyed\"] = 9324] = \"AccessKeyed\";\n    ExpressionKind[ExpressionKind[\"TaggedTemplate\"] = 1197] = \"TaggedTemplate\";\n    ExpressionKind[ExpressionKind[\"Binary\"] = 46] = \"Binary\";\n    ExpressionKind[ExpressionKind[\"Conditional\"] = 63] = \"Conditional\";\n    ExpressionKind[ExpressionKind[\"Assign\"] = 8208] = \"Assign\";\n    ExpressionKind[ExpressionKind[\"ValueConverter\"] = 36913] = \"ValueConverter\";\n    ExpressionKind[ExpressionKind[\"BindingBehavior\"] = 38962] = \"BindingBehavior\";\n    ExpressionKind[ExpressionKind[\"HtmlLiteral\"] = 51] = \"HtmlLiteral\";\n    ExpressionKind[ExpressionKind[\"ArrayBindingPattern\"] = 65556] = \"ArrayBindingPattern\";\n    ExpressionKind[ExpressionKind[\"ObjectBindingPattern\"] = 65557] = \"ObjectBindingPattern\";\n    ExpressionKind[ExpressionKind[\"BindingIdentifier\"] = 65558] = \"BindingIdentifier\";\n    ExpressionKind[ExpressionKind[\"ForOfStatement\"] = 6199] = \"ForOfStatement\";\n    ExpressionKind[ExpressionKind[\"Interpolation\"] = 24] = \"Interpolation\"; //\n})(ExpressionKind || (ExpressionKind = {}));\n//# sourceMappingURL=flags.js.map","/** @internal */\nexport var SubscriberFlags;\n(function (SubscriberFlags) {\n    SubscriberFlags[SubscriberFlags[\"None\"] = 0] = \"None\";\n    SubscriberFlags[SubscriberFlags[\"Subscriber0\"] = 1] = \"Subscriber0\";\n    SubscriberFlags[SubscriberFlags[\"Subscriber1\"] = 2] = \"Subscriber1\";\n    SubscriberFlags[SubscriberFlags[\"Subscriber2\"] = 4] = \"Subscriber2\";\n    SubscriberFlags[SubscriberFlags[\"SubscribersRest\"] = 8] = \"SubscribersRest\";\n    SubscriberFlags[SubscriberFlags[\"Any\"] = 15] = \"Any\";\n})(SubscriberFlags || (SubscriberFlags = {}));\nexport var DelegationStrategy;\n(function (DelegationStrategy) {\n    DelegationStrategy[DelegationStrategy[\"none\"] = 0] = \"none\";\n    DelegationStrategy[DelegationStrategy[\"capturing\"] = 1] = \"capturing\";\n    DelegationStrategy[DelegationStrategy[\"bubbling\"] = 2] = \"bubbling\";\n})(DelegationStrategy || (DelegationStrategy = {}));\nexport var CollectionKind;\n(function (CollectionKind) {\n    CollectionKind[CollectionKind[\"indexed\"] = 8] = \"indexed\";\n    CollectionKind[CollectionKind[\"keyed\"] = 4] = \"keyed\";\n    CollectionKind[CollectionKind[\"array\"] = 9] = \"array\";\n    CollectionKind[CollectionKind[\"map\"] = 6] = \"map\";\n    CollectionKind[CollectionKind[\"set\"] = 7] = \"set\";\n})(CollectionKind || (CollectionKind = {}));\nexport function copyIndexMap(existing, deletedItems) {\n    const { length } = existing;\n    const arr = Array(length);\n    let i = 0;\n    while (i < length) {\n        arr[i] = existing[i];\n        ++i;\n    }\n    if (deletedItems !== void 0) {\n        arr.deletedItems = deletedItems.slice(0);\n    }\n    else if (existing.deletedItems !== void 0) {\n        arr.deletedItems = existing.deletedItems.slice(0);\n    }\n    else {\n        arr.deletedItems = [];\n    }\n    arr.isIndexMap = true;\n    return arr;\n}\nexport function createIndexMap(length = 0) {\n    const arr = Array(length);\n    let i = 0;\n    while (i < length) {\n        arr[i] = i++;\n    }\n    arr.deletedItems = [];\n    arr.isIndexMap = true;\n    return arr;\n}\nexport function cloneIndexMap(indexMap) {\n    const clone = indexMap.slice();\n    clone.deletedItems = indexMap.deletedItems.slice();\n    clone.isIndexMap = true;\n    return clone;\n}\nexport function isIndexMap(value) {\n    return value instanceof Array && value.isIndexMap === true;\n}\n//# sourceMappingURL=observation.js.map","import { __decorate, __metadata } from \"tslib\";\nimport { subscriberCollection } from './subscriber-collection';\nlet CollectionLengthObserver = class CollectionLengthObserver {\n    constructor(obj) {\n        this.obj = obj;\n        this.currentValue = obj.length;\n    }\n    getValue() {\n        return this.obj.length;\n    }\n    setValue(newValue, flags) {\n        const { currentValue } = this;\n        if (newValue !== currentValue) {\n            this.currentValue = newValue;\n            this.callSubscribers(newValue, currentValue, flags | 16 /* updateTargetInstance */);\n        }\n    }\n};\nCollectionLengthObserver = __decorate([\n    subscriberCollection(),\n    __metadata(\"design:paramtypes\", [Array])\n], CollectionLengthObserver);\nexport { CollectionLengthObserver };\n//# sourceMappingURL=collection-length-observer.js.map","import { __decorate, __metadata } from \"tslib\";\nimport { ILifecycle } from '../lifecycle';\nimport { createIndexMap } from '../observation';\nimport { CollectionLengthObserver } from './collection-length-observer';\nimport { collectionSubscriberCollection, subscriberCollection } from './subscriber-collection';\nconst observerLookup = new WeakMap();\n// https://tc39.github.io/ecma262/#sec-sortcompare\nfunction sortCompare(x, y) {\n    if (x === y) {\n        return 0;\n    }\n    x = x === null ? 'null' : x.toString();\n    y = y === null ? 'null' : y.toString();\n    return x < y ? -1 : 1;\n}\nfunction preSortCompare(x, y) {\n    if (x === void 0) {\n        if (y === void 0) {\n            return 0;\n        }\n        else {\n            return 1;\n        }\n    }\n    if (y === void 0) {\n        return -1;\n    }\n    return 0;\n}\nfunction insertionSort(arr, indexMap, from, to, compareFn) {\n    let velement, ielement, vtmp, itmp, order;\n    let i, j;\n    for (i = from + 1; i < to; i++) {\n        velement = arr[i];\n        ielement = indexMap[i];\n        for (j = i - 1; j >= from; j--) {\n            vtmp = arr[j];\n            itmp = indexMap[j];\n            order = compareFn(vtmp, velement);\n            if (order > 0) {\n                arr[j + 1] = vtmp;\n                indexMap[j + 1] = itmp;\n            }\n            else {\n                break;\n            }\n        }\n        arr[j + 1] = velement;\n        indexMap[j + 1] = ielement;\n    }\n}\nfunction quickSort(arr, indexMap, from, to, compareFn) {\n    let thirdIndex = 0, i = 0;\n    let v0, v1, v2;\n    let i0, i1, i2;\n    let c01, c02, c12;\n    let vtmp, itmp;\n    let vpivot, ipivot, lowEnd, highStart;\n    let velement, ielement, order, vtopElement;\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n        if (to - from <= 10) {\n            insertionSort(arr, indexMap, from, to, compareFn);\n            return;\n        }\n        thirdIndex = from + ((to - from) >> 1);\n        v0 = arr[from];\n        i0 = indexMap[from];\n        v1 = arr[to - 1];\n        i1 = indexMap[to - 1];\n        v2 = arr[thirdIndex];\n        i2 = indexMap[thirdIndex];\n        c01 = compareFn(v0, v1);\n        if (c01 > 0) {\n            vtmp = v0;\n            itmp = i0;\n            v0 = v1;\n            i0 = i1;\n            v1 = vtmp;\n            i1 = itmp;\n        }\n        c02 = compareFn(v0, v2);\n        if (c02 >= 0) {\n            vtmp = v0;\n            itmp = i0;\n            v0 = v2;\n            i0 = i2;\n            v2 = v1;\n            i2 = i1;\n            v1 = vtmp;\n            i1 = itmp;\n        }\n        else {\n            c12 = compareFn(v1, v2);\n            if (c12 > 0) {\n                vtmp = v1;\n                itmp = i1;\n                v1 = v2;\n                i1 = i2;\n                v2 = vtmp;\n                i2 = itmp;\n            }\n        }\n        arr[from] = v0;\n        indexMap[from] = i0;\n        arr[to - 1] = v2;\n        indexMap[to - 1] = i2;\n        vpivot = v1;\n        ipivot = i1;\n        lowEnd = from + 1;\n        highStart = to - 1;\n        arr[thirdIndex] = arr[lowEnd];\n        indexMap[thirdIndex] = indexMap[lowEnd];\n        arr[lowEnd] = vpivot;\n        indexMap[lowEnd] = ipivot;\n        partition: for (i = lowEnd + 1; i < highStart; i++) {\n            velement = arr[i];\n            ielement = indexMap[i];\n            order = compareFn(velement, vpivot);\n            if (order < 0) {\n                arr[i] = arr[lowEnd];\n                indexMap[i] = indexMap[lowEnd];\n                arr[lowEnd] = velement;\n                indexMap[lowEnd] = ielement;\n                lowEnd++;\n            }\n            else if (order > 0) {\n                do {\n                    highStart--;\n                    // eslint-disable-next-line eqeqeq\n                    if (highStart == i) {\n                        break partition;\n                    }\n                    vtopElement = arr[highStart];\n                    order = compareFn(vtopElement, vpivot);\n                } while (order > 0);\n                arr[i] = arr[highStart];\n                indexMap[i] = indexMap[highStart];\n                arr[highStart] = velement;\n                indexMap[highStart] = ielement;\n                if (order < 0) {\n                    velement = arr[i];\n                    ielement = indexMap[i];\n                    arr[i] = arr[lowEnd];\n                    indexMap[i] = indexMap[lowEnd];\n                    arr[lowEnd] = velement;\n                    indexMap[lowEnd] = ielement;\n                    lowEnd++;\n                }\n            }\n        }\n        if (to - highStart < lowEnd - from) {\n            quickSort(arr, indexMap, highStart, to, compareFn);\n            to = lowEnd;\n        }\n        else {\n            quickSort(arr, indexMap, from, lowEnd, compareFn);\n            from = highStart;\n        }\n    }\n}\nconst proto = Array.prototype;\nconst $push = proto.push;\nconst $unshift = proto.unshift;\nconst $pop = proto.pop;\nconst $shift = proto.shift;\nconst $splice = proto.splice;\nconst $reverse = proto.reverse;\nconst $sort = proto.sort;\nconst native = { push: $push, unshift: $unshift, pop: $pop, shift: $shift, splice: $splice, reverse: $reverse, sort: $sort };\nconst methods = ['push', 'unshift', 'pop', 'shift', 'splice', 'reverse', 'sort'];\nconst observe = {\n    // https://tc39.github.io/ecma262/#sec-array.prototype.push\n    push: function (...args) {\n        let $this = this;\n        if ($this.$raw !== void 0) {\n            $this = $this.$raw;\n        }\n        const o = observerLookup.get($this);\n        if (o === void 0) {\n            return $push.apply($this, args);\n        }\n        const len = $this.length;\n        const argCount = args.length;\n        if (argCount === 0) {\n            return len;\n        }\n        $this.length = o.indexMap.length = len + argCount;\n        let i = len;\n        while (i < $this.length) {\n            $this[i] = args[i - len];\n            o.indexMap[i] = -2;\n            i++;\n        }\n        o.notify();\n        return $this.length;\n    },\n    // https://tc39.github.io/ecma262/#sec-array.prototype.unshift\n    unshift: function (...args) {\n        let $this = this;\n        if ($this.$raw !== void 0) {\n            $this = $this.$raw;\n        }\n        const o = observerLookup.get($this);\n        if (o === void 0) {\n            return $unshift.apply($this, args);\n        }\n        const argCount = args.length;\n        const inserts = new Array(argCount);\n        let i = 0;\n        while (i < argCount) {\n            inserts[i++] = -2;\n        }\n        $unshift.apply(o.indexMap, inserts);\n        const len = $unshift.apply($this, args);\n        o.notify();\n        return len;\n    },\n    // https://tc39.github.io/ecma262/#sec-array.prototype.pop\n    pop: function () {\n        let $this = this;\n        if ($this.$raw !== void 0) {\n            $this = $this.$raw;\n        }\n        const o = observerLookup.get($this);\n        if (o === void 0) {\n            return $pop.call($this);\n        }\n        const indexMap = o.indexMap;\n        const element = $pop.call($this);\n        // only mark indices as deleted if they actually existed in the original array\n        const index = indexMap.length - 1;\n        if (indexMap[index] > -1) {\n            indexMap.deletedItems.push(indexMap[index]);\n        }\n        $pop.call(indexMap);\n        o.notify();\n        return element;\n    },\n    // https://tc39.github.io/ecma262/#sec-array.prototype.shift\n    shift: function () {\n        let $this = this;\n        if ($this.$raw !== void 0) {\n            $this = $this.$raw;\n        }\n        const o = observerLookup.get($this);\n        if (o === void 0) {\n            return $shift.call($this);\n        }\n        const indexMap = o.indexMap;\n        const element = $shift.call($this);\n        // only mark indices as deleted if they actually existed in the original array\n        if (indexMap[0] > -1) {\n            indexMap.deletedItems.push(indexMap[0]);\n        }\n        $shift.call(indexMap);\n        o.notify();\n        return element;\n    },\n    // https://tc39.github.io/ecma262/#sec-array.prototype.splice\n    splice: function (...args) {\n        const start = args[0];\n        const deleteCount = args[1];\n        let $this = this;\n        if ($this.$raw !== void 0) {\n            $this = $this.$raw;\n        }\n        const o = observerLookup.get($this);\n        if (o === void 0) {\n            return $splice.apply($this, args);\n        }\n        const len = this.length;\n        const relativeStart = start | 0;\n        const actualStart = relativeStart < 0 ? Math.max((len + relativeStart), 0) : Math.min(relativeStart, len);\n        const indexMap = o.indexMap;\n        const argCount = args.length;\n        const actualDeleteCount = argCount === 0 ? 0 : argCount === 1 ? len - actualStart : deleteCount;\n        if (actualDeleteCount > 0) {\n            let i = actualStart;\n            const to = i + actualDeleteCount;\n            while (i < to) {\n                if (indexMap[i] > -1) {\n                    indexMap.deletedItems.push(indexMap[i]);\n                }\n                i++;\n            }\n        }\n        if (argCount > 2) {\n            const itemCount = argCount - 2;\n            const inserts = new Array(itemCount);\n            let i = 0;\n            while (i < itemCount) {\n                inserts[i++] = -2;\n            }\n            $splice.call(indexMap, start, deleteCount, ...inserts);\n        }\n        else {\n            $splice.apply(indexMap, args);\n        }\n        const deleted = $splice.apply($this, args);\n        o.notify();\n        return deleted;\n    },\n    // https://tc39.github.io/ecma262/#sec-array.prototype.reverse\n    reverse: function () {\n        let $this = this;\n        if ($this.$raw !== void 0) {\n            $this = $this.$raw;\n        }\n        const o = observerLookup.get($this);\n        if (o === void 0) {\n            $reverse.call($this);\n            return this;\n        }\n        const len = $this.length;\n        const middle = (len / 2) | 0;\n        let lower = 0;\n        while (lower !== middle) {\n            const upper = len - lower - 1;\n            const lowerValue = $this[lower];\n            const lowerIndex = o.indexMap[lower];\n            const upperValue = $this[upper];\n            const upperIndex = o.indexMap[upper];\n            $this[lower] = upperValue;\n            o.indexMap[lower] = upperIndex;\n            $this[upper] = lowerValue;\n            o.indexMap[upper] = lowerIndex;\n            lower++;\n        }\n        o.notify();\n        return this;\n    },\n    // https://tc39.github.io/ecma262/#sec-array.prototype.sort\n    // https://github.com/v8/v8/blob/master/src/js/array.js\n    sort: function (compareFn) {\n        let $this = this;\n        if ($this.$raw !== void 0) {\n            $this = $this.$raw;\n        }\n        const o = observerLookup.get($this);\n        if (o === void 0) {\n            $sort.call($this, compareFn);\n            return this;\n        }\n        const len = $this.length;\n        if (len < 2) {\n            return this;\n        }\n        quickSort($this, o.indexMap, 0, len, preSortCompare);\n        let i = 0;\n        while (i < len) {\n            if ($this[i] === void 0) {\n                break;\n            }\n            i++;\n        }\n        if (compareFn === void 0 || typeof compareFn !== 'function' /* spec says throw a TypeError, should we do that too? */) {\n            compareFn = sortCompare;\n        }\n        quickSort($this, o.indexMap, 0, i, compareFn);\n        o.notify();\n        return this;\n    }\n};\nconst descriptorProps = {\n    writable: true,\n    enumerable: false,\n    configurable: true\n};\nconst def = Reflect.defineProperty;\nfor (const method of methods) {\n    def(observe[method], 'observing', { value: true, writable: false, configurable: false, enumerable: false });\n}\nlet enableArrayObservationCalled = false;\nexport function enableArrayObservation() {\n    for (const method of methods) {\n        if (proto[method].observing !== true) {\n            def(proto, method, { ...descriptorProps, value: observe[method] });\n        }\n    }\n}\nexport function disableArrayObservation() {\n    for (const method of methods) {\n        if (proto[method].observing === true) {\n            def(proto, method, { ...descriptorProps, value: native[method] });\n        }\n    }\n}\nlet ArrayObserver = class ArrayObserver {\n    constructor(flags, lifecycle, array) {\n        if (!enableArrayObservationCalled) {\n            enableArrayObservationCalled = true;\n            enableArrayObservation();\n        }\n        this.inBatch = false;\n        this.indexObservers = {};\n        this.collection = array;\n        this.persistentFlags = flags & 2080374799 /* persistentBindingFlags */;\n        this.indexMap = createIndexMap(array.length);\n        this.lifecycle = lifecycle;\n        this.lengthObserver = (void 0);\n        observerLookup.set(array, this);\n    }\n    notify() {\n        if (this.lifecycle.batch.depth > 0) {\n            if (!this.inBatch) {\n                this.inBatch = true;\n                this.lifecycle.batch.add(this);\n            }\n        }\n        else {\n            this.flushBatch(0 /* none */);\n        }\n    }\n    getLengthObserver() {\n        if (this.lengthObserver === void 0) {\n            this.lengthObserver = new CollectionLengthObserver(this.collection);\n        }\n        return this.lengthObserver;\n    }\n    getIndexObserver(index) {\n        return this.getOrCreateIndexObserver(index);\n    }\n    flushBatch(flags) {\n        this.inBatch = false;\n        const indexMap = this.indexMap;\n        const length = this.collection.length;\n        this.indexMap = createIndexMap(length);\n        this.callCollectionSubscribers(indexMap, 16 /* updateTargetInstance */ | this.persistentFlags);\n        if (this.lengthObserver !== void 0) {\n            this.lengthObserver.setValue(length, 16 /* updateTargetInstance */);\n        }\n    }\n    /**\n     * @internal used by friend class ArrayIndexObserver only\n     */\n    addIndexObserver(indexObserver) {\n        this.addCollectionSubscriber(indexObserver);\n    }\n    /**\n     * @internal used by friend class ArrayIndexObserver only\n     */\n    removeIndexObserver(indexObserver) {\n        this.removeCollectionSubscriber(indexObserver);\n    }\n    /**\n     * @internal\n     */\n    getOrCreateIndexObserver(index) {\n        const indexObservers = this.indexObservers;\n        let observer = indexObservers[index];\n        if (observer === void 0) {\n            observer = indexObservers[index] = new ArrayIndexObserver(this, index);\n        }\n        return observer;\n    }\n};\nArrayObserver = __decorate([\n    collectionSubscriberCollection(),\n    __metadata(\"design:paramtypes\", [Number, Object, Object])\n], ArrayObserver);\nexport { ArrayObserver };\nlet ArrayIndexObserver = class ArrayIndexObserver {\n    constructor(owner, index) {\n        this.owner = owner;\n        this.index = index;\n        this.subscriberCount = 0;\n        this.currentValue = this.getValue();\n    }\n    getValue() {\n        return this.owner.collection[this.index];\n    }\n    setValue(newValue, flags) {\n        if (newValue === this.getValue()) {\n            return;\n        }\n        const arrayObserver = this.owner;\n        const index = this.index;\n        const indexMap = arrayObserver.indexMap;\n        if (indexMap[index] > -1) {\n            indexMap.deletedItems.push(indexMap[index]);\n        }\n        indexMap[index] = -2;\n        // do not need to update current value here\n        // as it will be updated inside handle collection change\n        arrayObserver.collection[index] = newValue;\n        arrayObserver.notify();\n    }\n    /**\n     * From interface `ICollectionSubscriber`\n     */\n    handleCollectionChange(indexMap, flags) {\n        const index = this.index;\n        const noChange = indexMap[index] === index;\n        if (noChange) {\n            return;\n        }\n        const prevValue = this.currentValue;\n        const currValue = this.currentValue = this.getValue();\n        // hmm\n        if (prevValue !== currValue) {\n            this.callSubscribers(currValue, prevValue, flags);\n        }\n    }\n    subscribe(subscriber) {\n        if (this.addSubscriber(subscriber) && ++this.subscriberCount === 1) {\n            this.owner.addIndexObserver(this);\n        }\n    }\n    unsubscribe(subscriber) {\n        if (this.removeSubscriber(subscriber) && --this.subscriberCount === 0) {\n            this.owner.removeIndexObserver(this);\n        }\n    }\n};\nArrayIndexObserver = __decorate([\n    subscriberCollection(),\n    __metadata(\"design:paramtypes\", [ArrayObserver, Number])\n], ArrayIndexObserver);\nexport { ArrayIndexObserver };\nexport function getArrayObserver(flags, lifecycle, array) {\n    const observer = observerLookup.get(array);\n    if (observer === void 0) {\n        return new ArrayObserver(flags, lifecycle, array);\n    }\n    return observer;\n}\n/**\n * Applies offsets to the non-negative indices in the IndexMap\n * based on added and deleted items relative to those indices.\n *\n * e.g. turn `[-2, 0, 1]` into `[-2, 1, 2]`, allowing the values at the indices to be\n * used for sorting/reordering items if needed\n */\nexport function applyMutationsToIndices(indexMap) {\n    let offset = 0;\n    let j = 0;\n    const len = indexMap.length;\n    for (let i = 0; i < len; ++i) {\n        while (indexMap.deletedItems[j] <= i - offset) {\n            ++j;\n            --offset;\n        }\n        if (indexMap[i] === -2) {\n            ++offset;\n        }\n        else {\n            indexMap[i] += offset;\n        }\n    }\n}\n/**\n * After `applyMutationsToIndices`, this function can be used to reorder items in a derived\n * array (e.g.  the items in the `views` in the repeater are derived from the `items` property)\n */\nexport function synchronizeIndices(items, indexMap) {\n    const copy = items.slice();\n    const len = indexMap.length;\n    let to = 0;\n    let from = 0;\n    while (to < len) {\n        from = indexMap[to];\n        if (from !== -2) {\n            items[to] = copy[from];\n        }\n        ++to;\n    }\n}\n//# sourceMappingURL=array-observer.js.map","import { __decorate, __metadata } from \"tslib\";\n/* eslint-disable eqeqeq, compat/compat */\nimport { PLATFORM, Reporter, isArrayIndex } from '@aurelia/kernel';\nimport { IObserverLocator } from './observer-locator';\nimport { subscriberCollection } from './subscriber-collection';\nexport function computed(config) {\n    return function (target, key) {\n        /**\n         * The 'computed' property defined on prototype needs to be non-enumerable to prevent getting this in loops,\n         * iterating over object properties, such as for..in.\n         *\n         * The 'value' of the property should not have any prototype. Otherwise if by mistake the target passed\n         * here is `Object`, then we are in soup. Because then every instance of `Object` will have the `computed`\n         * property, including the `value` (in the descriptor of the property), when assigned `{}`. This might\n         * lead to infinite recursion for the cases as mentioned above.\n         */\n        if (target.computed == null) {\n            Reflect.defineProperty(target, 'computed', {\n                writable: true,\n                configurable: true,\n                enumerable: false,\n                value: Object.create(null)\n            });\n        }\n        // eslint-disable-next-line @typescript-eslint/no-unnecessary-type-assertion\n        target.computed[key] = config;\n    };\n}\nconst computedOverrideDefaults = { static: false, volatile: false };\n/* @internal */\nexport function createComputedObserver(flags, observerLocator, dirtyChecker, lifecycle, instance, propertyName, descriptor) {\n    if (descriptor.configurable === false) {\n        return dirtyChecker.createProperty(instance, propertyName);\n    }\n    if (descriptor.get != null) {\n        const { constructor: { prototype: { computed: givenOverrides } } } = instance;\n        // eslint-disable-next-line @typescript-eslint/strict-boolean-expressions, @typescript-eslint/no-unnecessary-type-assertion\n        const overrides = givenOverrides && givenOverrides[propertyName] || computedOverrideDefaults;\n        if (descriptor.set != null) {\n            if (overrides.volatile) {\n                return new GetterObserver(flags, overrides, instance, propertyName, descriptor, observerLocator);\n            }\n            return new CustomSetterObserver(instance, propertyName, descriptor);\n        }\n        return new GetterObserver(flags, overrides, instance, propertyName, descriptor, observerLocator);\n    }\n    throw Reporter.error(18, propertyName);\n}\n// Used when the getter is dependent solely on changes that happen within the setter.\nlet CustomSetterObserver = class CustomSetterObserver {\n    constructor(obj, propertyKey, descriptor) {\n        this.obj = obj;\n        this.propertyKey = propertyKey;\n        this.descriptor = descriptor;\n        this.currentValue = void 0;\n        this.oldValue = void 0;\n        this.observing = false;\n    }\n    setValue(newValue) {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion, @typescript-eslint/no-unnecessary-type-assertion\n        this.descriptor.set.call(this.obj, newValue); // Non-null is implied because descriptors without setters won't end up here\n        if (this.currentValue !== newValue) {\n            this.oldValue = this.currentValue;\n            this.currentValue = newValue;\n            this.callSubscribers(newValue, this.oldValue, 16 /* updateTargetInstance */);\n        }\n    }\n    subscribe(subscriber) {\n        if (!this.observing) {\n            this.convertProperty();\n        }\n        this.addSubscriber(subscriber);\n    }\n    unsubscribe(subscriber) {\n        this.removeSubscriber(subscriber);\n    }\n    convertProperty() {\n        this.observing = true;\n        this.currentValue = this.obj[this.propertyKey];\n        const set = (newValue) => { this.setValue(newValue); };\n        Reflect.defineProperty(this.obj, this.propertyKey, { set, get: this.descriptor.get });\n    }\n};\nCustomSetterObserver = __decorate([\n    subscriberCollection(),\n    __metadata(\"design:paramtypes\", [Object, String, Object])\n], CustomSetterObserver);\nexport { CustomSetterObserver };\n// Used when there is no setter, and the getter is dependent on other properties of the object;\n// Used when there is a setter but the value of the getter can change based on properties set outside of the setter.\nlet GetterObserver = class GetterObserver {\n    constructor(flags, overrides, obj, propertyKey, descriptor, observerLocator) {\n        this.overrides = overrides;\n        this.obj = obj;\n        this.propertyKey = propertyKey;\n        this.descriptor = descriptor;\n        this.currentValue = void 0;\n        this.oldValue = void 0;\n        this.propertyDeps = [];\n        this.collectionDeps = [];\n        this.subscriberCount = 0;\n        this.isCollecting = false;\n        this.proxy = new Proxy(obj, createGetterTraps(flags, observerLocator, this));\n        const get = () => this.getValue();\n        Reflect.defineProperty(obj, propertyKey, { get, set: descriptor.set });\n    }\n    addPropertyDep(subscribable) {\n        if (!this.propertyDeps.includes(subscribable)) {\n            this.propertyDeps.push(subscribable);\n        }\n    }\n    addCollectionDep(subscribable) {\n        if (!this.collectionDeps.includes(subscribable)) {\n            this.collectionDeps.push(subscribable);\n        }\n    }\n    getValue() {\n        if (this.subscriberCount > 0 || this.isCollecting) {\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            this.currentValue = Reflect.apply(this.descriptor.get, this.proxy, PLATFORM.emptyArray); // Non-null is implied because descriptors without getters won't end up here\n        }\n        else {\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            this.currentValue = Reflect.apply(this.descriptor.get, this.obj, PLATFORM.emptyArray); // Non-null is implied because descriptors without getters won't end up here\n        }\n        return this.currentValue;\n    }\n    subscribe(subscriber) {\n        this.addSubscriber(subscriber);\n        if (++this.subscriberCount === 1) {\n            this.getValueAndCollectDependencies(true);\n        }\n    }\n    unsubscribe(subscriber) {\n        this.removeSubscriber(subscriber);\n        if (--this.subscriberCount === 0) {\n            this.unsubscribeAllDependencies();\n        }\n    }\n    handleChange() {\n        const oldValue = this.currentValue;\n        const newValue = this.getValueAndCollectDependencies(false);\n        if (oldValue !== newValue) {\n            this.callSubscribers(newValue, oldValue, 16 /* updateTargetInstance */);\n        }\n    }\n    handleCollectionChange() {\n        const oldValue = this.currentValue;\n        const newValue = this.getValueAndCollectDependencies(false);\n        if (oldValue !== newValue) {\n            this.callSubscribers(newValue, oldValue, 16 /* updateTargetInstance */);\n        }\n    }\n    getValueAndCollectDependencies(requireCollect) {\n        const dynamicDependencies = !this.overrides.static || requireCollect;\n        if (dynamicDependencies) {\n            this.unsubscribeAllDependencies();\n            this.isCollecting = true;\n        }\n        this.currentValue = this.getValue();\n        if (dynamicDependencies) {\n            this.propertyDeps.forEach(x => { x.subscribe(this); });\n            this.collectionDeps.forEach(x => { x.subscribeToCollection(this); });\n            this.isCollecting = false;\n        }\n        return this.currentValue;\n    }\n    doNotCollect(target, key, receiver) {\n        return !this.isCollecting\n            || key === '$observers'\n            || key === '$synthetic'\n            || key === 'constructor';\n    }\n    unsubscribeAllDependencies() {\n        this.propertyDeps.forEach(x => { x.unsubscribe(this); });\n        this.propertyDeps.length = 0;\n        this.collectionDeps.forEach(x => { x.unsubscribeFromCollection(this); });\n        this.collectionDeps.length = 0;\n    }\n};\nGetterObserver = __decorate([\n    subscriberCollection(),\n    __metadata(\"design:paramtypes\", [Number, Object, Object, String, Object, Object])\n], GetterObserver);\nexport { GetterObserver };\nconst toStringTag = Object.prototype.toString;\n/**\n * _@param observer The owning observer of current evaluation, will subscribe to all observers created via proxy\n */\nfunction createGetterTraps(flags, observerLocator, observer) {\n    return {\n        get: function (target, key, receiver) {\n            if (observer.doNotCollect(target, key, receiver)) {\n                return Reflect.get(target, key, receiver);\n            }\n            // The length and iterator properties need to be invoked on the original object\n            // (for Map and Set at least) or they will throw.\n            switch (toStringTag.call(target)) {\n                case '[object Array]':\n                    if (key === 'length' || isArrayIndex(key)) {\n                        observer.addCollectionDep(observerLocator.getArrayObserver(flags, target));\n                        return proxyOrValue(flags, target, key, observerLocator, observer);\n                    }\n                    break;\n                case '[object Map]':\n                    if (key === 'size') {\n                        observer.addCollectionDep(observerLocator.getMapObserver(flags, target));\n                        return Reflect.get(target, key, target);\n                    }\n                    break;\n                case '[object Set]':\n                    if (key === 'size') {\n                        observer.addCollectionDep(observerLocator.getSetObserver(flags, target));\n                        return Reflect.get(target, key, target);\n                    }\n                    break;\n            }\n            observer.addPropertyDep(observerLocator.getObserver(flags, target, key));\n            return proxyOrValue(flags, target, key, observerLocator, observer);\n        }\n    };\n}\n/**\n * _@param observer The owning observer of current evaluation, will subscribe to all observers created via proxy\n */\nfunction proxyOrValue(flags, target, key, observerLocator, observer) {\n    const value = Reflect.get(target, key, target);\n    if (typeof value !== 'object' || typeof value === 'function' || value === null) {\n        return value;\n    }\n    return new Proxy(value, createGetterTraps(flags, observerLocator, observer));\n}\n//# sourceMappingURL=computed-observer.js.map","import { __decorate, __metadata } from \"tslib\";\nimport { PLATFORM, DI, bound, Registration } from '@aurelia/kernel';\nconst defaultClockSettings = {\n    forceUpdateInterval: 10,\n    now: PLATFORM.now,\n};\nconst { enter, leave, trace, } = (function () {\n    const enabled = false;\n    let depth = 0;\n    function round(num) {\n        return ((num * 10 + .5) | 0) / 10;\n    }\n    function log(prefix, obj, method) {\n        if (obj instanceof TaskQueue) {\n            const processing = obj['processingSize'];\n            const pending = obj['pendingSize'];\n            const delayed = obj['delayedSize'];\n            const flushReq = obj['flushRequested'];\n            const prio = obj['priority'];\n            const info = `processing=${processing} pending=${pending} delayed=${delayed} flushReq=${flushReq} prio=${prio}`;\n            console.log(`${prefix}[Q.${method}] ${info}`);\n        }\n        else {\n            const id = obj['id'];\n            const created = round(obj['createdTime']);\n            const queue = round(obj['queueTime']);\n            const preempt = obj['preempt'];\n            const reusable = obj['reusable'];\n            const persistent = obj['persistent'];\n            const status = obj['_status'];\n            const info = `id=${id} created=${created} queue=${queue} preempt=${preempt} persistent=${persistent} reusable=${reusable} status=${status}`;\n            console.log(`${prefix}[T.${method}] ${info}`);\n        }\n    }\n    function $enter(obj, method) {\n        if (enabled) {\n            log(`${'  '.repeat(depth++)}> `, obj, method);\n        }\n    }\n    function $leave(obj, method) {\n        if (enabled) {\n            log(`${'  '.repeat(--depth)}< `, obj, method);\n        }\n    }\n    function $trace(obj, method) {\n        if (enabled) {\n            log(`${'  '.repeat(depth)}- `, obj, method);\n        }\n    }\n    return {\n        enter: $enter,\n        leave: $leave,\n        trace: $trace,\n    };\n})();\nexport const IClock = DI.createInterface('IClock').withDefault(x => x.instance(globalClock));\nexport class Clock {\n    constructor(opts) {\n        const { now, forceUpdateInterval } = { ...defaultClockSettings, ...opts };\n        this.now = function (highRes = false) {\n            // if (++requests === forceUpdateInterval || highRes) {\n            //   requests = 0;\n            //   timestamp = now();\n            // }\n            // return timestamp;\n            return now();\n        };\n    }\n    static register(container) {\n        return Registration.singleton(IClock, this).register(container);\n    }\n}\nexport const globalClock = new Clock();\nexport var TaskQueuePriority;\n(function (TaskQueuePriority) {\n    TaskQueuePriority[TaskQueuePriority[\"microTask\"] = 0] = \"microTask\";\n    TaskQueuePriority[TaskQueuePriority[\"render\"] = 1] = \"render\";\n    TaskQueuePriority[TaskQueuePriority[\"macroTask\"] = 2] = \"macroTask\";\n    TaskQueuePriority[TaskQueuePriority[\"postRender\"] = 3] = \"postRender\";\n    TaskQueuePriority[TaskQueuePriority[\"idle\"] = 4] = \"idle\";\n})(TaskQueuePriority || (TaskQueuePriority = {}));\nexport const IScheduler = DI.createInterface('IScheduler').noDefault();\nconst createPromise = (function () {\n    let $resolve = void 0;\n    let $reject = void 0;\n    function executor(resolve, reject) {\n        $resolve = resolve;\n        $reject = reject;\n    }\n    return function () {\n        const p = new Promise(executor);\n        p.resolve = $resolve;\n        p.reject = $reject;\n        $resolve = void 0;\n        $reject = void 0;\n        return p;\n    };\n})();\nconst defaultQueueTaskOptions = {\n    delay: 0,\n    preempt: false,\n    priority: 1 /* render */,\n    persistent: false,\n    reusable: true,\n};\nexport class TaskQueue {\n    constructor({ clock, priority, scheduler }) {\n        this.processingSize = 0;\n        this.processingHead = void 0;\n        this.processingTail = void 0;\n        this.pendingSize = 0;\n        this.pendingHead = void 0;\n        this.pendingTail = void 0;\n        this.delayedSize = 0;\n        this.delayedHead = void 0;\n        this.delayedTail = void 0;\n        this.flushRequested = false;\n        this.yieldPromise = void 0;\n        this.taskPool = [];\n        this.taskPoolSize = 0;\n        this.lastRequest = 0;\n        this.microTaskRequestFlushTask = null;\n        this.priority = priority;\n        this.scheduler = scheduler;\n        this.clock = clock;\n    }\n    get isEmpty() {\n        return this.processingSize === 0 && this.pendingSize === 0 && this.delayedSize === 0;\n    }\n    flush() {\n        enter(this, 'flush');\n        if (this.microTaskRequestFlushTask !== null) {\n            this.microTaskRequestFlushTask.cancel();\n            this.microTaskRequestFlushTask = null;\n        }\n        this.clock.now(true);\n        this.flushRequested = false;\n        if (this.pendingSize > 0) {\n            this.movePendingToProcessing();\n        }\n        if (this.delayedSize > 0) {\n            this.moveDelayedToProcessing();\n        }\n        while (this.processingSize > 0) {\n            this.processingHead.run();\n        }\n        if (this.pendingSize > 0) {\n            this.movePendingToProcessing();\n        }\n        if (this.delayedSize > 0) {\n            this.moveDelayedToProcessing();\n        }\n        if (this.processingSize > 0) {\n            this.requestFlush();\n        }\n        else if (this.delayedSize > 0) {\n            if (this.priority <= 0 /* microTask */) {\n                // MicroTasks are not clamped so we have to clamp them with setTimeout or they'll block forever\n                this.microTaskRequestFlushTask = this.scheduler.getTaskQueue(2 /* macroTask */).queueTask(this.requestFlush);\n            }\n            else {\n                // Otherwise just let this queue handle itself\n                this.requestFlush();\n            }\n        }\n        if (this.yieldPromise !== void 0) {\n            let noMoreFiniteWork = true;\n            let cur = this.processingHead;\n            while (cur !== void 0) {\n                if (!cur.persistent) {\n                    noMoreFiniteWork = false;\n                    break;\n                }\n                cur = cur.next;\n            }\n            if (noMoreFiniteWork) {\n                cur = this.pendingHead;\n                while (cur !== void 0) {\n                    if (!cur.persistent) {\n                        noMoreFiniteWork = false;\n                        break;\n                    }\n                    cur = cur.next;\n                }\n            }\n            if (noMoreFiniteWork) {\n                cur = this.delayedHead;\n                while (cur !== void 0) {\n                    if (!cur.persistent) {\n                        noMoreFiniteWork = false;\n                        break;\n                    }\n                    cur = cur.next;\n                }\n            }\n            if (noMoreFiniteWork) {\n                const p = this.yieldPromise;\n                this.yieldPromise = void 0;\n                p.resolve();\n            }\n        }\n        leave(this, 'flush');\n    }\n    cancel() {\n        enter(this, 'cancel');\n        if (this.microTaskRequestFlushTask !== null) {\n            this.microTaskRequestFlushTask.cancel();\n            this.microTaskRequestFlushTask = null;\n        }\n        this.scheduler.cancelFlush(this);\n        this.flushRequested = false;\n        leave(this, 'cancel');\n    }\n    yield() {\n        enter(this, 'yield');\n        if (this.processingSize === 0 && this.pendingSize === 0 && this.delayedSize === 0) {\n            leave(this, 'yield empty');\n            return Promise.resolve();\n        }\n        if (this.yieldPromise === void 0) {\n            this.yieldPromise = createPromise();\n        }\n        leave(this, 'yield task');\n        return this.yieldPromise;\n    }\n    queueTask(callback, opts) {\n        enter(this, 'queueTask');\n        const { delay, preempt, persistent, reusable } = { ...defaultQueueTaskOptions, ...opts };\n        if (preempt) {\n            if (delay > 0) {\n                throw new Error(`Invalid arguments: preempt cannot be combined with a greater-than-zero delay`);\n            }\n            if (persistent) {\n                throw new Error(`Invalid arguments: preempt cannot be combined with persistent`);\n            }\n        }\n        if (persistent && this.priority === 0 /* microTask */) {\n            throw new Error(`Invalid arguments: cannot queue persistent tasks on the micro task queue`);\n        }\n        if (this.processingSize === 0) {\n            this.requestFlush();\n        }\n        const time = this.clock.now();\n        let task;\n        if (reusable) {\n            const taskPool = this.taskPool;\n            const index = this.taskPoolSize - 1;\n            if (index >= 0) {\n                task = taskPool[index];\n                taskPool[index] = (void 0);\n                this.taskPoolSize = index;\n                task.reuse(time, delay, preempt, persistent, callback);\n            }\n            else {\n                task = new Task(this, time, time + delay, preempt, persistent, reusable, callback);\n            }\n        }\n        else {\n            task = new Task(this, time, time + delay, preempt, persistent, reusable, callback);\n        }\n        if (preempt) {\n            if (this.processingSize++ === 0) {\n                this.processingHead = this.processingTail = task;\n            }\n            else {\n                this.processingTail = (task.prev = this.processingTail).next = task;\n            }\n        }\n        else if (delay === 0) {\n            if (this.pendingSize++ === 0) {\n                this.pendingHead = this.pendingTail = task;\n            }\n            else {\n                this.pendingTail = (task.prev = this.pendingTail).next = task;\n            }\n        }\n        else {\n            if (this.delayedSize++ === 0) {\n                this.delayedHead = this.delayedTail = task;\n            }\n            else {\n                this.delayedTail = (task.prev = this.delayedTail).next = task;\n            }\n        }\n        leave(this, 'queueTask');\n        return task;\n    }\n    take(task) {\n        enter(this, 'take');\n        if (task.status !== 'pending') {\n            leave(this, 'take error');\n            throw new Error('Can only take pending tasks.');\n        }\n        if (this.processingSize === 0) {\n            this.requestFlush();\n        }\n        task.taskQueue.remove(task);\n        if (task.preempt) {\n            this.addToProcessing(task);\n        }\n        else if (task.queueTime <= this.clock.now()) {\n            this.addToPending(task);\n        }\n        else {\n            this.addToDelayed(task);\n        }\n        leave(this, 'take');\n    }\n    remove(task) {\n        enter(this, 'remove');\n        if (task.preempt) {\n            // Fast path - preempt task can only ever end up in the processing queue\n            this.removeFromProcessing(task);\n            leave(this, 'remove processing fast');\n            return;\n        }\n        if (task.queueTime > this.clock.now()) {\n            // Fast path - task with queueTime in the future can only ever be in the delayed queue\n            this.removeFromDelayed(task);\n            leave(this, 'remove delayed fast');\n            return;\n        }\n        // Scan everything (we can make this faster by using the queueTime property, but this is good enough for now)\n        let cur = this.processingHead;\n        while (cur !== void 0) {\n            if (cur === task) {\n                this.removeFromProcessing(task);\n                leave(this, 'remove processing slow');\n                return;\n            }\n            cur = cur.next;\n        }\n        cur = this.pendingHead;\n        while (cur !== void 0) {\n            if (cur === task) {\n                this.removeFromPending(task);\n                leave(this, 'remove pending slow');\n                return;\n            }\n            cur = cur.next;\n        }\n        cur = this.delayedHead;\n        while (cur !== void 0) {\n            if (cur === task) {\n                this.removeFromDelayed(task);\n                leave(this, 'remove delayed slow');\n                return;\n            }\n            cur = cur.next;\n        }\n        leave(this, 'remove error');\n        throw new Error(`Task #${task.id} could not be found`);\n    }\n    returnToPool(task) {\n        trace(this, 'returnToPool');\n        this.taskPool[this.taskPoolSize++] = task;\n    }\n    resetPersistentTask(task) {\n        enter(this, 'resetPersistentTask');\n        task.reset(this.clock.now());\n        if (task.createdTime === task.queueTime) {\n            if (this.pendingSize++ === 0) {\n                this.pendingHead = this.pendingTail = task;\n                task.prev = task.next = void 0;\n            }\n            else {\n                this.pendingTail = (task.prev = this.pendingTail).next = task;\n                task.next = void 0;\n            }\n        }\n        else {\n            if (this.delayedSize++ === 0) {\n                this.delayedHead = this.delayedTail = task;\n                task.prev = task.next = void 0;\n            }\n            else {\n                this.delayedTail = (task.prev = this.delayedTail).next = task;\n                task.next = void 0;\n            }\n        }\n        leave(this, 'resetPersistentTask');\n    }\n    finish(task) {\n        enter(this, 'finish');\n        if (task.next !== void 0) {\n            task.next.prev = task.prev;\n        }\n        if (task.prev !== void 0) {\n            task.prev.next = task.next;\n        }\n        leave(this, 'finish');\n    }\n    removeFromProcessing(task) {\n        enter(this, 'removeFromProcessing');\n        if (this.processingHead === task) {\n            this.processingHead = task.next;\n        }\n        if (this.processingTail === task) {\n            this.processingTail = task.prev;\n        }\n        --this.processingSize;\n        this.finish(task);\n        leave(this, 'removeFromProcessing');\n    }\n    removeFromPending(task) {\n        enter(this, 'removeFromPending');\n        if (this.pendingHead === task) {\n            this.pendingHead = task.next;\n        }\n        if (this.pendingTail === task) {\n            this.pendingTail = task.prev;\n        }\n        --this.pendingSize;\n        this.finish(task);\n        leave(this, 'removeFromPending');\n    }\n    removeFromDelayed(task) {\n        enter(this, 'removeFromDelayed');\n        if (this.delayedHead === task) {\n            this.delayedHead = task.next;\n        }\n        if (this.delayedTail === task) {\n            this.delayedTail = task.prev;\n        }\n        --this.delayedSize;\n        this.finish(task);\n        leave(this, 'removeFromDelayed');\n    }\n    addToProcessing(task) {\n        enter(this, 'addToProcessing');\n        if (this.processingSize++ === 0) {\n            this.processingHead = this.processingTail = task;\n        }\n        else {\n            this.processingTail = (task.prev = this.processingTail).next = task;\n        }\n        leave(this, 'addToProcessing');\n    }\n    addToPending(task) {\n        enter(this, 'addToPending');\n        if (this.pendingSize++ === 0) {\n            this.pendingHead = this.pendingTail = task;\n        }\n        else {\n            this.pendingTail = (task.prev = this.pendingTail).next = task;\n        }\n        leave(this, 'addToPending');\n    }\n    addToDelayed(task) {\n        enter(this, 'addToDelayed');\n        if (this.delayedSize++ === 0) {\n            this.delayedHead = this.delayedTail = task;\n        }\n        else {\n            this.delayedTail = (task.prev = this.delayedTail).next = task;\n        }\n        leave(this, 'addToDelayed');\n    }\n    movePendingToProcessing() {\n        enter(this, 'movePendingToProcessing');\n        // Add the previously pending tasks to the currently processing tasks\n        if (this.processingSize === 0) {\n            this.processingHead = this.pendingHead;\n            this.processingTail = this.pendingTail;\n            this.processingSize = this.pendingSize;\n        }\n        else {\n            this.processingTail.next = this.pendingHead;\n            this.processingTail = this.pendingTail;\n            this.processingSize += this.pendingSize;\n        }\n        this.pendingHead = void 0;\n        this.pendingTail = void 0;\n        this.pendingSize = 0;\n        leave(this, 'movePendingToProcessing');\n    }\n    moveDelayedToProcessing() {\n        enter(this, 'moveDelayedToProcessing');\n        const time = this.clock.now(true);\n        // Add any delayed tasks whose delay have expired to the currently processing tasks\n        const delayedHead = this.delayedHead;\n        if (delayedHead.queueTime <= time) {\n            let delayedTail = delayedHead;\n            let next = delayedTail.next;\n            let count = 1;\n            while (next !== void 0 && next.queueTime <= time) {\n                delayedTail = next;\n                next = delayedTail.next;\n                ++count;\n            }\n            if (this.processingSize === 0) {\n                this.processingHead = delayedHead;\n                this.processingTail = delayedTail;\n                this.processingSize = count;\n            }\n            else {\n                this.processingTail.next = delayedHead;\n                this.processingTail = delayedTail;\n                this.processingSize += count;\n            }\n            this.delayedHead = next;\n            this.delayedSize -= count;\n            if (this.delayedSize === 0) {\n                this.delayedTail = void 0;\n            }\n        }\n        leave(this, 'moveDelayedToProcessing');\n    }\n    requestFlush() {\n        enter(this, 'requestFlush');\n        if (this.microTaskRequestFlushTask !== null) {\n            this.microTaskRequestFlushTask.cancel();\n            this.microTaskRequestFlushTask = null;\n        }\n        if (!this.flushRequested) {\n            this.flushRequested = true;\n            this.lastRequest = this.clock.now(true);\n            this.scheduler.requestFlush(this);\n        }\n        leave(this, 'requestFlush');\n    }\n}\n__decorate([\n    bound,\n    __metadata(\"design:type\", Function),\n    __metadata(\"design:paramtypes\", []),\n    __metadata(\"design:returntype\", void 0)\n], TaskQueue.prototype, \"requestFlush\", null);\nexport class TaskAbortError extends Error {\n    constructor(task) {\n        super('Task was canceled.');\n        this.task = task;\n    }\n}\nlet id = 0;\nexport class Task {\n    constructor(taskQueue, createdTime, queueTime, preempt, persistent, reusable, callback) {\n        this.taskQueue = taskQueue;\n        this.createdTime = createdTime;\n        this.queueTime = queueTime;\n        this.preempt = preempt;\n        this.persistent = persistent;\n        this.reusable = reusable;\n        this.callback = callback;\n        this.id = ++id;\n        this.next = void 0;\n        this.prev = void 0;\n        this.resolve = void 0;\n        this.reject = void 0;\n        this._result = void 0;\n        this._status = 'pending';\n        trace(this, 'constructor');\n        this.priority = taskQueue.priority;\n    }\n    get result() {\n        const result = this._result;\n        if (result === void 0) {\n            switch (this._status) {\n                case 'pending': {\n                    const promise = this._result = createPromise();\n                    this.resolve = promise.resolve;\n                    this.reject = promise.reject;\n                    return promise;\n                }\n                case 'running':\n                    throw new Error('Trying to await task from within task will cause a deadlock.');\n                case 'completed':\n                    return this._result = Promise.resolve();\n                case 'canceled':\n                    return this._result = Promise.reject(new TaskAbortError(this));\n            }\n        }\n        return result;\n    }\n    get status() {\n        return this._status;\n    }\n    run() {\n        enter(this, 'run');\n        if (this._status !== 'pending') {\n            leave(this, 'run error');\n            throw new Error(`Cannot run task in ${this._status} state`);\n        }\n        // this.persistent could be changed while the task is running (this can only be done by the task itself if canceled, and is a valid way of stopping a loop)\n        // so we deliberately reference this.persistent instead of the local variable, but we keep it around to know whether the task *was* persistent before running it,\n        // so we can set the correct cancelation state.\n        const persistent = this.persistent;\n        const reusable = this.reusable;\n        const taskQueue = this.taskQueue;\n        const callback = this.callback;\n        const resolve = this.resolve;\n        const reject = this.reject;\n        const createdTime = this.createdTime;\n        taskQueue.remove(this);\n        this._status = 'running';\n        try {\n            const ret = callback(globalClock.now() - createdTime);\n            if (this.persistent) {\n                taskQueue.resetPersistentTask(this);\n            }\n            else if (persistent) {\n                // Persistent tasks never reach completed status. They're either pending, running, or canceled.\n                this._status = 'canceled';\n            }\n            else {\n                this._status = 'completed';\n            }\n            if (resolve !== void 0) {\n                resolve(ret);\n            }\n        }\n        catch (err) {\n            if (reject !== void 0) {\n                reject(err);\n            }\n            else {\n                throw err;\n            }\n        }\n        finally {\n            if (!this.persistent) {\n                this.dispose();\n                if (reusable) {\n                    taskQueue.returnToPool(this);\n                }\n            }\n            leave(this, 'run finally');\n        }\n    }\n    cancel() {\n        enter(this, 'cancel');\n        if (this._status === 'pending') {\n            const taskQueue = this.taskQueue;\n            const reusable = this.reusable;\n            const reject = this.reject;\n            taskQueue.remove(this);\n            if (taskQueue.isEmpty) {\n                taskQueue.cancel();\n            }\n            this._status = 'canceled';\n            if (reject !== void 0) {\n                reject(new TaskAbortError(this));\n            }\n            this.dispose();\n            if (reusable) {\n                taskQueue.returnToPool(this);\n            }\n            leave(this, 'cancel true =pending');\n            return true;\n        }\n        else if (this._status === 'running' && this.persistent) {\n            this.persistent = false;\n            leave(this, 'cancel true =running+persistent');\n            return true;\n        }\n        leave(this, 'cancel false');\n        return false;\n    }\n    reset(time) {\n        enter(this, 'reset');\n        const delay = this.queueTime - this.createdTime;\n        this.createdTime = time;\n        this.queueTime = time + delay;\n        this._status = 'pending';\n        this.resolve = void 0;\n        this.reject = void 0;\n        this._result = void 0;\n        leave(this, 'reset');\n    }\n    reuse(time, delay, preempt, persistent, callback) {\n        enter(this, 'reuse');\n        this.createdTime = time;\n        this.queueTime = time + delay;\n        this.preempt = preempt;\n        this.persistent = persistent;\n        this.callback = callback;\n        this._status = 'pending';\n        leave(this, 'reuse');\n    }\n    dispose() {\n        trace(this, 'dispose');\n        this.prev = void 0;\n        this.next = void 0;\n        this.callback = (void 0);\n        this.resolve = void 0;\n        this.reject = void 0;\n        this._result = void 0;\n    }\n}\n//# sourceMappingURL=scheduler.js.map","import { __decorate, __metadata, __param } from \"tslib\";\nimport { DI, Reporter } from '@aurelia/kernel';\nimport { subscriberCollection } from './subscriber-collection';\nimport { IScheduler } from '../scheduler';\nexport const IDirtyChecker = DI.createInterface('IDirtyChecker').withDefault(x => x.singleton(DirtyChecker));\nexport const DirtyCheckSettings = {\n    /**\n     * Default: `6`\n     *\n     * Adjust the global dirty check frequency.\n     * Measures in \"frames per check\", such that (given an FPS of 60):\n     * - A value of 1 will result in 60 dirty checks per second\n     * - A value of 6 will result in 10 dirty checks per second\n     */\n    framesPerCheck: 6,\n    /**\n     * Default: `false`\n     *\n     * Disable dirty-checking entirely. Properties that cannot be observed without dirty checking\n     * or an adapter, will simply not be observed.\n     */\n    disabled: false,\n    /**\n     * Default: `true`\n     *\n     * Log a warning message to the console if a property is being dirty-checked.\n     */\n    warn: true,\n    /**\n     * Default: `false`\n     *\n     * Throw an error if a property is being dirty-checked.\n     */\n    throw: false,\n    /**\n     * Resets all dirty checking settings to the framework's defaults.\n     */\n    resetToDefault() {\n        this.framesPerCheck = 6;\n        this.disabled = false;\n        this.warn = true;\n        this.throw = false;\n    }\n};\n/** @internal */\nlet DirtyChecker = class DirtyChecker {\n    constructor(scheduler) {\n        this.scheduler = scheduler;\n        this.tracked = [];\n        this.task = null;\n        this.elapsedFrames = 0;\n    }\n    createProperty(obj, propertyName) {\n        if (DirtyCheckSettings.throw) {\n            throw Reporter.error(800, propertyName); // TODO: create/organize error code\n        }\n        if (DirtyCheckSettings.warn) {\n            Reporter.write(801, propertyName);\n        }\n        return new DirtyCheckProperty(this, obj, propertyName);\n    }\n    addProperty(property) {\n        this.tracked.push(property);\n        if (this.tracked.length === 1) {\n            this.task = this.scheduler.queueRenderTask(() => this.check(), { persistent: true });\n        }\n    }\n    removeProperty(property) {\n        this.tracked.splice(this.tracked.indexOf(property), 1);\n        if (this.tracked.length === 0) {\n            this.task.cancel();\n            this.task = null;\n        }\n    }\n    check(delta) {\n        if (DirtyCheckSettings.disabled) {\n            return;\n        }\n        if (++this.elapsedFrames < DirtyCheckSettings.framesPerCheck) {\n            return;\n        }\n        this.elapsedFrames = 0;\n        const tracked = this.tracked;\n        const len = tracked.length;\n        let current;\n        let i = 0;\n        for (; i < len; ++i) {\n            current = tracked[i];\n            if (current.isDirty()) {\n                current.flush(256 /* fromTick */);\n            }\n        }\n    }\n};\nDirtyChecker = __decorate([\n    __param(0, IScheduler),\n    __metadata(\"design:paramtypes\", [Object])\n], DirtyChecker);\nexport { DirtyChecker };\nlet DirtyCheckProperty = class DirtyCheckProperty {\n    constructor(dirtyChecker, obj, propertyKey) {\n        this.dirtyChecker = dirtyChecker;\n        this.obj = obj;\n        this.propertyKey = propertyKey;\n    }\n    isDirty() {\n        return this.oldValue !== this.obj[this.propertyKey];\n    }\n    flush(flags) {\n        const oldValue = this.oldValue;\n        const newValue = this.obj[this.propertyKey];\n        this.callSubscribers(newValue, oldValue, flags | 16 /* updateTargetInstance */);\n        this.oldValue = newValue;\n    }\n    subscribe(subscriber) {\n        if (!this.hasSubscribers()) {\n            this.oldValue = this.obj[this.propertyKey];\n            this.dirtyChecker.addProperty(this);\n        }\n        this.addSubscriber(subscriber);\n    }\n    unsubscribe(subscriber) {\n        if (this.removeSubscriber(subscriber) && !this.hasSubscribers()) {\n            this.dirtyChecker.removeProperty(this);\n        }\n    }\n};\nDirtyCheckProperty = __decorate([\n    subscriberCollection(),\n    __metadata(\"design:paramtypes\", [Object, Object, String])\n], DirtyCheckProperty);\nexport { DirtyCheckProperty };\n//# sourceMappingURL=dirty-checker.js.map","import { __decorate, __metadata } from \"tslib\";\nimport { subscriberCollection } from './subscriber-collection';\nlet CollectionSizeObserver = class CollectionSizeObserver {\n    constructor(obj) {\n        this.obj = obj;\n        this.currentValue = obj.size;\n    }\n    getValue() {\n        return this.obj.size;\n    }\n    setValue(newValue, flags) {\n        const { currentValue } = this;\n        if (newValue !== currentValue) {\n            this.currentValue = newValue;\n            this.callSubscribers(newValue, currentValue, flags | 16 /* updateTargetInstance */);\n        }\n    }\n};\nCollectionSizeObserver = __decorate([\n    subscriberCollection(),\n    __metadata(\"design:paramtypes\", [Object])\n], CollectionSizeObserver);\nexport { CollectionSizeObserver };\n//# sourceMappingURL=collection-size-observer.js.map","import { __decorate, __metadata } from \"tslib\";\nimport { ILifecycle } from '../lifecycle';\nimport { createIndexMap } from '../observation';\nimport { CollectionSizeObserver } from './collection-size-observer';\nimport { collectionSubscriberCollection } from './subscriber-collection';\nconst observerLookup = new WeakMap();\nconst proto = Map.prototype;\nconst $set = proto.set;\nconst $clear = proto.clear;\nconst $delete = proto.delete;\nconst native = { set: $set, clear: $clear, delete: $delete };\nconst methods = ['set', 'clear', 'delete'];\n// note: we can't really do much with Map due to the internal data structure not being accessible so we're just using the native calls\n// fortunately, map/delete/clear are easy to reconstruct for the indexMap\nconst observe = {\n    // https://tc39.github.io/ecma262/#sec-map.prototype.map\n    set: function (key, value) {\n        let $this = this;\n        if ($this.$raw !== undefined) {\n            $this = $this.$raw;\n        }\n        const o = observerLookup.get($this);\n        if (o === undefined) {\n            $set.call($this, key, value);\n            return this;\n        }\n        const oldValue = $this.get(key);\n        const oldSize = $this.size;\n        $set.call($this, key, value);\n        const newSize = $this.size;\n        if (newSize === oldSize) {\n            let i = 0;\n            for (const entry of $this.entries()) {\n                if (entry[0] === key) {\n                    if (entry[1] !== oldValue) {\n                        o.indexMap.deletedItems.push(o.indexMap[i]);\n                        o.indexMap[i] = -2;\n                        o.notify();\n                    }\n                    return this;\n                }\n                i++;\n            }\n            return this;\n        }\n        o.indexMap[oldSize] = -2;\n        o.notify();\n        return this;\n    },\n    // https://tc39.github.io/ecma262/#sec-map.prototype.clear\n    clear: function () {\n        let $this = this;\n        if ($this.$raw !== undefined) {\n            $this = $this.$raw;\n        }\n        const o = observerLookup.get($this);\n        if (o === undefined) {\n            return $clear.call($this);\n        }\n        const size = $this.size;\n        if (size > 0) {\n            const indexMap = o.indexMap;\n            let i = 0;\n            for (const entry of $this.keys()) {\n                if (indexMap[i] > -1) {\n                    indexMap.deletedItems.push(indexMap[i]);\n                }\n                i++;\n            }\n            $clear.call($this);\n            indexMap.length = 0;\n            o.notify();\n        }\n        return undefined;\n    },\n    // https://tc39.github.io/ecma262/#sec-map.prototype.delete\n    delete: function (value) {\n        let $this = this;\n        if ($this.$raw !== undefined) {\n            $this = $this.$raw;\n        }\n        const o = observerLookup.get($this);\n        if (o === undefined) {\n            return $delete.call($this, value);\n        }\n        const size = $this.size;\n        if (size === 0) {\n            return false;\n        }\n        let i = 0;\n        const indexMap = o.indexMap;\n        for (const entry of $this.keys()) {\n            if (entry === value) {\n                if (indexMap[i] > -1) {\n                    indexMap.deletedItems.push(indexMap[i]);\n                }\n                indexMap.splice(i, 1);\n                const deleteResult = $delete.call($this, value);\n                if (deleteResult === true) {\n                    o.notify();\n                }\n                return deleteResult;\n            }\n            ++i;\n        }\n        return false;\n    }\n};\nconst descriptorProps = {\n    writable: true,\n    enumerable: false,\n    configurable: true\n};\nconst def = Reflect.defineProperty;\nfor (const method of methods) {\n    def(observe[method], 'observing', { value: true, writable: false, configurable: false, enumerable: false });\n}\nlet enableMapObservationCalled = false;\nexport function enableMapObservation() {\n    for (const method of methods) {\n        if (proto[method].observing !== true) {\n            def(proto, method, { ...descriptorProps, value: observe[method] });\n        }\n    }\n}\nexport function disableMapObservation() {\n    for (const method of methods) {\n        if (proto[method].observing === true) {\n            def(proto, method, { ...descriptorProps, value: native[method] });\n        }\n    }\n}\nconst slice = Array.prototype.slice;\nlet MapObserver = class MapObserver {\n    constructor(flags, lifecycle, map) {\n        if (!enableMapObservationCalled) {\n            enableMapObservationCalled = true;\n            enableMapObservation();\n        }\n        this.inBatch = false;\n        this.collection = map;\n        this.persistentFlags = flags & 2080374799 /* persistentBindingFlags */;\n        this.indexMap = createIndexMap(map.size);\n        this.lifecycle = lifecycle;\n        this.lengthObserver = (void 0);\n        observerLookup.set(map, this);\n    }\n    notify() {\n        if (this.lifecycle.batch.depth > 0) {\n            if (!this.inBatch) {\n                this.inBatch = true;\n                this.lifecycle.batch.add(this);\n            }\n        }\n        else {\n            this.flushBatch(0 /* none */);\n        }\n    }\n    getLengthObserver() {\n        if (this.lengthObserver === void 0) {\n            this.lengthObserver = new CollectionSizeObserver(this.collection);\n        }\n        return this.lengthObserver;\n    }\n    getIndexObserver(index) {\n        throw new Error('Map index observation not supported');\n    }\n    flushBatch(flags) {\n        this.inBatch = false;\n        const { indexMap, collection } = this;\n        const { size } = collection;\n        this.indexMap = createIndexMap(size);\n        this.callCollectionSubscribers(indexMap, 16 /* updateTargetInstance */ | this.persistentFlags);\n        if (this.lengthObserver !== void 0) {\n            this.lengthObserver.setValue(size, 16 /* updateTargetInstance */);\n        }\n    }\n};\nMapObserver = __decorate([\n    collectionSubscriberCollection(),\n    __metadata(\"design:paramtypes\", [Number, Object, Object])\n], MapObserver);\nexport { MapObserver };\nexport function getMapObserver(flags, lifecycle, map) {\n    const observer = observerLookup.get(map);\n    if (observer === void 0) {\n        return new MapObserver(flags, lifecycle, map);\n    }\n    return observer;\n}\n//# sourceMappingURL=map-observer.js.map","import { PLATFORM } from '@aurelia/kernel';\nconst slice = Array.prototype.slice;\nconst noop = PLATFORM.noop;\n// note: string.length is the only property of any primitive that is not a function,\n// so we can hardwire it to that and simply return undefined for anything else\n// note#2: a modified primitive constructor prototype would not work (and really, it shouldn't..)\nexport class PrimitiveObserver {\n    constructor(obj, propertyKey) {\n        this.doNotCache = true;\n        // we don't need to store propertyName because only 'length' can return a useful value\n        if (propertyKey === 'length') {\n            // deliberately not checking for typeof string as users probably still want to know via an error that their string is undefined\n            this.obj = obj;\n            this.getValue = this.getStringLength;\n        }\n        else {\n            this.getValue = this.returnUndefined;\n        }\n    }\n    getStringLength() {\n        return this.obj.length;\n    }\n    returnUndefined() {\n        return undefined;\n    }\n}\nPrimitiveObserver.prototype.setValue = noop;\nPrimitiveObserver.prototype.subscribe = noop;\nPrimitiveObserver.prototype.unsubscribe = noop;\nPrimitiveObserver.prototype.dispose = noop;\n//# sourceMappingURL=primitive-observer.js.map","export class PropertyAccessor {\n    constructor(obj, propertyKey) {\n        this.obj = obj;\n        this.propertyKey = propertyKey;\n        if (obj.$observers !== void 0\n            && obj.$observers[propertyKey] !== void 0\n            && obj.$observers[propertyKey].setValue !== void 0) {\n            this.setValue = this.setValueDirect;\n        }\n    }\n    getValue() {\n        return this.obj[this.propertyKey];\n    }\n    setValue(value, flags) {\n        this.obj[this.propertyKey] = value;\n    }\n    setValueDirect(value, flags) {\n        this.obj.$observers[this.propertyKey].setValue(value, flags);\n    }\n}\n//# sourceMappingURL=property-accessor.js.map","import { __decorate, __metadata } from \"tslib\";\nimport { ILifecycle } from '../lifecycle';\nimport { createIndexMap } from '../observation';\nimport { CollectionSizeObserver } from './collection-size-observer';\nimport { collectionSubscriberCollection } from './subscriber-collection';\nconst observerLookup = new WeakMap();\nconst proto = Set.prototype;\nconst $add = proto.add;\nconst $clear = proto.clear;\nconst $delete = proto.delete;\nconst native = { add: $add, clear: $clear, delete: $delete };\nconst methods = ['add', 'clear', 'delete'];\n// note: we can't really do much with Set due to the internal data structure not being accessible so we're just using the native calls\n// fortunately, add/delete/clear are easy to reconstruct for the indexMap\nconst observe = {\n    // https://tc39.github.io/ecma262/#sec-set.prototype.add\n    add: function (value) {\n        let $this = this;\n        if ($this.$raw !== undefined) {\n            $this = $this.$raw;\n        }\n        const o = observerLookup.get($this);\n        if (o === undefined) {\n            $add.call($this, value);\n            return this;\n        }\n        const oldSize = $this.size;\n        $add.call($this, value);\n        const newSize = $this.size;\n        if (newSize === oldSize) {\n            return this;\n        }\n        o.indexMap[oldSize] = -2;\n        o.notify();\n        return this;\n    },\n    // https://tc39.github.io/ecma262/#sec-set.prototype.clear\n    clear: function () {\n        let $this = this;\n        if ($this.$raw !== undefined) {\n            $this = $this.$raw;\n        }\n        const o = observerLookup.get($this);\n        if (o === undefined) {\n            return $clear.call($this);\n        }\n        const size = $this.size;\n        if (size > 0) {\n            const indexMap = o.indexMap;\n            let i = 0;\n            for (const entry of $this.keys()) {\n                if (indexMap[i] > -1) {\n                    indexMap.deletedItems.push(indexMap[i]);\n                }\n                i++;\n            }\n            $clear.call($this);\n            indexMap.length = 0;\n            o.notify();\n        }\n        return undefined;\n    },\n    // https://tc39.github.io/ecma262/#sec-set.prototype.delete\n    delete: function (value) {\n        let $this = this;\n        if ($this.$raw !== undefined) {\n            $this = $this.$raw;\n        }\n        const o = observerLookup.get($this);\n        if (o === undefined) {\n            return $delete.call($this, value);\n        }\n        const size = $this.size;\n        if (size === 0) {\n            return false;\n        }\n        let i = 0;\n        const indexMap = o.indexMap;\n        for (const entry of $this.keys()) {\n            if (entry === value) {\n                if (indexMap[i] > -1) {\n                    indexMap.deletedItems.push(indexMap[i]);\n                }\n                indexMap.splice(i, 1);\n                const deleteResult = $delete.call($this, value);\n                if (deleteResult === true) {\n                    o.notify();\n                }\n                return deleteResult;\n            }\n            i++;\n        }\n        return false;\n    }\n};\nconst descriptorProps = {\n    writable: true,\n    enumerable: false,\n    configurable: true\n};\nconst def = Reflect.defineProperty;\nfor (const method of methods) {\n    def(observe[method], 'observing', { value: true, writable: false, configurable: false, enumerable: false });\n}\nlet enableSetObservationCalled = false;\nexport function enableSetObservation() {\n    for (const method of methods) {\n        if (proto[method].observing !== true) {\n            def(proto, method, { ...descriptorProps, value: observe[method] });\n        }\n    }\n}\nexport function disableSetObservation() {\n    for (const method of methods) {\n        if (proto[method].observing === true) {\n            def(proto, method, { ...descriptorProps, value: native[method] });\n        }\n    }\n}\nconst slice = Array.prototype.slice;\nlet SetObserver = class SetObserver {\n    constructor(flags, lifecycle, observedSet) {\n        if (!enableSetObservationCalled) {\n            enableSetObservationCalled = true;\n            enableSetObservation();\n        }\n        this.inBatch = false;\n        this.collection = observedSet;\n        this.persistentFlags = flags & 2080374799 /* persistentBindingFlags */;\n        this.indexMap = createIndexMap(observedSet.size);\n        this.lifecycle = lifecycle;\n        this.lengthObserver = (void 0);\n        observerLookup.set(observedSet, this);\n    }\n    notify() {\n        if (this.lifecycle.batch.depth > 0) {\n            if (!this.inBatch) {\n                this.inBatch = true;\n                this.lifecycle.batch.add(this);\n            }\n        }\n        else {\n            this.flushBatch(0 /* none */);\n        }\n    }\n    getLengthObserver() {\n        if (this.lengthObserver === void 0) {\n            this.lengthObserver = new CollectionSizeObserver(this.collection);\n        }\n        return this.lengthObserver;\n    }\n    getIndexObserver(index) {\n        throw new Error('Set index observation not supported');\n    }\n    flushBatch(flags) {\n        this.inBatch = false;\n        const { indexMap, collection } = this;\n        const { size } = collection;\n        this.indexMap = createIndexMap(size);\n        this.callCollectionSubscribers(indexMap, 16 /* updateTargetInstance */ | this.persistentFlags);\n        if (this.lengthObserver !== void 0) {\n            this.lengthObserver.setValue(size, 16 /* updateTargetInstance */);\n        }\n    }\n};\nSetObserver = __decorate([\n    collectionSubscriberCollection(),\n    __metadata(\"design:paramtypes\", [Number, Object, Object])\n], SetObserver);\nexport { SetObserver };\nexport function getSetObserver(flags, lifecycle, observedSet) {\n    const observer = observerLookup.get(observedSet);\n    if (observer === void 0) {\n        return new SetObserver(flags, lifecycle, observedSet);\n    }\n    return observer;\n}\n//# sourceMappingURL=set-observer.js.map","import { __decorate, __metadata, __param } from \"tslib\";\nimport { DI, Registration, Reporter, isArrayIndex, } from '@aurelia/kernel';\nimport { ILifecycle } from '../lifecycle';\nimport { getArrayObserver } from './array-observer';\nimport { createComputedObserver } from './computed-observer';\nimport { IDirtyChecker } from './dirty-checker';\nimport { getMapObserver } from './map-observer';\nimport { PrimitiveObserver } from './primitive-observer';\nimport { PropertyAccessor } from './property-accessor';\nimport { ProxyObserver } from './proxy-observer';\nimport { getSetObserver } from './set-observer';\nimport { SetterObserver } from './setter-observer';\nimport { IScheduler } from '../scheduler';\nconst toStringTag = Object.prototype.toString;\nexport const IObserverLocator = DI.createInterface('IObserverLocator').noDefault();\nexport const ITargetObserverLocator = DI.createInterface('ITargetObserverLocator').noDefault();\nexport const ITargetAccessorLocator = DI.createInterface('ITargetAccessorLocator').noDefault();\nfunction getPropertyDescriptor(subject, name) {\n    let pd = Object.getOwnPropertyDescriptor(subject, name);\n    let proto = Object.getPrototypeOf(subject);\n    while (pd == null && proto != null) {\n        pd = Object.getOwnPropertyDescriptor(proto, name);\n        proto = Object.getPrototypeOf(proto);\n    }\n    return pd;\n}\n/** @internal */\nlet ObserverLocator = class ObserverLocator {\n    constructor(lifecycle, scheduler, dirtyChecker, targetObserverLocator, targetAccessorLocator) {\n        this.lifecycle = lifecycle;\n        this.scheduler = scheduler;\n        this.dirtyChecker = dirtyChecker;\n        this.targetObserverLocator = targetObserverLocator;\n        this.targetAccessorLocator = targetAccessorLocator;\n        this.adapters = [];\n    }\n    static register(container) {\n        return Registration.singleton(IObserverLocator, this).register(container);\n    }\n    getObserver(flags, obj, propertyName) {\n        if (flags & 2 /* proxyStrategy */ && typeof obj === 'object') {\n            return ProxyObserver.getOrCreate(obj, propertyName); // TODO: fix typings (and ensure proper contracts ofc)\n        }\n        if (isBindingContext(obj)) {\n            return obj.getObservers(flags).getOrCreate(this.lifecycle, flags, obj, propertyName);\n        }\n        let observersLookup = obj.$observers;\n        if (observersLookup && propertyName in observersLookup) {\n            return observersLookup[propertyName];\n        }\n        const observer = this.createPropertyObserver(flags, obj, propertyName);\n        if (!observer.doNotCache) {\n            if (observersLookup === void 0) {\n                observersLookup = this.getOrCreateObserversLookup(obj);\n            }\n            observersLookup[propertyName] = observer;\n        }\n        return observer;\n    }\n    addAdapter(adapter) {\n        this.adapters.push(adapter);\n    }\n    getAccessor(flags, obj, propertyName) {\n        if (this.targetAccessorLocator.handles(flags, obj)) {\n            if (this.targetObserverLocator.overridesAccessor(flags, obj, propertyName)) {\n                return this.getObserver(flags, obj, propertyName);\n            }\n            return this.targetAccessorLocator.getAccessor(flags, this.scheduler, this.lifecycle, obj, propertyName);\n        }\n        if (flags & 2 /* proxyStrategy */) {\n            return ProxyObserver.getOrCreate(obj, propertyName);\n        }\n        return new PropertyAccessor(obj, propertyName);\n    }\n    getArrayObserver(flags, observedArray) {\n        return getArrayObserver(flags, this.lifecycle, observedArray);\n    }\n    getMapObserver(flags, observedMap) {\n        return getMapObserver(flags, this.lifecycle, observedMap);\n    }\n    getSetObserver(flags, observedSet) {\n        return getSetObserver(flags, this.lifecycle, observedSet);\n    }\n    getOrCreateObserversLookup(obj) {\n        return obj.$observers || this.createObserversLookup(obj);\n    }\n    createObserversLookup(obj) {\n        const value = {};\n        if (!Reflect.defineProperty(obj, '$observers', {\n            enumerable: false,\n            configurable: false,\n            writable: false,\n            value: value\n        })) {\n            Reporter.write(0, obj);\n        }\n        return value;\n    }\n    getAdapterObserver(flags, obj, propertyName, descriptor) {\n        for (let i = 0, ii = this.adapters.length; i < ii; i++) {\n            const adapter = this.adapters[i];\n            const observer = adapter.getObserver(flags, obj, propertyName, descriptor);\n            if (observer != null) {\n                return observer;\n            }\n        }\n        return null;\n    }\n    createPropertyObserver(flags, obj, propertyName) {\n        if (!(obj instanceof Object)) {\n            return new PrimitiveObserver(obj, propertyName);\n        }\n        let isNode = false;\n        if (this.targetObserverLocator.handles(flags, obj)) {\n            const observer = this.targetObserverLocator.getObserver(flags, this.scheduler, this.lifecycle, this, obj, propertyName);\n            if (observer != null) {\n                return observer;\n            }\n            isNode = true;\n        }\n        const tag = toStringTag.call(obj);\n        switch (tag) {\n            case '[object Array]':\n                if (propertyName === 'length') {\n                    return this.getArrayObserver(flags, obj).getLengthObserver();\n                }\n                // is numer only returns true for integer\n                if (isArrayIndex(propertyName)) {\n                    return this.getArrayObserver(flags, obj).getIndexObserver(Number(propertyName));\n                }\n                break;\n            case '[object Map]':\n                if (propertyName === 'size') {\n                    return this.getMapObserver(flags, obj).getLengthObserver();\n                }\n                break;\n            case '[object Set]':\n                if (propertyName === 'size') {\n                    return this.getSetObserver(flags, obj).getLengthObserver();\n                }\n                break;\n        }\n        const descriptor = getPropertyDescriptor(obj, propertyName);\n        if (descriptor != null && (descriptor.get != null || descriptor.set != null)) {\n            if (descriptor.get != null && descriptor.get.getObserver != null) {\n                return descriptor.get.getObserver(obj);\n            }\n            // attempt to use an adapter before resorting to dirty checking.\n            const adapterObserver = this.getAdapterObserver(flags, obj, propertyName, descriptor);\n            if (adapterObserver != null) {\n                return adapterObserver;\n            }\n            if (isNode) {\n                // TODO: use MutationObserver\n                return this.dirtyChecker.createProperty(obj, propertyName);\n            }\n            return createComputedObserver(flags, this, this.dirtyChecker, this.lifecycle, obj, propertyName, descriptor);\n        }\n        return new SetterObserver(this.lifecycle, flags, obj, propertyName);\n    }\n};\nObserverLocator = __decorate([\n    __param(0, ILifecycle),\n    __param(1, IScheduler),\n    __param(2, IDirtyChecker),\n    __param(3, ITargetObserverLocator),\n    __param(4, ITargetAccessorLocator),\n    __metadata(\"design:paramtypes\", [Object, Object, Object, Object, Object])\n], ObserverLocator);\nexport { ObserverLocator };\nexport function getCollectionObserver(flags, lifecycle, collection) {\n    // If the collection is wrapped by a proxy then `$observer` will return the proxy observer instead of the collection observer, which is not what we want\n    // when we ask for getCollectionObserver\n    const rawCollection = collection instanceof Object ? ProxyObserver.getRawIfProxy(collection) : collection;\n    switch (toStringTag.call(collection)) {\n        case '[object Array]':\n            return getArrayObserver(flags, lifecycle, rawCollection);\n        case '[object Map]':\n            return getMapObserver(flags, lifecycle, rawCollection);\n        case '[object Set]':\n            return getSetObserver(flags, lifecycle, rawCollection);\n    }\n    return void 0;\n}\nfunction isBindingContext(obj) {\n    return obj.$synthetic === true;\n}\n//# sourceMappingURL=observer-locator.js.map","import { __decorate, __metadata } from \"tslib\";\nimport { IServiceLocator, Reporter, } from '@aurelia/kernel';\nimport { BindingMode, } from '../flags';\nimport { ILifecycle } from '../lifecycle';\nimport { IObserverLocator } from '../observation/observer-locator';\nimport { hasBind, hasUnbind, } from './ast';\nimport { connectable, } from './connectable';\n// BindingMode is not a const enum (and therefore not inlined), so assigning them to a variable to save a member accessor is a minor perf tweak\nconst { oneTime, toView, fromView } = BindingMode;\n// pre-combining flags for bitwise checks is a minor perf tweak\nconst toViewOrOneTime = toView | oneTime;\nlet PropertyBinding = class PropertyBinding {\n    constructor(sourceExpression, target, targetProperty, mode, observerLocator, locator) {\n        this.sourceExpression = sourceExpression;\n        this.target = target;\n        this.targetProperty = targetProperty;\n        this.mode = mode;\n        this.observerLocator = observerLocator;\n        this.locator = locator;\n        this.interceptor = this;\n        this.$state = 0 /* none */;\n        this.$scope = void 0;\n        this.targetObserver = void 0;\n        this.persistentFlags = 0 /* none */;\n        connectable.assignIdTo(this);\n        this.$lifecycle = locator.get(ILifecycle);\n    }\n    ;\n    updateTarget(value, flags) {\n        flags |= this.persistentFlags;\n        this.targetObserver.setValue(value, flags);\n    }\n    updateSource(value, flags) {\n        flags |= this.persistentFlags;\n        this.sourceExpression.assign(flags, this.$scope, this.locator, value, this.part);\n    }\n    handleChange(newValue, _previousValue, flags) {\n        if ((this.$state & 4 /* isBound */) === 0) {\n            return;\n        }\n        flags |= this.persistentFlags;\n        if ((flags & 16 /* updateTargetInstance */) > 0) {\n            const previousValue = this.targetObserver.getValue();\n            // if the only observable is an AccessScope then we can assume the passed-in newValue is the correct and latest value\n            if (this.sourceExpression.$kind !== 10082 /* AccessScope */ || this.observerSlots > 1) {\n                newValue = this.sourceExpression.evaluate(flags, this.$scope, this.locator, this.part);\n            }\n            if (newValue !== previousValue) {\n                this.interceptor.updateTarget(newValue, flags);\n            }\n            if ((this.mode & oneTime) === 0) {\n                this.version++;\n                this.sourceExpression.connect(flags, this.$scope, this.interceptor, this.part);\n                this.interceptor.unobserve(false);\n            }\n            return;\n        }\n        if ((flags & 32 /* updateSourceExpression */) > 0) {\n            if (newValue !== this.sourceExpression.evaluate(flags, this.$scope, this.locator, this.part)) {\n                this.interceptor.updateSource(newValue, flags);\n            }\n            return;\n        }\n        throw Reporter.error(15, flags);\n    }\n    $bind(flags, scope, part) {\n        if (this.$state & 4 /* isBound */) {\n            if (this.$scope === scope) {\n                return;\n            }\n            this.interceptor.$unbind(flags | 4096 /* fromBind */);\n        }\n        // add isBinding flag\n        this.$state |= 1 /* isBinding */;\n        // Force property binding to always be strict\n        flags |= 4 /* isStrictBindingStrategy */;\n        // Store flags which we can only receive during $bind and need to pass on\n        // to the AST during evaluate/connect/assign\n        this.persistentFlags = flags & 2080374799 /* persistentBindingFlags */;\n        this.$scope = scope;\n        this.part = part;\n        let sourceExpression = this.sourceExpression;\n        if (hasBind(sourceExpression)) {\n            sourceExpression.bind(flags, scope, this.interceptor);\n        }\n        let targetObserver = this.targetObserver;\n        if (!targetObserver) {\n            if (this.mode & fromView) {\n                targetObserver = this.targetObserver = this.observerLocator.getObserver(flags, this.target, this.targetProperty);\n            }\n            else {\n                targetObserver = this.targetObserver = this.observerLocator.getAccessor(flags, this.target, this.targetProperty);\n            }\n        }\n        if (this.mode !== BindingMode.oneTime && targetObserver.bind) {\n            targetObserver.bind(flags);\n        }\n        // during bind, binding behavior might have changed sourceExpression\n        sourceExpression = this.sourceExpression;\n        if (this.mode & toViewOrOneTime) {\n            this.interceptor.updateTarget(sourceExpression.evaluate(flags, scope, this.locator, part), flags);\n        }\n        if (this.mode & toView) {\n            sourceExpression.connect(flags, scope, this.interceptor, part);\n        }\n        if (this.mode & fromView) {\n            targetObserver.subscribe(this.interceptor);\n            targetObserver[this.id] |= 32 /* updateSourceExpression */;\n        }\n        // add isBound flag and remove isBinding flag\n        this.$state |= 4 /* isBound */;\n        this.$state &= ~1 /* isBinding */;\n    }\n    $unbind(flags) {\n        if (!(this.$state & 4 /* isBound */)) {\n            return;\n        }\n        // add isUnbinding flag\n        this.$state |= 2 /* isUnbinding */;\n        // clear persistent flags\n        this.persistentFlags = 0 /* none */;\n        if (hasUnbind(this.sourceExpression)) {\n            this.sourceExpression.unbind(flags, this.$scope, this.interceptor);\n        }\n        this.$scope = void 0;\n        if (this.targetObserver.unbind) {\n            this.targetObserver.unbind(flags);\n        }\n        if (this.targetObserver.unsubscribe) {\n            this.targetObserver.unsubscribe(this.interceptor);\n            this.targetObserver[this.id] &= ~32 /* updateSourceExpression */;\n        }\n        this.interceptor.unobserve(true);\n        // remove isBound and isUnbinding flags\n        this.$state &= ~(4 /* isBound */ | 2 /* isUnbinding */);\n    }\n};\nPropertyBinding = __decorate([\n    connectable(),\n    __metadata(\"design:paramtypes\", [Object, Object, String, Number, Object, Object])\n], PropertyBinding);\nexport { PropertyBinding };\n//# sourceMappingURL=property-binding.js.map","import { hasBind, hasUnbind, } from './ast';\nexport class CallBinding {\n    constructor(sourceExpression, target, targetProperty, observerLocator, locator) {\n        this.sourceExpression = sourceExpression;\n        this.locator = locator;\n        this.interceptor = this;\n        this.$state = 0 /* none */;\n        this.targetObserver = observerLocator.getObserver(0 /* none */, target, targetProperty);\n    }\n    callSource(args) {\n        const overrideContext = this.$scope.overrideContext;\n        Object.assign(overrideContext, args);\n        const result = this.sourceExpression.evaluate(2097152 /* mustEvaluate */, this.$scope, this.locator, this.part);\n        for (const prop in args) {\n            Reflect.deleteProperty(overrideContext, prop);\n        }\n        return result;\n    }\n    $bind(flags, scope, part) {\n        if (this.$state & 4 /* isBound */) {\n            if (this.$scope === scope) {\n                return;\n            }\n            this.interceptor.$unbind(flags | 4096 /* fromBind */);\n        }\n        // add isBinding flag\n        this.$state |= 1 /* isBinding */;\n        this.$scope = scope;\n        this.part = part;\n        if (hasBind(this.sourceExpression)) {\n            this.sourceExpression.bind(flags, scope, this.interceptor);\n        }\n        this.targetObserver.setValue(($args) => this.interceptor.callSource($args), flags);\n        // add isBound flag and remove isBinding flag\n        this.$state |= 4 /* isBound */;\n        this.$state &= ~1 /* isBinding */;\n    }\n    $unbind(flags) {\n        if (!(this.$state & 4 /* isBound */)) {\n            return;\n        }\n        // add isUnbinding flag\n        this.$state |= 2 /* isUnbinding */;\n        if (hasUnbind(this.sourceExpression)) {\n            this.sourceExpression.unbind(flags, this.$scope, this.interceptor);\n        }\n        this.$scope = void 0;\n        this.targetObserver.setValue(null, flags);\n        // remove isBound and isUnbinding flags\n        this.$state &= ~(4 /* isBound */ | 2 /* isUnbinding */);\n    }\n    observeProperty(flags, obj, propertyName) {\n        return;\n    }\n    handleChange(newValue, previousValue, flags) {\n        return;\n    }\n}\n//# sourceMappingURL=call-binding.js.map","import { DI, PLATFORM, Reporter, } from '@aurelia/kernel';\nimport { AccessMemberExpression, AccessScopeExpression, CallMemberExpression, CallScopeExpression, PrimitiveLiteralExpression, } from './ast';\nexport const IExpressionParser = DI.createInterface('IExpressionParser').withDefault(x => x.singleton(ExpressionParser));\n/** @internal */\nexport class ExpressionParser {\n    constructor() {\n        this.expressionLookup = Object.create(null);\n        this.forOfLookup = Object.create(null);\n        this.interpolationLookup = Object.create(null);\n    }\n    parse(expression, bindingType) {\n        switch (bindingType) {\n            case 2048 /* Interpolation */: {\n                let found = this.interpolationLookup[expression];\n                if (found === void 0) {\n                    found = this.interpolationLookup[expression] = this.parseCore(expression, bindingType);\n                }\n                return found;\n            }\n            case 539 /* ForCommand */: {\n                let found = this.forOfLookup[expression];\n                if (found === void 0) {\n                    found = this.forOfLookup[expression] = this.parseCore(expression, bindingType);\n                }\n                return found;\n            }\n            default: {\n                // Allow empty strings for normal bindings and those that are empty by default (such as a custom attribute without an equals sign)\n                // But don't cache it, because empty strings are always invalid for any other type of binding\n                if (expression.length === 0 && (bindingType & (53 /* BindCommand */ | 49 /* OneTimeCommand */ | 50 /* ToViewCommand */))) {\n                    return PrimitiveLiteralExpression.$empty;\n                }\n                let found = this.expressionLookup[expression];\n                if (found === void 0) {\n                    found = this.expressionLookup[expression] = this.parseCore(expression, bindingType);\n                }\n                return found;\n            }\n        }\n    }\n    cache(expressions) {\n        const { forOfLookup, expressionLookup, interpolationLookup } = this;\n        for (const expression in expressions) {\n            const expr = expressions[expression];\n            switch (expr.$kind) {\n                case 24 /* Interpolation */:\n                    interpolationLookup[expression] = expr;\n                    break;\n                case 6199 /* ForOfStatement */:\n                    forOfLookup[expression] = expr;\n                    break;\n                default:\n                    expressionLookup[expression] = expr;\n            }\n        }\n    }\n    parseCore(expression, bindingType) {\n        try {\n            const parts = expression.split('.');\n            const firstPart = parts[0];\n            let current;\n            if (firstPart.endsWith('()')) {\n                current = new CallScopeExpression(firstPart.replace('()', ''), PLATFORM.emptyArray);\n            }\n            else {\n                current = new AccessScopeExpression(parts[0]);\n            }\n            let index = 1;\n            while (index < parts.length) {\n                const currentPart = parts[index];\n                if (currentPart.endsWith('()')) {\n                    current = new CallMemberExpression(current, currentPart.replace('()', ''), PLATFORM.emptyArray);\n                }\n                else {\n                    current = new AccessMemberExpression(current, parts[index]);\n                }\n                index++;\n            }\n            return current;\n        }\n        catch (e) {\n            throw Reporter.error(3, e);\n        }\n    }\n}\n/* eslint-disable @typescript-eslint/indent */\nexport var BindingType;\n(function (BindingType) {\n    BindingType[BindingType[\"None\"] = 0] = \"None\";\n    BindingType[BindingType[\"IgnoreCustomAttr\"] = 4096] = \"IgnoreCustomAttr\";\n    BindingType[BindingType[\"Interpolation\"] = 2048] = \"Interpolation\";\n    BindingType[BindingType[\"IsRef\"] = 5376] = \"IsRef\";\n    BindingType[BindingType[\"IsIterator\"] = 512] = \"IsIterator\";\n    BindingType[BindingType[\"IsCustom\"] = 256] = \"IsCustom\";\n    BindingType[BindingType[\"IsFunction\"] = 128] = \"IsFunction\";\n    BindingType[BindingType[\"IsEvent\"] = 64] = \"IsEvent\";\n    BindingType[BindingType[\"IsProperty\"] = 32] = \"IsProperty\";\n    BindingType[BindingType[\"IsCommand\"] = 16] = \"IsCommand\";\n    BindingType[BindingType[\"IsPropertyCommand\"] = 48] = \"IsPropertyCommand\";\n    BindingType[BindingType[\"IsEventCommand\"] = 80] = \"IsEventCommand\";\n    BindingType[BindingType[\"DelegationStrategyDelta\"] = 6] = \"DelegationStrategyDelta\";\n    BindingType[BindingType[\"Command\"] = 15] = \"Command\";\n    BindingType[BindingType[\"OneTimeCommand\"] = 49] = \"OneTimeCommand\";\n    BindingType[BindingType[\"ToViewCommand\"] = 50] = \"ToViewCommand\";\n    BindingType[BindingType[\"FromViewCommand\"] = 51] = \"FromViewCommand\";\n    BindingType[BindingType[\"TwoWayCommand\"] = 52] = \"TwoWayCommand\";\n    BindingType[BindingType[\"BindCommand\"] = 53] = \"BindCommand\";\n    BindingType[BindingType[\"TriggerCommand\"] = 4182] = \"TriggerCommand\";\n    BindingType[BindingType[\"CaptureCommand\"] = 4183] = \"CaptureCommand\";\n    BindingType[BindingType[\"DelegateCommand\"] = 4184] = \"DelegateCommand\";\n    BindingType[BindingType[\"CallCommand\"] = 153] = \"CallCommand\";\n    BindingType[BindingType[\"OptionsCommand\"] = 26] = \"OptionsCommand\";\n    BindingType[BindingType[\"ForCommand\"] = 539] = \"ForCommand\";\n    BindingType[BindingType[\"CustomCommand\"] = 284] = \"CustomCommand\";\n})(BindingType || (BindingType = {}));\n/* eslint-enable @typescript-eslint/indent */\n//# sourceMappingURL=expression-parser.js.map","import { __decorate, __metadata } from \"tslib\";\nimport { IServiceLocator } from '@aurelia/kernel';\nimport { BindingMode, } from '../flags';\nimport { IObserverLocator } from '../observation/observer-locator';\nimport { connectable, } from './connectable';\nconst { toView, oneTime } = BindingMode;\nexport class MultiInterpolationBinding {\n    constructor(observerLocator, interpolation, target, targetProperty, mode, locator) {\n        this.observerLocator = observerLocator;\n        this.interpolation = interpolation;\n        this.target = target;\n        this.targetProperty = targetProperty;\n        this.mode = mode;\n        this.locator = locator;\n        this.interceptor = this;\n        this.$state = 0 /* none */;\n        this.$scope = void 0;\n        // Note: the child expressions of an Interpolation expression are full Aurelia expressions, meaning they may include\n        // value converters and binding behaviors.\n        // Each expression represents one ${interpolation}, and for each we create a child TextBinding unless there is only one,\n        // in which case the renderer will create the TextBinding directly\n        const expressions = interpolation.expressions;\n        const parts = this.parts = Array(expressions.length);\n        for (let i = 0, ii = expressions.length; i < ii; ++i) {\n            parts[i] = new InterpolationBinding(expressions[i], interpolation, target, targetProperty, mode, observerLocator, locator, i === 0);\n        }\n    }\n    ;\n    $bind(flags, scope, part) {\n        if (this.$state & 4 /* isBound */) {\n            if (this.$scope === scope) {\n                return;\n            }\n            this.interceptor.$unbind(flags);\n        }\n        this.$state |= 4 /* isBound */;\n        this.$scope = scope;\n        this.part = part;\n        const parts = this.parts;\n        for (let i = 0, ii = parts.length; i < ii; ++i) {\n            parts[i].interceptor.$bind(flags, scope, part);\n        }\n    }\n    $unbind(flags) {\n        if (!(this.$state & 4 /* isBound */)) {\n            return;\n        }\n        this.$state &= ~4 /* isBound */;\n        this.$scope = void 0;\n        const parts = this.parts;\n        for (let i = 0, ii = parts.length; i < ii; ++i) {\n            parts[i].interceptor.$unbind(flags);\n        }\n    }\n}\nlet InterpolationBinding = class InterpolationBinding {\n    constructor(sourceExpression, interpolation, target, targetProperty, mode, observerLocator, locator, isFirst) {\n        this.sourceExpression = sourceExpression;\n        this.interpolation = interpolation;\n        this.target = target;\n        this.targetProperty = targetProperty;\n        this.mode = mode;\n        this.observerLocator = observerLocator;\n        this.locator = locator;\n        this.isFirst = isFirst;\n        this.interceptor = this;\n        this.$state = 0 /* none */;\n        connectable.assignIdTo(this);\n        this.targetObserver = observerLocator.getAccessor(0 /* none */, target, targetProperty);\n    }\n    updateTarget(value, flags) {\n        this.targetObserver.setValue(value, flags | 16 /* updateTargetInstance */);\n    }\n    handleChange(_newValue, _previousValue, flags) {\n        if (!(this.$state & 4 /* isBound */)) {\n            return;\n        }\n        const previousValue = this.targetObserver.getValue();\n        const newValue = this.interpolation.evaluate(flags, this.$scope, this.locator, this.part);\n        if (newValue !== previousValue) {\n            this.interceptor.updateTarget(newValue, flags);\n        }\n        if ((this.mode & oneTime) === 0) {\n            this.version++;\n            this.sourceExpression.connect(flags, this.$scope, this.interceptor, this.part);\n            this.interceptor.unobserve(false);\n        }\n    }\n    $bind(flags, scope, part) {\n        if (this.$state & 4 /* isBound */) {\n            if (this.$scope === scope) {\n                return;\n            }\n            this.interceptor.$unbind(flags);\n        }\n        this.$state |= 4 /* isBound */;\n        this.$scope = scope;\n        this.part = part;\n        const sourceExpression = this.sourceExpression;\n        if (sourceExpression.bind) {\n            sourceExpression.bind(flags, scope, this.interceptor);\n        }\n        if (this.mode !== BindingMode.oneTime && this.targetObserver.bind) {\n            this.targetObserver.bind(flags);\n        }\n        // since the interpolation already gets the whole value, we only need to let the first\n        // text binding do the update if there are multiple\n        if (this.isFirst) {\n            this.interceptor.updateTarget(this.interpolation.evaluate(flags, scope, this.locator, part), flags);\n        }\n        if (this.mode & toView) {\n            sourceExpression.connect(flags, scope, this.interceptor, part);\n        }\n    }\n    $unbind(flags) {\n        if (!(this.$state & 4 /* isBound */)) {\n            return;\n        }\n        this.$state &= ~4 /* isBound */;\n        const sourceExpression = this.sourceExpression;\n        if (sourceExpression.unbind) {\n            sourceExpression.unbind(flags, this.$scope, this.interceptor);\n        }\n        if (this.targetObserver.unbind) {\n            this.targetObserver.unbind(flags);\n        }\n        this.$scope = void 0;\n        this.interceptor.unobserve(true);\n    }\n};\nInterpolationBinding = __decorate([\n    connectable(),\n    __metadata(\"design:paramtypes\", [Object, Object, Object, String, Number, Object, Object, Boolean])\n], InterpolationBinding);\nexport { InterpolationBinding };\n//# sourceMappingURL=interpolation-binding.js.map","import { __decorate, __metadata } from \"tslib\";\nimport { IServiceLocator, Reporter, } from '@aurelia/kernel';\nimport { ILifecycle, } from '../lifecycle';\nimport { IObserverLocator } from '../observation/observer-locator';\nimport { connectable, } from './connectable';\nlet LetBinding = class LetBinding {\n    constructor(sourceExpression, targetProperty, observerLocator, locator, toBindingContext = false) {\n        this.sourceExpression = sourceExpression;\n        this.targetProperty = targetProperty;\n        this.observerLocator = observerLocator;\n        this.locator = locator;\n        this.toBindingContext = toBindingContext;\n        this.interceptor = this;\n        this.$state = 0 /* none */;\n        this.$scope = void 0;\n        this.target = null;\n        connectable.assignIdTo(this);\n        this.$lifecycle = locator.get(ILifecycle);\n    }\n    handleChange(_newValue, _previousValue, flags) {\n        if (!(this.$state & 4 /* isBound */)) {\n            return;\n        }\n        if (flags & 16 /* updateTargetInstance */) {\n            const { target, targetProperty } = this;\n            const previousValue = target[targetProperty];\n            const newValue = this.sourceExpression.evaluate(flags, this.$scope, this.locator, this.part);\n            if (newValue !== previousValue) {\n                target[targetProperty] = newValue;\n            }\n            return;\n        }\n        throw Reporter.error(15, flags);\n    }\n    $bind(flags, scope, part) {\n        if (this.$state & 4 /* isBound */) {\n            if (this.$scope === scope) {\n                return;\n            }\n            this.interceptor.$unbind(flags | 4096 /* fromBind */);\n        }\n        // add isBinding flag\n        this.$state |= 1 /* isBinding */;\n        this.$scope = scope;\n        this.part = part;\n        this.target = (this.toBindingContext ? scope.bindingContext : scope.overrideContext);\n        const sourceExpression = this.sourceExpression;\n        if (sourceExpression.bind) {\n            sourceExpression.bind(flags, scope, this.interceptor);\n        }\n        // sourceExpression might have been changed during bind\n        this.target[this.targetProperty] = this.sourceExpression.evaluate(flags | 4096 /* fromBind */, scope, this.locator, part);\n        this.sourceExpression.connect(flags, scope, this.interceptor, part);\n        // add isBound flag and remove isBinding flag\n        this.$state |= 4 /* isBound */;\n        this.$state &= ~1 /* isBinding */;\n    }\n    $unbind(flags) {\n        if (!(this.$state & 4 /* isBound */)) {\n            return;\n        }\n        // add isUnbinding flag\n        this.$state |= 2 /* isUnbinding */;\n        const sourceExpression = this.sourceExpression;\n        if (sourceExpression.unbind) {\n            sourceExpression.unbind(flags, this.$scope, this.interceptor);\n        }\n        this.$scope = void 0;\n        this.interceptor.unobserve(true);\n        // remove isBound and isUnbinding flags\n        this.$state &= ~(4 /* isBound */ | 2 /* isUnbinding */);\n    }\n};\nLetBinding = __decorate([\n    connectable(),\n    __metadata(\"design:paramtypes\", [Object, String, Object, Object, Boolean])\n], LetBinding);\nexport { LetBinding };\n//# sourceMappingURL=let-binding.js.map","import { hasBind, hasUnbind, } from './ast';\nexport class RefBinding {\n    constructor(sourceExpression, target, locator) {\n        this.sourceExpression = sourceExpression;\n        this.target = target;\n        this.locator = locator;\n        this.interceptor = this;\n        this.$state = 0 /* none */;\n        this.$scope = void 0;\n    }\n    $bind(flags, scope, part) {\n        if (this.$state & 4 /* isBound */) {\n            if (this.$scope === scope) {\n                return;\n            }\n            this.interceptor.$unbind(flags | 4096 /* fromBind */);\n        }\n        // add isBinding flag\n        this.$state |= 1 /* isBinding */;\n        this.$scope = scope;\n        this.part = part;\n        if (hasBind(this.sourceExpression)) {\n            this.sourceExpression.bind(flags, scope, this);\n        }\n        this.sourceExpression.assign(flags | 32 /* updateSourceExpression */, this.$scope, this.locator, this.target, part);\n        // add isBound flag and remove isBinding flag\n        this.$state |= 4 /* isBound */;\n        this.$state &= ~1 /* isBinding */;\n    }\n    $unbind(flags) {\n        if (!(this.$state & 4 /* isBound */)) {\n            return;\n        }\n        // add isUnbinding flag\n        this.$state |= 2 /* isUnbinding */;\n        let sourceExpression = this.sourceExpression;\n        if (sourceExpression.evaluate(flags, this.$scope, this.locator, this.part) === this.target) {\n            sourceExpression.assign(flags, this.$scope, this.locator, null, this.part);\n        }\n        // source expression might have been modified durring assign, via a BB\n        sourceExpression = this.sourceExpression;\n        if (hasUnbind(sourceExpression)) {\n            sourceExpression.unbind(flags, this.$scope, this.interceptor);\n        }\n        this.$scope = void 0;\n        // remove isBound and isUnbinding flags\n        this.$state &= ~(4 /* isBound */ | 2 /* isUnbinding */);\n    }\n    observeProperty(flags, obj, propertyName) {\n        return;\n    }\n    handleChange(newValue, previousValue, flags) {\n        return;\n    }\n}\n//# sourceMappingURL=ref-binding.js.map","var BindableObserver_1;\nimport { __decorate, __metadata } from \"tslib\";\nimport { Reporter, PLATFORM } from '@aurelia/kernel';\nimport { ILifecycle } from '../lifecycle';\nimport { ProxyObserver } from './proxy-observer';\nimport { subscriberCollection } from './subscriber-collection';\nlet BindableObserver = BindableObserver_1 = class BindableObserver {\n    constructor(lifecycle, flags, obj, propertyKey, cbName, $set) {\n        this.lifecycle = lifecycle;\n        this.obj = obj;\n        this.propertyKey = propertyKey;\n        this.$set = $set;\n        this.currentValue = void 0;\n        this.oldValue = void 0;\n        this.inBatch = false;\n        let isProxy = false;\n        if (ProxyObserver.isProxy(obj)) {\n            isProxy = true;\n            obj.$observer.subscribe(this, propertyKey);\n            this.obj = obj.$raw;\n        }\n        this.callback = this.obj[cbName];\n        const propertyChangedCallback = this.propertyChangedCallback = this.obj.propertyChanged;\n        const hasPropertyChangedCallback = this.hasPropertyChangedCallback = typeof propertyChangedCallback === 'function';\n        const shouldInterceptSet = this.shouldInterceptSet = $set !== PLATFORM.noop;\n        // when user declare @bindable({ set })\n        // it's expected to work from the start,\n        // regardless where the assignment comes from: either direct view model assignment or from binding during render\n        // so if either getter/setter config is present, alter the accessor straight await\n        if (this.callback === void 0 && !hasPropertyChangedCallback && !shouldInterceptSet) {\n            this.observing = false;\n        }\n        else {\n            this.observing = true;\n            const currentValue = obj[propertyKey];\n            this.currentValue = shouldInterceptSet && currentValue !== void 0\n                ? $set(currentValue)\n                : currentValue;\n            if (!isProxy) {\n                this.createGetterSetter();\n            }\n        }\n        this.persistentFlags = flags & 2080374799 /* persistentBindingFlags */;\n    }\n    handleChange(newValue, oldValue, flags) {\n        this.setValue(newValue, flags);\n    }\n    getValue() {\n        return this.currentValue;\n    }\n    setValue(newValue, flags) {\n        if (this.shouldInterceptSet) {\n            newValue = this.$set(newValue);\n        }\n        if (this.observing) {\n            const currentValue = this.currentValue;\n            // eslint-disable-next-line compat/compat\n            if (Object.is(newValue, currentValue)) {\n                return;\n            }\n            this.currentValue = newValue;\n            if (this.lifecycle.batch.depth === 0) {\n                this.callSubscribers(newValue, currentValue, this.persistentFlags | flags);\n                if ((flags & 4096 /* fromBind */) === 0 || (flags & 32 /* updateSourceExpression */) > 0) {\n                    const callback = this.callback;\n                    if (callback !== void 0) {\n                        callback.call(this.obj, newValue, currentValue, this.persistentFlags | flags);\n                    }\n                    if (this.hasPropertyChangedCallback) {\n                        // eslint-disable-next-line @typescript-eslint/no-unnecessary-type-assertion\n                        this.propertyChangedCallback.call(this.obj, this.propertyKey, newValue, currentValue, this.persistentFlags | flags);\n                    }\n                }\n            }\n            else if (!this.inBatch) {\n                this.inBatch = true;\n                this.oldValue = currentValue;\n                this.lifecycle.batch.add(this);\n            }\n        }\n        else {\n            // See SetterObserver.setValue for explanation\n            this.obj[this.propertyKey] = newValue;\n        }\n    }\n    subscribe(subscriber) {\n        if (this.observing === false) {\n            this.observing = true;\n            const currentValue = this.obj[this.propertyKey];\n            this.currentValue = this.shouldInterceptSet\n                ? this.$set(currentValue)\n                : currentValue;\n            this.createGetterSetter();\n        }\n        this.addSubscriber(subscriber);\n    }\n    createGetterSetter() {\n        if (!Reflect.defineProperty(this.obj, this.propertyKey, {\n            enumerable: true,\n            configurable: true,\n            get: () => this.currentValue,\n            set: (value) => {\n                this.setValue(value, 0 /* none */);\n            }\n        })) {\n            Reporter.write(1, this.propertyKey, this.obj);\n        }\n    }\n};\nBindableObserver = BindableObserver_1 = __decorate([\n    subscriberCollection(),\n    __metadata(\"design:paramtypes\", [Object, Number, Object, String, String, Function])\n], BindableObserver);\nexport { BindableObserver };\n//# sourceMappingURL=bindable-observer.js.map","import { __decorate, __metadata } from \"tslib\";\nimport { BindingMode } from '../../flags';\nimport { bindingBehavior } from '../binding-behavior';\nexport class BindingModeBehavior {\n    constructor(mode) {\n        this.mode = mode;\n        this.originalModes = new WeakMap();\n    }\n    bind(flags, scope, binding) {\n        this.originalModes.set(binding, binding.mode);\n        binding.mode = this.mode;\n    }\n    unbind(flags, scope, binding) {\n        binding.mode = this.originalModes.get(binding);\n    }\n}\nlet OneTimeBindingBehavior = class OneTimeBindingBehavior extends BindingModeBehavior {\n    constructor() {\n        super(BindingMode.oneTime);\n    }\n};\nOneTimeBindingBehavior = __decorate([\n    bindingBehavior('oneTime'),\n    __metadata(\"design:paramtypes\", [])\n], OneTimeBindingBehavior);\nexport { OneTimeBindingBehavior };\nlet ToViewBindingBehavior = class ToViewBindingBehavior extends BindingModeBehavior {\n    constructor() {\n        super(BindingMode.toView);\n    }\n};\nToViewBindingBehavior = __decorate([\n    bindingBehavior('toView'),\n    __metadata(\"design:paramtypes\", [])\n], ToViewBindingBehavior);\nexport { ToViewBindingBehavior };\nlet FromViewBindingBehavior = class FromViewBindingBehavior extends BindingModeBehavior {\n    constructor() {\n        super(BindingMode.fromView);\n    }\n};\nFromViewBindingBehavior = __decorate([\n    bindingBehavior('fromView'),\n    __metadata(\"design:paramtypes\", [])\n], FromViewBindingBehavior);\nexport { FromViewBindingBehavior };\nlet TwoWayBindingBehavior = class TwoWayBindingBehavior extends BindingModeBehavior {\n    constructor() {\n        super(BindingMode.twoWay);\n    }\n};\nTwoWayBindingBehavior = __decorate([\n    bindingBehavior('twoWay'),\n    __metadata(\"design:paramtypes\", [])\n], TwoWayBindingBehavior);\nexport { TwoWayBindingBehavior };\n//# sourceMappingURL=binding-mode.js.map","import { __decorate, __metadata } from \"tslib\";\nimport { bindingBehavior, BindingInterceptor } from '../binding-behavior';\nimport { IScheduler } from '../../scheduler';\nimport { BindingBehaviorExpression } from '../../binding/ast';\nlet DebounceBindingBehavior = class DebounceBindingBehavior extends BindingInterceptor {\n    constructor(binding, expr) {\n        super(binding, expr);\n        this.opts = { delay: 0 };\n        this.firstArg = null;\n        this.task = null;\n        this.taskQueue = binding.locator.get(IScheduler).getPostRenderTaskQueue();\n        if (expr.args.length > 0) {\n            this.firstArg = expr.args[0];\n        }\n    }\n    callSource(args) {\n        this.queueTask(() => this.binding.callSource(args));\n        return void 0;\n    }\n    handleChange(newValue, previousValue, flags) {\n        this.queueTask(() => this.binding.handleChange(newValue, previousValue, flags));\n    }\n    queueTask(callback) {\n        if (this.task !== null) {\n            this.task.cancel();\n        }\n        this.task = this.taskQueue.queueTask(callback, this.opts);\n    }\n    $bind(flags, scope, part) {\n        if (this.firstArg !== null) {\n            const delay = Number(this.firstArg.evaluate(flags, scope, this.locator, part));\n            if (!isNaN(delay)) {\n                this.opts.delay = delay;\n            }\n        }\n        this.binding.$bind(flags, scope, part);\n    }\n};\nDebounceBindingBehavior = __decorate([\n    bindingBehavior('debounce'),\n    __metadata(\"design:paramtypes\", [Object, BindingBehaviorExpression])\n], DebounceBindingBehavior);\nexport { DebounceBindingBehavior };\n//# sourceMappingURL=debounce.js.map","import { __decorate, __metadata, __param } from \"tslib\";\nimport { Reporter } from '@aurelia/kernel';\nimport { ISignaler } from '../../observation/signaler';\nimport { bindingBehavior } from '../binding-behavior';\nlet SignalBindingBehavior = class SignalBindingBehavior {\n    constructor(signaler) {\n        this.signaler = signaler;\n    }\n    bind(flags, scope, binding, ...args) {\n        if (!binding.updateTarget) {\n            throw Reporter.error(11);\n        }\n        if (arguments.length === 4) {\n            const name = args[0];\n            this.signaler.addSignalListener(name, binding);\n            binding.signal = name;\n        }\n        else if (arguments.length > 4) {\n            const names = Array.prototype.slice.call(args.length + 3, 3);\n            let i = names.length;\n            while (i--) {\n                const name = names[i];\n                this.signaler.addSignalListener(name, binding);\n            }\n            binding.signal = names;\n        }\n        else {\n            throw Reporter.error(12);\n        }\n    }\n    unbind(flags, scope, binding) {\n        const name = binding.signal;\n        binding.signal = null;\n        if (Array.isArray(name)) {\n            const names = name;\n            let i = names.length;\n            while (i--) {\n                this.signaler.removeSignalListener(names[i], binding);\n            }\n        }\n        else {\n            this.signaler.removeSignalListener(name, binding);\n        }\n    }\n};\nSignalBindingBehavior = __decorate([\n    bindingBehavior('signal'),\n    __param(0, ISignaler),\n    __metadata(\"design:paramtypes\", [Object])\n], SignalBindingBehavior);\nexport { SignalBindingBehavior };\n//# sourceMappingURL=signals.js.map","import { __decorate, __metadata } from \"tslib\";\nimport { bindingBehavior, BindingInterceptor } from '../binding-behavior';\nimport { IScheduler, IClock } from '../../scheduler';\nimport { BindingBehaviorExpression } from '../../binding/ast';\nlet ThrottleBindingBehavior = class ThrottleBindingBehavior extends BindingInterceptor {\n    constructor(binding, expr) {\n        super(binding, expr);\n        this.opts = { delay: 0 };\n        this.firstArg = null;\n        this.task = null;\n        this.lastCall = 0;\n        this.taskQueue = binding.locator.get(IScheduler).getPostRenderTaskQueue();\n        this.clock = binding.locator.get(IClock);\n        if (expr.args.length > 0) {\n            this.firstArg = expr.args[0];\n        }\n    }\n    callSource(args) {\n        this.queueTask(() => this.binding.callSource(args));\n        return void 0;\n    }\n    handleChange(newValue, previousValue, flags) {\n        this.queueTask(() => this.binding.handleChange(newValue, previousValue, flags));\n    }\n    queueTask(callback) {\n        const opts = this.opts;\n        const clock = this.clock;\n        const nextDelay = this.lastCall + opts.delay - clock.now();\n        if (nextDelay > 0) {\n            if (this.task !== null) {\n                this.task.cancel();\n            }\n            opts.delay = nextDelay;\n            this.task = this.taskQueue.queueTask(() => {\n                this.lastCall = clock.now();\n                callback();\n            }, opts);\n        }\n        else {\n            this.lastCall = clock.now();\n            callback();\n        }\n    }\n    $bind(flags, scope, part) {\n        if (this.firstArg !== null) {\n            const delay = Number(this.firstArg.evaluate(flags, scope, this.locator, part));\n            if (!isNaN(delay)) {\n                this.opts.delay = delay;\n            }\n        }\n        this.binding.$bind(flags, scope, part);\n    }\n};\nThrottleBindingBehavior = __decorate([\n    bindingBehavior('throttle'),\n    __metadata(\"design:paramtypes\", [Object, BindingBehaviorExpression])\n], ThrottleBindingBehavior);\nexport { ThrottleBindingBehavior };\n//# sourceMappingURL=throttle.js.map","import { __decorate, __metadata } from \"tslib\";\nimport { kebabCase, Metadata, Protocol, firstDefined, getPrototypeChain, PLATFORM, } from '@aurelia/kernel';\nimport { BindingMode, } from '../flags';\nexport function bindable(configOrTarget, prop) {\n    let config;\n    function decorator($target, $prop) {\n        if (arguments.length > 1) {\n            // Non invocation:\n            // - @bindable\n            // Invocation with or w/o opts:\n            // - @bindable()\n            // - @bindable({...opts})\n            config.property = $prop;\n        }\n        Metadata.define(Bindable.name, BindableDefinition.create($prop, config), $target.constructor, $prop);\n        Protocol.annotation.appendTo($target.constructor, Bindable.keyFrom($prop));\n    }\n    if (arguments.length > 1) {\n        // Non invocation:\n        // - @bindable\n        config = {};\n        decorator(configOrTarget, prop);\n        return;\n    }\n    else if (typeof configOrTarget === 'string') {\n        // ClassDecorator\n        // - @bindable('bar')\n        // Direct call:\n        // - @bindable('bar')(Foo)\n        config = {};\n        return decorator;\n    }\n    // Invocation with or w/o opts:\n    // - @bindable()\n    // - @bindable({...opts})\n    config = configOrTarget === void 0 ? {} : configOrTarget;\n    return decorator;\n}\nfunction isBindableAnnotation(key) {\n    return key.startsWith(Bindable.name);\n}\nexport const Bindable = {\n    name: Protocol.annotation.keyFor('bindable'),\n    keyFrom(name) {\n        return `${Bindable.name}:${name}`;\n    },\n    from(...bindableLists) {\n        const bindables = {};\n        // eslint-disable-next-line @typescript-eslint/unbound-method\n        const isArray = Array.isArray;\n        function addName(name) {\n            bindables[name] = BindableDefinition.create(name);\n        }\n        function addDescription(name, def) {\n            bindables[name] = def instanceof BindableDefinition ? def : BindableDefinition.create(name, def);\n        }\n        function addList(maybeList) {\n            if (isArray(maybeList)) {\n                maybeList.forEach(addName);\n            }\n            else if (maybeList instanceof BindableDefinition) {\n                bindables[maybeList.property] = maybeList;\n            }\n            else if (maybeList !== void 0) {\n                Object.keys(maybeList).forEach(name => addDescription(name, maybeList[name]));\n            }\n        }\n        bindableLists.forEach(addList);\n        return bindables;\n    },\n    for(Type) {\n        let def;\n        const builder = {\n            add(configOrProp) {\n                let prop;\n                let config;\n                if (typeof configOrProp === 'string') {\n                    prop = configOrProp;\n                    config = { property: prop };\n                }\n                else {\n                    prop = configOrProp.property;\n                    config = configOrProp;\n                }\n                def = BindableDefinition.create(prop, config);\n                if (!Metadata.hasOwn(Bindable.name, Type, prop)) {\n                    Protocol.annotation.appendTo(Type, Bindable.keyFrom(prop));\n                }\n                Metadata.define(Bindable.name, def, Type, prop);\n                return builder;\n            },\n            mode(mode) {\n                def.mode = mode;\n                return builder;\n            },\n            callback(callback) {\n                def.callback = callback;\n                return builder;\n            },\n            attribute(attribute) {\n                def.attribute = attribute;\n                return builder;\n            },\n            primary() {\n                def.primary = true;\n                return builder;\n            },\n            set(setInterpreter) {\n                def.set = setInterpreter;\n                return builder;\n            }\n        };\n        return builder;\n    },\n    getAll(Type) {\n        const propStart = Bindable.name.length + 1;\n        const defs = [];\n        const prototypeChain = getPrototypeChain(Type);\n        let iProto = prototypeChain.length;\n        let iDefs = 0;\n        let keys;\n        let keysLen;\n        let Class;\n        while (--iProto >= 0) {\n            Class = prototypeChain[iProto];\n            keys = Protocol.annotation.getKeys(Class).filter(isBindableAnnotation);\n            keysLen = keys.length;\n            for (let i = 0; i < keysLen; ++i) {\n                defs[iDefs++] = Metadata.getOwn(Bindable.name, Class, keys[i].slice(propStart));\n            }\n        }\n        return defs;\n    },\n};\nexport class BindableDefinition {\n    constructor(attribute, callback, mode, primary, property, set) {\n        this.attribute = attribute;\n        this.callback = callback;\n        this.mode = mode;\n        this.primary = primary;\n        this.property = property;\n        this.set = set;\n    }\n    static create(prop, def = {}) {\n        return new BindableDefinition(firstDefined(def.attribute, kebabCase(prop)), firstDefined(def.callback, `${prop}Changed`), firstDefined(def.mode, BindingMode.toView), firstDefined(def.primary, false), firstDefined(def.property, prop), firstDefined(def.set, PLATFORM.noop));\n    }\n}\n/* eslint-disable @typescript-eslint/no-unused-vars,spaced-comment */\n/**\n * This function serves two purposes:\n * - A playground for contributors to try their changes to the APIs.\n * - Cause the API surface to be properly type-checked and protected against accidental type regressions.\n *\n * It will be automatically removed by dead code elimination.\n */\nfunction apiTypeCheck() {\n    let Foo = \n    // > expected error - class decorator only accepts a string\n    //@bindable({})\n    class Foo {\n    };\n    __decorate([\n        bindable,\n        bindable(),\n        bindable({})\n        // > expected error - 'property' does not exist on decorator input object\n        //@bindable({ property: 'prop' })\n        ,\n        bindable({ mode: BindingMode.twoWay }),\n        bindable({ callback: 'propChanged' }),\n        bindable({ attribute: 'prop' }),\n        bindable({ primary: true }),\n        bindable({ set: value => String(value) }),\n        bindable({ set: value => Number(value) }),\n        bindable({\n            mode: BindingMode.twoWay,\n            callback: 'propChanged',\n            attribute: 'prop',\n            primary: true,\n            set: value => String(value)\n        }),\n        __metadata(\"design:type\", Object)\n    ], Foo.prototype, \"prop\", void 0);\n    Foo = __decorate([\n        bindable('prop')\n        // > expected error - class decorator only accepts a string\n        //@bindable({})\n    ], Foo);\n    Bindable.for(Foo)\n        // > expected error - there is no add() function with only optional params on the fluent api\n        //.add()\n        // > expected error - 'property' is a required property on the fluent api\n        //.add({})\n        .add({ property: 'prop' })\n        .add({ property: 'prop', mode: BindingMode.twoWay })\n        .add({ property: 'prop', callback: 'propChanged' })\n        .add({ property: 'prop', attribute: 'prop' })\n        .add({ property: 'prop', primary: true })\n        .add({ property: 'prop', mode: BindingMode.twoWay, callback: 'propChanged', attribute: 'prop', primary: true })\n        .add('prop')\n        // > expected error - the add() method that accepts an object literal does not return a fluent api\n        //.add({ property: 'prop' }).mode(BindingMode.twoWay)\n        //.add({ property: 'prop' }).callback('propChanged')\n        //.add({ property: 'prop' }).attribute('prop')\n        //.add({ property: 'prop' }).primary()\n        // > expected error - fluent api methods can only be invoked once per bindable\n        //.add('prop').mode(BindingMode.twoWay).mode(BindingMode.twoWay)\n        //.add('prop').mode(BindingMode.twoWay).callback('propChanged').mode(BindingMode.twoWay)\n        //.add('prop').mode(BindingMode.twoWay).callback('propChanged').callback('propChanged') // etc\n        // > expected error - wrong invocation order\n        //.add('prop').callback('propChanged').mode(BindingMode.twoWay)\n        //.add('prop').primary().mode(BindingMode.twoWay)  // etc\n        .add('prop').mode(BindingMode.twoWay)\n        .add('prop').mode(BindingMode.twoWay).callback('propChanged')\n        .add('prop').mode(BindingMode.twoWay).callback('propChanged').attribute('prop')\n        .add('prop').mode(BindingMode.twoWay).callback('propChanged').attribute('prop').primary()\n        .add('prop').mode(BindingMode.twoWay).set((value) => Number(value))\n        .add('prop').mode(BindingMode.twoWay).callback('propChanged').set(value => Number(value))\n        .add('prop').callback('propChanged')\n        .add('prop').callback('propChanged').attribute('prop')\n        .add('prop').callback('propChanged').attribute('prop').primary()\n        .add('prop').attribute('prop')\n        .add('prop').attribute('prop').primary()\n        .add('prop').primary();\n}\n/* eslint-enable @typescript-eslint/no-unused-vars,spaced-comment */\n//# sourceMappingURL=bindable.js.map","import { Registration, Protocol, Metadata, mergeArrays, firstDefined, } from '@aurelia/kernel';\nimport { HooksDefinition, registerAliases, } from '../definitions';\nimport { BindingMode, } from '../flags';\nimport { Bindable } from '../templating/bindable';\nexport function customAttribute(nameOrDef) {\n    return function (target) {\n        return CustomAttribute.define(nameOrDef, target);\n    };\n}\nexport function templateController(nameOrDef) {\n    return function (target) {\n        return CustomAttribute.define(typeof nameOrDef === 'string'\n            ? { isTemplateController: true, name: nameOrDef }\n            : { isTemplateController: true, ...nameOrDef }, target);\n    };\n}\nexport class CustomAttributeDefinition {\n    constructor(Type, name, aliases, key, defaultBindingMode, isTemplateController, bindables, strategy, hooks, noMultiBindings) {\n        this.Type = Type;\n        this.name = name;\n        this.aliases = aliases;\n        this.key = key;\n        this.defaultBindingMode = defaultBindingMode;\n        this.isTemplateController = isTemplateController;\n        this.bindables = bindables;\n        this.strategy = strategy;\n        this.hooks = hooks;\n        this.noMultiBindings = noMultiBindings;\n    }\n    static create(nameOrDef, Type) {\n        let name;\n        let def;\n        if (typeof nameOrDef === 'string') {\n            name = nameOrDef;\n            def = { name };\n        }\n        else {\n            name = nameOrDef.name;\n            def = nameOrDef;\n        }\n        return new CustomAttributeDefinition(Type, firstDefined(CustomAttribute.getAnnotation(Type, 'name'), name), mergeArrays(CustomAttribute.getAnnotation(Type, 'aliases'), def.aliases, Type.aliases), CustomAttribute.keyFrom(name), firstDefined(CustomAttribute.getAnnotation(Type, 'defaultBindingMode'), def.defaultBindingMode, Type.defaultBindingMode, BindingMode.toView), firstDefined(CustomAttribute.getAnnotation(Type, 'isTemplateController'), def.isTemplateController, Type.isTemplateController, false), Bindable.from(...Bindable.getAll(Type), CustomAttribute.getAnnotation(Type, 'bindables'), Type.bindables, def.bindables), firstDefined(CustomAttribute.getAnnotation(Type, 'strategy'), def.strategy, Type.strategy, 1 /* getterSetter */), firstDefined(CustomAttribute.getAnnotation(Type, 'hooks'), def.hooks, Type.hooks, new HooksDefinition(Type.prototype)), firstDefined(CustomAttribute.getAnnotation(Type, 'noMultiBindings'), def.noMultiBindings, Type.noMultiBindings, false));\n    }\n    register(container) {\n        const { Type, key, aliases } = this;\n        Registration.transient(key, Type).register(container);\n        Registration.alias(key, Type).register(container);\n        registerAliases(aliases, CustomAttribute, key, container);\n    }\n}\nexport const CustomAttribute = {\n    name: Protocol.resource.keyFor('custom-attribute'),\n    keyFrom(name) {\n        return `${CustomAttribute.name}:${name}`;\n    },\n    isType(value) {\n        return typeof value === 'function' && Metadata.hasOwn(CustomAttribute.name, value);\n    },\n    for(node, name) {\n        return Metadata.getOwn(CustomAttribute.keyFrom(name), node);\n    },\n    define(nameOrDef, Type) {\n        const definition = CustomAttributeDefinition.create(nameOrDef, Type);\n        Metadata.define(CustomAttribute.name, definition, definition.Type);\n        Metadata.define(CustomAttribute.name, definition, definition);\n        Protocol.resource.appendTo(Type, CustomAttribute.name);\n        return definition.Type;\n    },\n    getDefinition(Type) {\n        const def = Metadata.getOwn(CustomAttribute.name, Type);\n        if (def === void 0) {\n            throw new Error(`No definition found for type ${Type.name}`);\n        }\n        return def;\n    },\n    annotate(Type, prop, value) {\n        Metadata.define(Protocol.annotation.keyFor(prop), value, Type);\n    },\n    getAnnotation(Type, prop) {\n        return Metadata.getOwn(Protocol.annotation.keyFor(prop), Type);\n    },\n};\n//# sourceMappingURL=custom-attribute.js.map","import { DI, PLATFORM, Reporter, } from '@aurelia/kernel';\nexport const INode = DI.createInterface('INode').noDefault();\nexport const IRenderLocation = DI.createInterface('IRenderLocation').noDefault();\nexport const IDOM = DI.createInterface('IDOM').noDefault();\nconst ni = function (...args) {\n    throw Reporter.error(1000); // TODO: create error code (not implemented exception)\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n}; // this function doesn't need typing because it is never directly called\nconst niDOM = {\n    addEventListener: ni,\n    appendChild: ni,\n    cloneNode: ni,\n    convertToRenderLocation: ni,\n    createDocumentFragment: ni,\n    createNodeSequence: ni,\n    createElement: ni,\n    createCustomEvent: ni,\n    dispatchEvent: ni,\n    createNodeObserver: ni,\n    createTemplate: ni,\n    createTextNode: ni,\n    getEffectiveParentNode: ni,\n    setEffectiveParentNode: ni,\n    insertBefore: ni,\n    isMarker: ni,\n    isNodeInstance: ni,\n    isRenderLocation: ni,\n    makeTarget: ni,\n    registerElementResolver: ni,\n    remove: ni,\n    removeEventListener: ni,\n    setAttribute: ni\n};\nexport const DOM = {\n    ...niDOM,\n    scheduler: (void 0),\n    get isInitialized() {\n        return Reflect.get(this, '$initialized') === true;\n    },\n    initialize(dom) {\n        if (this.isInitialized) {\n            throw Reporter.error(1001); // TODO: create error code (already initialized, check isInitialized property and call destroy() if you want to assign a different dom)\n        }\n        const descriptors = {};\n        const protos = [dom];\n        let proto = Object.getPrototypeOf(dom);\n        while (proto && proto !== Object.prototype) {\n            protos.unshift(proto);\n            proto = Object.getPrototypeOf(proto);\n        }\n        for (proto of protos) {\n            Object.assign(descriptors, Object.getOwnPropertyDescriptors(proto));\n        }\n        const keys = [];\n        let key;\n        let descriptor;\n        for (key in descriptors) {\n            descriptor = descriptors[key];\n            if (descriptor.configurable && descriptor.writable) {\n                Reflect.defineProperty(this, key, descriptor);\n                keys.push(key);\n            }\n        }\n        Reflect.set(this, '$domKeys', keys);\n        Reflect.set(this, '$initialized', true);\n    },\n    destroy() {\n        if (!this.isInitialized) {\n            throw Reporter.error(1002); // TODO: create error code (already destroyed)\n        }\n        const keys = Reflect.get(this, '$domKeys');\n        keys.forEach(key => {\n            Reflect.deleteProperty(this, key);\n        });\n        Object.assign(this, niDOM);\n        Reflect.set(this, '$domKeys', PLATFORM.emptyArray);\n        Reflect.set(this, '$initialized', false);\n    }\n};\n// This is an implementation of INodeSequence that represents \"no DOM\" to render.\n// It's used in various places to avoid null and to encode\n// the explicit idea of \"no view\".\nconst emptySequence = {\n    isMounted: false,\n    isLinked: false,\n    next: void 0,\n    childNodes: PLATFORM.emptyArray,\n    firstChild: null,\n    lastChild: null,\n    findTargets() { return PLATFORM.emptyArray; },\n    insertBefore(refNode) { },\n    appendTo(parent) { },\n    remove() { },\n    addToLinked() { },\n    unlink() { },\n    link(next) { },\n};\nexport const NodeSequence = {\n    empty: emptySequence\n};\n//# sourceMappingURL=dom.js.map","import { __decorate, __metadata, __param } from \"tslib\";\nimport { nextId } from '@aurelia/kernel';\nimport { IRenderLocation } from '../../dom';\nimport { IViewFactory } from '../../lifecycle';\nimport { templateController } from '../custom-attribute';\nclass FlagsTemplateController {\n    constructor(factory, location, flags) {\n        this.factory = factory;\n        this.flags = flags;\n        this.id = nextId('au$component');\n        this.view = this.factory.create();\n        this.view.hold(location, 1 /* insertBefore */);\n    }\n    beforeBind(flags) {\n        this.view.parent = this.$controller;\n        return this.view.bind(flags | this.flags, this.$controller.scope);\n    }\n    beforeAttach(flags) {\n        this.view.attach(flags);\n    }\n    beforeDetach(flags) {\n        this.view.detach(flags);\n    }\n    beforeUnbind(flags) {\n        const task = this.view.unbind(flags);\n        this.view.parent = void 0;\n        return task;\n    }\n}\nlet InfrequentMutations = class InfrequentMutations extends FlagsTemplateController {\n    constructor(factory, location) {\n        super(factory, location, 268435456 /* noTargetObserverQueue */);\n    }\n};\nInfrequentMutations = __decorate([\n    templateController('infrequent-mutations'),\n    __param(0, IViewFactory), __param(1, IRenderLocation),\n    __metadata(\"design:paramtypes\", [Object, Object])\n], InfrequentMutations);\nexport { InfrequentMutations };\nlet FrequentMutations = class FrequentMutations extends FlagsTemplateController {\n    constructor(factory, location) {\n        super(factory, location, 536870912 /* persistentTargetObserverQueue */);\n    }\n};\nFrequentMutations = __decorate([\n    templateController('frequent-mutations'),\n    __param(0, IViewFactory), __param(1, IRenderLocation),\n    __metadata(\"design:paramtypes\", [Object, Object])\n], FrequentMutations);\nexport { FrequentMutations };\nlet ObserveShallow = class ObserveShallow extends FlagsTemplateController {\n    constructor(factory, location) {\n        super(factory, location, 134217728 /* observeLeafPropertiesOnly */);\n    }\n};\nObserveShallow = __decorate([\n    templateController('observe-shallow'),\n    __param(0, IViewFactory), __param(1, IRenderLocation),\n    __metadata(\"design:paramtypes\", [Object, Object])\n], ObserveShallow);\nexport { ObserveShallow };\n//# sourceMappingURL=flags.js.map","import { __decorate, __metadata, __param } from \"tslib\";\nimport { DI, IServiceLocator, Registration, } from '@aurelia/kernel';\nexport const LifecycleTask = {\n    done: {\n        done: true,\n        canCancel() { return false; },\n        cancel() { return; },\n        wait() { return Promise.resolve(); }\n    }\n};\nexport var TaskSlot;\n(function (TaskSlot) {\n    TaskSlot[TaskSlot[\"beforeCreate\"] = 0] = \"beforeCreate\";\n    TaskSlot[TaskSlot[\"beforeRender\"] = 1] = \"beforeRender\";\n    TaskSlot[TaskSlot[\"beforeBind\"] = 2] = \"beforeBind\";\n    TaskSlot[TaskSlot[\"beforeAttach\"] = 3] = \"beforeAttach\";\n})(TaskSlot || (TaskSlot = {}));\nexport const IStartTask = DI.createInterface('IStartTask').noDefault();\nvar TaskType;\n(function (TaskType) {\n    TaskType[TaskType[\"with\"] = 0] = \"with\";\n    TaskType[TaskType[\"from\"] = 1] = \"from\";\n})(TaskType || (TaskType = {}));\n// eslint-disable-next-line @typescript-eslint/class-name-casing\nexport const StartTask = class $StartTask {\n    constructor(type) {\n        this.type = type;\n        this._slot = void 0;\n        this._promiseOrTask = void 0;\n        this._container = void 0;\n        this._key = void 0;\n        this._callback = void 0;\n        this._task = void 0;\n    }\n    get slot() {\n        if (this._slot === void 0) {\n            throw new Error('StartTask.slot is not set');\n        }\n        return this._slot;\n    }\n    get promiseOrTask() {\n        if (this._promiseOrTask === void 0) {\n            throw new Error('StartTask.promiseOrTask is not set');\n        }\n        return this._promiseOrTask;\n    }\n    get container() {\n        if (this._container === void 0) {\n            throw new Error('StartTask.container is not set');\n        }\n        return this._container;\n    }\n    get key() {\n        if (this._key === void 0) {\n            throw new Error('StartTask.key is not set');\n        }\n        return this._key;\n    }\n    get callback() {\n        if (this._callback === void 0) {\n            throw new Error('StartTask.callback is not set');\n        }\n        return this._callback;\n    }\n    get task() {\n        if (this._task === void 0) {\n            throw new Error('StartTask.task is not set');\n        }\n        return this._task;\n    }\n    static with(key) {\n        const task = new $StartTask(0 /* with */);\n        task._key = key;\n        return task;\n    }\n    static from(promiseOrTask) {\n        const task = new $StartTask(1 /* from */);\n        task._promiseOrTask = promiseOrTask;\n        return task;\n    }\n    beforeCreate() {\n        return this.at(0 /* beforeCreate */);\n    }\n    beforeRender() {\n        return this.at(1 /* beforeRender */);\n    }\n    beforeBind() {\n        return this.at(2 /* beforeBind */);\n    }\n    beforeAttach() {\n        return this.at(3 /* beforeAttach */);\n    }\n    at(slot) {\n        this._slot = slot;\n        return this;\n    }\n    call(fn) {\n        this._callback = fn;\n        return this;\n    }\n    register(container) {\n        return this._container = container.register(Registration.instance(IStartTask, this));\n    }\n    resolveTask() {\n        if (this._task === void 0) {\n            switch (this.type) {\n                case 0 /* with */:\n                    this._task = new ProviderTask(this.container, this.key, this.callback);\n                    break;\n                case 1 /* from */:\n                    this._task = new TerminalTask(this.promiseOrTask);\n                    break;\n            }\n        }\n        return this.task;\n    }\n};\nexport const IStartTaskManager = DI.createInterface('IStartTaskManager').noDefault();\nlet StartTaskManager = class StartTaskManager {\n    constructor(locator) {\n        this.locator = locator;\n    }\n    static register(container) {\n        return Registration.singleton(IStartTaskManager, this).register(container);\n    }\n    runBeforeCreate(locator = this.locator) {\n        return this.run(0 /* beforeCreate */, locator);\n    }\n    runBeforeRender(locator = this.locator) {\n        return this.run(1 /* beforeRender */, locator);\n    }\n    runBeforeBind(locator = this.locator) {\n        return this.run(2 /* beforeBind */, locator);\n    }\n    runBeforeAttach(locator = this.locator) {\n        return this.run(3 /* beforeAttach */, locator);\n    }\n    run(slot, locator = this.locator) {\n        const tasks = locator.getAll(IStartTask)\n            .filter(startTask => startTask.slot === slot)\n            .map(startTask => startTask.resolveTask())\n            .filter(task => !task.done);\n        if (tasks.length === 0) {\n            return LifecycleTask.done;\n        }\n        return new AggregateTerminalTask(tasks);\n    }\n};\nStartTaskManager = __decorate([\n    __param(0, IServiceLocator),\n    __metadata(\"design:paramtypes\", [Object])\n], StartTaskManager);\nexport { StartTaskManager };\nexport class PromiseTask {\n    constructor(promise, next, context, ...args) {\n        this.done = false;\n        this.hasStarted = false;\n        this.isCancelled = false;\n        this.promise = promise.then(value => {\n            if (this.isCancelled === true) {\n                return;\n            }\n            this.hasStarted = true;\n            if (next !== null) {\n                const nextResult = next.call(context, value, ...args);\n                if (nextResult === void 0) {\n                    this.done = true;\n                }\n                else {\n                    const nextPromise = nextResult.then instanceof Function\n                        ? nextResult\n                        : nextResult.wait();\n                    return nextPromise.then(() => {\n                        this.done = true;\n                    });\n                }\n            }\n        });\n    }\n    canCancel() {\n        return !this.hasStarted;\n    }\n    cancel() {\n        if (this.canCancel()) {\n            this.isCancelled = true;\n        }\n    }\n    wait() {\n        return this.promise;\n    }\n}\nexport class ProviderTask {\n    constructor(container, key, callback) {\n        this.container = container;\n        this.key = key;\n        this.callback = callback;\n        this.done = false;\n    }\n    canCancel() {\n        return false;\n    }\n    cancel() {\n        return;\n    }\n    wait() {\n        if (this.promise === void 0) {\n            const instance = this.container.get(this.key);\n            const maybePromiseOrTask = this.callback.call(void 0, instance);\n            this.promise = maybePromiseOrTask === void 0\n                ? Promise.resolve()\n                : maybePromiseOrTask.then instanceof Function\n                    ? maybePromiseOrTask\n                    : maybePromiseOrTask.wait();\n            this.promise = this.promise.then(() => {\n                this.done = true;\n                this.container = (void 0);\n                this.key = (void 0);\n                this.callback = (void 0);\n            }).catch(e => { throw e; });\n        }\n        return this.promise;\n    }\n}\nexport class ContinuationTask {\n    constructor(antecedent, next, context, ...args) {\n        this.done = false;\n        this.hasStarted = false;\n        this.isCancelled = false;\n        const promise = antecedent.then instanceof Function\n            ? antecedent\n            : antecedent.wait();\n        this.promise = promise.then(() => {\n            if (this.isCancelled === true) {\n                return;\n            }\n            this.hasStarted = true;\n            const nextResult = next.call(context, ...args);\n            if (nextResult === void 0) {\n                this.done = true;\n            }\n            else {\n                const nextPromise = nextResult.then instanceof Function\n                    ? nextResult\n                    : nextResult.wait();\n                return nextPromise.then(() => {\n                    this.done = true;\n                });\n            }\n        });\n    }\n    canCancel() {\n        return !this.hasStarted;\n    }\n    cancel() {\n        if (this.canCancel()) {\n            this.isCancelled = true;\n        }\n    }\n    wait() {\n        return this.promise;\n    }\n}\nexport class TerminalTask {\n    constructor(antecedent) {\n        this.done = false;\n        this.promise = antecedent.then instanceof Function\n            ? antecedent\n            : antecedent.wait();\n        this.promise.then(() => {\n            this.done = true;\n        }).catch(e => { throw e; });\n    }\n    canCancel() {\n        return false;\n    }\n    cancel() {\n        return;\n    }\n    wait() {\n        return this.promise;\n    }\n}\nexport class AggregateContinuationTask {\n    constructor(antecedents, next, context, ...args) {\n        this.done = false;\n        this.hasStarted = false;\n        this.isCancelled = false;\n        this.promise = Promise.all(antecedents.map(t => t.wait())).then(() => {\n            if (this.isCancelled === true) {\n                return;\n            }\n            this.hasStarted = true;\n            const nextResult = next.call(context, ...args);\n            if (nextResult === void 0) {\n                this.done = true;\n            }\n            else {\n                return nextResult.wait().then(() => {\n                    this.done = true;\n                });\n            }\n        });\n    }\n    canCancel() {\n        return !this.hasStarted;\n    }\n    cancel() {\n        if (this.canCancel()) {\n            this.isCancelled = true;\n        }\n    }\n    wait() {\n        return this.promise;\n    }\n}\nexport class AggregateTerminalTask {\n    constructor(antecedents) {\n        this.done = false;\n        this.promise = Promise.all(antecedents.map(t => t.wait())).then(() => {\n            this.done = true;\n        });\n    }\n    canCancel() {\n        return false;\n    }\n    cancel() {\n        return;\n    }\n    wait() {\n        return this.promise;\n    }\n}\nexport function hasAsyncWork(value) {\n    return !(value === void 0 || value.done === true);\n}\n//# sourceMappingURL=lifecycle-task.js.map","import { __decorate, __metadata, __param } from \"tslib\";\nimport { nextId } from '@aurelia/kernel';\nimport { IRenderLocation } from '../../dom';\nimport { IViewFactory } from '../../lifecycle';\nimport { ContinuationTask, LifecycleTask, PromiseTask } from '../../lifecycle-task';\nimport { bindable } from '../../templating/bindable';\nimport { templateController } from '../custom-attribute';\nlet If = class If {\n    constructor(ifFactory, location) {\n        this.ifFactory = ifFactory;\n        this.location = location;\n        this.id = nextId('au$component');\n        this.elseFactory = void 0;\n        this.elseView = void 0;\n        this.ifView = void 0;\n        this.view = void 0;\n        this.task = LifecycleTask.done;\n        this.value = false;\n    }\n    ;\n    beforeBind(flags) {\n        if (this.task.done) {\n            this.task = this.swap(this.value, flags);\n        }\n        else {\n            this.task = new ContinuationTask(this.task, this.swap, this, this.value, flags);\n        }\n        return this.task;\n    }\n    beforeAttach(flags) {\n        if (this.task.done) {\n            this.attachView(flags);\n        }\n        else {\n            this.task = new ContinuationTask(this.task, this.attachView, this, flags);\n        }\n    }\n    beforeDetach(flags) {\n        if (this.view !== void 0) {\n            if (this.task.done) {\n                this.view.detach(flags);\n            }\n            else {\n                this.task = new ContinuationTask(this.task, this.view.detach, this.view, flags);\n            }\n        }\n        return this.task;\n    }\n    beforeUnbind(flags) {\n        if (this.view !== void 0) {\n            if (this.task.done) {\n                this.task = this.view.unbind(flags);\n            }\n            else {\n                this.task = new ContinuationTask(this.task, this.view.unbind, this.view, flags);\n            }\n        }\n        return this.task;\n    }\n    caching(flags) {\n        if (this.ifView !== void 0 && this.ifView.release(flags)) {\n            this.ifView = void 0;\n        }\n        if (this.elseView !== void 0 && this.elseView.release(flags)) {\n            this.elseView = void 0;\n        }\n        this.view = void 0;\n    }\n    valueChanged(newValue, oldValue, flags) {\n        if ((this.$controller.state & 4 /* isBound */) === 0) {\n            return;\n        }\n        if (this.task.done) {\n            this.task = this.swap(this.value, flags);\n        }\n        else {\n            this.task = new ContinuationTask(this.task, this.swap, this, this.value, flags);\n        }\n    }\n    /** @internal */\n    updateView(value, flags) {\n        let view;\n        if (value) {\n            view = this.ifView = this.ensureView(this.ifView, this.ifFactory, flags);\n        }\n        else if (this.elseFactory != void 0) {\n            view = this.elseView = this.ensureView(this.elseView, this.elseFactory, flags);\n        }\n        else {\n            view = void 0;\n        }\n        return view;\n    }\n    /** @internal */\n    ensureView(view, factory, flags) {\n        if (view === void 0) {\n            view = factory.create(flags);\n        }\n        view.hold(this.location, 1 /* insertBefore */);\n        return view;\n    }\n    swap(value, flags) {\n        let task = LifecycleTask.done;\n        if ((value === true && this.elseView !== void 0)\n            || (value !== true && this.ifView !== void 0)) {\n            task = this.deactivate(flags);\n        }\n        if (task.done) {\n            const view = this.updateView(value, flags);\n            task = this.activate(view, flags);\n        }\n        else {\n            task = new PromiseTask(task.wait().then(() => this.updateView(value, flags)), this.activate, this, flags);\n        }\n        return task;\n    }\n    deactivate(flags) {\n        const view = this.view;\n        if (view === void 0) {\n            return LifecycleTask.done;\n        }\n        view.detach(flags); // TODO: link this up with unbind\n        const task = view.unbind(flags);\n        view.parent = void 0;\n        return task;\n    }\n    activate(view, flags) {\n        this.view = view;\n        if (view === void 0) {\n            return LifecycleTask.done;\n        }\n        let task = this.bindView(flags);\n        if ((this.$controller.state & 32 /* isAttached */) === 0) {\n            return task;\n        }\n        if (task.done) {\n            this.attachView(flags);\n        }\n        else {\n            task = new ContinuationTask(task, this.attachView, this, flags);\n        }\n        return task;\n    }\n    bindView(flags) {\n        if (this.view !== void 0 && (this.$controller.state & 5 /* isBoundOrBinding */) > 0) {\n            this.view.parent = this.$controller;\n            return this.view.bind(flags, this.$controller.scope, this.$controller.part);\n        }\n        return LifecycleTask.done;\n    }\n    attachView(flags) {\n        if (this.view !== void 0 && (this.$controller.state & 40 /* isAttachedOrAttaching */) > 0) {\n            this.view.attach(flags);\n        }\n    }\n};\n__decorate([\n    bindable,\n    __metadata(\"design:type\", Boolean)\n], If.prototype, \"value\", void 0);\nIf = __decorate([\n    templateController('if'),\n    __param(0, IViewFactory),\n    __param(1, IRenderLocation),\n    __metadata(\"design:paramtypes\", [Object, Object])\n], If);\nexport { If };\nlet Else = class Else {\n    constructor(factory) {\n        this.factory = factory;\n        this.id = nextId('au$component');\n    }\n    link(ifBehavior) {\n        if (ifBehavior instanceof If) {\n            ifBehavior.elseFactory = this.factory;\n        }\n        else if (ifBehavior.viewModel instanceof If) {\n            ifBehavior.viewModel.elseFactory = this.factory;\n        }\n        else {\n            throw new Error(`Unsupported IfBehavior`); // TODO: create error code\n        }\n    }\n};\nElse = __decorate([\n    templateController('else'),\n    __param(0, IViewFactory),\n    __metadata(\"design:paramtypes\", [Object])\n], Else);\nexport { Else };\n//# sourceMappingURL=if.js.map","import { __decorate, __metadata, __param } from \"tslib\";\nimport { compareNumber, nextId } from '@aurelia/kernel';\nimport { IRenderLocation } from '../../dom';\nimport { IViewFactory, IController } from '../../lifecycle';\nimport { AggregateContinuationTask, ContinuationTask, LifecycleTask, } from '../../lifecycle-task';\nimport { applyMutationsToIndices, synchronizeIndices } from '../../observation/array-observer';\nimport { BindingContext, Scope } from '../../observation/binding-context';\nimport { getCollectionObserver } from '../../observation/observer-locator';\nimport { bindable } from '../../templating/bindable';\nimport { templateController } from '../custom-attribute';\nlet Repeat = class Repeat {\n    constructor(location, renderable, factory) {\n        this.location = location;\n        this.renderable = renderable;\n        this.factory = factory;\n        this.id = nextId('au$component');\n        this.hasPendingInstanceMutation = false;\n        this.observer = void 0;\n        this.views = [];\n        this.key = void 0;\n        this.task = LifecycleTask.done;\n        this.normalizedItems = void 0;\n    }\n    beforeBind(flags) {\n        this.checkCollectionObserver(flags);\n        const bindings = this.renderable.bindings;\n        const { length } = bindings;\n        let binding;\n        for (let i = 0; i < length; ++i) {\n            binding = bindings[i];\n            if (binding.target === this && binding.targetProperty === 'items') {\n                this.forOf = binding.sourceExpression;\n                break;\n            }\n        }\n        this.local = this.forOf.declaration.evaluate(flags, this.$controller.scope, null);\n        this.normalizeToArray(flags);\n        this.processViewsKeyed(void 0, flags);\n        return this.task;\n    }\n    beforeAttach(flags) {\n        if (this.task.done) {\n            this.attachViews(void 0, flags);\n        }\n        else {\n            this.task = new ContinuationTask(this.task, this.attachViews, this, void 0, flags);\n        }\n    }\n    beforeDetach(flags) {\n        if (this.task.done) {\n            this.detachViewsByRange(0, this.views.length, flags);\n        }\n        else {\n            this.task = new ContinuationTask(this.task, this.detachViewsByRange, this, 0, this.views.length, flags);\n        }\n    }\n    beforeUnbind(flags) {\n        this.checkCollectionObserver(flags);\n        if (this.task.done) {\n            this.task = this.unbindAndRemoveViewsByRange(0, this.views.length, flags, false);\n        }\n        else {\n            this.task = new ContinuationTask(this.task, this.unbindAndRemoveViewsByRange, this, 0, this.views.length, flags, false);\n        }\n        return this.task;\n    }\n    // called by SetterObserver\n    itemsChanged(flags) {\n        flags |= this.$controller.flags;\n        this.checkCollectionObserver(flags);\n        flags |= 16 /* updateTargetInstance */;\n        this.normalizeToArray(flags);\n        this.processViewsKeyed(void 0, flags);\n    }\n    // called by a CollectionObserver\n    handleCollectionChange(indexMap, flags) {\n        flags |= this.$controller.flags;\n        flags |= (960 /* fromFlush */ | 16 /* updateTargetInstance */);\n        this.normalizeToArray(flags);\n        this.processViewsKeyed(indexMap, flags);\n    }\n    processViewsKeyed(indexMap, flags) {\n        const oldLength = this.views.length;\n        if (indexMap === void 0) {\n            if ((this.$controller.state & 5 /* isBoundOrBinding */) > 0) {\n                this.detachViewsByRange(0, oldLength, flags);\n                if (this.task.done) {\n                    this.task = this.unbindAndRemoveViewsByRange(0, oldLength, flags, false);\n                }\n                else {\n                    this.task = new ContinuationTask(this.task, this.unbindAndRemoveViewsByRange, this, 0, oldLength, flags, false);\n                }\n                if (this.task.done) {\n                    this.task = this.createAndBindAllViews(flags);\n                }\n                else {\n                    this.task = new ContinuationTask(this.task, this.createAndBindAllViews, this, flags);\n                }\n            }\n            if ((this.$controller.state & 40 /* isAttachedOrAttaching */) > 0) {\n                if (this.task.done) {\n                    this.attachViewsKeyed(flags);\n                }\n                else {\n                    this.task = new ContinuationTask(this.task, this.attachViewsKeyed, this, flags);\n                }\n            }\n        }\n        else {\n            applyMutationsToIndices(indexMap);\n            if ((this.$controller.state & 5 /* isBoundOrBinding */) > 0) {\n                // first detach+unbind+(remove from array) the deleted view indices\n                if (indexMap.deletedItems.length > 0) {\n                    indexMap.deletedItems.sort(compareNumber);\n                    if (this.task.done) {\n                        this.detachViewsByKey(indexMap, flags);\n                    }\n                    else {\n                        this.task = new ContinuationTask(this.task, this.detachViewsByKey, this, indexMap, flags);\n                    }\n                    if (this.task.done) {\n                        this.task = this.unbindAndRemoveViewsByKey(indexMap, flags);\n                    }\n                    else {\n                        this.task = new ContinuationTask(this.task, this.unbindAndRemoveViewsByKey, this, indexMap, flags);\n                    }\n                }\n                // then insert new views at the \"added\" indices to bring the views array in aligment with indexMap size\n                if (this.task.done) {\n                    this.task = this.createAndBindNewViewsByKey(indexMap, flags);\n                }\n                else {\n                    this.task = new ContinuationTask(this.task, this.createAndBindNewViewsByKey, this, indexMap, flags);\n                }\n            }\n            if ((this.$controller.state & 40 /* isAttachedOrAttaching */) > 0) {\n                if (this.task.done) {\n                    this.sortViewsByKey(oldLength, indexMap, flags);\n                }\n                else {\n                    this.task = new ContinuationTask(this.task, this.sortViewsByKey, this, oldLength, indexMap, flags);\n                }\n            }\n        }\n    }\n    // todo: subscribe to collection from inner expression\n    checkCollectionObserver(flags) {\n        const oldObserver = this.observer;\n        if ((flags & 8192 /* fromUnbind */)) {\n            if (oldObserver !== void 0) {\n                oldObserver.unsubscribeFromCollection(this);\n            }\n        }\n        else if ((this.$controller.state & 5 /* isBoundOrBinding */) > 0) {\n            const newObserver = this.observer = getCollectionObserver(flags, this.$controller.lifecycle, this.items);\n            if (oldObserver !== newObserver && oldObserver) {\n                oldObserver.unsubscribeFromCollection(this);\n            }\n            if (newObserver) {\n                newObserver.subscribeToCollection(this);\n            }\n        }\n    }\n    normalizeToArray(flags) {\n        const items = this.items;\n        if (items instanceof Array) {\n            this.normalizedItems = items;\n            return;\n        }\n        const forOf = this.forOf;\n        if (forOf === void 0) {\n            return;\n        }\n        const normalizedItems = [];\n        this.forOf.iterate(flags, items, (arr, index, item) => {\n            normalizedItems[index] = item;\n        });\n        this.normalizedItems = normalizedItems;\n    }\n    detachViewsByRange(iStart, iEnd, flags) {\n        const views = this.views;\n        this.$controller.lifecycle.afterDetach.begin();\n        let view;\n        for (let i = iStart; i < iEnd; ++i) {\n            view = views[i];\n            view.release(flags);\n            view.detach(flags);\n        }\n        this.$controller.lifecycle.afterDetach.end(flags);\n    }\n    unbindAndRemoveViewsByRange(iStart, iEnd, flags, adjustLength) {\n        const views = this.views;\n        let tasks = void 0;\n        let task;\n        this.$controller.lifecycle.afterUnbind.begin();\n        let view;\n        for (let i = iStart; i < iEnd; ++i) {\n            view = views[i];\n            task = view.unbind(flags);\n            view.parent = void 0;\n            if (!task.done) {\n                if (tasks === undefined) {\n                    tasks = [];\n                }\n                tasks.push(task);\n            }\n        }\n        if (adjustLength) {\n            this.views.length = iStart;\n        }\n        if (tasks === undefined) {\n            this.$controller.lifecycle.afterUnbind.end(flags);\n            return LifecycleTask.done;\n        }\n        return new AggregateContinuationTask(tasks, this.$controller.lifecycle.afterUnbind.end, this.$controller.lifecycle.afterUnbind, flags);\n    }\n    detachViewsByKey(indexMap, flags) {\n        const views = this.views;\n        this.$controller.lifecycle.afterDetach.begin();\n        const deleted = indexMap.deletedItems;\n        const deletedLen = deleted.length;\n        let view;\n        for (let i = 0; i < deletedLen; ++i) {\n            view = views[deleted[i]];\n            view.release(flags);\n            view.detach(flags);\n        }\n        this.$controller.lifecycle.afterDetach.end(flags);\n    }\n    unbindAndRemoveViewsByKey(indexMap, flags) {\n        const views = this.views;\n        let tasks = void 0;\n        let task;\n        this.$controller.lifecycle.afterUnbind.begin();\n        const deleted = indexMap.deletedItems;\n        const deletedLen = deleted.length;\n        let view;\n        let i = 0;\n        for (; i < deletedLen; ++i) {\n            view = views[deleted[i]];\n            task = view.unbind(flags);\n            view.parent = void 0;\n            if (!task.done) {\n                if (tasks === undefined) {\n                    tasks = [];\n                }\n                tasks.push(task);\n            }\n        }\n        i = 0;\n        let j = 0;\n        for (; i < deletedLen; ++i) {\n            j = deleted[i] - i;\n            this.views.splice(j, 1);\n        }\n        if (tasks === undefined) {\n            this.$controller.lifecycle.afterUnbind.end(flags);\n            return LifecycleTask.done;\n        }\n        return new AggregateContinuationTask(tasks, this.$controller.lifecycle.afterUnbind.end, this.$controller.lifecycle.afterUnbind, flags);\n    }\n    createAndBindAllViews(flags) {\n        let tasks = void 0;\n        let task;\n        let view;\n        let viewScope;\n        const $controller = this.$controller;\n        const lifecycle = $controller.lifecycle;\n        const parentScope = $controller.scope;\n        lifecycle.afterBind.begin();\n        const part = $controller.part;\n        const factory = this.factory;\n        const local = this.local;\n        const items = this.items;\n        const newLen = this.forOf.count(flags, items);\n        const views = this.views = Array(newLen);\n        this.forOf.iterate(flags, items, (arr, i, item) => {\n            view = views[i] = factory.create(flags);\n            view.parent = $controller;\n            viewScope = Scope.fromParent(flags, parentScope, BindingContext.create(flags, local, item));\n            setContextualProperties(viewScope.overrideContext, i, newLen);\n            task = view.bind(flags, viewScope, part);\n            if (!task.done) {\n                if (tasks === undefined) {\n                    tasks = [];\n                }\n                tasks.push(task);\n            }\n        });\n        if (tasks === undefined) {\n            lifecycle.afterBind.end(flags);\n            return LifecycleTask.done;\n        }\n        return new AggregateContinuationTask(tasks, lifecycle.afterBind.end, lifecycle.afterBind, flags);\n    }\n    createAndBindNewViewsByKey(indexMap, flags) {\n        let tasks = void 0;\n        let task;\n        let view;\n        let viewScope;\n        const factory = this.factory;\n        const views = this.views;\n        const local = this.local;\n        const normalizedItems = this.normalizedItems;\n        const $controller = this.$controller;\n        const lifecycle = $controller.lifecycle;\n        const parentScope = $controller.scope;\n        lifecycle.afterBind.begin();\n        const part = $controller.part;\n        const mapLen = indexMap.length;\n        for (let i = 0; i < mapLen; ++i) {\n            if (indexMap[i] === -2) {\n                view = factory.create(flags);\n                // TODO: test with map/set/undefined/null, make sure we can use strong typing here as well, etc\n                view.parent = $controller;\n                viewScope = Scope.fromParent(flags, parentScope, BindingContext.create(flags, local, normalizedItems[i]));\n                setContextualProperties(viewScope.overrideContext, i, mapLen);\n                // update all the rest oc\n                task = view.bind(flags, viewScope, part);\n                views.splice(i, 0, view);\n                if (!task.done) {\n                    if (tasks === undefined) {\n                        tasks = [];\n                    }\n                    tasks.push(task);\n                }\n            }\n        }\n        if (views.length !== mapLen) {\n            // TODO: create error code and use reporter with more informative message\n            throw new Error(`viewsLen=${views.length}, mapLen=${mapLen}`);\n        }\n        if (tasks === undefined) {\n            lifecycle.afterBind.end(flags);\n            return LifecycleTask.done;\n        }\n        return new AggregateContinuationTask(tasks, lifecycle.afterBind.end, lifecycle.afterBind, flags);\n    }\n    attachViews(indexMap, flags) {\n        let view;\n        const views = this.views;\n        const location = this.location;\n        const lifecycle = this.$controller.lifecycle;\n        lifecycle.afterAttach.begin();\n        if (indexMap === void 0) {\n            for (let i = 0, ii = views.length; i < ii; ++i) {\n                view = views[i];\n                view.hold(location, 1 /* insertBefore */);\n                view.nodes.unlink();\n                view.attach(flags);\n            }\n        }\n        else {\n            for (let i = 0, ii = views.length; i < ii; ++i) {\n                if (indexMap[i] !== i) {\n                    view = views[i];\n                    view.hold(location, 1 /* insertBefore */);\n                    view.nodes.unlink();\n                    view.attach(flags);\n                }\n            }\n        }\n        lifecycle.afterAttach.end(flags);\n    }\n    attachViewsKeyed(flags) {\n        let view;\n        const { views, location } = this;\n        this.$controller.lifecycle.afterAttach.begin();\n        for (let i = 0, ii = views.length; i < ii; ++i) {\n            view = views[i];\n            view.hold(location, 1 /* insertBefore */);\n            view.nodes.unlink();\n            view.attach(flags);\n        }\n        this.$controller.lifecycle.afterAttach.end(flags);\n    }\n    sortViewsByKey(oldLength, indexMap, flags) {\n        // TODO: integrate with tasks\n        const location = this.location;\n        const views = this.views;\n        const newLen = indexMap.length;\n        synchronizeIndices(views, indexMap);\n        // this algorithm retrieves the indices of the longest increasing subsequence of items in the repeater\n        // the items on those indices are not moved; this minimizes the number of DOM operations that need to be performed\n        const seq = longestIncreasingSubsequence(indexMap);\n        const seqLen = seq.length;\n        this.$controller.lifecycle.afterAttach.begin();\n        flags |= 33554432 /* reorderNodes */;\n        let next;\n        let j = seqLen - 1;\n        let i = newLen - 1;\n        let view;\n        for (; i >= 0; --i) {\n            view = views[i];\n            if (indexMap[i] === -2) {\n                setContextualProperties(view.scope.overrideContext, i, newLen);\n                view.hold(location, 1 /* insertBefore */);\n                view.attach(flags);\n            }\n            else if (j < 0 || seqLen === 1 || i !== seq[j]) {\n                setContextualProperties(view.scope.overrideContext, i, newLen);\n                view.attach(flags);\n            }\n            else {\n                if (oldLength !== newLen) {\n                    setContextualProperties(view.scope.overrideContext, i, newLen);\n                }\n                --j;\n            }\n            next = views[i + 1];\n            if (next !== void 0) {\n                view.nodes.link(next.nodes);\n            }\n            else {\n                view.nodes.link(location);\n            }\n        }\n        this.$controller.lifecycle.afterAttach.end(flags);\n    }\n};\n__decorate([\n    bindable,\n    __metadata(\"design:type\", Object)\n], Repeat.prototype, \"items\", void 0);\nRepeat = __decorate([\n    templateController('repeat'),\n    __param(0, IRenderLocation),\n    __param(1, IController),\n    __param(2, IViewFactory),\n    __metadata(\"design:paramtypes\", [Object, Object, Object])\n], Repeat);\nexport { Repeat };\nlet maxLen = 16;\nlet prevIndices = new Int32Array(maxLen);\nlet tailIndices = new Int32Array(maxLen);\n// Based on inferno's lis_algorithm @ https://github.com/infernojs/inferno/blob/master/packages/inferno/src/DOM/patching.ts#L732\n// with some tweaks to make it just a bit faster + account for IndexMap (and some names changes for readability)\n/** @internal */\nexport function longestIncreasingSubsequence(indexMap) {\n    const len = indexMap.length;\n    if (len > maxLen) {\n        maxLen = len;\n        prevIndices = new Int32Array(len);\n        tailIndices = new Int32Array(len);\n    }\n    let cursor = 0;\n    let cur = 0;\n    let prev = 0;\n    let i = 0;\n    let j = 0;\n    let low = 0;\n    let high = 0;\n    let mid = 0;\n    for (; i < len; i++) {\n        cur = indexMap[i];\n        if (cur !== -2) {\n            j = prevIndices[cursor];\n            prev = indexMap[j];\n            if (prev !== -2 && prev < cur) {\n                tailIndices[i] = j;\n                prevIndices[++cursor] = i;\n                continue;\n            }\n            low = 0;\n            high = cursor;\n            while (low < high) {\n                mid = (low + high) >> 1;\n                prev = indexMap[prevIndices[mid]];\n                if (prev !== -2 && prev < cur) {\n                    low = mid + 1;\n                }\n                else {\n                    high = mid;\n                }\n            }\n            prev = indexMap[prevIndices[low]];\n            if (cur < prev || prev === -2) {\n                if (low > 0) {\n                    tailIndices[i] = prevIndices[low - 1];\n                }\n                prevIndices[low] = i;\n            }\n        }\n    }\n    i = ++cursor;\n    const result = new Int32Array(i);\n    cur = prevIndices[cursor - 1];\n    while (cursor-- > 0) {\n        result[cursor] = cur;\n        cur = tailIndices[cur];\n    }\n    while (i-- > 0)\n        prevIndices[i] = 0;\n    return result;\n}\nfunction setContextualProperties(oc, index, length) {\n    const isFirst = index === 0;\n    const isLast = index === length - 1;\n    const isEven = index % 2 === 0;\n    oc.$index = index;\n    oc.$first = isFirst;\n    oc.$last = isLast;\n    oc.$middle = !isFirst && !isLast;\n    oc.$even = isEven;\n    oc.$odd = !isEven;\n    oc.$length = length;\n}\n//# sourceMappingURL=repeat.js.map","import { __decorate, __metadata, __param } from \"tslib\";\nimport { nextId } from '@aurelia/kernel';\nimport { IRenderLocation } from '../../dom';\nimport { IViewFactory } from '../../lifecycle';\nimport { templateController } from '../custom-attribute';\nlet Replaceable = class Replaceable {\n    constructor(factory, location) {\n        this.factory = factory;\n        this.location = location;\n        this.id = nextId('au$component');\n        this.view = this.factory.create();\n        this.view.hold(location, 1 /* insertBefore */);\n    }\n    beforeBind(flags) {\n        this.view.parent = this.$controller;\n        return this.view.bind(flags | 67108864 /* allowParentScopeTraversal */, this.$controller.scope, this.factory.name);\n    }\n    beforeAttach(flags) {\n        this.view.attach(flags);\n    }\n    beforeDetach(flags) {\n        this.view.detach(flags);\n    }\n    beforeUnbind(flags) {\n        const task = this.view.unbind(flags);\n        this.view.parent = void 0;\n        return task;\n    }\n};\nReplaceable = __decorate([\n    templateController('replaceable'),\n    __param(0, IViewFactory),\n    __param(1, IRenderLocation),\n    __metadata(\"design:paramtypes\", [Object, Object])\n], Replaceable);\nexport { Replaceable };\n//# sourceMappingURL=replaceable.js.map","import { __decorate, __metadata, __param } from \"tslib\";\nimport { nextId } from '@aurelia/kernel';\nimport { IRenderLocation } from '../../dom';\nimport { IViewFactory } from '../../lifecycle';\nimport { templateController } from '../custom-attribute';\nimport { bindable } from '../../templating/bindable';\nimport { Scope } from '../../observation/binding-context';\nlet With = class With {\n    constructor(factory, location) {\n        this.factory = factory;\n        this.location = location;\n        this.id = nextId('au$component');\n        this.id = nextId('au$component');\n        this.view = this.factory.create();\n        this.view.hold(location, 1 /* insertBefore */);\n    }\n    valueChanged(newValue, oldValue, flags) {\n        if ((this.$controller.state & 5 /* isBoundOrBinding */) > 0) {\n            this.bindChild(4096 /* fromBind */);\n        }\n    }\n    beforeBind(flags) {\n        this.view.parent = this.$controller;\n        this.bindChild(flags);\n    }\n    beforeAttach(flags) {\n        this.view.attach(flags);\n    }\n    beforeDetach(flags) {\n        this.view.detach(flags);\n    }\n    beforeUnbind(flags) {\n        this.view.unbind(flags);\n        this.view.parent = void 0;\n    }\n    bindChild(flags) {\n        const scope = Scope.fromParent(flags, this.$controller.scope, this.value === void 0 ? {} : this.value);\n        this.view.bind(flags, scope, this.$controller.part);\n    }\n};\n__decorate([\n    bindable,\n    __metadata(\"design:type\", Object)\n], With.prototype, \"value\", void 0);\nWith = __decorate([\n    templateController('with'),\n    __param(0, IViewFactory),\n    __param(1, IRenderLocation),\n    __metadata(\"design:paramtypes\", [Object, Object])\n], With);\nexport { With };\n//# sourceMappingURL=with.js.map","var ChildrenObserver_1;\nimport { __decorate, __metadata } from \"tslib\";\n/* eslint-disable @typescript-eslint/no-use-before-define */\nimport { Protocol, Metadata, firstDefined, getPrototypeChain, Reporter } from '@aurelia/kernel';\nimport { CustomElement } from '../resources/custom-element';\nimport { subscriberCollection } from '../observation/subscriber-collection';\nexport function children(configOrTarget, prop) {\n    let config;\n    function decorator($target, $prop) {\n        if (arguments.length > 1) {\n            // Non invocation:\n            // - @children\n            // Invocation with or w/o opts:\n            // - @children()\n            // - @children({...opts})\n            config.property = $prop;\n        }\n        Metadata.define(Children.name, ChildrenDefinition.create($prop, config), $target.constructor, $prop);\n        Protocol.annotation.appendTo($target.constructor, Children.keyFrom($prop));\n    }\n    if (arguments.length > 1) {\n        // Non invocation:\n        // - @children\n        config = {};\n        decorator(configOrTarget, prop);\n        return;\n    }\n    else if (typeof configOrTarget === 'string') {\n        // ClassDecorator\n        // - @children('bar')\n        // Direct call:\n        // - @children('bar')(Foo)\n        config = {};\n        return decorator;\n    }\n    // Invocation with or w/o opts:\n    // - @children()\n    // - @children({...opts})\n    config = configOrTarget === void 0 ? {} : configOrTarget;\n    return decorator;\n}\nfunction isChildrenObserverAnnotation(key) {\n    return key.startsWith(Children.name);\n}\nexport const Children = {\n    name: Protocol.annotation.keyFor('children-observer'),\n    keyFrom(name) {\n        return `${Children.name}:${name}`;\n    },\n    from(...childrenObserverLists) {\n        const childrenObservers = {};\n        // eslint-disable-next-line @typescript-eslint/unbound-method\n        const isArray = Array.isArray;\n        function addName(name) {\n            childrenObservers[name] = ChildrenDefinition.create(name);\n        }\n        function addDescription(name, def) {\n            childrenObservers[name] = ChildrenDefinition.create(name, def);\n        }\n        function addList(maybeList) {\n            if (isArray(maybeList)) {\n                maybeList.forEach(addName);\n            }\n            else if (maybeList instanceof ChildrenDefinition) {\n                childrenObservers[maybeList.property] = maybeList;\n            }\n            else if (maybeList !== void 0) {\n                Object.keys(maybeList).forEach(name => addDescription(name, maybeList));\n            }\n        }\n        childrenObserverLists.forEach(addList);\n        return childrenObservers;\n    },\n    getAll(Type) {\n        const propStart = Children.name.length + 1;\n        const defs = [];\n        const prototypeChain = getPrototypeChain(Type);\n        let iProto = prototypeChain.length;\n        let iDefs = 0;\n        let keys;\n        let keysLen;\n        let Class;\n        while (--iProto >= 0) {\n            Class = prototypeChain[iProto];\n            keys = Protocol.annotation.getKeys(Class).filter(isChildrenObserverAnnotation);\n            keysLen = keys.length;\n            for (let i = 0; i < keysLen; ++i) {\n                defs[iDefs++] = Metadata.getOwn(Children.name, Class, keys[i].slice(propStart));\n            }\n        }\n        return defs;\n    },\n};\nexport class ChildrenDefinition {\n    constructor(callback, property, options, query, filter, map) {\n        this.callback = callback;\n        this.property = property;\n        this.options = options;\n        this.query = query;\n        this.filter = filter;\n        this.map = map;\n    }\n    static create(prop, def = {}) {\n        return new ChildrenDefinition(firstDefined(def.callback, `${prop}Changed`), firstDefined(def.property, prop), def.options, def.query, def.filter, def.map);\n    }\n}\n/** @internal */\nlet ChildrenObserver = ChildrenObserver_1 = class ChildrenObserver {\n    constructor(controller, obj, flags, propertyKey, cbName, query = defaultChildQuery, filter = defaultChildFilter, map = defaultChildMap, options) {\n        this.controller = controller;\n        this.obj = obj;\n        this.propertyKey = propertyKey;\n        this.query = query;\n        this.filter = filter;\n        this.map = map;\n        this.options = options;\n        this.observing = false;\n        this.children = (void 0);\n        this.callback = obj[cbName];\n        this.persistentFlags = flags & 2080374799 /* persistentBindingFlags */;\n        this.createGetterSetter();\n    }\n    getValue() {\n        this.tryStartObserving();\n        return this.children;\n    }\n    setValue(newValue) { }\n    subscribe(subscriber) {\n        this.tryStartObserving();\n        this.addSubscriber(subscriber);\n    }\n    tryStartObserving() {\n        if (!this.observing) {\n            this.observing = true;\n            const projector = this.controller.projector;\n            this.children = filterChildren(projector, this.query, this.filter, this.map);\n            projector.subscribeToChildrenChange(() => { this.onChildrenChanged(); }, this.options);\n        }\n    }\n    onChildrenChanged() {\n        this.children = filterChildren(this.controller.projector, this.query, this.filter, this.map);\n        if (this.callback !== void 0) {\n            this.callback.call(this.obj);\n        }\n        this.callSubscribers(this.children, undefined, this.persistentFlags | 16 /* updateTargetInstance */);\n    }\n    createGetterSetter() {\n        if (!Reflect.defineProperty(this.obj, this.propertyKey, {\n            enumerable: true,\n            configurable: true,\n            get: () => this.getValue(),\n            set: () => { return; },\n        })) {\n            Reporter.write(1, this.propertyKey, this.obj);\n        }\n    }\n};\nChildrenObserver = ChildrenObserver_1 = __decorate([\n    subscriberCollection(),\n    __metadata(\"design:paramtypes\", [Object, Object, Number, String, String, Object, Object, Object, Object])\n], ChildrenObserver);\nexport { ChildrenObserver };\nfunction defaultChildQuery(projector) {\n    return projector.children;\n}\nfunction defaultChildFilter(node, controller, viewModel) {\n    return !!viewModel;\n}\nfunction defaultChildMap(node, controller, viewModel) {\n    return viewModel;\n}\n/** @internal */\nexport function filterChildren(projector, query, filter, map) {\n    const nodes = query(projector);\n    const children = [];\n    for (let i = 0, ii = nodes.length; i < ii; ++i) {\n        const node = nodes[i];\n        const controller = CustomElement.for(node);\n        const viewModel = controller ? controller.viewModel : null;\n        if (filter(node, controller, viewModel)) {\n            children.push(map(node, controller, viewModel));\n        }\n    }\n    return children;\n}\n//# sourceMappingURL=children.js.map","import { DI, Registration, Protocol, Metadata, mergeArrays, fromDefinitionOrDefault, pascalCase, fromAnnotationOrTypeOrDefault, fromAnnotationOrDefinitionOrTypeOrDefault, } from '@aurelia/kernel';\nimport { registerAliases, HooksDefinition, } from '../definitions';\nimport { DOM } from '../dom';\nimport { Bindable } from '../templating/bindable';\nimport { Children } from '../templating/children';\nexport function customElement(nameOrDef) {\n    return function (target) {\n        return CustomElement.define(nameOrDef, target);\n    };\n}\nexport function useShadowDOM(targetOrOptions) {\n    if (targetOrOptions === void 0) {\n        return function ($target) {\n            CustomElement.annotate($target, 'shadowOptions', { mode: 'open' });\n        };\n    }\n    if (typeof targetOrOptions !== 'function') {\n        return function ($target) {\n            CustomElement.annotate($target, 'shadowOptions', targetOrOptions);\n        };\n    }\n    CustomElement.annotate(targetOrOptions, 'shadowOptions', { mode: 'open' });\n}\nexport function containerless(target) {\n    if (target === void 0) {\n        return function ($target) {\n            CustomElement.annotate($target, 'containerless', true);\n        };\n    }\n    CustomElement.annotate(target, 'containerless', true);\n}\nexport function strict(target) {\n    if (target === void 0) {\n        return function ($target) {\n            CustomElement.annotate($target, 'isStrictBinding', true);\n        };\n    }\n    CustomElement.annotate(target, 'isStrictBinding', true);\n}\nconst definitionLookup = new WeakMap();\nexport class CustomElementDefinition {\n    constructor(Type, name, aliases, key, cache, template, instructions, dependencies, injectable, needsCompile, surrogates, bindables, childrenObservers, containerless, isStrictBinding, shadowOptions, hasSlots, strategy, hooks, scopeParts) {\n        this.Type = Type;\n        this.name = name;\n        this.aliases = aliases;\n        this.key = key;\n        this.cache = cache;\n        this.template = template;\n        this.instructions = instructions;\n        this.dependencies = dependencies;\n        this.injectable = injectable;\n        this.needsCompile = needsCompile;\n        this.surrogates = surrogates;\n        this.bindables = bindables;\n        this.childrenObservers = childrenObservers;\n        this.containerless = containerless;\n        this.isStrictBinding = isStrictBinding;\n        this.shadowOptions = shadowOptions;\n        this.hasSlots = hasSlots;\n        this.strategy = strategy;\n        this.hooks = hooks;\n        this.scopeParts = scopeParts;\n    }\n    static create(nameOrDef, Type = null) {\n        if (Type === null) {\n            const def = nameOrDef;\n            if (typeof def === 'string') {\n                throw new Error(`Cannot create a custom element definition with only a name and no type: ${nameOrDef}`);\n            }\n            // eslint-disable-next-line @typescript-eslint/unbound-method\n            const name = fromDefinitionOrDefault('name', def, CustomElement.generateName);\n            if (typeof def.Type === 'function') {\n                // This needs to be a clone (it will usually be the compiler calling this signature)\n                // TODO: we need to make sure it's documented that passing in the type via the definition (while passing in null\n                // as the \"Type\" parameter) effectively skips type analysis, so it should only be used this way for cloning purposes.\n                Type = def.Type;\n            }\n            else {\n                Type = CustomElement.generateType(pascalCase(name));\n            }\n            return new CustomElementDefinition(Type, name, mergeArrays(def.aliases), fromDefinitionOrDefault('key', def, () => CustomElement.keyFrom(name)), fromDefinitionOrDefault('cache', def, () => 0), fromDefinitionOrDefault('template', def, () => null), mergeArrays(def.instructions), mergeArrays(def.dependencies), fromDefinitionOrDefault('injectable', def, () => null), fromDefinitionOrDefault('needsCompile', def, () => true), mergeArrays(def.surrogates), Bindable.from(def.bindables), Children.from(def.childrenObservers), fromDefinitionOrDefault('containerless', def, () => false), fromDefinitionOrDefault('isStrictBinding', def, () => false), fromDefinitionOrDefault('shadowOptions', def, () => null), fromDefinitionOrDefault('hasSlots', def, () => false), fromDefinitionOrDefault('strategy', def, () => 1 /* getterSetter */), fromDefinitionOrDefault('hooks', def, () => HooksDefinition.none), mergeArrays(def.scopeParts));\n        }\n        // If a type is passed in, we ignore the Type property on the definition if it exists.\n        // TODO: document this behavior\n        if (typeof nameOrDef === 'string') {\n            return new CustomElementDefinition(Type, nameOrDef, mergeArrays(CustomElement.getAnnotation(Type, 'aliases'), Type.aliases), CustomElement.keyFrom(nameOrDef), fromAnnotationOrTypeOrDefault('cache', Type, () => 0), fromAnnotationOrTypeOrDefault('template', Type, () => null), mergeArrays(CustomElement.getAnnotation(Type, 'instructions'), Type.instructions), mergeArrays(CustomElement.getAnnotation(Type, 'dependencies'), Type.dependencies), fromAnnotationOrTypeOrDefault('injectable', Type, () => null), fromAnnotationOrTypeOrDefault('needsCompile', Type, () => true), mergeArrays(CustomElement.getAnnotation(Type, 'surrogates'), Type.surrogates), Bindable.from(...Bindable.getAll(Type), CustomElement.getAnnotation(Type, 'bindables'), Type.bindables), Children.from(...Children.getAll(Type), CustomElement.getAnnotation(Type, 'childrenObservers'), Type.childrenObservers), fromAnnotationOrTypeOrDefault('containerless', Type, () => false), fromAnnotationOrTypeOrDefault('isStrictBinding', Type, () => false), fromAnnotationOrTypeOrDefault('shadowOptions', Type, () => null), fromAnnotationOrTypeOrDefault('hasSlots', Type, () => false), fromAnnotationOrTypeOrDefault('strategy', Type, () => 1 /* getterSetter */), \n            // eslint-disable-next-line @typescript-eslint/no-unnecessary-type-assertion\n            fromAnnotationOrTypeOrDefault('hooks', Type, () => new HooksDefinition(Type.prototype)), mergeArrays(CustomElement.getAnnotation(Type, 'scopeParts'), Type.scopeParts));\n        }\n        // This is the typical default behavior, e.g. from regular CustomElement.define invocations or from @customElement deco\n        // The ViewValueConverter also uses this signature and passes in a definition where everything except for the 'hooks'\n        // property needs to be copied. So we have that exception for 'hooks', but we may need to revisit that default behavior\n        // if this turns out to be too opinionated.\n        // eslint-disable-next-line @typescript-eslint/unbound-method\n        const name = fromDefinitionOrDefault('name', nameOrDef, CustomElement.generateName);\n        return new CustomElementDefinition(Type, name, mergeArrays(CustomElement.getAnnotation(Type, 'aliases'), nameOrDef.aliases, Type.aliases), CustomElement.keyFrom(name), fromAnnotationOrDefinitionOrTypeOrDefault('cache', nameOrDef, Type, () => 0), fromAnnotationOrDefinitionOrTypeOrDefault('template', nameOrDef, Type, () => null), mergeArrays(CustomElement.getAnnotation(Type, 'instructions'), nameOrDef.instructions, Type.instructions), mergeArrays(CustomElement.getAnnotation(Type, 'dependencies'), nameOrDef.dependencies, Type.dependencies), fromAnnotationOrDefinitionOrTypeOrDefault('injectable', nameOrDef, Type, () => null), fromAnnotationOrDefinitionOrTypeOrDefault('needsCompile', nameOrDef, Type, () => true), mergeArrays(CustomElement.getAnnotation(Type, 'surrogates'), nameOrDef.surrogates, Type.surrogates), Bindable.from(...Bindable.getAll(Type), CustomElement.getAnnotation(Type, 'bindables'), Type.bindables, nameOrDef.bindables), Children.from(...Children.getAll(Type), CustomElement.getAnnotation(Type, 'childrenObservers'), Type.childrenObservers, nameOrDef.childrenObservers), fromAnnotationOrDefinitionOrTypeOrDefault('containerless', nameOrDef, Type, () => false), fromAnnotationOrDefinitionOrTypeOrDefault('isStrictBinding', nameOrDef, Type, () => false), fromAnnotationOrDefinitionOrTypeOrDefault('shadowOptions', nameOrDef, Type, () => null), fromAnnotationOrDefinitionOrTypeOrDefault('hasSlots', nameOrDef, Type, () => false), fromAnnotationOrDefinitionOrTypeOrDefault('strategy', nameOrDef, Type, () => 1 /* getterSetter */), \n        // eslint-disable-next-line @typescript-eslint/no-unnecessary-type-assertion\n        fromAnnotationOrTypeOrDefault('hooks', Type, () => new HooksDefinition(Type.prototype)), mergeArrays(CustomElement.getAnnotation(Type, 'scopeParts'), nameOrDef.scopeParts, Type.scopeParts));\n    }\n    static getOrCreate(partialDefinition) {\n        if (partialDefinition instanceof CustomElementDefinition) {\n            return partialDefinition;\n        }\n        if (definitionLookup.has(partialDefinition)) {\n            return definitionLookup.get(partialDefinition);\n        }\n        const definition = CustomElementDefinition.create(partialDefinition);\n        definitionLookup.set(partialDefinition, definition);\n        // Make sure the full definition can be retrieved from dynamically created classes as well\n        Metadata.define(CustomElement.name, definition, definition.Type);\n        return definition;\n    }\n    register(container) {\n        const { Type, key, aliases } = this;\n        Registration.transient(key, Type).register(container);\n        Registration.alias(key, Type).register(container);\n        registerAliases(aliases, CustomElement, key, container);\n    }\n}\nexport const CustomElement = {\n    name: Protocol.resource.keyFor('custom-element'),\n    keyFrom(name) {\n        return `${CustomElement.name}:${name}`;\n    },\n    isType(value) {\n        return typeof value === 'function' && Metadata.hasOwn(CustomElement.name, value);\n    },\n    for(node, nameOrSearchParents, searchParents) {\n        if (nameOrSearchParents === void 0) {\n            return Metadata.getOwn(CustomElement.name, node);\n        }\n        if (typeof nameOrSearchParents === 'string') {\n            if (searchParents !== true) {\n                const controller = Metadata.getOwn(CustomElement.name, node);\n                if (controller === void 0) {\n                    return (void 0);\n                }\n                if (controller.is(nameOrSearchParents)) {\n                    return controller;\n                }\n                return (void 0);\n            }\n            let cur = node;\n            while (cur !== null) {\n                const controller = Metadata.getOwn(CustomElement.name, cur);\n                if (controller !== void 0 && controller.is(nameOrSearchParents)) {\n                    return controller;\n                }\n                cur = DOM.getEffectiveParentNode(cur);\n            }\n            return (void 0);\n        }\n        let cur = node;\n        while (cur !== null) {\n            const controller = Metadata.getOwn(CustomElement.name, cur);\n            if (controller !== void 0) {\n                return controller;\n            }\n            cur = DOM.getEffectiveParentNode(cur);\n        }\n        return (void 0);\n    },\n    define(nameOrDef, Type) {\n        const definition = CustomElementDefinition.create(nameOrDef, Type);\n        Metadata.define(CustomElement.name, definition, definition.Type);\n        Metadata.define(CustomElement.name, definition, definition);\n        Protocol.resource.appendTo(definition.Type, CustomElement.name);\n        return definition.Type;\n    },\n    getDefinition(Type) {\n        const def = Metadata.getOwn(CustomElement.name, Type);\n        if (def === void 0) {\n            throw new Error(`No definition found for type ${Type.name}`);\n        }\n        return def;\n    },\n    annotate(Type, prop, value) {\n        Metadata.define(Protocol.annotation.keyFor(prop), value, Type);\n    },\n    getAnnotation(Type, prop) {\n        return Metadata.getOwn(Protocol.annotation.keyFor(prop), Type);\n    },\n    generateName: (function () {\n        let id = 0;\n        return function () {\n            return `unnamed-${++id}`;\n        };\n    })(),\n    createInjectable() {\n        const $injectable = function (target, property, index) {\n            const annotationParamtypes = DI.getOrCreateAnnotationParamTypes(target);\n            annotationParamtypes[index] = $injectable;\n            return target;\n        };\n        $injectable.register = function (container) {\n            // eslint-disable-next-line @typescript-eslint/consistent-type-assertions\n            return {\n                resolve(container, requestor) {\n                    if (requestor.has($injectable, true)) {\n                        return requestor.get($injectable);\n                    }\n                    else {\n                        return null;\n                    }\n                },\n            };\n        };\n        return $injectable;\n    },\n    generateType: (function () {\n        const nameDescriptor = {\n            value: '',\n            writable: false,\n            enumerable: false,\n            configurable: true,\n        };\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        const defaultProto = {};\n        return function (name, proto = defaultProto) {\n            // Anonymous class ensures that minification cannot cause unintended side-effects, and keeps the class\n            // looking similarly from the outside (when inspected via debugger, etc).\n            const Type = class {\n            };\n            // Define the name property so that Type.name can be used by end users / plugin authors if they really need to,\n            // even when minified.\n            nameDescriptor.value = name;\n            Reflect.defineProperty(Type, 'name', nameDescriptor);\n            // Assign anything from the prototype that was passed in\n            if (proto !== defaultProto) {\n                Object.assign(Type.prototype, proto);\n            }\n            return Type;\n        };\n    })(),\n};\nexport const IProjectorLocator = DI.createInterface('IProjectorLocator').noDefault();\n//# sourceMappingURL=custom-element.js.map","import { __decorate, __metadata, __param } from \"tslib\";\nimport { DI } from '@aurelia/kernel';\nimport { valueConverter } from '../value-converter';\nconst SCRIPT_REGEX = /<script\\b[^<]*(?:(?!<\\/script>)<[^<]*)*<\\/script>/gi;\nexport const ISanitizer = DI.createInterface('ISanitizer').withDefault(x => x.singleton(class {\n    sanitize(input) {\n        return input.replace(SCRIPT_REGEX, '');\n    }\n}));\n/**\n * Simple html sanitization converter to preserve whitelisted elements and attributes on a bound property containing html.\n */\nlet SanitizeValueConverter = class SanitizeValueConverter {\n    constructor(sanitizer) {\n        this.sanitizer = sanitizer;\n    }\n    /**\n     * Process the provided markup that flows to the view.\n     *\n     * @param untrustedMarkup - The untrusted markup to be sanitized.\n     */\n    toView(untrustedMarkup) {\n        if (untrustedMarkup == null) {\n            return null;\n        }\n        return this.sanitizer.sanitize(untrustedMarkup);\n    }\n};\nSanitizeValueConverter = __decorate([\n    valueConverter('sanitize'),\n    __param(0, ISanitizer),\n    __metadata(\"design:paramtypes\", [Object])\n], SanitizeValueConverter);\nexport { SanitizeValueConverter };\n//# sourceMappingURL=sanitize.js.map","import { __decorate, __metadata, __param } from \"tslib\";\nimport { all, Registration, Metadata, DI, } from '@aurelia/kernel';\nimport { CallBinding } from './binding/call-binding';\nimport { IExpressionParser } from './binding/expression-parser';\nimport { InterpolationBinding, MultiInterpolationBinding } from './binding/interpolation-binding';\nimport { LetBinding } from './binding/let-binding';\nimport { PropertyBinding } from './binding/property-binding';\nimport { RefBinding } from './binding/ref-binding';\nimport { mergeParts } from './definitions';\nimport { BindingMode } from './flags';\nimport { ILifecycle, } from './lifecycle';\nimport { IObserverLocator } from './observation/observer-locator';\nimport { CustomAttribute, } from './resources/custom-attribute';\nimport { CustomElement, } from './resources/custom-element';\nimport { Controller } from './templating/controller';\nimport { getRenderContext } from './templating/render-context';\nimport { BindingBehaviorExpression } from './binding/ast';\nimport { BindingBehaviorFactory } from './resources/binding-behavior';\nexport const ITemplateCompiler = DI.createInterface('ITemplateCompiler').noDefault();\nexport const IInstructionRenderer = DI.createInterface('IInstructionRenderer').noDefault();\nexport const IRenderer = DI.createInterface('IRenderer').noDefault();\nexport function instructionRenderer(instructionType) {\n    return function decorator(target) {\n        // wrap the constructor to set the instructionType to the instance (for better performance than when set on the prototype)\n        const decoratedTarget = function (...args) {\n            const instance = new target(...args);\n            instance.instructionType = instructionType;\n            return instance;\n        };\n        // make sure we register the decorated constructor with DI\n        decoratedTarget.register = function register(container) {\n            Registration.singleton(IInstructionRenderer, decoratedTarget).register(container);\n        };\n        // copy over any metadata such as annotations (set by preceding decorators) as well as static properties set by the user\n        // also copy the name, to be less confusing to users (so they can still use constructor.name for whatever reason)\n        // the length (number of ctor arguments) is copied for the same reason\n        const metadataKeys = Metadata.getOwnKeys(target);\n        for (const key of metadataKeys) {\n            Metadata.define(key, Metadata.getOwn(key, target), decoratedTarget);\n        }\n        const ownProperties = Object.getOwnPropertyDescriptors(target);\n        Object.keys(ownProperties).filter(prop => prop !== 'prototype').forEach(prop => {\n            Reflect.defineProperty(decoratedTarget, prop, ownProperties[prop]);\n        });\n        return decoratedTarget;\n    };\n}\n/* @internal */\nlet Renderer = class Renderer {\n    constructor(instructionRenderers) {\n        const record = this.instructionRenderers = {};\n        instructionRenderers.forEach(item => {\n            // Binding the functions to the renderer instances and calling the functions directly,\n            // prevents the `render` call sites from going megamorphic.\n            // Consumes slightly more memory but significantly less CPU.\n            record[item.instructionType] = item.render.bind(item);\n        });\n    }\n    static register(container) {\n        return Registration.singleton(IRenderer, this).register(container);\n    }\n    render(flags, context, controller, targets, definition, host, parts) {\n        const targetInstructions = definition.instructions;\n        if (targets.length !== targetInstructions.length) {\n            throw new Error(`The compiled template is not aligned with the render instructions. There are ${targets.length} targets and ${targetInstructions.length} instructions.`);\n        }\n        for (let i = 0, ii = targets.length; i < ii; ++i) {\n            this.renderInstructions(\n            /* flags        */ flags, \n            /* context      */ context, \n            /* instructions */ targetInstructions[i], \n            /* controller   */ controller, \n            /* target       */ targets[i], \n            /* parts        */ parts);\n        }\n        if (host !== void 0 && host !== null) {\n            this.renderInstructions(\n            /* flags        */ flags, \n            /* context      */ context, \n            /* instructions */ definition.surrogates, \n            /* controller   */ controller, \n            /* target       */ host, \n            /* parts        */ parts);\n        }\n    }\n    renderInstructions(flags, context, instructions, controller, target, parts) {\n        const instructionRenderers = this.instructionRenderers;\n        let current;\n        for (let i = 0, ii = instructions.length; i < ii; ++i) {\n            current = instructions[i];\n            instructionRenderers[current.type](flags, context, controller, target, current, parts);\n        }\n    }\n};\nRenderer = __decorate([\n    __param(0, all(IInstructionRenderer)),\n    __metadata(\"design:paramtypes\", [Array])\n], Renderer);\nexport { Renderer };\nexport function ensureExpression(parser, srcOrExpr, bindingType) {\n    if (typeof srcOrExpr === 'string') {\n        return parser.parse(srcOrExpr, bindingType);\n    }\n    return srcOrExpr;\n}\nexport function getTarget(potentialTarget) {\n    if (potentialTarget.bindingContext !== void 0) {\n        return potentialTarget.bindingContext;\n    }\n    return potentialTarget;\n}\nexport function getRefTarget(refHost, refTargetName) {\n    if (refTargetName === 'element') {\n        return refHost;\n    }\n    switch (refTargetName) {\n        case 'controller':\n            // this means it supports returning undefined\n            return CustomElement.for(refHost);\n        case 'view':\n            // todo: returns node sequences for fun?\n            throw new Error('Not supported API');\n        case 'view-model':\n            // this means it supports returning undefined\n            return CustomElement.for(refHost).viewModel;\n        default: {\n            const caController = CustomAttribute.for(refHost, refTargetName);\n            if (caController !== void 0) {\n                return caController.viewModel;\n            }\n            const ceController = CustomElement.for(refHost, refTargetName);\n            if (ceController === void 0) {\n                throw new Error(`Attempted to reference \"${refTargetName}\", but it was not found amongst the target's API.`);\n            }\n            return ceController.viewModel;\n        }\n    }\n}\nlet SetPropertyRenderer = \n/** @internal */\nclass SetPropertyRenderer {\n    render(flags, context, controller, target, instruction) {\n        const obj = getTarget(target);\n        if (obj.$observers !== void 0 && obj.$observers[instruction.to] !== void 0) {\n            obj.$observers[instruction.to].setValue(instruction.value, 4096 /* fromBind */);\n        }\n        else {\n            obj[instruction.to] = instruction.value;\n        }\n    }\n};\nSetPropertyRenderer = __decorate([\n    instructionRenderer(\"re\" /* setProperty */)\n    /** @internal */\n], SetPropertyRenderer);\nexport { SetPropertyRenderer };\nlet CustomElementRenderer = \n/** @internal */\nclass CustomElementRenderer {\n    render(flags, context, controller, target, instruction, parts) {\n        parts = mergeParts(parts, instruction.parts);\n        const factory = context.getComponentFactory(\n        /* parentController */ controller, \n        /* host             */ target, \n        /* instruction      */ instruction, \n        /* viewFactory      */ void 0, \n        /* location         */ target);\n        const key = CustomElement.keyFrom(instruction.res);\n        const component = factory.createComponent(key);\n        const lifecycle = context.get(ILifecycle);\n        const childController = Controller.forCustomElement(\n        /* viewModel       */ component, \n        /* lifecycle       */ lifecycle, \n        /* host            */ target, \n        /* parentContainer */ context, \n        /* parts           */ parts, \n        /* flags           */ flags);\n        flags = childController.flags;\n        Metadata.define(key, childController, target);\n        context.renderInstructions(\n        /* flags        */ flags, \n        /* instructions */ instruction.instructions, \n        /* controller   */ controller, \n        /* target       */ childController, \n        /* parts        */ parts);\n        controller.addController(childController);\n        factory.dispose();\n    }\n};\nCustomElementRenderer = __decorate([\n    instructionRenderer(\"ra\" /* hydrateElement */)\n    /** @internal */\n], CustomElementRenderer);\nexport { CustomElementRenderer };\nlet CustomAttributeRenderer = \n/** @internal */\nclass CustomAttributeRenderer {\n    render(flags, context, controller, target, instruction, parts) {\n        const factory = context.getComponentFactory(\n        /* parentController */ controller, \n        /* host             */ target, \n        /* instruction      */ instruction, \n        /* viewFactory      */ void 0, \n        /* location         */ void 0);\n        const key = CustomAttribute.keyFrom(instruction.res);\n        const component = factory.createComponent(key);\n        const lifecycle = context.get(ILifecycle);\n        const childController = Controller.forCustomAttribute(\n        /* viewModel */ component, \n        /* lifecycle */ lifecycle, \n        /* flags     */ flags);\n        Metadata.define(key, childController, target);\n        context.renderInstructions(\n        /* flags        */ flags, \n        /* instructions */ instruction.instructions, \n        /* controller   */ controller, \n        /* target       */ childController, \n        /* parts        */ parts);\n        controller.addController(childController);\n        factory.dispose();\n    }\n};\nCustomAttributeRenderer = __decorate([\n    instructionRenderer(\"rb\" /* hydrateAttribute */)\n    /** @internal */\n], CustomAttributeRenderer);\nexport { CustomAttributeRenderer };\nlet TemplateControllerRenderer = \n/** @internal */\nclass TemplateControllerRenderer {\n    render(flags, parentContext, controller, target, instruction, parts) {\n        parts = mergeParts(parts, instruction.parts);\n        const viewFactory = getRenderContext(instruction.def, parentContext, parts).getViewFactory();\n        const renderLocation = parentContext.dom.convertToRenderLocation(target);\n        const componentFactory = parentContext.getComponentFactory(\n        /* parentController */ controller, \n        /* host             */ target, \n        /* instruction      */ instruction, \n        /* viewFactory      */ viewFactory, \n        /* location         */ renderLocation);\n        const key = CustomAttribute.keyFrom(instruction.res);\n        const component = componentFactory.createComponent(key);\n        const lifecycle = parentContext.get(ILifecycle);\n        const childController = Controller.forCustomAttribute(\n        /* viewModel */ component, \n        /* lifecycle */ lifecycle, \n        /* flags     */ flags);\n        Metadata.define(key, childController, renderLocation);\n        if (instruction.link) {\n            const controllers = controller.controllers;\n            component.link(controllers[controllers.length - 1]);\n        }\n        parentContext.renderInstructions(\n        /* flags        */ flags, \n        /* instructions */ instruction.instructions, \n        /* controller   */ controller, \n        /* target       */ childController, \n        /* parts        */ parts);\n        controller.addController(childController);\n        componentFactory.dispose();\n    }\n};\nTemplateControllerRenderer = __decorate([\n    instructionRenderer(\"rc\" /* hydrateTemplateController */)\n    /** @internal */\n], TemplateControllerRenderer);\nexport { TemplateControllerRenderer };\nlet LetElementRenderer = \n/** @internal */\nclass LetElementRenderer {\n    constructor(parser, observerLocator) {\n        this.parser = parser;\n        this.observerLocator = observerLocator;\n    }\n    render(flags, context, controller, target, instruction) {\n        context.dom.remove(target);\n        const childInstructions = instruction.instructions;\n        const toBindingContext = instruction.toBindingContext;\n        let childInstruction;\n        let expr;\n        let binding;\n        for (let i = 0, ii = childInstructions.length; i < ii; ++i) {\n            childInstruction = childInstructions[i];\n            expr = ensureExpression(this.parser, childInstruction.from, 48 /* IsPropertyCommand */);\n            binding = applyBindingBehavior(new LetBinding(expr, childInstruction.to, this.observerLocator, context, toBindingContext), expr, context);\n            controller.addBinding(binding);\n        }\n    }\n};\nLetElementRenderer = __decorate([\n    instructionRenderer(\"rd\" /* hydrateLetElement */)\n    /** @internal */\n    ,\n    __param(0, IExpressionParser),\n    __param(1, IObserverLocator),\n    __metadata(\"design:paramtypes\", [Object, Object])\n], LetElementRenderer);\nexport { LetElementRenderer };\nlet CallBindingRenderer = \n/** @internal */\nclass CallBindingRenderer {\n    constructor(parser, observerLocator) {\n        this.parser = parser;\n        this.observerLocator = observerLocator;\n    }\n    render(flags, context, controller, target, instruction) {\n        const expr = ensureExpression(this.parser, instruction.from, 153 /* CallCommand */);\n        const binding = applyBindingBehavior(new CallBinding(expr, getTarget(target), instruction.to, this.observerLocator, context), expr, context);\n        controller.addBinding(binding);\n    }\n};\nCallBindingRenderer = __decorate([\n    instructionRenderer(\"rh\" /* callBinding */)\n    /** @internal */\n    ,\n    __param(0, IExpressionParser),\n    __param(1, IObserverLocator),\n    __metadata(\"design:paramtypes\", [Object, Object])\n], CallBindingRenderer);\nexport { CallBindingRenderer };\nlet RefBindingRenderer = \n/** @internal */\nclass RefBindingRenderer {\n    constructor(parser) {\n        this.parser = parser;\n    }\n    render(flags, context, controller, target, instruction) {\n        const expr = ensureExpression(this.parser, instruction.from, 5376 /* IsRef */);\n        const binding = applyBindingBehavior(new RefBinding(expr, getRefTarget(target, instruction.to), context), expr, context);\n        controller.addBinding(binding);\n    }\n};\nRefBindingRenderer = __decorate([\n    instructionRenderer(\"rj\" /* refBinding */)\n    /** @internal */\n    ,\n    __param(0, IExpressionParser),\n    __metadata(\"design:paramtypes\", [Object])\n], RefBindingRenderer);\nexport { RefBindingRenderer };\nlet InterpolationBindingRenderer = \n/** @internal */\nclass InterpolationBindingRenderer {\n    constructor(parser, observerLocator) {\n        this.parser = parser;\n        this.observerLocator = observerLocator;\n    }\n    render(flags, context, controller, target, instruction) {\n        let binding;\n        const expr = ensureExpression(this.parser, instruction.from, 2048 /* Interpolation */);\n        if (expr.isMulti) {\n            binding = applyBindingBehavior(new MultiInterpolationBinding(this.observerLocator, expr, getTarget(target), instruction.to, BindingMode.toView, context), expr, context);\n        }\n        else {\n            binding = applyBindingBehavior(new InterpolationBinding(expr.firstExpression, expr, getTarget(target), instruction.to, BindingMode.toView, this.observerLocator, context, true), expr, context);\n        }\n        controller.addBinding(binding);\n    }\n};\nInterpolationBindingRenderer = __decorate([\n    instructionRenderer(\"rf\" /* interpolation */)\n    /** @internal */\n    ,\n    __param(0, IExpressionParser),\n    __param(1, IObserverLocator),\n    __metadata(\"design:paramtypes\", [Object, Object])\n], InterpolationBindingRenderer);\nexport { InterpolationBindingRenderer };\nlet PropertyBindingRenderer = \n/** @internal */\nclass PropertyBindingRenderer {\n    constructor(parser, observerLocator) {\n        this.parser = parser;\n        this.observerLocator = observerLocator;\n    }\n    render(flags, context, controller, target, instruction) {\n        const expr = ensureExpression(this.parser, instruction.from, 48 /* IsPropertyCommand */ | instruction.mode);\n        const binding = applyBindingBehavior(new PropertyBinding(expr, getTarget(target), instruction.to, instruction.mode, this.observerLocator, context), expr, context);\n        controller.addBinding(binding);\n    }\n};\nPropertyBindingRenderer = __decorate([\n    instructionRenderer(\"rg\" /* propertyBinding */)\n    /** @internal */\n    ,\n    __param(0, IExpressionParser),\n    __param(1, IObserverLocator),\n    __metadata(\"design:paramtypes\", [Object, Object])\n], PropertyBindingRenderer);\nexport { PropertyBindingRenderer };\nlet IteratorBindingRenderer = \n/** @internal */\nclass IteratorBindingRenderer {\n    constructor(parser, observerLocator) {\n        this.parser = parser;\n        this.observerLocator = observerLocator;\n    }\n    render(flags, context, controller, target, instruction) {\n        const expr = ensureExpression(this.parser, instruction.from, 539 /* ForCommand */);\n        const binding = applyBindingBehavior(new PropertyBinding(expr, getTarget(target), instruction.to, BindingMode.toView, this.observerLocator, context), expr, context);\n        controller.addBinding(binding);\n    }\n};\nIteratorBindingRenderer = __decorate([\n    instructionRenderer(\"rk\" /* iteratorBinding */)\n    /** @internal */\n    ,\n    __param(0, IExpressionParser),\n    __param(1, IObserverLocator),\n    __metadata(\"design:paramtypes\", [Object, Object])\n], IteratorBindingRenderer);\nexport { IteratorBindingRenderer };\nlet behaviorExpressionIndex = 0;\nconst behaviorExpressions = [];\nexport function applyBindingBehavior(binding, expression, locator) {\n    while (expression instanceof BindingBehaviorExpression) {\n        behaviorExpressions[behaviorExpressionIndex++] = expression;\n        expression = expression.expression;\n    }\n    while (behaviorExpressionIndex > 0) {\n        const behaviorExpression = behaviorExpressions[--behaviorExpressionIndex];\n        const behaviorOrFactory = locator.get(behaviorExpression.behaviorKey);\n        if (behaviorOrFactory instanceof BindingBehaviorFactory) {\n            binding = behaviorOrFactory.construct(binding, behaviorExpression);\n        }\n    }\n    behaviorExpressions.length = 0;\n    return binding;\n}\n//# sourceMappingURL=renderer.js.map","import { CustomElementDefinition } from '../resources/custom-element';\nimport { ITargetedInstruction, mergeParts } from '../definitions';\nimport { InstanceProvider, Reporter } from '@aurelia/kernel';\nimport { IController, IViewFactory, ILifecycle } from '../lifecycle';\nimport { IDOM, IRenderLocation } from '../dom';\nimport { IRenderer, ITemplateCompiler } from '../renderer';\nimport { ViewFactory } from './view';\nconst definitionContainerLookup = new WeakMap();\nconst definitionContainerPartsLookup = new WeakMap();\nconst fragmentCache = new WeakMap();\nexport function isRenderContext(value) {\n    return value instanceof RenderContext;\n}\nexport function getRenderContext(partialDefinition, parentContainer, parts) {\n    const definition = CustomElementDefinition.getOrCreate(partialDefinition);\n    if (isRenderContext(parentContainer)) {\n        parts = mergeParts(parentContainer.parts, parts);\n    }\n    // injectable completely prevents caching, ensuring that each instance gets a new render context\n    if (definition.injectable !== null) {\n        return new RenderContext(definition, parentContainer, parts);\n    }\n    if (parts === void 0) {\n        let containerLookup = definitionContainerLookup.get(definition);\n        if (containerLookup === void 0) {\n            definitionContainerLookup.set(definition, containerLookup = new WeakMap());\n        }\n        let context = containerLookup.get(parentContainer);\n        if (context === void 0) {\n            containerLookup.set(parentContainer, context = new RenderContext(definition, parentContainer, parts));\n        }\n        return context;\n    }\n    let containerPartsLookup = definitionContainerPartsLookup.get(definition);\n    if (containerPartsLookup === void 0) {\n        definitionContainerPartsLookup.set(definition, containerPartsLookup = new WeakMap());\n    }\n    let partsLookup = containerPartsLookup.get(parentContainer);\n    if (partsLookup === void 0) {\n        containerPartsLookup.set(parentContainer, partsLookup = new WeakMap());\n    }\n    let context = partsLookup.get(parts);\n    if (context === void 0) {\n        partsLookup.set(parts, context = new RenderContext(definition, parentContainer, parts));\n    }\n    return context;\n}\nexport class RenderContext {\n    constructor(definition, parentContainer, parts) {\n        this.definition = definition;\n        this.parentContainer = parentContainer;\n        this.parts = parts;\n        this.viewModelProvider = void 0;\n        this.fragment = null;\n        this.factory = void 0;\n        this.isCompiled = false;\n        this.compiledDefinition = (void 0);\n        const container = this.container = parentContainer.createChild();\n        this.renderer = container.get(IRenderer);\n        container.registerResolver(IViewFactory, this.factoryProvider = new ViewFactoryProvider());\n        container.registerResolver(IController, this.parentControllerProvider = new InstanceProvider());\n        container.registerResolver(ITargetedInstruction, this.instructionProvider = new InstanceProvider());\n        container.registerResolver(IRenderLocation, this.renderLocationProvider = new InstanceProvider());\n        (this.dom = container.get(IDOM)).registerElementResolver(container, this.elementProvider = new InstanceProvider());\n        container.register(...definition.dependencies);\n    }\n    // #region IServiceLocator api\n    has(key, searchAncestors) {\n        return this.container.has(key, searchAncestors);\n    }\n    get(key) {\n        return this.container.get(key);\n    }\n    getAll(key) {\n        return this.container.getAll(key);\n    }\n    // #endregion\n    // #region IContainer api\n    register(...params) {\n        return this.container.register(...params);\n    }\n    registerResolver(key, resolver) {\n        return this.container.registerResolver(key, resolver);\n    }\n    registerTransformer(key, transformer) {\n        return this.container.registerTransformer(key, transformer);\n    }\n    getResolver(key, autoRegister) {\n        return this.container.getResolver(key, autoRegister);\n    }\n    getFactory(key) {\n        return this.container.getFactory(key);\n    }\n    createChild() {\n        return this.container.createChild();\n    }\n    // #endregion\n    // #region IRenderContext api\n    compile() {\n        let compiledDefinition;\n        if (this.isCompiled) {\n            return this;\n        }\n        this.isCompiled = true;\n        const definition = this.definition;\n        if (definition.needsCompile) {\n            const container = this.container;\n            const compiler = container.get(ITemplateCompiler);\n            compiledDefinition = this.compiledDefinition = compiler.compile(definition, container);\n        }\n        else {\n            compiledDefinition = this.compiledDefinition = definition;\n        }\n        // Support Recursive Components by adding self to own context\n        compiledDefinition.register(this);\n        if (fragmentCache.has(compiledDefinition)) {\n            this.fragment = fragmentCache.get(compiledDefinition);\n        }\n        else {\n            const template = compiledDefinition.template;\n            if (template === null) {\n                fragmentCache.set(compiledDefinition, null);\n            }\n            else {\n                fragmentCache.set(compiledDefinition, this.fragment = this.dom.createDocumentFragment(template));\n            }\n        }\n        return this;\n    }\n    getViewFactory(name) {\n        let factory = this.factory;\n        if (factory === void 0) {\n            if (name === void 0) {\n                name = this.definition.name;\n            }\n            const lifecycle = this.parentContainer.get(ILifecycle);\n            factory = this.factory = new ViewFactory(name, this, lifecycle, this.parts);\n        }\n        return factory;\n    }\n    beginChildComponentOperation(instance) {\n        const definition = this.definition;\n        if (definition.injectable !== null) {\n            if (this.viewModelProvider === void 0) {\n                this.container.registerResolver(definition.injectable, this.viewModelProvider = new InstanceProvider());\n            }\n            this.viewModelProvider.prepare(instance);\n        }\n        return this;\n    }\n    // #endregion\n    // #region ICompiledRenderContext api\n    createNodes() {\n        return this.dom.createNodeSequence(this.fragment);\n    }\n    // TODO: split up into 2 methods? getComponentFactory + getSyntheticFactory or something\n    getComponentFactory(parentController, host, instruction, viewFactory, location) {\n        if (parentController !== void 0) {\n            this.parentControllerProvider.prepare(parentController);\n        }\n        if (host !== void 0) {\n            // TODO: fix provider input type, Key is probably not a good constraint\n            this.elementProvider.prepare(host);\n        }\n        if (instruction !== void 0) {\n            this.instructionProvider.prepare(instruction);\n        }\n        if (location !== void 0) {\n            this.renderLocationProvider.prepare(location);\n        }\n        if (viewFactory !== void 0) {\n            this.factoryProvider.prepare(viewFactory);\n        }\n        return this;\n    }\n    // #endregion\n    // #region IComponentFactory api\n    createComponent(resourceKey) {\n        return this.container.get(resourceKey);\n    }\n    render(flags, controller, targets, templateDefinition, host, parts) {\n        this.renderer.render(flags, this, controller, targets, templateDefinition, host, parts);\n    }\n    renderInstructions(flags, instructions, controller, target, parts) {\n        this.renderer.renderInstructions(flags, this, instructions, controller, target, parts);\n    }\n    dispose() {\n        this.factoryProvider.dispose();\n        this.parentControllerProvider.dispose();\n        this.instructionProvider.dispose();\n        this.elementProvider.dispose();\n        this.renderLocationProvider.dispose();\n    }\n}\n/** @internal */\nexport class ViewFactoryProvider {\n    constructor() {\n        this.factory = null;\n    }\n    prepare(factory) {\n        this.factory = factory;\n    }\n    resolve(handler, requestor) {\n        const factory = this.factory;\n        if (factory === null) { // unmet precondition: call prepare\n            throw Reporter.error(50); // TODO: organize error codes\n        }\n        if (typeof factory.name !== 'string' || factory.name.length === 0) { // unmet invariant: factory must have a name\n            throw Reporter.error(51); // TODO: organize error codes\n        }\n        return factory.resolve(requestor);\n    }\n    dispose() {\n        this.factory = null;\n    }\n}\n//# sourceMappingURL=render-context.js.map","import { mergeDistinct, nextId, } from '@aurelia/kernel';\nimport { HooksDefinition, } from '../definitions';\nimport { AggregateContinuationTask, ContinuationTask, hasAsyncWork, LifecycleTask, } from '../lifecycle-task';\nimport { Scope, } from '../observation/binding-context';\nimport { ProxyObserver, } from '../observation/proxy-observer';\nimport { BindableObserver, } from '../observation/bindable-observer';\nimport { IProjectorLocator, CustomElementDefinition, CustomElement, } from '../resources/custom-element';\nimport { CustomAttribute, } from '../resources/custom-attribute';\nimport { getRenderContext, } from './render-context';\nimport { ChildrenObserver } from './children';\nconst controllerLookup = new WeakMap();\nexport class Controller {\n    constructor(vmKind, flags, lifecycle, hooks, \n    /**\n     * The viewFactory. Only present for synthetic views.\n     */\n    viewFactory, \n    /**\n     * The backing viewModel. This is never a proxy. Only present for custom attributes and elements.\n     */\n    viewModel, \n    /**\n     * The binding context. This may be a proxy. If it is not, then it is the same instance as the viewModel. Only present for custom attributes and elements.\n     */\n    bindingContext, \n    /**\n     * The physical host dom node. Only present for custom elements.\n     */\n    host) {\n        this.vmKind = vmKind;\n        this.flags = flags;\n        this.lifecycle = lifecycle;\n        this.hooks = hooks;\n        this.viewFactory = viewFactory;\n        this.viewModel = viewModel;\n        this.bindingContext = bindingContext;\n        this.host = host;\n        this.id = nextId('au$component');\n        this.nextBound = void 0;\n        this.nextUnbound = void 0;\n        this.prevBound = void 0;\n        this.prevUnbound = void 0;\n        this.nextAttached = void 0;\n        this.nextDetached = void 0;\n        this.prevAttached = void 0;\n        this.prevDetached = void 0;\n        this.nextMount = void 0;\n        this.nextUnmount = void 0;\n        this.prevMount = void 0;\n        this.prevUnmount = void 0;\n        this.parent = void 0;\n        this.bindings = void 0;\n        this.controllers = void 0;\n        this.state = 0 /* none */;\n        this.scopeParts = void 0;\n        this.isStrictBinding = false;\n        this.scope = void 0;\n        this.part = void 0;\n        this.projector = void 0;\n        this.nodes = void 0;\n        this.context = void 0;\n        this.location = void 0;\n        this.mountStrategy = 1 /* insertBefore */;\n    }\n    static getCached(viewModel) {\n        return controllerLookup.get(viewModel);\n    }\n    static getCachedOrThrow(viewModel) {\n        const controller = Controller.getCached(viewModel);\n        if (controller === void 0) {\n            throw new Error(`There is no cached controller for the provided ViewModel: ${String(viewModel)}`);\n        }\n        return controller;\n    }\n    static forCustomElement(viewModel, lifecycle, host, parentContainer, parts, flags = 0 /* none */) {\n        if (controllerLookup.has(viewModel)) {\n            return controllerLookup.get(viewModel);\n        }\n        const definition = CustomElement.getDefinition(viewModel.constructor);\n        flags |= definition.strategy;\n        const controller = new Controller(0 /* customElement */, \n        /* flags          */ flags, \n        /* lifecycle      */ lifecycle, \n        /* hooks          */ definition.hooks, \n        /* viewFactory    */ void 0, \n        /* viewModel      */ viewModel, \n        /* bindingContext */ getBindingContext(flags, viewModel), \n        /* host           */ host);\n        controllerLookup.set(viewModel, controller);\n        controller.hydrateCustomElement(definition, parentContainer, parts);\n        return controller;\n    }\n    static forCustomAttribute(viewModel, lifecycle, flags = 0 /* none */) {\n        if (controllerLookup.has(viewModel)) {\n            return controllerLookup.get(viewModel);\n        }\n        const definition = CustomAttribute.getDefinition(viewModel.constructor);\n        flags |= definition.strategy;\n        const controller = new Controller(1 /* customAttribute */, \n        /* flags          */ flags, \n        /* lifecycle      */ lifecycle, \n        /* hooks          */ definition.hooks, \n        /* viewFactory    */ void 0, \n        /* viewModel      */ viewModel, \n        /* bindingContext */ getBindingContext(flags, viewModel), \n        /* host           */ void 0);\n        controllerLookup.set(viewModel, controller);\n        controller.hydrateCustomAttribute(definition);\n        return controller;\n    }\n    static forSyntheticView(viewFactory, lifecycle, context, flags = 0 /* none */) {\n        const controller = new Controller(2 /* synthetic */, \n        /* flags          */ flags, \n        /* lifecycle      */ lifecycle, \n        /* hooks          */ HooksDefinition.none, \n        /* viewFactory    */ viewFactory, \n        /* viewModel      */ void 0, \n        /* bindingContext */ void 0, \n        /* host           */ void 0);\n        controller.hydrateSynthetic(context, viewFactory.parts);\n        return controller;\n    }\n    hydrateCustomElement(definition, parentContainer, parts) {\n        const flags = this.flags |= definition.strategy;\n        const instance = this.viewModel;\n        createObservers(this.lifecycle, definition, flags, instance);\n        createChildrenObservers(this, definition, flags, instance);\n        this.scope = Scope.create(flags, this.bindingContext, null);\n        const hooks = this.hooks;\n        if (hooks.hasCreate) {\n            const result = instance.create(\n            /* controller      */ this, \n            /* parentContainer */ parentContainer, \n            /* definition      */ definition, \n            /* parts           */ parts);\n            if (result !== void 0 && result !== definition) {\n                definition = CustomElementDefinition.getOrCreate(result);\n            }\n        }\n        const context = this.context = getRenderContext(definition, parentContainer, parts);\n        // Support Recursive Components by adding self to own context\n        definition.register(context);\n        if (definition.injectable !== null) {\n            // If the element is registered as injectable, support injecting the instance into children\n            context.beginChildComponentOperation(instance);\n        }\n        if (hooks.hasBeforeCompile) {\n            instance.beforeCompile(this);\n        }\n        const compiledContext = context.compile();\n        const compiledDefinition = compiledContext.compiledDefinition;\n        this.scopeParts = compiledDefinition.scopeParts;\n        this.isStrictBinding = compiledDefinition.isStrictBinding;\n        const projectorLocator = parentContainer.get(IProjectorLocator);\n        this.projector = projectorLocator.getElementProjector(context.dom, this, this.host, compiledDefinition);\n        instance.$controller = this;\n        const nodes = this.nodes = compiledContext.createNodes();\n        if (hooks.hasAfterCompile) {\n            instance.afterCompile(this);\n        }\n        const targets = nodes.findTargets();\n        compiledContext.render(\n        /* flags      */ this.flags, \n        /* controller */ this, \n        /* targets    */ targets, \n        /* definition */ compiledDefinition, \n        /* host       */ this.host, \n        /* parts      */ parts);\n        if (hooks.hasAfterCompileChildren) {\n            instance.afterCompileChildren(this);\n        }\n    }\n    hydrateCustomAttribute(definition) {\n        const flags = this.flags | definition.strategy;\n        const instance = this.viewModel;\n        createObservers(this.lifecycle, definition, flags, instance);\n        instance.$controller = this;\n    }\n    hydrateSynthetic(context, parts) {\n        this.context = context;\n        const compiledContext = context.compile();\n        const compiledDefinition = compiledContext.compiledDefinition;\n        this.scopeParts = compiledDefinition.scopeParts;\n        this.isStrictBinding = compiledDefinition.isStrictBinding;\n        const nodes = this.nodes = compiledContext.createNodes();\n        const targets = nodes.findTargets();\n        compiledContext.render(\n        /* flags      */ this.flags, \n        /* controller */ this, \n        /* targets    */ targets, \n        /* definition */ compiledDefinition, \n        /* host       */ void 0, \n        /* parts      */ parts);\n    }\n    addBinding(binding) {\n        if (this.bindings === void 0) {\n            this.bindings = [binding];\n        }\n        else {\n            this.bindings[this.bindings.length] = binding;\n        }\n    }\n    addController(controller) {\n        if (this.controllers === void 0) {\n            this.controllers = [controller];\n        }\n        else {\n            this.controllers[this.controllers.length] = controller;\n        }\n    }\n    is(name) {\n        switch (this.vmKind) {\n            case 1 /* customAttribute */: {\n                const def = CustomAttribute.getDefinition(this.viewModel.constructor);\n                return def.name === name;\n            }\n            case 0 /* customElement */: {\n                const def = CustomElement.getDefinition(this.viewModel.constructor);\n                return def.name === name;\n            }\n            case 2 /* synthetic */:\n                return this.viewFactory.name === name;\n        }\n    }\n    lockScope(scope) {\n        this.scope = scope;\n        this.state |= 256 /* hasLockedScope */;\n    }\n    hold(location, mountStrategy) {\n        this.state = (this.state | 512 /* canBeCached */) ^ 512 /* canBeCached */;\n        this.location = location;\n        this.mountStrategy = mountStrategy;\n    }\n    release(flags) {\n        this.state |= 512 /* canBeCached */;\n        if ((this.state & 32 /* isAttached */) > 0) {\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            return this.viewFactory.canReturnToCache(this); // non-null is implied by the hook\n        }\n        return this.unmountSynthetic(flags);\n    }\n    bind(flags, scope, part) {\n        this.part = part;\n        // TODO: benchmark which of these techniques is fastest:\n        // - the current one (enum with switch)\n        // - set the name of the method in the constructor, e.g. this.bindMethod = 'bindCustomElement'\n        //    and then doing this[this.bindMethod](flags, scope) instead of switch (eliminates branching\n        //    but computed property access might be harmful to browser optimizations)\n        // - make bind() a property and set it to one of the 3 methods in the constructor,\n        //    e.g. this.bind = this.bindCustomElement (eliminates branching + reduces call stack depth by 1,\n        //    but might make the call site megamorphic)\n        flags |= 4096 /* fromBind */;\n        switch (this.vmKind) {\n            case 0 /* customElement */:\n                return this.bindCustomElement(flags, scope);\n            case 1 /* customAttribute */:\n                return this.bindCustomAttribute(flags, scope);\n            case 2 /* synthetic */:\n                return this.bindSynthetic(flags, scope);\n        }\n    }\n    unbind(flags) {\n        flags |= 8192 /* fromUnbind */;\n        switch (this.vmKind) {\n            case 0 /* customElement */:\n                return this.unbindCustomElement(flags);\n            case 1 /* customAttribute */:\n                return this.unbindCustomAttribute(flags);\n            case 2 /* synthetic */:\n                return this.unbindSynthetic(flags);\n        }\n    }\n    afterBind(flags) {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        this.bindingContext.afterBind(flags); // non-null is implied by the hook\n    }\n    afterUnbind(flags) {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        this.bindingContext.afterUnbind(flags); // non-null is implied by the hook\n    }\n    attach(flags) {\n        if ((this.state & 40 /* isAttachedOrAttaching */) > 0 && (flags & 33554432 /* reorderNodes */) === 0) {\n            return;\n        }\n        flags |= 16384 /* fromAttach */;\n        switch (this.vmKind) {\n            case 0 /* customElement */:\n                this.attachCustomElement(flags);\n                break;\n            case 1 /* customAttribute */:\n                this.attachCustomAttribute(flags);\n                break;\n            case 2 /* synthetic */:\n                this.attachSynthetic(flags);\n        }\n    }\n    detach(flags) {\n        if ((this.state & 40 /* isAttachedOrAttaching */) === 0) {\n            return;\n        }\n        flags |= 32768 /* fromDetach */;\n        switch (this.vmKind) {\n            case 0 /* customElement */:\n                this.detachCustomElement(flags);\n                break;\n            case 1 /* customAttribute */:\n                this.detachCustomAttribute(flags);\n                break;\n            case 2 /* synthetic */:\n                this.detachSynthetic(flags);\n        }\n    }\n    afterAttach(flags) {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        this.bindingContext.afterAttach(flags); // non-null is implied by the hook\n    }\n    afterDetach(flags) {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        this.bindingContext.afterDetach(flags); // non-null is implied by the hook\n    }\n    mount(flags) {\n        switch (this.vmKind) {\n            case 0 /* customElement */:\n                this.mountCustomElement(flags);\n                break;\n            case 2 /* synthetic */:\n                this.mountSynthetic(flags);\n        }\n    }\n    unmount(flags) {\n        switch (this.vmKind) {\n            case 0 /* customElement */:\n                this.unmountCustomElement(flags);\n                break;\n            case 2 /* synthetic */:\n                this.unmountSynthetic(flags);\n        }\n    }\n    cache(flags) {\n        switch (this.vmKind) {\n            case 0 /* customElement */:\n                this.cacheCustomElement(flags);\n                break;\n            case 1 /* customAttribute */:\n                this.cacheCustomAttribute(flags);\n                break;\n            case 2 /* synthetic */:\n                this.cacheSynthetic(flags);\n        }\n    }\n    getTargetAccessor(propertyName) {\n        const { bindings } = this;\n        if (bindings !== void 0) {\n            const binding = bindings.find(b => b.targetProperty === propertyName);\n            if (binding !== void 0) {\n                return binding.targetObserver;\n            }\n        }\n        return void 0;\n    }\n    // #region bind/unbind\n    bindCustomElement(flags, scope) {\n        const $scope = this.scope;\n        $scope.parentScope = scope === void 0 ? null : scope;\n        $scope.scopeParts = this.scopeParts;\n        if ((this.state & 4 /* isBound */) > 0) {\n            return LifecycleTask.done;\n        }\n        flags |= 4096 /* fromBind */;\n        this.state |= 1 /* isBinding */;\n        this.lifecycle.afterBind.begin();\n        if (this.hooks.hasBeforeBind) {\n            const ret = this.bindingContext.beforeBind(flags);\n            if (hasAsyncWork(ret)) {\n                // this.scope could be reassigned during beforeBind so reference that instead of $scope.\n                return new ContinuationTask(ret, this.bindBindings, this, flags, this.scope);\n            }\n        }\n        return this.bindBindings(flags, this.scope);\n    }\n    bindCustomAttribute(flags, scope) {\n        if ((this.state & 4 /* isBound */) > 0) {\n            if (this.scope === scope) {\n                return LifecycleTask.done;\n            }\n            flags |= 4096 /* fromBind */;\n            const task = this.unbind(flags);\n            if (!task.done) {\n                return new ContinuationTask(task, this.bind, this, flags, scope);\n            }\n        }\n        else {\n            flags |= 4096 /* fromBind */;\n        }\n        this.state |= 1 /* isBinding */;\n        this.scope = scope;\n        this.lifecycle.afterBind.begin();\n        if (this.hooks.hasBeforeBind) {\n            const ret = this.bindingContext.beforeBind(flags);\n            if (hasAsyncWork(ret)) {\n                return new ContinuationTask(ret, this.endBind, this, flags);\n            }\n        }\n        this.endBind(flags);\n        return LifecycleTask.done;\n    }\n    bindSynthetic(flags, scope) {\n        if (scope == void 0) {\n            throw new Error(`Scope is null or undefined`); // TODO: create error code\n        }\n        scope.scopeParts = mergeDistinct(scope.scopeParts, this.scopeParts, false);\n        if ((this.state & 4 /* isBound */) > 0) {\n            if (this.scope === scope || (this.state & 256 /* hasLockedScope */) > 0) {\n                return LifecycleTask.done;\n            }\n            flags |= 4096 /* fromBind */;\n            const task = this.unbind(flags);\n            if (!task.done) {\n                return new ContinuationTask(task, this.bind, this, flags, scope);\n            }\n        }\n        else {\n            flags |= 4096 /* fromBind */;\n        }\n        if ((this.state & 256 /* hasLockedScope */) === 0) {\n            this.scope = scope;\n        }\n        this.state |= 1 /* isBinding */;\n        this.lifecycle.afterBind.begin();\n        return this.bindBindings(flags, this.scope);\n    }\n    bindBindings(flags, scope) {\n        const { bindings } = this;\n        if (bindings !== void 0) {\n            const { length } = bindings;\n            if (this.isStrictBinding) {\n                flags |= 4 /* isStrictBindingStrategy */;\n            }\n            for (let i = 0; i < length; ++i) {\n                bindings[i].$bind(flags, scope, this.part);\n            }\n        }\n        return this.bindControllers(flags, this.scope);\n    }\n    bindControllers(flags, scope) {\n        let tasks = void 0;\n        let task;\n        const { controllers } = this;\n        if (controllers !== void 0) {\n            const { length } = controllers;\n            for (let i = 0; i < length; ++i) {\n                controllers[i].parent = this;\n                task = controllers[i].bind(flags, scope, this.part);\n                if (!task.done) {\n                    if (tasks === void 0) {\n                        tasks = [];\n                    }\n                    tasks.push(task);\n                }\n            }\n        }\n        if (tasks === void 0) {\n            this.endBind(flags);\n            return LifecycleTask.done;\n        }\n        return new AggregateContinuationTask(tasks, this.endBind, this, flags);\n    }\n    endBind(flags) {\n        if (this.hooks.hasAfterBind) {\n            this.lifecycle.afterBind.add(this);\n        }\n        this.state = this.state ^ 1 /* isBinding */ | 4 /* isBound */;\n        this.lifecycle.afterBind.end(flags);\n    }\n    unbindCustomElement(flags) {\n        if ((this.state & 4 /* isBound */) === 0) {\n            return LifecycleTask.done;\n        }\n        this.scope.parentScope = null;\n        this.state |= 2 /* isUnbinding */;\n        flags |= 8192 /* fromUnbind */;\n        this.lifecycle.afterUnbind.begin();\n        if (this.hooks.hasBeforeUnbind) {\n            const ret = this.bindingContext.beforeUnbind(flags);\n            if (hasAsyncWork(ret)) {\n                return new ContinuationTask(ret, this.unbindControllers, this, flags);\n            }\n        }\n        return this.unbindControllers(flags);\n    }\n    unbindCustomAttribute(flags) {\n        if ((this.state & 4 /* isBound */) === 0) {\n            return LifecycleTask.done;\n        }\n        this.state |= 2 /* isUnbinding */;\n        flags |= 8192 /* fromUnbind */;\n        this.lifecycle.afterUnbind.begin();\n        if (this.hooks.hasBeforeUnbind) {\n            const ret = this.bindingContext.beforeUnbind(flags);\n            if (hasAsyncWork(ret)) {\n                return new ContinuationTask(ret, this.endUnbind, this, flags);\n            }\n        }\n        this.endUnbind(flags);\n        return LifecycleTask.done;\n    }\n    unbindSynthetic(flags) {\n        if ((this.state & 4 /* isBound */) === 0) {\n            return LifecycleTask.done;\n        }\n        this.state |= 2 /* isUnbinding */;\n        flags |= 8192 /* fromUnbind */;\n        this.lifecycle.afterUnbind.begin();\n        return this.unbindControllers(flags);\n    }\n    unbindBindings(flags) {\n        const { bindings } = this;\n        if (bindings !== void 0) {\n            for (let i = bindings.length - 1; i >= 0; --i) {\n                bindings[i].$unbind(flags);\n            }\n        }\n        this.endUnbind(flags);\n    }\n    unbindControllers(flags) {\n        let tasks = void 0;\n        let task;\n        const { controllers } = this;\n        if (controllers !== void 0) {\n            for (let i = controllers.length - 1; i >= 0; --i) {\n                task = controllers[i].unbind(flags);\n                controllers[i].parent = void 0;\n                if (!task.done) {\n                    if (tasks === void 0) {\n                        tasks = [];\n                    }\n                    tasks.push(task);\n                }\n            }\n        }\n        if (tasks === void 0) {\n            this.unbindBindings(flags);\n            return LifecycleTask.done;\n        }\n        return new AggregateContinuationTask(tasks, this.unbindBindings, this, flags);\n    }\n    endUnbind(flags) {\n        switch (this.vmKind) {\n            case 1 /* customAttribute */:\n                this.scope = void 0;\n                break;\n            case 2 /* synthetic */:\n                if ((this.state & 256 /* hasLockedScope */) === 0) {\n                    this.scope = void 0;\n                }\n        }\n        if (this.hooks.hasAfterUnbind) {\n            this.lifecycle.afterUnbind.add(this);\n        }\n        this.state = (this.state | 6 /* isBoundOrUnbinding */) ^ 6 /* isBoundOrUnbinding */;\n        this.lifecycle.afterUnbind.end(flags);\n    }\n    // #endregion\n    // #region attach/detach\n    attachCustomElement(flags) {\n        flags |= 16384 /* fromAttach */;\n        this.state |= 8 /* isAttaching */;\n        this.lifecycle.mount.add(this);\n        this.lifecycle.afterAttach.begin();\n        if (this.hooks.hasBeforeAttach) {\n            this.bindingContext.beforeAttach(flags);\n        }\n        this.attachControllers(flags);\n        if (this.hooks.hasAfterAttach) {\n            this.lifecycle.afterAttach.add(this);\n        }\n        this.state = this.state ^ 8 /* isAttaching */ | 32 /* isAttached */;\n        this.lifecycle.afterAttach.end(flags);\n    }\n    attachCustomAttribute(flags) {\n        flags |= 16384 /* fromAttach */;\n        this.state |= 8 /* isAttaching */;\n        this.lifecycle.afterAttach.begin();\n        if (this.hooks.hasBeforeAttach) {\n            this.bindingContext.beforeAttach(flags);\n        }\n        if (this.hooks.hasAfterAttach) {\n            this.lifecycle.afterAttach.add(this);\n        }\n        this.state = this.state ^ 8 /* isAttaching */ | 32 /* isAttached */;\n        this.lifecycle.afterAttach.end(flags);\n    }\n    attachSynthetic(flags) {\n        if (((this.state & 32 /* isAttached */) > 0 && flags & 33554432 /* reorderNodes */) > 0) {\n            this.lifecycle.mount.add(this);\n        }\n        else {\n            flags |= 16384 /* fromAttach */;\n            this.state |= 8 /* isAttaching */;\n            this.lifecycle.mount.add(this);\n            this.lifecycle.afterAttach.begin();\n            this.attachControllers(flags);\n            this.state = this.state ^ 8 /* isAttaching */ | 32 /* isAttached */;\n            this.lifecycle.afterAttach.end(flags);\n        }\n    }\n    detachCustomElement(flags) {\n        flags |= 32768 /* fromDetach */;\n        this.state |= 16 /* isDetaching */;\n        this.lifecycle.afterDetach.begin();\n        this.lifecycle.unmount.add(this);\n        if (this.hooks.hasBeforeDetach) {\n            this.bindingContext.beforeDetach(flags);\n        }\n        this.detachControllers(flags);\n        if (this.hooks.hasAfterDetach) {\n            this.lifecycle.afterDetach.add(this);\n        }\n        this.state = (this.state | 48 /* isAttachedOrDetaching */) ^ 48 /* isAttachedOrDetaching */;\n        this.lifecycle.afterDetach.end(flags);\n    }\n    detachCustomAttribute(flags) {\n        flags |= 32768 /* fromDetach */;\n        this.state |= 16 /* isDetaching */;\n        this.lifecycle.afterDetach.begin();\n        if (this.hooks.hasBeforeDetach) {\n            this.bindingContext.beforeDetach(flags);\n        }\n        if (this.hooks.hasAfterDetach) {\n            this.lifecycle.afterDetach.add(this);\n        }\n        this.state = (this.state | 48 /* isAttachedOrDetaching */) ^ 48 /* isAttachedOrDetaching */;\n        this.lifecycle.afterDetach.end(flags);\n    }\n    detachSynthetic(flags) {\n        flags |= 32768 /* fromDetach */;\n        this.state |= 16 /* isDetaching */;\n        this.lifecycle.afterDetach.begin();\n        this.lifecycle.unmount.add(this);\n        this.detachControllers(flags);\n        this.state = (this.state | 48 /* isAttachedOrDetaching */) ^ 48 /* isAttachedOrDetaching */;\n        this.lifecycle.afterDetach.end(flags);\n    }\n    attachControllers(flags) {\n        const { controllers } = this;\n        if (controllers !== void 0) {\n            const { length } = controllers;\n            for (let i = 0; i < length; ++i) {\n                controllers[i].attach(flags);\n            }\n        }\n    }\n    detachControllers(flags) {\n        const { controllers } = this;\n        if (controllers !== void 0) {\n            for (let i = controllers.length - 1; i >= 0; --i) {\n                controllers[i].detach(flags);\n            }\n        }\n    }\n    // #endregion\n    // #region mount/unmount/cache\n    mountCustomElement(flags) {\n        if ((this.state & 64 /* isMounted */) > 0) {\n            return;\n        }\n        this.state |= 64 /* isMounted */;\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        this.projector.project(this.nodes); // non-null is implied by the hook\n    }\n    mountSynthetic(flags) {\n        const nodes = this.nodes; // non null is implied by the hook\n        const location = this.location; // non null is implied by the hook\n        this.state |= 64 /* isMounted */;\n        switch (this.mountStrategy) {\n            case 2 /* append */:\n                nodes.appendTo(location);\n                break;\n            default:\n                nodes.insertBefore(location);\n        }\n    }\n    unmountCustomElement(flags) {\n        if ((this.state & 64 /* isMounted */) === 0) {\n            return;\n        }\n        this.state = (this.state | 64 /* isMounted */) ^ 64 /* isMounted */;\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        this.projector.take(this.nodes); // non-null is implied by the hook\n    }\n    unmountSynthetic(flags) {\n        if ((this.state & 64 /* isMounted */) === 0) {\n            return false;\n        }\n        this.state = (this.state | 64 /* isMounted */) ^ 64 /* isMounted */;\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        this.nodes.remove(); // non-null is implied by the hook\n        this.nodes.unlink();\n        if ((this.state & 512 /* canBeCached */) > 0) {\n            this.state = (this.state | 512 /* canBeCached */) ^ 512 /* canBeCached */;\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            if (this.viewFactory.tryReturnToCache(this)) { // non-null is implied by the hook\n                return true;\n            }\n        }\n        return false;\n    }\n    cacheCustomElement(flags) {\n        flags |= 65536 /* fromCache */;\n        if (this.hooks.hasCaching) {\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            this.bindingContext.caching(flags); // non-null is implied by the hook\n        }\n    }\n    cacheCustomAttribute(flags) {\n        flags |= 65536 /* fromCache */;\n        if (this.hooks.hasCaching) {\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            this.bindingContext.caching(flags); // non-null is implied by the hook\n        }\n        const { controllers } = this;\n        if (controllers !== void 0) {\n            const { length } = controllers;\n            for (let i = length - 1; i >= 0; --i) {\n                controllers[i].cache(flags);\n            }\n        }\n    }\n    cacheSynthetic(flags) {\n        const { controllers } = this;\n        if (controllers !== void 0) {\n            const { length } = controllers;\n            for (let i = length - 1; i >= 0; --i) {\n                controllers[i].cache(flags);\n            }\n        }\n    }\n}\nfunction getBindingContext(flags, instance) {\n    if (instance.noProxy === true || (flags & 2 /* proxyStrategy */) === 0) {\n        return instance;\n    }\n    return ProxyObserver.getOrCreate(instance).proxy;\n}\nfunction getLookup(instance) {\n    let lookup = instance.$observers;\n    if (lookup === void 0) {\n        Reflect.defineProperty(instance, '$observers', {\n            enumerable: false,\n            value: lookup = {},\n        });\n    }\n    return lookup;\n}\nfunction createObservers(lifecycle, definition, flags, instance) {\n    const bindables = definition.bindables;\n    const observableNames = Object.getOwnPropertyNames(bindables);\n    const length = observableNames.length;\n    if (length > 0) {\n        let name;\n        let bindable;\n        if ((flags & 2 /* proxyStrategy */) > 0) {\n            for (let i = 0; i < length; ++i) {\n                name = observableNames[i];\n                bindable = bindables[name];\n                new BindableObserver(lifecycle, flags, ProxyObserver.getOrCreate(instance).proxy, name, bindable.callback, bindable.set);\n            }\n        }\n        else {\n            const observers = getLookup(instance);\n            for (let i = 0; i < length; ++i) {\n                name = observableNames[i];\n                if (observers[name] === void 0) {\n                    bindable = bindables[name];\n                    observers[name] = new BindableObserver(lifecycle, flags, instance, name, bindable.callback, bindable.set);\n                }\n            }\n        }\n    }\n}\nfunction createChildrenObservers(controller, definition, flags, instance) {\n    const childrenObservers = definition.childrenObservers;\n    const childObserverNames = Object.getOwnPropertyNames(childrenObservers);\n    const length = childObserverNames.length;\n    if (length > 0) {\n        const observers = getLookup(instance);\n        let name;\n        for (let i = 0; i < length; ++i) {\n            name = childObserverNames[i];\n            if (observers[name] == void 0) {\n                const childrenDescription = childrenObservers[name];\n                observers[name] = new ChildrenObserver(controller, instance, flags, name, childrenDescription.callback, childrenDescription.query, childrenDescription.filter, childrenDescription.map, childrenDescription.options);\n            }\n        }\n    }\n}\n//# sourceMappingURL=controller.js.map","import { DI, Registration, Metadata, Protocol } from '@aurelia/kernel';\nimport { Scope } from '../observation/binding-context';\nimport { CustomElement, CustomElementDefinition } from '../resources/custom-element';\nimport { Controller } from './controller';\nimport { mergeParts } from '../definitions';\nimport { getRenderContext } from './render-context';\nexport class ViewFactory {\n    constructor(name, context, lifecycle, parts) {\n        this.name = name;\n        this.context = context;\n        this.lifecycle = lifecycle;\n        this.parts = parts;\n        this.isCaching = false;\n        this.cache = null;\n        this.cacheSize = -1;\n    }\n    setCacheSize(size, doNotOverrideIfAlreadySet) {\n        if (size) {\n            if (size === '*') {\n                size = ViewFactory.maxCacheSize;\n            }\n            else if (typeof size === 'string') {\n                size = parseInt(size, 10);\n            }\n            if (this.cacheSize === -1 || !doNotOverrideIfAlreadySet) {\n                this.cacheSize = size;\n            }\n        }\n        if (this.cacheSize > 0) {\n            this.cache = [];\n        }\n        else {\n            this.cache = null;\n        }\n        this.isCaching = this.cacheSize > 0;\n    }\n    canReturnToCache(controller) {\n        return this.cache != null && this.cache.length < this.cacheSize;\n    }\n    tryReturnToCache(controller) {\n        if (this.canReturnToCache(controller)) {\n            controller.cache(0 /* none */);\n            this.cache.push(controller);\n            return true;\n        }\n        return false;\n    }\n    create(flags) {\n        const cache = this.cache;\n        let controller;\n        if (cache != null && cache.length > 0) {\n            controller = cache.pop();\n            return controller;\n        }\n        controller = Controller.forSyntheticView(this, this.lifecycle, this.context, flags);\n        return controller;\n    }\n    resolve(requestor, parts) {\n        parts = mergeParts(this.parts, parts);\n        if (parts === void 0) {\n            return this;\n        }\n        const part = parts[this.name];\n        if (part === void 0) {\n            return this;\n        }\n        return getRenderContext(part, requestor, parts).getViewFactory(this.name);\n    }\n}\nViewFactory.maxCacheSize = 0xFFFF;\nconst seenViews = new WeakSet();\nfunction notYetSeen($view) {\n    return !seenViews.has($view);\n}\nfunction toCustomElementDefinition($view) {\n    seenViews.add($view);\n    return CustomElementDefinition.create($view);\n}\nexport const Views = {\n    name: Protocol.resource.keyFor('views'),\n    has(value) {\n        return typeof value === 'function' && (Metadata.hasOwn(Views.name, value) || '$views' in value);\n    },\n    get(value) {\n        if (typeof value === 'function' && '$views' in value) {\n            // TODO: a `get` operation with side effects is not a good thing. Should refactor this to a proper resource kind.\n            const $views = value.$views;\n            const definitions = $views.filter(notYetSeen).map(toCustomElementDefinition);\n            for (const def of definitions) {\n                Views.add(value, def);\n            }\n        }\n        let views = Metadata.getOwn(Views.name, value);\n        if (views === void 0) {\n            Metadata.define(Views.name, views = [], value);\n        }\n        return views;\n    },\n    add(Type, partialDefinition) {\n        const definition = CustomElementDefinition.create(partialDefinition);\n        let views = Metadata.getOwn(Views.name, Type);\n        if (views === void 0) {\n            Metadata.define(Views.name, views = [definition], Type);\n        }\n        else {\n            views.push(definition);\n        }\n        return views;\n    },\n};\nexport function view(v) {\n    return function (target) {\n        Views.add(target, v);\n    };\n}\nexport const IViewLocator = DI.createInterface('IViewLocator')\n    .noDefault();\nexport class ViewLocator {\n    constructor() {\n        this.modelInstanceToBoundComponent = new WeakMap();\n        this.modelTypeToUnboundComponent = new Map();\n    }\n    static register(container) {\n        return Registration.singleton(IViewLocator, this).register(container);\n    }\n    getViewComponentForObject(object, viewNameOrSelector) {\n        if (object) {\n            const availableViews = Views.has(object.constructor) ? Views.get(object.constructor) : [];\n            const resolvedViewName = typeof viewNameOrSelector === 'function'\n                ? viewNameOrSelector(object, availableViews)\n                : this.getViewName(availableViews, viewNameOrSelector);\n            return this.getOrCreateBoundComponent(object, availableViews, resolvedViewName);\n        }\n        return null;\n    }\n    getOrCreateBoundComponent(object, availableViews, resolvedViewName) {\n        let lookup = this.modelInstanceToBoundComponent.get(object);\n        let BoundComponent;\n        if (lookup === void 0) {\n            lookup = {};\n            this.modelInstanceToBoundComponent.set(object, lookup);\n        }\n        else {\n            BoundComponent = lookup[resolvedViewName];\n        }\n        if (BoundComponent === void 0) {\n            const UnboundComponent = this.getOrCreateUnboundComponent(object, availableViews, resolvedViewName);\n            BoundComponent = CustomElement.define(CustomElement.getDefinition(UnboundComponent), class extends UnboundComponent {\n                constructor() {\n                    super(object);\n                }\n            });\n            lookup[resolvedViewName] = BoundComponent;\n        }\n        return BoundComponent;\n    }\n    getOrCreateUnboundComponent(object, availableViews, resolvedViewName) {\n        let lookup = this.modelTypeToUnboundComponent.get(object.constructor);\n        let UnboundComponent;\n        if (lookup === void 0) {\n            lookup = {};\n            this.modelTypeToUnboundComponent.set(object.constructor, lookup);\n        }\n        else {\n            UnboundComponent = lookup[resolvedViewName];\n        }\n        if (UnboundComponent === void 0) {\n            UnboundComponent = CustomElement.define(this.getView(availableViews, resolvedViewName), class {\n                constructor(viewModel) {\n                    this.viewModel = viewModel;\n                }\n                create(controller, parentContainer, definition, parts) {\n                    const vm = this.viewModel;\n                    controller.scope = Scope.fromParent(controller.flags, controller.scope, vm);\n                    if (vm.create !== void 0) {\n                        return vm.create(controller, parentContainer, definition, parts);\n                    }\n                }\n            });\n            const proto = UnboundComponent.prototype;\n            if ('beforeCompile' in object) {\n                proto.beforeCompile = function beforeCompile(controller) {\n                    this.viewModel.beforeCompile(controller);\n                };\n            }\n            if ('afterCompile' in object) {\n                proto.afterCompile = function afterCompile(controller) {\n                    this.viewModel.afterCompile(controller);\n                };\n            }\n            if ('afterCompileChildren' in object) {\n                proto.afterCompileChildren = function afterCompileChildren(controller) {\n                    this.viewModel.afterCompileChildren(controller);\n                };\n            }\n            if ('beforeBind' in object) {\n                proto.beforeBind = function beforeBind(flags) {\n                    return this.viewModel.beforeBind(flags);\n                };\n            }\n            if ('afterBind' in object) {\n                proto.afterBind = function afterBind(flags) {\n                    this.viewModel.afterBind(flags);\n                };\n            }\n            if ('beforeUnbind' in object) {\n                proto.beforeUnbind = function beforeUnbind(flags) {\n                    return this.viewModel.beforeUnbind(flags);\n                };\n            }\n            if ('afterUnbind' in object) {\n                proto.afterUnbind = function afterUnbind(flags) {\n                    this.viewModel.afterUnbind(flags);\n                };\n            }\n            if ('beforeAttach' in object) {\n                proto.beforeAttach = function beforeAttach(flags) {\n                    this.viewModel.beforeAttach(flags);\n                };\n            }\n            if ('afterAttach' in object) {\n                proto.afterAttach = function afterAttach(flags) {\n                    this.viewModel.afterAttach(flags);\n                };\n            }\n            if ('beforeDetach' in object) {\n                proto.beforeDetach = function beforeDetach(flags) {\n                    this.viewModel.beforeDetach(flags);\n                };\n            }\n            if ('afterDetach' in object) {\n                proto.afterDetach = function afterDetach(flags) {\n                    this.viewModel.afterDetach(flags);\n                };\n            }\n            if ('caching' in object) {\n                proto.caching = function caching(flags) {\n                    this.viewModel.caching(flags);\n                };\n            }\n            lookup[resolvedViewName] = UnboundComponent;\n        }\n        return UnboundComponent;\n    }\n    getViewName(views, requestedName) {\n        if (requestedName) {\n            return requestedName;\n        }\n        if (views.length === 1) {\n            return views[0].name;\n        }\n        return 'default-view';\n    }\n    getView(views, name) {\n        const v = views.find(x => x.name === name);\n        if (v === void 0) {\n            // TODO: Use Reporter\n            throw new Error(`Could not find view: ${name}`);\n        }\n        return v;\n    }\n}\n//# sourceMappingURL=view.js.map","import { __decorate, __metadata, __param } from \"tslib\";\nimport { IViewLocator } from '../../templating/view';\nimport { valueConverter } from '../value-converter';\nlet ViewValueConverter = class ViewValueConverter {\n    constructor(viewLocator) {\n        this.viewLocator = viewLocator;\n    }\n    toView(object, viewNameOrSelector) {\n        return this.viewLocator.getViewComponentForObject(object, viewNameOrSelector);\n    }\n};\nViewValueConverter = __decorate([\n    valueConverter('view'),\n    __param(0, IViewLocator),\n    __metadata(\"design:paramtypes\", [Object])\n], ViewValueConverter);\nexport { ViewValueConverter };\n//# sourceMappingURL=view.js.map","import { DI, Registration, } from '@aurelia/kernel';\nimport { ILifecycle } from './lifecycle';\nimport { ContinuationTask, IStartTaskManager, } from './lifecycle-task';\nimport { Controller } from './templating/controller';\nexport const IActivator = DI.createInterface('IActivator').withDefault(x => x.singleton(Activator));\n/** @internal */\nexport class Activator {\n    constructor(taskManager) {\n        this.taskManager = taskManager;\n    }\n    static register(container) {\n        return Registration.singleton(IActivator, this).register(container);\n    }\n    activate(host, component, container, flags = 1024 /* fromStartTask */, parentScope) {\n        flags = flags === void 0 ? 0 /* none */ : flags;\n        const mgr = this.taskManager;\n        let task = mgr.runBeforeRender();\n        if (task.done) {\n            this.render(host, component, container, flags);\n        }\n        else {\n            task = new ContinuationTask(task, this.render, this, host, component, container, flags);\n        }\n        if (task.done) {\n            task = mgr.runBeforeBind();\n        }\n        else {\n            task = new ContinuationTask(task, mgr.runBeforeBind, mgr);\n        }\n        if (task.done) {\n            task = this.bind(component, flags, parentScope);\n        }\n        else {\n            task = new ContinuationTask(task, this.bind, this, component, flags, parentScope);\n        }\n        if (task.done) {\n            task = mgr.runBeforeAttach();\n        }\n        else {\n            task = new ContinuationTask(task, mgr.runBeforeAttach, mgr);\n        }\n        if (task.done) {\n            this.attach(component, flags);\n        }\n        else {\n            task = new ContinuationTask(task, this.attach, this, component, flags);\n        }\n        return task;\n    }\n    deactivate(component, flags = 2048 /* fromStopTask */) {\n        const controller = Controller.getCachedOrThrow(component);\n        controller.detach(flags | 32768 /* fromDetach */);\n        return controller.unbind(flags | 8192 /* fromUnbind */);\n    }\n    render(host, component, container, flags) {\n        const lifecycle = container.get(ILifecycle);\n        Controller.forCustomElement(component, lifecycle, host, container, void 0, flags);\n    }\n    bind(component, flags, parentScope) {\n        return Controller.getCachedOrThrow(component).bind(flags | 4096 /* fromBind */, parentScope);\n    }\n    attach(component, flags) {\n        Controller.getCachedOrThrow(component).attach(flags | 16384 /* fromAttach */);\n    }\n}\nActivator.inject = [IStartTaskManager];\n//# sourceMappingURL=activator.js.map","import { DI, PLATFORM, Registration } from '@aurelia/kernel';\nimport { IActivator } from './activator';\nimport { INode } from './dom';\nimport { ILifecycle, } from './lifecycle';\nimport { ContinuationTask, IStartTaskManager, LifecycleTask, } from './lifecycle-task';\nimport { CustomElement } from './resources/custom-element';\nimport { Controller } from './templating/controller';\nexport class CompositionRoot {\n    constructor(config, container) {\n        this.config = config;\n        if (config.host != void 0) {\n            if (container.has(INode, false)) {\n                this.container = container.createChild();\n            }\n            else {\n                this.container = container;\n            }\n            Registration.instance(INode, config.host).register(this.container);\n            this.host = config.host;\n        }\n        else if (container.has(INode, true)) {\n            this.container = container;\n            this.host = container.get(INode);\n        }\n        else {\n            throw new Error(`No host element found.`);\n        }\n        this.strategy = config.strategy != void 0 ? config.strategy : 1 /* getterSetter */;\n        const initializer = this.container.get(IDOMInitializer);\n        this.dom = initializer.initialize(config);\n        this.lifecycle = this.container.get(ILifecycle);\n        this.activator = this.container.get(IActivator);\n        const taskManager = this.container.get(IStartTaskManager);\n        const beforeCreateTask = taskManager.runBeforeCreate();\n        if (beforeCreateTask.done) {\n            this.task = LifecycleTask.done;\n            this.create();\n        }\n        else {\n            this.task = new ContinuationTask(beforeCreateTask, this.create, this);\n        }\n    }\n    activate(antecedent) {\n        const { task, host, viewModel, container, activator, strategy } = this;\n        const flags = strategy | 1024 /* fromStartTask */;\n        if (viewModel === void 0) {\n            if (this.createTask === void 0) {\n                this.createTask = new ContinuationTask(task, this.activate, this, antecedent);\n            }\n            return this.createTask;\n        }\n        if (task.done) {\n            if (antecedent == void 0 || antecedent.done) {\n                this.task = activator.activate(host, viewModel, container, flags, void 0);\n            }\n            else {\n                this.task = new ContinuationTask(antecedent, activator.activate, activator, host, viewModel, container, flags, void 0);\n            }\n        }\n        else {\n            if (antecedent == void 0 || antecedent.done) {\n                this.task = new ContinuationTask(task, activator.activate, activator, host, viewModel, container, flags, void 0);\n            }\n            else {\n                const combinedAntecedent = new ContinuationTask(task, antecedent.wait, antecedent);\n                this.task = new ContinuationTask(combinedAntecedent, activator.activate, activator, host, viewModel, container, flags, void 0);\n            }\n        }\n        return this.task;\n    }\n    deactivate(antecedent) {\n        const { task, viewModel, activator, strategy } = this;\n        const flags = strategy | 2048 /* fromStopTask */;\n        if (viewModel === void 0) {\n            if (this.createTask === void 0) {\n                this.createTask = new ContinuationTask(task, this.deactivate, this, antecedent);\n            }\n            return this.createTask;\n        }\n        if (task.done) {\n            if (antecedent == void 0 || antecedent.done) {\n                this.task = activator.deactivate(viewModel, flags);\n            }\n            else {\n                this.task = new ContinuationTask(antecedent, activator.deactivate, activator, viewModel, flags);\n            }\n        }\n        else {\n            if (antecedent == void 0 || antecedent.done) {\n                this.task = new ContinuationTask(task, activator.deactivate, activator, viewModel, flags);\n            }\n            else {\n                const combinedAntecedent = new ContinuationTask(task, antecedent.wait, antecedent);\n                this.task = new ContinuationTask(combinedAntecedent, activator.deactivate, activator, viewModel, flags);\n            }\n        }\n        return this.task;\n    }\n    create() {\n        const config = this.config;\n        const instance = this.viewModel = CustomElement.isType(config.component)\n            ? this.container.get(config.component)\n            : config.component;\n        const container = this.container;\n        const lifecycle = container.get(ILifecycle);\n        this.controller = Controller.forCustomElement(instance, lifecycle, this.host, container, void 0, this.strategy);\n    }\n}\nexport class Aurelia {\n    constructor(container = DI.createContainer()) {\n        this.container = container;\n        this.task = LifecycleTask.done;\n        this._isRunning = false;\n        this._isStarting = false;\n        this._isStopping = false;\n        this._root = void 0;\n        this.next = (void 0);\n        Registration.instance(Aurelia, this).register(container);\n    }\n    get isRunning() {\n        return this._isRunning;\n    }\n    get isStarting() {\n        return this._isStarting;\n    }\n    get isStopping() {\n        return this._isStopping;\n    }\n    get root() {\n        if (this._root == void 0) {\n            if (this.next == void 0) {\n                throw new Error(`root is not defined`); // TODO: create error code\n            }\n            return this.next;\n        }\n        return this._root;\n    }\n    register(...params) {\n        this.container.register(...params);\n        return this;\n    }\n    app(config) {\n        this.next = new CompositionRoot(config, this.container);\n        if (this.isRunning) {\n            this.start();\n        }\n        return this;\n    }\n    start(root = this.next) {\n        if (root == void 0) {\n            throw new Error(`There is no composition root`); // TODO: create error code\n        }\n        this.stop(root);\n        if (this.task.done) {\n            this.onBeforeStart(root);\n        }\n        else {\n            this.task = new ContinuationTask(this.task, this.onBeforeStart, this, root);\n        }\n        this.task = this.root.activate(this.task);\n        if (this.task.done) {\n            this.task = this.onAfterStart(root);\n        }\n        else {\n            this.task = new ContinuationTask(this.task, this.onAfterStart, this, root);\n        }\n        return this.task;\n    }\n    stop(root = this._root) {\n        if (this._isRunning && root != void 0) {\n            if (this.task.done) {\n                this.onBeforeStop(root);\n            }\n            else {\n                this.task = new ContinuationTask(this.task, this.onBeforeStop, this, root);\n            }\n            this.task = root.deactivate(this.task);\n            if (this.task.done) {\n                this.task = this.onAfterStop(root);\n            }\n            else {\n                this.task = new ContinuationTask(this.task, this.onAfterStop, this, root);\n            }\n        }\n        return this.task;\n    }\n    wait() {\n        return this.task.wait();\n    }\n    onBeforeStart(root) {\n        Reflect.set(root.host, '$aurelia', this);\n        this._root = root;\n        this._isStarting = true;\n    }\n    onAfterStart(root) {\n        this._isRunning = true;\n        this._isStarting = false;\n        this.dispatchEvent(root, 'aurelia-composed', root.dom);\n        this.dispatchEvent(root, 'au-started', root.host);\n        return LifecycleTask.done;\n    }\n    onBeforeStop(root) {\n        this._isRunning = false;\n        this._isStopping = true;\n    }\n    onAfterStop(root) {\n        Reflect.deleteProperty(root.host, '$aurelia');\n        this._root = void 0;\n        this._isStopping = false;\n        this.dispatchEvent(root, 'au-stopped', root.host);\n        return LifecycleTask.done;\n    }\n    dispatchEvent(root, name, target) {\n        target = 'dispatchEvent' in target ? target : root.dom;\n        target.dispatchEvent(root.dom.createCustomEvent(name, { detail: this, bubbles: true, cancelable: true }));\n    }\n}\nPLATFORM.global.Aurelia = Aurelia;\nexport const IDOMInitializer = DI.createInterface('IDOMInitializer').noDefault();\n//# sourceMappingURL=aurelia.js.map","import { BindingMode } from './flags';\nexport class InterpolationInstruction {\n    constructor(from, to) {\n        this.from = from;\n        this.to = to;\n        this.type = \"rf\" /* interpolation */;\n    }\n}\nexport class OneTimeBindingInstruction {\n    constructor(from, to) {\n        this.from = from;\n        this.to = to;\n        this.type = \"rg\" /* propertyBinding */;\n        this.mode = BindingMode.oneTime;\n        this.oneTime = true;\n    }\n}\nexport class ToViewBindingInstruction {\n    constructor(from, to) {\n        this.from = from;\n        this.to = to;\n        this.type = \"rg\" /* propertyBinding */;\n        this.mode = BindingMode.toView;\n        this.oneTime = false;\n    }\n}\nexport class FromViewBindingInstruction {\n    constructor(from, to) {\n        this.from = from;\n        this.to = to;\n        this.type = \"rg\" /* propertyBinding */;\n        this.mode = BindingMode.fromView;\n        this.oneTime = false;\n    }\n}\nexport class TwoWayBindingInstruction {\n    constructor(from, to) {\n        this.from = from;\n        this.to = to;\n        this.type = \"rg\" /* propertyBinding */;\n        this.mode = BindingMode.twoWay;\n        this.oneTime = false;\n    }\n}\nexport class IteratorBindingInstruction {\n    constructor(from, to) {\n        this.from = from;\n        this.to = to;\n        this.type = \"rk\" /* iteratorBinding */;\n    }\n}\nexport class CallBindingInstruction {\n    constructor(from, to) {\n        this.from = from;\n        this.to = to;\n        this.type = \"rh\" /* callBinding */;\n    }\n}\nexport class RefBindingInstruction {\n    constructor(from, to) {\n        this.from = from;\n        this.to = to;\n        this.type = \"rj\" /* refBinding */;\n        this.type = \"rj\" /* refBinding */;\n    }\n}\nexport class SetPropertyInstruction {\n    constructor(value, to) {\n        this.value = value;\n        this.to = to;\n        this.type = \"re\" /* setProperty */;\n    }\n}\nexport class HydrateElementInstruction {\n    constructor(res, instructions, parts) {\n        this.res = res;\n        this.instructions = instructions;\n        this.parts = parts;\n        this.type = \"ra\" /* hydrateElement */;\n    }\n}\nexport class HydrateAttributeInstruction {\n    constructor(res, instructions) {\n        this.res = res;\n        this.instructions = instructions;\n        this.type = \"rb\" /* hydrateAttribute */;\n    }\n}\nexport class HydrateTemplateController {\n    constructor(def, res, instructions, link, parts) {\n        this.def = def;\n        this.res = res;\n        this.instructions = instructions;\n        this.link = link;\n        this.parts = parts;\n        this.type = \"rc\" /* hydrateTemplateController */;\n    }\n}\nexport class LetElementInstruction {\n    constructor(instructions, toBindingContext) {\n        this.instructions = instructions;\n        this.toBindingContext = toBindingContext;\n        this.type = \"rd\" /* hydrateLetElement */;\n    }\n}\nexport class LetBindingInstruction {\n    constructor(from, to) {\n        this.from = from;\n        this.to = to;\n        this.type = \"ri\" /* letBinding */;\n    }\n}\n//# sourceMappingURL=instructions.js.map","import { hasBind, hasUnbind } from '@aurelia/runtime';\n/**\n * Listener binding. Handle event binding between view and view model\n */\nexport class Listener {\n    constructor(dom, targetEvent, delegationStrategy, sourceExpression, target, preventDefault, eventManager, locator) {\n        this.dom = dom;\n        this.targetEvent = targetEvent;\n        this.delegationStrategy = delegationStrategy;\n        this.sourceExpression = sourceExpression;\n        this.target = target;\n        this.preventDefault = preventDefault;\n        this.eventManager = eventManager;\n        this.locator = locator;\n        this.interceptor = this;\n        this.$state = 0 /* none */;\n    }\n    callSource(event) {\n        const overrideContext = this.$scope.overrideContext;\n        overrideContext.$event = event;\n        const result = this.sourceExpression.evaluate(2097152 /* mustEvaluate */, this.$scope, this.locator, this.part);\n        Reflect.deleteProperty(overrideContext, '$event');\n        if (result !== true && this.preventDefault) {\n            event.preventDefault();\n        }\n        return result;\n    }\n    handleEvent(event) {\n        this.interceptor.callSource(event);\n    }\n    $bind(flags, scope, part) {\n        if (this.$state & 4 /* isBound */) {\n            if (this.$scope === scope) {\n                return;\n            }\n            this.interceptor.$unbind(flags | 4096 /* fromBind */);\n        }\n        // add isBinding flag\n        this.$state |= 1 /* isBinding */;\n        this.$scope = scope;\n        this.part = part;\n        const sourceExpression = this.sourceExpression;\n        if (hasBind(sourceExpression)) {\n            sourceExpression.bind(flags, scope, this.interceptor);\n        }\n        this.handler = this.eventManager.addEventListener(this.dom, this.target, this.targetEvent, this.interceptor, this.delegationStrategy);\n        // add isBound flag and remove isBinding flag\n        this.$state |= 4 /* isBound */;\n        this.$state &= ~1 /* isBinding */;\n    }\n    $unbind(flags) {\n        if (!(this.$state & 4 /* isBound */)) {\n            return;\n        }\n        // add isUnbinding flag\n        this.$state |= 2 /* isUnbinding */;\n        const sourceExpression = this.sourceExpression;\n        if (hasUnbind(sourceExpression)) {\n            sourceExpression.unbind(flags, this.$scope, this.interceptor);\n        }\n        this.$scope = null;\n        this.handler.dispose();\n        this.handler = null;\n        // remove isBound and isUnbinding flags\n        this.$state &= ~(4 /* isBound */ | 2 /* isUnbinding */);\n    }\n    observeProperty(flags, obj, propertyName) {\n        return;\n    }\n    handleChange(newValue, previousValue, flags) {\n        return;\n    }\n}\n//# sourceMappingURL=listener.js.map","import { __decorate, __metadata } from \"tslib\";\nimport { DOM, IObserverLocator, subscriberCollection, IScheduler, } from '@aurelia/runtime';\n/**\n * Observer for handling two-way binding with attributes\n * Has different strategy for class/style and normal attributes\n * TODO: handle SVG/attributes with namespace\n */\nlet AttributeObserver = class AttributeObserver {\n    constructor(scheduler, flags, observerLocator, obj, propertyKey, targetAttribute) {\n        this.scheduler = scheduler;\n        this.observerLocator = observerLocator;\n        this.obj = obj;\n        this.propertyKey = propertyKey;\n        this.targetAttribute = targetAttribute;\n        this.currentValue = null;\n        this.oldValue = null;\n        this.hasChanges = false;\n        this.task = null;\n        this.persistentFlags = flags & 805306383 /* targetObserverFlags */;\n    }\n    getValue() {\n        return this.currentValue;\n    }\n    setValue(newValue, flags) {\n        this.currentValue = newValue;\n        this.hasChanges = newValue !== this.oldValue;\n        if ((flags & 4096 /* fromBind */) > 0 || this.persistentFlags === 268435456 /* noTargetObserverQueue */) {\n            this.flushChanges(flags);\n        }\n        else if (this.persistentFlags !== 536870912 /* persistentTargetObserverQueue */ && this.task === null) {\n            this.task = this.scheduler.queueRenderTask(() => {\n                this.flushChanges(flags);\n                this.task = null;\n            });\n        }\n    }\n    flushChanges(flags) {\n        if (this.hasChanges) {\n            this.hasChanges = false;\n            const { currentValue } = this;\n            this.oldValue = currentValue;\n            switch (this.targetAttribute) {\n                case 'class': {\n                    // Why is class attribute observer setValue look different with class attribute accessor?\n                    // ==============\n                    // For class list\n                    // newValue is simply checked if truthy or falsy\n                    // and toggle the class accordingly\n                    // -- the rule of this is quite different to normal attribute\n                    //\n                    // for class attribute, observer is different in a way that it only observe a particular class at a time\n                    // this also comes from syntax, where it would typically be my-class.class=\"someProperty\"\n                    //\n                    // so there is no need for separating class by space and add all of them like class accessor\n                    if (!!currentValue) {\n                        this.obj.classList.add(this.propertyKey);\n                    }\n                    else {\n                        this.obj.classList.remove(this.propertyKey);\n                    }\n                    break;\n                }\n                case 'style': {\n                    let priority = '';\n                    let newValue = currentValue;\n                    if (typeof newValue === 'string' && newValue.includes('!important')) {\n                        priority = 'important';\n                        newValue = newValue.replace('!important', '');\n                    }\n                    this.obj.style.setProperty(this.propertyKey, newValue, priority);\n                }\n            }\n        }\n    }\n    handleMutation(mutationRecords) {\n        let shouldProcess = false;\n        for (let i = 0, ii = mutationRecords.length; ii > i; ++i) {\n            const record = mutationRecords[i];\n            if (record.type === 'attributes' && record.attributeName === this.propertyKey) {\n                shouldProcess = true;\n                break;\n            }\n        }\n        if (shouldProcess) {\n            let newValue;\n            switch (this.targetAttribute) {\n                case 'class':\n                    newValue = this.obj.classList.contains(this.propertyKey);\n                    break;\n                case 'style':\n                    newValue = this.obj.style.getPropertyValue(this.propertyKey);\n                    break;\n                default:\n                    throw new Error(`Unsupported targetAttribute: ${this.targetAttribute}`);\n            }\n            if (newValue !== this.currentValue) {\n                const { currentValue } = this;\n                this.currentValue = this.oldValue = newValue;\n                this.hasChanges = false;\n                this.callSubscribers(newValue, currentValue, 131072 /* fromDOMEvent */);\n            }\n        }\n    }\n    subscribe(subscriber) {\n        if (!this.hasSubscribers()) {\n            this.currentValue = this.oldValue = this.obj.getAttribute(this.propertyKey);\n            startObservation(this.obj, this);\n        }\n        this.addSubscriber(subscriber);\n    }\n    unsubscribe(subscriber) {\n        this.removeSubscriber(subscriber);\n        if (!this.hasSubscribers()) {\n            stopObservation(this.obj, this);\n        }\n    }\n    bind(flags) {\n        if (this.persistentFlags === 536870912 /* persistentTargetObserverQueue */) {\n            if (this.task !== null) {\n                this.task.cancel();\n            }\n            this.task = this.scheduler.queueRenderTask(() => this.flushChanges(flags), { persistent: true });\n        }\n    }\n    unbind(flags) {\n        if (this.task !== null) {\n            this.task.cancel();\n            this.task = null;\n        }\n    }\n};\nAttributeObserver = __decorate([\n    subscriberCollection(),\n    __metadata(\"design:paramtypes\", [Object, Number, Object, Object, String, String])\n], AttributeObserver);\nexport { AttributeObserver };\nconst startObservation = (element, subscription) => {\n    if (element.$eMObservers === undefined) {\n        element.$eMObservers = new Set();\n    }\n    if (element.$mObserver === undefined) {\n        element.$mObserver = DOM.createNodeObserver(element, handleMutation, { attributes: true });\n    }\n    element.$eMObservers.add(subscription);\n};\nconst stopObservation = (element, subscription) => {\n    const $eMObservers = element.$eMObservers;\n    if ($eMObservers && $eMObservers.delete(subscription)) {\n        if ($eMObservers.size === 0) {\n            element.$mObserver.disconnect();\n            element.$mObserver = undefined;\n        }\n        return true;\n    }\n    return false;\n};\nconst handleMutation = (mutationRecords) => {\n    mutationRecords[0].target.$eMObservers.forEach(invokeHandleMutation, mutationRecords);\n};\nfunction invokeHandleMutation(s) {\n    s.handleMutation(this);\n}\n//# sourceMappingURL=element-attribute-observer.js.map","import { __decorate, __metadata } from \"tslib\";\nimport { IServiceLocator, Reporter, } from '@aurelia/kernel';\nimport { BindingMode, connectable, hasBind, hasUnbind, IObserverLocator, IScheduler, INode, } from '@aurelia/runtime';\nimport { AttributeObserver, } from '../observation/element-attribute-observer';\n// BindingMode is not a const enum (and therefore not inlined), so assigning them to a variable to save a member accessor is a minor perf tweak\nconst { oneTime, toView, fromView } = BindingMode;\n// pre-combining flags for bitwise checks is a minor perf tweak\nconst toViewOrOneTime = toView | oneTime;\n/**\n * Attribute binding. Handle attribute binding betwen view/view model. Understand Html special attributes\n */\nlet AttributeBinding = class AttributeBinding {\n    constructor(sourceExpression, target, \n    // some attributes may have inner structure\n    // such as class -> collection of class names\n    // such as style -> collection of style rules\n    //\n    // for normal attributes, targetAttribute and targetProperty are the same and can be ignore\n    targetAttribute, targetProperty, mode, observerLocator, locator) {\n        this.sourceExpression = sourceExpression;\n        this.targetAttribute = targetAttribute;\n        this.targetProperty = targetProperty;\n        this.mode = mode;\n        this.observerLocator = observerLocator;\n        this.locator = locator;\n        this.interceptor = this;\n        this.$state = 0 /* none */;\n        this.$scope = null;\n        this.persistentFlags = 0 /* none */;\n        this.target = target;\n        connectable.assignIdTo(this);\n        this.$scheduler = locator.get(IScheduler);\n    }\n    updateTarget(value, flags) {\n        flags |= this.persistentFlags;\n        this.targetObserver.setValue(value, flags | 16 /* updateTargetInstance */);\n    }\n    updateSource(value, flags) {\n        flags |= this.persistentFlags;\n        this.sourceExpression.assign(flags | 32 /* updateSourceExpression */, this.$scope, this.locator, value);\n    }\n    handleChange(newValue, _previousValue, flags) {\n        if (!(this.$state & 4 /* isBound */)) {\n            return;\n        }\n        flags |= this.persistentFlags;\n        if (this.mode === BindingMode.fromView) {\n            flags &= ~16 /* updateTargetInstance */;\n            flags |= 32 /* updateSourceExpression */;\n        }\n        if (flags & 16 /* updateTargetInstance */) {\n            const previousValue = this.targetObserver.getValue();\n            // if the only observable is an AccessScope then we can assume the passed-in newValue is the correct and latest value\n            if (this.sourceExpression.$kind !== 10082 /* AccessScope */ || this.observerSlots > 1) {\n                newValue = this.sourceExpression.evaluate(flags, this.$scope, this.locator, this.part);\n            }\n            if (newValue !== previousValue) {\n                this.interceptor.updateTarget(newValue, flags);\n            }\n            if ((this.mode & oneTime) === 0) {\n                this.version++;\n                this.sourceExpression.connect(flags, this.$scope, this.interceptor, this.part);\n                this.interceptor.unobserve(false);\n            }\n            return;\n        }\n        if (flags & 32 /* updateSourceExpression */) {\n            if (newValue !== this.sourceExpression.evaluate(flags, this.$scope, this.locator, this.part)) {\n                this.interceptor.updateSource(newValue, flags);\n            }\n            return;\n        }\n        throw Reporter.error(15, flags);\n    }\n    $bind(flags, scope, part) {\n        if (this.$state & 4 /* isBound */) {\n            if (this.$scope === scope) {\n                return;\n            }\n            this.interceptor.$unbind(flags | 4096 /* fromBind */);\n        }\n        // add isBinding flag\n        this.$state |= 1 /* isBinding */;\n        // Store flags which we can only receive during $bind and need to pass on\n        // to the AST during evaluate/connect/assign\n        this.persistentFlags = flags & 2080374799 /* persistentBindingFlags */;\n        this.$scope = scope;\n        this.part = part;\n        let sourceExpression = this.sourceExpression;\n        if (hasBind(sourceExpression)) {\n            sourceExpression.bind(flags, scope, this.interceptor);\n        }\n        let targetObserver = this.targetObserver;\n        if (!targetObserver) {\n            targetObserver = this.targetObserver = new AttributeObserver(this.$scheduler, flags, this.observerLocator, this.target, this.targetProperty, this.targetAttribute);\n        }\n        if (targetObserver.bind) {\n            targetObserver.bind(flags);\n        }\n        // during bind, binding behavior might have changed sourceExpression\n        sourceExpression = this.sourceExpression;\n        if (this.mode & toViewOrOneTime) {\n            this.interceptor.updateTarget(sourceExpression.evaluate(flags, scope, this.locator, part), flags);\n        }\n        if (this.mode & toView) {\n            sourceExpression.connect(flags, scope, this, part);\n        }\n        if (this.mode & fromView) {\n            targetObserver[this.id] |= 32 /* updateSourceExpression */;\n            targetObserver.subscribe(this.interceptor);\n        }\n        // add isBound flag and remove isBinding flag\n        this.$state |= 4 /* isBound */;\n        this.$state &= ~1 /* isBinding */;\n    }\n    $unbind(flags) {\n        if (!(this.$state & 4 /* isBound */)) {\n            return;\n        }\n        // add isUnbinding flag\n        this.$state |= 2 /* isUnbinding */;\n        // clear persistent flags\n        this.persistentFlags = 0 /* none */;\n        if (hasUnbind(this.sourceExpression)) {\n            this.sourceExpression.unbind(flags, this.$scope, this.interceptor);\n        }\n        this.$scope = null;\n        if (this.targetObserver.unbind) {\n            this.targetObserver.unbind(flags);\n        }\n        if (this.targetObserver.unsubscribe) {\n            this.targetObserver.unsubscribe(this.interceptor);\n            this.targetObserver[this.id] &= ~32 /* updateSourceExpression */;\n        }\n        this.interceptor.unobserve(true);\n        // remove isBound and isUnbinding flags\n        this.$state &= ~(4 /* isBound */ | 2 /* isUnbinding */);\n    }\n    connect(flags) {\n        if (this.$state & 4 /* isBound */) {\n            flags |= this.persistentFlags;\n            this.sourceExpression.connect(flags | 2097152 /* mustEvaluate */, this.$scope, this.interceptor, this.part); // why do we have a connect method here in the first place? will this be called after bind?\n        }\n    }\n};\nAttributeBinding = __decorate([\n    connectable(),\n    __metadata(\"design:paramtypes\", [Object, Object, String, String, Number, Object, Object])\n], AttributeBinding);\nexport { AttributeBinding };\n//# sourceMappingURL=attribute.js.map","/**\n * Attribute accessor in a XML document/element that can be accessed via a namespace.\n * Wraps [`getAttributeNS`](https://developer.mozilla.org/en-US/docs/Web/API/Element/getAttributeNS).\n */\nexport class AttributeNSAccessor {\n    constructor(scheduler, flags, obj, propertyKey, namespace) {\n        this.scheduler = scheduler;\n        this.propertyKey = propertyKey;\n        this.namespace = namespace;\n        this.currentValue = null;\n        this.oldValue = null;\n        this.hasChanges = false;\n        this.task = null;\n        this.obj = obj;\n        this.persistentFlags = flags & 805306383 /* targetObserverFlags */;\n    }\n    getValue() {\n        return this.currentValue;\n    }\n    setValue(newValue, flags) {\n        this.currentValue = newValue;\n        this.hasChanges = newValue !== this.oldValue;\n        if ((flags & 4096 /* fromBind */) > 0 || this.persistentFlags === 268435456 /* noTargetObserverQueue */) {\n            this.flushChanges(flags);\n        }\n        else if (this.persistentFlags !== 536870912 /* persistentTargetObserverQueue */ && this.task === null) {\n            this.task = this.scheduler.queueRenderTask(() => {\n                this.flushChanges(flags);\n                this.task = null;\n            });\n        }\n    }\n    flushChanges(flags) {\n        if (this.hasChanges) {\n            this.hasChanges = false;\n            const { currentValue } = this;\n            this.oldValue = currentValue;\n            if (currentValue == void 0) {\n                this.obj.removeAttributeNS(this.namespace, this.propertyKey);\n            }\n            else {\n                this.obj.setAttributeNS(this.namespace, this.propertyKey, currentValue);\n            }\n        }\n    }\n    bind(flags) {\n        if (this.persistentFlags === 536870912 /* persistentTargetObserverQueue */) {\n            if (this.task !== null) {\n                this.task.cancel();\n            }\n            this.task = this.scheduler.queueRenderTask(() => this.flushChanges(flags), { persistent: true });\n        }\n        this.currentValue = this.oldValue = this.obj.getAttributeNS(this.namespace, this.propertyKey);\n    }\n    unbind(flags) {\n        if (this.task !== null) {\n            this.task.cancel();\n            this.task = null;\n        }\n    }\n}\n//# sourceMappingURL=attribute-ns-accessor.js.map","import { __decorate, __metadata } from \"tslib\";\nimport { IObserverLocator, subscriberCollection, IScheduler, } from '@aurelia/runtime';\nfunction defaultMatcher(a, b) {\n    return a === b;\n}\nlet CheckedObserver = class CheckedObserver {\n    constructor(scheduler, flags, observerLocator, handler, obj) {\n        this.scheduler = scheduler;\n        this.observerLocator = observerLocator;\n        this.handler = handler;\n        this.obj = obj;\n        this.currentValue = void 0;\n        this.oldValue = void 0;\n        this.hasChanges = false;\n        this.task = null;\n        this.arrayObserver = void 0;\n        this.valueObserver = void 0;\n        this.persistentFlags = flags & 805306383 /* targetObserverFlags */;\n    }\n    getValue() {\n        return this.currentValue;\n    }\n    setValue(newValue, flags) {\n        this.currentValue = newValue;\n        this.hasChanges = newValue !== this.oldValue;\n        if ((flags & 4096 /* fromBind */) > 0 || this.persistentFlags === 268435456 /* noTargetObserverQueue */) {\n            this.flushChanges(flags);\n        }\n        else if (this.persistentFlags !== 536870912 /* persistentTargetObserverQueue */ && this.task === null) {\n            this.task = this.scheduler.queueRenderTask(() => {\n                this.flushChanges(flags);\n                this.task = null;\n            });\n        }\n    }\n    flushChanges(flags) {\n        if (this.hasChanges) {\n            this.hasChanges = false;\n            const currentValue = this.currentValue;\n            this.oldValue = currentValue;\n            if (this.valueObserver === void 0) {\n                if (this.obj.$observers !== void 0) {\n                    if (this.obj.$observers.model !== void 0) {\n                        this.valueObserver = this.obj.$observers.model;\n                    }\n                    else if (this.obj.$observers.value !== void 0) {\n                        this.valueObserver = this.obj.$observers.value;\n                    }\n                }\n                if (this.valueObserver !== void 0) {\n                    this.valueObserver.subscribe(this);\n                }\n            }\n            if (this.arrayObserver !== void 0) {\n                this.arrayObserver.unsubscribeFromCollection(this);\n                this.arrayObserver = void 0;\n            }\n            if (this.obj.type === 'checkbox' && Array.isArray(currentValue)) {\n                this.arrayObserver = this.observerLocator.getArrayObserver(flags, currentValue);\n                this.arrayObserver.subscribeToCollection(this);\n            }\n            this.synchronizeElement();\n        }\n    }\n    handleCollectionChange(indexMap, flags) {\n        const { currentValue, oldValue } = this;\n        if ((flags & 4096 /* fromBind */) > 0 || this.persistentFlags === 268435456 /* noTargetObserverQueue */) {\n            this.oldValue = currentValue;\n            this.synchronizeElement();\n        }\n        else {\n            this.hasChanges = true;\n        }\n        if (this.persistentFlags !== 536870912 /* persistentTargetObserverQueue */ && this.task === null) {\n            this.task = this.scheduler.queueRenderTask(() => {\n                this.flushChanges(flags);\n                this.task = null;\n            });\n        }\n        this.callSubscribers(currentValue, oldValue, flags);\n    }\n    handleChange(newValue, previousValue, flags) {\n        if ((flags & 4096 /* fromBind */) > 0 || this.persistentFlags === 268435456 /* noTargetObserverQueue */) {\n            this.synchronizeElement();\n        }\n        else {\n            this.hasChanges = true;\n        }\n        if (this.persistentFlags !== 536870912 /* persistentTargetObserverQueue */ && this.task === null) {\n            this.task = this.scheduler.queueRenderTask(() => this.flushChanges(flags));\n        }\n        this.callSubscribers(newValue, previousValue, flags);\n    }\n    synchronizeElement() {\n        const currentValue = this.currentValue;\n        const obj = this.obj;\n        const elementValue = Object.prototype.hasOwnProperty.call(obj, 'model') ? obj.model : obj.value;\n        const isRadio = obj.type === 'radio';\n        const matcher = obj.matcher !== void 0 ? obj.matcher : defaultMatcher;\n        if (isRadio) {\n            obj.checked = !!matcher(currentValue, elementValue);\n        }\n        else if (currentValue === true) {\n            obj.checked = true;\n        }\n        else if (Array.isArray(currentValue)) {\n            obj.checked = currentValue.findIndex(item => !!matcher(item, elementValue)) !== -1;\n        }\n        else {\n            obj.checked = false;\n        }\n    }\n    handleEvent() {\n        this.oldValue = this.currentValue;\n        let { currentValue } = this;\n        const { obj } = this;\n        const elementValue = Object.prototype.hasOwnProperty.call(obj, 'model') ? obj.model : obj.value;\n        let index;\n        const matcher = obj.matcher !== void 0 ? obj.matcher : defaultMatcher;\n        if (obj.type === 'checkbox') {\n            if (Array.isArray(currentValue)) {\n                index = currentValue.findIndex(item => !!matcher(item, elementValue));\n                if (obj.checked && index === -1) {\n                    currentValue.push(elementValue);\n                }\n                else if (!obj.checked && index !== -1) {\n                    currentValue.splice(index, 1);\n                }\n                // when existing currentValue is array, do not invoke callback as only the array obj has changed\n                return;\n            }\n            currentValue = obj.checked;\n        }\n        else if (obj.checked) {\n            currentValue = elementValue;\n        }\n        else {\n            return;\n        }\n        this.currentValue = currentValue;\n        this.callSubscribers(this.currentValue, this.oldValue, 131072 /* fromDOMEvent */ | 524288 /* allowPublishRoundtrip */);\n    }\n    bind(flags) {\n        if (this.persistentFlags === 536870912 /* persistentTargetObserverQueue */) {\n            if (this.task !== null) {\n                this.task.cancel();\n            }\n            this.task = this.scheduler.queueRenderTask(() => this.flushChanges(flags), { persistent: true });\n        }\n        this.currentValue = this.obj.checked;\n    }\n    unbind(flags) {\n        if (this.arrayObserver !== void 0) {\n            this.arrayObserver.unsubscribeFromCollection(this);\n            this.arrayObserver = void 0;\n        }\n        if (this.valueObserver !== void 0) {\n            this.valueObserver.unsubscribe(this);\n        }\n        if (this.task !== null) {\n            this.task.cancel();\n            this.task = null;\n        }\n    }\n    subscribe(subscriber) {\n        if (!this.hasSubscribers()) {\n            this.handler.subscribe(this.obj, this);\n        }\n        this.addSubscriber(subscriber);\n    }\n    unsubscribe(subscriber) {\n        this.removeSubscriber(subscriber);\n        if (!this.hasSubscribers()) {\n            this.handler.dispose();\n        }\n    }\n};\nCheckedObserver = __decorate([\n    subscriberCollection(),\n    __metadata(\"design:paramtypes\", [Object, Number, Object, Object, Object])\n], CheckedObserver);\nexport { CheckedObserver };\n//# sourceMappingURL=checked-observer.js.map","import { PLATFORM } from '@aurelia/kernel';\nexport class ClassAttributeAccessor {\n    constructor(scheduler, flags, obj) {\n        this.scheduler = scheduler;\n        this.currentValue = '';\n        this.oldValue = '';\n        this.doNotCache = true;\n        this.nameIndex = {};\n        this.version = 0;\n        this.hasChanges = false;\n        this.isActive = false;\n        this.task = null;\n        this.obj = obj;\n        this.persistentFlags = flags & 805306383 /* targetObserverFlags */;\n    }\n    getValue() {\n        return this.currentValue;\n    }\n    setValue(newValue, flags) {\n        this.currentValue = newValue;\n        this.hasChanges = newValue !== this.oldValue;\n        if ((flags & 4096 /* fromBind */) > 0 || this.persistentFlags === 268435456 /* noTargetObserverQueue */) {\n            this.flushChanges(flags);\n        }\n        else if (this.persistentFlags !== 536870912 /* persistentTargetObserverQueue */ && this.task === null) {\n            this.task = this.scheduler.queueRenderTask(() => {\n                this.flushChanges(flags);\n                this.task = null;\n            });\n        }\n    }\n    flushChanges(flags) {\n        if (this.hasChanges) {\n            this.hasChanges = false;\n            const { currentValue, nameIndex } = this;\n            let { version } = this;\n            this.oldValue = currentValue;\n            const classesToAdd = getClassesToAdd(currentValue);\n            // Get strings split on a space not including empties\n            if (classesToAdd.length > 0) {\n                this.addClassesAndUpdateIndex(classesToAdd);\n            }\n            this.version += 1;\n            // First call to setValue?  We're done.\n            if (version === 0) {\n                return;\n            }\n            // Remove classes from previous version.\n            version -= 1;\n            for (const name in nameIndex) {\n                if (!Object.prototype.hasOwnProperty.call(nameIndex, name) || nameIndex[name] !== version) {\n                    continue;\n                }\n                // TODO: this has the side-effect that classes already present which are added again,\n                // will be removed if they're not present in the next update.\n                // Better would be do have some configurability for this behavior, allowing the user to\n                // decide whether initial classes always need to be kept, always removed, or something in between\n                this.obj.classList.remove(name);\n            }\n        }\n    }\n    bind(flags) {\n        if (this.persistentFlags === 536870912 /* persistentTargetObserverQueue */) {\n            if (this.task !== null) {\n                this.task.cancel();\n            }\n            this.task = this.scheduler.queueRenderTask(() => this.flushChanges(flags), { persistent: true });\n        }\n    }\n    unbind(flags) {\n        if (this.task !== null) {\n            this.task.cancel();\n            this.task = null;\n        }\n    }\n    addClassesAndUpdateIndex(classes) {\n        const node = this.obj;\n        for (let i = 0, ii = classes.length; i < ii; i++) {\n            const className = classes[i];\n            if (className.length === 0) {\n                continue;\n            }\n            this.nameIndex[className] = this.version;\n            node.classList.add(className);\n        }\n    }\n}\nexport function getClassesToAdd(object) {\n    function splitClassString(classString) {\n        const matches = classString.match(/\\S+/g);\n        if (matches === null) {\n            return PLATFORM.emptyArray;\n        }\n        return matches;\n    }\n    if (typeof object === 'string') {\n        return splitClassString(object);\n    }\n    if (object instanceof Array) {\n        const len = object.length;\n        if (len > 0) {\n            const classes = [];\n            for (let i = 0; i < len; ++i) {\n                classes.push(...getClassesToAdd(object[i]));\n            }\n            return classes;\n        }\n        else {\n            return PLATFORM.emptyArray;\n        }\n    }\n    else if (object instanceof Object) {\n        const classes = [];\n        for (const property in object) {\n            // Let non typical values also evaluate true so disable bool check\n            // eslint-disable-next-line @typescript-eslint/strict-boolean-expressions, no-extra-boolean-cast\n            if (Boolean(object[property])) {\n                // We must do this in case object property has a space in the name which results in two classes\n                if (property.includes(' ')) {\n                    classes.push(...splitClassString(property));\n                }\n                else {\n                    classes.push(property);\n                }\n            }\n        }\n        return classes;\n    }\n    return PLATFORM.emptyArray;\n}\n//# sourceMappingURL=class-attribute-accessor.js.map","/**\n * Attribute accessor for HTML elements.\n * Note that Aurelia works with properties, so in all case it will try to assign to property instead of attributes.\n * Unless the property falls into a special set, then it will use attribute for it.\n *\n * @see ElementPropertyAccessor\n */\nexport class DataAttributeAccessor {\n    constructor(scheduler, flags, obj, propertyKey) {\n        this.scheduler = scheduler;\n        this.propertyKey = propertyKey;\n        this.currentValue = null;\n        this.oldValue = null;\n        this.hasChanges = false;\n        this.task = null;\n        this.obj = obj;\n        this.persistentFlags = flags & 805306383 /* targetObserverFlags */;\n    }\n    getValue() {\n        return this.currentValue;\n    }\n    setValue(newValue, flags) {\n        this.currentValue = newValue;\n        this.hasChanges = newValue !== this.oldValue;\n        if ((flags & 4096 /* fromBind */) > 0 || this.persistentFlags === 268435456 /* noTargetObserverQueue */) {\n            this.flushChanges(flags);\n        }\n        else if (this.persistentFlags !== 536870912 /* persistentTargetObserverQueue */ && this.task === null) {\n            this.task = this.scheduler.queueRenderTask(() => {\n                this.flushChanges(flags);\n                this.task = null;\n            });\n        }\n    }\n    flushChanges(flags) {\n        if (this.hasChanges) {\n            this.hasChanges = false;\n            const { currentValue } = this;\n            this.oldValue = currentValue;\n            if (currentValue == void 0) {\n                this.obj.removeAttribute(this.propertyKey);\n            }\n            else {\n                this.obj.setAttribute(this.propertyKey, currentValue);\n            }\n        }\n    }\n    bind(flags) {\n        if (this.persistentFlags === 536870912 /* persistentTargetObserverQueue */) {\n            if (this.task !== null) {\n                this.task.cancel();\n            }\n            this.task = this.scheduler.queueRenderTask(() => this.flushChanges(flags), { persistent: true });\n        }\n        this.currentValue = this.oldValue = this.obj.getAttribute(this.propertyKey);\n    }\n    unbind(flags) {\n        if (this.task !== null) {\n            this.task.cancel();\n            this.task = null;\n        }\n    }\n}\n//# sourceMappingURL=data-attribute-accessor.js.map","/**\n * Property accessor for HTML Elements.\n * Note that Aurelia works with properties, so in all case it will try to assign to property instead of attributes.\n * Unless the property falls into a special set, then it will use attribute for it.\n *\n * @see DataAttributeAccessor\n */\nexport class ElementPropertyAccessor {\n    constructor(scheduler, flags, obj, propertyKey) {\n        this.scheduler = scheduler;\n        this.obj = obj;\n        this.propertyKey = propertyKey;\n        this.currentValue = void 0;\n        this.oldValue = void 0;\n        this.hasChanges = false;\n        this.task = null;\n        this.persistentFlags = flags & 805306383 /* targetObserverFlags */;\n    }\n    getValue() {\n        return this.currentValue;\n    }\n    setValue(newValue, flags) {\n        this.currentValue = newValue;\n        this.hasChanges = newValue !== this.oldValue;\n        if ((flags & 4096 /* fromBind */) > 0 || this.persistentFlags === 268435456 /* noTargetObserverQueue */) {\n            this.flushChanges(flags);\n        }\n        else if (this.persistentFlags !== 536870912 /* persistentTargetObserverQueue */ && this.task === null) {\n            this.task = this.scheduler.queueRenderTask(() => {\n                this.flushChanges(flags);\n                this.task = null;\n            });\n        }\n    }\n    flushChanges(flags) {\n        if (this.hasChanges) {\n            this.hasChanges = false;\n            const { currentValue } = this;\n            this.oldValue = currentValue;\n            this.obj[this.propertyKey] = currentValue;\n        }\n    }\n    bind(flags) {\n        if (this.persistentFlags === 536870912 /* persistentTargetObserverQueue */) {\n            if (this.task !== null) {\n                this.task.cancel();\n            }\n            this.task = this.scheduler.queueRenderTask(() => this.flushChanges(flags), { persistent: true });\n        }\n        this.currentValue = this.oldValue = this.obj[this.propertyKey];\n    }\n    unbind(flags) {\n        if (this.task !== null) {\n            this.task.cancel();\n            this.task = null;\n        }\n    }\n}\n//# sourceMappingURL=element-property-accessor.js.map","import { DI } from '@aurelia/kernel';\nimport { DelegationStrategy } from '@aurelia/runtime';\n// Note: path and deepPath are designed to handle v0 and v1 shadow dom specs respectively\n/** @internal */\nexport function findOriginalEventTarget(event) {\n    return (event.composedPath && event.composedPath()[0]) || (event.deepPath && event.deepPath()[0]) || (event.path && event.path[0]) || event.target;\n}\nfunction stopPropagation() {\n    this.standardStopPropagation();\n    this.propagationStopped = true;\n}\nfunction handleCapturedEvent(event) {\n    event.propagationStopped = false;\n    let target = findOriginalEventTarget(event);\n    const orderedCallbacks = [];\n    /**\n     * During capturing phase, event 'bubbles' down from parent. Needs to reorder callback from root down to target\n     */\n    while (target) {\n        if (target.capturedCallbacks) {\n            const callback = target.capturedCallbacks[event.type];\n            if (callback) {\n                if (event.stopPropagation !== stopPropagation) {\n                    event.standardStopPropagation = event.stopPropagation;\n                    event.stopPropagation = stopPropagation;\n                }\n                orderedCallbacks.push(callback);\n            }\n        }\n        target = target.parentNode;\n    }\n    for (let i = orderedCallbacks.length - 1; i >= 0 && !event.propagationStopped; i--) {\n        const orderedCallback = orderedCallbacks[i];\n        if ('handleEvent' in orderedCallback) {\n            orderedCallback.handleEvent(event);\n        }\n        else {\n            orderedCallback(event);\n        }\n    }\n}\nfunction handleDelegatedEvent(event) {\n    event.propagationStopped = false;\n    let target = findOriginalEventTarget(event);\n    while (target && !event.propagationStopped) {\n        if (target.delegatedCallbacks) {\n            const callback = target.delegatedCallbacks[event.type];\n            if (callback) {\n                if (event.stopPropagation !== stopPropagation) {\n                    event.standardStopPropagation = event.stopPropagation;\n                    event.stopPropagation = stopPropagation;\n                }\n                if ('handleEvent' in callback) {\n                    callback.handleEvent(event);\n                }\n                else {\n                    callback(event);\n                }\n            }\n        }\n        target = target.parentNode;\n    }\n}\nexport class ListenerTracker {\n    constructor(dom, eventName, listener, capture) {\n        this.dom = dom;\n        this.eventName = eventName;\n        this.listener = listener;\n        this.capture = capture;\n        this.count = 0;\n    }\n    increment() {\n        this.count++;\n        if (this.count === 1) {\n            this.dom.addEventListener(this.eventName, this.listener, null, this.capture);\n        }\n    }\n    decrement() {\n        this.count--;\n        if (this.count === 0) {\n            this.dom.removeEventListener(this.eventName, this.listener, null, this.capture);\n        }\n    }\n    /* @internal */\n    dispose() {\n        if (this.count > 0) {\n            this.count = 0;\n            this.dom.removeEventListener(this.eventName, this.listener, null, this.capture);\n        }\n    }\n}\n/**\n * Enable dispose() pattern for `delegate` & `capture` commands\n */\nexport class DelegateOrCaptureSubscription {\n    constructor(entry, lookup, targetEvent, callback) {\n        this.entry = entry;\n        this.lookup = lookup;\n        this.targetEvent = targetEvent;\n        lookup[targetEvent] = callback;\n    }\n    dispose() {\n        this.entry.decrement();\n        this.lookup[this.targetEvent] = null;\n    }\n}\n/**\n * Enable dispose() pattern for addEventListener for `trigger`\n */\nexport class TriggerSubscription {\n    constructor(dom, target, targetEvent, callback) {\n        this.dom = dom;\n        this.target = target;\n        this.targetEvent = targetEvent;\n        this.callback = callback;\n        dom.addEventListener(targetEvent, callback, target);\n    }\n    dispose() {\n        this.dom.removeEventListener(this.targetEvent, this.callback, this.target);\n    }\n}\nexport class EventSubscriber {\n    constructor(dom, events) {\n        this.dom = dom;\n        this.events = events;\n        this.target = null;\n        this.handler = null;\n    }\n    subscribe(node, callbackOrListener) {\n        this.target = node;\n        this.handler = callbackOrListener;\n        const add = this.dom.addEventListener;\n        const events = this.events;\n        for (let i = 0, ii = events.length; ii > i; ++i) {\n            add(events[i], callbackOrListener, node);\n        }\n    }\n    dispose() {\n        const node = this.target;\n        const callbackOrListener = this.handler;\n        const events = this.events;\n        const dom = this.dom;\n        for (let i = 0, ii = events.length; ii > i; ++i) {\n            dom.removeEventListener(events[i], callbackOrListener, node);\n        }\n        this.target = this.handler = null;\n    }\n}\nexport const IEventManager = DI.createInterface('IEventManager').withDefault(x => x.singleton(EventManager));\n/** @internal */\nexport class EventManager {\n    constructor() {\n        this.delegatedHandlers = {};\n        this.capturedHandlers = {};\n    }\n    addEventListener(dom, target, targetEvent, callbackOrListener, strategy) {\n        let delegatedHandlers;\n        let capturedHandlers;\n        let handlerEntry;\n        if (strategy === DelegationStrategy.bubbling) {\n            delegatedHandlers = this.delegatedHandlers;\n            handlerEntry = delegatedHandlers[targetEvent] || (delegatedHandlers[targetEvent] = new ListenerTracker(dom, targetEvent, handleDelegatedEvent, false));\n            handlerEntry.increment();\n            const delegatedCallbacks = target.delegatedCallbacks || (target.delegatedCallbacks = {});\n            return new DelegateOrCaptureSubscription(handlerEntry, delegatedCallbacks, targetEvent, callbackOrListener);\n        }\n        if (strategy === DelegationStrategy.capturing) {\n            capturedHandlers = this.capturedHandlers;\n            handlerEntry = capturedHandlers[targetEvent] || (capturedHandlers[targetEvent] = new ListenerTracker(dom, targetEvent, handleCapturedEvent, true));\n            handlerEntry.increment();\n            const capturedCallbacks = target.capturedCallbacks || (target.capturedCallbacks = {});\n            return new DelegateOrCaptureSubscription(handlerEntry, capturedCallbacks, targetEvent, callbackOrListener);\n        }\n        return new TriggerSubscription(dom, target, targetEvent, callbackOrListener);\n    }\n    dispose() {\n        let key;\n        const { delegatedHandlers, capturedHandlers } = this;\n        for (key in delegatedHandlers) {\n            delegatedHandlers[key].dispose();\n        }\n        for (key in capturedHandlers) {\n            capturedHandlers[key].dispose();\n        }\n    }\n}\n//# sourceMappingURL=event-manager.js.map","import { __decorate, __metadata } from \"tslib\";\nimport { IDOM, IObserverLocator, subscriberCollection, IScheduler, } from '@aurelia/runtime';\nimport { bound } from '@aurelia/kernel';\nconst childObserverOptions = {\n    childList: true,\n    subtree: true,\n    characterData: true\n};\nfunction defaultMatcher(a, b) {\n    return a === b;\n}\nlet SelectValueObserver = class SelectValueObserver {\n    constructor(scheduler, flags, observerLocator, dom, handler, obj) {\n        this.scheduler = scheduler;\n        this.observerLocator = observerLocator;\n        this.dom = dom;\n        this.handler = handler;\n        this.obj = obj;\n        this.currentValue = void 0;\n        this.oldValue = void 0;\n        this.hasChanges = false;\n        this.task = null;\n        this.arrayObserver = void 0;\n        this.nodeObserver = void 0;\n        this.persistentFlags = flags & 805306383 /* targetObserverFlags */;\n    }\n    getValue() {\n        return this.currentValue;\n    }\n    setValue(newValue, flags) {\n        this.currentValue = newValue;\n        this.hasChanges = newValue !== this.oldValue;\n        if ((flags & 4096 /* fromBind */) > 0 || this.persistentFlags === 268435456 /* noTargetObserverQueue */) {\n            this.flushChanges(flags);\n        }\n        else if (this.persistentFlags !== 536870912 /* persistentTargetObserverQueue */ && this.task === null) {\n            this.task = this.scheduler.queueRenderTask(() => {\n                this.flushChanges(flags);\n                this.task = null;\n            });\n        }\n    }\n    flushChanges(flags) {\n        if (this.hasChanges) {\n            this.hasChanges = false;\n            const { currentValue } = this;\n            this.oldValue = currentValue;\n            const isArray = Array.isArray(currentValue);\n            if (!isArray && currentValue != void 0 && this.obj.multiple) {\n                throw new Error('Only null or Array instances can be bound to a multi-select.');\n            }\n            if (this.arrayObserver) {\n                this.arrayObserver.unsubscribeFromCollection(this);\n                this.arrayObserver = void 0;\n            }\n            if (isArray) {\n                this.arrayObserver = this.observerLocator.getArrayObserver(flags, currentValue);\n                this.arrayObserver.subscribeToCollection(this);\n            }\n            this.synchronizeOptions();\n            this.notify(flags);\n        }\n    }\n    handleCollectionChange(indexMap, flags) {\n        if ((flags & 4096 /* fromBind */) > 0 || this.persistentFlags === 268435456 /* noTargetObserverQueue */) {\n            this.synchronizeOptions();\n        }\n        else {\n            this.hasChanges = true;\n        }\n        if (this.persistentFlags !== 536870912 /* persistentTargetObserverQueue */ && this.task === null) {\n            this.task = this.scheduler.queueRenderTask(() => {\n                this.flushChanges(flags);\n                this.task = null;\n            });\n        }\n        this.callSubscribers(this.currentValue, this.oldValue, flags);\n    }\n    handleChange(newValue, previousValue, flags) {\n        if ((flags & 4096 /* fromBind */) > 0 || this.persistentFlags === 268435456 /* noTargetObserverQueue */) {\n            this.synchronizeOptions();\n        }\n        else {\n            this.hasChanges = true;\n        }\n        if (this.persistentFlags !== 536870912 /* persistentTargetObserverQueue */ && this.task === null) {\n            this.task = this.scheduler.queueRenderTask(() => {\n                this.flushChanges(flags);\n                this.task = null;\n            });\n        }\n        this.callSubscribers(newValue, previousValue, flags);\n    }\n    notify(flags) {\n        if ((flags & 4096 /* fromBind */) > 0 || this.persistentFlags === 268435456 /* noTargetObserverQueue */) {\n            return;\n        }\n        const oldValue = this.oldValue;\n        const newValue = this.currentValue;\n        if (newValue === oldValue) {\n            return;\n        }\n        this.callSubscribers(newValue, oldValue, flags);\n    }\n    handleEvent() {\n        // \"from-view\" changes are always synchronous now, so immediately sync the value and notify subscribers\n        const shouldNotify = this.synchronizeValue();\n        if (shouldNotify) {\n            this.callSubscribers(this.currentValue, this.oldValue, 131072 /* fromDOMEvent */ | 524288 /* allowPublishRoundtrip */);\n        }\n    }\n    synchronizeOptions(indexMap) {\n        const { currentValue, obj } = this;\n        const isArray = Array.isArray(currentValue);\n        const matcher = obj.matcher !== void 0 ? obj.matcher : defaultMatcher;\n        const options = obj.options;\n        let i = options.length;\n        while (i-- > 0) {\n            const option = options[i];\n            const optionValue = Object.prototype.hasOwnProperty.call(option, 'model') ? option.model : option.value;\n            if (isArray) {\n                option.selected = currentValue.findIndex(item => !!matcher(optionValue, item)) !== -1;\n                continue;\n            }\n            option.selected = !!matcher(optionValue, currentValue);\n        }\n    }\n    synchronizeValue() {\n        // Spec for synchronizing value from `SelectObserver` to `<select/>`\n        // When synchronizing value to observed <select/> element, do the following steps:\n        // A. If `<select/>` is multiple\n        //    1. Check if current value, called `currentValue` is an array\n        //      a. If not an array, return true to signal value has changed\n        //      b. If is an array:\n        //        i. gather all current selected <option/>, in to array called `values`\n        //        ii. loop through the `currentValue` array and remove items that are nolonger selected based on matcher\n        //        iii. loop through the `values` array and add items that are selected based on matcher\n        //        iv. Return false to signal value hasn't changed\n        // B. If the select is single\n        //    1. Let `value` equal the first selected option, if no option selected, then `value` is `null`\n        //    2. assign `this.currentValue` to `this.oldValue`\n        //    3. assign `value` to `this.currentValue`\n        //    4. return `true` to signal value has changed\n        const obj = this.obj;\n        const options = obj.options;\n        const len = options.length;\n        const currentValue = this.currentValue;\n        let i = 0;\n        if (obj.multiple) {\n            // A.\n            if (!Array.isArray(currentValue)) {\n                // A.1.a\n                return true;\n            }\n            // A.1.b\n            // multi select\n            let option;\n            const matcher = obj.matcher || defaultMatcher;\n            // A.1.b.i\n            const values = [];\n            while (i < len) {\n                option = options[i];\n                if (option.selected) {\n                    values.push(Object.prototype.hasOwnProperty.call(option, 'model')\n                        ? option.model\n                        : option.value);\n                }\n                ++i;\n            }\n            // A.1.b.ii\n            i = 0;\n            while (i < currentValue.length) {\n                const a = currentValue[i];\n                // Todo: remove arrow fn\n                if (values.findIndex(b => !!matcher(a, b)) === -1) {\n                    currentValue.splice(i, 1);\n                }\n                else {\n                    ++i;\n                }\n            }\n            // A.1.b.iii\n            i = 0;\n            while (i < values.length) {\n                const a = values[i];\n                // Todo: remove arrow fn\n                if (currentValue.findIndex(b => !!matcher(a, b)) === -1) {\n                    currentValue.push(a);\n                }\n                ++i;\n            }\n            // A.1.b.iv\n            return false;\n        }\n        // B. single select\n        // B.1\n        let value = null;\n        while (i < len) {\n            const option = options[i];\n            if (option.selected) {\n                value = Object.prototype.hasOwnProperty.call(option, 'model')\n                    ? option.model\n                    : option.value;\n                break;\n            }\n            ++i;\n        }\n        // B.2\n        this.oldValue = this.currentValue;\n        // B.3\n        this.currentValue = value;\n        // B.4\n        return true;\n    }\n    bind(flags) {\n        this.nodeObserver = this.dom.createNodeObserver(this.obj, this.handleNodeChange, childObserverOptions);\n        if (this.persistentFlags === 536870912 /* persistentTargetObserverQueue */) {\n            if (this.task !== null) {\n                this.task.cancel();\n            }\n            this.task = this.scheduler.queueRenderTask(() => this.flushChanges(flags), { persistent: true });\n        }\n    }\n    unbind(flags) {\n        this.nodeObserver.disconnect();\n        this.nodeObserver = null;\n        if (this.task !== null) {\n            this.task.cancel();\n            this.task = null;\n        }\n        if (this.arrayObserver) {\n            this.arrayObserver.unsubscribeFromCollection(this);\n            this.arrayObserver = null;\n        }\n    }\n    handleNodeChange() {\n        this.synchronizeOptions();\n        const shouldNotify = this.synchronizeValue();\n        if (shouldNotify) {\n            this.notify(131072 /* fromDOMEvent */);\n        }\n    }\n    subscribe(subscriber) {\n        if (!this.hasSubscribers()) {\n            this.handler.subscribe(this.obj, this);\n        }\n        this.addSubscriber(subscriber);\n    }\n    unsubscribe(subscriber) {\n        this.removeSubscriber(subscriber);\n        if (!this.hasSubscribers()) {\n            this.handler.dispose();\n        }\n    }\n};\n__decorate([\n    bound,\n    __metadata(\"design:type\", Function),\n    __metadata(\"design:paramtypes\", []),\n    __metadata(\"design:returntype\", void 0)\n], SelectValueObserver.prototype, \"handleNodeChange\", null);\nSelectValueObserver = __decorate([\n    subscriberCollection(),\n    __metadata(\"design:paramtypes\", [Object, Number, Object, Object, Object, Object])\n], SelectValueObserver);\nexport { SelectValueObserver };\n//# sourceMappingURL=select-value-observer.js.map","import { PLATFORM, kebabCase } from '@aurelia/kernel';\nexport class StyleAttributeAccessor {\n    constructor(scheduler, flags, obj) {\n        this.scheduler = scheduler;\n        this.currentValue = '';\n        this.oldValue = '';\n        this.styles = {};\n        this.version = 0;\n        this.hasChanges = false;\n        this.task = null;\n        this.obj = obj;\n        this.persistentFlags = flags & 805306383 /* targetObserverFlags */;\n    }\n    getValue() {\n        return this.obj.style.cssText;\n    }\n    setValue(newValue, flags) {\n        this.currentValue = newValue;\n        this.hasChanges = newValue !== this.oldValue;\n        if ((flags & 4096 /* fromBind */) > 0 || this.persistentFlags === 268435456 /* noTargetObserverQueue */) {\n            this.flushChanges(flags);\n        }\n        else if (this.persistentFlags !== 536870912 /* persistentTargetObserverQueue */ && this.task === null) {\n            this.task = this.scheduler.queueRenderTask(() => {\n                this.flushChanges(flags);\n                this.task = null;\n            });\n        }\n    }\n    getStyleTuplesFromString(currentValue) {\n        const styleTuples = [];\n        const rx = /\\s*([\\w-]+)\\s*:\\s*((?:(?:[\\w-]+\\(\\s*(?:\"(?:\\\\\"|[^\"])*\"|'(?:\\\\'|[^'])*'|[\\w-]+\\(\\s*(?:[^\"](?:\\\\\"|[^\"])*\"|'(?:\\\\'|[^'])*'|[^)]*)\\),?|[^)]*)\\),?|\"(?:\\\\\"|[^\"])*\"|'(?:\\\\'|[^'])*'|[^;]*),?\\s*)+);?/g;\n        let pair;\n        let name;\n        while ((pair = rx.exec(currentValue)) !== null) {\n            name = pair[1];\n            if (name.length === 0) {\n                continue;\n            }\n            styleTuples.push([name, pair[2]]);\n        }\n        return styleTuples;\n    }\n    getStyleTuplesFromObject(currentValue) {\n        let value;\n        const styles = [];\n        for (const property in currentValue) {\n            value = currentValue[property];\n            if (value == null) {\n                continue;\n            }\n            if (typeof value === 'string') {\n                styles.push([kebabCase(property), value]);\n                continue;\n            }\n            styles.push(...this.getStyleTuples(value));\n        }\n        return styles;\n    }\n    getStyleTuplesFromArray(currentValue) {\n        const len = currentValue.length;\n        if (len > 0) {\n            const styles = [];\n            for (let i = 0; i < len; ++i) {\n                styles.push(...this.getStyleTuples(currentValue[i]));\n            }\n            return styles;\n        }\n        return PLATFORM.emptyArray;\n    }\n    getStyleTuples(currentValue) {\n        if (typeof currentValue === 'string') {\n            return this.getStyleTuplesFromString(currentValue);\n        }\n        if (currentValue instanceof Array) {\n            return this.getStyleTuplesFromArray(currentValue);\n        }\n        if (currentValue instanceof Object) {\n            return this.getStyleTuplesFromObject(currentValue);\n        }\n        return PLATFORM.emptyArray;\n    }\n    flushChanges(flags) {\n        if (this.hasChanges) {\n            this.hasChanges = false;\n            const { currentValue } = this;\n            this.oldValue = currentValue;\n            const styles = this.styles;\n            let style;\n            let version = this.version;\n            const styleTuples = this.getStyleTuples(currentValue);\n            let tuple;\n            let name;\n            let value;\n            const len = styleTuples.length;\n            for (let i = 0; i < len; ++i) {\n                tuple = styleTuples[i];\n                name = tuple[0];\n                value = tuple[1];\n                this.setProperty(name, value);\n                styles[name] = version;\n            }\n            this.styles = styles;\n            this.version += 1;\n            if (version === 0) {\n                return;\n            }\n            version -= 1;\n            for (style in styles) {\n                if (!Object.prototype.hasOwnProperty.call(styles, style) || styles[style] !== version) {\n                    continue;\n                }\n                this.obj.style.removeProperty(style);\n            }\n        }\n    }\n    setProperty(style, value) {\n        let priority = '';\n        if (value != null && typeof value.indexOf === 'function' && value.includes('!important')) {\n            priority = 'important';\n            value = value.replace('!important', '');\n        }\n        this.obj.style.setProperty(style, value, priority);\n    }\n    bind(flags) {\n        if (this.persistentFlags === 536870912 /* persistentTargetObserverQueue */) {\n            if (this.task !== null) {\n                this.task.cancel();\n            }\n            this.task = this.scheduler.queueRenderTask(() => this.flushChanges(flags), { persistent: true });\n        }\n        this.oldValue = this.currentValue = this.obj.style.cssText;\n    }\n    unbind(flags) {\n        if (this.task !== null) {\n            this.task.cancel();\n            this.task = null;\n        }\n    }\n}\n//# sourceMappingURL=style-attribute-accessor.js.map","import { DI } from '@aurelia/kernel';\nexport const ISVGAnalyzer = DI.createInterface('ISVGAnalyzer').withDefault(x => x.singleton(class {\n    isStandardSvgAttribute(node, attributeName) {\n        return false;\n    }\n}));\n//# sourceMappingURL=svg-analyzer.js.map","import { __decorate, __metadata } from \"tslib\";\nimport { subscriberCollection, IScheduler, } from '@aurelia/runtime';\n// TODO: handle file attribute properly again, etc\n/**\n * Observer for non-radio, non-checkbox input.\n */\nlet ValueAttributeObserver = class ValueAttributeObserver {\n    constructor(scheduler, flags, handler, obj, propertyKey) {\n        this.scheduler = scheduler;\n        this.handler = handler;\n        this.obj = obj;\n        this.propertyKey = propertyKey;\n        this.currentValue = '';\n        this.oldValue = '';\n        this.hasChanges = false;\n        this.task = null;\n        this.persistentFlags = flags & 805306383 /* targetObserverFlags */;\n    }\n    getValue() {\n        return this.currentValue;\n    }\n    setValue(newValue, flags) {\n        this.currentValue = newValue;\n        this.hasChanges = newValue !== this.oldValue;\n        if ((flags & 4096 /* fromBind */) > 0 || this.persistentFlags === 268435456 /* noTargetObserverQueue */) {\n            this.flushChanges(flags);\n        }\n        else if (this.persistentFlags !== 536870912 /* persistentTargetObserverQueue */ && this.task === null) {\n            this.task = this.scheduler.queueRenderTask(() => {\n                this.flushChanges(flags);\n                this.task = null;\n            });\n        }\n    }\n    flushChanges(flags) {\n        if (this.hasChanges) {\n            this.hasChanges = false;\n            const { currentValue, oldValue } = this;\n            this.oldValue = currentValue;\n            if (currentValue == void 0) {\n                this.obj[this.propertyKey] = '';\n            }\n            else {\n                this.obj[this.propertyKey] = currentValue;\n            }\n            if ((flags & 4096 /* fromBind */) === 0) {\n                this.callSubscribers(currentValue, oldValue, flags);\n            }\n        }\n    }\n    handleEvent() {\n        const oldValue = this.oldValue = this.currentValue;\n        const currentValue = this.currentValue = this.obj[this.propertyKey];\n        if (oldValue !== currentValue) {\n            this.oldValue = currentValue;\n            this.callSubscribers(currentValue, oldValue, 131072 /* fromDOMEvent */ | 524288 /* allowPublishRoundtrip */);\n        }\n    }\n    subscribe(subscriber) {\n        if (!this.hasSubscribers()) {\n            this.handler.subscribe(this.obj, this);\n            this.currentValue = this.oldValue = this.obj[this.propertyKey];\n        }\n        this.addSubscriber(subscriber);\n    }\n    unsubscribe(subscriber) {\n        this.removeSubscriber(subscriber);\n        if (!this.hasSubscribers()) {\n            this.handler.dispose();\n        }\n    }\n    bind(flags) {\n        if (this.persistentFlags === 536870912 /* persistentTargetObserverQueue */) {\n            if (this.task !== null) {\n                this.task.cancel();\n            }\n            this.task = this.scheduler.queueRenderTask(() => this.flushChanges(flags), { persistent: true });\n        }\n    }\n    unbind(flags) {\n        if (this.task !== null) {\n            this.task.cancel();\n            this.task = null;\n        }\n    }\n};\nValueAttributeObserver = __decorate([\n    subscriberCollection(),\n    __metadata(\"design:paramtypes\", [Object, Number, Object, Object, String])\n], ValueAttributeObserver);\nexport { ValueAttributeObserver };\n//# sourceMappingURL=value-attribute-observer.js.map","import { __decorate, __metadata, __param } from \"tslib\";\nimport { Registration } from '@aurelia/kernel';\nimport { IDOM, ITargetAccessorLocator, ITargetObserverLocator, SetterObserver } from '@aurelia/runtime';\nimport { AttributeNSAccessor } from './attribute-ns-accessor';\nimport { CheckedObserver } from './checked-observer';\nimport { ClassAttributeAccessor } from './class-attribute-accessor';\nimport { DataAttributeAccessor } from './data-attribute-accessor';\nimport { ElementPropertyAccessor } from './element-property-accessor';\nimport { EventSubscriber } from './event-manager';\nimport { SelectValueObserver } from './select-value-observer';\nimport { StyleAttributeAccessor } from './style-attribute-accessor';\nimport { ISVGAnalyzer } from './svg-analyzer';\nimport { ValueAttributeObserver } from './value-attribute-observer';\n// https://infra.spec.whatwg.org/#namespaces\nconst htmlNS = 'http://www.w3.org/1999/xhtml';\nconst mathmlNS = 'http://www.w3.org/1998/Math/MathML';\nconst svgNS = 'http://www.w3.org/2000/svg';\nconst xlinkNS = 'http://www.w3.org/1999/xlink';\nconst xmlNS = 'http://www.w3.org/XML/1998/namespace';\nconst xmlnsNS = 'http://www.w3.org/2000/xmlns/';\n// https://html.spec.whatwg.org/multipage/syntax.html#attributes-2\nconst nsAttributes = Object.assign(Object.create(null), {\n    'xlink:actuate': ['actuate', xlinkNS],\n    'xlink:arcrole': ['arcrole', xlinkNS],\n    'xlink:href': ['href', xlinkNS],\n    'xlink:role': ['role', xlinkNS],\n    'xlink:show': ['show', xlinkNS],\n    'xlink:title': ['title', xlinkNS],\n    'xlink:type': ['type', xlinkNS],\n    'xml:lang': ['lang', xmlNS],\n    'xml:space': ['space', xmlNS],\n    'xmlns': ['xmlns', xmlnsNS],\n    'xmlns:xlink': ['xlink', xmlnsNS],\n});\nconst inputEvents = ['change', 'input'];\nconst selectEvents = ['change'];\nconst contentEvents = ['change', 'input', 'blur', 'keyup', 'paste'];\nconst scrollEvents = ['scroll'];\nconst overrideProps = Object.assign(Object.create(null), {\n    'class': true,\n    'style': true,\n    'css': true,\n    'checked': true,\n    'value': true,\n    'model': true,\n    'xlink:actuate': true,\n    'xlink:arcrole': true,\n    'xlink:href': true,\n    'xlink:role': true,\n    'xlink:show': true,\n    'xlink:title': true,\n    'xlink:type': true,\n    'xml:lang': true,\n    'xml:space': true,\n    'xmlns': true,\n    'xmlns:xlink': true,\n});\nlet TargetObserverLocator = class TargetObserverLocator {\n    constructor(dom, svgAnalyzer) {\n        this.dom = dom;\n        this.svgAnalyzer = svgAnalyzer;\n    }\n    static register(container) {\n        return Registration.singleton(ITargetObserverLocator, this).register(container);\n    }\n    getObserver(flags, scheduler, lifecycle, observerLocator, obj, propertyName) {\n        switch (propertyName) {\n            case 'checked':\n                return new CheckedObserver(scheduler, flags, observerLocator, new EventSubscriber(this.dom, inputEvents), obj);\n            case 'value':\n                if (obj.tagName === 'SELECT') {\n                    return new SelectValueObserver(scheduler, flags, observerLocator, this.dom, new EventSubscriber(this.dom, selectEvents), obj);\n                }\n                return new ValueAttributeObserver(scheduler, flags, new EventSubscriber(this.dom, inputEvents), obj, propertyName);\n            case 'files':\n                return new ValueAttributeObserver(scheduler, flags, new EventSubscriber(this.dom, inputEvents), obj, propertyName);\n            case 'textContent':\n            case 'innerHTML':\n                return new ValueAttributeObserver(scheduler, flags, new EventSubscriber(this.dom, contentEvents), obj, propertyName);\n            case 'scrollTop':\n            case 'scrollLeft':\n                return new ValueAttributeObserver(scheduler, flags, new EventSubscriber(this.dom, scrollEvents), obj, propertyName);\n            case 'class':\n                return new ClassAttributeAccessor(scheduler, flags, obj);\n            case 'style':\n            case 'css':\n                return new StyleAttributeAccessor(scheduler, flags, obj);\n            case 'model':\n                return new SetterObserver(lifecycle, flags, obj, propertyName);\n            case 'role':\n                return new DataAttributeAccessor(scheduler, flags, obj, propertyName);\n            default:\n                if (nsAttributes[propertyName] !== undefined) {\n                    const nsProps = nsAttributes[propertyName];\n                    return new AttributeNSAccessor(scheduler, flags, obj, nsProps[0], nsProps[1]);\n                }\n                if (isDataAttribute(obj, propertyName, this.svgAnalyzer)) {\n                    return new DataAttributeAccessor(scheduler, flags, obj, propertyName);\n                }\n        }\n        return null;\n    }\n    overridesAccessor(flags, obj, propertyName) {\n        return overrideProps[propertyName] === true;\n    }\n    handles(flags, obj) {\n        return this.dom.isNodeInstance(obj);\n    }\n};\nTargetObserverLocator = __decorate([\n    __param(0, IDOM),\n    __param(1, ISVGAnalyzer),\n    __metadata(\"design:paramtypes\", [Object, Object])\n], TargetObserverLocator);\nexport { TargetObserverLocator };\nlet TargetAccessorLocator = class TargetAccessorLocator {\n    constructor(dom, svgAnalyzer) {\n        this.dom = dom;\n        this.svgAnalyzer = svgAnalyzer;\n    }\n    static register(container) {\n        return Registration.singleton(ITargetAccessorLocator, this).register(container);\n    }\n    getAccessor(flags, scheduler, lifecycle, obj, propertyName) {\n        switch (propertyName) {\n            case 'textContent':\n                // note: this case is just an optimization (textContent is the most often used property)\n                return new ElementPropertyAccessor(scheduler, flags, obj, propertyName);\n            case 'class':\n                return new ClassAttributeAccessor(scheduler, flags, obj);\n            case 'style':\n            case 'css':\n                return new StyleAttributeAccessor(scheduler, flags, obj);\n            // TODO: there are (many) more situation where we want to default to DataAttributeAccessor,\n            // but for now stick to what vCurrent does\n            case 'src':\n            case 'href':\n            // https://html.spec.whatwg.org/multipage/dom.html#wai-aria\n            case 'role':\n                return new DataAttributeAccessor(scheduler, flags, obj, propertyName);\n            default:\n                if (nsAttributes[propertyName] !== undefined) {\n                    const nsProps = nsAttributes[propertyName];\n                    return new AttributeNSAccessor(scheduler, flags, obj, nsProps[0], nsProps[1]);\n                }\n                if (isDataAttribute(obj, propertyName, this.svgAnalyzer)) {\n                    return new DataAttributeAccessor(scheduler, flags, obj, propertyName);\n                }\n                return new ElementPropertyAccessor(scheduler, flags, obj, propertyName);\n        }\n    }\n    handles(flags, obj) {\n        return this.dom.isNodeInstance(obj);\n    }\n};\nTargetAccessorLocator = __decorate([\n    __param(0, IDOM),\n    __param(1, ISVGAnalyzer),\n    __metadata(\"design:paramtypes\", [Object, Object])\n], TargetAccessorLocator);\nexport { TargetAccessorLocator };\nconst IsDataAttribute = {};\nfunction isDataAttribute(obj, propertyName, svgAnalyzer) {\n    if (IsDataAttribute[propertyName] === true) {\n        return true;\n    }\n    const prefix = propertyName.slice(0, 5);\n    // https://html.spec.whatwg.org/multipage/dom.html#wai-aria\n    // https://html.spec.whatwg.org/multipage/dom.html#custom-data-attribute\n    return IsDataAttribute[propertyName] =\n        prefix === 'aria-' ||\n            prefix === 'data-' ||\n            svgAnalyzer.isStandardSvgAttribute(obj, propertyName);\n}\n//# sourceMappingURL=observer-locator.js.map","import { __decorate } from \"tslib\";\nimport { bindingBehavior, IScheduler } from '@aurelia/runtime';\nimport { DataAttributeAccessor } from '../../observation/data-attribute-accessor';\nlet AttrBindingBehavior = class AttrBindingBehavior {\n    bind(flags, scope, binding) {\n        binding.targetObserver = new DataAttributeAccessor(binding.locator.get(IScheduler), flags, binding.target, binding.targetProperty);\n    }\n    unbind(flags, scope, binding) {\n        return;\n    }\n};\nAttrBindingBehavior = __decorate([\n    bindingBehavior('attr')\n], AttrBindingBehavior);\nexport { AttrBindingBehavior };\n//# sourceMappingURL=attr.js.map","import { __decorate } from \"tslib\";\nimport { Reporter } from '@aurelia/kernel';\nimport { bindingBehavior } from '@aurelia/runtime';\nimport { findOriginalEventTarget } from '../../observation/event-manager';\n/** @internal */\nexport function handleSelfEvent(event) {\n    const target = findOriginalEventTarget(event);\n    if (this.target !== target) {\n        return;\n    }\n    return this.selfEventCallSource(event);\n}\nlet SelfBindingBehavior = class SelfBindingBehavior {\n    bind(flags, scope, binding) {\n        if (!binding.callSource || !binding.targetEvent) {\n            throw Reporter.error(8);\n        }\n        binding.selfEventCallSource = binding.callSource;\n        binding.callSource = handleSelfEvent;\n    }\n    unbind(flags, scope, binding) {\n        binding.callSource = binding.selfEventCallSource;\n        binding.selfEventCallSource = null;\n    }\n};\nSelfBindingBehavior = __decorate([\n    bindingBehavior('self')\n], SelfBindingBehavior);\nexport { SelfBindingBehavior };\n//# sourceMappingURL=self.js.map","import { __decorate, __metadata, __param } from \"tslib\";\nimport { Reporter } from '@aurelia/kernel';\nimport { BindingMode, IDOM, IObserverLocator, bindingBehavior } from '@aurelia/runtime';\nimport { EventSubscriber } from '../../observation/event-manager';\nlet UpdateTriggerBindingBehavior = class UpdateTriggerBindingBehavior {\n    constructor(observerLocator) {\n        this.observerLocator = observerLocator;\n    }\n    bind(flags, scope, binding, ...events) {\n        if (events.length === 0) {\n            throw Reporter.error(9);\n        }\n        if (binding.mode !== BindingMode.twoWay && binding.mode !== BindingMode.fromView) {\n            throw Reporter.error(10);\n        }\n        this.persistentFlags = flags & 2080374799 /* persistentBindingFlags */;\n        // ensure the binding's target observer has been set.\n        const targetObserver = this.observerLocator.getObserver(this.persistentFlags | flags, binding.target, binding.targetProperty);\n        if (!targetObserver.handler) {\n            throw Reporter.error(10);\n        }\n        binding.targetObserver = targetObserver;\n        // stash the original element subscribe function.\n        targetObserver.originalHandler = binding.targetObserver.handler;\n        // replace the element subscribe function with one that uses the correct events.\n        targetObserver.handler = new EventSubscriber(binding.locator.get(IDOM), events);\n    }\n    unbind(flags, scope, binding) {\n        // restore the state of the binding.\n        binding.targetObserver.handler.dispose();\n        binding.targetObserver.handler = binding.targetObserver.originalHandler;\n        binding.targetObserver.originalHandler = null;\n    }\n};\nUpdateTriggerBindingBehavior = __decorate([\n    bindingBehavior('updateTrigger'),\n    __param(0, IObserverLocator),\n    __metadata(\"design:paramtypes\", [Object])\n], UpdateTriggerBindingBehavior);\nexport { UpdateTriggerBindingBehavior };\n//# sourceMappingURL=update-trigger.js.map","import { DI, PLATFORM } from '@aurelia/kernel';\nexport const noopShadowDOMStyles = Object.freeze({\n    applyTo: PLATFORM.noop\n});\nexport const IShadowDOMStyles = DI.createInterface('IShadowDOMStyles').noDefault();\nexport const IShadowDOMGlobalStyles = DI.createInterface('IShadowDOMGlobalStyles')\n    .withDefault(x => x.instance(noopShadowDOMStyles));\nexport class AdoptedStyleSheetsStyles {\n    constructor(dom, localStyles, styleSheetCache, sharedStyles = null) {\n        this.sharedStyles = sharedStyles;\n        this.styleSheets = localStyles.map(x => {\n            let sheet;\n            if (x instanceof dom.CSSStyleSheet) {\n                sheet = x;\n            }\n            else {\n                sheet = styleSheetCache.get(x);\n                if (!sheet) {\n                    sheet = new dom.CSSStyleSheet();\n                    sheet.replaceSync(x);\n                    styleSheetCache.set(x, sheet);\n                }\n            }\n            return sheet;\n        });\n    }\n    static supported(dom) {\n        return 'adoptedStyleSheets' in dom.ShadowRoot.prototype;\n    }\n    applyTo(shadowRoot) {\n        if (this.sharedStyles !== null) {\n            this.sharedStyles.applyTo(shadowRoot);\n        }\n        // https://wicg.github.io/construct-stylesheets/\n        // https://developers.google.com/web/updates/2019/02/constructable-stylesheets\n        shadowRoot.adoptedStyleSheets = [\n            ...shadowRoot.adoptedStyleSheets,\n            ...this.styleSheets\n        ];\n    }\n}\nexport class StyleElementStyles {\n    constructor(dom, localStyles, sharedStyles = null) {\n        this.dom = dom;\n        this.localStyles = localStyles;\n        this.sharedStyles = sharedStyles;\n    }\n    applyTo(shadowRoot) {\n        const styles = this.localStyles;\n        const dom = this.dom;\n        for (let i = styles.length - 1; i > -1; --i) {\n            const element = dom.createElement('style');\n            element.innerHTML = styles[i];\n            shadowRoot.prepend(element);\n        }\n        if (this.sharedStyles !== null) {\n            this.sharedStyles.applyTo(shadowRoot);\n        }\n    }\n}\n//# sourceMappingURL=shadow-dom-styles.js.map","import { PLATFORM, Registration, Reporter, toArray, Metadata } from '@aurelia/kernel';\nimport { IProjectorLocator, CustomElement, } from '@aurelia/runtime';\nimport { IShadowDOMStyles, IShadowDOMGlobalStyles } from './styles/shadow-dom-styles';\nconst defaultShadowOptions = {\n    mode: 'open'\n};\nexport class HTMLProjectorLocator {\n    static register(container) {\n        return Registration.singleton(IProjectorLocator, this).register(container);\n    }\n    getElementProjector(dom, $component, host, def) {\n        if (def.shadowOptions || def.hasSlots) {\n            if (def.containerless) {\n                throw Reporter.error(21);\n            }\n            return new ShadowDOMProjector(dom, $component, host, def);\n        }\n        if (def.containerless) {\n            return new ContainerlessProjector(dom, $component, host);\n        }\n        return new HostProjector($component, host);\n    }\n}\nconst childObserverOptions = { childList: true };\n/** @internal */\nexport class ShadowDOMProjector {\n    constructor(dom, \n    // eslint-disable-next-line @typescript-eslint/prefer-readonly\n    $controller, host, definition) {\n        this.dom = dom;\n        this.$controller = $controller;\n        this.host = host;\n        let shadowOptions;\n        if (definition.shadowOptions instanceof Object &&\n            'mode' in definition.shadowOptions) {\n            shadowOptions = definition.shadowOptions;\n        }\n        else {\n            shadowOptions = defaultShadowOptions;\n        }\n        this.shadowRoot = host.attachShadow(shadowOptions);\n        Metadata.define(CustomElement.name, $controller, this.host);\n        Metadata.define(CustomElement.name, $controller, this.shadowRoot);\n    }\n    get children() {\n        return this.host.childNodes;\n    }\n    subscribeToChildrenChange(callback, options = childObserverOptions) {\n        // TODO: add a way to dispose/disconnect\n        this.dom.createNodeObserver(this.host, callback, options);\n    }\n    provideEncapsulationSource() {\n        return this.shadowRoot;\n    }\n    project(nodes) {\n        const context = this.$controller.context;\n        const styles = context.has(IShadowDOMStyles, false)\n            ? context.get(IShadowDOMStyles)\n            : context.get(IShadowDOMGlobalStyles);\n        styles.applyTo(this.shadowRoot);\n        nodes.appendTo(this.shadowRoot);\n    }\n    take(nodes) {\n        nodes.remove();\n        nodes.unlink();\n    }\n}\n/** @internal */\nexport class ContainerlessProjector {\n    constructor(dom, $controller, host) {\n        if (host.childNodes.length) {\n            this.childNodes = toArray(host.childNodes);\n        }\n        else {\n            this.childNodes = PLATFORM.emptyArray;\n        }\n        this.host = dom.convertToRenderLocation(host);\n        Metadata.define(CustomElement.name, $controller, this.host);\n    }\n    get children() {\n        return this.childNodes;\n    }\n    subscribeToChildrenChange(callback) {\n        // TODO: turn this into an error\n        // Containerless does not have a container node to observe children on.\n    }\n    provideEncapsulationSource() {\n        return this.host.getRootNode();\n    }\n    project(nodes) {\n        nodes.insertBefore(this.host);\n    }\n    take(nodes) {\n        nodes.remove();\n        nodes.unlink();\n    }\n}\n/** @internal */\nexport class HostProjector {\n    constructor($controller, host) {\n        this.host = host;\n        Metadata.define(CustomElement.name, $controller, host);\n    }\n    get children() {\n        return this.host.childNodes;\n    }\n    subscribeToChildrenChange(callback) {\n        // Do nothing since this scenario will never have children.\n    }\n    provideEncapsulationSource() {\n        return this.host.getRootNode();\n    }\n    project(nodes) {\n        nodes.appendTo(this.host);\n    }\n    take(nodes) {\n        nodes.remove();\n        nodes.unlink();\n    }\n}\n//# sourceMappingURL=projectors.js.map","import { PLATFORM, Registration, Reporter } from '@aurelia/kernel';\nimport { DOM, IDOM, INode, CustomElement } from '@aurelia/runtime';\nimport { ShadowDOMProjector } from './projectors';\nexport var NodeType;\n(function (NodeType) {\n    NodeType[NodeType[\"Element\"] = 1] = \"Element\";\n    NodeType[NodeType[\"Attr\"] = 2] = \"Attr\";\n    NodeType[NodeType[\"Text\"] = 3] = \"Text\";\n    NodeType[NodeType[\"CDATASection\"] = 4] = \"CDATASection\";\n    NodeType[NodeType[\"EntityReference\"] = 5] = \"EntityReference\";\n    NodeType[NodeType[\"Entity\"] = 6] = \"Entity\";\n    NodeType[NodeType[\"ProcessingInstruction\"] = 7] = \"ProcessingInstruction\";\n    NodeType[NodeType[\"Comment\"] = 8] = \"Comment\";\n    NodeType[NodeType[\"Document\"] = 9] = \"Document\";\n    NodeType[NodeType[\"DocumentType\"] = 10] = \"DocumentType\";\n    NodeType[NodeType[\"DocumentFragment\"] = 11] = \"DocumentFragment\";\n    NodeType[NodeType[\"Notation\"] = 12] = \"Notation\";\n})(NodeType || (NodeType = {}));\nconst effectiveParentNodeOverrides = new WeakMap();\n/**\n * IDOM implementation for Html.\n */\nexport class HTMLDOM {\n    constructor(window, document, TNode, TElement, THTMLElement, TCustomEvent, TCSSStyleSheet, TShadowRoot) {\n        this.window = window;\n        this.document = document;\n        this.Node = TNode;\n        this.Element = TElement;\n        this.HTMLElement = THTMLElement;\n        this.CustomEvent = TCustomEvent;\n        this.CSSStyleSheet = TCSSStyleSheet;\n        this.ShadowRoot = TShadowRoot;\n        if (DOM.isInitialized) {\n            Reporter.write(1001); // TODO: create reporters code // DOM already initialized (just info)\n            DOM.destroy();\n        }\n        DOM.initialize(this);\n        this.emptyNodes = new FragmentNodeSequence(this, document.createDocumentFragment());\n    }\n    static register(container) {\n        return Registration.alias(IDOM, this).register(container);\n    }\n    addEventListener(eventName, subscriber, publisher, options) {\n        (publisher || this.document).addEventListener(eventName, subscriber, options);\n    }\n    appendChild(parent, child) {\n        parent.appendChild(child);\n    }\n    cloneNode(node, deep) {\n        return node.cloneNode(deep !== false);\n    }\n    convertToRenderLocation(node) {\n        if (this.isRenderLocation(node)) {\n            return node; // it's already a IRenderLocation (converted by FragmentNodeSequence)\n        }\n        if (node.parentNode == null) {\n            throw Reporter.error(52);\n        }\n        const locationEnd = this.document.createComment('au-end');\n        const locationStart = this.document.createComment('au-start');\n        node.parentNode.replaceChild(locationEnd, node);\n        locationEnd.parentNode.insertBefore(locationStart, locationEnd);\n        locationEnd.$start = locationStart;\n        locationStart.$nodes = null;\n        return locationEnd;\n    }\n    createDocumentFragment(markupOrNode) {\n        if (markupOrNode == null) {\n            return this.document.createDocumentFragment();\n        }\n        if (this.isNodeInstance(markupOrNode)) {\n            if (markupOrNode.content !== undefined) {\n                return markupOrNode.content;\n            }\n            const fragment = this.document.createDocumentFragment();\n            fragment.appendChild(markupOrNode);\n            return fragment;\n        }\n        return this.createTemplate(markupOrNode).content;\n    }\n    createNodeSequence(fragment) {\n        if (fragment === null) {\n            return this.emptyNodes;\n        }\n        return new FragmentNodeSequence(this, fragment.cloneNode(true));\n    }\n    createElement(name) {\n        return this.document.createElement(name);\n    }\n    fetch(input, init) {\n        return this.window.fetch(input, init);\n    }\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    createCustomEvent(eventType, options) {\n        return new this.CustomEvent(eventType, options);\n    }\n    dispatchEvent(evt) {\n        this.document.dispatchEvent(evt);\n    }\n    createNodeObserver(node, cb, init) {\n        if (typeof MutationObserver === 'undefined') {\n            // TODO: find a proper response for this scenario\n            return {\n                disconnect() { },\n                observe() { },\n                takeRecords() { return PLATFORM.emptyArray; }\n            };\n        }\n        const observer = new MutationObserver(cb);\n        observer.observe(node, init);\n        return observer;\n    }\n    createTemplate(markup) {\n        if (markup == null) {\n            return this.document.createElement('template');\n        }\n        const template = this.document.createElement('template');\n        template.innerHTML = markup.toString();\n        return template;\n    }\n    createTextNode(text) {\n        return this.document.createTextNode(text);\n    }\n    /**\n     * Returns the effective parentNode according to Aurelia's component hierarchy.\n     *\n     * Used by Aurelia to find the closest parent controller relative to a node.\n     *\n     * This method supports 3 additional scenarios that `node.parentNode` does not support:\n     * - Containerless elements. The parentNode in this case is a comment precending the element under specific conditions, rather than a node wrapping the element.\n     * - ShadowDOM. If a `ShadowRoot` is encountered, this method retrieves the associated controller via the metadata api to locate the original host.\n     * - Portals. If the provided node was moved to a different location in the DOM by a `portal` attribute, then the original parent of the node will be returned.\n     *\n     * @param node - The node to get the parent for.\n     * @returns Either the closest parent node, the closest `IRenderLocation` (comment node that is the containerless host), original portal host, or `null` if this is either the absolute document root or a disconnected node.\n     */\n    getEffectiveParentNode(node) {\n        // TODO: this method needs more tests!\n        // First look for any overrides\n        if (effectiveParentNodeOverrides.has(node)) {\n            return effectiveParentNodeOverrides.get(node);\n        }\n        // Then try to get the nearest au-start render location, which would be the containerless parent,\n        // again looking for any overrides along the way.\n        // otherwise return the normal parent node\n        let containerlessOffset = 0;\n        let next = node.nextSibling;\n        while (next !== null) {\n            if (next.nodeType === 8 /* Comment */) {\n                switch (next.textContent) {\n                    case 'au-start':\n                        // If we see an au-start before we see au-end, it will precede the host of a sibling containerless element rather than a parent.\n                        // So we use the offset to ignore the next au-end\n                        ++containerlessOffset;\n                        break;\n                    case 'au-end':\n                        if (containerlessOffset-- === 0) {\n                            return next;\n                        }\n                }\n            }\n            next = next.nextSibling;\n        }\n        if (node.parentNode === null && node.nodeType === 11 /* DocumentFragment */) {\n            // Could be a shadow root; see if there's a controller and if so, get the original host via the projector\n            const controller = CustomElement.for(node);\n            if (controller === void 0) {\n                // Not a shadow root (or at least, not one created by Aurelia)\n                // Nothing more we can try, just return null\n                return null;\n            }\n            const projector = controller.projector;\n            if (projector instanceof ShadowDOMProjector) {\n                // Now we can use the original host to traverse further up\n                return this.getEffectiveParentNode(projector.host);\n            }\n        }\n        return node.parentNode;\n    }\n    setEffectiveParentNode(childNodeOrNodeSequence, parentNode) {\n        if (this.isNodeInstance(childNodeOrNodeSequence)) {\n            effectiveParentNodeOverrides.set(childNodeOrNodeSequence, parentNode);\n        }\n        else {\n            const nodes = childNodeOrNodeSequence.childNodes;\n            for (let i = 0, ii = nodes.length; i < ii; ++i) {\n                effectiveParentNodeOverrides.set(nodes[i], parentNode);\n            }\n        }\n    }\n    insertBefore(nodeToInsert, referenceNode) {\n        referenceNode.parentNode.insertBefore(nodeToInsert, referenceNode);\n    }\n    isMarker(node) {\n        return node.nodeName === 'AU-M';\n    }\n    isNodeInstance(potentialNode) {\n        return potentialNode != null && potentialNode.nodeType > 0;\n    }\n    isRenderLocation(node) {\n        return node.textContent === 'au-end';\n    }\n    makeTarget(node) {\n        node.className = 'au';\n    }\n    registerElementResolver(container, resolver) {\n        container.registerResolver(INode, resolver);\n        container.registerResolver(this.Node, resolver);\n        container.registerResolver(this.Element, resolver);\n        container.registerResolver(this.HTMLElement, resolver);\n    }\n    remove(node) {\n        if (node.remove) {\n            node.remove();\n        }\n        else {\n            node.parentNode.removeChild(node);\n        }\n    }\n    removeEventListener(eventName, subscriber, publisher, options) {\n        (publisher || this.document).removeEventListener(eventName, subscriber, options);\n    }\n    setAttribute(node, name, value) {\n        node.setAttribute(name, value);\n    }\n}\nconst $DOM = DOM;\nexport { $DOM as DOM };\n/* eslint-enable @typescript-eslint/no-explicit-any */\n// This is the most common form of INodeSequence.\n// Every custom element or template controller whose node sequence is based on an HTML template\n// has an instance of this under the hood. Anyone who wants to create a node sequence from\n// a string of markup would also receive an instance of this.\n// CompiledTemplates create instances of FragmentNodeSequence.\n/**\n * This is the most common form of INodeSequence.\n *\n * @internal\n */\nexport class FragmentNodeSequence {\n    constructor(dom, fragment) {\n        this.dom = dom;\n        this.fragment = fragment;\n        this.isMounted = false;\n        this.isLinked = false;\n        this.next = void 0;\n        this.refNode = void 0;\n        const targetNodeList = fragment.querySelectorAll('.au');\n        let i = 0;\n        let ii = targetNodeList.length;\n        const targets = this.targets = Array(ii);\n        while (i < ii) {\n            // eagerly convert all markers to RenderLocations (otherwise the renderer\n            // will do it anyway) and store them in the target list (since the comments\n            // can't be queried)\n            const target = targetNodeList[i];\n            if (target.nodeName === 'AU-M') {\n                // note the renderer will still call this method, but it will just return the\n                // location if it sees it's already a location\n                targets[i] = this.dom.convertToRenderLocation(target);\n            }\n            else {\n                // also store non-markers for consistent ordering\n                targets[i] = target;\n            }\n            ++i;\n        }\n        const childNodeList = fragment.childNodes;\n        i = 0;\n        ii = childNodeList.length;\n        const childNodes = this.childNodes = Array(ii);\n        while (i < ii) {\n            childNodes[i] = childNodeList[i];\n            ++i;\n        }\n        this.firstChild = fragment.firstChild;\n        this.lastChild = fragment.lastChild;\n    }\n    findTargets() {\n        return this.targets;\n    }\n    insertBefore(refNode) {\n        if (this.isLinked && !!this.refNode) {\n            this.addToLinked();\n        }\n        else {\n            const parent = refNode.parentNode;\n            if (this.isMounted) {\n                let current = this.firstChild;\n                const end = this.lastChild;\n                let next;\n                while (current != null) {\n                    next = current.nextSibling;\n                    parent.insertBefore(current, refNode);\n                    if (current === end) {\n                        break;\n                    }\n                    current = next;\n                }\n            }\n            else {\n                this.isMounted = true;\n                refNode.parentNode.insertBefore(this.fragment, refNode);\n            }\n        }\n    }\n    appendTo(parent) {\n        if (this.isMounted) {\n            let current = this.firstChild;\n            const end = this.lastChild;\n            let next;\n            while (current != null) {\n                next = current.nextSibling;\n                parent.appendChild(current);\n                if (current === end) {\n                    break;\n                }\n                current = next;\n            }\n        }\n        else {\n            this.isMounted = true;\n            parent.appendChild(this.fragment);\n        }\n    }\n    remove() {\n        if (this.isMounted) {\n            this.isMounted = false;\n            const fragment = this.fragment;\n            const end = this.lastChild;\n            let next;\n            let current = this.firstChild;\n            while (current !== null) {\n                next = current.nextSibling;\n                fragment.appendChild(current);\n                if (current === end) {\n                    break;\n                }\n                current = next;\n            }\n        }\n    }\n    addToLinked() {\n        const refNode = this.refNode;\n        const parent = refNode.parentNode;\n        if (this.isMounted) {\n            let current = this.firstChild;\n            const end = this.lastChild;\n            let next;\n            while (current != null) {\n                next = current.nextSibling;\n                parent.insertBefore(current, refNode);\n                if (current === end) {\n                    break;\n                }\n                current = next;\n            }\n        }\n        else {\n            this.isMounted = true;\n            parent.insertBefore(this.fragment, refNode);\n        }\n    }\n    unlink() {\n        this.isLinked = false;\n        this.next = void 0;\n        this.refNode = void 0;\n    }\n    link(next) {\n        this.isLinked = true;\n        if (this.dom.isRenderLocation(next)) {\n            this.refNode = next;\n        }\n        else {\n            this.next = next;\n            this.obtainRefNode();\n        }\n    }\n    obtainRefNode() {\n        if (this.next !== void 0) {\n            this.refNode = this.next.firstChild;\n        }\n        else {\n            this.refNode = void 0;\n        }\n    }\n}\n/** @internal */\nexport class AuMarker {\n    constructor(nextSibling) {\n        this.nextSibling = nextSibling;\n        this.textContent = '';\n    }\n    get parentNode() {\n        return this.nextSibling.parentNode;\n    }\n    remove() { }\n}\n(proto => {\n    proto.previousSibling = null;\n    proto.childNodes = PLATFORM.emptyArray;\n    proto.nodeName = 'AU-M';\n    proto.nodeType = 1 /* Element */;\n})(AuMarker.prototype);\n//# sourceMappingURL=dom.js.map","import { __decorate, __metadata, __param } from \"tslib\";\nimport { PLATFORM } from '@aurelia/kernel';\nimport { bindable, customAttribute, IDOM, INode, IScheduler } from '@aurelia/runtime';\nimport { HTMLDOM } from '../../dom';\nconst unset = Symbol();\n// Using passive to help with performance\nconst defaultCaptureEventInit = {\n    passive: true,\n    capture: true\n};\n// Using passive to help with performance\nconst defaultBubbleEventInit = {\n    passive: true\n};\n// weakly connect a document to a blur manager\n// to avoid polluting the document properties\nconst blurDocMap = new WeakMap();\nexport class BlurManager {\n    constructor(dom, scheduler) {\n        this.dom = dom;\n        this.scheduler = scheduler;\n        this.blurs = [];\n        blurDocMap.set(dom.document, this);\n        this.handler = createHandler(this, this.blurs);\n    }\n    static createFor(dom, scheduler) {\n        return blurDocMap.get(dom.document) || new BlurManager(dom, scheduler);\n    }\n    register(blur) {\n        const blurs = this.blurs;\n        if (!blurs.includes(blur) && blurs.push(blur) === 1) {\n            this.addListeners();\n        }\n    }\n    unregister(blur) {\n        const blurs = this.blurs;\n        const index = blurs.indexOf(blur);\n        if (index > -1) {\n            blurs.splice(index, 1);\n        }\n        if (blurs.length === 0) {\n            this.removeListeners();\n        }\n    }\n    addListeners() {\n        const dom = this.dom;\n        const doc = dom.document;\n        const win = dom.window;\n        const handler = this.handler;\n        if (win.navigator.pointerEnabled) {\n            doc.addEventListener('pointerdown', handler, defaultCaptureEventInit);\n        }\n        doc.addEventListener('touchstart', handler, defaultCaptureEventInit);\n        doc.addEventListener('mousedown', handler, defaultCaptureEventInit);\n        doc.addEventListener('focus', handler, defaultCaptureEventInit);\n        win.addEventListener('blur', handler, defaultBubbleEventInit);\n    }\n    removeListeners() {\n        const dom = this.dom;\n        const doc = dom.document;\n        const win = dom.window;\n        const handler = this.handler;\n        if (win.navigator.pointerEnabled) {\n            doc.removeEventListener('pointerdown', handler, defaultCaptureEventInit);\n        }\n        doc.removeEventListener('touchstart', handler, defaultCaptureEventInit);\n        doc.removeEventListener('mousedown', handler, defaultCaptureEventInit);\n        doc.removeEventListener('focus', handler, defaultCaptureEventInit);\n        win.removeEventListener('blur', handler, defaultBubbleEventInit);\n    }\n}\nlet Blur = class Blur {\n    constructor(element, dom, scheduler) {\n        this.dom = dom;\n        this.element = element;\n        /**\n         * By default, the behavior should be least surprise possible, that:\n         *\n         * it searches for anything from root context,\n         * and root context is document body\n         */\n        this.linkedMultiple = true;\n        this.searchSubTree = true;\n        this.linkingContext = null;\n        this.value = unset;\n        this.manager = BlurManager.createFor(dom, scheduler);\n    }\n    afterAttach() {\n        this.manager.register(this);\n    }\n    beforeDetach() {\n        this.manager.unregister(this);\n    }\n    handleEventTarget(target) {\n        if (this.value === false) {\n            return;\n        }\n        const dom = this.dom;\n        if (target === dom.window || target === dom.document || !this.contains(target)) {\n            this.triggerBlur();\n        }\n    }\n    contains(target) {\n        if (!this.value) {\n            return false;\n        }\n        let els;\n        let i;\n        let j, jj;\n        let link;\n        const element = this.element;\n        if (containsElementOrShadowRoot(element, target)) {\n            return true;\n        }\n        if (!this.linkedWith) {\n            return false;\n        }\n        const doc = this.dom.document;\n        const linkedWith = this.linkedWith;\n        const linkingContext = this.linkingContext;\n        const searchSubTree = this.searchSubTree;\n        const linkedMultiple = this.linkedMultiple;\n        const links = Array.isArray(linkedWith) ? linkedWith : [linkedWith];\n        const contextNode = (typeof linkingContext === 'string'\n            ? doc.querySelector(linkingContext)\n            : linkingContext)\n            || doc.body;\n        const ii = links.length;\n        for (i = 0; ii > i; ++i) {\n            link = links[i];\n            // When user specify to link with something by a string, it acts as a CSS selector\n            // We need to do some querying stuff to determine if target above is contained.\n            if (typeof link === 'string') {\n                // Default behavior, search the whole tree, from context that user specified, which default to document body\n                if (searchSubTree) {\n                    // todo: are there too many knobs?? Consider remove \"linkedMultiple\"??\n                    if (!linkedMultiple) {\n                        const el = contextNode.querySelector(link);\n                        els = el !== null ? [el] : PLATFORM.emptyArray;\n                    }\n                    else {\n                        els = contextNode.querySelectorAll(link);\n                    }\n                    jj = els.length;\n                    for (j = 0; jj > j; ++j) {\n                        if (els[j].contains(target)) {\n                            return true;\n                        }\n                    }\n                }\n                else {\n                    // default to document body, if user didn't define a linking context, and wanted to ignore subtree.\n                    // This is specifically performant and useful for dialogs, plugins\n                    // that usually generate contents to document body\n                    els = contextNode.children;\n                    jj = els.length;\n                    for (j = 0; jj > j; ++j) {\n                        if (els[j].matches(link)) {\n                            return true;\n                        }\n                    }\n                }\n            }\n            else {\n                // When user passed in something that is not a string,\n                // simply check if has method `contains` (allow duck typing)\n                // and call it against target.\n                // This enables flexible usages\n                if (link && link.contains(target)) {\n                    return true;\n                }\n            }\n        }\n        return false;\n    }\n    triggerBlur() {\n        this.value = false;\n        if (typeof this.onBlur === 'function') {\n            this.onBlur.call(null);\n        }\n    }\n};\n__decorate([\n    bindable(),\n    __metadata(\"design:type\", Object)\n], Blur.prototype, \"value\", void 0);\n__decorate([\n    bindable(),\n    __metadata(\"design:type\", Function)\n], Blur.prototype, \"onBlur\", void 0);\n__decorate([\n    bindable(),\n    __metadata(\"design:type\", Object)\n], Blur.prototype, \"linkedWith\", void 0);\n__decorate([\n    bindable(),\n    __metadata(\"design:type\", Boolean)\n], Blur.prototype, \"linkedMultiple\", void 0);\n__decorate([\n    bindable(),\n    __metadata(\"design:type\", Boolean)\n], Blur.prototype, \"searchSubTree\", void 0);\n__decorate([\n    bindable(),\n    __metadata(\"design:type\", Object)\n], Blur.prototype, \"linkingContext\", void 0);\nBlur = __decorate([\n    customAttribute('blur'),\n    __param(0, INode), __param(1, IDOM), __param(2, IScheduler),\n    __metadata(\"design:paramtypes\", [Object, HTMLDOM, Object])\n], Blur);\nexport { Blur };\nconst containsElementOrShadowRoot = (container, target) => {\n    if (container.contains(target)) {\n        return true;\n    }\n    let parentNode = null;\n    while (target != null) {\n        if (target === container) {\n            return true;\n        }\n        parentNode = target.parentNode;\n        if (parentNode === null && target.nodeType === 11 /* DocumentFragment */) {\n            target = target.host;\n            continue;\n        }\n        target = parentNode;\n    }\n    return false;\n};\nconst createHandler = (manager, checkTargets) => {\n    // *******************************\n    // EVENTS ORDER\n    // -----------------------------\n    // pointerdown\n    // touchstart\n    // pointerup\n    // touchend\n    // mousedown\n    // --------------\n    // BLUR\n    // FOCUS\n    // --------------\n    // mouseup\n    // click\n    //\n    // ******************************\n    //\n    // There are cases focus happens without mouse interaction (keyboard)\n    // So it needs to capture both mouse / focus movement\n    //\n    // ******************************\n    let hasChecked = false;\n    const revertCheckage = () => {\n        hasChecked = false;\n    };\n    const markChecked = () => {\n        hasChecked = true;\n        manager.scheduler.queueRenderTask(revertCheckage, { preempt: true });\n    };\n    const handleMousedown = (e) => {\n        if (!hasChecked) {\n            handleEvent(e);\n            markChecked();\n        }\n    };\n    /**\n     * Handle globally captured focus event\n     * This can happen via a few way:\n     * User clicks on a focusable element\n     * User uses keyboard to navigate to a focusable element\n     * User goes back to the window from another browser tab\n     * User clicks on a non-focusable element\n     * User clicks on the window, outside of the document\n     */\n    const handleFocus = (e) => {\n        if (hasChecked) {\n            return;\n        }\n        // there are two way a focus gets captured on window\n        // when the windows itself got focus\n        // and when an element in the document gets focus\n        // when the window itself got focus, reacting to it is quite unnecessary\n        // as it doesn't really affect element inside the document\n        // Do a simple check and bail immediately\n        const isWindow = e.target === manager.dom.window;\n        if (isWindow) {\n            for (let i = 0, ii = checkTargets.length; ii > i; ++i) {\n                checkTargets[i].triggerBlur();\n            }\n        }\n        else {\n            handleEvent(e);\n        }\n        markChecked();\n    };\n    const handleWindowBlur = () => {\n        hasChecked = false;\n        for (let i = 0, ii = checkTargets.length; i < ii; ++i) {\n            checkTargets[i].triggerBlur();\n        }\n    };\n    const handleEvent = (e) => {\n        const target = e.composed ? e.composedPath()[0] : e.target;\n        if (target === null) {\n            return;\n        }\n        for (let i = 0, ii = checkTargets.length; i < ii; ++i) {\n            checkTargets[i].handleEventTarget(target);\n        }\n    };\n    return {\n        onpointerdown: handleMousedown,\n        ontouchstart: handleMousedown,\n        onmousedown: handleMousedown,\n        onfocus: handleFocus,\n        onblur: handleWindowBlur,\n        handleEvent(e) {\n            this[`on${e.type}`](e);\n        }\n    };\n};\n//# sourceMappingURL=blur.js.map","import { __decorate, __metadata, __param } from \"tslib\";\nimport { bindable, BindingMode, customAttribute, IDOM, INode } from '@aurelia/runtime';\nimport { HTMLDOM } from '../../dom';\n/**\n * Focus attribute for element focus binding\n */\nlet Focus = class Focus {\n    constructor(element, dom) {\n        this.dom = dom;\n        /**\n         * Indicates whether `apply` should be called when `afterAttach` callback is invoked\n         */\n        this.needsApply = false;\n        this.element = element;\n    }\n    beforeBind() {\n        this.valueChanged();\n    }\n    /**\n     * Invoked everytime the bound value changes.\n     *\n     * @param newValue - The new value.\n     */\n    valueChanged() {\n        // In theory, we could/should react immediately\n        // but focus state of an element cannot be achieved\n        // while it's disconnected from the document\n        // thus, there neesd to be a check if it's currently connected or not\n        // before applying the value to the element\n        if (this.$controller.state & 32 /* isAttached */) {\n            this.apply();\n        }\n        else {\n            // If the element is not currently connect\n            // toggle the flag to add pending work for later\n            // in afterAttach lifecycle\n            this.needsApply = true;\n        }\n    }\n    /**\n     * Invoked when the attribute is afterAttach to the DOM.\n     */\n    afterAttach() {\n        if (this.needsApply) {\n            this.needsApply = false;\n            this.apply();\n        }\n        const el = this.element;\n        el.addEventListener('focus', this);\n        el.addEventListener('blur', this);\n    }\n    /**\n     * Invoked when the attribute is afterDetach from the DOM.\n     */\n    afterDetach() {\n        const el = this.element;\n        el.removeEventListener('focus', this);\n        el.removeEventListener('blur', this);\n    }\n    /**\n     * EventTarget interface handler for better memory usage\n     */\n    handleEvent(e) {\n        // there are only two event listened to\n        // if the even is focus, it menans the element is focused\n        // only need to switch the value to true\n        if (e.type === 'focus') {\n            this.value = true;\n        }\n        else if (this.dom.document.activeElement !== this.element) {\n            // else, it's blur event\n            // when a blur event happens, there are two situations\n            // 1. the element itself lost the focus\n            // 2. window lost the focus\n            // To handle both (1) and (2), only need to check if\n            // current active element is still the same element of this focus custom attribute\n            // If it's not, it's a blur event happened on Window because the browser tab lost focus\n            this.value = false;\n        }\n    }\n    /**\n     * Focus/blur based on current value\n     */\n    apply() {\n        const el = this.element;\n        if (this.value) {\n            el.focus();\n        }\n        else {\n            el.blur();\n        }\n    }\n};\n__decorate([\n    bindable({ mode: BindingMode.twoWay }),\n    __metadata(\"design:type\", Object)\n], Focus.prototype, \"value\", void 0);\nFocus = __decorate([\n    customAttribute('focus'),\n    __param(0, INode), __param(1, IDOM),\n    __metadata(\"design:paramtypes\", [Object, HTMLDOM])\n], Focus);\nexport { Focus };\n//# sourceMappingURL=focus.js.map","import { __decorate, __metadata, __param } from \"tslib\";\nimport { nextId, } from '@aurelia/kernel';\nimport { bindable, ContinuationTask, IDOM, IRenderLocation, IViewFactory, LifecycleTask, templateController, TerminalTask, } from '@aurelia/runtime';\nimport { HTMLDOM, } from '../../dom';\nfunction toTask(maybePromiseOrTask) {\n    if (maybePromiseOrTask == null) {\n        return LifecycleTask.done;\n    }\n    if (typeof maybePromiseOrTask.then === 'function') {\n        return new TerminalTask(maybePromiseOrTask);\n    }\n    return maybePromiseOrTask;\n}\nlet Portal = class Portal {\n    constructor(factory, originalLoc, dom) {\n        this.factory = factory;\n        this.originalLoc = originalLoc;\n        this.dom = dom;\n        this.id = nextId('au$component');\n        this.strict = false;\n        this.task = LifecycleTask.done;\n        // to make the shape of this object consistent.\n        // todo: is this necessary\n        this.currentTarget = dom.createElement('div');\n        this.view = this.factory.create();\n        dom.setEffectiveParentNode(this.view.nodes, originalLoc);\n        this.view.hold(originalLoc, 1 /* insertBefore */);\n    }\n    beforeBind(flags) {\n        if (this.callbackContext == null) {\n            this.callbackContext = this.$controller.scope.bindingContext;\n        }\n        return this.view.bind(flags, this.$controller.scope);\n    }\n    afterAttach(flags) {\n        this.targetChanged();\n    }\n    beforeDetach(flags) {\n        this.task = this.deactivate(flags);\n    }\n    beforeUnbind(flags) {\n        this.callbackContext = null;\n        return this.view.unbind(flags);\n    }\n    targetChanged() {\n        const $controller = this.$controller;\n        if (($controller.state & 4 /* isBound */) === 0) {\n            return;\n        }\n        this.project($controller.flags);\n    }\n    project(flags) {\n        const oldTarget = this.currentTarget;\n        const newTarget = this.currentTarget = this.resolveTarget();\n        if (oldTarget === newTarget) {\n            return;\n        }\n        this.task = this.deactivate(flags);\n        this.task = this.activate(newTarget, flags);\n    }\n    activate(target, flags) {\n        const { activating, activated, callbackContext, view } = this;\n        let task = this.task;\n        view.hold(target, 2 /* append */);\n        if ((this.$controller.state & 40 /* isAttachedOrAttaching */) === 0) {\n            return task;\n        }\n        if (typeof activating === 'function') {\n            if (task.done) {\n                task = toTask(activating.call(callbackContext, target, view));\n            }\n            else {\n                task = new ContinuationTask(task, activating, callbackContext, target, view);\n            }\n        }\n        if (task.done) {\n            view.attach(flags);\n        }\n        else {\n            task = new ContinuationTask(task, view.attach, view, flags);\n        }\n        if (typeof activated === 'function') {\n            if (task.done) {\n                // TODO: chain this up with RAF queue mount callback so activated is called only when\n                // node is actually mounted (is this needed as per the spec of this resource?)\n                task = toTask(activated.call(callbackContext, target, view));\n            }\n            else {\n                task = new ContinuationTask(task, activated, callbackContext, target, view);\n            }\n        }\n        return task;\n    }\n    deactivate(flags) {\n        const { deactivating, deactivated, callbackContext, view, target: target } = this;\n        let task = this.task;\n        if (typeof deactivating === 'function') {\n            if (task.done) {\n                task = toTask(deactivating.call(callbackContext, target, view));\n            }\n            else {\n                task = new ContinuationTask(task, deactivating, callbackContext, target, view);\n            }\n        }\n        if (task.done) {\n            view.detach(flags);\n        }\n        else {\n            task = new ContinuationTask(task, view.detach, view, flags);\n        }\n        if (typeof deactivated === 'function') {\n            if (task.done) {\n                task = toTask(deactivated.call(callbackContext, target, view));\n            }\n            else {\n                task = new ContinuationTask(task, deactivated, callbackContext, target, view);\n            }\n        }\n        return task;\n    }\n    resolveTarget() {\n        const dom = this.dom;\n        // with a $ in front to make it less confusing/error prone\n        const $document = dom.document;\n        let target = this.target;\n        let context = this.renderContext;\n        if (typeof target === 'string') {\n            let queryContext = $document;\n            if (typeof context === 'string') {\n                context = $document.querySelector(context);\n            }\n            if (dom.isNodeInstance(context)) {\n                queryContext = context;\n            }\n            target = queryContext.querySelector(target);\n        }\n        if (dom.isNodeInstance(target)) {\n            return target;\n        }\n        if (target == null) {\n            if (this.strict) {\n                throw new Error('Render target not found');\n            }\n            else {\n                target = $document.body;\n            }\n        }\n        return target;\n    }\n};\n__decorate([\n    bindable({ primary: true }),\n    __metadata(\"design:type\", Object)\n], Portal.prototype, \"target\", void 0);\n__decorate([\n    bindable({ callback: 'targetChanged' }),\n    __metadata(\"design:type\", Object)\n], Portal.prototype, \"renderContext\", void 0);\n__decorate([\n    bindable(),\n    __metadata(\"design:type\", Boolean)\n], Portal.prototype, \"strict\", void 0);\n__decorate([\n    bindable(),\n    __metadata(\"design:type\", Function)\n], Portal.prototype, \"deactivating\", void 0);\n__decorate([\n    bindable(),\n    __metadata(\"design:type\", Function)\n], Portal.prototype, \"activating\", void 0);\n__decorate([\n    bindable(),\n    __metadata(\"design:type\", Function)\n], Portal.prototype, \"deactivated\", void 0);\n__decorate([\n    bindable(),\n    __metadata(\"design:type\", Function)\n], Portal.prototype, \"activated\", void 0);\n__decorate([\n    bindable(),\n    __metadata(\"design:type\", Object)\n], Portal.prototype, \"callbackContext\", void 0);\nPortal = __decorate([\n    templateController('portal'),\n    __param(0, IViewFactory),\n    __param(1, IRenderLocation),\n    __param(2, IDOM),\n    __metadata(\"design:paramtypes\", [Object, Object, HTMLDOM])\n], Portal);\nexport { Portal };\n//# sourceMappingURL=portal.js.map","export var HTMLTargetedInstructionType;\n(function (HTMLTargetedInstructionType) {\n    HTMLTargetedInstructionType[\"textBinding\"] = \"ha\";\n    HTMLTargetedInstructionType[\"listenerBinding\"] = \"hb\";\n    HTMLTargetedInstructionType[\"attributeBinding\"] = \"hc\";\n    HTMLTargetedInstructionType[\"stylePropertyBinding\"] = \"hd\";\n    HTMLTargetedInstructionType[\"setAttribute\"] = \"he\";\n    HTMLTargetedInstructionType[\"setClassAttribute\"] = \"hf\";\n    HTMLTargetedInstructionType[\"setStyleAttribute\"] = \"hg\";\n})(HTMLTargetedInstructionType || (HTMLTargetedInstructionType = {}));\nexport function isHTMLTargetedInstruction(value) {\n    const type = value.type;\n    return typeof type === 'string' && type.length === 2;\n}\n//# sourceMappingURL=definitions.js.map","import { DelegationStrategy } from '@aurelia/runtime';\nexport class TextBindingInstruction {\n    constructor(from) {\n        this.from = from;\n        this.type = \"ha\" /* textBinding */;\n    }\n}\nexport class TriggerBindingInstruction {\n    constructor(from, to) {\n        this.from = from;\n        this.to = to;\n        this.type = \"hb\" /* listenerBinding */;\n        this.preventDefault = true;\n        this.strategy = DelegationStrategy.none;\n    }\n}\nexport class DelegateBindingInstruction {\n    constructor(from, to) {\n        this.from = from;\n        this.to = to;\n        this.type = \"hb\" /* listenerBinding */;\n        this.preventDefault = false;\n        this.strategy = DelegationStrategy.bubbling;\n    }\n}\nexport class CaptureBindingInstruction {\n    constructor(from, to) {\n        this.from = from;\n        this.to = to;\n        this.type = \"hb\" /* listenerBinding */;\n        this.preventDefault = false;\n        this.strategy = DelegationStrategy.capturing;\n    }\n}\nexport class StylePropertyBindingInstruction {\n    constructor(from, to) {\n        this.from = from;\n        this.to = to;\n        this.type = \"hd\" /* stylePropertyBinding */;\n    }\n}\nexport class SetAttributeInstruction {\n    constructor(value, to) {\n        this.value = value;\n        this.to = to;\n        this.type = \"he\" /* setAttribute */;\n    }\n}\nexport class SetClassAttributeInstruction {\n    constructor(value) {\n        this.value = value;\n        this.type = \"hf\" /* setClassAttribute */;\n    }\n}\nexport class SetStyleAttributeInstruction {\n    constructor(value) {\n        this.value = value;\n        this.type = \"hg\" /* setStyleAttribute */;\n    }\n}\nexport class AttributeBindingInstruction {\n    constructor(\n    /**\n     * `attr` and `to` have the same value on a normal attribute\n     * Will be different on `class` and `style`\n     * on `class`: attr = `class` (from binding command), to = attribute name\n     * on `style`: attr = `style` (from binding command), to = attribute name\n     */\n    attr, from, to) {\n        this.attr = attr;\n        this.from = from;\n        this.to = to;\n        this.type = \"hc\" /* attributeBinding */;\n    }\n}\n//# sourceMappingURL=instructions.js.map","import { CustomElement, HydrateElementInstruction, CustomElementDefinition, getRenderContext, } from '@aurelia/runtime';\nimport { isHTMLTargetedInstruction } from './definitions';\nimport { SetAttributeInstruction } from './instructions';\nexport function createElement(dom, tagOrType, props, children) {\n    if (typeof tagOrType === 'string') {\n        return createElementForTag(dom, tagOrType, props, children);\n    }\n    else if (CustomElement.isType(tagOrType)) {\n        return createElementForType(dom, tagOrType, props, children);\n    }\n    else {\n        throw new Error(`Invalid tagOrType.`);\n    }\n}\n/**\n * RenderPlan. Todo: describe goal of this class\n */\nexport class RenderPlan {\n    constructor(dom, node, instructions, dependencies) {\n        this.dom = dom;\n        this.node = node;\n        this.instructions = instructions;\n        this.dependencies = dependencies;\n        this.lazyDefinition = void 0;\n    }\n    get definition() {\n        if (this.lazyDefinition === void 0) {\n            this.lazyDefinition = CustomElementDefinition.create({\n                name: CustomElement.generateName(),\n                template: this.node,\n                needsCompile: typeof this.node === 'string',\n                instructions: this.instructions,\n                dependencies: this.dependencies,\n            });\n        }\n        return this.lazyDefinition;\n    }\n    getContext(parentContainer) {\n        return getRenderContext(this.definition, parentContainer, void 0);\n    }\n    createView(parentContainer) {\n        return this.getViewFactory(parentContainer).create();\n    }\n    getViewFactory(parentContainer) {\n        return this.getContext(parentContainer).getViewFactory();\n    }\n    /** @internal */\n    mergeInto(parent, instructions, dependencies) {\n        this.dom.appendChild(parent, this.node);\n        instructions.push(...this.instructions);\n        dependencies.push(...this.dependencies);\n    }\n}\nfunction createElementForTag(dom, tagName, props, children) {\n    const instructions = [];\n    const allInstructions = [];\n    const dependencies = [];\n    const element = dom.createElement(tagName);\n    let hasInstructions = false;\n    if (props) {\n        Object.keys(props)\n            .forEach(to => {\n            const value = props[to];\n            if (isHTMLTargetedInstruction(value)) {\n                hasInstructions = true;\n                instructions.push(value);\n            }\n            else {\n                dom.setAttribute(element, to, value);\n            }\n        });\n    }\n    if (hasInstructions) {\n        dom.makeTarget(element);\n        allInstructions.push(instructions);\n    }\n    if (children) {\n        addChildren(dom, element, children, allInstructions, dependencies);\n    }\n    return new RenderPlan(dom, element, allInstructions, dependencies);\n}\nfunction createElementForType(dom, Type, props, children) {\n    const definition = CustomElement.getDefinition(Type);\n    const tagName = definition.name;\n    const instructions = [];\n    const allInstructions = [instructions];\n    const dependencies = [];\n    const childInstructions = [];\n    const bindables = definition.bindables;\n    const element = dom.createElement(tagName);\n    dom.makeTarget(element);\n    if (!dependencies.includes(Type)) {\n        dependencies.push(Type);\n    }\n    instructions.push(new HydrateElementInstruction(tagName, childInstructions));\n    if (props) {\n        Object.keys(props)\n            .forEach(to => {\n            const value = props[to];\n            if (isHTMLTargetedInstruction(value)) {\n                childInstructions.push(value);\n            }\n            else {\n                const bindable = bindables[to];\n                if (bindable !== void 0) {\n                    childInstructions.push({\n                        type: \"re\" /* setProperty */,\n                        to,\n                        value\n                    });\n                }\n                else {\n                    childInstructions.push(new SetAttributeInstruction(value, to));\n                }\n            }\n        });\n    }\n    if (children) {\n        addChildren(dom, element, children, allInstructions, dependencies);\n    }\n    return new RenderPlan(dom, element, allInstructions, dependencies);\n}\nfunction addChildren(dom, parent, children, allInstructions, dependencies) {\n    for (let i = 0, ii = children.length; i < ii; ++i) {\n        const current = children[i];\n        switch (typeof current) {\n            case 'string':\n                dom.appendChild(parent, dom.createTextNode(current));\n                break;\n            case 'object':\n                if (dom.isNodeInstance(current)) {\n                    dom.appendChild(parent, current);\n                }\n                else if ('mergeInto' in current) {\n                    current.mergeInto(parent, allInstructions, dependencies);\n                }\n        }\n    }\n}\n//# sourceMappingURL=create-element.js.map","import { __decorate, __metadata, __param } from \"tslib\";\nimport { nextId, PLATFORM, } from '@aurelia/kernel';\nimport { BindingMode, ContinuationTask, IDOM, ITargetedInstruction, LifecycleTask, PromiseTask, CustomElementDefinition, bindable, customElement, getRenderContext, } from '@aurelia/runtime';\nimport { createElement, } from '../../create-element';\nconst bindables = ['subject', 'composing'];\nlet Compose = class Compose {\n    constructor(dom, instruction) {\n        this.dom = dom;\n        this.id = nextId('au$component');\n        this.subject = void 0;\n        this.composing = false;\n        this.view = void 0;\n        this.task = LifecycleTask.done;\n        this.lastSubject = void 0;\n        this.properties = instruction.instructions\n            .filter((x) => !bindables.includes(x.to))\n            .reduce((acc, item) => {\n            if (item.to) {\n                acc[item.to] = item;\n            }\n            return acc;\n        }, {});\n    }\n    beforeBind(flags) {\n        if (this.task.done) {\n            this.task = this.compose(this.subject, flags);\n        }\n        else {\n            this.task = new ContinuationTask(this.task, this.compose, this, this.subject, flags);\n        }\n        if (this.task.done) {\n            this.task = this.bindView(flags);\n        }\n        else {\n            this.task = new ContinuationTask(this.task, this.bindView, this, flags);\n        }\n        return this.task;\n    }\n    beforeAttach(flags) {\n        if (this.task.done) {\n            this.attachView(flags);\n        }\n        else {\n            this.task = new ContinuationTask(this.task, this.attachView, this, flags);\n        }\n    }\n    beforeDetach(flags) {\n        if (this.view != void 0) {\n            if (this.task.done) {\n                this.view.detach(flags);\n            }\n            else {\n                this.task = new ContinuationTask(this.task, this.view.detach, this.view, flags);\n            }\n        }\n    }\n    beforeUnbind(flags) {\n        this.lastSubject = void 0;\n        if (this.view != void 0) {\n            if (this.task.done) {\n                this.task = this.view.unbind(flags);\n            }\n            else {\n                this.task = new ContinuationTask(this.task, this.view.unbind, this.view, flags);\n            }\n        }\n        return this.task;\n    }\n    caching(flags) {\n        this.view = void 0;\n    }\n    subjectChanged(newValue, previousValue, flags) {\n        flags |= this.$controller.flags;\n        if (this.task.done) {\n            this.task = this.compose(newValue, flags);\n        }\n        else {\n            this.task = new ContinuationTask(this.task, this.compose, this, newValue, flags);\n        }\n    }\n    compose(subject, flags) {\n        if (this.lastSubject === subject) {\n            return LifecycleTask.done;\n        }\n        this.lastSubject = subject;\n        this.composing = true;\n        let task = this.deactivate(flags);\n        if (subject instanceof Promise) {\n            let viewPromise;\n            if (task.done) {\n                viewPromise = subject.then(s => this.resolveView(s, flags));\n            }\n            else {\n                viewPromise = task.wait().then(() => subject.then(s => this.resolveView(s, flags)));\n            }\n            task = new PromiseTask(viewPromise, this.activate, this, flags);\n        }\n        else {\n            const view = this.resolveView(subject, flags);\n            if (task.done) {\n                task = this.activate(view, flags);\n            }\n            else {\n                task = new ContinuationTask(task, this.activate, this, view, flags);\n            }\n        }\n        if (task.done) {\n            this.onComposed();\n        }\n        else {\n            task = new ContinuationTask(task, this.onComposed, this);\n        }\n        return task;\n    }\n    deactivate(flags) {\n        const view = this.view;\n        if (view == void 0) {\n            return LifecycleTask.done;\n        }\n        view.detach(flags);\n        return view.unbind(flags);\n    }\n    activate(view, flags) {\n        this.view = view;\n        if (view == void 0) {\n            return LifecycleTask.done;\n        }\n        let task = this.bindView(flags);\n        if (task.done) {\n            this.attachView(flags);\n        }\n        else {\n            task = new ContinuationTask(task, this.attachView, this, flags);\n        }\n        return task;\n    }\n    bindView(flags) {\n        if (this.view != void 0 && (this.$controller.state & (5 /* isBoundOrBinding */)) > 0) {\n            return this.view.bind(flags, this.$controller.scope, this.$controller.part);\n        }\n        return LifecycleTask.done;\n    }\n    attachView(flags) {\n        if (this.view != void 0 && (this.$controller.state & (40 /* isAttachedOrAttaching */)) > 0) {\n            this.view.attach(flags);\n        }\n    }\n    onComposed() {\n        this.composing = false;\n    }\n    resolveView(subject, flags) {\n        const view = this.provideViewFor(subject, flags);\n        if (view) {\n            view.hold(this.$controller.projector.host, 1 /* insertBefore */);\n            view.lockScope(this.$controller.scope);\n            return view;\n        }\n        return void 0;\n    }\n    provideViewFor(subject, flags) {\n        if (!subject) {\n            return void 0;\n        }\n        if (isController(subject)) { // IController\n            return subject;\n        }\n        if ('createView' in subject) { // RenderPlan\n            return subject.createView(this.$controller.context);\n        }\n        if ('create' in subject) { // IViewFactory\n            return subject.create(flags);\n        }\n        if ('template' in subject) { // Raw Template Definition\n            const definition = CustomElementDefinition.getOrCreate(subject);\n            return getRenderContext(definition, this.$controller.context, void 0).getViewFactory().create(flags);\n        }\n        // Constructable (Custom Element Constructor)\n        return createElement(this.dom, subject, this.properties, this.$controller.projector === void 0\n            ? PLATFORM.emptyArray\n            : this.$controller.projector.children).createView(this.$controller.context);\n    }\n};\n__decorate([\n    bindable,\n    __metadata(\"design:type\", Object)\n], Compose.prototype, \"subject\", void 0);\n__decorate([\n    bindable({ mode: BindingMode.fromView }),\n    __metadata(\"design:type\", Boolean)\n], Compose.prototype, \"composing\", void 0);\nCompose = __decorate([\n    customElement({ name: 'au-compose', template: null, containerless: true }),\n    __param(0, IDOM),\n    __param(1, ITargetedInstruction),\n    __metadata(\"design:paramtypes\", [Object, Object])\n], Compose);\nexport { Compose };\nfunction isController(subject) {\n    return 'lockScope' in subject;\n}\n//# sourceMappingURL=compose.js.map","import { __decorate, __metadata, __param } from \"tslib\";\nimport { BindingMode, ensureExpression, IExpressionParser, instructionRenderer, InterpolationBinding, IObserverLocator, MultiInterpolationBinding, PropertyBinding, applyBindingBehavior, } from '@aurelia/runtime';\nimport { AttributeBinding } from './binding/attribute';\nimport { Listener } from './binding/listener';\nimport { IEventManager } from './observation/event-manager';\nlet TextBindingRenderer = \n/** @internal */\nclass TextBindingRenderer {\n    constructor(parser, observerLocator) {\n        this.parser = parser;\n        this.observerLocator = observerLocator;\n    }\n    render(flags, context, controller, target, instruction) {\n        const next = target.nextSibling;\n        if (context.dom.isMarker(target)) {\n            context.dom.remove(target);\n        }\n        let binding;\n        const expr = ensureExpression(this.parser, instruction.from, 2048 /* Interpolation */);\n        if (expr.isMulti) {\n            binding = applyBindingBehavior(new MultiInterpolationBinding(this.observerLocator, expr, next, 'textContent', BindingMode.toView, context), expr, context);\n        }\n        else {\n            binding = applyBindingBehavior(new InterpolationBinding(expr.firstExpression, expr, next, 'textContent', BindingMode.toView, this.observerLocator, context, true), expr, context);\n        }\n        controller.addBinding(binding);\n    }\n};\nTextBindingRenderer = __decorate([\n    instructionRenderer(\"ha\" /* textBinding */)\n    /** @internal */\n    ,\n    __param(0, IExpressionParser),\n    __param(1, IObserverLocator),\n    __metadata(\"design:paramtypes\", [Object, Object])\n], TextBindingRenderer);\nexport { TextBindingRenderer };\nlet ListenerBindingRenderer = \n/** @internal */\nclass ListenerBindingRenderer {\n    constructor(parser, eventManager) {\n        this.parser = parser;\n        this.eventManager = eventManager;\n    }\n    render(flags, context, controller, target, instruction) {\n        // eslint-disable-next-line @typescript-eslint/restrict-plus-operands\n        const expr = ensureExpression(this.parser, instruction.from, 80 /* IsEventCommand */ | (instruction.strategy + 6 /* DelegationStrategyDelta */));\n        const binding = applyBindingBehavior(new Listener(context.dom, instruction.to, instruction.strategy, expr, target, instruction.preventDefault, this.eventManager, context), expr, context);\n        controller.addBinding(binding);\n    }\n};\nListenerBindingRenderer = __decorate([\n    instructionRenderer(\"hb\" /* listenerBinding */)\n    /** @internal */\n    ,\n    __param(0, IExpressionParser),\n    __param(1, IEventManager),\n    __metadata(\"design:paramtypes\", [Object, Object])\n], ListenerBindingRenderer);\nexport { ListenerBindingRenderer };\nlet SetAttributeRenderer = \n/** @internal */\nclass SetAttributeRenderer {\n    render(flags, context, controller, target, instruction) {\n        target.setAttribute(instruction.to, instruction.value);\n    }\n};\nSetAttributeRenderer = __decorate([\n    instructionRenderer(\"he\" /* setAttribute */)\n    /** @internal */\n], SetAttributeRenderer);\nexport { SetAttributeRenderer };\nlet SetClassAttributeRenderer = class SetClassAttributeRenderer {\n    render(flags, context, controller, target, instruction) {\n        addClasses(target.classList, instruction.value);\n    }\n};\nSetClassAttributeRenderer = __decorate([\n    instructionRenderer(\"hf\" /* setClassAttribute */)\n], SetClassAttributeRenderer);\nexport { SetClassAttributeRenderer };\nlet SetStyleAttributeRenderer = class SetStyleAttributeRenderer {\n    render(flags, context, controller, target, instruction) {\n        target.style.cssText += instruction.value;\n    }\n};\nSetStyleAttributeRenderer = __decorate([\n    instructionRenderer(\"hg\" /* setStyleAttribute */)\n], SetStyleAttributeRenderer);\nexport { SetStyleAttributeRenderer };\nlet StylePropertyBindingRenderer = \n/** @internal */\nclass StylePropertyBindingRenderer {\n    constructor(parser, observerLocator) {\n        this.parser = parser;\n        this.observerLocator = observerLocator;\n    }\n    render(flags, context, controller, target, instruction) {\n        const expr = ensureExpression(this.parser, instruction.from, 48 /* IsPropertyCommand */ | BindingMode.toView);\n        const binding = applyBindingBehavior(new PropertyBinding(expr, target.style, instruction.to, BindingMode.toView, this.observerLocator, context), expr, context);\n        controller.addBinding(binding);\n    }\n};\nStylePropertyBindingRenderer = __decorate([\n    instructionRenderer(\"hd\" /* stylePropertyBinding */)\n    /** @internal */\n    ,\n    __param(0, IExpressionParser),\n    __param(1, IObserverLocator),\n    __metadata(\"design:paramtypes\", [Object, Object])\n], StylePropertyBindingRenderer);\nexport { StylePropertyBindingRenderer };\nlet AttributeBindingRenderer = \n/** @internal */\nclass AttributeBindingRenderer {\n    constructor(parser, observerLocator) {\n        this.parser = parser;\n        this.observerLocator = observerLocator;\n    }\n    render(flags, context, controller, target, instruction) {\n        const expr = ensureExpression(this.parser, instruction.from, 48 /* IsPropertyCommand */ | BindingMode.toView);\n        const binding = applyBindingBehavior(new AttributeBinding(expr, target, instruction.attr /* targetAttribute */, instruction.to /* targetKey */, BindingMode.toView, this.observerLocator, context), expr, context);\n        controller.addBinding(binding);\n    }\n};\nAttributeBindingRenderer = __decorate([\n    instructionRenderer(\"hc\" /* attributeBinding */)\n    /** @internal */\n    ,\n    __param(0, IExpressionParser),\n    __param(1, IObserverLocator),\n    __metadata(\"design:paramtypes\", [Object, Object])\n], AttributeBindingRenderer);\nexport { AttributeBindingRenderer };\n// http://jsben.ch/7n5Kt\nfunction addClasses(classList, className) {\n    const len = className.length;\n    let start = 0;\n    for (let i = 0; i < len; ++i) {\n        if (className.charCodeAt(i) === 0x20) {\n            if (i !== start) {\n                classList.add(className.slice(start, i));\n            }\n            start = i + 1;\n        }\n        else if (i + 1 === len) {\n            classList.add(className.slice(start));\n        }\n    }\n}\n//# sourceMappingURL=html-renderer.js.map","import { __decorate, __metadata } from \"tslib\";\nimport { bound } from '@aurelia/kernel';\n/**\n * A first-in-first-out queue that only processes the next queued item\n * when the current one has been resolved or rejected. Sends queued items\n * one at a time to a specified callback function. The callback function\n * should resolve or reject the queued item when processing is done.\n * Enqueued items can be awaited. Enqueued items can specify an (arbitrary)\n * execution cost and the queue can be set up (activated) to only process\n * a specific amount of execution cost per RAF/tick.\n */\nexport class Queue {\n    constructor(callback) {\n        this.callback = callback;\n        this.pending = [];\n        this.processing = null;\n        this.allowedExecutionCostWithinTick = null;\n        this.currentExecutionCostInCurrentTick = 0;\n        this.scheduler = null;\n        this.task = null;\n    }\n    get isActive() {\n        return this.task !== null;\n    }\n    get length() {\n        return this.pending.length;\n    }\n    activate(options) {\n        if (this.isActive) {\n            throw new Error('Queue has already been activated');\n        }\n        this.scheduler = options.scheduler;\n        this.allowedExecutionCostWithinTick = options.allowedExecutionCostWithinTick;\n        this.task = this.scheduler.queueRenderTask(this.dequeue, { persistent: true });\n    }\n    deactivate() {\n        if (!this.isActive) {\n            throw new Error('Queue has not been activated');\n        }\n        this.task.cancel();\n        this.task = null;\n        this.allowedExecutionCostWithinTick = null;\n        this.clear();\n    }\n    enqueue(itemOrItems, costOrCosts) {\n        const list = Array.isArray(itemOrItems);\n        const items = list ? itemOrItems : [itemOrItems];\n        const costs = items\n            .map((value, index) => !Array.isArray(costOrCosts) ? costOrCosts : costOrCosts[index])\n            .map(value => value !== undefined ? value : 1);\n        const promises = [];\n        for (const item of items) {\n            const qItem = { ...item };\n            qItem.cost = costs.shift();\n            promises.push(new Promise((resolve, reject) => {\n                qItem.resolve = () => {\n                    resolve();\n                    this.processing = null;\n                    this.dequeue();\n                };\n                qItem.reject = (reason) => {\n                    reject(reason);\n                    this.processing = null;\n                    this.dequeue();\n                };\n            }));\n            this.pending.push(qItem);\n        }\n        this.dequeue();\n        return list ? promises : promises[0];\n    }\n    dequeue(delta) {\n        if (this.processing !== null) {\n            return;\n        }\n        if (delta !== undefined) {\n            this.currentExecutionCostInCurrentTick = 0;\n        }\n        if (!this.pending.length) {\n            return;\n        }\n        if (this.allowedExecutionCostWithinTick !== null && delta === undefined && this.currentExecutionCostInCurrentTick + (this.pending[0].cost || 0) > this.allowedExecutionCostWithinTick) {\n            return;\n        }\n        this.processing = this.pending.shift() || null;\n        if (this.processing) {\n            this.currentExecutionCostInCurrentTick += this.processing.cost || 0;\n            this.callback(this.processing);\n        }\n    }\n    clear() {\n        this.pending.splice(0, this.pending.length);\n    }\n}\n__decorate([\n    bound,\n    __metadata(\"design:type\", Function),\n    __metadata(\"design:paramtypes\", [Number]),\n    __metadata(\"design:returntype\", void 0)\n], Queue.prototype, \"dequeue\", null);\n//# sourceMappingURL=queue.js.map","import { __decorate, __metadata, __param } from \"tslib\";\nimport { Reporter } from '@aurelia/kernel';\nimport { IDOM, IScheduler } from '@aurelia/runtime';\nimport { HTMLDOM } from '@aurelia/runtime-html';\nimport { Queue } from './queue';\nlet BrowserNavigator = class BrowserNavigator {\n    constructor(scheduler, dom) {\n        this.scheduler = scheduler;\n        this.allowedExecutionCostWithinTick = 2; // Limit no of executed actions within the same RAF (due to browser limitation)\n        this.isActive = false;\n        this.options = {\n            useUrlFragmentHash: true,\n            callback: () => { return; },\n        };\n        this.forwardedState = {};\n        this.handlePopstate = (ev) => {\n            return this.enqueue(this, 'popstate', [ev]);\n        };\n        this.processCalls = (qCall) => {\n            const call = qCall;\n            if (call.target === this && call.methodName !== 'forwardState') {\n                call.parameters.push(this.forwardedState.resolve);\n                this.forwardedState.resolve = null;\n                // Should we suppress this popstate event?\n                if (call.methodName === 'popstate' && this.forwardedState.suppressPopstate) {\n                    call.parameters.push(true);\n                    this.forwardedState.suppressPopstate = false;\n                }\n            }\n            // eslint-disable-next-line @typescript-eslint/ban-types\n            const method = call.target[call.methodName];\n            Reporter.write(10000, 'DEQUEUE', call.methodName, call.parameters);\n            if (method) {\n                method.apply(call.target, call.parameters);\n            }\n            qCall.resolve();\n        };\n        this.window = dom.window;\n        this.history = dom.window.history;\n        this.location = dom.window.location;\n        this.pendingCalls = new Queue(this.processCalls);\n    }\n    activate(options) {\n        if (this.isActive) {\n            throw new Error('Browser navigation has already been activated');\n        }\n        this.isActive = true;\n        this.options.callback = options.callback;\n        if (options.useUrlFragmentHash != void 0) {\n            this.options.useUrlFragmentHash = options.useUrlFragmentHash;\n        }\n        this.pendingCalls.activate({ scheduler: this.scheduler, allowedExecutionCostWithinTick: this.allowedExecutionCostWithinTick });\n        this.window.addEventListener('popstate', this.handlePopstate);\n    }\n    deactivate() {\n        if (!this.isActive) {\n            throw new Error('Browser navigation has not been activated');\n        }\n        this.window.removeEventListener('popstate', this.handlePopstate);\n        this.pendingCalls.deactivate();\n        this.options = { useUrlFragmentHash: true, callback: () => { return; } };\n        this.isActive = false;\n    }\n    get length() {\n        return this.history.length;\n    }\n    get state() {\n        return this.history.state;\n    }\n    get viewerState() {\n        const { pathname, search, hash } = this.location;\n        return {\n            path: pathname,\n            query: search,\n            hash,\n            instruction: this.options.useUrlFragmentHash ? hash.slice(1) : pathname,\n        };\n    }\n    go(delta, suppressPopstate = false) {\n        return this.enqueue(this.history, 'go', [delta], suppressPopstate);\n    }\n    pushNavigatorState(state) {\n        const { title, path } = state.currentEntry;\n        const fragment = this.options.useUrlFragmentHash ? '#/' : '';\n        return this.enqueue(this.history, 'pushState', [state, title, `${fragment}${path}`]);\n    }\n    replaceNavigatorState(state) {\n        const { title, path } = state.currentEntry;\n        const fragment = this.options.useUrlFragmentHash ? '#/' : '';\n        return this.enqueue(this.history, 'replaceState', [state, title, `${fragment}${path}`]);\n    }\n    popNavigatorState() {\n        return this.enqueue(this, 'popState', []);\n    }\n    popstate(ev, resolve, suppressPopstate = false) {\n        if (!suppressPopstate) {\n            this.options.callback({\n                ...this.viewerState,\n                ...{\n                    event: ev,\n                    state: this.history.state,\n                },\n            });\n        }\n        if (resolve !== null && resolve !== void 0) {\n            resolve();\n        }\n    }\n    async popState(resolve) {\n        await this.go(-1, true);\n        const state = this.history.state;\n        // TODO: Fix browser forward bug after pop on first entry\n        if (state && state.navigationEntry && !state.navigationEntry.firstEntry) {\n            await this.go(-1, true);\n            return this.pushNavigatorState(state);\n        }\n        resolve();\n    }\n    forwardState(state) {\n        this.forwardedState = state;\n    }\n    // Everything that wants to await a browser event should pass suppressPopstate param\n    // Events NOT resulting in popstate events should NOT pass suppressPopstate param\n    enqueue(target, methodName, parameters, suppressPopstate) {\n        const calls = [];\n        const costs = [];\n        const promises = [];\n        if (suppressPopstate !== undefined) {\n            // Due to (browser) events not having a promise, we create and propagate one\n            let resolve = null;\n            promises.push(new Promise(_resolve => {\n                resolve = _resolve;\n            }));\n            calls.push({\n                target: this,\n                methodName: 'forwardState',\n                parameters: [\n                    {\n                        resolve,\n                        suppressPopstate,\n                    }\n                ],\n            });\n            costs.push(0);\n        }\n        calls.push({\n            target: target,\n            methodName: methodName,\n            parameters: parameters,\n        });\n        costs.push(1);\n        // The first promise is the relevant one since it's either a) the propagated one (in\n        // case of a browser action), or b) the only one since there's only one call\n        promises.push(this.pendingCalls.enqueue(calls, costs)[0]);\n        return promises[0];\n    }\n};\nBrowserNavigator = __decorate([\n    __param(0, IScheduler),\n    __param(1, IDOM),\n    __metadata(\"design:paramtypes\", [Object, HTMLDOM])\n], BrowserNavigator);\nexport { BrowserNavigator };\n//# sourceMappingURL=browser-navigator.js.map","import { IDOM, CustomAttribute } from '@aurelia/runtime';\n/**\n * Class responsible for handling interactions that should trigger navigation.\n */\nexport class LinkHandler {\n    constructor(dom) {\n        this.options = {\n            useHref: true,\n            callback: () => { return; }\n        };\n        this.isActive = false;\n        this.handler = (e) => {\n            const info = LinkHandler.getEventInfo(e, this.window, this.options);\n            if (info.shouldHandleEvent) {\n                e.preventDefault();\n                this.options.callback(info);\n            }\n        };\n        this.window = dom.window;\n        this.document = dom.document;\n    }\n    /**\n     * Gets the href and a \"should handle\" recommendation, given an Event.\n     *\n     * @param event - The Event to inspect for target anchor and href.\n     */\n    static getEventInfo(event, win, options) {\n        const info = {\n            shouldHandleEvent: false,\n            instruction: null,\n            anchor: null\n        };\n        const target = info.anchor = event.currentTarget;\n        // Switch to this for delegation:\n        // const target = info.anchor = LinkHandler.closestAnchor(event.target as Element);\n        if (!target || !LinkHandler.targetIsThisWindow(target, win)) {\n            return info;\n        }\n        if (target.hasAttribute('external')) {\n            return info;\n        }\n        if (event.altKey || event.ctrlKey || event.metaKey || event.shiftKey) {\n            return info;\n        }\n        const gotoAttr = CustomAttribute.for(target, 'goto');\n        const goto = gotoAttr !== void 0 ? gotoAttr.viewModel.value : null;\n        const href = options.useHref && target.hasAttribute('href') ? target.getAttribute('href') : null;\n        if ((goto === null || goto.length === 0) && (href === null || href.length === 0)) {\n            return info;\n        }\n        info.anchor = target;\n        info.instruction = goto || href;\n        const leftButtonClicked = event.button === 0;\n        info.shouldHandleEvent = leftButtonClicked;\n        return info;\n    }\n    /**\n     * Finds the closest ancestor that's an anchor element.\n     *\n     * @param el - The element to search upward from.\n     * @returns The link element that is the closest ancestor.\n     */\n    // private static closestAnchor(el: Element): Element | null {\n    //   while (el !== null && el !== void 0) {\n    //     if (el.tagName === 'A') {\n    //       return el;\n    //     }\n    //     el = el.parentNode as Element;\n    //   }\n    //   return null;\n    // }\n    /**\n     * Gets a value indicating whether or not an anchor targets the current window.\n     *\n     * @param target - The anchor element whose target should be inspected.\n     * @returns True if the target of the link element is this window; false otherwise.\n     */\n    static targetIsThisWindow(target, win) {\n        const targetWindow = target.getAttribute('target');\n        return !targetWindow ||\n            targetWindow === win.name ||\n            targetWindow === '_self';\n    }\n    /**\n     * Activate the instance.\n     *\n     */\n    activate(options) {\n        if (this.isActive) {\n            throw new Error('Link handler has already been activated');\n        }\n        this.isActive = true;\n        this.options = { ...options };\n    }\n    /**\n     * Deactivate the instance. Event handlers and other resources should be cleaned up here.\n     */\n    deactivate() {\n        if (!this.isActive) {\n            throw new Error('Link handler has not been activated');\n        }\n        this.isActive = false;\n    }\n}\nLinkHandler.inject = [IDOM];\n//# sourceMappingURL=link-handler.js.map","export function arrayRemove(arr, func) {\n    const removed = [];\n    let arrIndex = arr.findIndex(func);\n    while (arrIndex >= 0) {\n        removed.push(arr.splice(arrIndex, 1)[0]);\n        arrIndex = arr.findIndex(func);\n    }\n    return removed;\n}\n//# sourceMappingURL=utils.js.map","export function parseQuery(query) {\n    if (!query || !query.length) {\n        return {};\n    }\n    const parameters = {};\n    // TODO: Deal with complex parameters such as lists and objects\n    const params = query.replace('+', ' ').split('&');\n    for (const param of params) {\n        const [key, value] = param.split('=');\n        parameters[decodeURIComponent(key)] = decodeURIComponent(value !== void 0 ? value : key);\n    }\n    return parameters;\n}\n//# sourceMappingURL=parser.js.map","import { Reporter } from '@aurelia/kernel';\nimport { Controller, ILifecycle, CustomElement } from '@aurelia/runtime';\nimport { parseQuery } from './parser';\nimport { ViewportInstruction } from './viewport-instruction';\nexport var ContentStatus;\n(function (ContentStatus) {\n    ContentStatus[ContentStatus[\"none\"] = 0] = \"none\";\n    ContentStatus[ContentStatus[\"created\"] = 1] = \"created\";\n    ContentStatus[ContentStatus[\"loaded\"] = 2] = \"loaded\";\n    ContentStatus[ContentStatus[\"initialized\"] = 3] = \"initialized\";\n    ContentStatus[ContentStatus[\"added\"] = 4] = \"added\";\n})(ContentStatus || (ContentStatus = {}));\nexport class ViewportContent {\n    constructor(\n    // Can (and wants) be a (resolved) type or a string (to be resolved later)\n    content = new ViewportInstruction(''), instruction = {\n        instruction: '',\n        fullStateInstruction: '',\n    }, container = null) {\n        this.content = content;\n        this.instruction = instruction;\n        this.contentStatus = 0 /* none */;\n        this.entered = false;\n        this.fromCache = false;\n        this.fromHistory = false;\n        this.reentry = false;\n        // If we've got a container, we're good to resolve type\n        if (!this.content.isComponentType() && container !== null) {\n            this.content.componentType = this.toComponentType(container);\n        }\n    }\n    get componentInstance() {\n        return this.content.componentInstance;\n    }\n    get viewport() {\n        return this.content.viewport;\n    }\n    equalComponent(other) {\n        return this.content.sameComponent(other.content);\n    }\n    equalParameters(other) {\n        return this.content.sameComponent(other.content, true) &&\n            // TODO: Review whether query is relevant\n            this.instruction.query === other.instruction.query;\n    }\n    reentryBehavior() {\n        return (this.content.componentInstance !== null &&\n            'reentryBehavior' in this.content.componentInstance &&\n            this.content.componentInstance.reentryBehavior !== void 0)\n            ? this.content.componentInstance.reentryBehavior\n            : \"default\" /* default */;\n    }\n    isCacheEqual(other) {\n        return this.content.sameComponent(other.content, true);\n    }\n    createComponent(container, fallback) {\n        if (this.contentStatus !== 0 /* none */) {\n            return;\n        }\n        // Don't load cached content or instantiated history content\n        if (!this.fromCache && !this.fromHistory) {\n            try {\n                this.content.componentInstance = this.toComponentInstance(container);\n            }\n            catch (e) {\n                if (fallback !== void 0) {\n                    this.content.setParameters({ id: this.content.componentName });\n                    this.content.setComponent(fallback);\n                    try {\n                        this.content.componentInstance = this.toComponentInstance(container);\n                    }\n                    catch (ee) {\n                        throw e;\n                    }\n                }\n                else {\n                    throw e;\n                }\n            }\n        }\n        this.contentStatus = 1 /* created */;\n    }\n    destroyComponent() {\n        // TODO: We might want to do something here eventually, who knows?\n        if (this.contentStatus !== 1 /* created */) {\n            return;\n        }\n        // Don't destroy components when stateful\n        this.contentStatus = 0 /* none */;\n    }\n    async canEnter(viewport, previousInstruction) {\n        if (!this.content.componentInstance) {\n            return false;\n        }\n        if (!this.content.componentInstance.canEnter) {\n            return true;\n        }\n        const typeParameters = this.content.componentType ? this.content.componentType.parameters : null;\n        this.instruction.parameters = this.content.toSpecifiedParameters(typeParameters);\n        const merged = { ...parseQuery(this.instruction.query), ...this.instruction.parameters };\n        const result = this.content.componentInstance.canEnter(merged, this.instruction, previousInstruction);\n        Reporter.write(10000, 'viewport canEnter', result);\n        if (typeof result === 'boolean') {\n            return result;\n        }\n        if (typeof result === 'string') {\n            return [viewport.router.createViewportInstruction(result, viewport)];\n        }\n        return result;\n    }\n    async canLeave(nextInstruction) {\n        if (!this.content.componentInstance || !this.content.componentInstance.canLeave) {\n            return true;\n        }\n        const result = this.content.componentInstance.canLeave(nextInstruction, this.instruction);\n        Reporter.write(10000, 'viewport canLeave', result);\n        if (typeof result === 'boolean') {\n            return result;\n        }\n        return result;\n    }\n    async enter(previousInstruction) {\n        // if (!this.reentry && (this.contentStatus !== ContentStatus.created || this.entered)) {\n        if (!this.reentry && (this.contentStatus !== 2 /* loaded */ || this.entered)) {\n            return;\n        }\n        if (this.content.componentInstance && this.content.componentInstance.enter) {\n            const typeParameters = this.content.componentType ? this.content.componentType.parameters : null;\n            this.instruction.parameters = this.content.toSpecifiedParameters(typeParameters);\n            const merged = { ...parseQuery(this.instruction.query), ...this.instruction.parameters };\n            await this.content.componentInstance.enter(merged, this.instruction, previousInstruction);\n        }\n        this.entered = true;\n    }\n    async leave(nextInstruction) {\n        if (this.contentStatus !== 4 /* added */ || !this.entered) {\n            return;\n        }\n        if (this.content.componentInstance && this.content.componentInstance.leave) {\n            await this.content.componentInstance.leave(nextInstruction, this.instruction);\n        }\n        this.entered = false;\n    }\n    // eslint-disable-next-line @typescript-eslint/require-await\n    async loadComponent(container, element, viewport) {\n        // if (this.contentStatus !== ContentStatus.created || !this.entered || !this.content.componentInstance) {\n        if (this.contentStatus !== 1 /* created */ || this.entered || !this.content.componentInstance) {\n            return;\n        }\n        // Don't load cached content or instantiated history content\n        if (!this.fromCache || !this.fromHistory) {\n            const host = element;\n            const controller = Controller.forCustomElement(this.content.componentInstance, container.get(ILifecycle), host, container, void 0, void 0);\n            controller.parent = CustomElement.for(element);\n        }\n        this.contentStatus = 2 /* loaded */;\n    }\n    unloadComponent(cache, stateful = false) {\n        // TODO: We might want to do something here eventually, who knows?\n        if (this.contentStatus !== 2 /* loaded */) {\n            return;\n        }\n        // Don't unload components when stateful\n        if (!stateful) {\n            this.contentStatus = 1 /* created */;\n        }\n        else {\n            cache.push(this);\n        }\n    }\n    initializeComponent(parent) {\n        if (this.contentStatus !== 2 /* loaded */) {\n            return;\n        }\n        // Don't initialize cached content or instantiated history content\n        // if (!this.fromCache || !this.fromHistory) {\n        // ((this.content.componentInstance as IRouteableComponent).$controller as IController).parent = parent;\n        this.content.componentInstance.$controller.bind(1024 /* fromStartTask */ | 4096 /* fromBind */);\n        // }\n        this.contentStatus = 3 /* initialized */;\n    }\n    async terminateComponent(stateful = false) {\n        if (this.contentStatus !== 3 /* initialized */) {\n            return;\n        }\n        // Don't terminate cached content\n        // if (!stateful) {\n        await this.content.componentInstance.$controller.unbind(2048 /* fromStopTask */ | 8192 /* fromUnbind */).wait();\n        // ((this.content.componentInstance as IRouteableComponent).$controller as IController).parent = void 0;\n        // }\n        this.contentStatus = 2 /* loaded */;\n    }\n    addComponent(element) {\n        if (this.contentStatus !== 3 /* initialized */) {\n            return;\n        }\n        this.content.componentInstance.$controller.attach(1024 /* fromStartTask */);\n        if (this.fromCache || this.fromHistory) {\n            const elements = Array.from(element.getElementsByTagName('*'));\n            for (const el of elements) {\n                const attr = el.getAttribute('au-element-scroll');\n                if (attr) {\n                    const [top, left] = attr.split(',');\n                    el.removeAttribute('au-element-scroll');\n                    el.scrollTo(+left, +top);\n                }\n            }\n        }\n        this.contentStatus = 4 /* added */;\n    }\n    removeComponent(element, stateful = false) {\n        if (this.contentStatus !== 4 /* added */ || this.entered) {\n            return;\n        }\n        if (stateful && element !== null) {\n            const elements = Array.from(element.getElementsByTagName('*'));\n            for (const el of elements) {\n                if (el.scrollTop > 0 || el.scrollLeft) {\n                    el.setAttribute('au-element-scroll', `${el.scrollTop},${el.scrollLeft}`);\n                }\n            }\n        }\n        this.content.componentInstance.$controller.detach(2048 /* fromStopTask */);\n        this.contentStatus = 3 /* initialized */;\n    }\n    async freeContent(element, nextInstruction, cache, stateful = false) {\n        switch (this.contentStatus) {\n            case 4 /* added */:\n                await this.leave(nextInstruction);\n                this.removeComponent(element, stateful);\n            case 3 /* initialized */:\n                await this.terminateComponent(stateful);\n            case 2 /* loaded */:\n                this.unloadComponent(cache, stateful);\n            case 1 /* created */:\n                this.destroyComponent();\n        }\n    }\n    toComponentName() {\n        return this.content.componentName;\n    }\n    toComponentType(container) {\n        if (this.content.isEmpty()) {\n            return null;\n        }\n        return this.content.toComponentType(container);\n    }\n    toComponentInstance(container) {\n        if (this.content.isEmpty()) {\n            return null;\n        }\n        return this.content.toComponentInstance(container);\n    }\n}\n//# sourceMappingURL=viewport-content.js.map","import { ViewportInstruction } from './viewport-instruction';\nimport { Scope } from './scope';\nimport { arrayRemove } from './utils';\nexport class ViewportScope {\n    constructor(name, router, element, owningScope, scope, rootComponentType = null, // temporary. Metadata will probably eliminate it\n    options = {\n        catches: [],\n        source: null,\n    }) {\n        this.name = name;\n        this.router = router;\n        this.element = element;\n        this.rootComponentType = rootComponentType;\n        this.options = options;\n        this.path = null;\n        this.content = null;\n        this.nextContent = null;\n        this.available = true;\n        this.sourceItem = null;\n        this.sourceItemIndex = -1;\n        this.remove = false;\n        this.add = false;\n        this.connectedScope = new Scope(router, scope, owningScope, null, this);\n        if (this.catches.length > 0) {\n            this.content = router.createViewportInstruction(this.catches[0], this.name);\n        }\n    }\n    get scope() {\n        return this.connectedScope.scope;\n    }\n    get owningScope() {\n        return this.connectedScope.owningScope;\n    }\n    get enabled() {\n        return this.connectedScope.enabled;\n    }\n    set enabled(enabled) {\n        this.connectedScope.enabled = enabled;\n    }\n    get isViewport() {\n        return false;\n    }\n    get isViewportScope() {\n        return true;\n    }\n    get isEmpty() {\n        return this.content === null;\n    }\n    get passThroughScope() {\n        return this.rootComponentType === null && this.catches.length === 0;\n    }\n    get siblings() {\n        const parent = this.connectedScope.parent;\n        if (parent === null) {\n            return [this];\n        }\n        return parent.enabledChildren\n            .filter(child => child.isViewportScope && child.viewportScope.name === this.name)\n            .map(child => child.viewportScope);\n    }\n    get source() {\n        return this.options.source || null;\n    }\n    get catches() {\n        let catches = this.options.catches || [];\n        if (typeof catches === 'string') {\n            catches = catches.split(',');\n        }\n        return catches;\n    }\n    get default() {\n        if (this.catches.length > 0) {\n            return this.catches[0];\n        }\n    }\n    setNextContent(content, instruction) {\n        let viewportInstruction;\n        if (content instanceof ViewportInstruction) {\n            viewportInstruction = content;\n        }\n        else {\n            if (typeof content === 'string') {\n                viewportInstruction = this.router.instructionResolver.parseViewportInstruction(content);\n            }\n            else {\n                viewportInstruction = this.router.createViewportInstruction(content);\n            }\n        }\n        viewportInstruction.viewportScope = this;\n        this.remove = this.router.instructionResolver.isClearViewportInstruction(viewportInstruction)\n            || this.router.instructionResolver.isClearAllViewportsInstruction(viewportInstruction);\n        this.add = this.router.instructionResolver.isAddViewportInstruction(viewportInstruction)\n            && Array.isArray(this.source);\n        if (this.add) {\n            viewportInstruction.componentName = null;\n        }\n        if (this.default !== void 0 && viewportInstruction.componentName === null) {\n            viewportInstruction.componentName = this.default;\n        }\n        this.nextContent = viewportInstruction;\n        return true;\n    }\n    canLeave() {\n        return Promise.resolve(true);\n    }\n    canEnter() {\n        return Promise.resolve(true);\n    }\n    enter() {\n        return Promise.resolve(true);\n    }\n    loadContent() {\n        this.content = !this.remove ? this.nextContent : null;\n        this.nextContent = null;\n        return Promise.resolve(true);\n    }\n    finalizeContentChange() {\n        // console.log('ViewportScope finalizing', this.content);\n        if (this.remove && Array.isArray(this.source)) {\n            this.removeSourceItem();\n        }\n    }\n    abortContentChange() {\n        this.nextContent = null;\n        if (this.add) {\n            const index = this.source.indexOf(this.sourceItem);\n            this.source.splice(index, 1);\n            this.sourceItem = null;\n        }\n        return Promise.resolve();\n    }\n    acceptSegment(segment) {\n        if (segment === null && segment === void 0 || segment.length === 0) {\n            return true;\n        }\n        if (segment === this.router.instructionResolver.clearViewportInstruction\n            || segment === this.router.instructionResolver.addViewportInstruction\n            || segment === this.name) {\n            return true;\n        }\n        if (this.catches.length === 0) {\n            return true;\n        }\n        if (this.catches.includes(segment)) {\n            return true;\n        }\n        if (this.catches.filter((value) => value.includes('*')).length) {\n            return true;\n        }\n        return false;\n    }\n    beforeBind() {\n        const source = this.source || [];\n        if (source.length > 0 && this.sourceItem === null) {\n            this.sourceItem = this.getAvailableSourceItem();\n        }\n    }\n    beforeUnbind() {\n        if (this.sourceItem !== null && this.source !== null) {\n            arrayRemove(this.source, (item) => item === this.sourceItem);\n        }\n        this.sourceItem = null;\n    }\n    getAvailableSourceItem() {\n        if (this.source === null) {\n            return null;\n        }\n        const siblings = this.siblings;\n        for (const item of this.source) {\n            if (siblings.every(sibling => sibling.sourceItem !== item)) {\n                return item;\n            }\n        }\n        return null;\n    }\n    addSourceItem() {\n        const item = {};\n        this.source.push(item);\n        return item;\n    }\n    removeSourceItem() {\n        this.sourceItemIndex = this.source.indexOf(this.sourceItem);\n        if (this.sourceItemIndex >= 0) {\n            this.source.splice(this.sourceItemIndex, 1);\n        }\n    }\n    getRoutes() {\n        if (this.rootComponentType !== null) {\n            return this.rootComponentType.routes;\n        }\n        return null;\n    }\n}\n//# sourceMappingURL=viewport-scope.js.map","import { buildQueryString, parseQueryString } from '@aurelia/kernel';\nexport class HandlerEntry {\n    constructor(handler, names) {\n        this.handler = handler;\n        this.names = names;\n    }\n}\n/*\n* An object that is indexed and used for route generation, particularly for dynamic routes.\n*/\nexport class RouteGenerator {\n    constructor(segments, handlers) {\n        this.segments = segments;\n        this.handlers = handlers;\n    }\n}\nexport class TypesRecord {\n    constructor() {\n        this.statics = 0;\n        this.dynamics = 0;\n        this.stars = 0;\n    }\n}\nexport class RecognizeResult {\n    constructor(handler, params, isDynamic) {\n        this.handler = handler;\n        this.params = params;\n        this.isDynamic = isDynamic;\n    }\n}\nexport class CharSpec {\n    constructor(invalidChars, validChars, repeat) {\n        this.invalidChars = invalidChars;\n        this.validChars = validChars;\n        this.repeat = repeat;\n    }\n    equals(other) {\n        return this.validChars === other.validChars && this.invalidChars === other.invalidChars;\n    }\n}\nexport class State {\n    constructor(charSpec) {\n        this.charSpec = charSpec;\n        this.nextStates = [];\n    }\n    put(charSpec) {\n        let state = this.nextStates.find(s => s.charSpec.equals(charSpec));\n        if (state === undefined) {\n            state = new State(charSpec);\n            this.nextStates.push(state);\n            if (charSpec.repeat) {\n                state.nextStates.push(state);\n            }\n        }\n        return state;\n    }\n}\nconst specials = [\n    '/', '.', '*', '+', '?', '|',\n    '(', ')', '[', ']', '{', '}', '\\\\'\n];\nconst escapeRegex = new RegExp(`(\\\\${specials.join('|\\\\')})`, 'g');\n// A Segment represents a segment in the original route description.\n// Each Segment type provides an `eachChar` and `regex` method.\n//\n// The `eachChar` method invokes the callback with one or more character\n// specifications. A character specification consumes one or more input\n// characters.\n//\n// The `regex` method returns a regex fragment for the segment. If the\n// segment is a dynamic or star segment, the regex fragment also includes\n// a capture.\n//\n// A character specification contains:\n//\n// * `validChars`: a String with a list of all valid characters, or\n// * `invalidChars`: a String with a list of all invalid characters\n// * `repeat`: true if the character specification can repeat\nexport class StaticSegment {\n    constructor(str, caseSensitive) {\n        this.caseSensitive = caseSensitive;\n        this.optional = false;\n        this.name = str;\n        this.string = str;\n    }\n    eachChar(callback) {\n        const s = this.string;\n        const len = s.length;\n        let i = 0;\n        let ch = '';\n        if (this.caseSensitive) {\n            for (; i < len; ++i) {\n                ch = s.charAt(i);\n                callback(new CharSpec(null, ch, false));\n            }\n        }\n        else {\n            for (; i < len; ++i) {\n                ch = s.charAt(i);\n                callback(new CharSpec(null, ch.toUpperCase() + ch.toLowerCase(), false));\n            }\n        }\n    }\n    regex() {\n        return this.string.replace(escapeRegex, '\\\\$1');\n    }\n    generate(params, consumed) {\n        return this.string;\n    }\n}\nexport class DynamicSegment {\n    constructor(name, optional) {\n        this.name = name;\n        this.optional = optional;\n    }\n    eachChar(callback) {\n        callback(new CharSpec('/', null, true));\n    }\n    regex() {\n        return '([^/]+)';\n    }\n    generate(params, consumed) {\n        consumed[this.name] = true;\n        return params[this.name];\n    }\n}\nexport class StarSegment {\n    constructor(name) {\n        this.name = name;\n        this.optional = false;\n    }\n    eachChar(callback) {\n        callback(new CharSpec('', null, true));\n    }\n    regex() {\n        return '(.+)';\n    }\n    generate(params, consumed) {\n        consumed[this.name] = true;\n        return params[this.name];\n    }\n}\nexport class EpsilonSegment {\n    eachChar(callback) {\n        return;\n    }\n    regex() {\n        return '';\n    }\n    generate(params, consumed) {\n        return '';\n    }\n}\n/**\n * Class that parses route patterns and matches path strings.\n */\nexport class RouteRecognizer {\n    constructor() {\n        this.rootState = new State();\n        this.names = {};\n        this.routes = new Map();\n    }\n    /**\n     * Parse a route pattern and add it to the collection of recognized routes.\n     *\n     * @param route - The route to add.\n     */\n    add(route) {\n        if (Array.isArray(route)) {\n            route.forEach(r => {\n                this.add(r);\n            });\n            return;\n        }\n        let currentState = this.rootState;\n        const skippableStates = [];\n        let regex = '^';\n        const types = new TypesRecord();\n        const names = [];\n        const routeName = route.handler.name;\n        let isEmpty = true;\n        let normalizedRoute = route.path;\n        if (normalizedRoute.startsWith('/')) {\n            normalizedRoute = normalizedRoute.slice(1);\n        }\n        const segments = [];\n        const splitRoute = normalizedRoute.split('/');\n        let part;\n        let segment;\n        for (let i = 0, ii = splitRoute.length; i < ii; ++i) {\n            part = splitRoute[i];\n            // Try to parse a parameter :param?\n            let match = /^:([^?]+)(\\?)?$/.exec(part);\n            if (match) {\n                const [, name, optional] = match;\n                if (name.includes('=')) {\n                    throw new Error(`Parameter ${name} in route ${route} has a default value, which is not supported.`);\n                }\n                segments.push(segment = new DynamicSegment(name, !!optional));\n                names.push(name);\n                types.dynamics++;\n            }\n            else {\n                // Try to parse a star segment *whatever\n                match = /^\\*(.+)$/.exec(part);\n                if (match) {\n                    segments.push(segment = new StarSegment(match[1]));\n                    names.push(match[1]);\n                    types.stars++;\n                }\n                else if (part === '') {\n                    segments.push(new EpsilonSegment());\n                    continue;\n                }\n                else {\n                    segments.push(segment = new StaticSegment(part, route.caseSensitive === true));\n                    types.statics++;\n                }\n            }\n            // Add a representation of the segment to the NFA and regex\n            const firstState = currentState.put(new CharSpec(null, '/', false));\n            let nextState = firstState;\n            segment.eachChar(ch => {\n                nextState = nextState.put(ch);\n            });\n            // add the first part of the next segment to the end of any skipped states\n            for (let j = 0, jj = skippableStates.length; j < jj; j++) {\n                skippableStates[j].nextStates.push(firstState);\n            }\n            // If the segment was optional we don't fast forward to the end of the\n            // segment, but we do hold on to a reference to the end of the segment\n            // for adding future segments. Multiple consecutive optional segments\n            // will accumulate.\n            if (segment.optional) {\n                skippableStates.push(nextState);\n                regex += `(?:/${segment.regex()})?`;\n                // Otherwise, we fast forward to the end of the segment and remove any\n                // references to skipped segments since we don't need them anymore.\n            }\n            else {\n                currentState = nextState;\n                regex += `/${segment.regex()}`;\n                skippableStates.length = 0;\n                isEmpty = false;\n            }\n        }\n        // An \"all optional\" path is technically empty since currentState is this.rootState\n        if (isEmpty) {\n            currentState = currentState.put(new CharSpec(null, '/', false));\n            regex += '/?';\n        }\n        const handlers = [new HandlerEntry(route.handler, names)];\n        this.routes.set(route.handler, new RouteGenerator(segments, handlers));\n        if (routeName) {\n            const routeNames = Array.isArray(routeName) ? routeName : [routeName];\n            for (let i = 0; i < routeNames.length; i++) {\n                if (!(routeNames[i] in this.names)) {\n                    this.names[routeNames[i]] = new RouteGenerator(segments, handlers);\n                }\n            }\n        }\n        // Any trailing skipped states need to be endpoints and need to have\n        // handlers afterAttach.\n        for (let i = 0; i < skippableStates.length; i++) {\n            const state = skippableStates[i];\n            state.handlers = handlers;\n            state.regex = new RegExp(`${regex}$`, route.caseSensitive ? '' : 'i');\n            state.types = types;\n        }\n        currentState.handlers = handlers;\n        currentState.regex = new RegExp(`${regex}$`, route.caseSensitive ? '' : 'i');\n        currentState.types = types;\n        return currentState;\n    }\n    /**\n     * Retrieve a RouteGenerator for a route by name or RouteConfig (RouteHandler).\n     *\n     * @param nameOrRoute - The name of the route or RouteConfig object.\n     * @returns The RouteGenerator for that route.\n     */\n    getRoute(nameOrRoute) {\n        return typeof nameOrRoute === 'string' ? this.names[nameOrRoute] : this.routes.get(nameOrRoute);\n    }\n    /**\n     * Retrieve the handlers registered for the route by name or RouteConfig (RouteHandler).\n     *\n     * @param nameOrRoute - The name of the route or RouteConfig object.\n     * @returns The handlers.\n     */\n    handlersFor(nameOrRoute) {\n        const route = this.getRoute(nameOrRoute);\n        if (!route) {\n            throw new Error(`There is no route named ${nameOrRoute}`);\n        }\n        return [...route.handlers];\n    }\n    /**\n     * Check if this RouteRecognizer recognizes a route by name or RouteConfig (RouteHandler).\n     *\n     * @param nameOrRoute - The name of the route or RouteConfig object.\n     * @returns True if the named route is recognized.\n     */\n    hasRoute(nameOrRoute) {\n        return !!this.getRoute(nameOrRoute);\n    }\n    /**\n     * Generate a path and query string from a route name or RouteConfig (RouteHandler) and params object.\n     *\n     * @param nameOrRoute - The name of the route or RouteConfig object.\n     * @param params - The route params to use when populating the pattern.\n     * Properties not required by the pattern will be appended to the query string.\n     * @returns The generated absolute path and query string.\n     */\n    generate(nameOrRoute, params) {\n        const route = this.getRoute(nameOrRoute);\n        if (!route) {\n            throw new Error(`There is no route named ${nameOrRoute}`);\n        }\n        const handler = route.handlers[0].handler;\n        if (handler.generationUsesHref) {\n            return handler.href;\n        }\n        const routeParams = { ...params };\n        const segments = route.segments;\n        const consumed = {};\n        let output = '';\n        for (let i = 0, l = segments.length; i < l; i++) {\n            const segment = segments[i];\n            if (segment instanceof EpsilonSegment) {\n                continue;\n            }\n            const segmentValue = segment.generate(routeParams, consumed);\n            if (segmentValue == null) {\n                if (!segment.optional) {\n                    throw new Error(`A value is required for route parameter '${segment.name}' in route '${nameOrRoute}'.`);\n                }\n            }\n            else {\n                output += '/';\n                output += segmentValue;\n            }\n        }\n        if (!output.startsWith('/')) {\n            output = `/${output}`;\n        }\n        // remove params used in the path and add the rest to the querystring\n        for (const param in consumed) {\n            Reflect.deleteProperty(routeParams, param);\n        }\n        const queryString = buildQueryString(routeParams);\n        output += queryString ? `?${queryString}` : '';\n        return output;\n    }\n    /**\n     * Match a path string against registered route patterns.\n     *\n     * @param path - The path to attempt to match.\n     * @returns Array of objects containing `handler`, `params`, and\n     * `isDynamic` values for the matched route(s), or undefined if no match\n     * was found.\n     */\n    recognize(path) {\n        let states = [this.rootState];\n        let queryParams = {};\n        let isSlashDropped = false;\n        let normalizedPath = path;\n        const queryStart = normalizedPath.indexOf('?');\n        if (queryStart !== -1) {\n            const queryString = normalizedPath.slice(queryStart + 1);\n            normalizedPath = normalizedPath.slice(0, queryStart);\n            queryParams = parseQueryString(queryString);\n        }\n        normalizedPath = decodeURI(normalizedPath);\n        if (!normalizedPath.startsWith('/')) {\n            normalizedPath = `/${normalizedPath}`;\n        }\n        let pathLen = normalizedPath.length;\n        if (pathLen > 1 && normalizedPath.charAt(pathLen - 1) === '/') {\n            normalizedPath = normalizedPath.slice(0, -1);\n            isSlashDropped = true;\n            --pathLen;\n        }\n        for (let i = 0; i < pathLen; ++i) {\n            const nextStates = [];\n            const ch = normalizedPath.charAt(i);\n            states.forEach(state => {\n                state.nextStates.forEach(nextState => {\n                    if (nextState.charSpec.validChars !== null) {\n                        if (nextState.charSpec.validChars.includes(ch)) {\n                            nextStates.push(nextState);\n                        }\n                    }\n                    else if (nextState.charSpec.invalidChars !== null\n                        && !nextState.charSpec.invalidChars.includes(ch)) {\n                        nextStates.push(nextState);\n                    }\n                });\n            });\n            states = nextStates;\n            if (states.length === 0) {\n                break;\n            }\n        }\n        const solutions = [];\n        for (let i = 0, l = states.length; i < l; i++) {\n            if (states[i].handlers) {\n                solutions.push(states[i]);\n            }\n        }\n        // This is a somewhat naive strategy, but should work in a lot of cases\n        // A better strategy would properly resolve /posts/:id/new and /posts/edit/:id.\n        //\n        // This strategy generally prefers more static and less dynamic matching.\n        // Specifically, it\n        //\n        //  * prefers fewer stars to more, then\n        //  * prefers using stars for less of the match to more, then\n        //  * prefers fewer dynamic segments to more, then\n        //  * prefers more static segments to more\n        solutions.sort((a, b) => {\n            if (a.types.stars !== b.types.stars) {\n                return a.types.stars - b.types.stars;\n            }\n            if (a.types.stars) {\n                if (a.types.statics !== b.types.statics) {\n                    return b.types.statics - a.types.statics;\n                }\n                if (a.types.dynamics !== b.types.dynamics) {\n                    return b.types.dynamics - a.types.dynamics;\n                }\n            }\n            if (a.types.dynamics !== b.types.dynamics) {\n                return a.types.dynamics - b.types.dynamics;\n            }\n            if (a.types.statics !== b.types.statics) {\n                return b.types.statics - a.types.statics;\n            }\n            return 0;\n        });\n        const solution = solutions[0];\n        if (solution && solution.handlers) {\n            // if a trailing slash was dropped and a star segment is the last segment\n            // specified, put the trailing slash back\n            if (isSlashDropped && solution.regex.source.endsWith('(.+)$')) {\n                normalizedPath = `${normalizedPath}/`;\n            }\n            // eslint-disable-next-line @typescript-eslint/prefer-regexp-exec\n            const captures = normalizedPath.match(solution.regex);\n            let currentCapture = 1;\n            const result = [];\n            result.queryParams = queryParams;\n            solution.handlers.forEach(handler => {\n                const params = {};\n                handler.names.forEach(name => {\n                    params[name] = captures[currentCapture++];\n                });\n                result.push(new RecognizeResult(handler.handler, params, handler.names.length > 0));\n            });\n            return result;\n        }\n        return void 0;\n    }\n}\n//# sourceMappingURL=route-recognizer.js.map","export class FoundRoute {\n    constructor(match = null, matching = '', instructions = [], remaining = '') {\n        this.match = match;\n        this.matching = matching;\n        this.instructions = instructions;\n        this.remaining = remaining;\n    }\n    get foundConfiguration() {\n        return this.match !== null;\n    }\n    get foundInstructions() {\n        return this.instructions.length > 0;\n    }\n    get hasRemaining() {\n        return this.remaining !== null && this.remaining.length > 0;\n    }\n}\n//# sourceMappingURL=found-route.js.map","import { arrayRemove } from './utils';\nexport class Collection extends Array {\n    constructor() {\n        super(...arguments);\n        this.currentIndex = -1;\n    }\n    next() {\n        if (this.length > this.currentIndex + 1) {\n            return this[++this.currentIndex];\n        }\n        else {\n            this.currentIndex = -1;\n            return null;\n        }\n    }\n    removeCurrent() {\n        this.splice(this.currentIndex--, 1);\n    }\n    remove(instruction) {\n        arrayRemove(this, value => value === instruction);\n    }\n}\n//# sourceMappingURL=collection.js.map","import { ViewportScope } from './viewport-scope';\nimport { RouteRecognizer } from './route-recognizer';\nimport { FoundRoute } from './found-route';\nimport { NavigationInstructionResolver } from './type-resolvers';\nimport { Viewport } from './viewport';\nimport { arrayRemove } from './utils';\nimport { Collection } from './collection';\nexport class Scope {\n    constructor(router, hasScope, owningScope, viewport = null, viewportScope = null, rootComponentType = null) {\n        this.router = router;\n        this.hasScope = hasScope;\n        this.owningScope = owningScope;\n        this.viewport = viewport;\n        this.viewportScope = viewportScope;\n        this.rootComponentType = rootComponentType;\n        this.id = '.';\n        this.parent = null;\n        this.children = [];\n        this.replacedChildren = [];\n        this.path = null;\n        this.enabled = true;\n        // Support collection feature in viewport scopes\n        this.childCollections = {};\n        this.owningScope = owningScope || this;\n        this.scope = this.hasScope ? this : this.owningScope;\n    }\n    get isViewport() {\n        return this.viewport !== null;\n    }\n    get isViewportScope() {\n        return this.viewportScope !== null;\n    }\n    get passThroughScope() {\n        return this.isViewportScope && this.viewportScope.passThroughScope;\n    }\n    get owner() {\n        if (this.isViewport) {\n            return this.viewport;\n        }\n        if (this.isViewportScope) {\n            return this.viewportScope;\n        }\n        return null;\n    }\n    get enabledChildren() {\n        return this.children.filter(scope => scope.enabled);\n    }\n    get hoistedChildren() {\n        const scopes = this.enabledChildren;\n        while (scopes.some(scope => scope.passThroughScope)) {\n            for (const scope of scopes.slice()) {\n                if (scope.passThroughScope) {\n                    const index = scopes.indexOf(scope);\n                    scopes.splice(index, 1, ...scope.enabledChildren);\n                }\n            }\n        }\n        return scopes;\n    }\n    get enabledViewports() {\n        return this.children.filter(scope => scope.isViewport && scope.enabled)\n            .map(scope => scope.viewport);\n    }\n    get viewportInstruction() {\n        if (this.isViewportScope) {\n            return this.viewportScope.content;\n        }\n        if (this.isViewport) {\n            return this.viewport.content.content;\n        }\n        return null;\n    }\n    getEnabledViewports(viewportScopes) {\n        return viewportScopes.filter(scope => !scope.isViewportScope).map(scope => scope.viewport).reduce((viewports, viewport) => {\n            viewports[viewport.name] = viewport;\n            return viewports;\n        }, {});\n    }\n    getOwnedViewports(includeDisabled = false) {\n        return this.allViewports(includeDisabled).filter(viewport => viewport.owningScope === this);\n    }\n    getOwnedScopes(includeDisabled = false) {\n        const scopes = this.allScopes(includeDisabled).filter(scope => scope.owningScope === this);\n        // Hoist children to pass through scopes\n        for (const scope of scopes.slice()) {\n            if (scope.passThroughScope) {\n                const index = scopes.indexOf(scope);\n                scopes.splice(index, 1, ...scope.getOwnedScopes());\n            }\n        }\n        return scopes;\n    }\n    // Note: This can't change state other than the instructions!\n    findViewports(instructions, alreadyFound, disregardViewports = false) {\n        const foundViewports = [];\n        let remainingInstructions = [];\n        const ownedScopes = this.getOwnedScopes();\n        // Get a shallow copy of all available manual viewport scopes\n        const viewportScopes = ownedScopes.filter(scope => scope.isViewportScope).map(scope => scope.viewportScope);\n        const availableViewportScopes = viewportScopes.filter(viewportScope => alreadyFound.every(found => found.viewportScope !== viewportScope));\n        // Get a shallow copy of all available viewports\n        const availableViewports = { ...this.getEnabledViewports(ownedScopes) };\n        for (const instruction of alreadyFound.filter(found => found.scope === this)) {\n            availableViewports[instruction.viewportName] = null;\n        }\n        const viewportInstructions = new Collection(...instructions.slice());\n        let instruction = null;\n        // The viewport scope is already known\n        while ((instruction = viewportInstructions.next()) !== null) {\n            if (instruction.viewportScope !== null && !this.router.instructionResolver.isAddViewportInstruction(instruction)) {\n                remainingInstructions.push(...this.foundViewportScope(instruction, instruction.viewportScope));\n                foundViewports.push(instruction);\n                arrayRemove(availableViewportScopes, available => available === instruction.viewportScope);\n                viewportInstructions.removeCurrent();\n            }\n        }\n        // The viewport is already known\n        if (!disregardViewports) {\n            while ((instruction = viewportInstructions.next()) !== null) {\n                if (instruction.viewport) {\n                    remainingInstructions.push(...this.foundViewport(instruction, instruction.viewport, disregardViewports));\n                    foundViewports.push(instruction);\n                    availableViewports[instruction.viewport.name] = null;\n                    viewportInstructions.removeCurrent();\n                }\n            }\n        }\n        // Viewport scopes have priority\n        while ((instruction = viewportInstructions.next()) !== null) {\n            for (let viewportScope of viewportScopes) {\n                if (viewportScope.acceptSegment(instruction.componentName)) {\n                    if (Array.isArray(viewportScope.source)) {\n                        // console.log('available', viewportScope.available, source);\n                        let available = availableViewportScopes.find(available => available.name === viewportScope.name);\n                        if (available === void 0 || this.router.instructionResolver.isAddViewportInstruction(instruction)) {\n                            const item = viewportScope.addSourceItem();\n                            available = this.getOwnedScopes()\n                                .filter(scope => scope.isViewportScope)\n                                .map(scope => scope.viewportScope)\n                                .find(viewportScope => viewportScope.sourceItem === item);\n                        }\n                        viewportScope = available;\n                    }\n                    remainingInstructions.push(...this.foundViewportScope(instruction, viewportScope));\n                    foundViewports.push(instruction);\n                    arrayRemove(availableViewportScopes, available => available === instruction.viewportScope);\n                    viewportInstructions.removeCurrent();\n                    break;\n                }\n            }\n        }\n        // Configured viewport is ruling\n        while ((instruction = viewportInstructions.next()) !== null) {\n            instruction.needsViewportDescribed = true;\n            for (const name in availableViewports) {\n                if (Object.prototype.hasOwnProperty.call(availableViewports, name)) {\n                    const viewport = availableViewports[name];\n                    // TODO: Also check if (resolved) component wants a specific viewport\n                    if (viewport && viewport.wantComponent(instruction.componentName)) {\n                        const remaining = this.foundViewport(instruction, viewport, disregardViewports, true);\n                        foundViewports.push(instruction);\n                        remainingInstructions.push(...remaining);\n                        availableViewports[name] = null;\n                        viewportInstructions.removeCurrent();\n                        break;\n                    }\n                }\n            }\n        }\n        // Next in line is specified viewport (but not if we're disregarding viewports)\n        if (!disregardViewports) {\n            while ((instruction = viewportInstructions.next()) !== null) {\n                const name = instruction.viewportName;\n                if (!name || !name.length) {\n                    continue;\n                }\n                const newScope = instruction.ownsScope;\n                if (!this.getEnabledViewports(ownedScopes)[name]) {\n                    continue;\n                    // TODO: No longer pre-creating viewports. Evaluate!\n                    this.addViewport(name, null, null, { scope: newScope, forceDescription: true });\n                    availableViewports[name] = this.getEnabledViewports(ownedScopes)[name];\n                }\n                const viewport = availableViewports[name];\n                if (viewport && viewport.acceptComponent(instruction.componentName)) {\n                    const remaining = this.foundViewport(instruction, viewport, disregardViewports, true);\n                    foundViewports.push(instruction);\n                    remainingInstructions.push(...remaining);\n                    availableViewports[name] = null;\n                    viewportInstructions.removeCurrent();\n                }\n            }\n        }\n        // Finally, only one accepting viewport left?\n        while ((instruction = viewportInstructions.next()) !== null) {\n            const remainingViewports = [];\n            for (const name in availableViewports) {\n                if (Object.prototype.hasOwnProperty.call(availableViewports, name)) {\n                    const viewport = availableViewports[name];\n                    if (viewport && viewport.acceptComponent(instruction.componentName)) {\n                        remainingViewports.push(viewport);\n                    }\n                }\n            }\n            if (remainingViewports.length === 1) {\n                const viewport = remainingViewports.shift();\n                const remaining = this.foundViewport(instruction, viewport, disregardViewports, true);\n                foundViewports.push(instruction);\n                remainingInstructions.push(...remaining);\n                availableViewports[viewport.name] = null;\n                viewportInstructions.removeCurrent();\n            }\n        }\n        // If we're ignoring viewports, we now match them anyway\n        if (disregardViewports) {\n            while ((instruction = viewportInstructions.next()) !== null) {\n                let viewport = instruction.viewport;\n                if (!viewport) {\n                    const name = instruction.viewportName;\n                    if (!name || !name.length) {\n                        continue;\n                    }\n                    const newScope = instruction.ownsScope;\n                    if (!this.getEnabledViewports(ownedScopes)[name]) {\n                        continue;\n                        // TODO: No longer pre-creating viewports. Evaluate!\n                        this.addViewport(name, null, null, { scope: newScope, forceDescription: true });\n                        availableViewports[name] = this.getEnabledViewports(ownedScopes)[name];\n                    }\n                    viewport = availableViewports[name];\n                }\n                if (viewport && viewport.acceptComponent(instruction.componentName)) {\n                    const remaining = this.foundViewport(instruction, viewport, disregardViewports);\n                    foundViewports.push(instruction);\n                    remainingInstructions.push(...remaining);\n                    availableViewports[viewport.name] = null;\n                    viewportInstructions.removeCurrent();\n                }\n            }\n        }\n        remainingInstructions = [...viewportInstructions, ...remainingInstructions];\n        return {\n            foundViewports,\n            remainingInstructions,\n        };\n    }\n    foundViewportScope(instruction, viewportScope) {\n        instruction.viewportScope = viewportScope;\n        instruction.needsViewportDescribed = false;\n        const remaining = (instruction.nextScopeInstructions || []).slice();\n        for (const rem of remaining) {\n            if (rem.scope === null) {\n                rem.scope = viewportScope.scope.scope;\n            }\n        }\n        return remaining;\n    }\n    foundViewport(instruction, viewport, withoutViewports, doesntNeedViewportDescribed = false) {\n        instruction.setViewport(viewport);\n        if (doesntNeedViewportDescribed) {\n            instruction.needsViewportDescribed = false;\n        }\n        const remaining = (instruction.nextScopeInstructions || []).slice();\n        for (const rem of remaining) {\n            if (rem.scope === null) {\n                rem.scope = viewport.scope;\n            }\n        }\n        return remaining;\n    }\n    addViewport(name, element, container, options = {}) {\n        let viewport = this.getEnabledViewports(this.getOwnedScopes())[name];\n        // Each au-viewport element has its own Viewport\n        if (element && viewport && viewport.element !== null && viewport.element !== element) {\n            viewport.enabled = false;\n            viewport = this.getOwnedViewports(true).find(child => child.name === name && child.element === element) || null;\n            if (viewport) {\n                viewport.enabled = true;\n            }\n        }\n        if (!viewport) {\n            viewport = new Viewport(this.router, name, null, null, this.scope, !!options.scope, options);\n            this.addChild(viewport.connectedScope);\n        }\n        // TODO: Either explain why || instead of && here (might only need one) or change it to && if that should turn out to not be relevant\n        if (element || container) {\n            viewport.setElement(element, container, options);\n        }\n        return viewport;\n    }\n    removeViewport(viewport, element, container) {\n        if ((!element && !container) || viewport.remove(element, container)) {\n            this.removeChild(viewport.connectedScope);\n            return true;\n        }\n        return false;\n    }\n    addViewportScope(name, element, options = {}) {\n        const viewportScope = new ViewportScope(name, this.router, element, this.scope, true, null, options);\n        this.addChild(viewportScope.connectedScope);\n        return viewportScope;\n    }\n    removeViewportScope(viewportScope) {\n        // viewportScope.remove();\n        this.removeChild(viewportScope.connectedScope);\n        return true;\n    }\n    addChild(scope) {\n        if (!this.children.some(vp => vp === scope)) {\n            if (scope.parent !== null) {\n                scope.parent.removeChild(scope);\n            }\n            this.children.push(scope);\n            scope.parent = this;\n        }\n    }\n    removeChild(scope) {\n        const index = this.children.indexOf(scope);\n        if (index >= 0) {\n            this.children.splice(index, 1);\n            scope.parent = null;\n        }\n    }\n    clearReplacedChildren() {\n        this.replacedChildren = [];\n    }\n    disableReplacedChildren() {\n        this.replacedChildren = this.enabledChildren;\n        for (const scope of this.replacedChildren) {\n            scope.enabled = false;\n        }\n    }\n    reenableReplacedChildren() {\n        for (const scope of this.replacedChildren) {\n            scope.enabled = true;\n        }\n    }\n    allViewports(includeDisabled = false, includeReplaced = false) {\n        return this.allScopes(includeDisabled, includeReplaced).filter(scope => scope.isViewport).map(scope => scope.viewport);\n    }\n    allScopes(includeDisabled = false, includeReplaced = false) {\n        const scopes = includeDisabled ? this.children.slice() : this.enabledChildren;\n        for (const scope of scopes.slice()) {\n            scopes.push(...scope.allScopes(includeDisabled, includeReplaced));\n        }\n        return scopes;\n    }\n    reparentViewportInstructions() {\n        const scopes = this.hoistedChildren\n            .filter(scope => scope.viewportInstruction !== null && scope.viewportInstruction.componentName);\n        if (!scopes.length) {\n            return null;\n        }\n        for (const scope of scopes) {\n            const childInstructions = scope.reparentViewportInstructions();\n            scope.viewportInstruction.nextScopeInstructions =\n                childInstructions !== null && childInstructions.length > 0 ? childInstructions : null;\n        }\n        return scopes.map(scope => scope.viewportInstruction);\n    }\n    findMatchingRoute(path) {\n        if (this.isViewportScope && !this.passThroughScope) {\n            return this.findMatchingRouteInRoutes(path, this.viewportScope.getRoutes());\n        }\n        if (this.isViewport) {\n            return this.findMatchingRouteInRoutes(path, this.viewport.getRoutes());\n        }\n        // TODO: Match specified names here\n        for (const child of this.enabledChildren) {\n            const found = child.findMatchingRoute(path);\n            if (found !== null) {\n                return found;\n            }\n        }\n        return null;\n    }\n    async canLeave() {\n        const results = await Promise.all(this.children.map(child => child.viewport !== null\n            ? child.viewport.canLeave()\n            : child.canLeave()));\n        return !results.some(result => result === false);\n    }\n    findMatchingRouteInRoutes(path, routes) {\n        if (!Array.isArray(routes)) {\n            return null;\n        }\n        routes = routes.map(route => this.ensureProperRoute(route));\n        const recognizableRoutes = routes.map(route => ({ path: route.path, handler: { name: route.id, route } }));\n        for (let i = 0, ilen = recognizableRoutes.length; i < ilen; i++) {\n            const newRoute = { ...recognizableRoutes[i] };\n            newRoute.path += '/*remainingPath';\n            recognizableRoutes.push(newRoute);\n        }\n        const found = new FoundRoute();\n        let params = {};\n        if (path.startsWith('/') || path.startsWith('+')) {\n            path = path.slice(1);\n        }\n        const recognizer = new RouteRecognizer();\n        recognizer.add(recognizableRoutes);\n        const result = recognizer.recognize(path);\n        if (result !== void 0 && result.length > 0) {\n            found.match = result[0].handler.route;\n            found.matching = path;\n            params = result[0].params;\n            if (params.remainingPath !== void 0 && params.remainingPath.length > 0) {\n                found.remaining = params.remainingPath;\n                Reflect.deleteProperty(params, 'remainingPath');\n                found.matching = found.matching.slice(0, found.matching.indexOf(found.remaining));\n            }\n        }\n        if (found.foundConfiguration) {\n            // clone it so config doesn't get modified\n            found.instructions = this.router.instructionResolver.cloneViewportInstructions(found.match.instructions, false, true);\n            const instructions = found.instructions.slice();\n            while (instructions.length > 0) {\n                const instruction = instructions.shift();\n                instruction.addParameters(params);\n                instruction.route = '';\n                if (instruction.nextScopeInstructions !== null) {\n                    instructions.unshift(...instruction.nextScopeInstructions);\n                }\n            }\n            if (found.instructions.length > 0) {\n                found.instructions[0].route = found.matching;\n            }\n        }\n        return found;\n    }\n    ensureProperRoute(route) {\n        if (route.id === void 0) {\n            route.id = route.path;\n        }\n        route.instructions = NavigationInstructionResolver.toViewportInstructions(this.router, route.instructions);\n        return route;\n    }\n}\n//# sourceMappingURL=scope.js.map","import { Reporter } from '@aurelia/kernel';\nimport { CustomElement } from '@aurelia/runtime';\nimport { arrayRemove } from './utils';\nimport { ViewportContent } from './viewport-content';\nimport { ViewportInstruction } from './viewport-instruction';\nimport { Scope } from './scope';\nexport class Viewport {\n    constructor(router, name, element, container, owningScope, scope, options = {}) {\n        this.router = router;\n        this.name = name;\n        this.element = element;\n        this.container = container;\n        this.options = options;\n        this.nextContent = null;\n        this.forceRemove = false;\n        this.path = null;\n        this.clear = false;\n        this.elementResolve = null;\n        this.previousViewportState = null;\n        this.cache = [];\n        this.historyCache = [];\n        this.content = new ViewportContent();\n        this.connectedScope = new Scope(router, scope, owningScope, this);\n    }\n    get scope() {\n        return this.connectedScope.scope;\n    }\n    get owningScope() {\n        return this.connectedScope.owningScope;\n    }\n    get enabled() {\n        return this.connectedScope.enabled;\n    }\n    set enabled(enabled) {\n        this.connectedScope.enabled = enabled;\n    }\n    get isViewport() {\n        return true;\n    }\n    get isViewportScope() {\n        return false;\n    }\n    get isEmpty() {\n        return this.content.componentInstance === null;\n    }\n    get doForceRemove() {\n        let scope = this.connectedScope;\n        while (scope !== null) {\n            if (scope.viewport !== null && scope.viewport.forceRemove) {\n                return true;\n            }\n            scope = scope.parent;\n        }\n        return false;\n    }\n    setNextContent(content, instruction) {\n        let viewportInstruction;\n        if (content instanceof ViewportInstruction) {\n            viewportInstruction = content;\n        }\n        else {\n            if (typeof content === 'string') {\n                viewportInstruction = this.router.instructionResolver.parseViewportInstruction(content);\n            }\n            else {\n                viewportInstruction = this.router.createViewportInstruction(content);\n            }\n        }\n        viewportInstruction.setViewport(this);\n        this.clear = this.router.instructionResolver.isClearViewportInstruction(viewportInstruction);\n        // Can have a (resolved) type or a string (to be resolved later)\n        this.nextContent = new ViewportContent(!this.clear ? viewportInstruction : void 0, instruction, this.container);\n        this.nextContent.fromHistory = this.nextContent.componentInstance && instruction.navigation\n            ? !!instruction.navigation.back || !!instruction.navigation.forward\n            : false;\n        if (this.options.stateful) {\n            // TODO: Add a parameter here to decide required equality\n            const cached = this.cache.find((item) => this.nextContent.isCacheEqual(item));\n            if (cached) {\n                this.nextContent = cached;\n                this.nextContent.fromCache = true;\n            }\n            else {\n                this.cache.push(this.nextContent);\n            }\n        }\n        // Children that will be replaced (unless added again) by next content. Will\n        // be re-enabled on cancel\n        this.connectedScope.clearReplacedChildren();\n        // If we get the same _instance_, don't do anything (happens with cached and history)\n        if (this.nextContent.componentInstance !== null && this.content.componentInstance === this.nextContent.componentInstance) {\n            this.nextContent = null;\n            return false;\n        }\n        // ReentryBehavior 'refresh' takes precedence\n        if (!this.content.equalComponent(this.nextContent) ||\n            instruction.navigation.refresh ||\n            this.content.reentryBehavior() === \"refresh\" /* refresh */) {\n            this.connectedScope.disableReplacedChildren();\n            return true;\n        }\n        // Explicitly don't allow navigation back to the same component again\n        if (this.content.reentryBehavior() === \"disallow\" /* disallow */) {\n            this.nextContent = null;\n            return false;\n        }\n        // Explicitly re-enter same component again\n        if (this.content.reentryBehavior() === \"enter\" /* enter */) {\n            this.content.reentry = true;\n            this.nextContent.content.setComponent(this.content.componentInstance);\n            this.nextContent.contentStatus = this.content.contentStatus;\n            this.nextContent.reentry = this.content.reentry;\n            return true;\n        }\n        // ReentryBehavior is now 'default'\n        // Requires updated parameters if viewport stateful\n        if (this.options.stateful &&\n            this.content.equalParameters(this.nextContent)) {\n            this.nextContent = null;\n            return false;\n        }\n        // Default is to trigger a refresh (without a check of parameters)\n        this.connectedScope.disableReplacedChildren();\n        return true;\n    }\n    setElement(element, container, options) {\n        options = options || {};\n        if (this.element !== element) {\n            // TODO: Restore this state on navigation cancel\n            this.previousViewportState = { ...this };\n            this.clearState();\n            this.element = element;\n            if (options.usedBy) {\n                this.options.usedBy = options.usedBy;\n            }\n            if (options.default) {\n                this.options.default = options.default;\n            }\n            if (options.fallback) {\n                this.options.fallback = options.fallback;\n            }\n            if (options.noLink) {\n                this.options.noLink = options.noLink;\n            }\n            if (options.noHistory) {\n                this.options.noHistory = options.noHistory;\n            }\n            if (options.stateful) {\n                this.options.stateful = options.stateful;\n            }\n            if (this.elementResolve) {\n                this.elementResolve();\n            }\n        }\n        // TODO: Might not need this? Figure it out\n        // if (container) {\n        //   container['viewportName'] = this.name;\n        // }\n        if (this.container !== container) {\n            this.container = container;\n        }\n        if (!this.content.componentInstance && (!this.nextContent || !this.nextContent.componentInstance) && this.options.default) {\n            const instructions = this.router.instructionResolver.parseViewportInstructions(this.options.default);\n            for (const instruction of instructions) {\n                // Set to name to be delayed one turn\n                instruction.setViewport(this.name);\n                instruction.scope = this.owningScope;\n                instruction.default = true;\n            }\n            this.router.goto(instructions, { append: true }).catch(error => { throw error; });\n        }\n    }\n    async remove(element, container) {\n        if (this.element === element && this.container === container) {\n            if (this.content.componentInstance) {\n                await this.content.freeContent(this.element, (this.nextContent ? this.nextContent.instruction : null), this.historyCache, this.doForceRemove ? false : this.router.statefulHistory || this.options.stateful); // .catch(error => { throw error; });\n            }\n            if (this.doForceRemove) {\n                await Promise.all(this.historyCache.map(content => content.freeContent(null, null, this.historyCache, false)));\n                this.historyCache = [];\n            }\n            return true;\n        }\n        return false;\n    }\n    async canLeave() {\n        const canLeaveChildren = await this.connectedScope.canLeave();\n        if (!canLeaveChildren) {\n            return false;\n        }\n        return this.content.canLeave(this.nextContent ? this.nextContent.instruction : null);\n    }\n    async canEnter() {\n        if (this.clear) {\n            return true;\n        }\n        if ((this.nextContent.content || null) === null) {\n            return false;\n        }\n        await this.waitForElement();\n        this.nextContent.createComponent(this.container, this.options.fallback);\n        await this.nextContent.loadComponent(this.container, this.element, this);\n        return this.nextContent.canEnter(this, this.content.instruction);\n    }\n    async enter() {\n        Reporter.write(10000, 'Viewport enter', this.name);\n        if (this.clear) {\n            return true;\n        }\n        if (!this.nextContent || !this.nextContent.componentInstance) {\n            return false;\n        }\n        await this.nextContent.enter(this.content.instruction);\n        // await this.nextContent.loadComponent(this.container as IContainer, this.element as Element, this);\n        this.nextContent.initializeComponent(CustomElement.for(this.element));\n        return true;\n    }\n    async loadContent() {\n        Reporter.write(10000, 'Viewport loadContent', this.name);\n        // No need to wait for next component activation\n        if (this.content.componentInstance && !this.nextContent.componentInstance) {\n            await this.content.leave(this.nextContent.instruction);\n            await this.unloadContent();\n        }\n        if (this.nextContent.componentInstance) {\n            if (this.content.componentInstance !== this.nextContent.componentInstance) {\n                this.nextContent.addComponent(this.element);\n            }\n            else {\n                this.connectedScope.reenableReplacedChildren();\n            }\n            // Only when next component activation is done\n            if (this.content.componentInstance) {\n                await this.content.leave(this.nextContent.instruction);\n                if (!this.content.reentry && this.content.componentInstance !== this.nextContent.componentInstance) {\n                    await this.unloadContent();\n                }\n            }\n            this.content = this.nextContent;\n            this.content.reentry = false;\n        }\n        if (this.clear) {\n            this.content = new ViewportContent(void 0, this.nextContent.instruction);\n        }\n        this.nextContent = null;\n        return true;\n    }\n    finalizeContentChange() {\n        this.previousViewportState = null;\n        this.connectedScope.clearReplacedChildren();\n    }\n    async abortContentChange() {\n        this.connectedScope.reenableReplacedChildren();\n        await this.nextContent.freeContent(this.element, this.nextContent.instruction, this.historyCache, this.router.statefulHistory || this.options.stateful);\n        if (this.previousViewportState) {\n            Object.assign(this, this.previousViewportState);\n        }\n    }\n    // TODO: Deal with non-string components\n    wantComponent(component) {\n        let usedBy = this.options.usedBy || [];\n        if (typeof usedBy === 'string') {\n            usedBy = usedBy.split(',');\n        }\n        return usedBy.includes(component);\n    }\n    // TODO: Deal with non-string components\n    acceptComponent(component) {\n        if (component === '-' || component === null) {\n            return true;\n        }\n        let usedBy = this.options.usedBy;\n        if (!usedBy || !usedBy.length) {\n            return true;\n        }\n        if (typeof usedBy === 'string') {\n            usedBy = usedBy.split(',');\n        }\n        if (usedBy.includes(component)) {\n            return true;\n        }\n        if (usedBy.filter((value) => value.includes('*')).length) {\n            return true;\n        }\n        return false;\n    }\n    beforeBind(flags) {\n        if (this.content.componentInstance) {\n            this.content.initializeComponent(CustomElement.for(this.element));\n        }\n    }\n    async beforeAttach(flags) {\n        this.enabled = true;\n        if (this.content.componentInstance) {\n            // Only acts if not already entered\n            await this.content.enter(this.content.instruction);\n            this.content.addComponent(this.element);\n        }\n    }\n    async beforeDetach(flags) {\n        if (this.content.componentInstance) {\n            // Only acts if not already left\n            await this.content.leave(this.content.instruction);\n            this.content.removeComponent(this.element, this.doForceRemove ? false : this.router.statefulHistory || this.options.stateful);\n        }\n        this.enabled = false;\n    }\n    async beforeUnbind(flags) {\n        if (this.content.componentInstance) {\n            await this.content.terminateComponent(this.doForceRemove ? false : this.router.statefulHistory || this.options.stateful);\n        }\n    }\n    async freeContent(component) {\n        const content = this.historyCache.find(cached => cached.componentInstance === component);\n        if (content !== void 0) {\n            this.forceRemove = true;\n            await content.freeContent(null, null, this.historyCache, false);\n            this.forceRemove = false;\n            arrayRemove(this.historyCache, (cached => cached === content));\n        }\n    }\n    getRoutes() {\n        let componentType = this.nextContent !== null\n            && this.nextContent.content !== null\n            ? this.nextContent.content.componentType\n            : this.content.content.componentType;\n        // TODO: This is going away once Metadata is in!\n        if (componentType === null || componentType === void 0) {\n            const controller = CustomElement.for(this.element);\n            componentType = controller.context.componentType;\n        }\n        if (componentType === null || componentType === void 0) {\n            return null;\n        }\n        const routes = componentType.routes;\n        return Array.isArray(routes) ? routes : null;\n    }\n    async unloadContent() {\n        this.content.removeComponent(this.element, this.router.statefulHistory || this.options.stateful);\n        await this.content.terminateComponent(this.router.statefulHistory || this.options.stateful);\n        this.content.unloadComponent(this.historyCache, this.router.statefulHistory || this.options.stateful);\n        this.content.destroyComponent();\n    }\n    clearState() {\n        this.options = {};\n        this.content = new ViewportContent();\n        this.cache = [];\n    }\n    async waitForElement() {\n        if (this.element) {\n            return Promise.resolve();\n        }\n        return new Promise((resolve) => {\n            this.elementResolve = resolve;\n        });\n    }\n}\n//# sourceMappingURL=viewport.js.map","import { CustomElement } from '@aurelia/runtime';\nimport { Viewport } from './viewport';\nimport { ViewportInstruction } from './viewport-instruction';\nexport const ComponentAppellationResolver = {\n    isName: function (component) {\n        return typeof component === 'string';\n    },\n    isType: function (component) {\n        return CustomElement.isType(component);\n    },\n    isInstance: function (component) {\n        return !ComponentAppellationResolver.isName(component) && !ComponentAppellationResolver.isType(component);\n    },\n    getName: function (component) {\n        if (ComponentAppellationResolver.isName(component)) {\n            return component;\n        }\n        else if (ComponentAppellationResolver.isType(component)) {\n            return CustomElement.getDefinition(component).name;\n        }\n        else {\n            return ComponentAppellationResolver.getName(component.constructor);\n        }\n    },\n    getType: function (component) {\n        if (ComponentAppellationResolver.isName(component)) {\n            return null;\n        }\n        else if (ComponentAppellationResolver.isType(component)) {\n            return component;\n        }\n        else {\n            return component.constructor;\n        }\n    },\n    getInstance: function (component) {\n        if (ComponentAppellationResolver.isName(component) || ComponentAppellationResolver.isType(component)) {\n            return null;\n        }\n        else {\n            return component;\n        }\n    },\n};\nexport const ViewportHandleResolver = {\n    isName: function (viewport) {\n        return typeof viewport === 'string';\n    },\n    isInstance: function (viewport) {\n        return viewport instanceof Viewport;\n    },\n    getName: function (viewport) {\n        if (ViewportHandleResolver.isName(viewport)) {\n            return viewport;\n        }\n        else {\n            return viewport ? (viewport).name : null;\n        }\n    },\n    getInstance: function (viewport) {\n        if (ViewportHandleResolver.isName(viewport)) {\n            return null;\n        }\n        else {\n            return viewport;\n        }\n    },\n};\nexport const NavigationInstructionResolver = {\n    createViewportInstructions: function (router, navigationInstructions, options) {\n        options = options || {};\n        let scope = null;\n        if (options.context) {\n            scope = router.findScope(options.context);\n            if (typeof navigationInstructions === 'string') {\n                // If it's not from scope root, figure out which scope\n                if (!navigationInstructions.startsWith('/')) {\n                    // Scope modifications\n                    if (navigationInstructions.startsWith('.')) {\n                        // The same as no scope modification\n                        if (navigationInstructions.startsWith('./')) {\n                            navigationInstructions = navigationInstructions.slice(2);\n                        }\n                        // Find out how many scopes upwards we should move\n                        while (navigationInstructions.startsWith('../')) {\n                            scope = scope.parent || scope;\n                            navigationInstructions = navigationInstructions.slice(3);\n                        }\n                    }\n                    if (scope.path !== null) {\n                        navigationInstructions = `${scope.path}/${navigationInstructions}`;\n                        scope = router.rootScope.scope;\n                    }\n                }\n                else { // Specified root scope with /\n                    scope = router.rootScope.scope;\n                }\n            }\n            else {\n                navigationInstructions = NavigationInstructionResolver.toViewportInstructions(router, navigationInstructions);\n                for (const instruction of navigationInstructions) {\n                    if (instruction.scope === null) {\n                        instruction.scope = scope;\n                    }\n                }\n            }\n        }\n        return {\n            instructions: navigationInstructions,\n            scope,\n        };\n    },\n    toViewportInstructions: function (router, navigationInstructions) {\n        if (!Array.isArray(navigationInstructions)) {\n            return NavigationInstructionResolver.toViewportInstructions(router, [navigationInstructions]);\n        }\n        const instructions = [];\n        for (const instruction of navigationInstructions) {\n            if (typeof instruction === 'string') {\n                instructions.push(...router.instructionResolver.parseViewportInstructions(instruction));\n            }\n            else if (instruction instanceof ViewportInstruction) {\n                instructions.push(instruction);\n            }\n            else if (instruction.component) {\n                const viewportComponent = instruction;\n                const newInstruction = router.createViewportInstruction(viewportComponent.component, viewportComponent.viewport, viewportComponent.parameters);\n                if (viewportComponent.children !== void 0 && viewportComponent.children !== null) {\n                    newInstruction.nextScopeInstructions = NavigationInstructionResolver.toViewportInstructions(router, viewportComponent.children);\n                }\n                instructions.push(newInstruction);\n            }\n            else {\n                instructions.push(router.createViewportInstruction(instruction));\n            }\n        }\n        return instructions;\n    },\n};\n//# sourceMappingURL=type-resolvers.js.map","import { CustomElement } from '@aurelia/runtime';\nimport { ComponentAppellationResolver } from './type-resolvers';\nexport var ParametersType;\n(function (ParametersType) {\n    ParametersType[\"none\"] = \"none\";\n    ParametersType[\"string\"] = \"string\";\n    ParametersType[\"array\"] = \"array\";\n    ParametersType[\"object\"] = \"object\";\n})(ParametersType || (ParametersType = {}));\nexport class ViewportInstruction {\n    constructor(component, viewport, parameters, ownsScope = true, nextScopeInstructions = null) {\n        this.ownsScope = ownsScope;\n        this.nextScopeInstructions = nextScopeInstructions;\n        this.componentName = null;\n        this.componentType = null;\n        this.componentInstance = null;\n        this.viewportName = null;\n        this.viewport = null;\n        this.parametersString = null;\n        this.parametersRecord = null;\n        this.parametersList = null;\n        this.parametersType = \"none\" /* none */;\n        this.scope = null;\n        this.context = '';\n        this.viewportScope = null;\n        this.needsViewportDescribed = false;\n        this.route = null;\n        this.default = false;\n        this.instructionResolver = null;\n        this.setComponent(component);\n        this.setViewport(viewport);\n        this.setParameters(parameters);\n    }\n    get owner() {\n        return this.viewport || this.viewportScope || null;\n    }\n    get typedParameters() {\n        switch (this.parametersType) {\n            case \"string\" /* string */:\n                return this.parametersString;\n            case \"array\" /* array */:\n                return this.parametersList;\n            case \"object\" /* object */:\n                return this.parametersRecord;\n            default:\n                return null;\n        }\n    }\n    get parameters() {\n        if (this.instructionResolver !== null) {\n            return this.instructionResolver.parseComponentParameters(this.typedParameters);\n        }\n        return [];\n    }\n    get normalizedParameters() {\n        if (this.instructionResolver !== null && this.typedParameters !== null) {\n            return this.instructionResolver.stringifyComponentParameters(this.parameters);\n        }\n        return '';\n    }\n    setComponent(component) {\n        if (ComponentAppellationResolver.isName(component)) {\n            this.componentName = ComponentAppellationResolver.getName(component);\n            this.componentType = null;\n            this.componentInstance = null;\n        }\n        else if (ComponentAppellationResolver.isType(component)) {\n            this.componentName = ComponentAppellationResolver.getName(component);\n            this.componentType = ComponentAppellationResolver.getType(component);\n            this.componentInstance = null;\n        }\n        else if (ComponentAppellationResolver.isInstance(component)) {\n            this.componentName = ComponentAppellationResolver.getName(component);\n            this.componentType = ComponentAppellationResolver.getType(component);\n            this.componentInstance = ComponentAppellationResolver.getInstance(component);\n        }\n    }\n    setViewport(viewport) {\n        if (viewport === undefined || viewport === '') {\n            viewport = null;\n        }\n        if (typeof viewport === 'string') {\n            this.viewportName = viewport;\n            this.viewport = null;\n        }\n        else {\n            this.viewport = viewport;\n            if (viewport !== null) {\n                this.viewportName = viewport.name;\n                this.scope = viewport.owningScope;\n            }\n        }\n    }\n    setParameters(parameters) {\n        if (parameters === undefined || parameters === null || parameters === '') {\n            this.parametersType = \"none\" /* none */;\n            parameters = null;\n        }\n        else if (typeof parameters === 'string') {\n            this.parametersType = \"string\" /* string */;\n            this.parametersString = parameters;\n        }\n        else if (Array.isArray(parameters)) {\n            this.parametersType = \"array\" /* array */;\n            this.parametersList = parameters;\n        }\n        else {\n            this.parametersType = \"object\" /* object */;\n            this.parametersRecord = parameters;\n        }\n    }\n    // This only works with objects added to objects!\n    addParameters(parameters) {\n        if (this.parametersType === \"none\" /* none */) {\n            return this.setParameters(parameters);\n        }\n        if (this.parametersType !== \"object\" /* object */) {\n            throw new Error('Can\\'t add object parameters to existing non-object parameters!');\n        }\n        this.setParameters({ ...this.parametersRecord, ...parameters });\n    }\n    setInstructionResolver(instructionResolver) {\n        this.instructionResolver = instructionResolver;\n    }\n    isEmpty() {\n        return !this.isComponentName() && !this.isComponentType() && !this.isComponentInstance();\n    }\n    isComponentName() {\n        return !!this.componentName && !this.isComponentType() && !this.isComponentInstance();\n    }\n    isComponentType() {\n        return this.componentType !== null && !this.isComponentInstance();\n    }\n    isComponentInstance() {\n        return this.componentInstance !== null;\n    }\n    toComponentType(container) {\n        if (this.componentType !== null) {\n            return this.componentType;\n        }\n        if (this.componentName !== null\n            && typeof this.componentName === 'string'\n            && container !== null\n            && container.has(CustomElement.keyFrom(this.componentName), true)) {\n            const resolver = container.getResolver(CustomElement.keyFrom(this.componentName));\n            if (resolver !== null && resolver.getFactory !== void 0) {\n                const factory = resolver.getFactory(container);\n                if (factory) {\n                    return factory.Type;\n                }\n            }\n        }\n        return null;\n    }\n    toComponentInstance(container) {\n        if (this.componentInstance !== null) {\n            return this.componentInstance;\n        }\n        if (container !== void 0 && container !== null) {\n            if (this.isComponentType()) {\n                return container.get(this.componentType);\n            }\n            else {\n                return container.get(CustomElement.keyFrom(this.componentName));\n            }\n        }\n        return null;\n    }\n    toViewportInstance(router) {\n        if (this.viewport !== null) {\n            return this.viewport;\n        }\n        return router.getViewport(this.viewportName);\n    }\n    toSpecifiedParameters(specifications) {\n        specifications = specifications || [];\n        const parameters = this.parameters;\n        const specified = {};\n        for (const spec of specifications) {\n            // First get named if it exists\n            let index = parameters.findIndex(param => param.key === spec);\n            if (index >= 0) {\n                const [parameter] = parameters.splice(index, 1);\n                specified[spec] = parameter.value;\n            }\n            else {\n                // Otherwise get first unnamed\n                index = parameters.findIndex(param => param.key === void 0);\n                if (index >= 0) {\n                    const [parameter] = parameters.splice(index, 1);\n                    specified[spec] = parameter.value;\n                }\n            }\n        }\n        // Add all remaining named\n        for (const parameter of parameters.filter(param => param.key !== void 0)) {\n            specified[parameter.key] = parameter.value;\n        }\n        let index = specifications.length;\n        // Add all remaining unnamed...\n        for (const parameter of parameters.filter(param => param.key === void 0)) {\n            // ..with an index\n            specified[index++] = parameter.value;\n        }\n        return specified;\n    }\n    toSortedParameters(specifications) {\n        specifications = specifications || [];\n        const parameters = this.parameters;\n        const sorted = [];\n        for (const spec of specifications) {\n            // First get named if it exists\n            let index = parameters.findIndex(param => param.key === spec);\n            if (index >= 0) {\n                const parameter = { ...parameters.splice(index, 1)[0] };\n                parameter.key = void 0;\n                sorted.push(parameter);\n            }\n            else {\n                // Otherwise get first unnamed\n                index = parameters.findIndex(param => param.key === void 0);\n                if (index >= 0) {\n                    const parameter = { ...parameters.splice(index, 1)[0] };\n                    sorted.push(parameter);\n                }\n                else {\n                    // Or an empty\n                    sorted.push({ value: void 0 });\n                }\n            }\n        }\n        // Add all remaining named\n        const params = parameters.filter(param => param.key !== void 0);\n        params.sort((a, b) => (a.key || '') < (b.key || '') ? 1 : (b.key || '') < (a.key || '') ? -1 : 0);\n        sorted.push(...params);\n        // Add all remaining unnamed...\n        sorted.push(...parameters.filter(param => param.key === void 0));\n        return sorted;\n    }\n    sameComponent(other, compareParameters = false, compareType = false) {\n        if (compareParameters && !this.sameParameters(other, compareType)) {\n            return false;\n        }\n        return compareType ? this.componentType === other.componentType : this.componentName === other.componentName;\n    }\n    // TODO: Somewhere we need to check for format such as spaces etc\n    sameParameters(other, compareType = false) {\n        if (!this.sameComponent(other, false, compareType)) {\n            return false;\n        }\n        const typeParameters = this.componentType ? this.componentType.parameters : [];\n        const mine = this.toSpecifiedParameters(typeParameters);\n        const others = other.toSpecifiedParameters(typeParameters);\n        return Object.keys(mine).every(key => mine[key] === others[key])\n            && Object.keys(others).every(key => others[key] === mine[key]);\n    }\n    sameViewport(other) {\n        if (this.viewport !== null && other.viewport !== null) {\n            return this.viewport === other.viewport;\n        }\n        return this.scope === other.scope &&\n            (this.viewport ? this.viewport.name : this.viewportName) === (other.viewport ? other.viewport.name : other.viewportName);\n    }\n}\n//# sourceMappingURL=viewport-instruction.js.map","export var ReentryBehavior;\n(function (ReentryBehavior) {\n    ReentryBehavior[\"default\"] = \"default\";\n    ReentryBehavior[\"disallow\"] = \"disallow\";\n    ReentryBehavior[\"enter\"] = \"enter\";\n    ReentryBehavior[\"refresh\"] = \"refresh\";\n})(ReentryBehavior || (ReentryBehavior = {}));\n//# sourceMappingURL=interfaces.js.map","import { Hook } from './hook';\nexport var HookTypes;\n(function (HookTypes) {\n    HookTypes[\"BeforeNavigation\"] = \"beforeNavigation\";\n    HookTypes[\"TransformFromUrl\"] = \"transformFromUrl\";\n    HookTypes[\"TransformToUrl\"] = \"transformToUrl\";\n})(HookTypes || (HookTypes = {}));\nexport class HookManager {\n    constructor() {\n        this.hooks = {\n            beforeNavigation: [],\n            transformFromUrl: [],\n            transformToUrl: [],\n        };\n        this.lastIdentity = 0;\n    }\n    addHook(hookFunction, options) {\n        const hook = new Hook(hookFunction, options || {}, ++this.lastIdentity);\n        this.hooks[hook.type].push(hook);\n        return this.lastIdentity;\n    }\n    removeHook(id) {\n        for (const type in this.hooks) {\n            if (Object.prototype.hasOwnProperty.call(this.hooks, type)) {\n                const index = this.hooks[type].findIndex(hook => hook.id === id);\n                if (index >= 0) {\n                    this.hooks[type].splice(index, 1);\n                }\n            }\n        }\n    }\n    invokeBeforeNavigation(viewportInstructions, navigationInstruction) {\n        return this.invoke(\"beforeNavigation\" /* BeforeNavigation */, navigationInstruction, viewportInstructions);\n    }\n    invokeTransformFromUrl(url, navigationInstruction) {\n        return this.invoke(\"transformFromUrl\" /* TransformFromUrl */, navigationInstruction, url);\n    }\n    invokeTransformToUrl(state, navigationInstruction) {\n        return this.invoke(\"transformToUrl\" /* TransformToUrl */, navigationInstruction, state);\n    }\n    async invoke(type, navigationInstruction, arg) {\n        for (const hook of this.hooks[type]) {\n            if (!hook.wantsMatch || hook.matches(arg)) {\n                const outcome = await hook.invoke(navigationInstruction, arg);\n                if (typeof outcome === 'boolean') {\n                    if (!outcome) {\n                        return false;\n                    }\n                }\n                else {\n                    arg = outcome;\n                }\n            }\n        }\n        return arg;\n    }\n}\n//# sourceMappingURL=hook-manager.js.map","import { ComponentAppellationResolver, ViewportHandleResolver } from './type-resolvers';\nimport { ViewportInstruction } from './viewport-instruction';\nexport class Hook {\n    constructor(hook, options, id) {\n        this.hook = hook;\n        this.id = id;\n        this.type = \"beforeNavigation\" /* BeforeNavigation */;\n        this.includeTargets = [];\n        this.excludeTargets = [];\n        if (options.type !== void 0) {\n            this.type = options.type;\n        }\n        for (const target of options.include || []) {\n            this.includeTargets.push(new Target(target));\n        }\n        for (const target of options.exclude || []) {\n            this.excludeTargets.push(new Target(target));\n        }\n    }\n    get wantsMatch() {\n        return this.includeTargets.length > 0 || this.excludeTargets.length > 0;\n    }\n    matches(viewportInstructions) {\n        if (this.includeTargets.length && !this.includeTargets.some(target => target.matches(viewportInstructions))) {\n            return false;\n        }\n        if (this.excludeTargets.length && this.excludeTargets.some(target => target.matches(viewportInstructions))) {\n            return false;\n        }\n        return true;\n    }\n    invoke(navigationInstruction, arg) {\n        // TODO: Fix the type here\n        return this.hook(arg, navigationInstruction);\n    }\n}\nclass Target {\n    constructor(target) {\n        this.componentType = null;\n        this.componentName = null;\n        this.viewport = null;\n        this.viewportName = null;\n        if (typeof target === 'string') {\n            this.componentName = target;\n        }\n        else if (ComponentAppellationResolver.isType(target)) {\n            this.componentType = target;\n            this.componentName = ComponentAppellationResolver.getName(target);\n        }\n        else {\n            const cvTarget = target;\n            if (cvTarget.component) {\n                this.componentType = ComponentAppellationResolver.isType(cvTarget.component)\n                    ? ComponentAppellationResolver.getType(cvTarget.component)\n                    : null;\n                this.componentName = ComponentAppellationResolver.getName(cvTarget.component);\n            }\n            if (cvTarget.viewport) {\n                this.viewport = ViewportHandleResolver.isInstance(cvTarget.viewport) ? cvTarget.viewport : null;\n                this.viewportName = ViewportHandleResolver.getName(cvTarget.viewport);\n            }\n        }\n    }\n    matches(viewportInstructions) {\n        const instructions = viewportInstructions.slice();\n        if (!instructions.length) {\n            instructions.push(new ViewportInstruction(''));\n        }\n        for (const instruction of instructions) {\n            if ((this.componentName !== null && this.componentName === instruction.componentName) ||\n                (this.componentType !== null && this.componentType === instruction.componentType) ||\n                (this.viewportName !== null && this.viewportName === instruction.viewportName) ||\n                (this.viewport !== null && this.viewport === instruction.viewport)) {\n                return true;\n            }\n        }\n        return false;\n    }\n}\n//# sourceMappingURL=hook.js.map","import { ComponentAppellationResolver, NavigationInstructionResolver } from './type-resolvers';\nexport class NavRoute {\n    constructor(nav, route) {\n        this.nav = nav;\n        this.instructions = [];\n        this.link = null;\n        this.linkVisible = null;\n        this.linkActive = null;\n        this.compareParameters = false;\n        this.children = null;\n        this.visible = true;\n        this.active = '';\n        this.title = route.title;\n        this.meta = route.meta;\n        if (route.route) {\n            this.instructions = this.parseRoute(route.route);\n            this.link = this.computeLink(this.instructions);\n        }\n        this.linkActive = route.consideredActive !== null && route.consideredActive !== void 0 ? route.consideredActive : this.link;\n        if (this.linkActive !== null && (!(this.linkActive instanceof Function) || ComponentAppellationResolver.isType(this.linkActive))) {\n            this.linkActive = NavigationInstructionResolver.toViewportInstructions(this.nav.router, this.linkActive);\n        }\n        this.execute = route.execute;\n        this.compareParameters = !!route.compareParameters;\n        this.linkVisible = route.condition === undefined ? true : route.condition;\n        this.update();\n    }\n    get hasChildren() {\n        return (this.children && this.children.length ? 'nav-has-children' : '');\n    }\n    update() {\n        this.visible = this.computeVisible();\n        if ((this.link && this.link.length) || this.execute) {\n            this.active = this.computeActive();\n        }\n        else {\n            this.active = (this.active === 'nav-active' ? 'nav-active' : (this.activeChild() ? 'nav-active-child' : ''));\n        }\n    }\n    executeAction(event) {\n        if (this.execute) {\n            this.execute(this);\n        }\n        event.stopPropagation();\n    }\n    toggleActive() {\n        this.active = (this.active.startsWith('nav-active') ? '' : 'nav-active');\n    }\n    parseRoute(routes) {\n        return NavigationInstructionResolver.toViewportInstructions(this.nav.router, routes);\n    }\n    computeVisible() {\n        if (this.linkVisible instanceof Function) {\n            return this.linkVisible(this);\n        }\n        return !!this.linkVisible;\n    }\n    computeActive() {\n        if (!Array.isArray(this.linkActive)) {\n            return this.linkActive(this) ? 'nav-active' : '';\n        }\n        const components = this.linkActive;\n        const activeComponents = this.nav.router.instructionResolver.flattenViewportInstructions(this.nav.router.activeComponents);\n        for (const component of components) {\n            if (activeComponents.every((active) => !active.sameComponent(component, this.compareParameters && component.typedParameters !== null))) {\n                return '';\n            }\n        }\n        return 'nav-active';\n    }\n    computeLink(instructions) {\n        return this.nav.router.instructionResolver.stringifyViewportInstructions(instructions);\n    }\n    activeChild() {\n        if (this.children) {\n            for (const child of this.children) {\n                if (child.active.startsWith('nav-active') || child.activeChild()) {\n                    return true;\n                }\n            }\n        }\n        return false;\n    }\n}\n//# sourceMappingURL=nav-route.js.map","import { NavRoute } from './nav-route';\nexport class Nav {\n    constructor(router, name, routes = [], classes = {}) {\n        this.router = router;\n        this.name = name;\n        this.routes = routes;\n        this.classes = classes;\n        this.update();\n    }\n    addRoutes(routes) {\n        for (const route of routes) {\n            this.addRoute(this.routes, route);\n        }\n        this.update();\n    }\n    update() {\n        this.updateRoutes(this.routes);\n        this.routes = this.routes.slice();\n    }\n    addRoute(routes, route) {\n        const newRoute = new NavRoute(this, route);\n        routes.push(newRoute);\n        if (route.children) {\n            newRoute.children = [];\n            for (const child of route.children) {\n                this.addRoute(newRoute.children, child);\n            }\n        }\n    }\n    updateRoutes(routes) {\n        for (const route of routes) {\n            route.update();\n            if (route.children && route.children.length) {\n                this.updateRoutes(route.children);\n            }\n        }\n    }\n}\n//# sourceMappingURL=nav.js.map","import { __decorate, __metadata } from \"tslib\";\nimport { bound } from '@aurelia/kernel';\nexport class QueueTask {\n    constructor(taskQueue, item, cost = 0) {\n        this.taskQueue = taskQueue;\n        this.item = item;\n        this.cost = cost;\n        this.done = false;\n        this.promise = new Promise((resolve, reject) => {\n            this.resolve = () => {\n                this.taskQueue.resolve(this, resolve);\n            };\n            this.reject = (reason) => {\n                this.taskQueue.reject(this, reject, reason);\n            };\n        });\n    }\n    async execute() {\n        if ('execute' in this.item) {\n            await this.item.execute(this);\n        }\n        else {\n            await this.item(this);\n        }\n    }\n    wait() {\n        return this.promise;\n    }\n    canCancel() {\n        return false;\n    }\n    cancel() { return; }\n}\n/**\n * A first-in-first-out task queue that only processes the next queued item\n * when the current one has been resolved or rejected. If a callback function\n * is specified, it receives the queued items as tasks one at a time. If no\n * callback is specified, the tasks themselves are either executed (if a\n * function) or the execute method in them are run. The executed function\n * should resolve or reject the task when processing is done.\n * Enqueued items' tasks can be awaited. Enqueued items can specify an\n * (arbitrary) execution cost and the queue can be set up (activated) to\n * only process a specific amount of execution cost per RAF/tick.\n */\nexport class TaskQueue {\n    constructor(callback) {\n        this.callback = callback;\n        this.pending = [];\n        this.processing = null;\n        this.allowedExecutionCostWithinTick = null;\n        this.currentExecutionCostInCurrentTick = 0;\n        this.scheduler = null;\n        this.task = null;\n    }\n    get isActive() {\n        return this.task !== null;\n    }\n    get length() {\n        return this.pending.length;\n    }\n    activate(options) {\n        if (this.isActive) {\n            throw new Error('TaskQueue has already been activated');\n        }\n        this.scheduler = options.scheduler;\n        this.allowedExecutionCostWithinTick = options.allowedExecutionCostWithinTick;\n        this.task = this.scheduler.queueRenderTask(this.dequeue, { persistent: true });\n    }\n    deactivate() {\n        if (!this.isActive) {\n            throw new Error('TaskQueue has not been activated');\n        }\n        this.task.cancel();\n        this.task = null;\n        this.allowedExecutionCostWithinTick = null;\n        this.clear();\n    }\n    enqueue(itemOrItems, costOrCosts) {\n        const list = Array.isArray(itemOrItems);\n        const items = (list ? itemOrItems : [itemOrItems]);\n        const costs = items\n            .map((value, index) => !Array.isArray(costOrCosts) ? costOrCosts : costOrCosts[index])\n            .map((value) => value !== undefined ? value : 1);\n        const tasks = [];\n        for (const item of items) {\n            tasks.push(item instanceof QueueTask\n                ? item\n                : this.createQueueTask(item, costs.shift())); // TODO: Get cancellable in as well\n        }\n        this.pending.push(...tasks);\n        this.dequeue();\n        return list ? tasks : tasks[0];\n    }\n    createQueueTask(item, cost) {\n        return new QueueTask(this, item, cost);\n    }\n    dequeue(delta) {\n        if (this.processing !== null) {\n            return;\n        }\n        if (delta !== undefined) {\n            this.currentExecutionCostInCurrentTick = 0;\n        }\n        if (!this.pending.length) {\n            return;\n        }\n        if (this.allowedExecutionCostWithinTick !== null && delta === undefined && this.currentExecutionCostInCurrentTick + (this.pending[0].cost || 0) > this.allowedExecutionCostWithinTick) {\n            return;\n        }\n        this.processing = this.pending.shift() || null;\n        if (this.processing) {\n            this.currentExecutionCostInCurrentTick += this.processing.cost || 0;\n            if (this.callback !== void 0) {\n                this.callback(this.processing);\n            }\n            else {\n                // Don't need to await this since next task won't be dequeued until\n                // executed function is resolved\n                this.processing.execute().catch(error => { throw error; });\n            }\n        }\n    }\n    clear() {\n        this.pending.splice(0, this.pending.length);\n    }\n    resolve(task, resolve) {\n        resolve();\n        this.processing = null;\n        this.dequeue();\n    }\n    reject(task, reject, reason) {\n        reject(reason);\n        this.processing = null;\n        this.dequeue();\n    }\n}\n__decorate([\n    bound,\n    __metadata(\"design:type\", Function),\n    __metadata(\"design:paramtypes\", [Number]),\n    __metadata(\"design:returntype\", void 0)\n], TaskQueue.prototype, \"dequeue\", null);\n//# sourceMappingURL=task-queue.js.map","import { __decorate, __metadata, __param } from \"tslib\";\nimport { IDOM, IScheduler } from '@aurelia/runtime';\nimport { HTMLDOM } from '@aurelia/runtime-html';\nimport { TaskQueue } from './task-queue';\nlet BrowserViewerStore = class BrowserViewerStore {\n    constructor(scheduler, dom) {\n        this.scheduler = scheduler;\n        this.allowedExecutionCostWithinTick = 2; // Limit no of executed actions within the same RAF (due to browser limitation)\n        this.isActive = false;\n        this.options = {\n            useUrlFragmentHash: true,\n            callback: () => { return; },\n        };\n        this.forwardedState = { eventTask: null, suppressPopstate: false };\n        this.handlePopstate = (event) => {\n            const { eventTask, suppressPopstate } = this.forwardedState;\n            this.forwardedState = { eventTask: null, suppressPopstate: false };\n            return this.pendingCalls.enqueue(async (task) => {\n                const store = this;\n                const ev = event;\n                const evTask = eventTask;\n                const suppressPopstateEvent = suppressPopstate;\n                await store.popstate(ev, evTask, suppressPopstateEvent);\n                task.resolve();\n            }, 1).wait();\n        };\n        this.window = dom.window;\n        this.history = dom.window.history;\n        this.location = dom.window.location;\n        this.pendingCalls = new TaskQueue();\n    }\n    activate(options) {\n        if (this.isActive) {\n            throw new Error('Browser navigation has already been activated');\n        }\n        this.isActive = true;\n        this.options.callback = options.callback;\n        if (options.useUrlFragmentHash != void 0) {\n            this.options.useUrlFragmentHash = options.useUrlFragmentHash;\n        }\n        this.pendingCalls.activate({ scheduler: this.scheduler, allowedExecutionCostWithinTick: this.allowedExecutionCostWithinTick });\n        this.window.addEventListener('popstate', this.handlePopstate);\n    }\n    deactivate() {\n        if (!this.isActive) {\n            throw new Error('Browser navigation has not been activated');\n        }\n        this.window.removeEventListener('popstate', this.handlePopstate);\n        this.pendingCalls.deactivate();\n        this.options = { useUrlFragmentHash: true, callback: () => { return; } };\n        this.isActive = false;\n    }\n    get length() {\n        return this.history.length;\n    }\n    get state() {\n        return this.history.state;\n    }\n    get viewerState() {\n        const { pathname, search, hash } = this.location;\n        return {\n            path: pathname,\n            query: search,\n            hash,\n            instruction: this.options.useUrlFragmentHash ? hash.slice(1) : pathname,\n        };\n    }\n    go(delta, suppressPopstateEvent = false) {\n        const doneTask = this.pendingCalls.createQueueTask((task) => task.resolve(), 1);\n        this.pendingCalls.enqueue([\n            (task) => {\n                const store = this;\n                const eventTask = doneTask;\n                const suppressPopstate = suppressPopstateEvent;\n                store.forwardState({ eventTask, suppressPopstate });\n                task.resolve();\n            },\n            (task) => {\n                const history = this.history;\n                const steps = delta;\n                history.go(steps);\n                task.resolve();\n            },\n        ], [0, 1]);\n        return doneTask.wait();\n    }\n    pushNavigatorState(state) {\n        const { title, path } = state.currentEntry;\n        const fragment = this.options.useUrlFragmentHash ? '#/' : '';\n        return this.pendingCalls.enqueue((task) => {\n            const history = this.history;\n            const data = state;\n            const titleOrEmpty = title || '';\n            const url = `${fragment}${path}`;\n            history.pushState(data, titleOrEmpty, url);\n            task.resolve();\n        }, 1).wait();\n    }\n    replaceNavigatorState(state) {\n        const { title, path } = state.currentEntry;\n        const fragment = this.options.useUrlFragmentHash ? '#/' : '';\n        return this.pendingCalls.enqueue((task) => {\n            const history = this.history;\n            const data = state;\n            const titleOrEmpty = title || '';\n            const url = `${fragment}${path}`;\n            history.replaceState(data, titleOrEmpty, url);\n            task.resolve();\n        }, 1).wait();\n    }\n    popNavigatorState() {\n        const doneTask = this.pendingCalls.createQueueTask((task) => task.resolve(), 1);\n        this.pendingCalls.enqueue(async (task) => {\n            const store = this;\n            const eventTask = doneTask;\n            await store.popState(eventTask);\n            task.resolve();\n        }, 1);\n        return doneTask.wait();\n    }\n    async popState(doneTask) {\n        await this.go(-1, true);\n        const state = this.history.state;\n        // TODO: Fix browser forward bug after pop on first entry\n        if (state && state.navigationEntry && !state.navigationEntry.firstEntry) {\n            await this.go(-1, true);\n            await this.pushNavigatorState(state);\n        }\n        await doneTask.execute();\n    }\n    forwardState(state) {\n        this.forwardedState = state;\n    }\n    async popstate(ev, eventTask, suppressPopstate = false) {\n        if (!suppressPopstate) {\n            this.options.callback({\n                ...this.viewerState,\n                ...{\n                    event: ev,\n                    state: this.history.state,\n                },\n            });\n        }\n        if (eventTask !== null) {\n            await eventTask.execute();\n        }\n    }\n};\nBrowserViewerStore = __decorate([\n    __param(0, IScheduler),\n    __param(1, IDOM),\n    __metadata(\"design:paramtypes\", [Object, HTMLDOM])\n], BrowserViewerStore);\nexport { BrowserViewerStore };\n//# sourceMappingURL=browser-viewer-store.js.map","/* eslint-disable max-lines-per-function */\nimport { DI, IContainer, Reporter, Registration, Metadata } from '@aurelia/kernel';\nimport { Aurelia, CustomElement, DOM, isRenderContext } from '@aurelia/runtime';\nimport { InstructionResolver } from './instruction-resolver';\nimport { LinkHandler } from './link-handler';\nimport { Nav } from './nav';\nimport { Navigator } from './navigator';\nimport { NavigationInstructionResolver } from './type-resolvers';\nimport { arrayRemove } from './utils';\nimport { Viewport } from './viewport';\nimport { FoundRoute } from './found-route';\nimport { HookManager } from './hook-manager';\nimport { Scope } from './scope';\nimport { ViewportScope } from './viewport-scope';\nimport { BrowserViewerStore } from './browser-viewer-store';\nclass ClosestViewportCustomElement {\n}\nclass ClosestScope {\n}\nexport const IRouter = DI.createInterface('IRouter').withDefault(x => x.singleton(Router));\nexport class Router {\n    constructor(container, navigator, navigation, linkHandler, instructionResolver) {\n        this.container = container;\n        this.navigator = navigator;\n        this.navigation = navigation;\n        this.linkHandler = linkHandler;\n        this.instructionResolver = instructionResolver;\n        this.rootScope = null;\n        this.navs = {};\n        this.activeComponents = [];\n        this.appendedInstructions = [];\n        this.options = {\n            useHref: true,\n            statefulHistoryLength: 0,\n            useDirectRoutes: true,\n            useConfiguredRoutes: true,\n        };\n        this.isActive = false;\n        this.loadedFirst = false;\n        this.processingNavigation = null;\n        this.lastNavigation = null;\n        this.staleChecks = {};\n        // TODO: use @bound and improve name (eslint-disable is temp)\n        // eslint-disable-next-line @typescript-eslint/typedef\n        this.linkCallback = (info) => {\n            let instruction = info.instruction || '';\n            if (typeof instruction === 'string' && instruction.startsWith('#')) {\n                instruction = instruction.slice(1);\n                // '#' === '/' === '#/'\n                if (!instruction.startsWith('/')) {\n                    instruction = `/${instruction}`;\n                }\n            }\n            // Adds to Navigator's Queue, which makes sure it's serial\n            this.goto(instruction, { origin: info.anchor }).catch(error => { throw error; });\n        };\n        // TODO: use @bound and improve name (eslint-disable is temp)\n        // eslint-disable-next-line @typescript-eslint/typedef\n        this.navigatorCallback = (instruction) => {\n            // Instructions extracted from queue, one at a time\n            this.processNavigations(instruction).catch(error => { throw error; });\n        };\n        // TODO: use @bound and improve name (eslint-disable is temp)\n        // eslint-disable-next-line @typescript-eslint/typedef\n        this.navigatorSerializeCallback = async (entry, preservedEntries) => {\n            let excludeComponents = [];\n            for (const preservedEntry of preservedEntries) {\n                if (typeof preservedEntry.instruction !== 'string') {\n                    excludeComponents.push(...this.instructionResolver.flattenViewportInstructions(preservedEntry.instruction)\n                        .filter(instruction => instruction.viewport !== null)\n                        .map(instruction => instruction.componentInstance));\n                }\n                if (typeof preservedEntry.fullStateInstruction !== 'string') {\n                    excludeComponents.push(...this.instructionResolver.flattenViewportInstructions(preservedEntry.fullStateInstruction)\n                        .filter(instruction => instruction.viewport !== null)\n                        .map(instruction => instruction.componentInstance));\n                }\n            }\n            excludeComponents = excludeComponents.filter((component, i, arr) => component !== null && arr.indexOf(component) === i);\n            const serialized = { ...entry };\n            let instructions = [];\n            if (serialized.fullStateInstruction && typeof serialized.fullStateInstruction !== 'string') {\n                instructions.push(...serialized.fullStateInstruction);\n                serialized.fullStateInstruction = this.instructionResolver.stringifyViewportInstructions(serialized.fullStateInstruction);\n            }\n            if (serialized.instruction && typeof serialized.instruction !== 'string') {\n                instructions.push(...serialized.instruction);\n                serialized.instruction = this.instructionResolver.stringifyViewportInstructions(serialized.instruction);\n            }\n            instructions = instructions.filter((instruction, i, arr) => instruction !== null\n                && instruction.componentInstance !== null\n                && arr.indexOf(instruction) === i);\n            const alreadyDone = [];\n            for (const instruction of instructions) {\n                await this.freeComponents(instruction, excludeComponents, alreadyDone);\n            }\n            return serialized;\n        };\n        // TODO: use @bound and improve name (eslint-disable is temp)\n        // eslint-disable-next-line @typescript-eslint/typedef\n        this.browserNavigatorCallback = (browserNavigationEvent) => {\n            const entry = (browserNavigationEvent.state && browserNavigationEvent.state.currentEntry\n                ? browserNavigationEvent.state.currentEntry\n                : { instruction: '', fullStateInstruction: '' });\n            entry.instruction = browserNavigationEvent.instruction;\n            entry.fromBrowser = true;\n            this.navigator.navigate(entry).catch(error => { throw error; });\n        };\n        // TODO: use @bound and improve name (eslint-disable is temp)\n        // eslint-disable-next-line @typescript-eslint/typedef\n        this.processNavigations = async (qInstruction) => {\n            const instruction = this.processingNavigation = qInstruction;\n            if (this.options.reportCallback) {\n                this.options.reportCallback(instruction);\n            }\n            let fullStateInstruction = false;\n            const instructionNavigation = instruction.navigation;\n            if ((instructionNavigation.back || instructionNavigation.forward) && instruction.fullStateInstruction) {\n                fullStateInstruction = true;\n                // if (!confirm('Perform history navigation?')) { this.navigator.cancel(instruction); this.processingNavigation = null; return Promise.resolve(); }\n            }\n            let configuredRoute = await this.findInstructions(this.rootScope.scope, instruction.instruction, instruction.scope || this.rootScope.scope, !fullStateInstruction);\n            let instructions = configuredRoute.instructions;\n            let configuredRoutePath = null;\n            if (instruction.instruction.length > 0 && !configuredRoute.foundConfiguration && !configuredRoute.foundInstructions) {\n                // TODO: Do something here!\n                this.unknownRoute(configuredRoute.remaining);\n            }\n            if (configuredRoute.foundConfiguration) {\n                instruction.path = instruction.instruction.startsWith('/')\n                    ? instruction.instruction.slice(1) : instruction.instruction;\n                configuredRoutePath = `${configuredRoutePath || ''}${configuredRoute.matching}`;\n                this.rootScope.path = configuredRoutePath;\n            }\n            // TODO: Used to have an early exit if no instructions. Restore it?\n            const clearScopeOwners = [];\n            let clearViewportScopes = [];\n            for (const clearInstruction of instructions.filter(instr => this.instructionResolver.isClearAllViewportsInstruction(instr))) {\n                const scope = clearInstruction.scope || this.rootScope.scope;\n                clearScopeOwners.push(...scope.children.filter(scope => !scope.owner.isEmpty).map(scope => scope.owner));\n                if (scope.viewportScope !== null) {\n                    clearViewportScopes.push(scope.viewportScope);\n                }\n            }\n            instructions = instructions.filter(instr => !this.instructionResolver.isClearAllViewportsInstruction(instr));\n            for (const addInstruction of instructions.filter(instr => this.instructionResolver.isAddAllViewportsInstruction(instr))) {\n                addInstruction.setViewport((addInstruction.scope || this.rootScope.scope).viewportScope.name);\n                addInstruction.scope = addInstruction.scope.owningScope;\n            }\n            const updatedScopeOwners = [];\n            const alreadyFoundInstructions = [];\n            // TODO: Take care of cancellations down in subsets/iterations\n            let { found: viewportInstructions, remaining: remainingInstructions } = this.findViewports(instructions, alreadyFoundInstructions);\n            let guard = 100;\n            do {\n                if (!guard--) { // Guard against endless loop\n                    console.log('remainingInstructions', remainingInstructions);\n                    throw Reporter.error(2002);\n                }\n                const changedScopeOwners = [];\n                const hooked = await this.hookManager.invokeBeforeNavigation(viewportInstructions, instruction);\n                if (hooked === false) {\n                    return this.cancelNavigation([...changedScopeOwners, ...updatedScopeOwners], instruction);\n                }\n                else {\n                    viewportInstructions = hooked;\n                }\n                for (const viewportInstruction of viewportInstructions) {\n                    const scopeOwner = viewportInstruction.owner;\n                    if (scopeOwner !== null) {\n                        scopeOwner.path = configuredRoutePath;\n                        if (scopeOwner.setNextContent(viewportInstruction, instruction)) {\n                            changedScopeOwners.push(scopeOwner);\n                        }\n                        arrayRemove(clearScopeOwners, value => value === scopeOwner);\n                        if (!this.instructionResolver.isClearViewportInstruction(viewportInstruction)\n                            && viewportInstruction.scope !== null\n                            && viewportInstruction.scope.parent !== null\n                            && viewportInstruction.scope.parent.isViewportScope) {\n                            arrayRemove(clearViewportScopes, value => value === viewportInstruction.scope.parent.viewportScope);\n                        }\n                    }\n                }\n                let results = await Promise.all(changedScopeOwners.map((value) => value.canLeave()));\n                if (results.some(result => result === false)) {\n                    return this.cancelNavigation([...changedScopeOwners, ...updatedScopeOwners], instruction);\n                }\n                results = await Promise.all(changedScopeOwners.map(async (value) => {\n                    const canEnter = await value.canEnter();\n                    if (typeof canEnter === 'boolean') {\n                        if (canEnter) {\n                            return value.enter();\n                        }\n                        else {\n                            return false;\n                        }\n                    }\n                    await this.goto(canEnter, { append: true });\n                    await value.abortContentChange();\n                    // TODO: Abort content change in the viewports\n                    return true;\n                }));\n                if (results.some(result => result === false)) {\n                    return this.cancelNavigation([...changedScopeOwners, ...updatedScopeOwners], qInstruction);\n                }\n                for (const viewport of changedScopeOwners) {\n                    if (updatedScopeOwners.every(value => value !== viewport)) {\n                        updatedScopeOwners.push(viewport);\n                    }\n                }\n                // TODO: Fix multi level recursiveness!\n                alreadyFoundInstructions.push(...viewportInstructions);\n                ({ found: viewportInstructions, remaining: remainingInstructions } = this.findViewports(remainingInstructions, alreadyFoundInstructions));\n                // Look for configured child routes (once we've loaded everything so far?)\n                if (configuredRoute.hasRemaining &&\n                    viewportInstructions.length === 0 &&\n                    remainingInstructions.length === 0) {\n                    let configured = new FoundRoute();\n                    const routeScopeOwners = alreadyFoundInstructions\n                        .filter(instr => instr.owner !== null && instr.owner.path === configuredRoutePath)\n                        .map(instr => instr.owner)\n                        .filter((value, index, arr) => arr.indexOf(value) === index);\n                    for (const owner of routeScopeOwners) {\n                        configured = await this.findInstructions(owner.scope, configuredRoute.remaining, owner.scope);\n                        if (configured.foundConfiguration) {\n                            break;\n                        }\n                    }\n                    if (configured.foundInstructions) {\n                        configuredRoute = configured;\n                        configuredRoutePath = `${configuredRoutePath || ''}/${configuredRoute.matching}`;\n                    }\n                    else {\n                        // TODO: Do something here!\n                        this.unknownRoute(configured.remaining);\n                    }\n                    this.appendInstructions(configured.instructions);\n                }\n                // Don't use defaults when it's a full state navigation\n                if (fullStateInstruction) {\n                    this.appendedInstructions = this.appendedInstructions.filter(instruction => !instruction.default);\n                }\n                // Process non-defaults first\n                let appendedInstructions = this.appendedInstructions.filter(instruction => !instruction.default);\n                this.appendedInstructions = this.appendedInstructions.filter(instruction => instruction.default);\n                if (appendedInstructions.length === 0) {\n                    const index = this.appendedInstructions.findIndex(instruction => instruction.default);\n                    if (index >= 0) {\n                        appendedInstructions = this.appendedInstructions.splice(index, 1);\n                    }\n                }\n                while (appendedInstructions.length > 0) {\n                    const appendedInstruction = appendedInstructions.shift();\n                    const existingAlreadyFound = alreadyFoundInstructions.some(instruction => instruction.sameViewport(appendedInstruction));\n                    const existingFound = viewportInstructions.find(value => value.sameViewport(appendedInstruction));\n                    const existingRemaining = remainingInstructions.find(value => value.sameViewport(appendedInstruction));\n                    if (appendedInstruction.default &&\n                        (existingAlreadyFound ||\n                            (existingFound !== void 0 && !existingFound.default) ||\n                            (existingRemaining !== void 0 && !existingRemaining.default))) {\n                        continue;\n                    }\n                    if (existingFound !== void 0) {\n                        arrayRemove(viewportInstructions, value => value === existingFound);\n                    }\n                    if (existingRemaining !== void 0) {\n                        arrayRemove(remainingInstructions, value => value === existingRemaining);\n                    }\n                    if (appendedInstruction.viewport !== null) {\n                        viewportInstructions.push(appendedInstruction);\n                    }\n                    else {\n                        remainingInstructions.push(appendedInstruction);\n                    }\n                }\n                if (viewportInstructions.length === 0 && remainingInstructions.length === 0) {\n                    viewportInstructions = clearScopeOwners.map(owner => {\n                        const instruction = this.createViewportInstruction(this.instructionResolver.clearViewportInstruction, owner.isViewport ? owner : void 0);\n                        if (owner.isViewportScope) {\n                            instruction.viewportScope = owner;\n                        }\n                        return instruction;\n                    });\n                    viewportInstructions.push(...clearViewportScopes.map(viewportScope => {\n                        const instr = this.createViewportInstruction(this.instructionResolver.clearViewportInstruction);\n                        instr.viewportScope = viewportScope;\n                        return instr;\n                    }));\n                    clearViewportScopes = [];\n                }\n            } while (viewportInstructions.length > 0 || remainingInstructions.length > 0);\n            await Promise.all(updatedScopeOwners.map((value) => value.loadContent()));\n            await this.replacePaths(instruction);\n            // this.updateNav();\n            // Remove history entry if no history viewports updated\n            if (instructionNavigation.new && !instructionNavigation.first && !instruction.repeating && updatedScopeOwners.every(viewport => viewport.options.noHistory)) {\n                instruction.untracked = true;\n            }\n            updatedScopeOwners.forEach((viewport) => {\n                viewport.finalizeContentChange();\n            });\n            this.lastNavigation = this.processingNavigation;\n            if (this.lastNavigation.repeating) {\n                this.lastNavigation.repeating = false;\n            }\n            this.processingNavigation = null;\n            await this.navigator.finalize(instruction);\n        };\n        this.hookManager = new HookManager();\n    }\n    get isNavigating() {\n        return this.processingNavigation !== null;\n    }\n    get statefulHistory() {\n        return this.options.statefulHistoryLength !== void 0 && this.options.statefulHistoryLength > 0;\n    }\n    activate(options) {\n        if (this.isActive) {\n            throw new Error('Router has already been activated');\n        }\n        this.isActive = true;\n        this.options = {\n            ...this.options,\n            ...options\n        };\n        if (this.options.hooks !== void 0) {\n            this.addHooks(this.options.hooks);\n        }\n        this.instructionResolver.activate({ separators: this.options.separators });\n        this.navigator.activate(this, {\n            callback: this.navigatorCallback,\n            store: this.navigation,\n            statefulHistoryLength: this.options.statefulHistoryLength,\n            serializeCallback: this.statefulHistory ? this.navigatorSerializeCallback : void 0,\n        });\n        this.linkHandler.activate({ callback: this.linkCallback, useHref: this.options.useHref });\n        this.navigation.activate({\n            callback: this.browserNavigatorCallback,\n            useUrlFragmentHash: this.options.useUrlFragmentHash\n        });\n        this.ensureRootScope();\n    }\n    async loadUrl() {\n        const entry = {\n            ...this.navigation.viewerState,\n            ...{\n                fullStateInstruction: '',\n                replacing: true,\n                fromBrowser: false,\n            }\n        };\n        const result = this.navigator.navigate(entry);\n        this.loadedFirst = true;\n        return result;\n    }\n    deactivate() {\n        if (!this.isActive) {\n            throw new Error('Router has not been activated');\n        }\n        this.linkHandler.deactivate();\n        this.navigator.deactivate();\n        this.navigation.deactivate();\n    }\n    findScope(origin) {\n        // this.ensureRootScope();\n        if (origin === void 0 || origin === null) {\n            return this.rootScope.scope;\n        }\n        if (origin instanceof Scope || origin instanceof Viewport) {\n            return origin.scope;\n        }\n        return this.getClosestScope(origin) || this.rootScope.scope;\n    }\n    findParentScope(container) {\n        if (container === null) {\n            return this.rootScope.scope;\n        }\n        // Already (prematurely) set on this view model so get it from container's parent instead\n        if (container.has(ClosestScope, false)) {\n            container = container.parent;\n            if (container === null) {\n                return this.rootScope.scope;\n            }\n        }\n        if (container.has(ClosestScope, true)) {\n            return container.get(ClosestScope);\n        }\n        return this.rootScope.scope;\n    }\n    // External API to get viewport by name\n    getViewport(name) {\n        return this.allViewports().find(viewport => viewport.name === name) || null;\n    }\n    // Called from the viewport scope custom element in created()\n    setClosestScope(viewModelOrContainer, scope) {\n        const container = this.getContainer(viewModelOrContainer);\n        Registration.instance(ClosestScope, scope).register(container);\n    }\n    getClosestScope(viewModelOrElement) {\n        const container = 'resourceResolvers' in viewModelOrElement\n            ? viewModelOrElement\n            : this.getClosestContainer(viewModelOrElement);\n        if (container === null) {\n            return null;\n        }\n        if (!container.has(ClosestScope, true)) {\n            return null;\n        }\n        return container.get(ClosestScope) || null;\n    }\n    unsetClosestScope(viewModelOrContainer) {\n        const container = this.getContainer(viewModelOrContainer);\n        // TODO: Get an 'unregister' on container\n        container.resolvers.delete(ClosestScope);\n    }\n    // Called from the viewport custom element in attached()\n    connectViewport(viewport, container, name, element, options) {\n        const parentScope = this.findParentScope(container);\n        if (viewport === null) {\n            viewport = parentScope.addViewport(name, element, container, options);\n            this.setClosestScope(container, viewport.connectedScope);\n        }\n        return viewport;\n    }\n    // Called from the viewport custom element\n    disconnectViewport(viewport, container, element) {\n        if (!viewport.connectedScope.parent.removeViewport(viewport, element, container)) {\n            throw new Error(`Failed to remove viewport: ${viewport.name}`);\n        }\n        this.unsetClosestScope(container);\n    }\n    // Called from the viewport scope custom element in attached()\n    connectViewportScope(viewportScope, name, container, element, options) {\n        const parentScope = this.findParentScope(container);\n        if (viewportScope === null) {\n            viewportScope = parentScope.addViewportScope(name, element, options);\n            this.setClosestScope(container, viewportScope.connectedScope);\n        }\n        return viewportScope;\n    }\n    // Called from the viewport scope custom element\n    disconnectViewportScope(viewportScope, container) {\n        if (!viewportScope.connectedScope.parent.removeViewportScope(viewportScope)) {\n            throw new Error(`Failed to remove viewport scope: ${viewportScope.path}`);\n        }\n        this.unsetClosestScope(container);\n    }\n    allViewports(includeDisabled = false, includeReplaced = false) {\n        // this.ensureRootScope();\n        return this.rootScope.scope.allViewports(includeDisabled, includeReplaced);\n    }\n    goto(instructions, options) {\n        options = options || {};\n        // TODO: Review query extraction; different pos for path and fragment!\n        if (typeof instructions === 'string' && !options.query) {\n            const [path, search] = instructions.split('?');\n            instructions = path;\n            options.query = search;\n        }\n        const toOptions = {};\n        if (options.origin) {\n            toOptions.context = options.origin;\n        }\n        let scope = null;\n        ({ instructions, scope } = NavigationInstructionResolver.createViewportInstructions(this, instructions, toOptions));\n        if (options.append && this.processingNavigation) {\n            instructions = NavigationInstructionResolver.toViewportInstructions(this, instructions);\n            this.appendInstructions(instructions, scope);\n            // Can't return current navigation promise since it can lead to deadlock in enter\n            return Promise.resolve();\n        }\n        const entry = {\n            instruction: instructions,\n            fullStateInstruction: '',\n            scope: scope,\n            title: options.title,\n            data: options.data,\n            query: options.query,\n            replacing: options.replace,\n            repeating: options.append,\n            fromBrowser: false,\n        };\n        return this.navigator.navigate(entry);\n    }\n    refresh() {\n        return this.navigator.refresh();\n    }\n    back() {\n        return this.navigator.go(-1);\n    }\n    forward() {\n        return this.navigator.go(1);\n    }\n    checkActive(instructions) {\n        for (const instruction of instructions) {\n            const scopeInstructions = this.instructionResolver.matchScope(this.activeComponents, instruction.scope);\n            const matching = scopeInstructions.filter(instr => instr.sameComponent(instruction));\n            if (matching.length === 0) {\n                return false;\n            }\n            if (Array.isArray(instruction.nextScopeInstructions)\n                && instruction.nextScopeInstructions.length > 0\n                && this.instructionResolver.matchChildren(instruction.nextScopeInstructions, matching.map(instr => Array.isArray(instr.nextScopeInstructions) ? instr.nextScopeInstructions : []).flat()) === false) {\n                return false;\n            }\n        }\n        return true;\n    }\n    setNav(name, routes, classes) {\n        const nav = this.findNav(name);\n        if (nav !== void 0 && nav !== null) {\n            nav.routes = [];\n        }\n        this.addNav(name, routes, classes);\n    }\n    addNav(name, routes, classes) {\n        let nav = this.navs[name];\n        if (nav === void 0 || nav === null) {\n            nav = this.navs[name] = new Nav(this, name, [], classes);\n        }\n        nav.addRoutes(routes);\n        nav.update();\n    }\n    updateNav(name) {\n        const navs = name\n            ? [name]\n            : Object.keys(this.navs);\n        for (const nav of navs) {\n            if (this.navs[nav] !== void 0 && this.navs[nav] !== null) {\n                this.navs[nav].update();\n            }\n        }\n    }\n    findNav(name) {\n        return this.navs[name];\n    }\n    addRoutes(routes, context) {\n        // TODO: This should add to the context instead\n        // TODO: Add routes without context to rootScope content (which needs to be created)?\n        return [];\n        // const viewport = (context !== void 0 ? this.closestViewport(context) : this.rootScope) || this.rootScope as Viewport;\n        // return viewport.addRoutes(routes);\n    }\n    removeRoutes(routes, context) {\n        // TODO: This should remove from the context instead\n        // const viewport = (context !== void 0 ? this.closestViewport(context) : this.rootScope) || this.rootScope as Viewport;\n        // return viewport.removeRoutes(routes);\n    }\n    addHooks(hooks) {\n        return hooks.map(hook => this.addHook(hook.hook, hook.options));\n    }\n    addHook(hook, options) {\n        return this.hookManager.addHook(hook, options);\n    }\n    removeHooks(hooks) {\n        return;\n    }\n    createViewportInstruction(component, viewport, parameters, ownsScope = true, nextScopeInstructions = null) {\n        return this.instructionResolver.createViewportInstruction(component, viewport, parameters, ownsScope, nextScopeInstructions);\n    }\n    async findInstructions(scope, instruction, instructionScope, transformUrl = false) {\n        let route = new FoundRoute();\n        if (typeof instruction === 'string') {\n            instruction = transformUrl\n                ? await this.hookManager.invokeTransformFromUrl(instruction, this.processingNavigation)\n                : instruction;\n            if (Array.isArray(instruction)) {\n                route.instructions = instruction;\n            }\n            else {\n                // TODO: Review this\n                if (instruction === '/') {\n                    instruction = '';\n                }\n                const instructions = this.instructionResolver.parseViewportInstructions(instruction);\n                if (this.options.useConfiguredRoutes && !this.hasSiblingInstructions(instructions)) {\n                    const foundRoute = scope.findMatchingRoute(instruction);\n                    if (foundRoute !== null && foundRoute.foundConfiguration) {\n                        route = foundRoute;\n                    }\n                    else {\n                        if (this.options.useDirectRoutes) {\n                            route.instructions = instructions;\n                            if (route.instructions.length > 0) {\n                                const nextInstructions = route.instructions[0].nextScopeInstructions || [];\n                                route.remaining = this.instructionResolver.stringifyViewportInstructions(nextInstructions);\n                                route.instructions[0].nextScopeInstructions = null;\n                            }\n                        }\n                    }\n                }\n                else if (this.options.useDirectRoutes) {\n                    route.instructions = instructions;\n                }\n            }\n        }\n        else {\n            route.instructions = instruction;\n        }\n        for (const instr of route.instructions) {\n            if (instr.scope === null) {\n                instr.scope = instructionScope;\n            }\n        }\n        return route;\n    }\n    hasSiblingInstructions(instructions) {\n        if (instructions === null) {\n            return false;\n        }\n        if (instructions.length > 1) {\n            return true;\n        }\n        return instructions.some(instruction => this.hasSiblingInstructions(instruction.nextScopeInstructions));\n    }\n    appendInstructions(instructions, scope = null) {\n        if (scope === null) {\n            scope = this.rootScope.scope;\n        }\n        for (const instruction of instructions) {\n            if (instruction.scope === null) {\n                instruction.scope = scope;\n            }\n        }\n        this.appendedInstructions.push(...instructions);\n    }\n    checkStale(name, instructions) {\n        const staleCheck = this.staleChecks[name];\n        if (staleCheck === void 0) {\n            this.staleChecks[name] = instructions.slice();\n            return false;\n        }\n        if (staleCheck.length !== instructions.length) {\n            this.staleChecks[name] = instructions.slice();\n            return false;\n        }\n        for (let i = 0, ii = instructions.length; i < ii; i++) {\n            if (staleCheck[i] !== instructions[i]) {\n                this.staleChecks[name] = instructions.slice();\n                return false;\n            }\n        }\n        return true;\n    }\n    unknownRoute(route) {\n        if (typeof route !== 'string' || route.length === 0) {\n            return;\n        }\n        if (this.options.useConfiguredRoutes && this.options.useDirectRoutes) {\n            // TODO: Add missing/unknown route handling\n            throw new Error(`No matching configured route or component found for '${route}'`);\n        }\n        else if (this.options.useConfiguredRoutes) {\n            // TODO: Add missing/unknown route handling\n            throw new Error(`No matching configured route found for '${route}'`);\n        }\n        else {\n            // TODO: Add missing/unknown route handling\n            throw new Error(`No matching route/component found for '${route}'`);\n        }\n    }\n    findViewports(instructions, alreadyFound, withoutViewports = false) {\n        const found = [];\n        const remaining = [];\n        while (instructions.length) {\n            if (instructions[0].scope === null) {\n                instructions[0].scope = this.rootScope.scope;\n            }\n            const scope = instructions[0].scope;\n            const { foundViewports, remainingInstructions } = scope.findViewports(instructions.filter(instruction => instruction.scope === scope), alreadyFound, withoutViewports);\n            found.push(...foundViewports);\n            remaining.push(...remainingInstructions);\n            instructions = instructions.filter(instruction => instruction.scope !== scope);\n        }\n        return { found: found.slice(), remaining };\n    }\n    async cancelNavigation(updatedScopeOwners, qInstruction) {\n        // TODO: Take care of disabling viewports when cancelling and stateful!\n        updatedScopeOwners.forEach((viewport) => {\n            viewport.abortContentChange().catch(error => { throw error; });\n        });\n        await this.navigator.cancel(qInstruction);\n        this.processingNavigation = null;\n        qInstruction.resolve();\n    }\n    ensureRootScope() {\n        if (!this.rootScope) {\n            const root = this.container.get(Aurelia).root;\n            // root.config.component shouldn't be used in the end. Metadata will probably eliminate it\n            this.rootScope = new ViewportScope('rootScope', this, root.config.host, null, true, root.config.component);\n        }\n        return this.rootScope;\n    }\n    async replacePaths(instruction) {\n        this.rootScope.scope.reparentViewportInstructions();\n        let instructions = this.rootScope.scope.hoistedChildren\n            .filter(scope => scope.viewportInstruction !== null && !scope.viewportInstruction.isEmpty())\n            .map(scope => scope.viewportInstruction);\n        instructions = this.instructionResolver.cloneViewportInstructions(instructions, true);\n        // The following makes sure right viewport/viewport scopes are set and update\n        // whether viewport name is necessary or not\n        const alreadyFound = [];\n        let { found, remaining } = this.findViewports(instructions, alreadyFound, true);\n        let guard = 100;\n        while (remaining.length) {\n            // Guard against endless loop\n            if (!guard--) {\n                throw new Error('Failed to find viewport when updating viewer paths.');\n            }\n            alreadyFound.push(...found);\n            ({ found, remaining } = this.findViewports(remaining, alreadyFound, true));\n        }\n        this.activeComponents = instructions;\n        this.activeRoute = instruction.route;\n        // First invoke with viewport instructions (should it perhaps get full state?)\n        let state = await this.hookManager.invokeTransformToUrl(instructions, instruction);\n        if (typeof state !== 'string') {\n            // Convert to string if necessary\n            state = this.instructionResolver.stringifyViewportInstructions(state, false, true);\n        }\n        // Invoke again with string\n        state = await this.hookManager.invokeTransformToUrl(state, instruction);\n        const query = (instruction.query && instruction.query.length ? `?${instruction.query}` : '');\n        // if (instruction.path === void 0 || instruction.path.length === 0 || instruction.path === '/') {\n        instruction.path = state + query;\n        // }\n        const fullViewportStates = [this.createViewportInstruction(this.instructionResolver.clearViewportInstruction)];\n        fullViewportStates.push(...this.instructionResolver.cloneViewportInstructions(instructions, this.statefulHistory));\n        instruction.fullStateInstruction = fullViewportStates;\n        // TODO: Fetch and update title\n        return Promise.resolve();\n    }\n    async freeComponents(instruction, excludeComponents, alreadyDone) {\n        const component = instruction.componentInstance;\n        const viewport = instruction.viewport;\n        if (component === null || viewport === null || alreadyDone.some(done => done === component)) {\n            return;\n        }\n        if (!excludeComponents.some(exclude => exclude === component)) {\n            await viewport.freeContent(component);\n            alreadyDone.push(component);\n            return;\n        }\n        if (instruction.nextScopeInstructions !== null) {\n            for (const nextInstruction of instruction.nextScopeInstructions) {\n                await this.freeComponents(nextInstruction, excludeComponents, alreadyDone);\n            }\n        }\n    }\n    getClosestContainer(viewModelOrElement) {\n        if ('context' in viewModelOrElement) {\n            return viewModelOrElement.context;\n        }\n        if ('$controller' in viewModelOrElement) {\n            return viewModelOrElement.$controller.context;\n        }\n        const controller = this.CustomElementFor(viewModelOrElement);\n        if (controller === void 0) {\n            return null;\n        }\n        return controller.context;\n    }\n    getContainer(viewModelOrContainer) {\n        if ('resourceResolvers' in viewModelOrContainer) {\n            return viewModelOrContainer;\n        }\n        if (isRenderContext(viewModelOrContainer)) {\n            return viewModelOrContainer.get(IContainer);\n        }\n        if ('$controller' in viewModelOrContainer) {\n            return viewModelOrContainer.$controller.context.get(IContainer);\n        }\n        return null;\n    }\n    // TODO: This is probably wrong since it caused test fails when in CustomElement.for\n    // Fred probably knows and will need to look at it\n    // This can most likely also be changed so that the node traversal isn't necessary\n    CustomElementFor(node) {\n        let cur = node;\n        while (cur !== null) {\n            const nodeResourceName = cur.nodeName.toLowerCase();\n            const controller = Metadata.getOwn(`${CustomElement.name}:${nodeResourceName}`, cur)\n                || Metadata.getOwn(CustomElement.name, cur);\n            if (controller !== void 0) {\n                return controller;\n            }\n            cur = DOM.getEffectiveParentNode(cur);\n        }\n        return (void 0);\n    }\n}\nRouter.inject = [IContainer, Navigator, BrowserViewerStore, LinkHandler, InstructionResolver];\n//# sourceMappingURL=router.js.map","import { Reporter } from '@aurelia/kernel';\nimport { Queue } from './queue';\nexport class Navigator {\n    constructor() {\n        this.entries = [];\n        this.options = {\n            statefulHistoryLength: 0,\n        };\n        this.isActive = false;\n        this.processNavigations = (qEntry) => {\n            const entry = qEntry;\n            const navigationFlags = {};\n            if (this.currentEntry === this.uninitializedEntry) { // Refresh or first entry\n                this.loadState();\n                if (this.currentEntry !== this.uninitializedEntry) {\n                    navigationFlags.refresh = true;\n                }\n                else {\n                    navigationFlags.first = true;\n                    navigationFlags.new = true;\n                    // TODO: Should this really be created here? Shouldn't it be in the viewer?\n                    this.currentEntry = {\n                        index: 0,\n                        instruction: '',\n                        fullStateInstruction: '',\n                    };\n                    this.entries = [];\n                }\n            }\n            if (entry.index !== void 0 && !entry.replacing && !entry.refreshing) { // History navigation\n                entry.historyMovement = entry.index - (this.currentEntry.index !== void 0 ? this.currentEntry.index : 0);\n                entry.instruction = this.entries[entry.index] !== void 0 && this.entries[entry.index] !== null ? this.entries[entry.index].fullStateInstruction : entry.fullStateInstruction;\n                entry.replacing = true;\n                if (entry.historyMovement > 0) {\n                    navigationFlags.forward = true;\n                }\n                else if (entry.historyMovement < 0) {\n                    navigationFlags.back = true;\n                }\n            }\n            else if (entry.refreshing || navigationFlags.refresh) { // Refreshing\n                entry.index = this.currentEntry.index;\n            }\n            else if (entry.replacing) { // Replacing\n                navigationFlags.replace = true;\n                navigationFlags.new = true;\n                entry.index = this.currentEntry.index;\n            }\n            else { // New entry\n                navigationFlags.new = true;\n                entry.index = this.currentEntry.index !== void 0 ? this.currentEntry.index + 1 : this.entries.length;\n            }\n            this.invokeCallback(entry, navigationFlags, this.currentEntry);\n        };\n        this.uninitializedEntry = {\n            instruction: 'NAVIGATOR UNINITIALIZED',\n            fullStateInstruction: '',\n        };\n        this.currentEntry = this.uninitializedEntry;\n        this.pendingNavigations = new Queue(this.processNavigations);\n    }\n    get queued() {\n        return this.pendingNavigations.length;\n    }\n    activate(router, options) {\n        if (this.isActive) {\n            throw new Error('Navigator has already been activated');\n        }\n        this.isActive = true;\n        this.router = router;\n        this.options = { ...options };\n    }\n    deactivate() {\n        if (!this.isActive) {\n            throw new Error('Navigator has not been activated');\n        }\n        this.pendingNavigations.clear();\n        this.isActive = false;\n    }\n    navigate(entry) {\n        return this.pendingNavigations.enqueue(entry);\n    }\n    refresh() {\n        const entry = this.currentEntry;\n        if (entry === this.uninitializedEntry) {\n            return Promise.reject();\n        }\n        entry.replacing = true;\n        entry.refreshing = true;\n        return this.navigate(entry);\n    }\n    go(movement) {\n        const newIndex = (this.currentEntry.index !== undefined ? this.currentEntry.index : 0) + movement;\n        if (newIndex >= this.entries.length) {\n            return Promise.reject();\n        }\n        const entry = this.entries[newIndex];\n        return this.navigate(entry);\n    }\n    setEntryTitle(title) {\n        this.currentEntry.title = title;\n        return this.saveState();\n    }\n    get titles() {\n        if (this.currentEntry == this.uninitializedEntry) {\n            return [];\n        }\n        const index = this.currentEntry.index !== void 0 ? this.currentEntry.index : 0;\n        return this.entries.slice(0, index + 1).filter((value) => !!value.title).map((value) => value.title ? value.title : '');\n    }\n    getState() {\n        const state = this.options.store ? { ...this.options.store.state } : {};\n        const entries = (state.entries || []);\n        const currentEntry = (state.currentEntry || this.uninitializedEntry);\n        return { state, entries, currentEntry };\n    }\n    loadState() {\n        const state = this.getState();\n        this.entries = state.entries;\n        this.currentEntry = state.currentEntry;\n    }\n    async saveState(push = false) {\n        if (this.currentEntry === this.uninitializedEntry) {\n            return Promise.resolve();\n        }\n        const storedEntry = this.toStoredEntry(this.currentEntry);\n        this.entries[storedEntry.index !== undefined ? storedEntry.index : 0] = storedEntry;\n        if (this.options.serializeCallback !== void 0 && this.options.statefulHistoryLength > 0) {\n            const index = this.entries.length - this.options.statefulHistoryLength;\n            for (let i = 0; i < index; i++) {\n                const entry = this.entries[i];\n                if (typeof entry.instruction !== 'string' || typeof entry.fullStateInstruction !== 'string') {\n                    this.entries[i] = await this.options.serializeCallback(entry, this.entries.slice(index));\n                }\n            }\n        }\n        if (!this.options.store) {\n            return Promise.resolve();\n        }\n        const state = {\n            entries: [],\n            currentEntry: { ...this.toStoreableEntry(storedEntry) },\n        };\n        for (const entry of this.entries) {\n            state.entries.push(this.toStoreableEntry(entry));\n        }\n        if (push) {\n            return this.options.store.pushNavigatorState(state);\n        }\n        else {\n            return this.options.store.replaceNavigatorState(state);\n        }\n    }\n    toStoredEntry(entry) {\n        const { previous, fromBrowser, replacing, refreshing, untracked, historyMovement, navigation, scope, resolve, reject, ...storableEntry } = entry;\n        return storableEntry;\n    }\n    async finalize(instruction) {\n        this.currentEntry = instruction;\n        let index = this.currentEntry.index !== undefined ? this.currentEntry.index : 0;\n        if (this.currentEntry.untracked) {\n            if (instruction.fromBrowser && this.options.store) {\n                await this.options.store.popNavigatorState();\n            }\n            index--;\n            this.currentEntry.index = index;\n            this.entries[index] = this.toStoredEntry(this.currentEntry);\n            await this.saveState();\n        }\n        else if (this.currentEntry.replacing) {\n            this.entries[index] = this.toStoredEntry(this.currentEntry);\n            await this.saveState();\n        }\n        else { // New entry (add and discard later entries)\n            if (this.options.serializeCallback !== void 0 && this.options.statefulHistoryLength > 0) {\n                // Need to clear the instructions we discard!\n                const indexPreserve = this.entries.length - this.options.statefulHistoryLength;\n                for (const entry of this.entries.slice(index)) {\n                    if (typeof entry.instruction !== 'string' || typeof entry.fullStateInstruction !== 'string') {\n                        await this.options.serializeCallback(entry, this.entries.slice(indexPreserve, index));\n                    }\n                }\n            }\n            this.entries = this.entries.slice(0, index);\n            this.entries.push(this.toStoredEntry(this.currentEntry));\n            await this.saveState(true);\n        }\n        if (this.currentEntry.resolve) {\n            this.currentEntry.resolve();\n        }\n    }\n    async cancel(instruction) {\n        if (instruction.fromBrowser && this.options.store) {\n            if (instruction.navigation && instruction.navigation.new) {\n                await this.options.store.popNavigatorState();\n            }\n            else {\n                await this.options.store.go(-(instruction.historyMovement || 0), true);\n            }\n        }\n        if (this.currentEntry.resolve) {\n            this.currentEntry.resolve();\n        }\n    }\n    invokeCallback(entry, navigationFlags, previousEntry) {\n        const instruction = { ...entry };\n        instruction.navigation = navigationFlags;\n        instruction.previous = this.toStoredEntry(previousEntry);\n        Reporter.write(10000, 'callback', instruction, instruction.previous, this.entries);\n        if (this.options.callback) {\n            this.options.callback(instruction);\n        }\n    }\n    toStoreableEntry(entry) {\n        const storeable = { ...entry };\n        if (storeable.instruction && typeof storeable.instruction !== 'string') {\n            storeable.instruction = this.router.instructionResolver.stringifyViewportInstructions(storeable.instruction);\n        }\n        if (storeable.fullStateInstruction && typeof storeable.fullStateInstruction !== 'string') {\n            storeable.fullStateInstruction = this.router.instructionResolver.stringifyViewportInstructions(storeable.fullStateInstruction);\n        }\n        return storeable;\n    }\n}\n//# sourceMappingURL=navigator.js.map","import { ViewportInstruction } from './viewport-instruction';\nexport class InstructionResolver {\n    constructor() {\n        this.separators = {\n            viewport: '@',\n            sibling: '+',\n            scope: '/',\n            scopeStart: '(',\n            scopeEnd: ')',\n            noScope: '!',\n            parameters: '(',\n            parametersEnd: ')',\n            parameterSeparator: ',',\n            parameterKeySeparator: '=',\n            parameter: '&',\n            add: '+',\n            clear: '-',\n            action: '.',\n        };\n    }\n    activate(options) {\n        options = options || {};\n        this.separators = { ...this.separators, ...options.separators };\n    }\n    get clearViewportInstruction() {\n        return this.separators.clear;\n    }\n    get addViewportInstruction() {\n        return this.separators.add;\n    }\n    isClearViewportInstruction(instruction) {\n        return instruction instanceof ViewportInstruction\n            ? instruction.componentName === this.clearViewportInstruction && !!instruction.viewportName\n            : instruction.startsWith(this.clearViewportInstruction) && instruction !== this.clearViewportInstruction;\n    }\n    isAddViewportInstruction(instruction) {\n        return instruction instanceof ViewportInstruction\n            ? instruction.componentName === this.addViewportInstruction\n            : (instruction === this.addViewportInstruction\n                || instruction.startsWith(`${this.separators.add}${this.separators.viewport}`));\n    }\n    isClearViewportScopeInstruction(instruction) {\n        return instruction instanceof ViewportInstruction\n            ? instruction.componentName === this.clearViewportInstruction && !!instruction.viewportScope\n            : instruction.startsWith(this.clearViewportInstruction) && instruction !== this.clearViewportInstruction;\n    }\n    isClearAllViewportsInstruction(instruction) {\n        return instruction instanceof ViewportInstruction\n            ? instruction.componentName === this.clearViewportInstruction && !instruction.viewportName\n            : instruction === this.clearViewportInstruction;\n    }\n    isAddAllViewportsInstruction(instruction) {\n        return instruction instanceof ViewportInstruction\n            ? instruction.componentName === this.addViewportInstruction && !instruction.viewportName\n            : instruction === this.addViewportInstruction;\n    }\n    createViewportInstruction(component, viewport, parameters, ownsScope = true, nextScopeInstructions = null) {\n        const instruction = new ViewportInstruction(component, viewport, parameters, ownsScope, nextScopeInstructions);\n        instruction.setInstructionResolver(this);\n        return instruction;\n    }\n    parseViewportInstructions(instructions) {\n        const match = /^[./]+/.exec(instructions);\n        let context = '';\n        if (Array.isArray(match) && match.length > 0) {\n            context = match[0];\n            instructions = instructions.slice(context.length);\n        }\n        const parsedInstructions = this.parseViewportInstructionsWorker(instructions, true).instructions;\n        for (const instruction of parsedInstructions) {\n            instruction.context = context;\n        }\n        return parsedInstructions;\n    }\n    parseViewportInstruction(instruction) {\n        const instructions = this.parseViewportInstructions(instruction);\n        if (instructions.length) {\n            return instructions[0];\n        }\n        return this.createViewportInstruction('');\n    }\n    stringifyViewportInstructions(instructions, excludeViewport = false, viewportContext = false) {\n        return instructions\n            .map(instruction => this.stringifyViewportInstruction(instruction, excludeViewport, viewportContext))\n            .filter(instruction => instruction && instruction.length)\n            .join(this.separators.sibling);\n    }\n    stringifyViewportInstruction(instruction, excludeViewport = false, viewportContext = false) {\n        if (typeof instruction === 'string') {\n            return this.stringifyAViewportInstruction(instruction, excludeViewport);\n        }\n        else {\n            let excludeCurrentViewport = excludeViewport;\n            let excludeCurrentComponent = false;\n            if (viewportContext) {\n                if (instruction.viewport && instruction.viewport.options.noLink) {\n                    return '';\n                }\n                if (!instruction.needsViewportDescribed && instruction.viewport && !instruction.viewport.options.forceDescription) {\n                    excludeCurrentViewport = true;\n                }\n                if (instruction.viewport && instruction.viewport.options.fallback === instruction.componentName) {\n                    excludeCurrentComponent = true;\n                }\n                if (!instruction.needsViewportDescribed && instruction.viewportScope) {\n                    excludeCurrentViewport = true;\n                }\n            }\n            const route = instruction.route;\n            const nextInstructions = instruction.nextScopeInstructions;\n            let stringified = instruction.context;\n            // It's a configured route\n            if (route !== null) {\n                // Already added as part of a configuration, skip to next scope\n                if (route === '') {\n                    return Array.isArray(nextInstructions)\n                        ? this.stringifyViewportInstructions(nextInstructions, excludeViewport, viewportContext)\n                        : '';\n                }\n                stringified += route.endsWith(this.separators.scope) ? route.slice(0, -this.separators.scope.length) : route;\n            }\n            else {\n                stringified += this.stringifyAViewportInstruction(instruction, excludeCurrentViewport, excludeCurrentComponent);\n            }\n            if (Array.isArray(nextInstructions) && nextInstructions.length) {\n                const nextStringified = this.stringifyViewportInstructions(nextInstructions, excludeViewport, viewportContext);\n                if (nextStringified.length > 0) {\n                    stringified += nextInstructions.length === 1 // TODO: This should really also check that the instructions have value\n                        ? `${this.separators.scope}${nextStringified}`\n                        : `${this.separators.scope}${this.separators.scopeStart}${nextStringified}${this.separators.scopeEnd}`;\n                }\n            }\n            return stringified;\n        }\n    }\n    stringifyScopedViewportInstructions(instructions) {\n        if (!Array.isArray(instructions)) {\n            return this.stringifyScopedViewportInstructions([instructions]);\n        }\n        return instructions.map((instruction) => this.stringifyViewportInstruction(instruction)).join(this.separators.scope);\n    }\n    encodeViewportInstructions(instructions) {\n        return encodeURIComponent(this.stringifyViewportInstructions(instructions)).replace(/\\(/g, '%28').replace(/\\)/g, '%29');\n    }\n    decodeViewportInstructions(instructions) {\n        return this.parseViewportInstructions(decodeURIComponent(instructions));\n    }\n    buildScopedLink(scopeContext, href) {\n        if (scopeContext) {\n            href = `/${scopeContext}${this.separators.scope}${href}`;\n        }\n        return href;\n    }\n    shouldClearViewports(path) {\n        const clearViewports = (path === this.separators.clear || path.startsWith(this.separators.clear + this.separators.add));\n        const newPath = path.startsWith(this.separators.clear) ? path.slice(2) : path;\n        return { clearViewports, newPath };\n    }\n    mergeViewportInstructions(instructions) {\n        const merged = [];\n        for (let instruction of instructions) {\n            if (typeof instruction === 'string') {\n                instruction = this.parseViewportInstruction(instruction);\n            }\n            const index = merged.findIndex(merge => merge.sameViewport(instruction));\n            if (index >= 0) {\n                merged.splice(index, 1, instruction);\n            }\n            else {\n                merged.push(instruction);\n            }\n        }\n        return merged;\n    }\n    flattenViewportInstructions(instructions) {\n        const flat = [];\n        for (const instruction of instructions) {\n            flat.push(instruction);\n            if (instruction.nextScopeInstructions) {\n                flat.push(...this.flattenViewportInstructions(instruction.nextScopeInstructions));\n            }\n        }\n        return flat;\n    }\n    cloneViewportInstructions(instructions, keepInstances = false, context = false) {\n        const clones = [];\n        for (const instruction of instructions) {\n            const clone = this.createViewportInstruction((keepInstances ? instruction.componentInstance : null) || instruction.componentType || instruction.componentName, keepInstances ? instruction.viewport || instruction.viewportName : instruction.viewportName, instruction.typedParameters !== null ? instruction.typedParameters : void 0);\n            clone.needsViewportDescribed = instruction.needsViewportDescribed;\n            clone.route = instruction.route;\n            if (context) {\n                clone.context = instruction.context;\n            }\n            clone.viewportScope = keepInstances ? instruction.viewportScope : null;\n            clone.scope = keepInstances ? instruction.scope : null;\n            if (instruction.nextScopeInstructions) {\n                clone.nextScopeInstructions = this.cloneViewportInstructions(instruction.nextScopeInstructions, keepInstances, context);\n            }\n            clones.push(clone);\n        }\n        return clones;\n    }\n    // TODO: Deal with separators in data and complex types\n    parseComponentParameters(parameters, uriComponent = false) {\n        if (parameters === undefined || parameters === null || parameters.length === 0) {\n            return [];\n        }\n        if (typeof parameters === 'string') {\n            const list = [];\n            const params = parameters.split(this.separators.parameterSeparator);\n            for (const param of params) {\n                let key;\n                let value;\n                [key, value] = param.split(this.separators.parameterKeySeparator);\n                if (value === void 0) {\n                    value = uriComponent ? decodeURIComponent(key) : key;\n                    key = void 0;\n                }\n                else if (uriComponent) {\n                    key = decodeURIComponent(key);\n                    value = decodeURIComponent(value);\n                }\n                list.push({ key, value });\n            }\n            return list;\n        }\n        if (Array.isArray(parameters)) {\n            return parameters.map(param => ({ key: void 0, value: param }));\n        }\n        const keys = Object.keys(parameters);\n        keys.sort();\n        return keys.map(key => ({ key, value: parameters[key] }));\n    }\n    // TODO: Deal with separators in data and complex types\n    stringifyComponentParameters(parameters, uriComponent = false) {\n        if (!Array.isArray(parameters) || parameters.length === 0) {\n            return '';\n        }\n        const seps = this.separators;\n        return parameters\n            .map(param => {\n            const key = param.key !== void 0 && uriComponent ? encodeURIComponent(param.key) : param.key;\n            const value = uriComponent ? encodeURIComponent(param.value) : param.value;\n            return key !== void 0 && key !== value ? key + seps.parameterKeySeparator + value : value;\n        })\n            .join(seps.parameterSeparator);\n    }\n    matchScope(instructions, scope) {\n        const matching = [];\n        matching.push(...instructions.filter(instruction => instruction.scope === scope));\n        matching.push(...instructions\n            .filter(instr => instr.scope !== scope)\n            .map(instr => Array.isArray(instr.nextScopeInstructions) ? this.matchScope(instr.nextScopeInstructions, scope) : [])\n            .flat());\n        return matching;\n    }\n    matchChildren(instructions, active) {\n        for (const instruction of instructions) {\n            const matching = active.filter(instr => instr.sameComponent(instruction));\n            if (matching.length === 0) {\n                return false;\n            }\n            if (Array.isArray(instruction.nextScopeInstructions)\n                && instruction.nextScopeInstructions.length > 0\n                && this.matchChildren(instruction.nextScopeInstructions, matching.map(instr => Array.isArray(instr.nextScopeInstructions) ? instr.nextScopeInstructions : []).flat()) === false) {\n                return false;\n            }\n        }\n        return true;\n    }\n    parseViewportInstructionsWorker(instructions, grouped = false) {\n        if (!instructions) {\n            return { instructions: [], remaining: '' };\n        }\n        if (instructions.startsWith(this.separators.scopeStart)) {\n            instructions = `${this.separators.scope}${instructions}`;\n        }\n        const viewportInstructions = [];\n        let guard = 1000;\n        while (instructions.length && guard) {\n            guard--;\n            if (instructions.startsWith(this.separators.scope)) {\n                instructions = instructions.slice(this.separators.scope.length);\n                const scopeStart = instructions.startsWith(this.separators.scopeStart);\n                if (scopeStart) {\n                    instructions = instructions.slice(this.separators.scopeStart.length);\n                }\n                const { instructions: found, remaining } = this.parseViewportInstructionsWorker(instructions, scopeStart);\n                if (viewportInstructions.length) {\n                    viewportInstructions[viewportInstructions.length - 1].nextScopeInstructions = found;\n                }\n                else {\n                    viewportInstructions.push(...found);\n                }\n                instructions = remaining;\n            }\n            else if (instructions.startsWith(this.separators.scopeEnd)) {\n                if (grouped) {\n                    instructions = instructions.slice(this.separators.scopeEnd.length);\n                }\n                return { instructions: viewportInstructions, remaining: instructions };\n            }\n            else if (instructions.startsWith(this.separators.sibling) && !this.isAddViewportInstruction(instructions)) {\n                if (!grouped) {\n                    return { instructions: viewportInstructions, remaining: instructions };\n                }\n                instructions = instructions.slice(this.separators.sibling.length);\n            }\n            else {\n                const { instruction: viewportInstruction, remaining } = this.parseAViewportInstruction(instructions);\n                viewportInstructions.push(viewportInstruction);\n                instructions = remaining;\n            }\n        }\n        return { instructions: viewportInstructions, remaining: instructions };\n    }\n    findNextToken(instruction, tokens) {\n        const matches = {};\n        // Tokens can have length > 1\n        for (const token of tokens) {\n            const tokenPos = instruction.indexOf(token);\n            if (tokenPos > -1) {\n                matches[token] = instruction.indexOf(token);\n            }\n        }\n        const pos = Math.min(...Object.values(matches));\n        for (const token in matches) {\n            if (matches[token] === pos) {\n                return { token, pos };\n            }\n        }\n        return { token: '', pos: -1 };\n    }\n    parseAViewportInstruction(instruction) {\n        const seps = this.separators;\n        const tokens = [seps.parameters, seps.viewport, seps.noScope, seps.scopeEnd, seps.scope, seps.sibling];\n        let component = void 0;\n        let parametersString = void 0;\n        let viewport = void 0;\n        let scope = true;\n        let token;\n        let pos;\n        const specials = [seps.add, seps.clear];\n        for (const special of specials) {\n            if (instruction === special) {\n                component = instruction;\n                instruction = '';\n                tokens.shift(); // parameters\n                tokens.shift(); // viewport\n                token = seps.viewport;\n                break;\n            }\n        }\n        if (component === void 0) {\n            for (const special of specials) {\n                if (instruction.startsWith(`${special}${seps.viewport}`)) {\n                    component = special;\n                    instruction = instruction.slice(`${special}${seps.viewport}`.length);\n                    tokens.shift(); // parameters\n                    tokens.shift(); // viewport\n                    token = seps.viewport;\n                    break;\n                }\n            }\n        }\n        if (component === void 0) {\n            ({ token, pos } = this.findNextToken(instruction, tokens));\n            component = pos !== -1 ? instruction.slice(0, pos) : instruction;\n            instruction = pos !== -1 ? instruction.slice(pos + token.length) : '';\n            tokens.shift(); // parameters\n            if (token === seps.parameters) {\n                ({ token, pos } = this.findNextToken(instruction, [seps.parametersEnd]));\n                parametersString = instruction.slice(0, pos);\n                instruction = instruction.slice(pos + token.length);\n                ({ token } = this.findNextToken(instruction, tokens));\n                instruction = instruction.slice(token.length);\n            }\n            tokens.shift(); // viewport\n        }\n        if (token === seps.viewport) {\n            ({ token, pos } = this.findNextToken(instruction, tokens));\n            viewport = pos !== -1 ? instruction.slice(0, pos) : instruction;\n            instruction = pos !== -1 ? instruction.slice(pos + token.length) : '';\n        }\n        tokens.shift(); // noScope\n        if (token === seps.noScope) {\n            scope = false;\n        }\n        // Restore token that belongs to next instruction\n        if (token === seps.scopeEnd || token === seps.scope || token === seps.sibling) {\n            instruction = `${token}${instruction}`;\n        }\n        const viewportInstruction = this.createViewportInstruction(component, viewport, parametersString, scope);\n        return { instruction: viewportInstruction, remaining: instruction };\n    }\n    stringifyAViewportInstruction(instruction, excludeViewport = false, excludeComponent = false) {\n        if (typeof instruction === 'string') {\n            return this.stringifyViewportInstruction(this.parseViewportInstruction(instruction), excludeViewport, excludeComponent);\n        }\n        else {\n            let instructionString = !excludeComponent ? instruction.componentName : '';\n            const specification = instruction.componentType ? instruction.componentType.parameters : null;\n            const parameters = this.stringifyComponentParameters(instruction.toSortedParameters(specification));\n            if (parameters.length > 0) {\n                instructionString += !excludeComponent\n                    ? `${this.separators.parameters}${parameters}${this.separators.parametersEnd}`\n                    : parameters;\n            }\n            if (instruction.viewportName !== null && !excludeViewport) {\n                instructionString += this.separators.viewport + instruction.viewportName;\n            }\n            if (!instruction.ownsScope) {\n                instructionString += this.separators.noScope;\n            }\n            return instructionString || '';\n        }\n    }\n}\n//# sourceMappingURL=instruction-resolver.js.map","import { __decorate, __metadata } from \"tslib\";\nimport { inject } from '@aurelia/kernel';\nimport { bindable, customElement, INode } from '@aurelia/runtime';\nimport { IRouter } from '../router';\nlet NavCustomElement = class NavCustomElement {\n    constructor(router) {\n        this.router = router;\n        this.name = null;\n        this.routes = null;\n        this.level = 0;\n        this.classes = {};\n    }\n    get navRoutes() {\n        const nav = this.router.navs[this.name];\n        return (nav !== void 0 && nav !== null ? nav.routes : []);\n    }\n    get navClasses() {\n        const nav = this.router.navs[this.name];\n        const navClasses = (nav !== void 0 && nav !== null ? nav.classes : {});\n        return {\n            ...{\n                nav: '',\n                ul: '',\n                li: '',\n                a: '',\n                ulActive: '',\n                liActive: 'nav-active',\n                aActive: '',\n            }, ...navClasses\n        };\n    }\n    active(route) {\n        return 'Active';\n    }\n};\n__decorate([\n    bindable,\n    __metadata(\"design:type\", Object)\n], NavCustomElement.prototype, \"name\", void 0);\n__decorate([\n    bindable,\n    __metadata(\"design:type\", Object)\n], NavCustomElement.prototype, \"routes\", void 0);\n__decorate([\n    bindable,\n    __metadata(\"design:type\", Number)\n], NavCustomElement.prototype, \"level\", void 0);\n__decorate([\n    bindable,\n    __metadata(\"design:type\", Object)\n], NavCustomElement.prototype, \"classes\", void 0);\nNavCustomElement = __decorate([\n    inject(IRouter, INode),\n    customElement({\n        name: 'au-nav', template: `<template>\n  <nav if.bind=\"name\" class=\"\\${name} \\${navClasses.nav}\">\n    <au-nav routes.bind=\"navRoutes\" classes.bind=\"navClasses\" containerless></au-nav>\n  </nav>\n  <ul if.bind=\"routes\" class=\"nav-level-\\${level} \\${classes.ul}\">\n    <li repeat.for=\"route of routes\" if.bind=\"route.visible\" class=\"\\${route.active ? classes.liActive : ''} \\${route.hasChildren} \\${classes.li}\">\n      <a if.bind=\"route.link && route.link.length\" goto=\"\\${route.link}\" class=\"\\${route.active ? classes.aActive : ''} \\${classes.a}\" innerhtml.bind=\"route.title\"></a>\n      <a if.bind=\"route.execute\" click.trigger=\"route.executeAction($event)\" href=\"\" class=\"\\${route.active ? classes.aActive : ''} \\${classes.a}\" innerhtml.bind=\"route.title\"></a>\n      <span if.bind=\"(!route.link || !route.link.length) && !route.execute && !route.children\" class=\"\\${route.active ? classes.aActive : ''} \\${classes.span} nav-separator\" innerhtml.bind=\"route.title\"></span>\n      <a if.bind=\"(!route.link || !route.link.length) && !route.execute && route.children\" click.delegate=\"route.toggleActive()\" href=\"\" class=\"\\${route.active ? classes.aActive : ''} \\${classes.a}\" innerhtml.bind=\"route.title\"></a>\n      <au-nav if.bind=\"route.children\" routes.bind=\"route.children\" level.bind=\"level + 1\" classes.bind=\"classes\" containerless></au-nav>\n    </li>\n  </ul>\n</template>`\n    }),\n    __metadata(\"design:paramtypes\", [Object])\n], NavCustomElement);\nexport { NavCustomElement };\n//# sourceMappingURL=nav.js.map","import { __decorate, __metadata, __param } from \"tslib\";\nimport { IContainer } from '@aurelia/kernel';\nimport { bindable, INode, customElement, CustomElement, } from '@aurelia/runtime';\nimport { IRouter } from '../router';\nexport const ParentViewport = CustomElement.createInjectable();\nlet ViewportCustomElement = class ViewportCustomElement {\n    constructor(router, element, container, parentViewport) {\n        this.router = router;\n        this.container = container;\n        this.parentViewport = parentViewport;\n        this.name = 'default';\n        this.usedBy = '';\n        this.default = '';\n        this.fallback = '';\n        this.noScope = false;\n        this.noLink = false;\n        this.noHistory = false;\n        this.stateful = false;\n        this.viewport = null;\n        this.isBound = false;\n        this.element = element;\n    }\n    afterCompile(controller) {\n        this.container = controller.context.get(IContainer);\n        // console.log('Viewport creating', this.getAttribute('name', this.name), this.container, this.parentViewport, controller, this);\n        // this.connect();\n    }\n    afterUnbind() {\n        this.isBound = false;\n    }\n    connect() {\n        if (this.router.rootScope === null) {\n            return;\n        }\n        const name = this.getAttribute('name', this.name);\n        let value = this.getAttribute('no-scope', this.noScope);\n        const options = { scope: value === void 0 || !value ? true : false };\n        value = this.getAttribute('used-by', this.usedBy);\n        if (value !== void 0) {\n            options.usedBy = value;\n        }\n        value = this.getAttribute('default', this.default);\n        if (value !== void 0) {\n            options.default = value;\n        }\n        value = this.getAttribute('fallback', this.fallback);\n        if (value !== void 0) {\n            options.fallback = value;\n        }\n        value = this.getAttribute('no-link', this.noLink, true);\n        if (value !== void 0) {\n            options.noLink = value;\n        }\n        value = this.getAttribute('no-history', this.noHistory, true);\n        if (value !== void 0) {\n            options.noHistory = value;\n        }\n        value = this.getAttribute('stateful', this.stateful, true);\n        if (value !== void 0) {\n            options.stateful = value;\n        }\n        this.viewport = this.router.connectViewport(this.viewport, this.container, name, this.element, options);\n    }\n    disconnect() {\n        if (this.viewport) {\n            this.router.disconnectViewport(this.viewport, this.container, this.element);\n        }\n        this.viewport = null;\n    }\n    beforeBind(flags) {\n        this.isBound = true;\n        this.connect();\n        if (this.viewport) {\n            this.viewport.beforeBind(flags);\n        }\n    }\n    beforeAttach(flags) {\n        if (this.viewport) {\n            return this.viewport.beforeAttach(flags);\n        }\n        return Promise.resolve();\n    }\n    beforeDetach(flags) {\n        if (this.viewport) {\n            return this.viewport.beforeDetach(flags);\n        }\n        return Promise.resolve();\n    }\n    async beforeUnbind(flags) {\n        if (this.viewport) {\n            await this.viewport.beforeUnbind(flags);\n            this.disconnect();\n        }\n    }\n    getAttribute(key, value, checkExists = false) {\n        const result = {};\n        if (this.isBound) {\n            return value;\n        }\n        else {\n            if (this.element.hasAttribute(key)) {\n                if (checkExists) {\n                    return true;\n                }\n                else {\n                    value = this.element.getAttribute(key);\n                    if (value.length > 0) {\n                        return value;\n                    }\n                }\n            }\n        }\n        return void 0;\n    }\n};\n__decorate([\n    bindable,\n    __metadata(\"design:type\", String)\n], ViewportCustomElement.prototype, \"name\", void 0);\n__decorate([\n    bindable,\n    __metadata(\"design:type\", String)\n], ViewportCustomElement.prototype, \"usedBy\", void 0);\n__decorate([\n    bindable,\n    __metadata(\"design:type\", String)\n], ViewportCustomElement.prototype, \"default\", void 0);\n__decorate([\n    bindable,\n    __metadata(\"design:type\", String)\n], ViewportCustomElement.prototype, \"fallback\", void 0);\n__decorate([\n    bindable,\n    __metadata(\"design:type\", Boolean)\n], ViewportCustomElement.prototype, \"noScope\", void 0);\n__decorate([\n    bindable,\n    __metadata(\"design:type\", Boolean)\n], ViewportCustomElement.prototype, \"noLink\", void 0);\n__decorate([\n    bindable,\n    __metadata(\"design:type\", Boolean)\n], ViewportCustomElement.prototype, \"noHistory\", void 0);\n__decorate([\n    bindable,\n    __metadata(\"design:type\", Boolean)\n], ViewportCustomElement.prototype, \"stateful\", void 0);\nViewportCustomElement = __decorate([\n    customElement({\n        name: 'au-viewport',\n        injectable: ParentViewport\n    }),\n    __param(0, IRouter),\n    __param(1, INode),\n    __param(2, IContainer),\n    __param(3, ParentViewport),\n    __metadata(\"design:paramtypes\", [Object, Object, Object, ViewportCustomElement])\n], ViewportCustomElement);\nexport { ViewportCustomElement };\n//# sourceMappingURL=viewport.js.map","import { __decorate, __metadata, __param } from \"tslib\";\nimport { bindable, INode, customElement, CustomElement, CustomElementDefinition, IController, } from '@aurelia/runtime';\nimport { IRouter } from '../router';\nimport { IContainer } from '@aurelia/kernel';\nexport const ParentViewportScope = CustomElement.createInjectable();\nlet ViewportScopeCustomElement = class ViewportScopeCustomElement {\n    constructor(router, element, container, parent, parentController) {\n        this.router = router;\n        this.container = container;\n        this.parent = parent;\n        this.parentController = parentController;\n        this.name = 'default';\n        this.catches = '';\n        this.collection = false;\n        this.source = null;\n        this.viewportScope = null;\n        this.isBound = false;\n        this.element = element;\n    }\n    create(controller, parentContainer, definition, parts) {\n        // TODO(fkleuver): describe this somewhere in the docs instead\n        // Under the condition that there is no `replace` attribute on this custom element's declaration,\n        // and this custom element is containerless, its content will be placed in a part named 'default'\n        // See packages/jit-html/src/template-binder.ts line 411 (`replace = 'default';`) for the logic that governs this.\n        // We could tidy this up into a formal api in the future. For now, there are two ways to do this:\n        // 1. inject the `@ITargetedInstruction` (IHydrateElementInstruction) and grab .parts['default'] from there, manually creating a view factory from that, etc.\n        // 2. what we're doing right here: grab the 'default' part from the create hook and return it as the definition, telling the render context to use that part to compile this element instead\n        // This effectively causes this element to render its declared content as if it was its own template.\n        // We do need to set `containerless` to true on the part definition so that the correct projector is used since parts default to non-containerless.\n        // Otherwise, the controller will try to do `appendChild` on a comment node when it has to do `insertBefore`.\n        // Also, in this particular scenario (specific to viewport-scope) we need to clone the part so as to prevent the resulting compiled definition\n        // from ever being cached. That's the only reason why we're spreading the part into a new object for `getOrCreate`. If we didn't clone the object, this specific element wouldn't work correctly.\n        const part = parts['default'];\n        return CustomElementDefinition.getOrCreate({ ...part, containerless: true });\n    }\n    afterCompile(controller) {\n        this.container = controller.context.get(IContainer);\n        // console.log('ViewportScope creating', this.getAttribute('name', this.name), this.container, this.parent, controller, this);\n        // this.connect();\n    }\n    afterUnbound() {\n        this.isBound = false;\n    }\n    connect() {\n        if (this.router.rootScope === null) {\n            return;\n        }\n        const name = this.getAttribute('name', this.name);\n        const options = {};\n        let value = this.getAttribute('catches', this.catches);\n        if (value !== void 0) {\n            options.catches = value;\n        }\n        value = this.getAttribute('collection', this.collection, true);\n        if (value !== void 0) {\n            options.collection = value;\n        }\n        // TODO: Needs to be bound? How to solve?\n        options.source = this.source || null;\n        this.viewportScope = this.router.connectViewportScope(this.viewportScope, name, this.container, this.element, options);\n    }\n    disconnect() {\n        if (this.viewportScope) {\n            this.router.disconnectViewportScope(this.viewportScope, this.container);\n        }\n        this.viewportScope = null;\n    }\n    beforeBind(flags) {\n        this.isBound = true;\n        this.$controller.scope = this.parentController.scope;\n        this.connect();\n        if (this.viewportScope !== null) {\n            this.viewportScope.beforeBind();\n        }\n    }\n    async beforeUnbind(flags) {\n        if (this.viewportScope !== null) {\n            this.viewportScope.beforeUnbind();\n        }\n        this.disconnect();\n        return Promise.resolve();\n    }\n    getAttribute(key, value, checkExists = false) {\n        const result = {};\n        if (this.isBound) {\n            return value;\n        }\n        else {\n            if (this.element.hasAttribute(key)) {\n                if (checkExists) {\n                    return true;\n                }\n                else {\n                    value = this.element.getAttribute(key);\n                    if (value.length > 0) {\n                        return value;\n                    }\n                }\n            }\n        }\n        return void 0;\n    }\n};\n__decorate([\n    bindable,\n    __metadata(\"design:type\", String)\n], ViewportScopeCustomElement.prototype, \"name\", void 0);\n__decorate([\n    bindable,\n    __metadata(\"design:type\", String)\n], ViewportScopeCustomElement.prototype, \"catches\", void 0);\n__decorate([\n    bindable,\n    __metadata(\"design:type\", Boolean)\n], ViewportScopeCustomElement.prototype, \"collection\", void 0);\n__decorate([\n    bindable,\n    __metadata(\"design:type\", Object)\n], ViewportScopeCustomElement.prototype, \"source\", void 0);\nViewportScopeCustomElement = __decorate([\n    customElement({\n        name: 'au-viewport-scope',\n        template: '<template></template>',\n        containerless: true,\n        injectable: ParentViewportScope\n    }),\n    __param(0, IRouter),\n    __param(1, INode),\n    __param(2, IContainer),\n    __param(3, ParentViewportScope),\n    __param(4, IController),\n    __metadata(\"design:paramtypes\", [Object, Object, Object, ViewportScopeCustomElement, Object])\n], ViewportScopeCustomElement);\nexport { ViewportScopeCustomElement };\n//# sourceMappingURL=viewport-scope.js.map","import { __decorate, __metadata, __param } from \"tslib\";\nimport { NavigationInstructionResolver } from '../type-resolvers';\nimport { customAttribute, INode, bindable, BindingMode, IDOM, DelegationStrategy, IObserverLocator, CustomAttribute } from '@aurelia/runtime';\nimport { IRouter } from '../router';\nimport { IEventManager } from '@aurelia/runtime-html';\nlet GotoCustomAttribute = class GotoCustomAttribute {\n    constructor(dom, element, router, eventManager) {\n        this.dom = dom;\n        this.router = router;\n        this.eventManager = eventManager;\n        this.listener = null;\n        this.hasHref = null;\n        this.activeClass = 'goto-active';\n        this.element = element;\n    }\n    beforeBind() {\n        this.listener = this.eventManager.addEventListener(this.dom, this.element, 'click', this.router.linkHandler.handler, DelegationStrategy.none);\n        this.updateValue();\n        const observerLocator = this.router.container.get(IObserverLocator);\n        this.observer = observerLocator.getObserver(0 /* none */, this.router, 'activeComponents');\n        this.observer.subscribe(this);\n    }\n    beforeUnbind() {\n        if (this.listener !== null) {\n            this.listener.dispose();\n        }\n        this.observer.unsubscribe(this);\n    }\n    valueChanged(newValue) {\n        this.updateValue();\n    }\n    updateValue() {\n        if (this.hasHref === null) {\n            this.hasHref = this.element.hasAttribute('href');\n        }\n        if (!this.hasHref) {\n            // TODO: Figure out a better value here for non-strings (using InstructionResolver?)\n            const value = typeof this.value === 'string' ? this.value : JSON.stringify(this.value);\n            this.element.setAttribute('href', value);\n        }\n    }\n    handleChange() {\n        const controller = CustomAttribute.for(this.element, 'goto').parent;\n        const created = NavigationInstructionResolver.createViewportInstructions(this.router, this.value, { context: controller });\n        const instructions = NavigationInstructionResolver.toViewportInstructions(this.router, created.instructions);\n        for (const instruction of instructions) {\n            if (instruction.scope === null) {\n                instruction.scope = created.scope;\n            }\n        }\n        // TODO: Use router configuration for class name and update target\n        if (this.router.checkActive(instructions)) {\n            this.element.classList.add(this.activeClass);\n        }\n        else {\n            this.element.classList.remove(this.activeClass);\n        }\n    }\n};\n__decorate([\n    bindable({ mode: BindingMode.toView }),\n    __metadata(\"design:type\", Object)\n], GotoCustomAttribute.prototype, \"value\", void 0);\nGotoCustomAttribute = __decorate([\n    customAttribute('goto'),\n    __param(0, IDOM),\n    __param(1, INode),\n    __param(2, IRouter),\n    __param(3, IEventManager),\n    __metadata(\"design:paramtypes\", [Object, Object, Object, Object])\n], GotoCustomAttribute);\nexport { GotoCustomAttribute };\n//# sourceMappingURL=goto.js.map","import { __decorate, __metadata, __param } from \"tslib\";\nimport { customAttribute, INode, bindable, BindingMode, IDOM, DelegationStrategy } from '@aurelia/runtime';\nimport { IRouter } from '../router';\nimport { GotoCustomAttribute } from '../configuration';\nimport { IEventManager } from '@aurelia/runtime-html';\nlet HrefCustomAttribute = class HrefCustomAttribute {\n    constructor(dom, element, router, eventManager) {\n        this.dom = dom;\n        this.router = router;\n        this.eventManager = eventManager;\n        this.eventListener = null;\n        this.element = element;\n    }\n    beforeBind() {\n        if (this.router.options.useHref && !this.hasGoto()) {\n            this.eventListener = this.eventManager.addEventListener(this.dom, this.element, 'click', this.router.linkHandler.handler, DelegationStrategy.none);\n        }\n        this.updateValue();\n    }\n    beforeUnbind() {\n        if (this.eventListener !== null) {\n            this.eventListener.dispose();\n        }\n    }\n    valueChanged() {\n        this.updateValue();\n    }\n    updateValue() {\n        this.element.setAttribute('href', this.value);\n    }\n    hasGoto() {\n        const parent = this.$controller.parent;\n        const siblings = parent.vmKind !== 1 /* customAttribute */ ? parent.controllers : void 0;\n        return siblings !== void 0\n            && siblings.some(c => c.vmKind === 1 /* customAttribute */ && c.viewModel instanceof GotoCustomAttribute);\n    }\n};\n__decorate([\n    bindable({ mode: BindingMode.toView }),\n    __metadata(\"design:type\", Object)\n], HrefCustomAttribute.prototype, \"value\", void 0);\nHrefCustomAttribute = __decorate([\n    customAttribute('href'),\n    __param(0, IDOM),\n    __param(1, INode),\n    __param(2, IRouter),\n    __param(3, IEventManager),\n    __metadata(\"design:paramtypes\", [Object, Object, Object, Object])\n], HrefCustomAttribute);\nexport { HrefCustomAttribute };\n//# sourceMappingURL=href.js.map","import { DI } from '@aurelia/kernel';\nimport { StartTask } from '@aurelia/runtime';\nimport { NavCustomElement } from './resources/nav';\nimport { ViewportCustomElement } from './resources/viewport';\nimport { ViewportScopeCustomElement } from './resources/viewport-scope';\nimport { GotoCustomAttribute } from './resources/goto';\nimport { HrefCustomAttribute } from './resources/href';\nimport { IRouter } from './router';\nexport const RouterRegistration = IRouter;\n/**\n * Default runtime/environment-agnostic implementations for the following interfaces:\n * - `IRouter`\n */\nexport const DefaultComponents = [\n    RouterRegistration,\n];\nexport { ViewportCustomElement, ViewportScopeCustomElement, NavCustomElement, GotoCustomAttribute, HrefCustomAttribute, };\nexport const ViewportCustomElementRegistration = ViewportCustomElement;\nexport const ViewportScopeCustomElementRegistration = ViewportScopeCustomElement;\nexport const NavCustomElementRegistration = NavCustomElement;\nexport const GotoCustomAttributeRegistration = GotoCustomAttribute;\nexport const HrefCustomAttributeRegistration = HrefCustomAttribute;\n/**\n * Default router resources:\n * - Custom Elements: `au-viewport`, `au-nav`\n * - Custom Attributes: `goto`, `href`\n */\nexport const DefaultResources = [\n    ViewportCustomElement,\n    ViewportScopeCustomElement,\n    NavCustomElement,\n    GotoCustomAttribute,\n    HrefCustomAttribute,\n];\nlet configurationOptions = {};\nlet configurationCall = (router) => {\n    router.activate(configurationOptions);\n};\n/**\n * A DI configuration object containing router resource registrations.\n */\nconst routerConfiguration = {\n    /**\n     * Apply this configuration to the provided container.\n     */\n    register(container) {\n        return container.register(...DefaultComponents, ...DefaultResources, StartTask.with(IRouter).beforeBind().call(configurationCall), StartTask.with(IRouter).beforeAttach().call(router => router.loadUrl()));\n    },\n    /**\n     * Create a new container with this configuration applied to it.\n     */\n    createContainer() {\n        return this.register(DI.createContainer());\n    }\n};\nexport const RouterConfiguration = {\n    /**\n     * Make it possible to specify options to Router activation.\n     * Parameter is either a config object that's passed to Router's activate\n     * or a config function that's called instead of Router's activate.\n     */\n    customize(config) {\n        if (config === undefined) {\n            configurationOptions = {};\n            configurationCall = (router) => {\n                router.activate(configurationOptions);\n            };\n        }\n        else if (config instanceof Function) {\n            configurationCall = config;\n        }\n        else {\n            configurationOptions = config;\n        }\n        return { ...routerConfiguration };\n    },\n    ...routerConfiguration,\n};\n//# sourceMappingURL=configuration.js.map","<audio autoplay durationchange.trigger=\"updateDuration($event.target)\" timeupdate.trigger=\"updateCurrentTime($event.target)\" ref=\"audioElement\">\r\n    <source src.bind=\"url\" type=\"audio/mpeg\" />\r\n</audio>\r\n \r\n\r\n<input class=\"current-time\" title=\"location\" type=\"range\" min=\"0\" max=\"100\" value=\"0\" class=\"slider\" step=\".001\" input.delegate=\"slideTimeUpdate($event.target.value)\" />\r\n<div>${currentLocation} - ${totalLength}</div>\r\n\r\n<div class=\"controls\">\r\n    <button type=\"button\" click.delegate=\"goToBeginning()\" title=\"go to beginning\">\r\n        <i class=\"icon\">&#9614;&#9668;</i>\r\n        <span>Start</span>\r\n    </button>\r\n    <button type=\"button\" click.delegate=\"rewind()\" title=\"seek backward\">\r\n        <i class=\"icon seek\">&#9668;&#9668;</i>\r\n        <span>Rewind</span>\r\n    </button>\r\n\r\n    <button type=\"button\" class=\"play\" click.delegate=\"togglePlay()\" title=\"play\">\r\n        <i class=\"icon\" if.bind=\"audioElement.paused\">&#9658;</i>\r\n        <i class=\"icon\" if.bind=\"!audioElement.paused\">&#9614; &#9614;</i>\r\n        <span>${audioElement.paused ? 'Play' : 'Pause'}</span>\r\n    </button>\r\n\r\n    <button type=\"button\" click.delegate=\"fastForward()\" title=\"seek forward\">\r\n        <i class=\"icon seek\">&#9658;&#9658;</i>\r\n        <span>Advance</span>\r\n    </button>\r\n    <button type=\"button\" click.delegate=\"goToEnd()\" title=\"go to end\">\r\n        <i class=\"icon\">&#9658;&#9614;</i>\r\n        <span>End</span>\r\n    </button>\r\n\r\n    <div class=\"volume\">\r\n        <i class=\"icon\">&#128362;</i>\r\n        <input title=\"volume\" type=\"range\" min=\"0\" max=\"100\" value.bind=\"volume\" class=\"slider\" input.delegate=\"updateVolume($event.target.value)\" />\r\n    </div>\r\n</div>\r\n","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __metadata = (this && this.__metadata) || function (k, v) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n};\r\nimport * as __au2ViewDef from './audio-player.html';\r\nimport { customElement } from '@aurelia/runtime';\r\n/* https://ilikekillnerds.com/category/aurelia-2/\r\n   https://stackoverflow.com/questions/12325787/setting-the-granularity-of-the-html5-audio-event-timeupdate#comment-69606299\r\n*/\r\nimport { inject, bindable } from 'aurelia';\r\nlet AudioPlayer = class AudioPlayer {\r\n    constructor(element) {\r\n        this.element = element;\r\n        this.totalLength = '00:00';\r\n        this.currentLocation = '00:00';\r\n        this.volume = 50;\r\n    }\r\n    get currentTimeElement() {\r\n        return this.element.querySelector('.current-time');\r\n    }\r\n    set currentTime(currentTime) {\r\n        this.currentTimeElement.value = ((currentTime / this.audioElement.duration) * 100).toString();\r\n        this.currentLocation = this.createTimeSpan(currentTime);\r\n    }\r\n    updateDuration(audioElement) {\r\n        if (audioElement.duration) {\r\n            this.totalLength = this.createTimeSpan(audioElement.duration);\r\n        }\r\n    }\r\n    updateCurrentTime(audioElement) {\r\n        this.currentTime = audioElement.currentTime;\r\n    }\r\n    slideTimeUpdate(percent) {\r\n        this.currentTime = this.audioElement.duration * (percent / 100);\r\n        this.audioElement.currentTime = this.audioElement.duration * (percent / 100);\r\n    }\r\n    togglePlay() {\r\n        if (this.audioElement.paused) {\r\n            this.audioElement.play();\r\n        }\r\n        else {\r\n            this.audioElement.pause();\r\n        }\r\n    }\r\n    goToBeginning() {\r\n        this.currentTime = 0;\r\n        this.audioElement.currentTime = 0;\r\n    }\r\n    fastForward() {\r\n        const currentTime = this.audioElement.currentTime;\r\n        this.currentTime = currentTime + 15;\r\n        this.audioElement.currentTime = currentTime + 15;\r\n    }\r\n    rewind() {\r\n        const currentTime = this.audioElement.currentTime;\r\n        this.currentTime = currentTime - 15;\r\n        this.audioElement.currentTime = currentTime - 15;\r\n    }\r\n    goToEnd() {\r\n        this.currentTime = this.audioElement.duration;\r\n        this.audioElement.currentTime = this.audioElement.duration;\r\n    }\r\n    updateVolume(volume) {\r\n        this.audioElement.volume = volume / 100;\r\n        this.volume = volume;\r\n    }\r\n    // public percentLoaded() {\r\n    //     for (let i = 0; i < this.audioElement.buffered.length; i++) {\r\n    //         if (this.audioElement.buffered.start(this.audioElement.buffered.length - 1 - i) < this.audioElement.currentTime) {\r\n    //             console.log((this.audioElement.buffered.end(this.audioElement.buffered.length - 1 - i) / this.audioElement.duration) * 100 + \"%\");\r\n    //             break;\r\n    //         }\r\n    //     }\r\n    // }\r\n    createTimeSpan(timeInSeconds) {\r\n        let minutes = Math.floor((timeInSeconds / 60)).toFixed(0);\r\n        let seconds = Math.floor((timeInSeconds % 60)).toFixed(0);\r\n        minutes = minutes.length === 1 ? `0${minutes}` : minutes;\r\n        seconds = seconds.length === 1 ? `0${seconds}` : seconds;\r\n        return `${minutes}:${seconds}`;\r\n    }\r\n};\r\n__decorate([\r\n    bindable,\r\n    __metadata(\"design:type\", String)\r\n], AudioPlayer.prototype, \"url\", void 0);\r\nAudioPlayer = __decorate([\r\n    customElement(__au2ViewDef),\r\n    inject(Element),\r\n    __metadata(\"design:paramtypes\", [Element])\r\n], AudioPlayer);\r\nexport { AudioPlayer };\r\n","<import from=\"./audio-player\"></import>\n\n<header>\n    <h1>TorahIs.Life</h1>\n</header>\n\n<main>\n    <div class=\"wrapper\">\n        <div class=\"card\" repeat.for=\"shiur of shiurim\">\n            <span class=\"inner-border\"></span>\n            <h3>${shiur.subseries} - ${shiur.title}</h3>\n            <h5>\n                <div repeat.for=\"version of shiur.versions\">\n                    <a click.delegate=\"openDialog(shiur, version)\" href=\"javascript:void(0)\">${version.name} (${version.duration})</a>\n                    <button type=\"button\" title=\"Download the shiur\" click.delegate=\"downloadShiur(shiur, version)\">&#x21A7;</button>\n                </div>\n            </h5>\n            <div>${shiur.author}</div>\n        </div>\n    </div>\n</main>\n\n<div class=\"faux-dialog\" if.bind=\"selectedShiur\">\n    <div class=\"close\" click.delegate=\"closeDialog()\">X</div>\n    <audio-player url=\"https://torahislife.azurewebsites.net/api/ShiurRetriever?name=${selectedShiur.getVersionLocation(selectedVersion)}\"></audio-player>\n</div>\n\n<footer>Powered by Pinary Development LLC  ${copyrightYears}</footer>","export class Shiur {\r\n    constructor(shiur) {\r\n        this.normalize = (str) => str.replace(/\\s/g, '').toLocaleLowerCase();\r\n        Object.assign(this, shiur);\r\n        this.versions = shiur.versions.slice(0);\r\n    }\r\n    getVersionLocation(version) {\r\n        return encodeURIComponent(`dist/${this.normalize(this.author)}/${this.normalize(this.series)}/${this.normalize(this.subseries)}/${this.title} - ${this.versions.find(v => v.name === version.name).name} (${this.date}).mp3`);\r\n    }\r\n}\r\n","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __metadata = (this && this.__metadata) || function (k, v) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n};\r\nimport * as __au2ViewDef from './my-app.html';\r\nimport { customElement } from '@aurelia/runtime';\r\nimport { Shiur } from './shiur';\r\nimport { HttpClient } from 'aurelia';\r\nlet MyApp = class MyApp {\r\n    constructor(client) {\r\n        this.shiurim = [];\r\n        this.selectedShiur = undefined;\r\n        this.selectedVersion = undefined;\r\n        client.get('/data/data.json')\r\n            .then(response => response.json())\r\n            .then(data => {\r\n            data.shiurim.forEach((shiur) => this.shiurim.push(new Shiur(shiur)));\r\n        });\r\n    }\r\n    openDialog(shiur, version) {\r\n        this.selectedVersion = version;\r\n        this.selectedShiur = shiur;\r\n        document.querySelector('.faux-dialog').classList.add('full');\r\n    }\r\n    closeDialog() {\r\n        document.querySelector('.faux-dialog').classList.remove('full');\r\n        setTimeout(() => {\r\n            this.selectedShiur = undefined;\r\n            this.selectedVersion = undefined;\r\n        }, 250);\r\n    }\r\n    get copyrightYears() {\r\n        const firstYear = 2020;\r\n        const currentYear = new Date(Date.now()).getFullYear();\r\n        if (currentYear === firstYear) {\r\n            return firstYear.toString();\r\n        }\r\n        return `${firstYear} - ${currentYear}`;\r\n    }\r\n    downloadShiur(shiur, version) {\r\n        window.location.href = `https://torahislife.azurewebsites.net/api/ShiurRetriever?name=${shiur.getVersionLocation(version)}`;\r\n    }\r\n};\r\nMyApp = __decorate([\r\n    customElement(__au2ViewDef),\r\n    __metadata(\"design:paramtypes\", [HttpClient])\r\n], MyApp);\r\nexport { MyApp };\r\n","import Aurelia from 'aurelia';\r\nimport { MyApp } from './my-app';\r\n// import * as globalComponents from './registry';\r\nAurelia\r\n    // .register(globalComponents)\r\n    .app(MyApp)\r\n    .start();\r\n"],"sourceRoot":""}